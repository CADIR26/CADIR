<!DOCTYPE html>
<html lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PILOTE — PERDIR</title>
    <link rel="stylesheet" href="CADIR_fichiers/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous">
    <!-- Aptos: police native Windows 11/Office. Pas de Google Fonts nécessaire -->
    <script src="CADIR_fichiers/xlsx.full.min.js"></script>
    <style>
        :root {
            --nav-h: 52px;
            --c-bg: #f0f1f4;
            --c-nav: #1b2433;
            --c-nav-hover: #273347;
            --c-accent: #d4483b;
            --c-accent-glow: rgba(212,72,59,0.35);
            --c-text: #e8eaed;
            --c-text-dim: #8b92a0;
            --c-card: #ffffff;
            --c-border: #dfe2e8;
            --c-success: #2ecc71;
            --c-info: #3498db;
            --c-warning: #f39c12;
            --c-purple: #9b59b6;
            --radius: 10px;
            --shadow: 0 4px 24px rgba(0,0,0,0.08);
            --font: 'Aptos', 'Calibri', 'Trebuchet MS', Arial, sans-serif;
            --font-display: 'Aptos', 'Calibri', 'Trebuchet MS', Arial, sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font); background: var(--c-bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; color: #2c3040; }

        /* ═══ TOP NAV ═══ */
        .topnav { height: var(--nav-h); background: var(--c-nav); display: flex; align-items: center; padding: 0 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.25); z-index: 1000; flex-shrink: 0; position: relative; }
        .topnav::after { content:''; position:absolute; bottom:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--c-accent),#f39c12,var(--c-accent)); opacity:0.7; }
        .brand { display:flex; align-items:center; gap:8px; margin-right:20px; cursor:pointer; text-decoration:none; }
        .brand-icon { width:32px; height:32px; background:var(--c-accent); border-radius:7px; display:flex; align-items:center; justify-content:center; font-size:15px; color:white; font-weight:700; box-shadow:0 2px 8px var(--c-accent-glow); overflow:hidden; }
        .brand-icon img { width:100%; height:100%; object-fit:contain; }
        .brand-text { font-family:var(--font-display); font-size:1.05rem; font-weight:700; color:#fff; }
        .brand-text span { color:var(--c-text-dim); font-family:var(--font); font-weight:400; font-size:0.6rem; display:block; margin-top:-2px; letter-spacing:1.5px; text-transform:uppercase; }
        .nav-sep { width:3px; height:28px; background:#ffffff; margin:0 8px; border-radius:2px; }
        .nav-items { display:flex; align-items:center; gap:3px; height:100%; }
        .nav-item { display:flex; align-items:center; gap:7px; padding:7px 14px; border-radius:7px; cursor:pointer; transition:all 0.2s; color:var(--c-text-dim); font-size:0.8rem; font-weight:500; position:relative; height:34px; user-select:none; white-space:nowrap; }
        .nav-item:hover { background:var(--c-nav-hover); color:var(--c-text); }
        
        .nav-shortcut { font-size:.5rem; background:rgba(255,255,255,.15); color:rgba(255,255,255,.5); padding:1px 4px; border-radius:3px; margin-left:4px; font-family:monospace; vertical-align:middle; display:none; }
        .nav-item:hover .nav-shortcut { display:inline; }
        .nav-item.active { background:rgba(212,72,59,0.12); color:#fff; }
        .nav-item.active::after { content:''; position:absolute; bottom:-9px; left:50%; transform:translateX(-50%); width:20px; height:3px; background:var(--c-accent); border-radius:3px 3px 0 0; }
        .nav-item.hidden-module { display: none !important; }
        .nav-item i { font-size:0.9rem; width:16px; text-align:center; }
        .nav-badge { font-size:0.55rem; padding:1px 5px; border-radius:10px; font-weight:600; }
        .nav-item[data-module="perdir"] .nav-badge { background:var(--c-info); color:#fff; }
        .nav-item[data-module="exam"] .nav-badge { background:var(--c-accent); color:#fff; }
        .nav-item[data-module="oral"] .nav-badge { background:var(--c-warning); color:#fff; }
        .nav-item[data-module="aed"] .nav-badge { background:var(--c-success); color:#fff; }
            [data-module="bibase"] .nav-badge { background:#e67e22; color:#fff; }
        .nav-item[data-module="data"] .nav-badge { background:var(--c-purple); color:#fff; }
        .nav-item[data-module="dhg"] .nav-badge { background:#16a085; color:#fff; }
        .module-card[data-m="dhg"]::before { background:#16a085; }
        .module-card[data-m="dhg"] .module-icon { background:#16a085; transition: transform 320ms cubic-bezier(.2,.8,.2,1), filter 320ms; }

        .nav-right { margin-left:auto; display:flex; align-items:center; gap:8px; }
        .nav-clock { color:var(--c-text-dim); font-size:0.75rem; font-variant-numeric:tabular-nums; }
        .nav-btn { width:32px; height:32px; border-radius:7px; border:none; background:var(--c-nav-hover); color:var(--c-text-dim); cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s; font-size:0.8rem; }
        .nav-btn:hover { background:rgba(255,255,255,0.12); color:white; }

        /* ═══ SETTINGS OVERLAY ═══ */
        .settings-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:2000; display:none; align-items:center; justify-content:center; backdrop-filter:blur(4px); }
        .settings-overlay.open { display:flex; }
        .settings-panel { background:white; border-radius:14px; width:720px; max-width:95vw; max-height:92vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.25); animation:panelIn 0.25s ease; }
        @keyframes panelIn { from{opacity:0;transform:translateY(20px) scale(0.97)} to{opacity:1;transform:none} }
        .settings-header { padding:18px 24px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
        .settings-header h2 { font-size:1.1rem; font-weight:600; color:var(--c-nav); display:flex; align-items:center; gap:10px; }
        .settings-header h2 i { color:var(--c-accent); }
        .settings-close { background:none; border:none; font-size:1.3rem; cursor:pointer; color:#999; padding:4px; }
        .settings-close:hover { color:#333; }
        .settings-body { padding:24px; display:flex; flex-direction:column; gap:12px; }
.settings-body .acc-section{ width:100%; margin:0; }
.settings-body .acc-section .acc-header{ width:100%; }
.settings-body .acc-section .acc-body{ width:100%; }

        .settings-section { margin-bottom:24px; }
        .settings-section h3 { font-size:0.8rem; font-weight:600; color:#666; text-transform:uppercase; letter-spacing:1px; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
        .settings-section h3 i { color:var(--c-info); }
        .settings-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
        .form-group { display:flex; flex-direction:column; gap:4px; }
        .form-group label { font-size:0.78rem; font-weight:500; color:#555; }
        .form-group input[type="text"] { padding:9px 12px; border:1px solid #ddd; border-radius:8px; font-size:0.85rem; font-family:var(--font); transition:border 0.2s; }
        .form-group input[type="text"]:focus { outline:none; border-color:var(--c-info); box-shadow:0 0 0 3px rgba(52,152,219,0.1); }
        .form-group input[type="file"] { font-size:0.75rem; }
        .img-preview { width:100%; height:72px; border:2px dashed #ddd; border-radius:8px; display:flex; align-items:center; justify-content:center; background:#fafafa; margin-top:4px; overflow:hidden; position:relative; }
        .img-preview img { max-height:64px; max-width:100%; object-fit:contain; }
        .img-preview .placeholder { color:#bbb; font-size:0.7rem; }
        .img-preview .btn-clear { position:absolute; top:3px; right:3px; width:18px; height:18px; background:rgba(0,0,0,0.5); color:white; border:none; border-radius:50%; cursor:pointer; font-size:0.55rem; display:none; align-items:center; justify-content:center; }
        .img-preview:hover .btn-clear { display:flex; }

        
        /* ═══ ACCORDION SETTINGS ═══ */
        .acc-section{border:1px solid #e8eaed;border-radius:10px;margin-bottom:10px;}
        .acc-header{display:flex;align-items:center;gap:10px;padding:14px 18px;cursor:pointer;background:#fafbfc;border-radius:10px;user-select:none;}
        .acc-header:hover{background:#eaf4fe;}
        .acc-header h3{font-size:0.82rem;font-weight:600;color:#444;text-transform:uppercase;letter-spacing:0.8px;margin:0;display:flex;align-items:center;gap:8px;flex:1;}
        .acc-header h3 i{color:var(--c-info);font-size:.85rem;}
        .acc-chevron{font-size:.7rem;color:#aaa;transition:transform 0.3s;}
        .acc-section.open .acc-header{background:#eaf4fe;border-bottom:1px solid #e0e0e0;border-radius:10px 10px 0 0;}
        .acc-section.open .acc-chevron{transform:rotate(90deg);color:var(--c-info);}
        .acc-body{display:none;padding:16px 18px;}
        .acc-section.open .acc-body{display:block;}

        
        .cloud-prov-btn{padding:10px 14px;border:2px solid #e0e0e0;border-radius:10px;background:#fff;cursor:pointer;text-align:center;font-family:var(--font);font-size:.78rem;font-weight:600;color:#555;transition:all .2s;flex:1;min-width:110px;}
        .cloud-prov-btn:hover{border-color:#3498db;background:#f0f7ff;}
        .cloud-prov-btn.active{border-color:#3498db;background:#eaf4fe;color:#2c3e50;box-shadow:0 2px 8px rgba(52,152,219,.15);}
        .cloud-prov-btn i{font-size:1.2rem;display:block;margin-bottom:4px;}
        .cloud-prov-btn small{font-weight:400;color:#888;font-size:.62rem;}

        /* Module toggles */
        .module-toggle { display:flex; align-items:center; gap:12px; padding:9px 0; border-bottom:1px solid #f0f0f0; }
        .module-toggle:last-child { border-bottom:none; }
        .module-toggle-icon { width:30px; height:30px; border-radius:7px; display:flex; align-items:center; justify-content:center; color:white; font-size:0.8rem; }
        .module-toggle-info { flex:1; }
        .module-toggle-info strong { font-size:0.82rem; color:#333; }
        .module-toggle-info span { font-size:0.68rem; color:#999; display:block; }
        .toggle-switch { position:relative; width:42px; height:23px; cursor:pointer; }
        .toggle-switch input { opacity:0; width:0; height:0; }
        .toggle-slider { position:absolute; inset:0; background:#ddd; border-radius:23px; transition:0.3s; }
        .toggle-slider::before { content:''; position:absolute; height:17px; width:17px; left:3px; bottom:3px; background:white; border-radius:50%; transition:0.3s; box-shadow:0 1px 3px rgba(0,0,0,0.2); }
        .toggle-switch input:checked + .toggle-slider { background:var(--c-success); }
        .toggle-switch input:checked + .toggle-slider::before { transform:translateX(19px); }

        /* Drag-and-drop order */
        .order-list { list-style:none; }
        .order-item { display:flex; align-items:center; gap:12px; padding:10px 14px; margin-bottom:6px; background:#f8f9fa; border:1px solid #e8eaed; border-radius:8px; cursor:grab; transition:all 0.2s; user-select:none; }
        .order-item:active { cursor:grabbing; }
        .order-item.dragging { opacity:0.4; background:#e8eaed; }
        .order-item.drag-over { border-color:var(--c-info); background:#eaf4fe; transform:scale(1.01); }
        .order-grip { color:#bbb; font-size:0.9rem; }
        .order-icon { width:26px; height:26px; border-radius:6px; display:flex; align-items:center; justify-content:center; color:white; font-size:0.7rem; flex-shrink:0; }
        .order-label { flex:1; font-size:0.82rem; font-weight:500; color:#333; }
        .order-hint { font-size:0.65rem; color:#aaa; margin-top:6px; }
        .order-item.sep-item { background:#f0f0f0; border:1px dashed #ccc; padding:6px 14px; cursor:grab; }
        .order-item.sep-item:active { cursor:grabbing; }
        .order-item.sep-item .sep-line { flex:1; height:2px; background:rgba(0,0,0,0.12); border-radius:2px; }
        .order-item.sep-item .sep-label { font-size:0.68rem; color:#aaa; font-style:italic; white-space:nowrap; }
        .order-item.sep-item .sep-del { width:20px; height:20px; border:none; background:rgba(0,0,0,0.07); border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:0.6rem; color:#999; flex-shrink:0; }
        .order-item.sep-item .sep-del:hover { background:#fde0e0; color:var(--c-accent); }
        .add-sep-btn { display:inline-flex; align-items:center; gap:6px; padding:6px 14px; border:1px dashed #bbb; border-radius:7px; background:#fafbfc; cursor:pointer; font-size:0.75rem; color:#888; font-family:var(--font); font-weight:500; transition:all 0.2s; margin-top:8px; }
        .add-sep-btn:hover { border-color:var(--c-info); color:var(--c-info); background:#eaf4fe; }

        /* Export/Import buttons */
        .settings-backup { display:flex; gap:8px; flex-wrap:wrap; }
        .backup-btn { display:flex; align-items:center; gap:7px; padding:8px 16px; border:1px solid #ddd; border-radius:8px; background:#fafbfc; cursor:pointer; font-size:0.78rem; font-weight:500; font-family:var(--font); color:#555; transition:all 0.2s; }
        .backup-btn:hover { border-color:var(--c-info); background:#eaf4fe; color:var(--c-info); }
        .backup-btn i { font-size:0.85rem; }
        .backup-btn.import-btn { position:relative; }
        .backup-btn.import-btn input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; }

        .settings-footer { padding:14px 24px; border-top:1px solid #eee; display:flex; justify-content:flex-end; gap:10px; }
        .btn-settings { padding:9px 22px; border:none; border-radius:8px; font-size:0.82rem; font-weight:600; cursor:pointer; font-family:var(--font); transition:all 0.2s; }
        .btn-save { background:var(--c-accent); color:white; }
        .btn-save:hover { background:#c0392b; }
        .btn-cancel { background:#f0f0f0; color:#666; }
        .btn-cancel:hover { background:#e0e0e0; }

        /* ═══ DATA PANEL ═══ */
        .data-panel { position:absolute; inset:0; display:none; flex-direction:column; background:var(--c-bg); z-index:10; overflow-y:auto; }
        .data-panel.active { display:flex; }
        .data-header { padding:30px 40px 0; }
        .data-header h1 { font-family:var(--font-display); font-size:1.6rem; font-weight:700; color:var(--c-nav); display:flex; align-items:center; gap:12px; }
        .data-header h1 i { color:var(--c-purple); }
        .data-header p { color:#6b7280; font-size:0.85rem; margin-top:6px; }
        .data-body { padding:24px 40px 40px; display:grid; grid-template-columns:1fr 1fr; gap:24px; }
        .data-card { background:white; border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid var(--c-border); overflow:hidden; }
        .data-card-header { padding:16px 20px; border-bottom:1px solid #eee; display:flex; align-items:center; gap:10px; }
        .data-card-header i { font-size:1.1rem; }
        .data-card-header.teachers i { color:var(--c-info); }
        .data-card-header.students i { color:var(--c-purple); }
        .data-card-header h3 { font-size:0.95rem; font-weight:600; color:var(--c-nav); }
        .data-card-header .data-badge { margin-left:auto; font-size:0.7rem; padding:3px 10px; border-radius:20px; font-weight:600; background:#f0f0f0; color:#888; }
        .data-card-header .data-badge.has-data { background:#e8f8f0; color:var(--c-success); }
        .data-card-body { padding:20px; }

        .excel-drop { border:2px dashed #ccc; border-radius:8px; padding:24px; text-align:center; transition:0.2s; cursor:pointer; position:relative; background:#fafbfc; }
        .excel-drop:hover { border-color:var(--c-info); background:#f0f7ff; }
        .excel-drop.loaded { border-color:var(--c-success); background:#f0fff4; }
        .excel-drop input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; }
        .excel-drop i.drop-icon { font-size:2rem; color:#ccc; margin-bottom:8px; display:block; }
        .excel-drop.loaded i.drop-icon { color:var(--c-success); }
        .excel-drop .drop-label { font-size:0.82rem; color:#888; }
        .excel-drop.loaded .drop-label { color:var(--c-success); font-weight:600; }
        .excel-drop .drop-hint { font-size:0.68rem; color:#bbb; margin-top:4px; }

        .data-actions { display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
        .data-btn { padding:7px 14px; border:none; border-radius:7px; font-size:0.75rem; font-weight:600; cursor:pointer; font-family:var(--font); transition:0.2s; display:flex; align-items:center; gap:6px; }
        .data-btn-view { background:#eaf4fe; color:var(--c-info); }
        .data-btn-view:hover { background:#d0e8fc; }
        .data-btn-clear { background:#fff0f0; color:var(--c-accent); }
        .data-btn-clear:hover { background:#fde0e0; }
        .data-btn-tpl { background:#f0f7ff; color:var(--c-purple); }
        .data-btn-tpl:hover { background:#e4edfe; }

        .data-preview { margin-top:14px; max-height:260px; overflow-y:auto; border:1px solid #eee; border-radius:8px; }
        .data-preview table { width:100%; border-collapse:collapse; font-size:0.72rem; }
        .data-preview th { background:#f4f5f7; padding:7px 10px; text-align:left; font-weight:600; color:#555; position:sticky; top:0; border-bottom:1px solid #ddd; }
        .data-preview td { padding:6px 10px; border-bottom:1px solid #f0f0f0; color:#444; }
        .data-preview tr:hover td { background:#f8f9ff; }
        .data-count { font-size:0.72rem; color:#888; margin-top:8px; display:flex; align-items:center; gap:6px; }
        .data-count strong { color:var(--c-nav); }
        .data-count i { color:var(--c-success); }

        /* ═══ CONTENT ═══ */
        .content-area { flex:1; position:relative; overflow:hidden; }
        .welcome { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(160deg,#f0f1f4,#e4e7ee,#dfe2ea); z-index:10; transition:opacity 0.4s,transform 0.4s; padding:40px; }
        .welcome.hidden { opacity:0; transform:scale(0.98); pointer-events:none; }
        .welcome-header { text-align:center; margin-bottom:40px; }
        .welcome-logo { width:auto; height:auto; min-height:56px; background:var(--c-accent); border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:24px; color:white; font-weight:700; margin:0 auto 16px; box-shadow:0 8px 32px var(--c-accent-glow); overflow:hidden; }
        .welcome-logo img { height:4cm; width:auto; object-fit:contain; }
        .welcome-title { font-family:var(--font-display); font-size:2rem; font-weight:700; color:var(--c-nav); margin-bottom:6px; }
        .welcome-subtitle { color:#6b7280; font-size:0.95rem; }
        .module-grid { display:flex; flex-wrap:wrap; gap:16px; width:100%; justify-content:center; align-content:flex-start; max-width: calc(var(--home-cols, 3) * 170px + (var(--home-cols, 3) - 1) * 16px); margin: 0 auto; }
        @media (max-width: 720px){ .module-grid{ grid-template-columns: repeat(2, 170px); max-width: calc(2 * 170px + 16px); } }
        .module-card { 
  background:var(--c-card); border-radius:var(--radius); padding:24px 20px; cursor:pointer; 
  transition: transform 320ms cubic-bezier(.2,.8,.2,1), box-shadow 320ms cubic-bezier(.2,.8,.2,1), border-color 320ms, background 320ms;
  box-shadow:var(--shadow); border:1px solid var(--c-border); text-align:center; position:relative; overflow:hidden; width:170px; 
  will-change: transform;
}
.module-card:focus-visible{ outline:none; box-shadow:0 0 0 3px var(--c-accent-glow), var(--shadow); }
.module-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; border-radius:var(--radius) var(--radius) 0 0; transition:height 320ms cubic-bezier(.2,.8,.2,1); }
.module-card::after { content:''; position:absolute; inset:-1px; border-radius:var(--radius); pointer-events:none; opacity:0; transition:opacity 320ms; box-shadow: 0 0 0 0 rgba(0,0,0,0); }
.module-card:hover { transform:translateY(-6px); box-shadow:0 14px 44px rgba(0,0,0,0.14); background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(240,241,244,0.35) 100%); }
.module-card:hover::before { height:6px; }
.module-card:hover .module-icon { transform: translateY(-2px) scale(1.05); filter: saturate(1.05); }
.module-card:active { transform:translateY(-2px) scale(0.99); box-shadow:0 10px 34px rgba(0,0,0,0.12); }
.module-card.active { border-color: rgba(212,72,59,0.45); box-shadow:0 18px 54px rgba(0,0,0,0.16); transform:translateY(-4px); }
.module-card.active::before { height:8px; }
.module-card.active::after { opacity:1; box-shadow: 0 0 0 3px var(--c-accent-glow); }
        .module-card.card-hidden { display:none !important; }
        .module-card[data-m="perdir"]::before { background:var(--c-info); }
        .module-card[data-m="exam"]::before { background:var(--c-accent); }
        .module-card[data-m="oral"]::before { background:var(--c-warning); }
        .module-card[data-m="aed"]::before { background:var(--c-success); }
        .module-card[data-m="bibase"]::before { background:#e67e22; }
            .module-card[data-m="data"]::before { background:var(--c-purple); }
        .module-icon { width:44px; height:44px; border-radius:11px; display:flex; align-items:center; justify-content:center; font-size:1.1rem; color:white; margin:0 auto 12px;  transition: transform 320ms cubic-bezier(.2,.8,.2,1), filter 320ms; }
        .module-card[data-m="perdir"] .module-icon { background:var(--c-info); }
        .module-card[data-m="exam"] .module-icon { background:var(--c-accent); }
        .module-card[data-m="oral"] .module-icon { background:var(--c-warning); }
        .module-card[data-m="aed"] .module-icon { background:var(--c-success); }
        .module-card[data-m="bibase"] .module-icon { background:#e67e22; }
            .module-card[data-m="data"] .module-icon { background:var(--c-purple); }
        .module-card h3 { font-size:0.9rem; font-weight:600; color:var(--c-nav); margin-bottom:4px; }
        .module-card p { font-size:0.7rem; color:#9ca3af; line-height:1.3; }

        .module-frame { position:absolute; inset:0; border:none; width:100%; height:100%; display:none; background:white; }
        .module-frame.active { display:block; }
        .loader-overlay { position:absolute; inset:0; background:rgba(240,241,244,0.92); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:20; opacity:0; pointer-events:none; transition:opacity 0.3s; }
        .loader-overlay.show { opacity:1; pointer-events:auto; }
        .loader-spinner { width:32px; height:32px; border:3px solid var(--c-border); border-top-color:var(--c-accent); border-radius:50%; animation:spin 0.8s linear infinite; margin-bottom:10px; }
        .loader-text { font-size:0.8rem; color:#6b7280; }
        @keyframes spin { to{transform:rotate(360deg)} }

        .bottom-bar { height:26px; background:var(--c-nav); display:flex; align-items:center; justify-content:space-between; padding:0 16px; font-size:0.6rem; color:var(--c-text-dim); flex-shrink:0; }
        .status-dot { display:inline-block; width:5px; height:5px; border-radius:50%; background:var(--c-success); margin-right:5px; animation:pulse-dot 2s ease infinite; }
        @keyframes pulse-dot { 0%,100%{opacity:1} 50%{opacity:0.4} }

        @media (max-width:900px) { .module-grid{grid-template-columns:repeat(2,1fr);max-width:460px} .nav-item .nav-label{display:none} .nav-item{padding:7px 10px} .brand-text span{display:none} .nav-clock{display:none} .settings-grid{grid-template-columns:1fr} .data-body{grid-template-columns:1fr;padding:20px} }
        @media (max-width:500px) { .module-grid{grid-template-columns:1fr;max-width:300px} }
    
        /* ═══ HOME: EVENTS DU JOUR ═══ */
        .home-events{max-width:1000px;margin:18px auto 0;background:rgba(255,255,255,.92);border:1px solid rgba(0,0,0,.08);border-radius:16px;box-shadow:0 10px 34px rgba(0,0,0,.08);backdrop-filter:blur(6px);padding:14px 16px;}
        .home-events-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;}
        .home-events-title{font-weight:800;color:#1f2937;display:flex;align-items:center;gap:10px;}
        .home-events-title i{color:var(--c-accent);}
        .home-events-actions{display:flex;gap:8px;align-items:center;}
        .home-events-btn{border:none;background:#eef2f7;color:#344054;font-weight:800;font-size:.78rem;border-radius:12px;padding:8px 10px;cursor:pointer;transition:transform .18s, box-shadow .18s, background .18s;}
        .home-events-btn:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(0,0,0,.10);background:#e9f2ff;}
        .home-events-body{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
        @media (max-width: 980px){.home-events-body{grid-template-columns:1fr;}}
        .home-ev{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:10px 12px;display:flex;gap:12px;align-items:flex-start;transition:transform .18s, box-shadow .18s, border-color .18s;}
        .home-ev:hover{transform:translateY(-1px);box-shadow:0 12px 30px rgba(0,0,0,.10);border-color:rgba(212,72,59,.22);}
        .home-ev-dot{width:10px;height:10px;border-radius:999px;margin-top:4px;flex-shrink:0;box-shadow:0 0 0 3px rgba(0,0,0,.05);}
        .home-ev-when{min-width:86px;font-variant-numeric:tabular-nums;}
        .home-ev-time{font-weight:900;color:#334155;font-size:.8rem;}
        .home-ev-date{color:#64748b;font-size:.72rem;font-weight:800;margin-top:2px;}
        .home-ev-title{font-weight:900;color:#111827;font-size:.84rem;line-height:1.15;}
        .home-ev-cal{color:#94a3b8;font-size:.72rem;font-weight:800;margin-top:2px;}
        .home-ev-empty{grid-column:1/-1;background:#fff;border:1px dashed rgba(0,0,0,.15);border-radius:14px;padding:14px;color:#64748b;font-weight:900;}


/* --- PATCH UI: align accordion sections (incl. Bulletin) --- */
#settingsModal .acc-section{ margin: 10px 14px; }
#settingsModal .acc-section:last-child{ margin-bottom: 14px; }
#settingsModal .acc-header{ width:100%; }
#settingsModal .acc-body{ width:100%; }

/* --- Home calendar blocks --- */
.home-calwrap{ margin-top:16px; background:#fff; border:1px solid #e5e7eb; border-radius:18px; overflow:hidden; box-shadow:0 10px 30px rgba(2,8,23,.06);}
.home-calhead{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; background:linear-gradient(180deg,#ffffff,#f8fafc); border-bottom:1px solid #eef2f7;}
.home-calhead .ttl{ font-weight:800; color:#0f172a; display:flex; align-items:center; gap:10px;}
.home-calgrid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; padding:14px 16px;}
@media(max-width:900px){ .home-calgrid{ grid-template-columns:1fr; } }
.home-calcard{ border:1px solid #eef2f7; border-radius:16px; padding:12px 12px; background:#fff; position:relative; overflow:hidden;}
.home-calcard:before{ content:''; position:absolute; inset:0; background:radial-gradient(600px 200px at 0% 0%, rgba(56,189,248,.10), transparent 60%); opacity:0; transition:opacity .25s ease; }
.home-calcard:hover:before{ opacity:1; }
.home-calcard h4{ margin:0 0 8px; font-size:.92rem; font-weight:800; display:flex; align-items:center; gap:8px; color:#0f172a;}
.home-calcard h4 .dot{ width:10px; height:10px; border-radius:99px; display:inline-block; }
.home-calev{ display:flex; gap:10px; padding:8px 8px; border-radius:12px; transition:transform .18s ease, background .18s ease; }
.home-calev:hover{ transform:translateY(-1px); background:#f8fafc; }
.home-calev + .home-calev{ border-top:1px dashed #eef2f7; }
.home-calev .when{ width:92px; flex:0 0 92px; font-weight:800; color:#0f172a; font-size:.78rem; }
.home-calev .meta{ min-width:0; }
.home-calev .meta .t{ font-weight:700; color:#0f172a; font-size:.84rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.home-calev .meta .s{ font-size:.72rem; color:#64748b; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.home-calempty{ padding:14px 16px; color:#64748b; font-weight:600; }
</style>
    <script src="CADIR_fichiers/client" async="" defer="defer"></script>
<style id="googleidentityservice_button_styles">.qJTHM{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;color:#202124;direction:ltr;-webkit-touch-callout:none;font-family:"Roboto-Regular",arial,sans-serif;-webkit-font-smoothing:antialiased;font-weight:400;margin:0;overflow:hidden;-webkit-text-size-adjust:100%}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{overflow-wrap:break-word;word-break:break-word}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-u2z5K{height:36px;width:36px}.Bz112c-uaxL4e{border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf{border:none;margin:0;padding:0}.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u{transition:height linear .2s}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important;transition:width linear .3s}.P1ekSe-ZMv3u>div:nth-child(2){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;-moz-box-sizing:border-box;box-sizing:border-box;transition:background-color .218s,border-color .218s;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-appearance:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}@media screen and (preferes-contrast:more){.nsm7Bb-HzV7m-LgbsSe{color:#000}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{color:#fff}}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-moz-box;display:flex;-moz-box-pack:center;justify-content:center;-moz-box-align:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-moz-box;display:flex;-moz-box-align:center;align-items:center;-moz-box-orient:horizontal;-moz-box-direction:normal;flex-direction:row;-moz-box-pack:justify;justify-content:space-between;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{-moz-box-pack:center;justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{-moz-box-flex:1;flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{-moz-box-flex:0;flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:rgb(210,227,252);outline:none}.nsm7Bb-HzV7m-LgbsSe:focus-within{outline:2px solid #00639b;border-color:transparent}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.08)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-moz-box;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-moz-box;display:flex;-moz-box-align:center;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff,.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#000;fill:#000}}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style></head>
<body>

    <nav class="topnav">
        <a class="brand" onclick="goHome()" title="Accueil">
            <div class="brand-icon" id="brandIcon"><span id="brandLetter">P</span><img id="brandLogo" style="display:none"></div>
            <div class="brand-text">CADIR<span>Suite Direction</span></div>
        </a>
        <div class="nav-sep"></div>
        <div class="nav-items" id="navItems"><div class="nav-item active" data-module="perdir" onclick="loadModule('perdir')" title="Ctrl+P"><i class="fas fa-building-columns"></i><span class="nav-label">CADIR</span><span class="nav-badge">Direction</span><kbd class="nav-shortcut">Ctrl+P</kbd></div><div class="nav-item" data-module="exam" onclick="loadModule('exam')" title="Ctrl+E"><i class="fas fa-file-pen"></i><span class="nav-label">Écrit</span><span class="nav-badge">Épreuves</span><kbd class="nav-shortcut">Ctrl+E</kbd></div><div class="nav-item" data-module="oral" onclick="loadModule('oral')" title="Ctrl+O"><i class="fas fa-comments"></i><span class="nav-label">Oral</span><span class="nav-badge">Oraux</span><kbd class="nav-shortcut">Ctrl+O</kbd></div><div class="nav-item" data-module="aed" onclick="loadModule('aed')" title="Ctrl+A"><i class="fas fa-user-shield"></i><span class="nav-label">AED</span><span class="nav-badge">Vie Scolaire</span><kbd class="nav-shortcut">Ctrl+A</kbd></div><div class="nav-item" data-module="bibase" onclick="loadModule('bibase')" title="Ctrl+B"><i class="fas fa-newspaper"></i><span class="nav-label">BULLETIN</span><span class="nav-badge">Information</span><kbd class="nav-shortcut">Ctrl+B</kbd></div><div class="nav-item" data-module="dhg" onclick="loadModule('dhg')" title="Ctrl+H"><i class="fas fa-table-cells"></i><span class="nav-label">DHG</span><span class="nav-badge">Services</span><kbd class="nav-shortcut">Ctrl+H</kbd></div><div class="nav-item" data-module="data" onclick="openDataPanel()" title="Ctrl+D"><i class="fas fa-database"></i><span class="nav-label">Données</span><span class="nav-badge">Import</span><kbd class="nav-shortcut">Ctrl+D</kbd></div></div>
        <div class="nav-right">
            <div class="nav-clock" id="clock">mer. 18 févr., 21:26</div>
            <button class="nav-btn" onclick="openSettings()" title="Paramètres (Alt+P)"><svg id="settings-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg></button>
            <button class="nav-btn" onclick="toggleFullscreen()" title="Plein écran"><svg id="fs-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg></button>
        </div>
    </nav>

    <!-- ═══ SETTINGS ═══ -->
    <div class="settings-overlay" id="settingsOverlay" onclick="if(event.target===this)closeSettings()">
        <div class="settings-panel">
            <div class="settings-header">
                <h2><i class="fas fa-cog"></i> Paramètres généraux</h2>
                <button class="settings-close" onclick="closeSettings()">×</button>
            </div>
            <div class="settings-body">

                <div class="acc-section open">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-id-card"></i> Identité &amp; Établissement</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body">
                    <div class="settings-grid">
                        <div class="form-group"><label>Nom de l'établissement</label><input type="text" id="s-school" placeholder="Lycée Jean-Antoine"></div>
                        <div class="form-group"><label>Nom &amp; Prénom</label><input type="text" id="s-name" placeholder="M. Dupont"></div>
                        <div class="form-group"><label>Fonction</label><input type="text" id="s-role" placeholder="Proviseur adjoint"></div>
                        <div class="form-group"><label>Ville</label><input type="text" id="s-city" placeholder="Rennes"></div>
                        <div class="form-group"><label>Zone de vacances</label><select id="s-zone" style="padding:8px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;width:100%;"><option value="A">Zone A</option><option value="B" selected="selected">Zone B</option><option value="C">Zone C</option></select></div>
                        <div class="form-group" style="display:flex;align-items:flex-end;">
                            <button onclick="triggerVacancesUpdate()" style="padding:9px 16px;border:none;border-radius:8px;background:#e67e22;color:#fff;font-weight:600;font-size:.78rem;cursor:pointer;white-space:nowrap;display:flex;align-items:center;gap:6px;height:40px;">
                                <i class="fas fa-calendar-day"></i> MAJ Vacances scolaires
                            </button>
                        </div>
                    </div>
                </div></div>
                <div class="acc-section">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-image"></i> Logo &amp; Signature</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body">
                    <div class="settings-grid">
                        <div class="form-group">
                            <label>Logo de l'établissement</label>
                            <input type="file" accept="image/*" onchange="handleSettingsImage(this,'logo')">
                            <div class="img-preview" id="prev-logo">
                                <span class="placeholder" id="ph-logo">Aucun logo</span>
                                <img id="img-logo" style="display:none">
                                <button class="btn-clear" onclick="clearImage('logo')" title="Supprimer">×</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Signature scannée</label>
                            <input type="file" accept="image/*" onchange="handleSettingsImage(this,'sign')">
                            <div class="img-preview" id="prev-sign">
                                <span class="placeholder" id="ph-sign">Aucune signature</span>
                                <img id="img-sign" style="display:none">
                                <button class="btn-clear" onclick="clearImage('sign')" title="Supprimer">×</button>
                            </div>
                        </div>
                    </div>
                </div></div>
                <div class="acc-section">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-sliders"></i> Modules &amp; Organisation</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body">
                        <small style="color:#888;display:block;margin-bottom:12px;">Glissez pour réordonner. Décochez pour masquer. Ajoutez des séparateurs pour organiser la barre de navigation.</small>
                        <ul class="order-list" id="orderList"></ul>
                        <div class="order-hint"><i class="fas fa-hand-pointer"></i> Glissez-déposez pour réorganiser l'ordre</div>
                        <button class="add-sep-btn" onclick="addSeparatorToOrderList()"><i class="fas fa-grip-lines"></i> Ajouter un séparateur</button>
                    </div>
                </div>
                <div class="acc-section">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-bars"></i> Sous-menus CADIR</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body"><div class="acc-body-inner">
                        <small style="color:#888;display:block;margin-bottom:10px;">Affichez/masquez et réorganisez les sous-menus du module CADIR par glisser-déposer.</small>
                        <div id="perdir-submenu-list" style="margin-bottom:8px;"></div>
                        <button class="add-sep-btn" onclick="addSubMenuSeparator()"><i class="fas fa-grip-lines"></i> Ajouter un séparateur</button>
                        <div class="order-hint" style="font-size:.68rem;color:#aaa;margin-top:6px;"><i class="fas fa-hand-pointer"></i> Glissez pour réordonner. Décochez pour masquer.</div>
                    </div></div>
                </div>
                <div class="acc-section">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-file-pdf"></i> En-têtes des documents PDF</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body">
                        <small style="color:#888;display:block;margin-bottom:12px;">Personnalisez l'en-tête des PDF générés dans CADIR (entretiens, réunions, conseil de direction…).</small>
                        <div class="settings-grid">
                            <div class="form-group">
                                <label>Style de l'en-tête</label>
                                <select id="s-pdf-layout" style="padding:9px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;font-family:var(--font);width:100%;">
                                    <option value="classique" selected="selected">Classique — logo + nom + séparateur</option>
                                    <option value="bandeau">Bandeau coloré pleine largeur</option>
                                    <option value="moderne">Moderne — centré avec accent coloré</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Couleur principale</label>
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <input type="color" id="s-pdf-color" value="#1b2433" style="width:42px;height:36px;border:1px solid #ddd;border-radius:6px;cursor:pointer;padding:2px;" oninput="var h=document.getElementById('s-pdf-color-hex');if(h)h.value=this.value;" onchange="var h=document.getElementById('s-pdf-color-hex');if(h)h.value=this.value;">
                                    <input type="text" id="s-pdf-color-hex" value="#1b2433" placeholder="#1b2433" style="flex:1;padding:8px;border:1px solid #ddd;border-radius:8px;font-size:.82rem;" oninput="document.getElementById('s-pdf-color').value=this.value">
                                </div>
                            </div>
                            <div class="form-group" style="grid-column:1/-1;">
                                <label>Sous-titre (département, service…)</label>
                                <input type="text" id="s-pdf-subtitle" placeholder="Direction" style="padding:9px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;font-family:var(--font);">
                                <small style="color:#aaa;font-size:.65rem;margin-top:3px;">Affiché sous le nom d'établissement dans l'en-tête. Laissez vide pour "Direction".</small>
                            </div>
                        </div>
                        <div id="pdf-header-preview" style="margin-top:14px;border:1px solid #e0e0e0;border-radius:8px;overflow:hidden;font-family:'Times New Roman',serif;font-size:.8rem;">
                            <div style="background:#f5f5f5;padding:6px 12px;font-size:.7rem;color:#888;font-family:var(--font);border-bottom:1px solid #eee;">Aperçu</div>
                            <div style="padding:12px 16px;" id="pdf-header-preview-inner"><div style="display:flex;justify-content:space-between;align-items:flex-start;border-bottom:1.5px solid #000;padding-bottom:8px;"><div><div style="font-weight:bold;text-transform:uppercase;font-size:.9rem;">Nom de l'établissement</div><div style="font-size:.7rem;color:#555;margin-top:1px;">Direction</div></div><div></div></div></div>
                        </div>
                        <button onclick="updatePdfHeaderPreview()" style="margin-top:8px;padding:6px 14px;border:none;border-radius:7px;background:#eaf4fe;color:var(--c-info);font-weight:600;font-size:.75rem;cursor:pointer;font-family:var(--font);"><i class="fas fa-sync"></i> Aperçu</button>
                    </div>
                </div>
                <div class="acc-section">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-calendar-alt"></i> Agendas externes</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body">
                    <div class="settings-grid">
                        <div class="form-group" style="grid-column:1/-1;">
                            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                                <input type="checkbox" id="s-gcal" onchange="toggleGcal()" style="width:18px;height:18px;cursor:pointer;accent-color:#4285f4;">
                                <span style="font-weight:600;">Utiliser Google Agenda dans CADIR</span>
                            </label>
                            <small style="color:#888;font-size:.65rem;margin-top:2px;display:block;margin-left:26px;">Si décoché, l'agenda CADIR fonctionne en mode local (déconnecté).</small>
                        </div>
                        <div id="gcal-opts" style="display:none;grid-column:1/-1;">
                            <div style="background:#f8f9fa;border:1px solid #e0e0e0;border-radius:10px;padding:14px;margin-bottom:12px;">
                                <div style="font-weight:600;font-size:.8rem;margin-bottom:8px;color:#333;"><i class="fab fa-google" style="color:#4285f4;margin-right:4px;"></i> Connexion OAuth2</div>
                                <div class="form-group" style="margin-bottom:8px">
                                    <label style="font-size:.75rem;">Client ID OAuth2</label>
                                    <input type="text" id="s-gcal-clientid" placeholder="xxxxx.apps.googleusercontent.com" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.8rem;">
                                    <small style="color:#888;font-size:.62rem;">Console Google Cloud → API &amp; Services → Identifiants → ID client OAuth 2.0 (<a href="https://console.cloud.google.com/apis/credentials" target="_blank">ouvrir</a>)</small>
                                </div>
                                <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                                    <button onclick="gcalAuth()" id="btn-gcal-auth" style="padding:7px 16px;border:none;border-radius:8px;background:#4285f4;color:#fff;font-weight:600;font-size:.78rem;cursor:pointer;display:flex;align-items:center;gap:6px;">
                                        <i class="fas fa-sign-in-alt"></i> Se connecter à Google
                                    </button>
                                    <span id="gcal-auth-status" style="font-size:.72rem;color:#999;"></span>
                                </div>
                            </div>

                            <div id="gcal-list-wrap" style="display:none;">
                                <div style="font-weight:600;font-size:.78rem;margin-bottom:6px;color:#333;"><i class="fas fa-list"></i> Vos agendas Google</div>
                                <div id="gcal-list" style="margin-bottom:8px;max-height:200px;overflow-y:auto;"></div>
                                <button onclick="gcalFetchEvents()" style="padding:7px 14px;border:none;border-radius:8px;background:#34a853;color:#fff;font-weight:600;font-size:.78rem;cursor:pointer;"><i class="fas fa-sync"></i> Synchroniser les événements</button>
                                <div id="gcal-events-status" style="margin-top:6px;font-size:.72rem;color:#888;"></div>
                            </div>

                            <div style="margin-top:12px;border-top:1px solid #eee;padding-top:10px;">
                                <details>
                                    <summary style="cursor:pointer;font-size:.72rem;color:#888;font-weight:600;"><i class="fas fa-keyboard"></i> Ajouter un agenda manuellement</summary>
                                    <div style="margin-top:8px;">
                                        <small style="color:#888;font-size:.62rem;display:block;margin-bottom:6px;">Pour les agendas publics : copiez l'ID depuis Google Agenda → Paramètres de l'agenda.</small>
                                        <div class="form-group" style="margin-bottom:6px">
                                            <label style="font-size:.72rem;">Clé API (pour agendas publics)</label>
                                            <input type="text" id="s-gcal-key" placeholder="AIzaSy..." style="padding:7px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;">
                                        </div>
                                        <div style="display:flex;gap:6px;align-items:flex-end;">
                                            <div class="form-group" style="flex:2;">
                                                <label style="font-size:.72rem;">ID du calendrier</label>
                                                <input type="text" id="gcal-manual-id" placeholder="email@gmail.com" style="padding:7px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;">
                                            </div>
                                            <div class="form-group" style="flex:1;">
                                                <label style="font-size:.72rem;">Nom</label>
                                                <input type="text" id="gcal-manual-name" placeholder="Mon agenda" style="padding:7px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;">
                                            </div>
                                            <button onclick="addManualCal()" style="padding:7px 12px;border:none;border-radius:8px;background:var(--c-info);color:#fff;font-weight:700;cursor:pointer;font-size:.85rem;height:36px;">+</button>
                                        </div>
                                        <div id="gcal-manual-list" style="margin-top:6px;"></div>
                                    </div>
                                </details>
                            </div>
                        </div>

                            <div style="margin-top:20px;border-top:2px solid #e0e0e0;padding-top:16px;">
                                <div style="font-weight:700;font-size:.88rem;margin-bottom:10px;color:#0078d4;display:flex;align-items:center;gap:8px;"><i class="fab fa-microsoft"></i> Outlook / Office 365</div>
                                <small style="color:#666;display:block;margin-bottom:10px;line-height:1.4;font-size:.7rem;">Connectez un calendrier Outlook / Microsoft 365 via Microsoft Graph API.</small>
                                <div class="form-group" style="margin-bottom:8px;"><label style="font-size:.72rem;">Application (client) ID</label><input type="text" id="s-outlook-clientid" placeholder="Azure AD App ID" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                <button onclick="outlookAuth()" id="btn-outlook-auth" style="padding:9px 18px;border:none;border-radius:8px;background:#0078d4;color:#fff;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:.8rem;"><i class="fab fa-microsoft"></i> Connecter Outlook</button>
                                <span id="outlook-auth-status" style="font-size:.72rem;color:#888;margin-left:8px;"></span>
                                <div id="outlook-cal-list-wrap" style="display:none;margin-top:12px;">
                                    <label style="font-size:.72rem;font-weight:600;">Agendas Outlook :</label>
                                    <div id="outlook-cal-list" style="margin-top:6px;"></div>
                                    <button onclick="outlookFetchEvents()" style="margin-top:8px;padding:8px 16px;border:none;border-radius:8px;background:#0078d4;color:#fff;font-weight:600;cursor:pointer;font-size:.78rem;"><i class="fas fa-sync"></i> Synchroniser</button>
                                    <span id="outlook-events-status" style="font-size:.72rem;margin-left:8px;"></span>
                                </div>
                            </div>
                    </div>
                </div></div>
                <div class="acc-section">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-hard-drive"></i> Sauvegarde &amp; Synchronisation</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body">
                    <div style="margin-bottom:18px;padding:16px;background:#f0f7ff;border:1px solid #c8ddf5;border-radius:10px;">
                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
                            <i class="fas fa-cloud" style="color:#3498db;font-size:1.1rem;"></i>
                            <strong style="font-size:.85rem;color:#2c3e50;">Synchronisation en ligne</strong>
                            <label class="toggle-switch" style="margin-left:auto;"><input type="checkbox" id="s-cloud-enabled" onchange="toggleCloudUI()"><span class="toggle-slider"></span></label>
                        </div>
                        <div id="cloud-opts" style="display:none;">
                            <div style="margin-bottom:12px;">
                                <label style="font-size:.78rem;font-weight:600;color:#333;display:block;margin-bottom:6px;">Fournisseur de stockage</label>
                                <div style="display:flex;gap:8px;flex-wrap:wrap;" id="cloud-provider-btns">
                                    <button class="cloud-prov-btn active" data-prov="jsonbin" onclick="selectCloudProvider('jsonbin')"><i class="fas fa-database" style="color:#3498db"></i> jsonbin.io<br><small>Gratuit • Simple</small></button>
                                    <button class="cloud-prov-btn" data-prov="gist" onclick="selectCloudProvider('gist')"><i class="fab fa-github" style="color:#333"></i> GitHub Gist<br><small>Gratuit • Illimité</small></button>
                                    <button class="cloud-prov-btn" data-prov="webdav" onclick="selectCloudProvider('webdav')"><i class="fas fa-server" style="color:#e67e22"></i> WebDAV / FTP<br><small>Serveur perso</small></button>
                                    <button class="cloud-prov-btn" data-prov="gdrive" onclick="selectCloudProvider('gdrive')"><i class="fab fa-google-drive" style="color:#0f9d58"></i> Google Drive<br><small>OAuth2</small></button>
                                    <button class="cloud-prov-btn" data-prov="localfolder" onclick="selectCloudProvider('localfolder')"><i class="fas fa-folder-open" style="color:#0078d4"></i> Dossier Local<br><small>OneDrive / GDrive / Dropbox</small></button>
                                </div>
                            </div>
                            <div id="cloud-cfg-jsonbin">
                                <small style="color:#666;display:block;margin-bottom:8px;line-height:1.4;"><a href="https://jsonbin.io/" target="_blank" style="color:#3498db;">jsonbin.io</a> — Créez un compte gratuit, copiez votre <b>X-Master-Key</b> depuis le dashboard.</small>
                                <div class="settings-grid">
                                    <div class="form-group"><label style="font-size:.72rem;">Clé API (X-Master-Key)</label><input type="password" id="s-cloud-key" placeholder="$2a$10$xxxxxxx..." style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                    <div class="form-group"><label style="font-size:.72rem;">ID du Bin <small style="color:#aaa;">(auto-créé)</small></label><input type="text" id="s-cloud-bin" placeholder="Automatique au 1er envoi" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                </div>
                            </div>
                            <div id="cloud-cfg-gist" style="display:none;">
                                <small style="color:#666;display:block;margin-bottom:8px;line-height:1.4;"><a href="https://github.com/settings/tokens" target="_blank" style="color:#333;">GitHub</a> — Créez un <b>Personal Access Token</b> (scope <code>gist</code>). Stockage illimité et privé.</small>
                                <div class="settings-grid">
                                    <div class="form-group"><label style="font-size:.72rem;">Personal Access Token</label><input type="password" id="s-gist-token" placeholder="ghp_xxxxxxxxxxxx" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                    <div class="form-group"><label style="font-size:.72rem;">Gist ID <small style="color:#aaa;">(auto-créé)</small></label><input type="text" id="s-gist-id" placeholder="Automatique au 1er envoi" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                </div>
                            </div>
                            <div id="cloud-cfg-gdrive" style="display:none;">
                                <small style="color:#666;display:block;margin-bottom:8px;line-height:1.4;">Utilisez <b>Google Drive</b> pour stocker vos données. Nécessite le même Client ID OAuth2 que Google Agenda (ajouter le scope <code>drive.file</code>).</small>
                                <div class="settings-grid">
                                    <div class="form-group"><label style="font-size:.72rem;">Client ID OAuth2</label><input type="text" id="s-gdrive-clientid" placeholder="Même que Google Agenda" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                    <div class="form-group"><label style="font-size:.72rem;">File ID <small style="color:#aaa;">(auto-créé)</small></label><input type="text" id="s-gdrive-fileid" placeholder="Automatique au 1er envoi" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                </div>
                                <button class="backup-btn" onclick="gdriveAuth()" style="margin-top:8px;background:#0f9d58;color:#fff;border-color:#0f9d58;"><i class="fab fa-google"></i> Connecter Google Drive</button>
                                <span id="gdrive-auth-status" style="font-size:.72rem;color:#888;margin-left:8px;"></span>
                            </div>
                            <div id="cloud-cfg-localfolder" style="display:none;">
                                <div id="lf-mode-auto" style="display:none;">
                                    <small style="color:#666;display:block;margin-bottom:10px;line-height:1.4;"><b>Mode automatique</b> — Toutes vos données sont synchronisées en temps réel dans le dossier local choisi (OneDrive, Google Drive, Dropbox…).</small>
                                    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:8px;">
                                        <button class="backup-btn" onclick="lfPickFolder()" style="background:#0078d4;color:#fff;border-color:#0078d4;" id="lf-pick-btn"><i class="fas fa-folder-open"></i> Choisir le dossier</button>
                                        <span id="lf-auto-status" style="font-size:.72rem;color:#888;"></span>
                                    </div>
                                    <div id="lf-auto-actions" style="display:none;margin-top:6px;">
                                        <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                            <button class="backup-btn" onclick="lfForceSave()" style="background:#27ae60;color:#fff;border-color:#27ae60;font-size:.72rem;padding:6px 12px;"><i class="fas fa-save"></i> Forcer la sauvegarde</button>
                                            <button class="backup-btn" onclick="lfForceLoad()" style="background:#3498db;color:#fff;border-color:#3498db;font-size:.72rem;padding:6px 12px;"><i class="fas fa-sync"></i> Recharger depuis le fichier</button>
                                        </div>
                                    </div>
                                    <small style="color:#aaa;display:block;margin-top:8px;"><i class="fas fa-info-circle"></i> Le fichier <code>pilote_data.json</code> est automatiquement mis à jour dans le dossier sélectionné à chaque modification.</small>
                                </div>
                                <div id="lf-mode-manual">
                                    <small style="color:#666;display:block;margin-bottom:10px;line-height:1.4;">Sauvegardez vos données dans un fichier <code>pilote_data.json</code> que vous placez dans votre <b>dossier synchronisé</b> (OneDrive, Google Drive, Dropbox…).</small>
                                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px;">
                                        <button class="backup-btn" onclick="localFolderExport()" style="background:#0078d4;color:#fff;border-color:#0078d4;"><i class="fas fa-download"></i> Exporter</button>
                                        <label class="backup-btn" style="background:#27ae60;color:#fff;border-color:#27ae60;cursor:pointer;margin:0;"><i class="fas fa-upload"></i> Importer
                                            <input type="file" id="localfolder-import" accept=".json" style="display:none;" onchange="localFolderImport(this)">
                                        </label>
                                    </div>
                                    <span id="localfolder-status" style="font-size:.72rem;color:#888;display:block;margin-top:4px;"></span>
                                    <div style="background:#fffbea;border:1px solid #f0d060;border-radius:8px;padding:10px 12px;margin-top:10px;">
                                        <small style="color:#8a6d00;line-height:1.5;display:block;"><i class="fas fa-lightbulb" style="color:#f0a030;"></i> <b>Astuce — Synchronisation automatique :</b><br>
                                        Lancez un mini-serveur local pour activer l'écriture directe dans votre dossier :<br>
                                        <code style="background:#fff;padding:3px 8px;border-radius:4px;display:inline-block;margin:4px 0;user-select:all;cursor:pointer;" onclick="navigator.clipboard.writeText(this.textContent)" title="Cliquer pour copier">python3 -m http.server 8080</code><br>
                                        puis ouvrez <code style="user-select:all;cursor:pointer;" onclick="navigator.clipboard.writeText('http://localhost:8080/PILOTE_Suite.html')">http://localhost:8080/PILOTE_Suite.html</code></small>
                                    </div>
                                </div>
                            </div>
                            <div id="cloud-cfg-webdav" style="display:none;">
                                <small style="color:#666;display:block;margin-bottom:8px;line-height:1.4;">Connectez un serveur <b>WebDAV</b>
 (Nextcloud, OwnCloud, Synology, NAS…). Le protocole FTP natif n'est pas
 supporté par les navigateurs — utilisez un proxy WebDAV.</small>
                                <div class="settings-grid">
                                    <div class="form-group" style="grid-column:1/-1;"><label style="font-size:.72rem;">URL du serveur WebDAV</label><input type="text" id="s-webdav-url" placeholder="https://cloud.monserveur.fr/remote.php/dav/files/user/" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                    <div class="form-group"><label style="font-size:.72rem;">Identifiant</label><input type="text" id="s-webdav-user" placeholder="utilisateur" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                    <div class="form-group"><label style="font-size:.72rem;">Mot de passe</label><input type="password" id="s-webdav-pass" placeholder="••••••••" style="padding:8px;border:1px solid #ddd;border-radius:8px;width:100%;font-size:.78rem;"></div>
                                </div>
                            </div>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;">
                                <button class="backup-btn" onclick="cloudPush()" style="background:#27ae60;color:#fff;border-color:#27ae60;"><i class="fas fa-cloud-arrow-up"></i> Envoyer</button>
                                <button class="backup-btn" onclick="cloudPull()" style="background:#3498db;color:#fff;border-color:#3498db;"><i class="fas fa-cloud-arrow-down"></i> Récupérer</button>
                            </div>
                            <div id="cloud-status" style="margin-top:8px;font-size:.72rem;color:#888;"></div>
                            <label style="display:flex;align-items:center;gap:6px;margin-top:10px;cursor:pointer;font-size:.75rem;color:#555;">
                                <input type="checkbox" id="s-cloud-auto" style="accent-color:#27ae60;"> Sync automatique à chaque sauvegarde
                            </label>
                        </div>
                    </div>
                    <div class="settings-backup">
                        <button class="backup-btn" onclick="exportSettings()"><i class="fas fa-download"></i> Exporter les paramètres</button>
                        <label class="backup-btn import-btn"><i class="fas fa-upload"></i> Importer des paramètres<input type="file" accept=".json" onchange="importSettings(this)"></label>
                    </div>
                    <div class="order-hint" style="margin-top:8px"><i class="fas fa-info-circle"></i>
 Exportez vos paramètres pour les conserver entre les versions. Le 
fichier JSON contient identité, images, ordre et visibilité des modules.</div>
                </div></div>
            </div>
            <div class="acc-section">
                    <div class="acc-header" onclick="toggleAcc(this)"><h3><i class="fas fa-newspaper" style="color:#e67e22"></i> Bulletin d'information</h3><i class="fas fa-chevron-right acc-chevron"></i></div>
                    <div class="acc-body">
                    <small style="color:#888;display:block;margin-bottom:12px">Paramètres du module Bulletin d'information.</small>
                    <div class="settings-grid">
                        <div class="form-group">
                            <label>Mise en page du PDF</label>
                            <select id="bib-layout" style="padding:8px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;width:100%;">
                                <option value="classic" selected="selected">Classique</option>
                                <option value="modern">Centré</option>
                                <option value="banner">Bandeau</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Police d'écriture</label>
                            <select id="bib-font" style="padding:8px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;width:100%;">
                                <option value="inter" selected="selected">Inter (Moderne, Sans Serif)</option>
                                <option value="serif">Merriweather (Classique, Serif)</option>
                                <option value="mono">Roboto Mono (Monospace)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Signataire par défaut</label>
                            <select id="bib-signatory" style="padding:8px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;width:100%;">
                                <option value="L'équipe de direction" selected="selected">L'équipe de direction</option>
                                <option value="Le Chef d'établissement">Le Chef d'établissement</option>
                                <option value="Le Directeur adjoint">Le Directeur adjoint</option>
                                <option value="Le Proviseur">Le Proviseur</option>
                                <option value="Le Principal">Le Principal</option>
                                <option value="Tous">Tous</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Titre du document</label>
                            <input type="text" id="bib-doc-title" value="Bulletin d'information" style="padding:8px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;width:100%;">
                        </div>
                    </div>
                    <div style="margin-top:10px">
                        <div class="form-group">
                            <label>Note de pied de page (PDF)</label>
                            <input type="text" id="bib-doc-footer" placeholder="Ex: Document Interne - Ne pas diffuser" style="padding:8px 12px;border:1px solid #ddd;border-radius:8px;font-size:.85rem;width:100%;">
                        </div>
                    </div>
                </div></div>
            <div class="settings-footer">
                <button class="btn-settings btn-cancel" onclick="closeSettings()">Annuler</button>
                <button class="btn-settings btn-save" onclick="saveSettings()"><i class="fas fa-check"></i> Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- ═══ CONTENT ═══ -->
    <div class="content-area" id="contentArea">
        <div class="welcome hidden" id="welcome">
            <div class="welcome-header">
                <div class="welcome-logo" id="welcomeLogo"><span id="welcomeLetter">P</span><img id="welcomeLogoImg" style="display:none"></div>
                <h1 class="welcome-title">Bienvenue sur CADIR</h1>
                <p class="welcome-subtitle" id="welcomeSubtitle">Suite d'outils pour la direction d'établissement</p>
            </div>
            <div class="module-grid" id="moduleGrid"><div class="module-card" data-m="perdir" onclick="loadModule('perdir')"><div class="module-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><rect x="3" y="10" width="18" height="11" rx="1"></rect><path d="M3 10l9-7 9 7"></path><line x1="12" y1="3" x2="12" y2="10"></line><rect x="7" y="14" width="3" height="7"></rect><rect x="14" y="14" width="3" height="7"></rect></svg></div><h3>CADIR</h3><p>Direction &amp; pilotage</p></div><div class="module-card" data-m="exam" onclick="loadModule('exam')"><div class="module-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><path d="M10 9H8"></path></svg></div><h3>Écrit</h3><p>Organisation d'épreuves écrites</p></div><div class="module-card" data-m="oral" onclick="loadModule('oral')"><div class="module-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></div><h3>Oral</h3><p>Organisation d'épreuves orales</p></div><div class="module-card" data-m="aed" onclick="loadModule('aed')"><div class="module-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle><path d="M18 8s2 2 0 5"></path></svg></div><h3>AED</h3><p>Assistants d'éducation</p></div><div class="module-card" data-m="bibase" onclick="loadModule('bibase')"><div class="module-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a4 4 0 0 1-4-4V6"></path><line x1="16" y1="6" x2="10" y2="6"></line><line x1="16" y1="10" x2="10" y2="10"></line><line x1="16" y1="14" x2="10" y2="14"></line></svg></div><h3>BULLETIN</h3><p>Bulletin d'information</p></div><div class="module-card" data-m="dhg" onclick="loadModule('dhg')"><div class="module-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><rect x="3" y="3" width="18" height="18" rx="2"></rect><path d="M3 9h18"></path><path d="M3 15h18"></path><path d="M9 3v18"></path><path d="M15 3v18"></path></svg></div><h3>DHG</h3><p>Gestion des services</p></div><div class="module-card" data-m="data" onclick="openDataPanel()"><div class="module-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg></div><h3>DONNÉES</h3><p>Import élèves &amp; enseignants</p></div></div>

            <div class="home-events" id="homeEvents">
                <div class="home-events-head">
                    <div class="home-events-title"><i class="fas fa-calendar-day"></i> Événements du jour</div>
                    <div class="home-events-actions">
                        <button class="home-events-btn" onclick="trySyncCalendars()" title="Synchroniser agendas"><i class="fas fa-sync"></i> Sync</button>
                    </div>
                </div>
                <div class="home-events-body" id="homeEventsBody"></div>
            </div>


            <div class="home-calwrap" id="homeUpcomingWrap">
                <div class="home-calhead">
                    <div class="ttl"><i class="fas fa-calendar-week"></i> Prochaines 2 semaines (par agenda)</div>
                    <div class="home-events-actions">
                        <button class="home-events-btn" onclick="renderHomeUpcoming2Weeks()" title="Rafraîchir l'affichage"><i class="fas fa-rotate"></i> Rafraîchir</button>
                    </div>
                </div>
                <div class="home-calgrid" id="homeUpcomingGrid"></div>
                <div class="home-calempty" id="homeUpcomingEmpty" style="display:none;"></div>
            </div>


        </div>

        <!-- DATA PANEL -->
        <div class="data-panel" id="dataPanel">
            <div class="data-header">
                <h1><i class="fas fa-database"></i> Données</h1>
                <p>Importez vos listes d'enseignants et d'élèves. Les données seront partagées avec tous les modules.</p>
            </div>
            <div class="data-body">
                <div class="data-card">
                    <div class="data-card-header teachers">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <h3>Enseignants</h3>
                        <span class="data-badge has-data" id="badge-teachers">Non chargé</span>
                    </div>
                    <div class="data-card-body">
                        <div class="data-actions" style="margin-bottom:12px">
                            <button class="data-btn data-btn-tpl" onclick="downloadTemplate('teachers')"><i class="fas fa-file-download"></i> Télécharger le modèle vierge</button>
                        </div>
                        <div class="excel-drop loaded" id="drop-teachers">
                            <input type="file" accept=".xlsx,.xls,.csv" multiple="" onchange="handleExcelImport(this,'teachers')">
                            <i class="fas fa-file-excel drop-icon"></i>
                            <div class="drop-label" id="lbl-teachers">Cliquez ou glissez un ou plusieurs fichiers Excel</div>
                            <div class="drop-hint">.xlsx, .xls ou .csv — plusieurs fichiers possibles</div>
                        </div>
                        <div class="data-actions" id="actions-teachers" style="display:none">
                            <button class="data-btn data-btn-view" onclick="togglePreview('teachers')"><i class="fas fa-table"></i> Voir / Masquer</button>
                            <button class="data-btn data-btn-clear" onclick="clearExcelData('teachers')"><i class="fas fa-trash"></i> Supprimer</button>
                        </div>
                        <div class="data-count" id="count-teachers"></div>
                        <div class="data-preview" id="preview-teachers" style="display:none"></div>
                    </div>
                </div>
                <div class="data-card">
                    <div class="data-card-header students">
                        <i class="fas fa-user-graduate"></i>
                        <h3>Élèves</h3>
                        <span class="data-badge has-data" id="badge-students">Non chargé</span>
                    </div>
                    <div class="data-card-body">
                        <div class="data-actions" style="margin-bottom:12px">
                            <button class="data-btn data-btn-tpl" onclick="downloadTemplate('students')"><i class="fas fa-file-download"></i> Télécharger le modèle vierge</button>
                        </div>
                        <div class="excel-drop loaded" id="drop-students">
                            <input type="file" accept=".xlsx,.xls,.csv" multiple="" onchange="handleExcelImport(this,'students')">
                            <i class="fas fa-file-excel drop-icon"></i>
                            <div class="drop-label" id="lbl-students">Cliquez ou glissez un ou plusieurs fichiers Excel</div>
                            <div class="drop-hint">.xlsx, .xls ou .csv — plusieurs fichiers possibles</div>
                        </div>
                        <div class="data-actions" id="actions-students" style="display:none">
                            <button class="data-btn data-btn-view" onclick="togglePreview('students')"><i class="fas fa-table"></i> Voir / Masquer</button>
                            <button class="data-btn data-btn-clear" onclick="clearExcelData('students')"><i class="fas fa-trash"></i> Supprimer</button>
                        </div>
                        <div class="data-count" id="count-students"></div>
                        <div class="data-preview" id="preview-students" style="display:none"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loader-overlay" id="loader"><div class="loader-spinner"></div><div class="loader-text">Chargement du module…</div></div>
        <iframe class="module-frame active" id="frame-perdir" sandbox="allow-scripts allow-same-origin allow-popups allow-modals allow-downloads allow-forms" src="blob:null/51323e71-e24a-4649-809a-7b80b991e53a"></iframe>
        <iframe class="module-frame" id="frame-exam" sandbox="allow-scripts allow-same-origin allow-popups allow-modals allow-downloads allow-forms"></iframe>
        <iframe class="module-frame" id="frame-oral" sandbox="allow-scripts allow-same-origin allow-popups allow-modals allow-downloads allow-forms"></iframe>
        <iframe class="module-frame" id="frame-aed" sandbox="allow-scripts allow-same-origin allow-popups allow-modals allow-downloads allow-forms"></iframe>
        <iframe class="module-frame" id="frame-dhg" sandbox="allow-scripts allow-same-origin allow-popups allow-modals allow-downloads allow-forms"></iframe>
        <iframe class="module-frame" id="frame-bibase" sandbox="allow-scripts allow-same-origin allow-popups allow-modals allow-downloads allow-forms"></iframe>
    </div>

    <div class="bottom-bar">
        <div><span class="status-dot"></span>Tous les modules opérationnels</div>
        <div id="lf-sync-indicator" style="display:none;font-size:.7rem;color:#888;cursor:pointer;" onclick="lfForceSave()" title="Cliquer pour forcer la sauvegarde"><i class="fas fa-circle" style="color:#27ae60;font-size:.5rem;vertical-align:middle;margin-right:4px;"></i><span id="lf-sync-text">Synchronisé</span></div>
        <div id="bottomBarInfo">CADIR Suite — Direction</div>
    </div>

    <script>
    const MODULE_DATA = {"perdir": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImZyIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+Q0FESVI8L3RpdGxlPgogICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvZm9udC1hd2Vzb21lLzYuNC4wL2Nzcy9hbGwubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2NoYXJ0LmpzIj48L3NjcmlwdD4KICAgIDxzdHlsZT4KICAgICAgICA6cm9vdCB7CiAgICAgICAgICAgIC0tcHJpbWFyeTogIzJjM2U1MDsKICAgICAgICAgICAgLS1zZWNvbmRhcnk6ICMzNDQ5NWU7CiAgICAgICAgICAgIC0tYWNjZW50OiAjYzAzOTJiOwogICAgICAgICAgICAtLWhlYWRlcjogIzJjM2U1MDsKICAgICAgICAgICAgLS1tZW51LXRleHQ6ICMxYWJjOWM7CiAgICAgICAgICAgIC0taGlnaGxpZ2h0OiAjZTc0YzNjOwogICAgICAgICAgICAtLXdhcm5pbmc6ICNmMzljMTI7CiAgICAgICAgICAgIC0tc3VjY2VzczogIzI3YWU2MDsKICAgICAgICAgICAgLS1pbmZvOiAjMjk4MGI5OwogICAgICAgICAgICAtLWxpZ2h0OiAjZWNmMGYxOwogICAgICAgICAgICAtLWZvbnQtbWFpbjogJ0FwdG9zJywgJ0NhbGlicmknLCAnVHJlYnVjaGV0IE1TJywgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgfQoKICAgICAgICAqIHsgYm94LXNpemluZzogYm9yZGVyLWJveDsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyB9CiAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LW1haW4pOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZWVmMmY1OyBjb2xvcjogIzMzMzsgZGlzcGxheTogZmxleDsgaGVpZ2h0OiAxMDB2aDsgb3ZlcmZsb3c6IGhpZGRlbjsgfQoKICAgICAgICAvKiBTSURFQkFSICovCiAgICAgICAgLnNpZGViYXIgeyB3aWR0aDogMjgwcHg7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLXByaW1hcnkpOyBjb2xvcjogd2hpdGU7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGZsZXgtc2hyaW5rOiAwOyB9CiAgICAgICAgLmJyYW5kIHsgcGFkZGluZzogMjVweCAyMHB4OyBmb250LXNpemU6IDEuMnJlbTsgZm9udC13ZWlnaHQ6IGJvbGQ7IHRleHQtYWxpZ246IGNlbnRlcjsgYmFja2dyb3VuZDogIzFhMjUyZjsgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkIHZhcigtLW1lbnUtdGV4dCk7IH0KICAgICAgICAuYnJhbmQgc3BhbiB7IGNvbG9yOiB2YXIoLS1tZW51LXRleHQpOyBkaXNwbGF5OiBibG9jazsgZm9udC1zaXplOiAwLjhyZW07IG1hcmdpbi10b3A6IDVweDsgZm9udC13ZWlnaHQ6IG5vcm1hbDsgfQogICAgICAgIC5tZW51IHsgZmxleDogMTsgcGFkZGluZy10b3A6IDEwcHg7IG92ZXJmbG93LXk6IGF1dG87IH0KICAgICAgICAubWVudS1pdGVtIHsgcGFkZGluZzogMTVweCAyMHB4OyBjdXJzb3I6IHBvaW50ZXI7IHRyYW5zaXRpb246IDAuM3M7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGNvbG9yOiAjYmRjM2M3OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgdHJhbnNwYXJlbnQ7IGZvbnQtc2l6ZTogMC45cmVtOyB9CiAgICAgICAgLm1lbnUtaXRlbTpob3ZlciwgLm1lbnUtaXRlbS5hY3RpdmUgeyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpOyBjb2xvcjogd2hpdGU7IGJvcmRlci1sZWZ0LWNvbG9yOiB2YXIoLS1tZW51LXRleHQpOyB9CiAgICAgICAgLm1lbnUtaXRlbSBpIHsgd2lkdGg6IDMwcHg7IGZvbnQtc2l6ZTogMS4xcmVtOyBtYXJnaW4tcmlnaHQ6IDEwcHg7IH0KICAgICAgICAubWVudS1udW0geyBkaXNwbGF5Om5vbmU7IH0KICAgICAgICAubWVudS1zZXBhcmF0b3J7aGVpZ2h0OjFweDtiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsLjE1KTttYXJnaW46OHB4IDEycHh9CiAgICAgICAgLmZvb3Rlci1pbmZvIHsgcGFkZGluZzogMTVweDsgZm9udC1zaXplOiAwLjdyZW07IHRleHQtYWxpZ246IGNlbnRlcjsgYm9yZGVyLXRvcDogMXB4IHNvbGlkICMzNDQ5NWU7IGNvbG9yOiAjN2Y4YzhkOyB9CgogICAgICAgIC8qIE1BSU4gKi8KICAgICAgICAubWFpbi1jb250ZW50IHsgZmxleDogMTsgb3ZlcmZsb3cteTogYXV0bzsgcGFkZGluZzogMzBweDsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgfQogICAgICAgIC50b3AtYmFyIHsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyBtYXJnaW4tYm90dG9tOiAzMHB4OyBiYWNrZ3JvdW5kOiB3aGl0ZTsgcGFkZGluZzogMTVweCAyNXB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGJveC1zaGFkb3c6IDAgMnB4IDEwcHggcmdiYSgwLDAsMCwwLjA1KTsgfQogICAgICAgIC5wYWdlLXRpdGxlIGgyIHsgY29sb3I6IHZhcigtLXNlY29uZGFyeSk7IG1hcmdpbjogMDsgfQogICAgICAgIC5zeXN0ZW0tc3RhdHVzIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiAyMHB4OyB9CiAgICAgICAgLnNhdmUtaW5kaWNhdG9yIHsgZm9udC1zaXplOiAwLjhyZW07IGNvbG9yOiB2YXIoLS1zdWNjZXNzKTsgZGlzcGxheTogbm9uZTsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA1cHg7IGZvbnQtd2VpZ2h0OiBib2xkOyB9CgogICAgICAgIC8qIFVJIEVMRU1FTlRTICovCiAgICAgICAgLmJ0biB7IHBhZGRpbmc6IDEwcHggMjBweDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA1cHg7IGN1cnNvcjogcG9pbnRlcjsgZm9udC13ZWlnaHQ6IDYwMDsgdHJhbnNpdGlvbjogMC4yczsgZGlzcGxheTogaW5saW5lLWZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogOHB4OyBmb250LXNpemU6IDAuOXJlbTsgfQogICAgICAgIC5idG46aG92ZXIgeyBvcGFjaXR5OiAwLjk7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsgfQogICAgICAgIC5idG4tcHJpbWFyeSB7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLXNlY29uZGFyeSk7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5idG4tYWNjZW50IHsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYWNjZW50KTsgY29sb3I6IHdoaXRlOyB9CiAgICAgICAgLmJ0bi1zdWNjZXNzIHsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc3VjY2Vzcyk7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5idG4taW5mbyB7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLWluZm8pOyBjb2xvcjogd2hpdGU7IH0KICAgICAgICAuYnRuLWRhbmdlciB7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLWhpZ2hsaWdodCk7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5idG4td2FybmluZyB7IGJhY2tncm91bmQtY29sb3I6IHZhcigtLXdhcm5pbmcpOyBjb2xvcjogd2hpdGU7IH0KICAgICAgICAuYnRuLWRhcmsgeyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1wcmltYXJ5KTsgY29sb3I6IHdoaXRlOyB9CiAgICAgICAgLmJ0bi13b3JkIHsgYmFja2dyb3VuZC1jb2xvcjogIzJiNTc5YTsgY29sb3I6IHdoaXRlOyB9IC8qIENvdWxldXIgV29yZCAqLwogICAgICAgIC5idG4tc20geyBwYWRkaW5nOiA1cHggMTBweDsgZm9udC1zaXplOiAwLjhyZW07IH0KICAgICAgICAuYnRuLWljb24geyBwYWRkaW5nOiA4cHg7IHdpZHRoOiAzNXB4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgfQoKICAgICAgICAuYnRuLXVwZGF0ZS1tb2RlIHsgYmFja2dyb3VuZC1jb2xvcjogI2YzOWMxMiAhaW1wb3J0YW50OyBjb2xvcjogd2hpdGUgIWltcG9ydGFudDsgYW5pbWF0aW9uOiBwdWxzZSAycyBpbmZpbml0ZTsgfQogICAgICAgIEBrZXlmcmFtZXMgcHVsc2UgeyAwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDAgcmdiYSgyNDMsIDE1NiwgMTgsIDAuNCk7IH0gNzAlIHsgYm94LXNoYWRvdzogMCAwIDAgMTBweCByZ2JhKDI0MywgMTU2LCAxOCwgMCk7IH0gMTAwJSB7IGJveC1zaGFkb3c6IDAgMCAwIDAgcmdiYSgyNDMsIDE1NiwgMTgsIDApOyB9IH0KCiAgICAgICAgLnNlY3Rpb24geyBkaXNwbGF5OiBub25lOyBhbmltYXRpb246IGZhZGVJbiAwLjNzIGVhc2UtaW4tb3V0OyB9CiAgICAgICAgLnNlY3Rpb24uYWN0aXZlIHsgZGlzcGxheTogYmxvY2s7IH0KICAgICAgICAuZm9ybS1jYXJkIHsgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDMwcHg7IHBhZGRpbmctYm90dG9tOjEwcHg7CiAgICAgICAgLnNhdmUtYmFye3Bvc2l0aW9uOnN0aWNreTtib3R0b206MDtiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCh0cmFuc3BhcmVudCwjZmZmIDE1JSk7cGFkZGluZzoxNXB4IDAgNXB4O3otaW5kZXg6MTA7dGV4dC1hbGlnbjpyaWdodDttYXJnaW4tdG9wOjIwcHg7fQogICAgICAgIC5zYXZlLWJhciAuYnRue2JveC1zaGFkb3c6MCAycHggOHB4IHJnYmEoMCwwLDAsMC4xNSk7Zm9udC1zaXplOi45cmVtO3BhZGRpbmc6MTBweCAyNHB4O30KIGJvcmRlci1yYWRpdXM6IDhweDsgYm94LXNoYWRvdzogMCA0cHggMTVweCByZ2JhKDAsMCwwLDAuMDUpOyB9CiAgICAgICAgLmZvcm0tZ3JpZCB7IGRpc3BsYXk6IGdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmcjsgZ2FwOiAyMHB4OyBtYXJnaW4tYm90dG9tOiAyMHB4OyB9CiAgICAgICAgLmZvcm0tZnVsbCB7IG1hcmdpbi1ib3R0b206IDIwcHg7IH0KICAgICAgICAuZm9ybS1ncm91cCBsYWJlbCB7IGRpc3BsYXk6IGJsb2NrOyBtYXJnaW4tYm90dG9tOiA4cHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpOyBmb250LXNpemU6IDAuOXJlbTsgfQogICAgICAgIC5mb3JtLWNvbnRyb2wgeyB3aWR0aDogMTAwJTsgcGFkZGluZzogMTJweDsgYm9yZGVyOiAycHggc29saWQgI2MwYzVjZTsgYm9yZGVyLXJhZGl1czogNnB4OyBmb250LWZhbWlseTogaW5oZXJpdDsgZm9udC1zaXplOiAwLjk1cmVtOyB0cmFuc2l0aW9uOiAwLjJzOyB9CiAgICAgICAgICAgIC5mb3JtLWNvbnRyb2w6Zm9jdXMgeyBib3JkZXItY29sb3I6IHZhcigtLWFjY2VudCk7IG91dGxpbmU6bm9uZTsgYm94LXNoYWRvdzowIDAgMCAzcHggcmdiYSg1MiwxNTIsMjE5LDAuMTUpOyB9CiAgICAgICAgLm11bHRpLXJvdyB7IGRpc3BsYXk6IGZsZXg7IGdhcDogMTBweDsgbWFyZ2luLWJvdHRvbTogMTBweDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgfQogICAgICAgIC5tdWx0aS1yb3cgaW5wdXQgeyBmbGV4OiAxOyB9CiAgICAgICAgCiAgICAgICAgLyogQVRUQUNITUVOVFMgQVJFQSAqLwogICAgICAgIC5hdHRhY2htZW50cy1hcmVhIHsgYm9yZGVyOiAycHggZGFzaGVkICNiZGMzYzc7IGJhY2tncm91bmQ6ICNmOWY5Zjk7IHBhZGRpbmc6IDE1cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgbWFyZ2luLXRvcDogMTBweDsgfQogICAgICAgIC5hdHRhY2htZW50LWxpc3QgeyBtYXJnaW4tdG9wOiAxMHB4OyBsaXN0LXN0eWxlOiBub25lOyB9CiAgICAgICAgLmF0dGFjaG1lbnQtaXRlbSB7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDhweDsgbWFyZ2luLWJvdHRvbTogNXB4OyBib3JkZXItcmFkaXVzOiA0cHg7IGJvcmRlci1sZWZ0OiAzcHggc29saWQgdmFyKC0taW5mbyk7IGZvbnQtc2l6ZTogMC44NXJlbTsgYWxpZ24taXRlbXM6IGNlbnRlcjsgfQogICAgICAgIC5maWxlLXdhcm5pbmcgeyBmb250LXNpemU6IDAuNzVyZW07IGNvbG9yOiAjZTc0YzNjOyBtYXJnaW4tdG9wOiA1cHg7IGZvbnQtc3R5bGU6IGl0YWxpYzsgfQoKICAgICAgICAvKiBEUkFHICYgRFJPUCAvIEtBTkJBTiAqLwogICAgICAgIC50b2RvLWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IGdhcDogMjVweDsgfQogICAgICAgIC50b2RvLWJveCB7IGJhY2tncm91bmQ6IHdoaXRlOyBib3JkZXItcmFkaXVzOiA4cHg7IHBhZGRpbmc6IDIwcHg7IGJveC1zaGFkb3c6IDAgNHB4IDEwcHggcmdiYSgwLDAsMCwwLjA1KTsgYm9yZGVyLXRvcDogNXB4IHNvbGlkICNjY2M7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IG1pbi1oZWlnaHQ6IDM1MHB4OyB9CiAgICAgICAgLnRvZG8tdXJnZW50IHsgYm9yZGVyLXRvcC1jb2xvcjogdmFyKC0taGlnaGxpZ2h0KTsgfSAudG9kby1wbGFuIHsgYm9yZGVyLXRvcC1jb2xvcjogdmFyKC0tcHJpbWFyeSk7IH0gLnRvZG8tcG9zc2libGUgeyBib3JkZXItdG9wLWNvbG9yOiB2YXIoLS1zdWNjZXNzKTsgfSAudG9kby1kZWxlZ2F0ZSB7IGJvcmRlci10b3AtY29sb3I6IHZhcigtLXdhcm5pbmcpOyB9CiAgICAgICAgLnRvZG8taGVhZGVyIHsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyBtYXJnaW4tYm90dG9tOiAxNXB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTsgcGFkZGluZy1ib3R0b206IDEwcHg7IH0KICAgICAgICAudG9kby1pbnB1dC1ncm91cCB7IGRpc3BsYXk6IGZsZXg7IGdhcDogNXB4OyBtYXJnaW4tYm90dG9tOiAxNXB4OyB9CiAgICAgICAgLnRvZG8taW5wdXQtZ3JvdXAgaW5wdXQgeyBmbGV4OiAxOyBwYWRkaW5nOiA4cHg7IGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7IGJvcmRlci1yYWRpdXM6IDRweDsgfQogICAgICAgIC50b2RvLWxpc3QgeyBsaXN0LXN0eWxlOiBub25lOyBmbGV4OiAxOyBvdmVyZmxvdy15OiBhdXRvOyBtYXgtaGVpZ2h0OiAzNTBweDsgcGFkZGluZzogNXB4OyBtaW4taGVpZ2h0OiAxMDBweDsgdHJhbnNpdGlvbjogMC4yczsgfQogICAgICAgIC50b2RvLWxpc3QuZHJhZy1vdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2YwZjBmMDsgYm9yZGVyLXJhZGl1czogNHB4OyBvdXRsaW5lOiAycHggZGFzaGVkICNjY2M7IH0KICAgICAgICAvKiBTdHlsZSBhbcOpbGlvcsOpIHBvdXIgbGUgRHJhZyAmIERyb3AgKi8KICAgICAgICAudG9kby1pdGVtIHsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyBwYWRkaW5nOiAxMnB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2Y0ZjRmNDsgYmFja2dyb3VuZDogd2hpdGU7IG1hcmdpbi1ib3R0b206IDhweDsgYm9yZGVyLXJhZGl1czogNHB4OyBjdXJzb3I6IGdyYWI7IGJvcmRlci1sZWZ0OiAzcHggc29saWQgI2VlZTsgYm94LXNoYWRvdzogMCAxcHggM3B4IHJnYmEoMCwwLDAsMC4wNSk7IH0KICAgICAgICAudG9kby1pdGVtOmFjdGl2ZSB7IGN1cnNvcjogZ3JhYmJpbmc7IH0KICAgICAgICAudG9kby1pdGVtLmRyYWctb3Zlci1pdGVtIHsgYm9yZGVyLXRvcDogMnB4IHNvbGlkIHZhcigtLW1lbnUtdGV4dCk7IG1hcmdpbi10b3A6IDE1cHg7IH0gLyogSW5kaWNhdGV1ciB2aXN1ZWwgZCdpbnNlcnRpb24gKi8KICAgICAgICAudG9kby1pdGVtIHNwYW5bY29udGVudGVkaXRhYmxlXSB7IGZsZXg6MTsgbWFyZ2luLXJpZ2h0OjEwcHg7IHBhZGRpbmc6MnB4OyBib3JkZXI6MXB4IHNvbGlkIHRyYW5zcGFyZW50OyB0cmFuc2l0aW9uOjAuMnM7IH0KICAgICAgICAudG9kby1pdGVtIHNwYW5bY29udGVudGVkaXRhYmxlXTpmb2N1cyB7IGJvcmRlci1ib3R0b20tY29sb3I6IHZhcigtLWFjY2VudCk7IG91dGxpbmU6bm9uZTsgYmFja2dyb3VuZDojZjlmYmZmOyB9CiAgICAgICAgLmZyb20tYWdlbmRhIHsgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjhlMTsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjZjFjNDBmOyB9CiAgICAgICAgLnRvZG8tYWN0aW9ucyBpIHsgY3Vyc29yOiBwb2ludGVyOyBjb2xvcjogI2JkYzNjNzsgdHJhbnNpdGlvbjogMC4yczsgbWFyZ2luLWxlZnQ6IDhweDsgfQogICAgICAgIC50b2RvLWFjdGlvbnMgaTpob3ZlciB7IGNvbG9yOiB2YXIoLS1hY2NlbnQpOyB9CiAgICAgICAgCiAgICAgICAgLnRvZG8tdG9kYXktem9uZSB7IG1hcmdpbi1ib3R0b206IDIwcHg7IHBhZGRpbmc6IDE1cHg7IGJhY2tncm91bmQ6ICNmZmYzZTA7IGJvcmRlcjogMnB4IHNvbGlkICNmMzljMTI7IGJvcmRlci1yYWRpdXM6IDhweDsgZGlzcGxheTogbm9uZTsgfQogICAgICAgIC50b2RvLXRvZGF5LXpvbmUuYWN0aXZlIHsgZGlzcGxheTogYmxvY2s7IGFuaW1hdGlvbjogZmFkZUluIDAuNXM7IH0KICAgICAgICAudG9kby10b2RheS1pdGVtIHsgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDEwcHg7IGJvcmRlci1yYWRpdXM6IDRweDsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjZTc0YzNjOyBtYXJnaW4tYm90dG9tOiA1cHg7IGN1cnNvcjogZ3JhYjsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjA1KTsgfQoKICAgICAgICAvKiBDQUxFTkRBUiAqLwogICAgICAgIC5jYWxlbmRhci10YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyBiYWNrZ3JvdW5kOiB3aGl0ZTsgfQogICAgICAgIC5jYWxlbmRhci10YWJsZSB0aCB7IGJhY2tncm91bmQ6IHZhcigtLXNlY29uZGFyeSk7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweDsgdGV4dC1hbGlnbjogbGVmdDsgfQogICAgICAgIC5jYWxlbmRhci10YWJsZSB0ZCB7IHBhZGRpbmc6IDEycHg7IGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWVlOyB9CiAgICAgICAgLnJvdy10b2RheSB7IGJhY2tncm91bmQtY29sb3I6ICNmZmY4ZTE7IGZvbnQtd2VpZ2h0OiBib2xkOyBib3JkZXItbGVmdDogNXB4IHNvbGlkICNlNzRjM2M7IH0gCgogICAgICAgIC8qIEVESVRPUiAqLwogICAgICAgIC5kb2MtZWRpdG9yIHsgYm9yZGVyOiAxcHggc29saWQgI2RkZDsgcGFkZGluZzogNDBweDsgYmFja2dyb3VuZDogd2hpdGU7IG1pbi1oZWlnaHQ6IDIwMHB4OyBib3JkZXItcmFkaXVzOiA0cHg7IGZvbnQtZmFtaWx5OiAnQXB0b3MnLCAnQ2FsaWJyaScsICdUcmVidWNoZXQgTVMnLCBBcmlhbCwgc2Fucy1zZXJpZjsgbGluZS1oZWlnaHQ6IDEuNjsgY29sb3I6IzAwMDsgYm94LXNoYWRvdzogaW5zZXQgMCAwIDEwcHggcmdiYSgwLDAsMCwwLjA1KTsgcmVzaXplOiB2ZXJ0aWNhbDsgb3ZlcmZsb3c6IGF1dG87IH0KICAgICAgICAuZG9jLWVkaXRvcjpmb2N1cyB7IG91dGxpbmU6IG5vbmU7IGJvcmRlci1jb2xvcjogdmFyKC0tYWNjZW50KTsgfQogICAgICAgIC5ub3Rlcy1lZGl0b3IgeyBtaW4taGVpZ2h0OiAxNTBweDsgYmFja2dyb3VuZDogI2ZmZmZmMDsgYm9yZGVyLWNvbG9yOiAjZTBlMGQwOyB9CiAgICAgICAgCiAgICAgICAgLyogREFTSEJPQVJEICovCiAgICAgICAgLmRhc2gta3BpLWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgzLCAxZnIpOyBnYXA6IDIwcHg7IG1hcmdpbi1ib3R0b206IDMwcHg7IH0KICAgICAgICAua3BpLWNhcmQgeyBiYWNrZ3JvdW5kOiB3aGl0ZTsgcGFkZGluZzogMjBweDsgYm9yZGVyLXJhZGl1czogMTBweDsgYm94LXNoYWRvdzogMCA0cHggNnB4IHJnYmEoMCwwLDAsMC4wNSk7IHRleHQtYWxpZ246IGNlbnRlcjsgYm9yZGVyLWJvdHRvbTogNHB4IHNvbGlkIHZhcigtLXNlY29uZGFyeSk7IGRpc3BsYXk6ZmxleDsgZmxleC1kaXJlY3Rpb246Y29sdW1uOyBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOyBhbGlnbi1pdGVtczpjZW50ZXI7IG1pbi1oZWlnaHQ6IDE0MHB4OyB9CiAgICAgICAgLmtwaS1udW0geyBmb250LXNpemU6IDNyZW07IGZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogdmFyKC0tc2Vjb25kYXJ5KTsgZGlzcGxheTogYmxvY2s7IG1hcmdpbjogMTBweCAwOyB9CiAgICAgICAgLmtwaS1sYWJlbCB7IGZvbnQtc2l6ZTogMC45cmVtOyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBmb250LXdlaWdodDogYm9sZDsgY29sb3I6ICM3ZjhjOGQ7IH0KICAgICAgICAuY2hhcnRzLWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IGdhcDogMjBweDsgbWFyZ2luLWJvdHRvbTogMzBweDsgfQogICAgICAgIC5jaGFydC1jb250YWluZXIgeyBiYWNrZ3JvdW5kOiB3aGl0ZTsgcGFkZGluZzogMjBweDsgYm9yZGVyLXJhZGl1czogMTBweDsgYm94LXNoYWRvdzogMCA0cHggNnB4IHJnYmEoMCwwLDAsMC4wNSk7IGhlaWdodDogMzUwcHg7IH0KICAgICAgICAudG9wLXN0dWRlbnRzLWxpc3QgeyBsaXN0LXN0eWxlOiBub25lOyBwYWRkaW5nOiAwOyB9CiAgICAgICAgLnRvcC1zdHVkZW50LWl0ZW0geyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IHBhZGRpbmc6IDhweCAwOyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTsgfQoKICAgICAgICAvKiBUQUJMRVMgKi8KICAgICAgICAuZGF0YS10YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyBiYWNrZ3JvdW5kOiB3aGl0ZTsgfQogICAgICAgIC5kYXRhLXRhYmxlIHRoIHsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tc2Vjb25kYXJ5KTsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxNXB4OyB0ZXh0LWFsaWduOiBsZWZ0OyB9CiAgICAgICAgLmRhdGEtdGFibGUgdGQgeyBwYWRkaW5nOiAxNXB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTsgfQogICAgICAgIC5iYWRnZSB7IHBhZGRpbmc6IDRweCA4cHg7IGJvcmRlci1yYWRpdXM6IDEycHg7IGZvbnQtc2l6ZTogMC43NXJlbTsgZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5iZy1lbnQgeyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1hY2NlbnQpOyB9IC5iZy1yZXUgeyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdWNjZXNzKTsgfSAuYmctc3VpdmkgeyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1pbmZvKTsgfSAuYmctZGlyIHsgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tcHJpbWFyeSk7IH0KCiAgICAgICAgLyogRklMVEVSUyAqLwogICAgICAgIC5maWx0ZXJzLWJhciB7IGRpc3BsYXk6IGZsZXg7IGdhcDogMTVweDsgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDE1cHg7IGJvcmRlci1yYWRpdXM6IDhweDsgbWFyZ2luLWJvdHRvbTogMjBweDsgYWxpZ24taXRlbXM6IGZsZXgtZW5kOyB9CgogICAgICAgIAogICAgICAgIC8qIOKVkOKVkOKVkCBQcm9jw6lkdXJlcyDilZDilZDilZAgKi8KICAgICAgICAucHJvYy1oZWFkZXJ7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW4tYm90dG9tOjE2cHh9CiAgICAgICAgLnByb2MtaGVhZGVyIGJ1dHRvbntiYWNrZ3JvdW5kOnZhcigtLWhlYWRlciwjMmMzZTUwKTtjb2xvcjojZmZmO2JvcmRlcjpub25lO3BhZGRpbmc6MTBweCAyMHB4O2JvcmRlci1yYWRpdXM6OHB4O2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZTouODVyZW07Zm9udC13ZWlnaHQ6NjAwO2JveC1zaGFkb3c6MCAycHggOHB4IHJnYmEoNDQsNjIsODAsLjMpfQogICAgICAgIC5wcm9jLWhlYWRlciBidXR0b246aG92ZXJ7b3BhY2l0eTouOTt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtMXB4KX0KICAgICAgICAucHJvYy1saXN0e2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Z2FwOjhweH0KICAgICAgICAucHJvYy1jYXJke2JhY2tncm91bmQ6I2ZmZjtib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzoxMHB4IDE0cHg7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDtjdXJzb3I6cG9pbnRlcjtib3gtc2hhZG93OjAgMXB4IDRweCByZ2JhKDAsMCwwLC4wNik7dHJhbnNpdGlvbjpib3gtc2hhZG93IC4xNXN9CiAgICAgICAgLnByb2MtY2FyZDpob3Zlcntib3gtc2hhZG93OjAgM3B4IDEycHggcmdiYSgwLDAsMCwuMTIpfQogICAgICAgIC5wcm9jLWNvZGV7ZGlzcGxheTppbmxpbmUtYmxvY2s7cGFkZGluZzo0cHggMTBweDtib3JkZXItcmFkaXVzOjZweDtmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOi44cmVtO2NvbG9yOiNmZmY7bWluLXdpZHRoOjQ0cHg7dGV4dC1hbGlnbjpjZW50ZXJ9CiAgICAgICAgLnByb2MtY2FyZC1ib2R5e2ZsZXg6MTttaW4td2lkdGg6MH0KICAgICAgICAucHJvYy1jYXJkLXRpdGxle2ZvbnQtd2VpZ2h0OjYwMDtmb250LXNpemU6Ljg4cmVtO2NvbG9yOiMzMzN9CiAgICAgICAgLnByb2MtY2FyZC1tZXRhe2ZvbnQtc2l6ZTouNzJyZW07Y29sb3I6Izk5OTttYXJnaW4tdG9wOjJweH0KICAgICAgICAucHJvYy1jYXJkLWNhdHtkaXNwbGF5OmlubGluZS1ibG9jaztiYWNrZ3JvdW5kOiNmMGYwZjA7cGFkZGluZzoycHggOHB4O2JvcmRlci1yYWRpdXM6MTBweDtmb250LXNpemU6LjY4cmVtO2NvbG9yOiM2NjY7bWFyZ2luLWxlZnQ6NnB4fQogICAgICAgIC5wcm9jLWNhcmQtYWN0aW9uc3tkaXNwbGF5OmZsZXg7Z2FwOjZweH0KICAgICAgICAucHJvYy1jYXJkLWFjdGlvbnMgYnV0dG9ue2JhY2tncm91bmQ6bm9uZTtib3JkZXI6bm9uZTtjdXJzb3I6cG9pbnRlcjtwYWRkaW5nOjRweCA4cHg7Ym9yZGVyLXJhZGl1czo2cHg7Y29sb3I6Izg4ODtmb250LXNpemU6LjhyZW19CiAgICAgICAgLnByb2MtY2FyZC1hY3Rpb25zIGJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kOiNmMGYwZjA7Y29sb3I6IzMzM30KICAgICAgICAucHJvYy1maWx0ZXJze2Rpc3BsYXk6ZmxleDtmbGV4LXdyYXA6d3JhcDtnYXA6NnB4O21hcmdpbi1ib3R0b206MTRweH0KICAgICAgICAucHJvYy1maWx0ZXJzIGJ1dHRvbntib3JkZXI6MXB4IHNvbGlkICNkZGQ7YmFja2dyb3VuZDojZmZmO3BhZGRpbmc6NHB4IDEycHg7Ym9yZGVyLXJhZGl1czoxNnB4O2ZvbnQtc2l6ZTouNzJyZW07Y3Vyc29yOnBvaW50ZXI7Y29sb3I6IzY2Nn0KICAgICAgICAucHJvYy1maWx0ZXJzIGJ1dHRvbi5hY3RpdmV7YmFja2dyb3VuZDp2YXIoLS1oZWFkZXIsIzJjM2U1MCk7Y29sb3I6I2ZmZjtib3JkZXItY29sb3I6dHJhbnNwYXJlbnR9CiAgICAgICAgLnByb2Mtdmlld3tiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyLXJhZGl1czoxMnB4O292ZXJmbG93OmhpZGRlbjtib3gtc2hhZG93OjAgMnB4IDEwcHggcmdiYSgwLDAsMCwuMDgpO3dpZHRoOjEwMCU7Ym94LXNpemluZzpib3JkZXItYm94fQogICAgICAgIC5wcm9jLXZpZXctaGVhZGVye3BhZGRpbmc6MThweCAyMnB4O2NvbG9yOiNmZmZ9CiAgICAgICAgLnByb2Mtdmlldy1oZWFkZXIgaDJ7bWFyZ2luOjA7Zm9udC1zaXplOjEuMXJlbX0KICAgICAgICAucHJvYy12aWV3LWhlYWRlciAucHYtY29kZXtmb250LXNpemU6Ljg1cmVtO29wYWNpdHk6Ljg1O21hcmdpbi10b3A6MnB4fQogICAgICAgIC5wcm9jLXZpZXctYm9keXtwYWRkaW5nOjE2cHggMTJweH0KICAgICAgICAucHJvYy16b25le2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjZGRkO3BhZGRpbmc6MTBweCAxNHB4O21hcmdpbjoxMHB4IDA7YmFja2dyb3VuZDojZmFmYWZhO2JvcmRlci1yYWRpdXM6MCA4cHggOHB4IDA7d2lkdGg6MTAwJTtib3gtc2l6aW5nOmJvcmRlci1ib3h9CiAgICAgICAgLnByb2Mtem9uZSBoNHtmb250LXNpemU6Ljc4cmVtO2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojOTk5O21hcmdpbjowIDAgNnB4O3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTtsZXR0ZXItc3BhY2luZzouNXB4fQogICAgICAgIC5wcm9jLXpvbmUtY29udGVudHtmb250LXNpemU6Ljg1cmVtO2xpbmUtaGVpZ2h0OjEuNTtjb2xvcjojNDQ0fQogICAgICAgIC5wcm9jLXpvbmUtY29udGVudCBwe21hcmdpbjo0cHggMH0KICAgICAgICAucHJvYy1pY29uLW1haWwsLnByb2MtaWNvbi1hbGVydCwucHJvYy1pY29uLWlkZWF7ZGlzcGxheTppbmxpbmUtYmxvY2s7d2lkdGg6MjBweDtoZWlnaHQ6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoyMHB4O2JvcmRlci1yYWRpdXM6NTAlO2ZvbnQtc2l6ZTouNjVyZW07bWFyZ2luOjAgMnB4O3ZlcnRpY2FsLWFsaWduOm1pZGRsZX0KICAgICAgICAucHJvYy1pY29uLW1haWx7YmFja2dyb3VuZDojMzQ5OGRiO2NvbG9yOiNmZmZ9CiAgICAgICAgLnByb2MtaWNvbi1hbGVydHtiYWNrZ3JvdW5kOiNlNzRjM2M7Y29sb3I6I2ZmZn0KICAgICAgICAucHJvYy1pY29uLWlkZWF7YmFja2dyb3VuZDojZjM5YzEyO2NvbG9yOiNmZmZ9CgogICAgICAgIC8qIFBSSU5UIENPTkZJRyAqLwogICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgIC5zaWRlYmFyLCAubm8tcHJpbnQsIC50b3AtYmFyLCAuc2VjdGlvbiB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfQogICAgICAgICAgICBib2R5IHsgYmFja2dyb3VuZDogd2hpdGU7IGhlaWdodDogYXV0bzsgb3ZlcmZsb3c6IHZpc2libGU7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgZm9udC1mYW1pbHk6ICdUaW1lcyBOZXcgUm9tYW4nLCBzZXJpZjsgY29sb3I6ICMwMDA7IC13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdDsgfQogICAgICAgICAgICAubWFpbi1jb250ZW50IHsgcGFkZGluZzogMDsgbWFyZ2luOiAwOyB3aWR0aDogMTAwJTsgZGlzcGxheTogYmxvY2s7IH0KICAgICAgICAgICAgLnByaW50LWFyZWEgeyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OyB3aWR0aDogMTAwJTsgcG9zaXRpb246IHN0YXRpYzsgb3ZlcmZsb3c6IHZpc2libGUgIWltcG9ydGFudDsgfQogICAgICAgICAgICBAcGFnZSB7IHNpemU6IEE0OyBtYXJnaW46IDVtbSA1bW0gMTJtbSA1bW07IH0KICAgICAgICAgICAgLnByaW50LXBhZ2UgeyB3aWR0aDogMTAwJTsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyBwYWdlLWJyZWFrLWFmdGVyOiBhbHdheXM7IG92ZXJmbG93OiBoaWRkZW47IH0KICAgICAgICAgICAgLnByaW50LXBhZ2U6bGFzdC1jaGlsZCB7IHBhZ2UtYnJlYWstYWZ0ZXI6IGF2b2lkOyB9CiAgICAgICAgICAgIC5vZmZpY2lhbC1oZWFkZXIgeyBkaXNwbGF5OiBmbGV4ICFpbXBvcnRhbnQ7IGZsZXgtZGlyZWN0aW9uOiByb3cgIWltcG9ydGFudDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuICFpbXBvcnRhbnQ7IGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OyBtYXJnaW4tYm90dG9tOiAyMHB4OyBib3JkZXItYm90dG9tOiAxLjVweCBzb2xpZCAjMDAwOyBwYWRkaW5nLWJvdHRvbTogMTVweDsgfQogICAgICAgICAgICAub2ZmaWNpYWwtcmlnaHQgeyB0ZXh0LWFsaWduOiByaWdodCAhaW1wb3J0YW50OyBmbGV4LXNocmluazogMDsgfQogICAgICAgICAgICAuc2Nob29sLW5hbWUgeyBmb250LXdlaWdodDogYm9sZDsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgZm9udC1zaXplOiAxLjJyZW07IH0KICAgICAgICAgICAgLm9mZmljaWFsLWxvZ28geyBtYXgtaGVpZ2h0OiA5MHB4OyBtYXgtd2lkdGg6IDE4MHB4OyBvYmplY3QtZml0OiBjb250YWluOyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OyAtd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDogZXhhY3QgIWltcG9ydGFudDsgcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdCAhaW1wb3J0YW50OyB9CiAgICAgICAgICAgIC5vZmZpY2lhbC1wYXJ0aWNpcGFudHMgeyBiYWNrZ3JvdW5kOiAjZjRmNGY0ICFpbXBvcnRhbnQ7IHBhZGRpbmc6IDEycHg7IGJvcmRlcjogMXB4IHNvbGlkICNjY2M7IG1hcmdpbi1ib3R0b206IDIwcHg7IGZvbnQtc2l6ZTogMXJlbTsgfQogICAgICAgICAgICAub2ZmaWNpYWwtY29udGVudCB7IHRleHQtYWxpZ246IGp1c3RpZnk7IGxpbmUtaGVpZ2h0OiAxLjY7IGZvbnQtc2l6ZTogMS4xcmVtOyB9CiAgICAgICAgICAgIC5vZmZpY2lhbC1jb250ZW50IGltZywgLnByaW50LXBhZ2UgaW1nIHsgZGlzcGxheTogaW5saW5lLWJsb2NrICFpbXBvcnRhbnQ7IHZpc2liaWxpdHk6IHZpc2libGUgIWltcG9ydGFudDsgbWF4LWhlaWdodDogODBweDsgbWF4LXdpZHRoOiAxNjBweDsgLXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6IGV4YWN0ICFpbXBvcnRhbnQ7IHByaW50LWNvbG9yLWFkanVzdDogZXhhY3QgIWltcG9ydGFudDsgfQogICAgICAgICAgICAub2ZmaWNpYWwtZm9vdGVyIHsgbWFyZ2luLXRvcDogNDBweDsgdGV4dC1hbGlnbjogcmlnaHQ7IGZvbnQtc2l6ZTogMS4xcmVtOyB9CiAgICAgICAgICAgIC5zaWduYXR1cmUtaW1nIHsgbWF4LWhlaWdodDogNzBweDsgZGlzcGxheTogYmxvY2s7IG1hcmdpbi1sZWZ0OiBhdXRvOyB9CiAgICAgICAgICAgIC5hdHRhY2htZW50LXByaW50LWxpc3QgeyBtYXJnaW4tdG9wOiAyMHB4OyBib3JkZXItdG9wOiAxcHggZG90dGVkICNjY2M7IHBhZGRpbmctdG9wOiAxMHB4OyBmb250LXNpemU6IDAuOXJlbTsgfQogICAgICAgIH0KICAgICAgICAucHJpbnQtYXJlYSB7IGRpc3BsYXk6IG5vbmU7IH0KICAgICAgICBAa2V5ZnJhbWVzIGZhZGVJbiB7IGZyb20geyBvcGFjaXR5OiAwOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTBweCk7IH0gdG8geyBvcGFjaXR5OiAxOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0gfQogICAgCiAgICAgICAgCiAgICAgICAgLyog4pWQ4pWQ4pWQIFVOSUZJRUQgQ0FMRU5EQVIgVjEyLjEzIOKVkOKVkOKVkCAqLwogICAgICAgIC51Y2FsLWhlYWRlcntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7bWFyZ2luLWJvdHRvbToxNnB4O2ZsZXgtd3JhcDp3cmFwO30KICAgICAgICAudWNhbC1uYXYtYnRue2JhY2tncm91bmQ6bm9uZTtib3JkZXI6MXB4IHNvbGlkICNkZGQ7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzo4cHggMTJweDtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6LjlyZW07Y29sb3I6IzU1NTt0cmFuc2l0aW9uOmFsbCAuMTVzO30KICAgICAgICAudWNhbC1uYXYtYnRuOmhvdmVye2JhY2tncm91bmQ6I2Y1ZjVmNTtib3JkZXItY29sb3I6I2JiYjt9CiAgICAgICAgLnVjYWwtdGl0bGV7bWFyZ2luOjA7Zm9udC1zaXplOjEuMXJlbTtjb2xvcjojMmMzZTUwO21pbi13aWR0aDoxODBweDt0ZXh0LWFsaWduOmNlbnRlcjt9CiAgICAgICAgLnVjYWwtYnRuLXRvZGF5e2JhY2tncm91bmQ6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICMzNDk4ZGI7Y29sb3I6IzM0OThkYjtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjdweCAxNHB4O2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZTouNzhyZW07Zm9udC13ZWlnaHQ6NjAwO3RyYW5zaXRpb246YWxsIC4xNXM7fQogICAgICAgIC51Y2FsLWJ0bi10b2RheTpob3ZlcntiYWNrZ3JvdW5kOiMzNDk4ZGI7Y29sb3I6I2ZmZjt9CiAgICAgICAgLnVjYWwtYnRuLWFkZHtiYWNrZ3JvdW5kOiMyN2FlNjA7Y29sb3I6I2ZmZjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjhweCAxNnB4O2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZTouNzhyZW07Zm9udC13ZWlnaHQ6NjAwO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDt9CiAgICAgICAgLnVjYWwtYnRuLWFkZDpob3ZlcntiYWNrZ3JvdW5kOiMyMTlhNTI7fQogICAgICAgIC51Y2FsLWJ0bi1yZWZyZXNoe2JhY2tncm91bmQ6bm9uZTtib3JkZXI6MXB4IHNvbGlkICM0Mjg1ZjQ7Y29sb3I6IzQyODVmNDtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjhweCAxMnB4O2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZTouNzhyZW07fQogICAgICAgIC51Y2FsLWJ0bi1yZWZyZXNoOmhvdmVye2JhY2tncm91bmQ6IzQyODVmNDtjb2xvcjojZmZmO30KICAgICAgICAudWNhbC1sZWdlbmR7ZGlzcGxheTpmbGV4O2dhcDoxMHB4O2ZvbnQtc2l6ZTouNjVyZW07Y29sb3I6Izg4ODthbGlnbi1pdGVtczpjZW50ZXI7ZmxleC13cmFwOndyYXA7fQogICAgICAgIC51Y2FsLWxlZ2VuZC1kb3R7d2lkdGg6MTBweDtoZWlnaHQ6MTBweDtib3JkZXItcmFkaXVzOjUwJTtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW4tcmlnaHQ6M3B4O30KICAgICAgICAudWNhbC1kYXktZ3JvdXB7bWFyZ2luLWJvdHRvbTo0cHg7fQogICAgICAgIC51Y2FsLWRheS1oZHJ7Zm9udC1zaXplOi43OHJlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6IzU1NTtwYWRkaW5nOjEwcHggMTRweCA0cHg7cG9zaXRpb246c3RpY2t5O3RvcDowO2JhY2tncm91bmQ6I2Y5ZmFmYjt6LWluZGV4OjI7dGV4dC10cmFuc2Zvcm06Y2FwaXRhbGl6ZTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZWVlO30KICAgICAgICAudWNhbC1kYXktaGRyLmlzLXRvZGF5e2NvbG9yOiNlNjdlMjI7YmFja2dyb3VuZDojZmZmOGYwO30KICAgICAgICAudWNhbC1pdGVte2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpmbGV4LXN0YXJ0O2dhcDoxMHB4O3BhZGRpbmc6MTBweCAxNHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNmMGYwZjA7dHJhbnNpdGlvbjpiYWNrZ3JvdW5kIC4xcztjdXJzb3I6ZGVmYXVsdDt9CiAgICAgICAgLnVjYWwtaXRlbTpob3ZlcntiYWNrZ3JvdW5kOiNmOGY5ZmE7fQogICAgICAgIC51Y2FsLWRvdHt3aWR0aDoxMHB4O2hlaWdodDoxMHB4O2JvcmRlci1yYWRpdXM6NTAlO2ZsZXgtc2hyaW5rOjA7bWFyZ2luLXRvcDo1cHg7fQogICAgICAgIC51Y2FsLWxlZnR7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjthbGlnbi1pdGVtczpmbGV4LXN0YXJ0O21pbi13aWR0aDo5MHB4O2ZsZXgtc2hyaW5rOjA7fQogICAgICAgIC51Y2FsLWluZm97ZmxleDoxO21pbi13aWR0aDowO30KICAgICAgICAudWNhbC1pdGVtLXRpdGxle2ZvbnQtc2l6ZTouODJyZW07Y29sb3I6IzJjM2U1MDtmb250LXdlaWdodDo1MDA7fQogICAgICAgIC51Y2FsLWl0ZW0tbWV0YXtmb250LXNpemU6LjY1cmVtO2NvbG9yOiNhYWE7bWFyZ2luLXRvcDoxcHg7fQogICAgICAgIC51Y2FsLWl0ZW0tdGltZXtmb250LXNpemU6LjcycmVtO2NvbG9yOiM4ODg7fQogICAgICAgIC51Y2FsLWl0ZW0tYWN0aW9uc3tkaXNwbGF5OmZsZXg7Z2FwOjFweDttYXJnaW4tdG9wOjRweDtvcGFjaXR5OjA7dHJhbnNpdGlvbjpvcGFjaXR5IC4xNXM7fQogICAgICAgIC51Y2FsLWl0ZW06aG92ZXIgLnVjYWwtaXRlbS1hY3Rpb25ze29wYWNpdHk6MTt9CiAgICAgICAgLnVjYWwtaXRlbS1hY3Rpb25zIGJ1dHRvbntiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7cGFkZGluZzozcHggNnB4O2JvcmRlci1yYWRpdXM6NXB4O2ZvbnQtc2l6ZTouNjhyZW07Y29sb3I6I2JiYjt9CiAgICAgICAgLnVjYWwtaXRlbS1hY3Rpb25zIGJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kOiNlZWU7Y29sb3I6IzU1NTt9CiAgICAgICAgLnVjYWwtaXRlbS1hY3Rpb25zIGJ1dHRvbi5hY3QtZGVsOmhvdmVye2NvbG9yOiNlNzRjM2M7YmFja2dyb3VuZDojZmRmMGYwO30KICAgICAgICAudWNhbC1lbXB0eXt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjojY2NjO3BhZGRpbmc6NTBweCAyMHB4O2ZvbnQtc2l6ZTouODVyZW07fQogICAgICAgIC51Y2FsLWVtcHR5IGl7Zm9udC1zaXplOjJyZW07ZGlzcGxheTpibG9jazttYXJnaW4tYm90dG9tOjEwcHg7fQogICAgICAgIC51Y2FsLWRlc3Qtb3B0e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDtwYWRkaW5nOjhweCAxNHB4O2JvcmRlcjoycHggc29saWQgI2UwZTBlMDtib3JkZXItcmFkaXVzOjhweDtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6Ljc4cmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjojNTU1O3RyYW5zaXRpb246YWxsIC4xNXM7fQogICAgICAgIC51Y2FsLWRlc3Qtb3B0OmhvdmVye2JvcmRlci1jb2xvcjojMzQ5OGRiO30KICAgICAgICAudWNhbC1kZXN0LW9wdC5hY3RpdmV7Ym9yZGVyLWNvbG9yOiMzNDk4ZGI7YmFja2dyb3VuZDojZWFmNGZlO2NvbG9yOiMyYzNlNTA7fQogICAgICAgIC51Y2FsLWRlc3Qtb3B0IGlucHV0e2Rpc3BsYXk6bm9uZTt9CiAgICAgICAgLnVjYWwtc3JjLWJhZGdle2ZvbnQtc2l6ZTouNTVyZW07cGFkZGluZzoxcHggNXB4O2JvcmRlci1yYWRpdXM6NHB4O2NvbG9yOiNmZmY7Zm9udC13ZWlnaHQ6NjAwO21hcmdpbi1sZWZ0OjZweDt9CgogICAgICAgIC8qIOKVkOKVkOKVkCBJTkxJTkUgTE9HTyDilZDilZDilZAgKi8KICAgICAgICAucnRlLWxvZ28taW1nIHsgbWF4LWhlaWdodDo2MHB4OyBtYXgtd2lkdGg6MTIwcHg7IHZlcnRpY2FsLWFsaWduOm1pZGRsZTsgZGlzcGxheTppbmxpbmUtYmxvY2sgIWltcG9ydGFudDsgLXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6ZXhhY3QgIWltcG9ydGFudDsgcHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0ICFpbXBvcnRhbnQ7IH0KICAgICAgICAvKiDilZDilZDilZAgUklDSCBURVhUIEVESVRPUiDilZDilZDilZAgKi8KICAgICAgICAucnRlLXdyYXB7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci1yYWRpdXM6OHB4O292ZXJmbG93OmhpZGRlbjtiYWNrZ3JvdW5kOiNmZmZ9CiAgICAgICAgLnJ0ZS1iYXJ7ZGlzcGxheTpmbGV4O2dhcDoycHg7cGFkZGluZzo0cHggNnB4O2JhY2tncm91bmQ6I2Y0ZjVmNztib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZGRkfQogICAgICAgIC5ydGUtYmFyIGJ1dHRvbnt3aWR0aDoyOHB4O2hlaWdodDoyNnB4O2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6NHB4O2JhY2tncm91bmQ6dHJhbnNwYXJlbnQ7Y3Vyc29yOnBvaW50ZXI7Zm9udC1zaXplOi43OHJlbTtjb2xvcjojNTU1O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcn0KICAgICAgICAucnRlLWJhciBidXR0b246aG92ZXJ7YmFja2dyb3VuZDojZTBlMGUwfQogICAgICAgIC5ydGUtc2Vwe2Rpc3BsYXk6aW5saW5lLWJsb2NrO3dpZHRoOjFweDtoZWlnaHQ6MTZweDtiYWNrZ3JvdW5kOiNkZGQ7bWFyZ2luOjAgM3B4O3ZlcnRpY2FsLWFsaWduOm1pZGRsZTt9CiAgICAgICAgLnJ0ZS1jb2xvci1wb3B7cG9zaXRpb246YWJzb2x1dGU7dG9wOjEwMCU7bGVmdDowO2JhY2tncm91bmQ6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNkZGQ7Ym9yZGVyLXJhZGl1czo4cHg7Ym94LXNoYWRvdzowIDRweCAxMnB4IHJnYmEoMCwwLDAsLjE1KTtwYWRkaW5nOjhweDtkaXNwbGF5OmZsZXg7Z2FwOjRweDtmbGV4LXdyYXA6d3JhcDt6LWluZGV4OjEwMDt3aWR0aDoxNjBweDt9CiAgICAgICAgLnJ0ZS1jb2xvci1zd3t3aWR0aDoyMHB4O2hlaWdodDoyMHB4O2JvcmRlci1yYWRpdXM6NHB4O2JvcmRlcjoxcHggc29saWQgI2RkZDtjdXJzb3I6cG9pbnRlcjt9CiAgICAgICAgLnJ0ZS1jb2xvci1zdzpob3Zlcnt0cmFuc2Zvcm06c2NhbGUoMS4yKTtib3gtc2hhZG93OjAgMCA0cHggcmdiYSgwLDAsMCwuMik7fQoKICAgICAgICAucnRlLWJvZHl7bWluLWhlaWdodDo4MHB4O292ZXJmbG93OmF1dG87cmVzaXplOnZlcnRpY2FsO3BhZGRpbmc6OHB4IDEwcHg7Zm9udC1zaXplOi44MnJlbTtsaW5lLWhlaWdodDoxLjU7b3V0bGluZTpub25lfQogICAgICAgIC5ydGUtYm9keSB1bCwucnRlLWJvZHkgb2x7bWFyZ2luOjRweCAwIDRweCAxOHB4O3BhZGRpbmc6MH0KCiAgICAgICAgCiAgICAgICAgLyog4pWQ4pWQ4pWQIEFVVE9DT01QTEVURSDDiUzDiFZFUyDilZDilZDilZAgKi8KICAgICAgICAuYWMtd3JhcHtwb3NpdGlvbjpyZWxhdGl2ZX0KICAgICAgICAuYWMtbGlzdHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MTAwJTtsZWZ0OjA7cmlnaHQ6MDttYXgtaGVpZ2h0OjE4MHB4O292ZXJmbG93LXk6YXV0bztiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci10b3A6bm9uZTtib3JkZXItcmFkaXVzOjAgMCA4cHggOHB4O2JveC1zaGFkb3c6MCA0cHggMTJweCByZ2JhKDAsMCwwLC4xMik7ei1pbmRleDo5OTk7ZGlzcGxheTpub25lfQogICAgICAgIC5hYy1saXN0LnNob3d7ZGlzcGxheTpibG9ja30KICAgICAgICAuYWMtaXRlbXtwYWRkaW5nOjdweCAxMnB4O2ZvbnQtc2l6ZTouNzhyZW07Y3Vyc29yOnBvaW50ZXI7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcn0KICAgICAgICAuYWMtaXRlbTpob3ZlciwuYWMtaXRlbS5hY3RpdmV7YmFja2dyb3VuZDojZWFmNGZlfQogICAgICAgIC5hYy1pdGVtIC5hYy1jbGFzc2V7Zm9udC1zaXplOi42NXJlbTtjb2xvcjojODg4O2JhY2tncm91bmQ6I2YwZjBmMDtwYWRkaW5nOjFweCA2cHg7Ym9yZGVyLXJhZGl1czo0cHh9CgogICAgICAgIC8qIOKVkOKVkOKVkCBFVkVORU1FTlRTIChtZW51MTApIOKVkOKVkOKVkCAqLwogICAgICAgIC5ldi1oZWFkZXJ7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjttYXJnaW4tYm90dG9tOjE0cHg7ZmxleC13cmFwOndyYXA7Z2FwOjhweH0KICAgICAgICAuZXYtaGVhZGVyIGgye2NvbG9yOnZhcigtLWhlYWRlcik7Zm9udC1zaXplOjEuMDVyZW07ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4O21hcmdpbjowfQogICAgICAgIC5ldi10b3B7ZGlzcGxheTpmbGV4O2dhcDoxMnB4O21hcmdpbi1ib3R0b206MTRweDtmbGV4LXdyYXA6d3JhcDthbGlnbi1pdGVtczpjZW50ZXJ9CiAgICAgICAgLmV2LWtwaXN7ZGlzcGxheTpmbGV4O2dhcDoxMHB4O2ZsZXg6MTtmbGV4LXdyYXA6d3JhcH0KICAgICAgICAuZXYta3Bpe2JhY2tncm91bmQ6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNlOGVhZWQ7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6MTBweCAxNnB4O3RleHQtYWxpZ246Y2VudGVyO21pbi13aWR0aDo5MHB4fQogICAgICAgIC5ldi1rcGkgLmt2e2ZvbnQtc2l6ZToxLjNyZW07Zm9udC13ZWlnaHQ6NzAwfS5ldi1rcGkgLmtse2ZvbnQtc2l6ZTouNjVyZW07Y29sb3I6Izg4ODttYXJnaW4tdG9wOjJweH0KICAgICAgICAuZXYtZmlsdGVyc3tkaXNwbGF5OmZsZXg7Z2FwOjhweDtmbGV4LXdyYXA6d3JhcDttYXJnaW4tYm90dG9tOjE0cHg7YWxpZ24taXRlbXM6Y2VudGVyfQogICAgICAgIC5ldi1maWx0ZXJzIHNlbGVjdCwuZXYtZmlsdGVycyBpbnB1dHtwYWRkaW5nOjZweCAxMHB4O2JvcmRlcjoxcHggc29saWQgI2RkZDtib3JkZXItcmFkaXVzOjhweDtmb250LXNpemU6Ljc4cmVtfQogICAgICAgIC5ldi1ncmlke2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6cmVwZWF0KGF1dG8tZmlsbCxtaW5tYXgoMzIwcHgsMWZyKSk7Z2FwOjE0cHh9CiAgICAgICAgLmV2LWNhcmR7YmFja2dyb3VuZDojZmZmO2JvcmRlcjoxcHggc29saWQgI2U4ZWFlZDtib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzoxNnB4O2JveC1zaGFkb3c6MCAxcHggNHB4IHJnYmEoMCwwLDAsLjA0KTt0cmFuc2l0aW9uOmFsbCAuMTVzO3Bvc2l0aW9uOnJlbGF0aXZlfQogICAgICAgIC5ldi1jYXJkOmhvdmVye2JveC1zaGFkb3c6MCA0cHggMTRweCByZ2JhKDAsMCwwLC4xKTt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtMXB4KX0KICAgICAgICAuZXYtY2FyZC1oZHtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6ZmxleC1zdGFydDtnYXA6OHB4O21hcmdpbi1ib3R0b206OHB4fQogICAgICAgIC5ldi1jYXJkIGg0e2ZvbnQtc2l6ZTouODhyZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiMyYzNlNTA7bWFyZ2luOjA7ZmxleDoxO2xpbmUtaGVpZ2h0OjEuM30KICAgICAgICAuZXYtY2FyZC1hY3Rze2Rpc3BsYXk6ZmxleDtnYXA6M3B4fQogICAgICAgIC5ldi1jYXJkLWFjdHMgYnV0dG9ue3dpZHRoOjI2cHg7aGVpZ2h0OjI2cHg7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo2cHg7Y3Vyc29yOnBvaW50ZXI7Zm9udC1zaXplOi43cmVtO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtiYWNrZ3JvdW5kOiNmMGYwZjA7Y29sb3I6Izg4OH0KICAgICAgICAuZXYtY2FyZC1hY3RzIGJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kOiNkZGQ7Y29sb3I6IzMzM30KICAgICAgICAuZXYtY2FyZC1tZXRhe2Rpc3BsYXk6ZmxleDtnYXA6MTBweDtmbGV4LXdyYXA6d3JhcDtmb250LXNpemU6LjdyZW07Y29sb3I6Izg4ODttYXJnaW4tYm90dG9tOjZweH0KICAgICAgICAuZXYtY2FyZC1tZXRhIHNwYW57ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6M3B4fQogICAgICAgIC5ldi1jYXJkLWRlc2N7Zm9udC1zaXplOi43NnJlbTtjb2xvcjojNTU1O2xpbmUtaGVpZ2h0OjEuNDttYXgtaGVpZ2h0OjYwcHg7b3ZlcmZsb3c6aGlkZGVuO21hcmdpbi1ib3R0b206OHB4fQogICAgICAgIC5ldi1jYXJkLWZ0e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDtmbGV4LXdyYXA6d3JhcH0KICAgICAgICAuZXYtYmFkZ2V7cGFkZGluZzoycHggOHB4O2JvcmRlci1yYWRpdXM6MTBweDtmb250LXNpemU6LjZyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiNmZmZ9CiAgICAgICAgLmV2LWJhZGdlLnRvZG97YmFja2dyb3VuZDojZTc0YzNjfS5ldi1iYWRnZS5wcm9ncmVzc3tiYWNrZ3JvdW5kOiNmMzljMTJ9LmV2LWJhZGdlLmRvbmV7YmFja2dyb3VuZDojMjdhZTYwfS5ldi1iYWRnZS5ibG9ja2Vke2JhY2tncm91bmQ6Izk1YTVhNn0KICAgICAgICAuZXYtcGJhcntoZWlnaHQ6NHB4O2JhY2tncm91bmQ6I2VjZjBmMTtib3JkZXItcmFkaXVzOjRweDtvdmVyZmxvdzpoaWRkZW47ZmxleDoxO21pbi13aWR0aDo2MHB4fQogICAgICAgIC5ldi1wZmlsbHtoZWlnaHQ6MTAwJTtib3JkZXItcmFkaXVzOjRweH0KICAgICAgICAuZXYtdGFne3BhZGRpbmc6MXB4IDVweDtib3JkZXItcmFkaXVzOjZweDtmb250LXNpemU6LjU4cmVtO2JhY2tncm91bmQ6I2VlZjtjb2xvcjojNjY2fQogICAgICAgIC5ldi1hdHRhY2h7Zm9udC1zaXplOi42NnJlbTtjb2xvcjp2YXIoLS1oZWFkZXIpO2N1cnNvcjpwb2ludGVyO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweH0KICAgICAgICAuZXYtYXR0YWNoOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9CgogICAgICAgIC8qIOKVkOKVkOKVkCBHQU5UVCBUQUJMRSAobWVudTExKSDilZDilZDilZAgKi8KICAgICAgICAuZ3QtYmFye2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47bWFyZ2luLWJvdHRvbToxMnB4O2ZsZXgtd3JhcDp3cmFwO2dhcDo4cHg7cGFkZGluZzoxMnB4IDE2cHg7YmFja2dyb3VuZDojZmRmMmU5O2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MXB4IHNvbGlkICNmMGM0OWJ9CiAgICAgICAgLmd0LWJhciBoMntjb2xvcjojZDM1NDAwO2ZvbnQtc2l6ZToxLjA1cmVtO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDttYXJnaW46MH0KICAgICAgICAuZ3QtYmFyLWJ0bnN7ZGlzcGxheTpmbGV4O2dhcDo2cHh9CiAgICAgICAgLmd0LWJhci1idG5zIGJ1dHRvbntwYWRkaW5nOjZweCAxNHB4O2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6NnB4O2ZvbnQtd2VpZ2h0OjYwMDtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6Ljc4cmVtO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjVweH0KICAgICAgICAuZ3QtYnRuLWFkZHtiYWNrZ3JvdW5kOiNkMzU0MDA7Y29sb3I6I2ZmZn0uZ3QtYnRuLWFkZDpob3ZlcntiYWNrZ3JvdW5kOiNlNjdlMjJ9CiAgICAgICAgLmd0LWJ0bi1zZWN7YmFja2dyb3VuZDojZmZmO2NvbG9yOiM1NTU7Ym9yZGVyOjFweCBzb2xpZCAjY2NjfS5ndC1idG4tc2VjOmhvdmVye2JhY2tncm91bmQ6I2Y1ZjVmNX0KICAgICAgICAuZ3QtbmF2e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDttYXJnaW4tYm90dG9tOjEwcHg7ZmxleC13cmFwOndyYXB9CiAgICAgICAgLmd0LW5hdiBidXR0b257aGVpZ2h0OjI4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci1yYWRpdXM6NXB4O2JhY2tncm91bmQ6I2ZmZjtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6LjcycmVtO3BhZGRpbmc6MCA4cHh9CiAgICAgICAgLmd0LW5hdiBidXR0b246aG92ZXJ7YmFja2dyb3VuZDojZjBmMGYwfQogICAgICAgIC5ndC1uYXYgc2VsZWN0e3BhZGRpbmc6NHB4IDhweDtib3JkZXI6MXB4IHNvbGlkICNkZGQ7Ym9yZGVyLXJhZGl1czo1cHg7Zm9udC1zaXplOi43NXJlbX0KICAgICAgICAuZ3Qtd3JhcHtvdmVyZmxvdy14OmF1dG87Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci1yYWRpdXM6OHB4O2JhY2tncm91bmQ6I2ZmZn0KICAgICAgICB0YWJsZS5ndHt3aWR0aDoxMDAlO2JvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTt0YWJsZS1sYXlvdXQ6Zml4ZWR9CiAgICAgICAgLmd0IHRoe3BhZGRpbmc6NHB4IDJweDtmb250LXNpemU6LjYycmVtO2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojNjY2O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNkZGQ7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZDojZjhmOGY4fQogICAgICAgIC5ndCB0aC5ndC1tb3tiYWNrZ3JvdW5kOiNlOGU4ZTg7Zm9udC1zaXplOi42OHJlbTtjb2xvcjojNDQ0O2JvcmRlci1yaWdodDoxcHggc29saWQgI2RkZH0KICAgICAgICAuZ3QgdGguZ3QtbGN7bWluLXdpZHRoOjI3MHB4O3dpZHRoOjI3MHB4O3RleHQtYWxpZ246bGVmdDtwYWRkaW5nLWxlZnQ6MTBweH0KICAgICAgICAuZ3QgdGguZ3QtY2N7d2lkdGg6NTBweDt0ZXh0LWFsaWduOmNlbnRlcn0uZ3QgdGguZ3QtZGN7d2lkdGg6NTVweDt0ZXh0LWFsaWduOmNlbnRlcn0KICAgICAgICAuZ3QgdGguZ3QtY3d7YmFja2dyb3VuZDojZDM1NDAwO2NvbG9yOiNmZmZ9CiAgICAgICAgLmd0IHRoLmd0LXZhe2JhY2tncm91bmQ6cmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCg0NWRlZywjZjBmMGYwLCNmMGYwZjAgM3B4LCNlOGU4ZTggM3B4LCNlOGU4ZTggNnB4KX0KICAgICAgICAuZ3QgdGR7cGFkZGluZzowO2hlaWdodDoyOHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNmMGYwZjA7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjZjhmOGY4O3Bvc2l0aW9uOnJlbGF0aXZlfQogICAgICAgIC5ndCB0ZC5ndC1sYXtmb250LXNpemU6Ljc0cmVtO2ZvbnQtd2VpZ2h0OjUwMDtjb2xvcjojMzMzO3BhZGRpbmctbGVmdDoxMHB4O3doaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpcztjdXJzb3I6cG9pbnRlcjtib3JkZXItcmlnaHQ6MXB4IHNvbGlkICNlZWV9CiAgICAgICAgLmd0IHRkLmd0LWxhOmhvdmVye2NvbG9yOiNkMzU0MDA7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX0KICAgICAgICAuZ3QgdGQuZ3QtY297Zm9udC1zaXplOi43cmVtO2ZvbnQtd2VpZ2h0OjcwMDt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjojZDM1NDAwO2JvcmRlci1yaWdodDoxcHggc29saWQgI2VlZX0KICAgICAgICAuZ3QgdGQuZ3QtY2t7dGV4dC1hbGlnbjpjZW50ZXI7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjZWVlfQogICAgICAgIC5ndCB0ZC5ndC12YXtiYWNrZ3JvdW5kOnJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoNDVkZWcsI2YwZjBmMCwjZjBmMGYwIDNweCwjZThlOGU4IDNweCwjZThlOGU4IDZweCkhaW1wb3J0YW50fQogICAgICAgIC5ndC1jZntwb3NpdGlvbjphYnNvbHV0ZTtpbnNldDozcHggMXB4O2JvcmRlci1yYWRpdXM6M3B4fQogICAgICAgIC5ndC1jZi5kb25le29wYWNpdHk6LjR9CiAgICAgICAgLmd0LWNmLmMtcmVudHJlZXtiYWNrZ3JvdW5kOiM1ZGFkZTJ9Lmd0LWNmLmMtZXhhbWVuc3tiYWNrZ3JvdW5kOiMyZTg2YzF9CiAgICAgICAgLmd0LWNmLmMtb3JpZW50YXRpb257YmFja2dyb3VuZDojMWE1Mjc2fS5ndC1jZi5jLWNvbnNlaWxze2JhY2tncm91bmQ6IzI0NzFhM30KICAgICAgICAuZ3QtY2YuYy1hZG1pbntiYWNrZ3JvdW5kOiMxNDhmNzd9Lmd0LWNmLmMtYXV0cmV7YmFja2dyb3VuZDojNWI2ZDVifQogICAgICAgIC5ndC1jZi5jLXBlZGFnb2d7YmFja2dyb3VuZDojOGU0NGFkfS5ndC1jZi5jLXJoe2JhY2tncm91bmQ6I2MwMzkyYn0KICAgICAgICAuZ3QtbGVne2Rpc3BsYXk6ZmxleDtnYXA6MTJweDtmbGV4LXdyYXA6d3JhcDttYXJnaW4tdG9wOjhweDtwYWRkaW5nOjRweCAwfQogICAgICAgIC5ndC1sZWcgc3BhbntkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo0cHg7Zm9udC1zaXplOi42OHJlbTtjb2xvcjojNjY2fQogICAgICAgIC5ndC1sZWcgaXt3aWR0aDoxMnB4O2hlaWdodDo4cHg7Ym9yZGVyLXJhZGl1czoycHg7ZGlzcGxheTppbmxpbmUtYmxvY2t9CgogICAgICAgIC8qIOKVkOKVkOKVkCBNT0RBTFMg4pWQ4pWQ4pWQICovCiAgICAgICAgLm0tb3Z7ZGlzcGxheTpub25lO3Bvc2l0aW9uOmZpeGVkO2luc2V0OjA7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC40KTt6LWluZGV4Ojk5OTk7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXJ9CiAgICAgICAgLm0tb3Yub3BlbntkaXNwbGF5OmZsZXh9CiAgICAgICAgLm0tYm94e2JhY2tncm91bmQ6I2ZmZjtib3JkZXItcmFkaXVzOjE0cHg7cGFkZGluZzoyNnB4O21heC13aWR0aDo5NXZ3O21heC1oZWlnaHQ6OTB2aDtvdmVyZmxvdy15OmF1dG87Ym94LXNoYWRvdzowIDIwcHggNjBweCByZ2JhKDAsMCwwLC4yNSl9CiAgICAgICAgLm0tYm94IGgze21hcmdpbjowIDAgMTZweDtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHh9Lm0tYm94IGgzIGl7Y29sb3I6dmFyKC0taGVhZGVyKX0KICAgICAgICAubS1yb3d7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMWZyO2dhcDoxMnB4O21hcmdpbi1ib3R0b206MTJweH0KICAgICAgICAubS1hY3Rze2Rpc3BsYXk6ZmxleDtnYXA6OHB4O2p1c3RpZnktY29udGVudDpmbGV4LWVuZDttYXJnaW4tdG9wOjEycHh9CiAgICAgICAgLm1ie3BhZGRpbmc6OHB4IDE4cHg7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo4cHg7Y3Vyc29yOnBvaW50ZXI7Zm9udC13ZWlnaHQ6NjAwO2ZvbnQtc2l6ZTouOHJlbTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo1cHh9CiAgICAgICAgLm1iLWN7YmFja2dyb3VuZDojZjBmMGYwO2NvbG9yOiM1NTU7cGFkZGluZzoxMHB4IDIwcHg7Zm9udC1zaXplOi44NXJlbTtib3JkZXItcmFkaXVzOjhweH0ubWItb2t7YmFja2dyb3VuZDp2YXIoLS1oZWFkZXIpO2NvbG9yOiNmZmY7Zm9udC1zaXplOi45cmVtO3BhZGRpbmc6MTBweCAyNHB4O2JveC1zaGFkb3c6MCAycHggOHB4IHJnYmEoNDQsNjIsODAsLjMpO3RyYW5zaXRpb246dHJhbnNmb3JtIC4xcyxib3gtc2hhZG93IC4xc30ubWItb2s6aG92ZXJ7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoLTFweCk7Ym94LXNoYWRvdzowIDRweCAxMnB4IHJnYmEoNDQsNjIsODAsLjQpfQogICAgICAgIC5tYi1kZWx7YmFja2dyb3VuZDojZTc0YzNjO2NvbG9yOiNmZmY7bWFyZ2luLXJpZ2h0OmF1dG99CgogICAgICAgIEBtZWRpYSBwcmludHsKICAgICAgICAgICAgLnNpZGViYXIsLmd0LWJhci1idG5zLC5ndC1uYXYsLmd0LWxlZywuZ3QtY2ssLmV2LWhlYWRlciwuZXYtdG9wLC5ldi1maWx0ZXJzLC5ldi1jYXJkLWFjdHMsLm5vLXByaW50e2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnR9CiAgICAgICAgICAgIC5jb250ZW50e21hcmdpbi1sZWZ0OjAhaW1wb3J0YW50O3BhZGRpbmc6OHB4IWltcG9ydGFudH0KICAgICAgICAgICAgLmd0LXdyYXB7Ym9yZGVyOjFweCBzb2xpZCAjOTk5O21heC1oZWlnaHQ6bm9uZSFpbXBvcnRhbnQ7b3ZlcmZsb3c6dmlzaWJsZSFpbXBvcnRhbnR9CiAgICAgICAgICAgIC5ndCB0ZCwuZ3QgdGh7Ym9yZGVyOjFweCBzb2xpZCAjY2NjIWltcG9ydGFudH0KICAgICAgICAgICAgLmd0LWNme3ByaW50LWNvbG9yLWFkanVzdDpleGFjdDstd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDpleGFjdH0KICAgICAgICB9CgogICAgCi8qIOKUgOKUgCBHb29nbGUgQ2FsZW5kYXIgZHVhbCB2aWV3IOKUgOKUgCAqLwouZ2NhbC1iYW5uZXJ7YmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCM0Mjg1ZjQsIzM0YTg1Myk7Y29sb3I6I2ZmZjtwYWRkaW5nOjE0cHggMThweDtib3JkZXItcmFkaXVzOjEycHg7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTJweDttYXJnaW4tYm90dG9tOjE2cHg7Zm9udC1zaXplOi44NXJlbTt9Ci5nY2FsLWJhbm5lciBpe2ZvbnQtc2l6ZToxLjNyZW07fQouZ2NhbC1iYW5uZXIgLmdjYWwtc3RhdHVze2ZvbnQtd2VpZ2h0OjYwMDt9Ci5nY2FsLWJhbm5lciAuZ2NhbC1zdWJ7b3BhY2l0eTouODU7Zm9udC1zaXplOi43MnJlbTt9Ci5nY2FsLW9mZmxpbmUtYmFubmVye2JhY2tncm91bmQ6I2YwZjBmMDtjb2xvcjojNTU1O3BhZGRpbmc6MTRweCAxOHB4O2JvcmRlci1yYWRpdXM6MTJweDtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMnB4O21hcmdpbi1ib3R0b206MTZweDtmb250LXNpemU6Ljg1cmVtO30KLmdjYWwtb2ZmbGluZS1iYW5uZXIgaXtmb250LXNpemU6MS4zcmVtO2NvbG9yOiM5OTk7fQouZ2NhbC1ldnQtbGlzdHttYXgtaGVpZ2h0OjYwdmg7b3ZlcmZsb3cteTphdXRvO30KLmdjYWwtZGF5LWdyb3Vwe21hcmdpbi1ib3R0b206MTRweDt9Ci5nY2FsLWRheS1oZWFkZXJ7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTouODJyZW07Y29sb3I6IzMzMztwYWRkaW5nOjZweCAwO2JvcmRlci1ib3R0b206MnB4IHNvbGlkICNlMGUwZTA7bWFyZ2luLWJvdHRvbTo2cHg7cG9zaXRpb246c3RpY2t5O3RvcDowO2JhY2tncm91bmQ6I2ZmZjt6LWluZGV4OjE7fQouZ2NhbC1kYXktaGVhZGVyLmlzLXRvZGF5e2NvbG9yOiNlNjdlMjI7Ym9yZGVyLWJvdHRvbS1jb2xvcjojZTY3ZTIyO30KLmdjYWwtaXRlbXtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6ZmxleC1zdGFydDtnYXA6MTBweDtwYWRkaW5nOjdweCAxMHB4O2JvcmRlci1yYWRpdXM6OHB4O2ZvbnQtc2l6ZTouOHJlbTt0cmFuc2l0aW9uOmJhY2tncm91bmQgLjE1czt9Ci5nY2FsLWl0ZW06aG92ZXJ7YmFja2dyb3VuZDojZjVmNWY1O30KLmdjYWwtaXRlbSAuZ2NhbC1kb3R7d2lkdGg6MTBweDtoZWlnaHQ6MTBweDtib3JkZXItcmFkaXVzOjUwJTtmbGV4LXNocmluazowO21hcmdpbi10b3A6M3B4O30KLmdjYWwtaXRlbSAuZ2NhbC10aW1le2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojNTU1O21pbi13aWR0aDo0OHB4O2ZvbnQtc2l6ZTouNzVyZW07fQouZ2NhbC1pdGVtIC5nY2FsLXRpdGxle2ZsZXg6MTtjb2xvcjojMjIyO30KLmdjYWwtaXRlbSAuZ2NhbC1jYWwtbmFtZXtmb250LXNpemU6LjY1cmVtO2NvbG9yOiM5OTk7bWFyZ2luLXRvcDoxcHg7fQouZ2NhbC1uYXZ7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4O21hcmdpbi1ib3R0b206MTJweDtmbGV4LXdyYXA6d3JhcDt9Ci5nY2FsLW5hdiBidXR0b257cGFkZGluZzo2cHggMTJweDtib3JkZXI6MXB4IHNvbGlkICNkZGQ7Ym9yZGVyLXJhZGl1czo4cHg7YmFja2dyb3VuZDojZmZmO2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZTouNzhyZW07Zm9udC13ZWlnaHQ6NjAwO30KLmdjYWwtbmF2IGJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kOiNmMGYwZjA7fQouZ2NhbC1uYXYgLmdjYWwtcGVyaW9ke2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6LjlyZW07Y29sb3I6IzMzMzttaW4td2lkdGg6MTYwcHg7dGV4dC1hbGlnbjpjZW50ZXI7fQouZ2NhbC1lbXB0eXt0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjMwcHg7Y29sb3I6I2FhYTtmb250LXNpemU6Ljg1cmVtO30KLmdjYWwtZW1wdHkgaXtmb250LXNpemU6MnJlbTtkaXNwbGF5OmJsb2NrO21hcmdpbi1ib3R0b206OHB4O30KCgovKiAtLS0gVnVlICJBZ2VuZGFzIiAoMiBzZW1haW5lcykgLS0tICovCi51Y2FsLXZpZXctdG9nZ2xle2Rpc3BsYXk6ZmxleDtnYXA6NnB4O2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW4tbGVmdDoxMHB4O30KLnVjYWwtdmlldy1idG57Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7cGFkZGluZzo3cHggMTBweDtib3JkZXItcmFkaXVzOjEwcHg7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTouNzhyZW07YmFja2dyb3VuZDojZWVmMmY3O2NvbG9yOiMzYjQ2NTg7dHJhbnNpdGlvbjp0cmFuc2Zvcm0gLjE4cywgYm94LXNoYWRvdyAuMThzLCBiYWNrZ3JvdW5kIC4xOHM7fQoudWNhbC12aWV3LWJ0bjpob3Zlcnt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtMXB4KTtib3gtc2hhZG93OjAgNnB4IDE4cHggcmdiYSgwLDAsMCwuMDgpO2JhY2tncm91bmQ6I2U5ZjJmZjt9Ci51Y2FsLXZpZXctYnRuLmFjdGl2ZXtiYWNrZ3JvdW5kOnJnYmEoNTIsMTUyLDIxOSwuMTQpO2NvbG9yOiMxZjRmN2E7Ym94LXNoYWRvdzowIDZweCAxOHB4IHJnYmEoNTIsMTUyLDIxOSwuMTgpO30KLnVjYWwtY2FsZ3JpZHtkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmciAxZnI7Z2FwOjE0cHg7bWFyZ2luLXRvcDoxNHB4O30KQG1lZGlhIChtYXgtd2lkdGg6IDk4MHB4KXsudWNhbC1jYWxncmlke2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnI7fX0KLnVjYWwtY2FsYmxvY2t7YmFja2dyb3VuZDojZmZmO2JvcmRlcjoxcHggc29saWQgcmdiYSgwLDAsMCwuMDgpO2JvcmRlci1yYWRpdXM6MTRweDtib3gtc2hhZG93OjAgOHB4IDI2cHggcmdiYSgwLDAsMCwuMDYpO292ZXJmbG93OmhpZGRlbjtwb3NpdGlvbjpyZWxhdGl2ZTt9Ci51Y2FsLWNhbGhlYWR7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtnYXA6MTBweDtwYWRkaW5nOjEycHggMTRweDtiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEoMCwwLDAsLjAzKSwgcmdiYSgwLDAsMCwwKSk7fQoudWNhbC1jYWxuYW1le2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDtmb250LXdlaWdodDo4MDA7Y29sb3I6IzIyMzA0Nzt9Ci51Y2FsLWRvdHt3aWR0aDoxMHB4O2hlaWdodDoxMHB4O2JvcmRlci1yYWRpdXM6OTk5cHg7ZmxleC1zaHJpbms6MDtib3gtc2hhZG93OjAgMCAwIDNweCByZ2JhKDAsMCwwLC4wNSk7fQoudWNhbC1jYWxsaW1pdHtmb250LXNpemU6LjdyZW07Y29sb3I6IzZiNzI4MDtmb250LXdlaWdodDo3MDA7fQoudWNhbC1jYWxsaXN0e3BhZGRpbmc6OHB4IDEycHggMTJweDt9Ci51Y2FsLWV2ZW50cm93e2Rpc3BsYXk6ZmxleDtnYXA6MTBweDthbGlnbi1pdGVtczpmbGV4LXN0YXJ0O3BhZGRpbmc6MTBweCAxMHB4O2JvcmRlci1yYWRpdXM6MTJweDt0cmFuc2l0aW9uOnRyYW5zZm9ybSAuMThzLCBiYWNrZ3JvdW5kIC4xOHMsIGJveC1zaGFkb3cgLjE4cztib3JkZXI6MXB4IHNvbGlkIHRyYW5zcGFyZW50O30KLnVjYWwtZXZlbnRyb3c6aG92ZXJ7YmFja2dyb3VuZDojZmFmY2ZmO2JvcmRlci1jb2xvcjpyZ2JhKDUyLDE1MiwyMTksLjE0KTtib3gtc2hhZG93OjAgMTBweCAyNnB4IHJnYmEoNTIsMTUyLDIxOSwuMTIpO3RyYW5zZm9ybTp0cmFuc2xhdGVZKC0xcHgpO30KLnVjYWwtd2hlbnttaW4td2lkdGg6OTJweDttYXgtd2lkdGg6OTJweDtmb250LXZhcmlhbnQtbnVtZXJpYzp0YWJ1bGFyLW51bXM7fQoudWNhbC1kYXRle2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjojMzM0MTU1O2ZvbnQtc2l6ZTouNzhyZW07fQoudWNhbC10aW1le2NvbG9yOiM2NDc0OGI7Zm9udC1zaXplOi43MnJlbTttYXJnaW4tdG9wOjJweDtmb250LXdlaWdodDo3MDA7fQoudWNhbC10aXRsZTJ7Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOiMxZjI5Mzc7Zm9udC1zaXplOi44MnJlbTtsaW5lLWhlaWdodDoxLjE1O30KLnVjYWwtbXV0ZWR7Y29sb3I6Izk0YTNiODtmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOi43MnJlbTttYXJnaW4tdG9wOjJweDt9Ci51Y2FsLXNlcHtoZWlnaHQ6MXB4O2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuMDgpO21hcmdpbjowIDE0cHg7fQoKPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KCjxuYXYgY2xhc3M9InNpZGViYXIgbm8tcHJpbnQiPgogICAgPGRpdiBjbGFzcz0iYnJhbmQiPkNBRElSPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJtZW51Ij4KICAgICAgICA8YSBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLW1lbnU9Im1lbnUxIiBvbmNsaWNrPSJzd2l0Y2hNZW51KCdtZW51MScpIj48aSBjbGFzcz0iZmFzIGZhLWNvZ3MiPjwvaT4gUGFyYW3DqHRyZXM8L2E+CiAgICAgICAgPGEgY2xhc3M9Im1lbnUtaXRlbSBhY3RpdmUiIGRhdGEtbWVudT0ibWVudTIiIG9uY2xpY2s9InN3aXRjaE1lbnUoJ21lbnUyJykiPjxpIGNsYXNzPSJmYXMgZmEtY2hlY2stc3F1YXJlIj48L2k+IFRvIERvIExpc3Q8L2E+CiAgICAgICAgPGEgY2xhc3M9Im1lbnUtaXRlbSIgZGF0YS1tZW51PSJtZW51MyIgb25jbGljaz0ic3dpdGNoTWVudSgnbWVudTMnKSI+PGkgY2xhc3M9ImZhcyBmYS1jYWxlbmRhci1hbHQiPjwvaT4gQ2FsZW5kcmllcjwvYT4KICAgICAgICA8YSBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLW1lbnU9Im1lbnU0IiBvbmNsaWNrPSJzd2l0Y2hNZW51KCdtZW51NCcpIj48aSBjbGFzcz0iZmFzIGZhLWNsaXBib2FyZC1saXN0Ij48L2k+IENvbnNlaWwgZGUgRGlyZWN0aW9uPC9hPgogICAgICAgIDxhIGNsYXNzPSJtZW51LWl0ZW0iIGRhdGEtbWVudT0ibWVudTUiIG9uY2xpY2s9InN3aXRjaE1lbnUoJ21lbnU1JykiPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1ncmFkdWF0ZSI+PC9pPiBTdWl2aSDDiWzDqHZlIC8gUG9pbnQgQ1BFPC9hPgogICAgICAgIDxhIGNsYXNzPSJtZW51LWl0ZW0iIGRhdGEtbWVudT0ibWVudTYiIG9uY2xpY2s9InN3aXRjaE1lbnUoJ21lbnU2JykiPjxpIGNsYXNzPSJmYXMgZmEtY29tbWVudHMiPjwvaT4gRW50cmV0aWVuczwvYT4KICAgICAgICA8YSBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLW1lbnU9Im1lbnU3IiBvbmNsaWNrPSJzd2l0Y2hNZW51KCdtZW51NycpIj48aSBjbGFzcz0iZmFzIGZhLXVzZXJzIj48L2k+IFLDqXVuaW9uczwvYT4KICAgICAgICA8YSBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLW1lbnU9Im1lbnU4IiBvbmNsaWNrPSJzd2l0Y2hNZW51KCdtZW51OCcpIj48aSBjbGFzcz0iZmFzIGZhLWhpc3RvcnkiPjwvaT4gSGlzdG9yaXF1ZTwvYT4KICAgICAgICA8YSBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLW1lbnU9Im1lbnU5IiBvbmNsaWNrPSJzd2l0Y2hNZW51KCdtZW51OScpIj48aSBjbGFzcz0iZmFzIGZhLWNoYXJ0LWxpbmUiPjwvaT4gVGFibGVhdSBkZSBCb3JkPC9hPgogICAgICAgIDxhIGNsYXNzPSJtZW51LWl0ZW0iIGRhdGEtbWVudT0ibWVudTEwIiBvbmNsaWNrPSJzd2l0Y2hNZW51KCdtZW51MTAnKSI+PGkgY2xhc3M9ImZhcyBmYS1jYWxlbmRhci1jaGVjayI+PC9pPiBBY3Rpdml0w6lzIHDDqWRhZ29naXF1ZXM8L2E+CiAgICAgICAgPGEgY2xhc3M9Im1lbnUtaXRlbSIgZGF0YS1tZW51PSJtZW51MTEiIG9uY2xpY2s9InN3aXRjaE1lbnUoJ21lbnUxMScpIj48aSBjbGFzcz0iZmFzIGZhLXN0cmVhbSI+PC9pPiDDiWNow6lhbmNlczwvYT4KICAgICAgICA8YSBjbGFzcz0ibWVudS1pdGVtIiBkYXRhLW1lbnU9Im1lbnUxMiIgb25jbGljaz0ic3dpdGNoTWVudSgnbWVudTEyJykiPjxpIGNsYXNzPSJmYXMgZmEtYm9vayI+PC9pPiBQcm9jw6lkdXJlczwvYT4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iZm9vdGVyLWluZm8iPkNBRElSIGJ5IEZTPC9kaXY+CjwvbmF2PgoKPGRpdiBjbGFzcz0ibWFpbi1jb250ZW50Ij4KICAgIDxkaXYgY2xhc3M9InRvcC1iYXIgbm8tcHJpbnQiPgogICAgICAgIDxkaXYgY2xhc3M9InBhZ2UtdGl0bGUiPjxoMiBpZD0iY3VycmVudC10aXRsZSI+UGFyYW3DqHRyZXM8L2gyPjxwIGlkPSJjdXJyZW50LWRhdGUiPjwvcD48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJzeXN0ZW0tc3RhdHVzIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2F2ZS1pbmRpY2F0b3IiIGlkPSJhdXRvLXNhdmUtbXNnIj48aSBjbGFzcz0iZmFzIGZhLXN5bmMtYWx0IGZhLXNwaW4iPjwvaT4gRG9ubsOpZXMgw6Agam91cjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJhY3Rpb24tYnV0dG9ucyI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImltcG9ydEZpbGUiIHN0eWxlPSJkaXNwbGF5Om5vbmUiIG9uY2hhbmdlPSJpbXBvcnREYXRhKHRoaXMpIj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJtZW51MSIgY2xhc3M9InNlY3Rpb24gYWN0aXZlIj4KICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWNhcmQiPgogICAgICAgICAgICA8aDM+UGFyYW3DqHRyZXMgR8OpbsOpcmF1eDwvaDM+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JpZCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48bGFiZWw+Tm9tIMOJdGFibGlzc2VtZW50PC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImNmZy1zY2hvb2wiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIG9uaW5wdXQ9InNhdmVEYXRhKCk7Ij48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxsYWJlbD5Ob20gJiBGb25jdGlvbiAoU2lnbmF0dXJlKTwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGlkPSJjZmctdXNlciIgY2xhc3M9ImZvcm0tY29udHJvbCIgcGxhY2Vob2xkZXI9Ik0uIGxlIFByaW5jaXBhbCIgb25pbnB1dD0ic2F2ZURhdGEoKTsiPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncmlkIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxsYWJlbD5Mb2dvPC9sYWJlbD48aW5wdXQgdHlwZT0iZmlsZSIgb25jaGFuZ2U9ImVuY29kZUltYWdlKHRoaXMsICdjZmctbG9nby1wcmV2aWV3JywgJ2xvZ28nKSIgY2xhc3M9ImZvcm0tY29udHJvbCI+PGltZyBpZD0iY2ZnLWxvZ28tcHJldmlldyIgc3JjPSIiIHN0eWxlPSJoZWlnaHQ6NTBweDsgZGlzcGxheTpub25lOyBtYXJnaW4tdG9wOjEwcHg7Ij48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxsYWJlbD5TaWduYXR1cmU8L2xhYmVsPjxpbnB1dCB0eXBlPSJmaWxlIiBvbmNoYW5nZT0iZW5jb2RlSW1hZ2UodGhpcywgJ2NmZy1zaWctcHJldmlldycsICdzaWduYXR1cmUnKSIgY2xhc3M9ImZvcm0tY29udHJvbCI+PGltZyBpZD0iY2ZnLXNpZy1wcmV2aWV3IiBzcmM9IiIgc3R5bGU9ImhlaWdodDo1MHB4OyBkaXNwbGF5Om5vbmU7IG1hcmdpbi10b3A6MTBweDsiPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoyMHB4OyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiIG9uY2xpY2s9InNhdmVTZXR0aW5ncygpIj5FbnJlZ2lzdHJlciBsZXMgcGFyYW3DqHRyZXM8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGFuZ2VyIiBvbmNsaWNrPSJjbGVhckFsbCgpIj5SZXNldCBBcHA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTRweCI+CiAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtc2l6ZTouNzhyZW07Zm9udC13ZWlnaHQ6NjAwO2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbTo2cHgiPjxpIGNsYXNzPSJmYXMgZmEtZ3JpcC1saW5lcyIgc3R5bGU9ImNvbG9yOiM5OTkiPjwvaT4gU8OpcGFyYXRldXJzIGRlIHNvdXMtbWVudXM8L2xhYmVsPgogICAgICAgICAgICAgICAgPHNtYWxsIHN0eWxlPSJjb2xvcjojODg4O2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbTo4cHgiPkNvY2hleiBsZXMgc291cy1tZW51cyBhcHLDqHMgbGVzcXVlbHMgYWZmaWNoZXIgdW4gc8OpcGFyYXRldXIuPC9zbWFsbD4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9InNlcC1jb25maWciIHN0eWxlPSJkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2dhcDo0cHgiPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAKICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWNhcmQiIHN0eWxlPSJtYXJnaW4tdG9wOjIwcHg7Ij4KICAgICAgICAgICAgPGgzPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS1hbHQiPjwvaT4gTW9kw6hsZXMgcGFyIGTDqWZhdXQ8L2gzPgogICAgICAgICAgICA8c21hbGwgc3R5bGU9ImNvbG9yOiM4ODg7ZGlzcGxheTpibG9jazttYXJnaW4tYm90dG9tOjEycHg7Ij5QZXJzb25uYWxpc2V6IGxlIGNvbnRlbnUgcGFyIGTDqWZhdXQgZGVzIHpvbmVzIGRlIHByaXNlIGRlIG5vdGVzLjwvc21hbGw+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Z2FwOjE0cHg7Ij4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXNpemU6Ljc4cmVtO2ZvbnQtd2VpZ2h0OjYwMDttYXJnaW4tYm90dG9tOjRweDtkaXNwbGF5OmJsb2NrOyI+PGkgY2xhc3M9ImZhcyBmYS1jb21tZW50cyIgc3R5bGU9ImNvbG9yOiM5YjU5YjYiPjwvaT4gRW50cmV0aWVuPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJydGUtd3JhcCI+PGRpdiBjbGFzcz0icnRlLWJhciI+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnYm9sZCcpIiB0aXRsZT0iR3JhcyI+PGI+RzwvYj48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKSIgdGl0bGU9Ikl0YWxpcXVlIj48aT5JPC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKSIgdGl0bGU9IlB1Y2VzIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtdWwiPjwvaT48L2J1dHRvbj4KPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlMZWZ0JykiIHRpdGxlPSJBbGlnbmVyIMOgIGdhdWNoZSI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1sZWZ0Ij48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5Q2VudGVyJykiIHRpdGxlPSJDZW50cmVyIj48aSBjbGFzcz0iZmFzIGZhLWFsaWduLWNlbnRlciI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUZ1bGwnKSIgdGl0bGU9Ikp1c3RpZmllciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1qdXN0aWZ5Ij48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InBhc3RlRnJvbVdvcmQoKSIgdGl0bGU9IkNvbGxlciBkZXB1aXMgV29yZCBlbiBjb25zZXJ2YW50IGxhIG1pc2UgZW4gcGFnZSIgc3R5bGU9Im1hcmdpbi1sZWZ0OjZweDtiYWNrZ3JvdW5kOiMyYjU3OWE7Y29sb3I6d2hpdGU7Ym9yZGVyLXJhZGl1czo0cHg7cGFkZGluZzoycHggOHB4O2ZvbnQtc2l6ZTouNjhyZW07Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7Zm9udC1mYW1pbHk6aW5oZXJpdDtkaXNwbGF5OmlubGluZS1mbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6M3B4O3ZlcnRpY2FsLWFsaWduOm1pZGRsZTsiPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS13b3JkIj48L2k+wqBXb3JkPC9idXR0b24+CjwvZGl2PjxkaXYgaWQ9InRwbC1lbnQiIGNsYXNzPSJkb2MtZWRpdG9yIiBjb250ZW50ZWRpdGFibGU9InRydWUiIHN0eWxlPSJtaW4taGVpZ2h0OjgwcHg7Zm9udC1zaXplOi44cmVtO3Jlc2l6ZTp2ZXJ0aWNhbDtvdmVyZmxvdzphdXRvOyI+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXNpemU6Ljc4cmVtO2ZvbnQtd2VpZ2h0OjYwMDttYXJnaW4tYm90dG9tOjRweDtkaXNwbGF5OmJsb2NrOyI+PGkgY2xhc3M9ImZhcyBmYS11c2VycyIgc3R5bGU9ImNvbG9yOiNlNzRjM2MiPjwvaT4gUsOpdW5pb248L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJ0ZS13cmFwIj48ZGl2IGNsYXNzPSJydGUtYmFyIj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdib2xkJykiIHRpdGxlPSJHcmFzIj48Yj5HPC9iPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2l0YWxpYycpIiB0aXRsZT0iSXRhbGlxdWUiPjxpPkk8L2k+PC9idXR0b24+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VW5vcmRlcmVkTGlzdCcpIiB0aXRsZT0iUHVjZXMiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC11bCI+PC9pPjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUxlZnQnKSIgdGl0bGU9IkFsaWduZXIgw6AgZ2F1Y2hlIj48aSBjbGFzcz0iZmFzIGZhLWFsaWduLWxlZnQiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlDZW50ZXInKSIgdGl0bGU9IkNlbnRyZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tY2VudGVyIj48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5RnVsbCcpIiB0aXRsZT0iSnVzdGlmaWVyIj48aSBjbGFzcz0iZmFzIGZhLWFsaWduLWp1c3RpZnkiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icGFzdGVGcm9tV29yZCgpIiB0aXRsZT0iQ29sbGVyIGRlcHVpcyBXb3JkIGVuIGNvbnNlcnZhbnQgbGEgbWlzZSBlbiBwYWdlIiBzdHlsZT0ibWFyZ2luLWxlZnQ6NnB4O2JhY2tncm91bmQ6IzJiNTc5YTtjb2xvcjp3aGl0ZTtib3JkZXItcmFkaXVzOjRweDtwYWRkaW5nOjJweCA4cHg7Zm9udC1zaXplOi42OHJlbTtib3JkZXI6bm9uZTtjdXJzb3I6cG9pbnRlcjtmb250LWZhbWlseTppbmhlcml0O2Rpc3BsYXk6aW5saW5lLWZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDozcHg7dmVydGljYWwtYWxpZ246bWlkZGxlOyI+PGkgY2xhc3M9ImZhcyBmYS1maWxlLXdvcmQiPjwvaT7CoFdvcmQ8L2J1dHRvbj4KPC9kaXY+PGRpdiBpZD0idHBsLXJldSIgY2xhc3M9ImRvYy1lZGl0b3IiIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgc3R5bGU9Im1pbi1oZWlnaHQ6ODBweDtmb250LXNpemU6LjhyZW07cmVzaXplOnZlcnRpY2FsO292ZXJmbG93OmF1dG87Ij48L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtc2l6ZTouNzhyZW07Zm9udC13ZWlnaHQ6NjAwO21hcmdpbi1ib3R0b206NHB4O2Rpc3BsYXk6YmxvY2s7Ij48aSBjbGFzcz0iZmFzIGZhLWNsaXBib2FyZC1saXN0IiBzdHlsZT0iY29sb3I6IzJjM2U1MCI+PC9pPiBDb25zZWlsIGRlIERpcmVjdGlvbiAoT0RKKTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icnRlLXdyYXAiPjxkaXYgY2xhc3M9InJ0ZS1iYXIiPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2JvbGQnKSIgdGl0bGU9IkdyYXMiPjxiPkc8L2I+PC9idXR0b24+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnaXRhbGljJykiIHRpdGxlPSJJdGFsaXF1ZSI+PGk+STwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRVbm9yZGVyZWRMaXN0JykiIHRpdGxlPSJQdWNlcyI+PGkgY2xhc3M9ImZhcyBmYS1saXN0LXVsIj48L2k+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj48ZGl2IGlkPSJ0cGwtZGlyIiBjbGFzcz0iZG9jLWVkaXRvciIgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBzdHlsZT0ibWluLWhlaWdodDo4MHB4O2ZvbnQtc2l6ZTouOHJlbTtyZXNpemU6dmVydGljYWw7b3ZlcmZsb3c6YXV0bzsiPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC1zaXplOi43OHJlbTtmb250LXdlaWdodDo2MDA7bWFyZ2luLWJvdHRvbTo0cHg7ZGlzcGxheTpibG9jazsiPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1ncmFkdWF0ZSIgc3R5bGU9ImNvbG9yOiMyN2FlNjAiPjwvaT4gU3Vpdmkgw4lsw6h2ZTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icnRlLXdyYXAiPjxkaXYgY2xhc3M9InJ0ZS1iYXIiPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2JvbGQnKSIgdGl0bGU9IkdyYXMiPjxiPkc8L2I+PC9idXR0b24+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnaXRhbGljJykiIHRpdGxlPSJJdGFsaXF1ZSI+PGk+STwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRVbm9yZGVyZWRMaXN0JykiIHRpdGxlPSJQdWNlcyI+PGkgY2xhc3M9ImZhcyBmYS1saXN0LXVsIj48L2k+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj48ZGl2IGlkPSJ0cGwtc3VpdmkiIGNsYXNzPSJkb2MtZWRpdG9yIiBjb250ZW50ZWRpdGFibGU9InRydWUiIHN0eWxlPSJtaW4taGVpZ2h0OjgwcHg7Zm9udC1zaXplOi44cmVtO3Jlc2l6ZTp2ZXJ0aWNhbDtvdmVyZmxvdzphdXRvOyI+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tYWNjZW50IiBvbmNsaWNrPSJzYXZlVGVtcGxhdGVzKCkiIHN0eWxlPSJhbGlnbi1zZWxmOmZsZXgtc3RhcnQ7Ij48aSBjbGFzcz0iZmFzIGZhLXNhdmUiPjwvaT4gRW5yZWdpc3RyZXIgbGVzIG1vZMOobGVzPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8IS0tIEV4cG9ydCAvIEltcG9ydCAtLT4KICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWNhcmQiIHN0eWxlPSJtYXJnaW4tdG9wOjE2cHg7Ym9yZGVyOjJweCBzb2xpZCAjZTBlN2ZmO2JhY2tncm91bmQ6I2Y4ZmFmZiI+CiAgICAgICAgICAgIDxoMz48aSBjbGFzcz0iZmFzIGZhLWRhdGFiYXNlIiBzdHlsZT0iY29sb3I6IzNCODJGNiI+PC9pPiBTYXV2ZWdhcmRlICYgUmVzdGF1cmF0aW9uIGRlcyBkb25uw6llczwvaDM+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I2YwZmRmNDtib3JkZXI6MnB4IHNvbGlkICMyMkM1NUU7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6MTRweCAxOHB4O21hcmdpbi1ib3R0b206MTZweCI+CiAgICAgICAgICAgICAgICA8aDQgc3R5bGU9Im1hcmdpbjowIDAgOHB4O2ZvbnQtc2l6ZTouOXJlbTtjb2xvcjojMTY2NTM0Ij48aSBjbGFzcz0iZmFzIGZhLWhkZCI+PC9pPiBTYXV2ZWdhcmRlIGZpY2hpZXIgbG9jYWw8L2g0PgogICAgICAgICAgICAgICAgPHAgc3R5bGU9ImZvbnQtc2l6ZTouNzhyZW07Y29sb3I6IzU1NTttYXJnaW46MCAwIDEwcHgiPkNob2lzaXNzZXogdW4gZG9zc2llciBzdXIgdm90cmUgZGlzcXVlLCByw6lzZWF1LCBvdSBjbG91ZCAoT25lRHJpdmUsIEdvb2dsZSBEcml2ZeKApikuIExlIGZpY2hpZXIgPHN0cm9uZz5jYWRpcl9kYXRhLmpzb248L3N0cm9uZz4geSBzZXJhIGNyw6nDqSBldCBtaXMgw6Agam91ciBhdXRvbWF0aXF1ZW1lbnQuPC9wPgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDoxMHB4O2FsaWduLWl0ZW1zOmNlbnRlcjtmbGV4LXdyYXA6d3JhcCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ3aW5kb3cucGlja1NhdmVGaWxlKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOiMxNjY1MzQ7Y29sb3I6I2ZmZjtmb250LXNpemU6LjhyZW0iPjxpIGNsYXNzPSJmYXMgZmEtZm9sZGVyLW9wZW4iPjwvaT4gQ2hvaXNpciB1biBkb3NzaWVyPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJ3aW5kb3cucGlja0V4aXN0aW5nRmlsZSgpIiBzdHlsZT0iYmFja2dyb3VuZDojMjU2M0VCO2NvbG9yOiNmZmY7Zm9udC1zaXplOi44cmVtIj48aSBjbGFzcz0iZmFzIGZhLWZpbGUtaW1wb3J0Ij48L2k+IE91dnJpciB1biBmaWNoaWVyIGV4aXN0YW50PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iZmlsZS11bmxpbmstYnRuIiBvbmNsaWNrPSJ3aW5kb3cudW5saW5rRmlsZSgpIiBzdHlsZT0iYmFja2dyb3VuZDojZGMyNjI2O2NvbG9yOiNmZmY7Zm9udC1zaXplOi43NXJlbTtkaXNwbGF5Om5vbmUiPjxpIGNsYXNzPSJmYXMgZmEtdW5saW5rIj48L2k+IETDqWxpZXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0iZmlsZS1saW5rLXN0YXR1cyIgc3R5bGU9ImZvbnQtc2l6ZTouOHJlbSI+PGkgY2xhc3M9ImZhcyBmYS11bmxpbmsiIHN0eWxlPSJjb2xvcjojYWFhIj48L2k+IDxzcGFuIHN0eWxlPSJjb2xvcjojOTk5Ij5BdWN1biBmaWNoaWVyIGxpw6k8L3NwYW4+PC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8cCBzdHlsZT0iZm9udC1zaXplOi42OHJlbTtjb2xvcjojODg4O21hcmdpbjo4cHggMCAwIj48aSBjbGFzcz0iZmFzIGZhLWluZm8tY2lyY2xlIj48L2k+IExlIGZpY2hpZXIgcGV1dCDDqnRyZSBzdXIgdm90cmUgZGlzcXVlLCB1biByw6lzZWF1IHBhcnRhZ8OpLCBHb29nbGUgRHJpdmUsIE9uZURyaXZlLCBldGMuIEZvbmN0aW9ubmUgYXZlYyBDaHJvbWUgZXQgRWRnZS48L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8cCBzdHlsZT0iZm9udC1zaXplOi44cmVtO2NvbG9yOiM2NjY7bWFyZ2luOjAgMCAxMnB4Ij5Wb3VzIHBvdXZleiBhdXNzaSBleHBvcnRlci9pbXBvcnRlciBtYW51ZWxsZW1lbnQgOjwvcD4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDoxMHB4O2ZsZXgtd3JhcDp3cmFwO2FsaWduLWl0ZW1zOmNlbnRlciI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWFjY2VudCIgb25jbGljaz0id2luZG93LmV4cG9ydERhdGEoKSIgc3R5bGU9ImJhY2tncm91bmQ6IzNCODJGNiI+PGkgY2xhc3M9ImZhcyBmYS1kb3dubG9hZCI+PC9pPiBFeHBvcnRlciBKU09OPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4iIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbXBvcnQtZmlsZScpLmNsaWNrKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOiMyMkM1NUU7Y29sb3I6I2ZmZiI+PGkgY2xhc3M9ImZhcyBmYS11cGxvYWQiPjwvaT4gSW1wb3J0ZXIgSlNPTjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImZpbGUiIGlkPSJpbXBvcnQtZmlsZSIgYWNjZXB0PSIuanNvbiIgc3R5bGU9ImRpc3BsYXk6bm9uZSIgb25jaGFuZ2U9ImltcG9ydERhdGEodGhpcykiPgogICAgICAgICAgICAgICAgPHNwYW4gaWQ9Imxhc3QtZXhwb3J0IiBzdHlsZT0iZm9udC1zaXplOi43cmVtO2NvbG9yOiM5OTkiPjwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxwIHN0eWxlPSJmb250LXNpemU6LjdyZW07Y29sb3I6Izk5OTttYXJnaW46OHB4IDAgMCI+PGkgY2xhc3M9ImZhcyBmYS1pbmZvLWNpcmNsZSI+PC9pPiBMZSBmaWNoaWVyIGV4cG9ydMOpIHBldXQgw6p0cmUgc3RvY2vDqSBzdXIgdW4gcsOpc2VhdSwgdW5lIGNsw6kgVVNCLCB1biBGVFAsIEdvb2dsZSBEcml2ZSwgZXRjLjwvcD4KICAgICAgICA8L2Rpdj4KCiAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9Im1lbnUyIiBjbGFzcz0ic2VjdGlvbiI+CiAgICAgICAgPGRpdiBpZD0idG9kby10b2RheS16b25lIiBjbGFzcz0idG9kby10b2RheS16b25lIj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6I2QzNTQwMDsgbWFyZ2luLWJvdHRvbToxMHB4OyBkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjEwcHg7Ij48aSBjbGFzcz0iZmFzIGZhLWJlbGwgZmEtbGciPjwvaT4gQUdFTkRBIERVIEpPVVIgKEdsaXNzZXotbGVzIGRhbnMgdm9zIGNvbG9ubmVzKTwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJ0b2RvLXRvZGF5LWxpc3QiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InRvZG8tZ3JpZCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvZG8tYm94IHRvZG8tdXJnZW50Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvZG8taGVhZGVyIj48aDMgc3R5bGU9ImNvbG9yOnZhcigtLWhpZ2hsaWdodCkiPlVSR0VOVDwvaDM+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2RvLWlucHV0LWdyb3VwIj48aW5wdXQgdHlwZT0idGV4dCIgaWQ9InRvZG8taW5wdXQtdXJnZW50IiBwbGFjZWhvbGRlcj0iQWpvdXRlci4uLiIgb25rZXlwcmVzcz0iaGFuZGxlRW50ZXIoZXZlbnQsICd1cmdlbnQnKSI+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kYW5nZXIgYnRuLXNtIiBvbmNsaWNrPSJhZGRUb2RvKCd1cmdlbnQnKSI+KzwvYnV0dG9uPjwvZGl2PgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJ0b2RvLWxpc3QiIGlkPSJsaXN0LXVyZ2VudCIgb25kcm9wPSJkcm9wKGV2ZW50LCAndXJnZW50JykiIG9uZHJhZ292ZXI9ImFsbG93RHJvcChldmVudCkiPjwvdWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2RvLWJveCB0b2RvLXBsYW4iPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9kby1oZWFkZXIiPjxoMyBzdHlsZT0iY29sb3I6dmFyKC0tcHJpbWFyeSkiPkEgUExBTklGSUVSPC9oMz48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvZG8taW5wdXQtZ3JvdXAiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0idG9kby1pbnB1dC1wbGFuIiBwbGFjZWhvbGRlcj0iQWpvdXRlci4uLiIgb25rZXlwcmVzcz0iaGFuZGxlRW50ZXIoZXZlbnQsICdwbGFuJykiPjxidXR0b24gY2xhc3M9ImJ0biBidG4tcHJpbWFyeSBidG4tc20iIG9uY2xpY2s9ImFkZFRvZG8oJ3BsYW4nKSI+KzwvYnV0dG9uPjwvZGl2PgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJ0b2RvLWxpc3QiIGlkPSJsaXN0LXBsYW4iIG9uZHJvcD0iZHJvcChldmVudCwgJ3BsYW4nKSIgb25kcmFnb3Zlcj0iYWxsb3dEcm9wKGV2ZW50KSI+PC91bD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvZG8tYm94IHRvZG8tcG9zc2libGUiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9kby1oZWFkZXIiPjxoMyBzdHlsZT0iY29sb3I6dmFyKC0tc3VjY2VzcykiPlNJIFBPU1NJQkxFPC9oMz48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvZG8taW5wdXQtZ3JvdXAiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0idG9kby1pbnB1dC1wb3NzaWJsZSIgcGxhY2Vob2xkZXI9IkFqb3V0ZXIuLi4iIG9ua2V5cHJlc3M9ImhhbmRsZUVudGVyKGV2ZW50LCAncG9zc2libGUnKSI+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi1zbSIgb25jbGljaz0iYWRkVG9kbygncG9zc2libGUnKSI+KzwvYnV0dG9uPjwvZGl2PgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJ0b2RvLWxpc3QiIGlkPSJsaXN0LXBvc3NpYmxlIiBvbmRyb3A9ImRyb3AoZXZlbnQsICdwb3NzaWJsZScpIiBvbmRyYWdvdmVyPSJhbGxvd0Ryb3AoZXZlbnQpIj48L3VsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9kby1ib3ggdG9kby1kZWxlZ2F0ZSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2RvLWhlYWRlciI+PGgzIHN0eWxlPSJjb2xvcjp2YXIoLS13YXJuaW5nKSI+QSBERUxFR1VFUjwvaDM+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b2RvLWlucHV0LWdyb3VwIj48aW5wdXQgdHlwZT0idGV4dCIgaWQ9InRvZG8taW5wdXQtZGVsZWdhdGUiIHBsYWNlaG9sZGVyPSJBam91dGVyLi4uIiBvbmtleXByZXNzPSJoYW5kbGVFbnRlcihldmVudCwgJ2RlbGVnYXRlJykiPjxidXR0b24gY2xhc3M9ImJ0biBidG4tZGFyayBidG4tc20iIHN0eWxlPSJiYWNrZ3JvdW5kOnZhcigtLXdhcm5pbmcpO2JvcmRlcjpub25lIiBvbmNsaWNrPSJhZGRUb2RvKCdkZWxlZ2F0ZScpIj4rPC9idXR0b24+PC9kaXY+CiAgICAgICAgICAgICAgICA8dWwgY2xhc3M9InRvZG8tbGlzdCIgaWQ9Imxpc3QtZGVsZWdhdGUiIG9uZHJvcD0iZHJvcChldmVudCwgJ2RlbGVnYXRlJykiIG9uZHJhZ292ZXI9ImFsbG93RHJvcChldmVudCkiPjwvdWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBpZD0ibWVudTMiIGNsYXNzPSJzZWN0aW9uIj4KICAgICAgICA8IS0tIENhbGVuZHJpZXIgVW5pZmnDqSBWMTIuMTMgLS0+CiAgICAgICAgPGRpdiBjbGFzcz0idWNhbC1oZWFkZXIiPgogICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InVjYWxQcmV2KCkiIGNsYXNzPSJ1Y2FsLW5hdi1idG4iPjxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1sZWZ0Ij48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxoMyBjbGFzcz0idWNhbC10aXRsZSIgaWQ9InVjYWwtdGl0bGUiPuKAlDwvaDM+CiAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0idWNhbE5leHQoKSIgY2xhc3M9InVjYWwtbmF2LWJ0biI+PGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLXJpZ2h0Ij48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0idWNhbFRvZGF5KCkiIGNsYXNzPSJ1Y2FsLWJ0bi10b2RheSI+QXVqb3VyZCdodWk8L2J1dHRvbj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDoxIj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idWNhbC1sZWdlbmQiIGlkPSJ1Y2FsLWxlZ2VuZCI+PC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0ib3BlblVjYWxBZGRNb2RhbCgpIiBjbGFzcz0idWNhbC1idG4tYWRkIj48aSBjbGFzcz0iZmFzIGZhLXBsdXMiPjwvaT4gQWpvdXRlcjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InVjYWxSZWZyZXNoKCkiIGNsYXNzPSJ1Y2FsLWJ0bi1yZWZyZXNoIiB0aXRsZT0iU3luY2hyb25pc2VyIEdvb2dsZSBBZ2VuZGEiPjxpIGNsYXNzPSJmYXMgZmEtc3luYyI+PC9pPjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgaWQ9InVjYWwtYm9keSI+PC9kaXY+CgogICAgICAgIDwhLS0gTW9kYWwgQWpvdXQvRWRpdCDDqXbDqW5lbWVudCAtLT4KICAgICAgICA8ZGl2IGlkPSJ1Y2FsTW9kYWwiIGNsYXNzPSJtLW92IiBvbmNsaWNrPSJpZihldmVudC50YXJnZXQ9PT10aGlzKWNsb3NlVWNhbE1vZGFsKCkiIHN0eWxlPSJkaXNwbGF5Om5vbmUiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtLWJveCIgc3R5bGU9IndpZHRoOjQ4MHB4OyI+CiAgICAgICAgICAgICAgICA8aDM+PGkgY2xhc3M9ImZhcyBmYS1jYWxlbmRhci1wbHVzIj48L2k+IDxzcGFuIGlkPSJ1Y2FsLW1vZGFsLXRpdGxlIj5Ob3V2ZWwgw6l2w6luZW1lbnQ8L3NwYW4+PC9oMz4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSJ1Y2FsLWVpZCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBpZD0idWNhbC1lc3JjIj4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSJ1Y2FsLWVjYWxpZCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PGxhYmVsPkRhdGUgKjwvbGFiZWw+PGlucHV0IHR5cGU9ImRhdGUiIGlkPSJ1Y2FsLWRhdGUiIGNsYXNzPSJmb3JtLWNvbnRyb2wiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxsYWJlbD5IZXVyZSBkw6lidXQ8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0aW1lIiBpZD0idWNhbC10aW1lIiBjbGFzcz0iZm9ybS1jb250cm9sIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48bGFiZWw+SGV1cmUgZmluPC9sYWJlbD48aW5wdXQgdHlwZT0idGltZSIgaWQ9InVjYWwtZW5kdGltZSIgY2xhc3M9ImZvcm0tY29udHJvbCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPjxsYWJlbD5JbnRpdHVsw6kgKjwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGlkPSJ1Y2FsLXRhc2siIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHBsYWNlaG9sZGVyPSJFeDogQ29uc2VpbCBkZSBjbGFzc2UgVDMiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCIgc3R5bGU9Im1hcmdpbi1ib3R0b206MTRweCIgaWQ9InVjYWwtZGVzdC13cmFwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+RW5yZWdpc3RyZXIgZGFuczwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo4cHg7ZmxleC13cmFwOndyYXAiIGlkPSJ1Y2FsLWRlc3QtYnRucyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0idWNhbC1kZXN0LW9wdCBhY3RpdmUiIGRhdGEtZGVzdD0ibG9jYWwiPjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0idWNhbC1kZXN0IiB2YWx1ZT0ibG9jYWwiIGNoZWNrZWQ+PGkgY2xhc3M9ImZhcyBmYS1kYXRhYmFzZSIgc3R5bGU9ImNvbG9yOiMzNDk4ZGIiPjwvaT4gQWdlbmRhIGxvY2FsPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJ1Y2FsLWRlc3Qtb3B0IiBkYXRhLWRlc3Q9ImdjYWwiPjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0idWNhbC1kZXN0IiB2YWx1ZT0iZ2NhbCI+PGkgY2xhc3M9ImZhYiBmYS1nb29nbGUiIHN0eWxlPSJjb2xvcjojNDI4NWY0Ij48L2k+IEdvb2dsZSBBZ2VuZGE8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9InVjYWwtZGVzdC1vcHQiIGRhdGEtZGVzdD0ib3V0bG9vayIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+PGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJ1Y2FsLWRlc3QiIHZhbHVlPSJvdXRsb29rIj48aSBjbGFzcz0iZmFiIGZhLW1pY3Jvc29mdCIgc3R5bGU9ImNvbG9yOiMwMDc4ZDQiPjwvaT4gT3V0bG9vazwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0idWNhbC1nY2FsLXRhcmdldCIgY2xhc3M9ImZvcm0tY29udHJvbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjZweDtmb250LXNpemU6Ljc4cmVtOyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+4oCUIENob2lzaXIgdW4gYWdlbmRhIOKAlDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzYXZlLWJhciI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBvbmNsaWNrPSJjbG9zZVVjYWxNb2RhbCgpIiBzdHlsZT0iYmFja2dyb3VuZDojZWVlO2NvbG9yOiM1NTU7bWFyZ2luLXJpZ2h0OjhweDsiPkFubnVsZXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWFjY2VudCIgb25jbGljaz0ic2F2ZVVjYWxFdmVudCgpIj48aSBjbGFzcz0iZmFzIGZhLXNhdmUiPjwvaT4gRW5yZWdpc3RyZXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9Im1lbnU0IiBjbGFzcz0ic2VjdGlvbiI+CiAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1jYXJkIj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6Y2VudGVyOyI+CiAgICAgICAgICAgICAgICA8aDMgc3R5bGU9ImNvbG9yOnZhcigtLXByaW1hcnkpIj5Sw6l1bmlvbiBkZSBEaXJlY3Rpb248L2gzPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWN0aW9uLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi13YXJuaW5nIGJ0bi1zbSIgb25jbGljaz0icmF6UGFnZSgnRElSJykiPjxpIGNsYXNzPSJmYXMgZmEtZXJhc2VyIj48L2k+IFJBWjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4td29yZCBidG4tc20iIG9uY2xpY2s9ImV4cG9ydERvY1dvcmQoJ1BSRVBfRElSJykiPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS13b3JkIj48L2k+IFdvcmQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXNtIiBvbmNsaWNrPSJwcmludEN1cnJlbnRGb3JtKCdQUkVQX0RJUicpIj48aSBjbGFzcz0iZmFzIGZhLXByaW50Ij48L2k+IFBERjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyaWQiIHN0eWxlPSJtYXJnaW4tdG9wOjE1cHg7Ij48ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48bGFiZWw+RGF0ZTwvbGFiZWw+PGlucHV0IHR5cGU9ImRhdGUiIGlkPSJkaXItZGF0ZSIgY2xhc3M9ImZvcm0tY29udHJvbCI+PC9kaXY+PGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PGxhYmVsPlBhcnRpY2lwYW50czwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGlkPSJkaXItcGFydHMiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHBsYWNlaG9sZGVyPSJBZGosIENQRSwgRERGUFQuLi4iPjwvZGl2PjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWZ1bGwiPjxsYWJlbCBzdHlsZT0iY29sb3I6dmFyKC0tcHJpbWFyeSk7IGZvbnQtc2l6ZToxcmVtOyBib3JkZXItYm90dG9tOjJweCBzb2xpZCAjZWVlOyBwYWRkaW5nLWJvdHRvbTo1cHg7IG1hcmdpbi1ib3R0b206MTBweDsiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC11bCI+PC9pPiBQcsOpcGFyYXRpb24gOiBUaMOobWVzICYgU3VqZXRzPC9sYWJlbD48ZGl2IGNsYXNzPSJydGUtd3JhcCI+PGRpdiBjbGFzcz0icnRlLWJhciI+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnYm9sZCcpIiB0aXRsZT0iR3JhcyI+PGI+RzwvYj48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKSIgdGl0bGU9Ikl0YWxpcXVlIj48aT5JPC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VuZGVybGluZScpIiB0aXRsZT0iU291bGlnbsOpIj48dT5TPC91PjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKSIgdGl0bGU9Ikxpc3RlIMOgIHB1Y2VzIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtdWwiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRPcmRlcmVkTGlzdCcpIiB0aXRsZT0iTGlzdGUgbnVtw6lyb3TDqWUiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC1vbCI+PC9pPjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlQ29sb3IodGhpcykiIHRpdGxlPSJDb3VsZXVyIj48aSBjbGFzcz0iZmFzIGZhLXBhbGV0dGUiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUxpbmsodGhpcykiIHRpdGxlPSJMaWVuIj48aSBjbGFzcz0iZmFzIGZhLWxpbmsiPjwvaT48L2J1dHRvbj4KPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRvJykiIHRpdGxlPSJBbm51bGVyIj48aSBjbGFzcz0iZmFzIGZhLXVuZG8iPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdyZWRvJykiIHRpdGxlPSJSZXN0YXVyZXIiPjxpIGNsYXNzPSJmYXMgZmEtcmVkbyI+PC9pPjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUluc2VydExvZ28oKSIgdGl0bGU9Ikluc8OpcmVyIGxlIGxvZ28iPjxpIGNsYXNzPSJmYXMgZmEtc3RhbXAiIHN0eWxlPSJjb2xvcjojZTY3ZTIyIj48L2k+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj48ZGl2IGlkPSJkaXItY29udGVudSIgY2xhc3M9ImRvYy1lZGl0b3IiIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSI+PC9kaXY+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZnVsbCIgc3R5bGU9Im1hcmdpbi10b3A6IDMwcHg7Ij48bGFiZWwgc3R5bGU9ImNvbG9yOnZhcigtLWFjY2VudCk7IGZvbnQtc2l6ZToxcmVtOyBib3JkZXItYm90dG9tOjJweCBzb2xpZCAjZWVlOyBwYWRkaW5nLWJvdHRvbTo1cHg7IG1hcmdpbi1ib3R0b206MTBweDsiPjxpIGNsYXNzPSJmYXMgZmEtcGVuLWFsdCI+PC9pPiBTw6lhbmNlIDogTm90ZXMgJiBEw6ljaXNpb25zPC9sYWJlbD48ZGl2IGNsYXNzPSJydGUtd3JhcCI+PGRpdiBjbGFzcz0icnRlLWJhciI+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnYm9sZCcpIiB0aXRsZT0iR3JhcyI+PGI+RzwvYj48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKSIgdGl0bGU9Ikl0YWxpcXVlIj48aT5JPC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VuZGVybGluZScpIiB0aXRsZT0iU291bGlnbsOpIj48dT5TPC91PjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKSIgdGl0bGU9Ikxpc3RlIMOgIHB1Y2VzIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtdWwiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRPcmRlcmVkTGlzdCcpIiB0aXRsZT0iTGlzdGUgbnVtw6lyb3TDqWUiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC1vbCI+PC9pPjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlQ29sb3IodGhpcykiIHRpdGxlPSJDb3VsZXVyIj48aSBjbGFzcz0iZmFzIGZhLXBhbGV0dGUiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUxpbmsodGhpcykiIHRpdGxlPSJMaWVuIj48aSBjbGFzcz0iZmFzIGZhLWxpbmsiPjwvaT48L2J1dHRvbj4KPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRvJykiIHRpdGxlPSJBbm51bGVyIj48aSBjbGFzcz0iZmFzIGZhLXVuZG8iPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdyZWRvJykiIHRpdGxlPSJSZXN0YXVyZXIiPjxpIGNsYXNzPSJmYXMgZmEtcmVkbyI+PC9pPjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUluc2VydExvZ28oKSIgdGl0bGU9Ikluc8OpcmVyIGxlIGxvZ28iPjxpIGNsYXNzPSJmYXMgZmEtc3RhbXAiIHN0eWxlPSJjb2xvcjojZTY3ZTIyIj48L2k+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj48ZGl2IGlkPSJkaXItbm90ZXMiIGNsYXNzPSJkb2MtZWRpdG9yIG5vdGVzLWVkaXRvciIgY29udGVudGVkaXRhYmxlPSJ0cnVlIj48L2Rpdj48L2Rpdj48L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZnVsbCBhdHRhY2htZW50cy1hcmVhIj4KICAgICAgICAgICAgICAgIDxsYWJlbD48aSBjbGFzcz0iZmFzIGZhLXBhcGVyY2xpcCI+PC9pPiBQacOoY2VzIGpvaW50ZXMgLyBEb2N1bWVudHMgbGnDqXM8L2xhYmVsPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmlsZS13YXJuaW5nIj5MaW1pdGUgY29uc2VpbGzDqWUgOiBmaWNoaWVycyBsw6lnZXJzIG91IGxpZW5zLiBHcm9zIGZpY2hpZXJzID0gcmlzcXVlIGRlIHJhbGVudGlzc2VtZW50LjwvZGl2PgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImZpbGUiIGlkPSJkaXItZmlsZS1pbnB1dCIgY2xhc3M9ImZvcm0tY29udHJvbCIgb25jaGFuZ2U9ImFkZEF0dGFjaG1lbnQoJ2Rpci1hdHRhY2htZW50cycsIHRoaXMpIj4KICAgICAgICAgICAgICAgIDx1bCBpZD0iZGlyLWF0dGFjaG1lbnRzIiBjbGFzcz0iYXR0YWNobWVudC1saXN0Ij48L3VsPgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNhdmUtYmFyIj48YnV0dG9uIGlkPSJidG4tc2F2ZS1kaXIiIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiIG9uY2xpY2s9InNhdmVQcmVwRGlyZWN0aW9uKCkiPjxpIGNsYXNzPSJmYXMgZmEtc2F2ZSIgc3R5bGU9Im1hcmdpbi1yaWdodDo2cHgiPjwvaT5FbnJlZ2lzdHJlciAoSGlzdG9yaXF1ZSk8L2J1dHRvbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9Im1lbnU1IiBjbGFzcz0ic2VjdGlvbiI+CiAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1jYXJkIj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6Y2VudGVyOyI+CiAgICAgICAgICAgICAgICA8aDMgc3R5bGU9ImNvbG9yOnZhcigtLWluZm8pIj5TdWl2aSDDiWzDqHZlIC8gUG9pbnQgQ1BFPC9oMz4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFjdGlvbi1yb3ciPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4tc20iIG9uY2xpY2s9InJhelBhZ2UoJ1NVSVZJJykiPjxpIGNsYXNzPSJmYXMgZmEtZXJhc2VyIj48L2k+IFJBWjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4td29yZCBidG4tc20iIG9uY2xpY2s9ImV4cG9ydERvY1dvcmQoJ1NVSVZJJykiPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS13b3JkIj48L2k+IFdvcmQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXNtIiBvbmNsaWNrPSJwcmludEN1cnJlbnRGb3JtKCdTVUlWSScpIj48aSBjbGFzcz0iZmFzIGZhLXByaW50Ij48L2k+IFBERjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyaWQiIHN0eWxlPSJtYXJnaW4tdG9wOjE1cHg7Ij48ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48bGFiZWw+RGF0ZTwvbGFiZWw+PGlucHV0IHR5cGU9ImRhdGUiIGlkPSJzdWl2aS1kYXRlIiBjbGFzcz0iZm9ybS1jb250cm9sIj48L2Rpdj48ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48bGFiZWw+UGFydGljaXBhbnRzIChDUEUsIFByb2ZzLi4uKTwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGlkPSJzdWl2aS1wYXJ0cyIgY2xhc3M9ImZvcm0tY29udHJvbCI+PC9kaXY+PGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PGxhYmVsPkNsYXNzZXMgQ29uY2VybsOpZXM8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ic3VpdmktY2xhc3NlcyIgY2xhc3M9ImZvcm0tY29udHJvbCI+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZnVsbCI+PGxhYmVsPlNpdHVhdGlvbnMgw6lsw6h2ZXMgYWJvcmTDqWVzIChOb3Rlcyk8L2xhYmVsPjxkaXYgY2xhc3M9InJ0ZS13cmFwIj48ZGl2IGNsYXNzPSJydGUtYmFyIj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdib2xkJykiIHRpdGxlPSJHcmFzIj48Yj5HPC9iPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2l0YWxpYycpIiB0aXRsZT0iSXRhbGlxdWUiPjxpPkk8L2k+PC9idXR0b24+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgndW5kZXJsaW5lJykiIHRpdGxlPSJTb3VsaWduw6kiPjx1PlM8L3U+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VW5vcmRlcmVkTGlzdCcpIiB0aXRsZT0iTGlzdGUgw6AgcHVjZXMiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC11bCI+PC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydE9yZGVyZWRMaXN0JykiIHRpdGxlPSJMaXN0ZSBudW3DqXJvdMOpZSI+PGkgY2xhc3M9ImZhcyBmYS1saXN0LW9sIj48L2k+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJydGVDb2xvcih0aGlzKSIgdGl0bGU9IkNvdWxldXIiPjxpIGNsYXNzPSJmYXMgZmEtcGFsZXR0ZSI+PC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlTGluayh0aGlzKSIgdGl0bGU9IkxpZW4iPjxpIGNsYXNzPSJmYXMgZmEtbGluayI+PC9pPjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VuZG8nKSIgdGl0bGU9IkFubnVsZXIiPjxpIGNsYXNzPSJmYXMgZmEtdW5kbyI+PC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3JlZG8nKSIgdGl0bGU9IlJlc3RhdXJlciI+PGkgY2xhc3M9ImZhcyBmYS1yZWRvIj48L2k+PC9idXR0b24+PHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlSW5zZXJ0TG9nbygpIiB0aXRsZT0iSW5zw6lyZXIgbGUgbG9nbyI+PGkgY2xhc3M9ImZhcyBmYS1zdGFtcCIgc3R5bGU9ImNvbG9yOiNlNjdlMjIiPjwvaT48L2J1dHRvbj4KPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlMZWZ0JykiIHRpdGxlPSJBbGlnbmVyIMOgIGdhdWNoZSI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1sZWZ0Ij48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5Q2VudGVyJykiIHRpdGxlPSJDZW50cmVyIj48aSBjbGFzcz0iZmFzIGZhLWFsaWduLWNlbnRlciI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUZ1bGwnKSIgdGl0bGU9Ikp1c3RpZmllciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1qdXN0aWZ5Ij48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InBhc3RlRnJvbVdvcmQoKSIgdGl0bGU9IkNvbGxlciBkZXB1aXMgV29yZCBlbiBjb25zZXJ2YW50IGxhIG1pc2UgZW4gcGFnZSIgc3R5bGU9Im1hcmdpbi1sZWZ0OjZweDtiYWNrZ3JvdW5kOiMyYjU3OWE7Y29sb3I6d2hpdGU7Ym9yZGVyLXJhZGl1czo0cHg7cGFkZGluZzoycHggOHB4O2ZvbnQtc2l6ZTouNjhyZW07Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7Zm9udC1mYW1pbHk6aW5oZXJpdDtkaXNwbGF5OmlubGluZS1mbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6M3B4O3ZlcnRpY2FsLWFsaWduOm1pZGRsZTsiPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS13b3JkIj48L2k+wqBXb3JkPC9idXR0b24+CjwvZGl2PjxkaXYgaWQ9InN1aXZpLWNvbnRlbnUiIGNsYXNzPSJkb2MtZWRpdG9yIiBjb250ZW50ZWRpdGFibGU9InRydWUiPjwvZGl2PjwvZGl2PjwvZGl2PgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1mdWxsIGF0dGFjaG1lbnRzLWFyZWEiPgogICAgICAgICAgICAgICAgPGxhYmVsPjxpIGNsYXNzPSJmYXMgZmEtcGFwZXJjbGlwIj48L2k+IFBpw6hjZXMgam9pbnRlczwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9InN1aXZpLWZpbGUtaW5wdXQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJhZGRBdHRhY2htZW50KCdzdWl2aS1hdHRhY2htZW50cycsIHRoaXMpIj4KICAgICAgICAgICAgICAgIDx1bCBpZD0ic3VpdmktYXR0YWNobWVudHMiIGNsYXNzPSJhdHRhY2htZW50LWxpc3QiPjwvdWw+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2F2ZS1iYXIiPjxidXR0b24gaWQ9ImJ0bi1zYXZlLXN1aXZpIiBjbGFzcz0iYnRuIGJ0bi1pbmZvIiBvbmNsaWNrPSJzYXZlU3VpdmlFbGV2ZSgpIj48aSBjbGFzcz0iZmFzIGZhLXNhdmUiIHN0eWxlPSJtYXJnaW4tcmlnaHQ6NnB4Ij48L2k+RW5yZWdpc3RyZXIgKEhpc3RvcmlxdWUpPC9idXR0b24+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJtZW51NiIgY2xhc3M9InNlY3Rpb24iPgogICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tY2FyZCI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOmNlbnRlcjsiPgogICAgICAgICAgICAgICAgPGgzIHN0eWxlPSJjb2xvcjp2YXIoLS1hY2NlbnQpIj5TYWlzaXIgdW4gRW50cmV0aWVuPC9oMz4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFjdGlvbi1yb3ciPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4tc20iIG9uY2xpY2s9InJhelBhZ2UoJ0VOVCcpIj48aSBjbGFzcz0iZmFzIGZhLWVyYXNlciI+PC9pPiBSQVo8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXdvcmQgYnRuLXNtIiBvbmNsaWNrPSJleHBvcnREb2NXb3JkKCdFTlQnKSI+PGkgY2xhc3M9ImZhcyBmYS1maWxlLXdvcmQiPjwvaT4gV29yZDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGFyayBidG4tc20iIG9uY2xpY2s9InByaW50Q3VycmVudEZvcm0oJ0VOVCcpIj48aSBjbGFzcz0iZmFzIGZhLXByaW50Ij48L2k+IFBERjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyaWQiIHN0eWxlPSJtYXJnaW4tdG9wOjE1cHg7Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxsYWJlbD5EYXRlPC9sYWJlbD48aW5wdXQgdHlwZT0iZGF0ZSIgaWQ9ImVudC1kYXRlIiBjbGFzcz0iZm9ybS1jb250cm9sIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbD5UeXBlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDo1cHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0iZW50LXR5cGUiIGNsYXNzPSJmb3JtLWNvbnRyb2wiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5FbnRyZXRpZW4gUkggLyBQZXJzb25uZWw8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24+UmVuZGV6LXZvdXMgRmFtaWxsZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5TdWl2aSDDiWzDqHZlPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uPlBhcnRlbmFpcmVzPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uPkluc3BlY3Rpb248L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24+QXV0cmU8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tcHJpbWFyeSBidG4taWNvbiIgb25jbGljaz0iYWRkQ3VzdG9tVHlwZSgnZW50LXR5cGUnKSI+PGkgY2xhc3M9ImZhcyBmYS1wbHVzIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6MTVweDtmbGV4LXdyYXA6d3JhcDsiPgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDoxO21pbi13aWR0aDoyNTBweDtiYWNrZ3JvdW5kOiNmOWY5Zjk7cGFkZGluZzoxNXB4O2JvcmRlci1yYWRpdXM6NXB4O2JvcmRlci1sZWZ0OjNweCBzb2xpZCAjZTY3ZTIyOyI+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1ncmFkdWF0ZSIgc3R5bGU9ImNvbG9yOiNlNjdlMjI7bWFyZ2luLXJpZ2h0OjRweCI+PC9pPiDDiWzDqHZlcyBjb25jZXJuw6lzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJlbnQtc3R1ZGVudHMtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJtdWx0aS1yb3cgZW50LXN0dWRlbnQiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIG5hbWUiIHBsYWNlaG9sZGVyPSJOb20gUHLDqW5vbSI+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kYW5nZXIgYnRuLWljb24iIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPjwvYnV0dG9uPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLXN1Y2Nlc3MiIG9uY2xpY2s9ImFkZE11bHRpUm93KCdlbnQtc3R1ZGVudHMtY29udGFpbmVyJywgJ2VudC1zdHVkZW50JywgJ05vbSDDiWzDqHZlJykiPisgw4lsw6h2ZTwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmbGV4OjE7bWluLXdpZHRoOjI1MHB4O2JhY2tncm91bmQ6I2Y5ZjlmOTtwYWRkaW5nOjE1cHg7Ym9yZGVyLXJhZGl1czo1cHg7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICMyOTgwYjk7Ij4KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGkgY2xhc3M9ImZhcyBmYS1jaGFsa2JvYXJkLXRlYWNoZXIiIHN0eWxlPSJjb2xvcjojMjk4MGI5O21hcmdpbi1yaWdodDo0cHgiPjwvaT4gRW5zZWlnbmFudHMgLyBQZXJzb25uZWxzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJlbnQtdGVhY2hlcnMtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJtdWx0aS1yb3cgZW50LXRlYWNoZXIiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIG5hbWUiIHBsYWNlaG9sZGVyPSJOb20gUHLDqW5vbSI+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kYW5nZXIgYnRuLWljb24iIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPjwvYnV0dG9uPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLXN1Y2Nlc3MiIG9uY2xpY2s9ImFkZE11bHRpUm93KCdlbnQtdGVhY2hlcnMtY29udGFpbmVyJywgJ2VudC10ZWFjaGVyJywgJ05vbSBQZXJzb25uZWwnKSI+KyBQZXJzb25uZWw8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1mdWxsIj48bGFiZWw+T2JqZXQ8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iZW50LW9iamV0IiBjbGFzcz0iZm9ybS1jb250cm9sIj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1mdWxsIj48bGFiZWw+Q29tcHRlIFJlbmR1PC9sYWJlbD48ZGl2IGNsYXNzPSJydGUtd3JhcCI+PGRpdiBjbGFzcz0icnRlLWJhciI+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnYm9sZCcpIiB0aXRsZT0iR3JhcyI+PGI+RzwvYj48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKSIgdGl0bGU9Ikl0YWxpcXVlIj48aT5JPC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VuZGVybGluZScpIiB0aXRsZT0iU291bGlnbsOpIj48dT5TPC91PjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKSIgdGl0bGU9Ikxpc3RlIMOgIHB1Y2VzIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtdWwiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRPcmRlcmVkTGlzdCcpIiB0aXRsZT0iTGlzdGUgbnVtw6lyb3TDqWUiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC1vbCI+PC9pPjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlQ29sb3IodGhpcykiIHRpdGxlPSJDb3VsZXVyIj48aSBjbGFzcz0iZmFzIGZhLXBhbGV0dGUiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUxpbmsodGhpcykiIHRpdGxlPSJMaWVuIj48aSBjbGFzcz0iZmFzIGZhLWxpbmsiPjwvaT48L2J1dHRvbj4KPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRvJykiIHRpdGxlPSJBbm51bGVyIj48aSBjbGFzcz0iZmFzIGZhLXVuZG8iPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdyZWRvJykiIHRpdGxlPSJSZXN0YXVyZXIiPjxpIGNsYXNzPSJmYXMgZmEtcmVkbyI+PC9pPjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUluc2VydExvZ28oKSIgdGl0bGU9Ikluc8OpcmVyIGxlIGxvZ28iPjxpIGNsYXNzPSJmYXMgZmEtc3RhbXAiIHN0eWxlPSJjb2xvcjojZTY3ZTIyIj48L2k+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj48ZGl2IGlkPSJlbnQtY29udGVudSIgY2xhc3M9ImRvYy1lZGl0b3IiIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSI+PC9kaXY+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWZ1bGwgYXR0YWNobWVudHMtYXJlYSI+CiAgICAgICAgICAgICAgICA8bGFiZWw+PGkgY2xhc3M9ImZhcyBmYS1wYXBlcmNsaXAiPjwvaT4gUGnDqGNlcyBqb2ludGVzPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJmaWxlIiBpZD0iZW50LWZpbGUtaW5wdXQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJhZGRBdHRhY2htZW50KCdlbnQtYXR0YWNobWVudHMnLCB0aGlzKSI+CiAgICAgICAgICAgICAgICA8dWwgaWQ9ImVudC1hdHRhY2htZW50cyIgY2xhc3M9ImF0dGFjaG1lbnQtbGlzdCI+PC91bD4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzYXZlLWJhciI+PGJ1dHRvbiBpZD0iYnRuLXNhdmUtZW50IiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBvbmNsaWNrPSJzYXZlRW50cmV0aWVuKCkiPjxpIGNsYXNzPSJmYXMgZmEtc2F2ZSIgc3R5bGU9Im1hcmdpbi1yaWdodDo2cHgiPjwvaT5FbnJlZ2lzdHJlcjwvYnV0dG9uPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBpZD0ibWVudTciIGNsYXNzPSJzZWN0aW9uIj4KICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWNhcmQiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczpjZW50ZXI7Ij4KICAgICAgICAgICAgICAgIDxoMyBzdHlsZT0iY29sb3I6dmFyKC0tc3VjY2VzcykiPlNhaXNpciB1bmUgUsOpdW5pb248L2gzPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWN0aW9uLXJvdyI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi13YXJuaW5nIGJ0bi1zbSIgb25jbGljaz0icmF6UGFnZSgnUkVVJykiPjxpIGNsYXNzPSJmYXMgZmEtZXJhc2VyIj48L2k+IFJBWjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4td29yZCBidG4tc20iIG9uY2xpY2s9ImV4cG9ydERvY1dvcmQoJ1JFVScpIj48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPiBXb3JkPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi1zbSIgb25jbGljaz0icHJpbnRDdXJyZW50Rm9ybSgnUkVVJykiPjxpIGNsYXNzPSJmYXMgZmEtcHJpbnQiPjwvaT4gUERGPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JpZCIgc3R5bGU9Im1hcmdpbi10b3A6MTVweDsiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PGxhYmVsPkRhdGU8L2xhYmVsPjxpbnB1dCB0eXBlPSJkYXRlIiBpZD0icmV1LWRhdGUiIGNsYXNzPSJmb3JtLWNvbnRyb2wiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsPlR5cGUgZGUgcsOpdW5pb248L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjVweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJyZXUtdHlwZSIgY2xhc3M9ImZvcm0tY29udHJvbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uPkNvbnNlaWwgZCdBZG1pbmlzdHJhdGlvbjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5Db25zZWlsIFDDqWRhZ29naXF1ZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5Db21pdMOpIGRlIFBpbG90YWdlIChDT1BJTCk8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24+Q29tbWlzc2lvbiDDiWR1Y2F0aXZlPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uPsOJcXVpcGUgw6lkdWNhdGl2ZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5FU1M8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24+R1BEUzwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5DZWxsdWxlIGRlIHZlaWxsZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5Gb25kIHNvY2lhbDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbj5BdXRyZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi1pY29uIiBvbmNsaWNrPSJhZGRDdXN0b21UeXBlKCdyZXUtdHlwZScpIj48aSBjbGFzcz0iZmFzIGZhLXBsdXMiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDoxNXB4O2ZsZXgtd3JhcDp3cmFwOyI+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmbGV4OjE7bWluLXdpZHRoOjI1MHB4O2JhY2tncm91bmQ6I2Y5ZjlmOTtwYWRkaW5nOjE1cHg7Ym9yZGVyLXJhZGl1czo1cHg7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICNlNjdlMjI7Ij4KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGkgY2xhc3M9ImZhcyBmYS11c2VyLWdyYWR1YXRlIiBzdHlsZT0iY29sb3I6I2U2N2UyMjttYXJnaW4tcmlnaHQ6NHB4Ij48L2k+IMOJbMOodmVzIGNvbmNlcm7DqXM8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InJldS1zdHVkZW50cy1jb250YWluZXIiPjxkaXYgY2xhc3M9Im11bHRpLXJvdyByZXUtc3R1ZGVudCI+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgbmFtZSIgcGxhY2Vob2xkZXI9Ik5vbSBQcsOpbm9tIj48YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRhbmdlciBidG4taWNvbiIgb25jbGljaz0idGhpcy5wYXJlbnRFbGVtZW50LnJlbW92ZSgpIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+PC9idXR0b24+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSBidG4tc3VjY2VzcyIgb25jbGljaz0iYWRkTXVsdGlSb3coJ3JldS1zdHVkZW50cy1jb250YWluZXInLCAncmV1LXN0dWRlbnQnLCAnTm9tIMOJbMOodmUnKSI+KyDDiWzDqHZlPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZsZXg6MTttaW4td2lkdGg6MjUwcHg7YmFja2dyb3VuZDojZjlmOWY5O3BhZGRpbmc6MTVweDtib3JkZXItcmFkaXVzOjVweDtib3JkZXItbGVmdDozcHggc29saWQgIzI5ODBiOTsiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbD48aSBjbGFzcz0iZmFzIGZhLWNoYWxrYm9hcmQtdGVhY2hlciIgc3R5bGU9ImNvbG9yOiMyOTgwYjk7bWFyZ2luLXJpZ2h0OjRweCI+PC9pPiBQYXJ0aWNpcGFudHMgLyBQZXJzb25uZWxzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJyZXUtdGVhY2hlcnMtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJtdWx0aS1yb3cgcmV1LXRlYWNoZXIiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sIG5hbWUiIHBsYWNlaG9sZGVyPSJOb20gUHLDqW5vbSI+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kYW5nZXIgYnRuLWljb24iIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPjwvYnV0dG9uPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tc20gYnRuLXN1Y2Nlc3MiIG9uY2xpY2s9ImFkZE11bHRpUm93KCdyZXUtdGVhY2hlcnMtY29udGFpbmVyJywgJ3JldS10ZWFjaGVyJywgJ05vbSBQZXJzb25uZWwnKSI+KyBQZXJzb25uZWw8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1mdWxsIj48bGFiZWw+T3JkcmUgZHUgam91cjwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGlkPSJyZXUtb2RqIiBjbGFzcz0iZm9ybS1jb250cm9sIj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1mdWxsIj48bGFiZWw+Q29tcHRlLXJlbmR1PC9sYWJlbD48ZGl2IGNsYXNzPSJydGUtd3JhcCI+PGRpdiBjbGFzcz0icnRlLWJhciI+CjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnYm9sZCcpIiB0aXRsZT0iR3JhcyI+PGI+RzwvYj48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKSIgdGl0bGU9Ikl0YWxpcXVlIj48aT5JPC9pPjwvYnV0dG9uPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VuZGVybGluZScpIiB0aXRsZT0iU291bGlnbsOpIj48dT5TPC91PjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKSIgdGl0bGU9Ikxpc3RlIMOgIHB1Y2VzIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtdWwiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRPcmRlcmVkTGlzdCcpIiB0aXRsZT0iTGlzdGUgbnVtw6lyb3TDqWUiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC1vbCI+PC9pPjwvYnV0dG9uPgo8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgo8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlQ29sb3IodGhpcykiIHRpdGxlPSJDb3VsZXVyIj48aSBjbGFzcz0iZmFzIGZhLXBhbGV0dGUiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUxpbmsodGhpcykiIHRpdGxlPSJMaWVuIj48aSBjbGFzcz0iZmFzIGZhLWxpbmsiPjwvaT48L2J1dHRvbj4KPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRvJykiIHRpdGxlPSJBbm51bGVyIj48aSBjbGFzcz0iZmFzIGZhLXVuZG8iPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdyZWRvJykiIHRpdGxlPSJSZXN0YXVyZXIiPjxpIGNsYXNzPSJmYXMgZmEtcmVkbyI+PC9pPjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUluc2VydExvZ28oKSIgdGl0bGU9Ikluc8OpcmVyIGxlIGxvZ28iPjxpIGNsYXNzPSJmYXMgZmEtc3RhbXAiIHN0eWxlPSJjb2xvcjojZTY3ZTIyIj48L2k+PC9idXR0b24+CjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj48ZGl2IGlkPSJyZXUtY29udGVudSIgY2xhc3M9ImRvYy1lZGl0b3IiIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSI+PC9kaXY+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWZ1bGwgYXR0YWNobWVudHMtYXJlYSI+CiAgICAgICAgICAgICAgICA8bGFiZWw+PGkgY2xhc3M9ImZhcyBmYS1wYXBlcmNsaXAiPjwvaT4gUGnDqGNlcyBqb2ludGVzPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJmaWxlIiBpZD0icmV1LWZpbGUtaW5wdXQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJhZGRBdHRhY2htZW50KCdyZXUtYXR0YWNobWVudHMnLCB0aGlzKSI+CiAgICAgICAgICAgICAgICA8dWwgaWQ9InJldS1hdHRhY2htZW50cyIgY2xhc3M9ImF0dGFjaG1lbnQtbGlzdCI+PC91bD4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzYXZlLWJhciI+PGJ1dHRvbiBpZD0iYnRuLXNhdmUtcmV1IiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIiBvbmNsaWNrPSJzYXZlUmV1bmlvbigpIj48aSBjbGFzcz0iZmFzIGZhLXNhdmUiIHN0eWxlPSJtYXJnaW4tcmlnaHQ6NnB4Ij48L2k+RW5yZWdpc3RyZXI8L2J1dHRvbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9Im1lbnU4IiBjbGFzcz0ic2VjdGlvbiI+CiAgICAgICAgPGRpdiBjbGFzcz0iZmlsdGVycy1iYXIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIiBzdHlsZT0iZmxleDoxOyI+PGxhYmVsPlJlY2hlcmNoZSBnbG9iYWxlPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgaWQ9InNlYXJjaC1zdHVkZW50IiBjbGFzcz0iZm9ybS1jb250cm9sIiBwbGFjZWhvbGRlcj0iVGFwZXIgdW4gbm9tLi4uIiBkYXRhLXN0dWRlbnQtYWM9IjEiIG9ua2V5dXA9InJlbmRlckhpc3RvcnkoKSI+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiIHN0eWxlPSJmbGV4OjE7Ij48bGFiZWw+VHlwZTwvbGFiZWw+PHNlbGVjdCBpZD0ic2VhcmNoLXR5cGUiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIG9uY2hhbmdlPSJyZW5kZXJIaXN0b3J5KCkiPjxvcHRpb24gdmFsdWU9IkFMTCI+VG91dDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IkVOVCI+RW50cmV0aWVuczwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IlJFVSI+UsOpdW5pb25zPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iRElSIj5EaXJlY3Rpb248L29wdGlvbj48b3B0aW9uIHZhbHVlPSJTVUlWSSI+U3Vpdmk8L29wdGlvbj48L3NlbGVjdD48L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi1zbSIgb25jbGljaz0icHJpbnRBbGxIaXN0b3J5KCkiPlRvdXQgSW1wcmltZXI8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8dGFibGUgY2xhc3M9ImRhdGEtdGFibGUiIGlkPSJoaXN0b3J5LXRhYmxlIj48dGhlYWQ+PHRyPjx0aD5EYXRlPC90aD48dGg+VHlwZTwvdGg+PHRoPlN1amV0IC8gUGVyc29ubmVzPC90aD48dGg+QWN0aW9uczwvdGg+PC90cj48L3RoZWFkPjx0Ym9keT48L3Rib2R5PjwvdGFibGU+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJtZW51OSIgY2xhc3M9InNlY3Rpb24iPgogICAgICAgIDxoMyBzdHlsZT0ibWFyZ2luLWJvdHRvbToyMHB4OyBjb2xvcjp2YXIoLS1wcmltYXJ5KTsiPjxpIGNsYXNzPSJmYXMgZmEtY2hhcnQtbGluZSI+PC9pPiBQaWxvdGFnZSBHbG9iYWw8L2gzPgogICAgICAgIDxkaXYgY2xhc3M9ImRhc2gta3BpLWdyaWQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCIgc3R5bGU9ImJvcmRlci1ib3R0b20tY29sb3I6dmFyKC0taGlnaGxpZ2h0KSI+PGkgY2xhc3M9ImZhcyBmYS1maXJlIGZhLTJ4IGtwaS1pY29uIiBzdHlsZT0iY29sb3I6dmFyKC0taGlnaGxpZ2h0KSI+PC9pPjxzcGFuIGNsYXNzPSJrcGktbnVtIiBpZD0ia3BpLXRvZG8iPjA8L3NwYW4+PHNwYW4gY2xhc3M9ImtwaS1sYWJlbCI+VXJnZW5jZXM8L3NwYW4+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIiBzdHlsZT0iYm9yZGVyLWJvdHRvbS1jb2xvcjp2YXIoLS1wcmltYXJ5KSI+PGkgY2xhc3M9ImZhcyBmYS1jbGlwYm9hcmQtbGlzdCBmYS0yeCBrcGktaWNvbiIgc3R5bGU9ImNvbG9yOnZhcigtLXByaW1hcnkpIj48L2k+PHNwYW4gY2xhc3M9ImtwaS1udW0iIGlkPSJrcGktZGlyIj4wPC9zcGFuPjxzcGFuIGNsYXNzPSJrcGktbGFiZWwiPkRpcmVjdGlvbjwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQiIHN0eWxlPSJib3JkZXItYm90dG9tLWNvbG9yOnZhcigtLWFjY2VudCkiPjxpIGNsYXNzPSJmYXMgZmEtY29tbWVudHMgZmEtMngga3BpLWljb24iIHN0eWxlPSJjb2xvcjp2YXIoLS1hY2NlbnQpIj48L2k+PHNwYW4gY2xhc3M9ImtwaS1udW0iIGlkPSJrcGktZW50Ij4wPC9zcGFuPjxzcGFuIGNsYXNzPSJrcGktbGFiZWwiPkVudHJldGllbnM8L3NwYW4+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIiBzdHlsZT0iYm9yZGVyLWJvdHRvbS1jb2xvcjp2YXIoLS1zdWNjZXNzKSI+PGkgY2xhc3M9ImZhcyBmYS11c2VycyBmYS0yeCBrcGktaWNvbiIgc3R5bGU9ImNvbG9yOnZhcigtLXN1Y2Nlc3MpIj48L2k+PHNwYW4gY2xhc3M9ImtwaS1udW0iIGlkPSJrcGktcmV1Ij4wPC9zcGFuPjxzcGFuIGNsYXNzPSJrcGktbGFiZWwiPlLDqXVuaW9uczwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQiIHN0eWxlPSJib3JkZXItYm90dG9tLWNvbG9yOnZhcigtLXdhcm5pbmcpIj48aSBjbGFzcz0iZmFzIGZhLWNhbGVuZGFyLWFsdCBmYS0yeCBrcGktaWNvbiIgc3R5bGU9ImNvbG9yOnZhcigtLXdhcm5pbmcpIj48L2k+PHNwYW4gY2xhc3M9ImtwaS1udW0iIGlkPSJrcGktY2FsIj4wPC9zcGFuPjxzcGFuIGNsYXNzPSJrcGktbGFiZWwiPkFnZW5kYTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQiIHN0eWxlPSJib3JkZXItYm90dG9tLWNvbG9yOnZhcigtLWluZm8pIj48aSBjbGFzcz0iZmFzIGZhLXVzZXItZ3JhZHVhdGUgZmEtMngga3BpLWljb24iIHN0eWxlPSJjb2xvcjp2YXIoLS1pbmZvKSI+PC9pPjxzcGFuIGNsYXNzPSJrcGktbnVtIiBpZD0ia3BpLXN1aXZpIj4wPC9zcGFuPjxzcGFuIGNsYXNzPSJrcGktbGFiZWwiPlN1aXZpPC9zcGFuPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0cy1ncmlkIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY29udGFpbmVyIj48aDM+UsOpcGFydGl0aW9uIEFjdGl2aXTDqTwvaDM+PGNhbnZhcyBpZD0iY2hhcnRUeXBlcyI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8aDM+VG9wIDUgw4lsw6h2ZXMgKEhpc3RvcmlxdWUpPC9oMz4KICAgICAgICAgICAgICAgIDx1bCBpZD0idG9wLXN0dWRlbnRzLWxpc3QiIGNsYXNzPSJ0b3Atc3R1ZGVudHMtbGlzdCIgc3R5bGU9Im1hcmdpbi10b3A6MjBweDsiPjwvdWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNvbnRhaW5lciIgc3R5bGU9IndpZHRoOjEwMCU7IGhlaWdodDozMDBweDsiPjxoMz7DiXZvbHV0aW9uICg2IG1vaXMpPC9oMz48Y2FudmFzIGlkPSJjaGFydE1vbnRobHkiPjwvY2FudmFzPjwvZGl2PgogICAgPC9kaXY+CgoKPCEtLSDilZDilZDilZAgRVZFTkVNRU5UUyAobWVudTEwKSDilZDilZDilZAgLS0+CjxkaXYgaWQ9Im1lbnUxMCIgY2xhc3M9InNlY3Rpb24iPgogICAgPGRpdiBjbGFzcz0iZXYtaGVhZGVyIj4KICAgICAgICA8aDI+PGkgY2xhc3M9ImZhcyBmYS1jYWxlbmRhci1jaGVjayI+PC9pPiBBY3Rpdml0w6lzIHDDqWRhZ29naXF1ZXM8L2gyPgogICAgICAgIDxidXR0b24gY2xhc3M9ImFjdGlvbi1idG4iIHN0eWxlPSJiYWNrZ3JvdW5kOnZhcigtLWhlYWRlcik7Y29sb3I6I2ZmZjtwYWRkaW5nOjEwcHggMjBweDtmb250LXNpemU6Ljk1cmVtO2ZvbnQtd2VpZ2h0OjcwMDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7Ym94LXNoYWRvdzowIDNweCAxMHB4IHJnYmEoNDQsNjIsODAsLjMpO3RyYW5zaXRpb246dHJhbnNmb3JtIC4xNXMsYm94LXNoYWRvdyAuMTVzOyIgb25tb3VzZW92ZXI9InRoaXMuc3R5bGUudHJhbnNmb3JtPSd0cmFuc2xhdGVZKC0ycHgpJzt0aGlzLnN0eWxlLmJveFNoYWRvdz0nMCA1cHggMTVweCByZ2JhKDQ0LDYyLDgwLC40KSciIG9ubW91c2VvdXQ9InRoaXMuc3R5bGUudHJhbnNmb3JtPSdub25lJzt0aGlzLnN0eWxlLmJveFNoYWRvdz0nMCAzcHggMTBweCByZ2JhKDQ0LDYyLDgwLC4zKSciIG9uY2xpY2s9Im9wZW5Fdk1vZGFsKCkiPjxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPiBOb3V2ZWwgw6l2w6luZW1lbnQ8L2J1dHRvbj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iZXYtdG9wIj4KICAgICAgICA8ZGl2IGNsYXNzPSJldi1rcGlzIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZXYta3BpIj48ZGl2IGNsYXNzPSJrdiIgaWQ9ImtwaS1ldi10b3QiIHN0eWxlPSJjb2xvcjp2YXIoLS1oZWFkZXIpIj4wPC9kaXY+PGRpdiBjbGFzcz0ia2wiPlRvdGFsPC9kaXY+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImV2LWtwaSI+PGRpdiBjbGFzcz0ia3YiIGlkPSJrcGktZXYtbXNnIiBzdHlsZT0iY29sb3I6IzI3YWU2MCI+MDwvZGl2PjxkaXYgY2xhc3M9ImtsIj5Nc2cgUGFyZW50czwvZGl2PjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJldi1maWx0ZXJzIj4KICAgICAgICAKICAgICAgICAKICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImV2LXNlYXJjaCIgcGxhY2Vob2xkZXI9IlJlY2hlcmNoZXLigKYiIG9uaW5wdXQ9InJlbmRlckV2ZW50cygpIiBzdHlsZT0iZmxleDoxO21pbi13aWR0aDoxMjBweDttYXgtd2lkdGg6MjYwcHgiPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJldi1ncmlkIiBpZD0iZXYtZ3JpZCI+PC9kaXY+CjwvZGl2PgoKPCEtLSBNT0RBTCBFVkVORU1FTlQgLS0+CjxkaXYgaWQ9ImV2TW9kIiBjbGFzcz0ibS1vdiIgc3R5bGU9ImxlZnQ6MjgwcHgiIG9uY2xpY2s9ImlmKGV2ZW50LnRhcmdldD09PXRoaXMpY2xvc2VFdk1vZGFsKCkiPgogICAgPGRpdiBjbGFzcz0ibS1ib3giIHN0eWxlPSJ3aWR0aDpjYWxjKDEwMHZ3IC0gMjgwcHgpO21heC13aWR0aDpjYWxjKDEwMHZ3IC0gMjgwcHgpO2hlaWdodDoxMDB2aDttYXgtaGVpZ2h0OjEwMHZoO2JvcmRlci1yYWRpdXM6MDtwYWRkaW5nOjIwcHggMjhweDtib3gtc2l6aW5nOmJvcmRlci1ib3g7bWFyZ2luLWxlZnQ6YXV0byI+CiAgICAgICAgPGgzPjxpIGNsYXNzPSJmYXMgZmEtY2FsZW5kYXItY2hlY2siPjwvaT4gPHNwYW4gaWQ9ImV2LW10Ij5Ob3V2ZWwgw6l2w6luZW1lbnQ8L3NwYW4+PC9oMz4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBpZD0iZXYtZWlkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4Ij48bGFiZWw+SW50aXR1bMOpICo8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iZXYtbmFtZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgcGxhY2Vob2xkZXI9IkV4OiBKb3VybsOpZSBwb3J0ZXMgb3V2ZXJ0ZXMiPjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im0tcm93Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PGxhYmVsPkTDqWJ1dDwvbGFiZWw+PGlucHV0IHR5cGU9ImRhdGUiIGlkPSJldi1zdGFydCIgY2xhc3M9ImZvcm0tY29udHJvbCI+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPjxsYWJlbD7DiWNow6lhbmNlPC9sYWJlbD48aW5wdXQgdHlwZT0iZGF0ZSIgaWQ9ImV2LWRlYWQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im0tcm93Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+PGxhYmVsPlBpbG90ZTwvbGFiZWw+PHNlbGVjdCBpZD0iZXYtcmVzcCIgY2xhc3M9ImZvcm0tY29udHJvbCI+PG9wdGlvbiB2YWx1ZT0iIj4tLSBDaG9pc2lyIC0tPC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiIHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7cGFkZGluZy10b3A6MjJweCI+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iZXYtbXNncGFyZW50cyIgc3R5bGU9IndpZHRoOjE4cHg7aGVpZ2h0OjE4cHg7Y3Vyc29yOnBvaW50ZXIiPjxsYWJlbCBmb3I9ImV2LW1zZ3BhcmVudHMiIHN0eWxlPSJtYXJnaW46MDtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6Ljg1cmVtIj5NZXNzYWdlIGVudm95w6kgYXV4IHBhcmVudHM8L2xhYmVsPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPjxsYWJlbD5DbGFzc2VzIGNvbmNlcm7DqWVzPC9sYWJlbD4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo4cHg7YWxpZ24taXRlbXM6Y2VudGVyIj4KICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9ImV2LWNsYXNzZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgc3R5bGU9ImZsZXg6MSI+PG9wdGlvbiB2YWx1ZT0iIj4tLSBDaG9pc2lyIG91IHNhaXNpciAtLTwvb3B0aW9uPjwvc2VsZWN0PgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJtYiIgc3R5bGU9ImJhY2tncm91bmQ6IzU1NTtjb2xvcjojZmZmO3BhZGRpbmc6NnB4IDEwcHg7Zm9udC1zaXplOi43NXJlbSIgb25jbGljaz0id2luZG93LmFkZEV2Q2xhc3NlKCkiPjxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0iZXYtY2xhc3Nlcy1saXN0IiBzdHlsZT0iZGlzcGxheTpmbGV4O2ZsZXgtd3JhcDp3cmFwO2dhcDo0cHg7bWFyZ2luLXRvcDo2cHgiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPjxsYWJlbD5NZXNzYWdlIMOgIGFkcmVzc2VyIGF1eCBwYXJlbnRzPC9sYWJlbD4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icnRlLXdyYXAiPjxkaXYgY2xhc3M9InJ0ZS1iYXIiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdib2xkJykiIHRpdGxlPSJHcmFzIj48Yj5HPC9iPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKSIgdGl0bGU9Ikl0YWxpcXVlIj48aT5JPC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRlcmxpbmUnKSIgdGl0bGU9IlNvdWxpZ27DqSI+PHU+UzwvdT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKSIgdGl0bGU9IlB1Y2VzIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtdWwiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0T3JkZXJlZExpc3QnKSIgdGl0bGU9Ikxpc3RlIG51bcOpcm90w6llIj48aSBjbGFzcz0iZmFzIGZhLWxpc3Qtb2wiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlQ29sb3IodGhpcykiIHRpdGxlPSJDb3VsZXVyIj48aSBjbGFzcz0iZmFzIGZhLXBhbGV0dGUiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJydGVMaW5rKHRoaXMpIiB0aXRsZT0iTGllbiI+PGkgY2xhc3M9ImZhcyBmYS1saW5rIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCd1bmRvJykiIHRpdGxlPSJBbm51bGVyIj48aSBjbGFzcz0iZmFzIGZhLXVuZG8iPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgncmVkbycpIiB0aXRsZT0iUmVzdGF1cmVyIj48aSBjbGFzcz0iZmFzIGZhLXJlZG8iPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlMZWZ0JykiIHRpdGxlPSJBbGlnbmVyIMOgIGdhdWNoZSI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1sZWZ0Ij48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5Q2VudGVyJykiIHRpdGxlPSJDZW50cmVyIj48aSBjbGFzcz0iZmFzIGZhLWFsaWduLWNlbnRlciI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUZ1bGwnKSIgdGl0bGU9Ikp1c3RpZmllciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1qdXN0aWZ5Ij48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InBhc3RlRnJvbVdvcmQoKSIgdGl0bGU9IkNvbGxlciBkZXB1aXMgV29yZCBlbiBjb25zZXJ2YW50IGxhIG1pc2UgZW4gcGFnZSIgc3R5bGU9Im1hcmdpbi1sZWZ0OjZweDtiYWNrZ3JvdW5kOiMyYjU3OWE7Y29sb3I6d2hpdGU7Ym9yZGVyLXJhZGl1czo0cHg7cGFkZGluZzoycHggOHB4O2ZvbnQtc2l6ZTouNjhyZW07Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7Zm9udC1mYW1pbHk6aW5oZXJpdDtkaXNwbGF5OmlubGluZS1mbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6M3B4O3ZlcnRpY2FsLWFsaWduOm1pZGRsZTsiPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS13b3JkIj48L2k+wqBXb3JkPC9idXR0b24+CjwvZGl2PjxkaXYgY2xhc3M9InJ0ZS1ib2R5IiBpZD0iZXYtZGVzYyIgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBzdHlsZT0ibWluLWhlaWdodDoxMjBweDtib3JkZXI6MnB4IHNvbGlkICNlMGUwZTA7Ym9yZGVyLXJhZGl1czowIDAgOHB4IDhweDtwYWRkaW5nOjEwcHgiPjwvZGl2PjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPjxsYWJlbD7DiXRpcXVldHRlcyAodmlyZ3VsZXMpPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImV2LXRhZ3MiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHBsYWNlaG9sZGVyPSJKUE8sIGNvbW11bmljYXRpb24sIG9yaWVudGF0aW9uIj48L2Rpdj4KICAgICAgICAKICAgICAgICA8ZGl2IGNsYXNzPSJtLWFjdHMiPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtYiBtYi1kZWwiIGlkPSJldi1kZWwtYnRuIiBzdHlsZT0iZGlzcGxheTpub25lIiBvbmNsaWNrPSJ3aW5kb3cuZGVsRXZGcm9tTW9kYWwoKSI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPiBTdXBwcmltZXI8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibWIgbWItYyIgb25jbGljaz0id2luZG93LmNsb3NlRXZNb2RhbCgpIj5Bbm51bGVyPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1iIG1iLW9rIiBvbmNsaWNrPSJ3aW5kb3cuc2F2ZUV2ZW50KCkiPjxpIGNsYXNzPSJmYXMgZmEtY2hlY2siPjwvaT4gRW5yZWdpc3RyZXI8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2Pgo8L2Rpdj4KCjwhLS0g4pWQ4pWQ4pWQIEdBTlRUIC8gUFJPQ0VEVVJFUyAobWVudTExKSDilZDilZDilZAgLS0+CjxkaXYgaWQ9Im1lbnUxMSIgY2xhc3M9InNlY3Rpb24iPgogICAgPGRpdiBjbGFzcz0iZ3QtYmFyIj4KICAgICAgICA8aDI+PGkgY2xhc3M9ImZhcyBmYS1zdHJlYW0iPjwvaT4gw4ljaMOpYW5jZXM8L2gyPgogICAgICAgIDxkaXYgY2xhc3M9Imd0LWJhci1idG5zIj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3QtYnRuLWFkZCIgb25jbGljaz0id2luZG93Lm9wZW5HdE1vZGFsKCkiPjxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPiDDiWNow6lhbmNlPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Imd0LWJ0bi1zZWMiIG9uY2xpY2s9IndpbmRvdy5wcmludEdhbnR0KCkiPjxpIGNsYXNzPSJmYXMgZmEtcHJpbnQiPjwvaT4gSW1wcmltZXI8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgCiAgICA8ZGl2IGNsYXNzPSJndC1uYXYiPgogICAgICAgIDxidXR0b24gb25jbGljaz0id2luZG93Lmd0UHJldigpIiB0aXRsZT0iUHLDqWPDqWRlbnQiPjxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1sZWZ0Ij48L2k+PC9idXR0b24+CiAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTouNzZyZW07Zm9udC13ZWlnaHQ6NjAwO21pbi13aWR0aDoxNTBweDt0ZXh0LWFsaWduOmNlbnRlciIgaWQ9Imd0LXBlciI+PC9zcGFuPgogICAgICAgIDxidXR0b24gb25jbGljaz0id2luZG93Lmd0TmV4dCgpIiB0aXRsZT0iU3VpdmFudCI+PGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLXJpZ2h0Ij48L2k+PC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3aW5kb3cuZ3RZZWFyKCkiPkFubsOpZTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gb25jbGljaz0id2luZG93Lmd0VG9kYXkoKSI+QXVqLjwvYnV0dG9uPgogICAgICAgIDxzZWxlY3QgaWQ9Imd0LWZjIiBvbmNoYW5nZT0id2luZG93LnJlbmRlckdhbnR0KCkiIHN0eWxlPSJtYXJnaW4tbGVmdDphdXRvIj48b3B0aW9uIHZhbHVlPSJBTEwiPlRvdXRlcyBjYXTDqWdvcmllczwvb3B0aW9uPjwvc2VsZWN0PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJndC13cmFwIiBzdHlsZT0ibWF4LWhlaWdodDpjYWxjKDEwMHZoIC0gMjYwcHgpO292ZXJmbG93LXk6YXV0byI+CiAgICAgICAgPHRhYmxlIGNsYXNzPSJndCIgaWQ9Imd0LXRibCI+PC90YWJsZT4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iZ3QtbGVnIj4KICAgICAgICA8c3Bhbj48aSBzdHlsZT0iYmFja2dyb3VuZDojNWRhZGUyIj48L2k+UmVudHLDqWU8L3NwYW4+CiAgICAgICAgPHNwYW4+PGkgc3R5bGU9ImJhY2tncm91bmQ6IzJlODZjMSI+PC9pPkV4YW1lbnM8L3NwYW4+CiAgICAgICAgPHNwYW4+PGkgc3R5bGU9ImJhY2tncm91bmQ6IzFhNTI3NiI+PC9pPk9yaWVudGF0aW9uPC9zcGFuPgogICAgICAgIDxzcGFuPjxpIHN0eWxlPSJiYWNrZ3JvdW5kOiMyNDcxYTMiPjwvaT5Db25zZWlsczwvc3Bhbj4KICAgICAgICA8c3Bhbj48aSBzdHlsZT0iYmFja2dyb3VuZDojOGU0NGFkIj48L2k+UMOpZGFnb2dpcXVlPC9zcGFuPgogICAgICAgIDxzcGFuPjxpIHN0eWxlPSJiYWNrZ3JvdW5kOiMxNDhmNzciPjwvaT5BZG1pbjwvc3Bhbj4KICAgICAgICA8c3Bhbj48aSBzdHlsZT0iYmFja2dyb3VuZDojYzAzOTJiIj48L2k+Ukg8L3NwYW4+CiAgICAgICAgPHNwYW4+PGkgc3R5bGU9ImJhY2tncm91bmQ6IzViNmQ1YiI+PC9pPkF1dHJlPC9zcGFuPgogICAgICAgIDxzcGFuPjxpIHN0eWxlPSJiYWNrZ3JvdW5kOnJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoNDVkZWcsI2YwZjBmMCwjZjBmMGYwIDJweCwjZThlOGU4IDJweCwjZThlOGU4IDRweCk7Ym9yZGVyOjFweCBzb2xpZCAjY2NjIj48L2k+VmFjYW5jZXM8L3NwYW4+CiAgICAgICAgPHNwYW4+PGkgc3R5bGU9ImJhY2tncm91bmQ6I2QzNTQwMCI+PC9pPlNlbS4gY291cmFudGU8L3NwYW4+CiAgICA8L2Rpdj4KPC9kaXY+Cgo8IS0tIE1PREFMIEdBTlRUIC0tPgo8ZGl2IGlkPSJndE1vZCIgY2xhc3M9Im0tb3YiIG9uY2xpY2s9ImlmKGV2ZW50LnRhcmdldD09PXRoaXMpY2xvc2VHdE1vZGFsKCkiPgogICAgPGRpdiBjbGFzcz0ibS1ib3giIHN0eWxlPSJ3aWR0aDo1MDBweDsiPgogICAgICAgIDxoMz48aSBjbGFzcz0iZmFzIGZhLXN0cmVhbSI+PC9pPiA8c3BhbiBpZD0iZ3QtbXQiPk5vdXZlbGxlIMOpY2jDqWFuY2U8L3NwYW4+PC9oMz4KICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBpZD0iZ3QtZWlkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4Ij48bGFiZWw+SW50aXR1bMOpICo8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iZ3QtbmFtZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgcGxhY2Vob2xkZXI9IkNvbnNlaWxzIGRlIGNsYXNzZSBUMiI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibS1yb3ciPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48bGFiZWw+Q29kZTwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGlkPSJndC1jb2RlIiBjbGFzcz0iZm9ybS1jb250cm9sIiBwbGFjZWhvbGRlcj0iQSA0IiBtYXhsZW5ndGg9IjYiPjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj48bGFiZWw+Q2F0w6lnb3JpZTwvbGFiZWw+CiAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJndC1jYXQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFkbWluaXN0cmF0aWYiPkFkbWluaXN0cmF0aWY8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSLDiWzDqHZlcyBCRVAiPsOJbMOodmVzIEJFUDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkNvbmNlcnRhdGlvbnMiPkNvbmNlcnRhdGlvbnM8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJEaXNwb3NpdGlmcyBQw6lkYWdvZ2lxdWVzIj5EaXNwb3NpdGlmcyBQw6lkYWdvZ2lxdWVzPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iU3VpdmkgZGVzIMOpbMOodmVzIj5TdWl2aSBkZXMgw6lsw6h2ZXM8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJJbnRlcnZlbmFudHMiPkludGVydmVuYW50czwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Ik51bcOpcmlxdWUiPk51bcOpcmlxdWU8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJPcmllbnRhdGlvbiI+T3JpZW50YXRpb248L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJQcm9qZXRzIj5Qcm9qZXRzPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iUG9ydGVzIE91dmVydGVzIj5Qb3J0ZXMgT3V2ZXJ0ZXM8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJSZXNzb3VyY2VzIEh1bWFpbmVzIj5SZXNzb3VyY2VzIEh1bWFpbmVzPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iU8OpY3VyaXTDqSI+U8OpY3VyaXTDqTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkF1dHJlIj5BdXRyZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im0tcm93IiBzdHlsZT0iYWxpZ24taXRlbXM6ZmxleC1lbmQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIiBzdHlsZT0ibWF4LXdpZHRoOjEyMHB4Ij48bGFiZWw+U2VtLiBkw6lidXQgKElTTyk8L2xhYmVsPjxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJndC13cyIgY2xhc3M9ImZvcm0tY29udHJvbCIgbWluPSIxIiBtYXg9IjUzIiBzdHlsZT0id2lkdGg6MTAwcHg7dGV4dC1hbGlnbjpjZW50ZXIiPjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIiBzdHlsZT0ibWF4LXdpZHRoOjEyMHB4Ij48bGFiZWw+U2VtLiBmaW4gKElTTyk8L2xhYmVsPjxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJndC13ZSIgY2xhc3M9ImZvcm0tY29udHJvbCIgbWluPSIxIiBtYXg9IjUzIiBzdHlsZT0id2lkdGg6MTAwcHg7dGV4dC1hbGlnbjpjZW50ZXIiPjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIiBzdHlsZT0iZmxleDoxIj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4Ij48bGFiZWw+UmVzcG9uc2FibGU8L2xhYmVsPjxzZWxlY3QgaWQ9Imd0LXJlc3AiIGNsYXNzPSJmb3JtLWNvbnRyb2wiPjxvcHRpb24gdmFsdWU9IiI+LS0gQ2hvaXNpciAtLTwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPjxsYWJlbD5Ob3RlczwvbGFiZWw+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJ0ZS13cmFwIj48ZGl2IGNsYXNzPSJydGUtYmFyIj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnYm9sZCcpIiB0aXRsZT0iR3JhcyI+PGI+RzwvYj48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnaXRhbGljJykiIHRpdGxlPSJJdGFsaXF1ZSI+PGk+STwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgndW5kZXJsaW5lJykiIHRpdGxlPSJTb3VsaWduw6kiPjx1PlM8L3U+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRVbm9yZGVyZWRMaXN0JykiIHRpdGxlPSJQdWNlcyI+PGkgY2xhc3M9ImZhcyBmYS1saXN0LXVsIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydE9yZGVyZWRMaXN0JykiIHRpdGxlPSJOdW3DqXJvdMOpZSI+PGkgY2xhc3M9ImZhcyBmYS1saXN0LW9sIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUNvbG9yKHRoaXMpIiB0aXRsZT0iQ291bGV1ciI+PGkgY2xhc3M9ImZhcyBmYS1wYWxldHRlIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlTGluayh0aGlzKSIgdGl0bGU9IkxpZW4iPjxpIGNsYXNzPSJmYXMgZmEtbGluayI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgndW5kbycpIiB0aXRsZT0iQW5udWxlciI+PGkgY2xhc3M9ImZhcyBmYS11bmRvIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3JlZG8nKSIgdGl0bGU9IlJlc3RhdXJlciI+PGkgY2xhc3M9ImZhcyBmYS1yZWRvIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj48ZGl2IGNsYXNzPSJydGUtYm9keSIgaWQ9Imd0LW5vdGVzIiBjb250ZW50ZWRpdGFibGU9InRydWUiIHN0eWxlPSJib3JkZXI6MnB4IHNvbGlkICNlMGUwZTA7Ym9yZGVyLXJhZGl1czowIDAgOHB4IDhweDtwYWRkaW5nOjEwcHg7bWluLWhlaWdodDo4MHB4Ij48L2Rpdj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJtLWFjdHMiIHN0eWxlPSJwYWRkaW5nLXRvcDoxMnB4O2JvcmRlci10b3A6MXB4IHNvbGlkICNlZWU7ZGlzcGxheTpmbGV4O2dhcDo4cHg7anVzdGlmeS1jb250ZW50OmZsZXgtZW5kIj4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJtYiBtYi1kZWwiIGlkPSJndC1kZWwtYnRuIiBzdHlsZT0iZGlzcGxheTpub25lIiBvbmNsaWNrPSJ3aW5kb3cuZGVsR3RGcm9tTW9kYWwoKSI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPiBTdXBwcmltZXI8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJtYiBtYi1jIiBvbmNsaWNrPSJ3aW5kb3cuY2xvc2VHdE1vZGFsKCkiPkFubnVsZXI8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJtYiBtYi1vayIgb25jbGljaz0id2luZG93LnNhdmVHdCgpIj48aSBjbGFzcz0iZmFzIGZhLWNoZWNrIj48L2k+IEVucmVnaXN0cmVyPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KPC9kaXY+CiAgICA8IS0tIOKVkOKVkOKVkCBQUk9Dw4lEVVJFUyDilZDilZDilZAgLS0+CiAgICA8ZGl2IGlkPSJtZW51MTIiIGNsYXNzPSJzZWN0aW9uIj4KICAgICAgICA8ZGl2IGNsYXNzPSJldi1oZWFkZXIiIHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO21hcmdpbi1ib3R0b206MTZweCI+CiAgICAgICAgICAgIDxoMiBzdHlsZT0iY29sb3I6dmFyKC0taGVhZGVyKTtmb250LXNpemU6MS4wNXJlbTtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7bWFyZ2luOjAiPjxpIGNsYXNzPSJmYXMgZmEtYm9vayI+PC9pPiBQcm9jw6lkdXJlczwvaDI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImFjdGlvbi1idG4iIHN0eWxlPSJiYWNrZ3JvdW5kOnZhcigtLWhlYWRlcik7Y29sb3I6I2ZmZjtwYWRkaW5nOjEwcHggMjBweDtmb250LXNpemU6Ljk1cmVtO2ZvbnQtd2VpZ2h0OjcwMDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXI7Ym94LXNoYWRvdzowIDNweCAxMHB4IHJnYmEoNDQsNjIsODAsLjMpIiBvbmNsaWNrPSJvcGVuUHJvY01vZGFsKCkiPjxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPiBOb3V2ZWxsZSBwcm9jw6lkdXJlPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icHJvYy1maWx0ZXJzIiBpZD0icHJvYy1maWx0ZXJzIj48L2Rpdj4KICAgICAgICA8ZGl2IGlkPSJwcm9jLXZpZXctYXJlYSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icHJvYy1saXN0IiBpZD0icHJvYy1saXN0Ij48L2Rpdj4KICAgIDwvZGl2PgoKPC9kaXY+PCEtLSAvbWFpbi1jb250ZW50IC0tPgoKPGRpdiBpZD0icHJpbnQtem9uZSIgY2xhc3M9InByaW50LWFyZWEiPjwvZGl2PgoKPHNjcmlwdD4KICAgIGxldCBhcHBEYXRhID0geyAKICAgICAgICBzZXR0aW5nczogeyBzY2hvb2w6ICJMeWPDqWUiLCB1c2VyOiAiUHJvdmlzZXVyIiwgbG9nbzogIiIsIHNpZ25hdHVyZTogIiIsIGN1c3RvbUVudFR5cGVzOiBbXSwgY3VzdG9tUmV1VHlwZXM6IFtdLCB6b25lOiAiQiIgfSwgCiAgICAgICAgZW50cmV0aWVuczogW10sIHJldW5pb25zOiBbXSwgc3VpdmlFbGV2ZXM6IFtdLCAKICAgICAgICB0b2RvOiB7IHVyZ2VudDpbXSwgcGxhbjpbXSwgcG9zc2libGU6W10sIGRlbGVnYXRlOltdIH0sIAogICAgICAgIGNhbGVuZGFyOiBbXSwKICAgICAgICBldmVudHM6IFtdLAogICAgICAgICAgICBwcm9jZWR1cmVzOiBbXSwKICAgICAgICBnYW50dDogW10KICAgIH07CiAgICBsZXQgY2hhcnRJbnN0YW5jZXMgPSB7fTsKICAgIGxldCBjdXJyZW50RWRpdElkID0gbnVsbDsKICAgIGxldCBjdXJyZW50RWRpdFR5cGUgPSBudWxsOyAKCiAgICB3aW5kb3cub25sb2FkID0gKCkgPT4gewogICAgICAgIGluaXRXb3JkUGFzdGUoKTsKICAgICAgICBsb2FkRGF0YSgpOwogICAgICAgIHJlc2V0QWxsRGF0ZXMoKTsKICAgICAgICBpbml0RG9jVGVtcGxhdGVzKCk7CiAgICAgICAgcmVuZGVyVG9kbygpOyBjaGVja0RhaWx5VGFza3MoKTsgdXBkYXRlUHJldmlld3MoKTsgc3dpdGNoTWVudSgnbWVudTInKTsgYXBwbHlTZXBhcmF0b3JzKCk7CiAgICAgICAgbG9hZEN1c3RvbVR5cGVzKCk7CiAgICB9OwoKICAgIGZ1bmN0aW9uIHJlc2V0QWxsRGF0ZXMoKSB7CiAgICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgICAgICBbJ2VudC1kYXRlJywncmV1LWRhdGUnLCdkaXItZGF0ZScsJ3N1aXZpLWRhdGUnLCdjYWwtZGF0ZSddLmZvckVhY2goaWQgPT4geyBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsgaWYoZWwpIGVsLnZhbHVlID0gdG9kYXk7IH0pOwogICAgfQoKICAgIAogICAgLy8g4pWQ4pWQ4pWQIFNBVVZFR0FSREUgRklDSElFUiBMT0NBTCDilZDilZDilZAKICAgIHZhciBfZmlsZUhhbmRsZSA9IG51bGw7CiAgICB2YXIgX2RpckhhbmRsZSA9IG51bGw7CgogICAgZnVuY3Rpb24gc3RvcmVEaXJIYW5kbGUoaGFuZGxlKXsKICAgICAgICBvcGVuSGFuZGxlREIoKS50aGVuKGZ1bmN0aW9uKGRiKXsKICAgICAgICAgICAgdmFyIHR4PWRiLnRyYW5zYWN0aW9uKCdoYW5kbGVzJywncmVhZHdyaXRlJyk7CiAgICAgICAgICAgIHR4Lm9iamVjdFN0b3JlKCdoYW5kbGVzJykucHV0KGhhbmRsZSwnc2F2ZURpcicpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKCl7fSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRTdG9yZWREaXJIYW5kbGUoKXsKICAgICAgICByZXR1cm4gb3BlbkhhbmRsZURCKCkudGhlbihmdW5jdGlvbihkYil7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKXsKICAgICAgICAgICAgICAgIHZhciB0eD1kYi50cmFuc2FjdGlvbignaGFuZGxlcycsJ3JlYWRvbmx5Jyk7CiAgICAgICAgICAgICAgICB2YXIgcnE9dHgub2JqZWN0U3RvcmUoJ2hhbmRsZXMnKS5nZXQoJ3NhdmVEaXInKTsKICAgICAgICAgICAgICAgIHJxLm9uc3VjY2Vzcz1mdW5jdGlvbigpe3Jlc29sdmUocnEucmVzdWx0fHxudWxsKTt9OwogICAgICAgICAgICAgICAgcnEub25lcnJvcj1mdW5jdGlvbigpe3Jlc29sdmUobnVsbCk7fTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oKXtyZXR1cm4gbnVsbDt9KTsKICAgIH0KCiAgICAvLyBJbmRleGVkREIgcG91ciBwZXJzaXN0ZXIgbGUgZmlsZUhhbmRsZSBlbnRyZSBzZXNzaW9ucwogICAgZnVuY3Rpb24gb3BlbkhhbmRsZURCKCl7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUscmVqZWN0KXsKICAgICAgICAgICAgdmFyIHJxPWluZGV4ZWREQi5vcGVuKCdjYWRpcl9oYW5kbGVzJywxKTsKICAgICAgICAgICAgcnEub251cGdyYWRlbmVlZGVkPWZ1bmN0aW9uKGUpe2UudGFyZ2V0LnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZSgnaGFuZGxlcycpO307CiAgICAgICAgICAgIHJxLm9uc3VjY2Vzcz1mdW5jdGlvbihlKXtyZXNvbHZlKGUudGFyZ2V0LnJlc3VsdCk7fTsKICAgICAgICAgICAgcnEub25lcnJvcj1mdW5jdGlvbigpe3JlamVjdCgpO307CiAgICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBzdG9yZUhhbmRsZShoYW5kbGUpewogICAgICAgIG9wZW5IYW5kbGVEQigpLnRoZW4oZnVuY3Rpb24oZGIpewogICAgICAgICAgICB2YXIgdHg9ZGIudHJhbnNhY3Rpb24oJ2hhbmRsZXMnLCdyZWFkd3JpdGUnKTsKICAgICAgICAgICAgdHgub2JqZWN0U3RvcmUoJ2hhbmRsZXMnKS5wdXQoaGFuZGxlLCdzYXZlRmlsZScpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKCl7fSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRTdG9yZWRIYW5kbGUoKXsKICAgICAgICByZXR1cm4gb3BlbkhhbmRsZURCKCkudGhlbihmdW5jdGlvbihkYil7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKXsKICAgICAgICAgICAgICAgIHZhciB0eD1kYi50cmFuc2FjdGlvbignaGFuZGxlcycsJ3JlYWRvbmx5Jyk7CiAgICAgICAgICAgICAgICB2YXIgcnE9dHgub2JqZWN0U3RvcmUoJ2hhbmRsZXMnKS5nZXQoJ3NhdmVGaWxlJyk7CiAgICAgICAgICAgICAgICBycS5vbnN1Y2Nlc3M9ZnVuY3Rpb24oKXtyZXNvbHZlKHJxLnJlc3VsdHx8bnVsbCk7fTsKICAgICAgICAgICAgICAgIHJxLm9uZXJyb3I9ZnVuY3Rpb24oKXtyZXNvbHZlKG51bGwpO307CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKCl7cmV0dXJuIG51bGw7fSk7CiAgICB9CiAgICBmdW5jdGlvbiBjbGVhclN0b3JlZEhhbmRsZSgpewogICAgICAgIG9wZW5IYW5kbGVEQigpLnRoZW4oZnVuY3Rpb24oZGIpewogICAgICAgICAgICB2YXIgdHg9ZGIudHJhbnNhY3Rpb24oJ2hhbmRsZXMnLCdyZWFkd3JpdGUnKTsKICAgICAgICAgICAgdHgub2JqZWN0U3RvcmUoJ2hhbmRsZXMnKS5kZWxldGUoJ3NhdmVGaWxlJyk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oKXt9KTsKICAgIH0KCiAgICAvLyBDaG9pc2lyIHVuIGZpY2hpZXIgZGUgc2F1dmVnYXJkZQogICAgYXN5bmMgZnVuY3Rpb24gcGlja1NhdmVGaWxlKCl7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAvLyBDaG9pc2lyIHVuIGRvc3NpZXIKICAgICAgICAgICAgdmFyIGRpckhhbmRsZT1hd2FpdCB3aW5kb3cuc2hvd0RpcmVjdG9yeVBpY2tlcih7bW9kZToncmVhZHdyaXRlJ30pOwogICAgICAgICAgICAvLyBDcsOpZXIgb3Ugb3V2cmlyIGxlIGZpY2hpZXIgZGFucyBjZSBkb3NzaWVyCiAgICAgICAgICAgIHZhciBmaWxlSGFuZGxlPWF3YWl0IGRpckhhbmRsZS5nZXRGaWxlSGFuZGxlKCdjYWRpcl9kYXRhLmpzb24nLHtjcmVhdGU6dHJ1ZX0pOwogICAgICAgICAgICBfZmlsZUhhbmRsZT1maWxlSGFuZGxlOwogICAgICAgICAgICBfZGlySGFuZGxlPWRpckhhbmRsZTsKICAgICAgICAgICAgc3RvcmVIYW5kbGUoZmlsZUhhbmRsZSk7CiAgICAgICAgICAgIHN0b3JlRGlySGFuZGxlKGRpckhhbmRsZSk7CiAgICAgICAgICAgIGF3YWl0IHdyaXRlVG9GaWxlKCk7CiAgICAgICAgICAgIHVwZGF0ZUZpbGVVSSgpOwogICAgICAgIH1jYXRjaChlKXsKICAgICAgICAgICAgaWYoZS5uYW1lIT09J0Fib3J0RXJyb3InKSBhbGVydCgnRXJyZXVyIDogJytlLm1lc3NhZ2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBBdXNzaSBwZXJtZXR0cmUgZGUgY2hvaXNpciB1biBmaWNoaWVyIGV4aXN0YW50CiAgICBhc3luYyBmdW5jdGlvbiBwaWNrRXhpc3RpbmdGaWxlKCl7CiAgICAgICAgdHJ5ewogICAgICAgICAgICB2YXIgaGFuZGxlcz1hd2FpdCB3aW5kb3cuc2hvd09wZW5GaWxlUGlja2VyKHsKICAgICAgICAgICAgICAgIHR5cGVzOlt7ZGVzY3JpcHRpb246J0pTT04nLGFjY2VwdDp7J2FwcGxpY2F0aW9uL2pzb24nOlsnLmpzb24nXX19XQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGhhbmRsZT1oYW5kbGVzWzBdOwogICAgICAgICAgICBfZmlsZUhhbmRsZT1oYW5kbGU7CiAgICAgICAgICAgIHN0b3JlSGFuZGxlKGhhbmRsZSk7CiAgICAgICAgICAgIC8vIENoYXJnZXIgbGVzIGRvbm7DqWVzIGRlcHVpcyBsZSBmaWNoaWVyCiAgICAgICAgICAgIHZhciBsb2FkZWQ9YXdhaXQgbG9hZEZyb21GaWxlKCk7CiAgICAgICAgICAgIHVwZGF0ZUZpbGVVSSgpOwogICAgICAgICAgICBpZihsb2FkZWQpe2xvY2F0aW9uLnJlbG9hZCgpO30KICAgICAgICB9Y2F0Y2goZSl7CiAgICAgICAgICAgIGlmKGUubmFtZSE9PSdBYm9ydEVycm9yJykgYWxlcnQoJ0VycmV1ciA6ICcrZS5tZXNzYWdlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gw4ljcmlyZSBkYW5zIGxlIGZpY2hpZXIgY2hvaXNpCiAgICBhc3luYyBmdW5jdGlvbiB3cml0ZVRvRmlsZSgpewogICAgICAgIGlmKCFfZmlsZUhhbmRsZSlyZXR1cm47CiAgICAgICAgdHJ5ewogICAgICAgICAgICB2YXIgd3JpdGFibGU9YXdhaXQgX2ZpbGVIYW5kbGUuY3JlYXRlV3JpdGFibGUoKTsKICAgICAgICAgICAgYXdhaXQgd3JpdGFibGUud3JpdGUoSlNPTi5zdHJpbmdpZnkoYXBwRGF0YSxudWxsLDIpKTsKICAgICAgICAgICAgYXdhaXQgd3JpdGFibGUuY2xvc2UoKTsKICAgICAgICB9Y2F0Y2goZSl7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybignw4ljcml0dXJlIGZpY2hpZXIgw6ljaG91w6llOicsZSk7CiAgICAgICAgICAgIC8vIFNpIHBlcm1pc3Npb24gcmVmdXPDqWUsIHRlbnRlciBkZSByZWRlbWFuZGVyCiAgICAgICAgICAgIGlmKGUubmFtZT09PSdOb3RBbGxvd2VkRXJyb3InKXsKICAgICAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgICAgICB2YXIgcGVybT1hd2FpdCBfZmlsZUhhbmRsZS5yZXF1ZXN0UGVybWlzc2lvbih7bW9kZToncmVhZHdyaXRlJ30pOwogICAgICAgICAgICAgICAgICAgIGlmKHBlcm09PT0nZ3JhbnRlZCcpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdzI9YXdhaXQgX2ZpbGVIYW5kbGUuY3JlYXRlV3JpdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdzIud3JpdGUoSlNPTi5zdHJpbmdpZnkoYXBwRGF0YSxudWxsLDIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdzIuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9Y2F0Y2goZTIpe2NvbnNvbGUud2FybignUGVybWlzc2lvbiByZWZ1c8OpZTonLGUyKTt9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gQ2hhcmdlciBkZXB1aXMgbGUgZmljaGllcgogICAgYXN5bmMgZnVuY3Rpb24gbG9hZEZyb21GaWxlKCl7CiAgICAgICAgaWYoIV9maWxlSGFuZGxlKXJldHVybiBmYWxzZTsKICAgICAgICB0cnl7CiAgICAgICAgICAgIHZhciBwZXJtPWF3YWl0IF9maWxlSGFuZGxlLnF1ZXJ5UGVybWlzc2lvbih7bW9kZToncmVhZHdyaXRlJ30pOwogICAgICAgICAgICBpZihwZXJtIT09J2dyYW50ZWQnKXsKICAgICAgICAgICAgICAgIHBlcm09YXdhaXQgX2ZpbGVIYW5kbGUucmVxdWVzdFBlcm1pc3Npb24oe21vZGU6J3JlYWR3cml0ZSd9KTsKICAgICAgICAgICAgICAgIGlmKHBlcm0hPT0nZ3JhbnRlZCcpcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBmaWxlPWF3YWl0IF9maWxlSGFuZGxlLmdldEZpbGUoKTsKICAgICAgICAgICAgdmFyIHRleHQ9YXdhaXQgZmlsZS50ZXh0KCk7CiAgICAgICAgICAgIHZhciBkYXRhPUpTT04ucGFyc2UodGV4dCk7CiAgICAgICAgICAgIGFwcERhdGE9ZGF0YTsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BlcmRpcl9waWxvdGVfdjEwJyxKU09OLnN0cmluZ2lmeShhcHBEYXRhKSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH1jYXRjaChlKXsKICAgICAgICAgICAgY29uc29sZS53YXJuKCdMZWN0dXJlIGZpY2hpZXIgw6ljaG91w6llOicsZSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gRMOpbGllciBsZSBmaWNoaWVyCiAgICBmdW5jdGlvbiB1bmxpbmtGaWxlKCl7CiAgICAgICAgaWYoY29uZmlybSgnRMOpbGllciBsZSBkb3NzaWVyIGRlIHNhdXZlZ2FyZGUgP1xuTGVzIGRvbm7DqWVzIHJlc3Rlcm9udCBkYW5zIGxlIG5hdmlnYXRldXIuJykpewogICAgICAgICAgICBfZmlsZUhhbmRsZT1udWxsOwogICAgICAgICAgICBfZGlySGFuZGxlPW51bGw7CiAgICAgICAgICAgIGNsZWFyU3RvcmVkSGFuZGxlKCk7CiAgICAgICAgICAgIG9wZW5IYW5kbGVEQigpLnRoZW4oZnVuY3Rpb24oZGIpe3ZhciB0eD1kYi50cmFuc2FjdGlvbignaGFuZGxlcycsJ3JlYWR3cml0ZScpO3R4Lm9iamVjdFN0b3JlKCdoYW5kbGVzJykuZGVsZXRlKCdzYXZlRGlyJyk7fSkuY2F0Y2goZnVuY3Rpb24oKXt9KTsKICAgICAgICAgICAgdXBkYXRlRmlsZVVJKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIE1pc2Ugw6Agam91ciBkZSBsJ2FmZmljaGFnZQogICAgZnVuY3Rpb24gdXBkYXRlRmlsZVVJKCl7CiAgICAgICAgdmFyIGVsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLWxpbmstc3RhdHVzJyk7CiAgICAgICAgdmFyIGJ0bj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS11bmxpbmstYnRuJyk7CiAgICAgICAgaWYoIWVsKXJldHVybjsKICAgICAgICBpZihfZmlsZUhhbmRsZSl7CiAgICAgICAgICAgIHZhciBkaXJOYW1lPV9kaXJIYW5kbGU/X2RpckhhbmRsZS5uYW1lKycvJzonJzsKICAgICAgICAgICAgZWwuaW5uZXJIVE1MPSc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSIgc3R5bGU9ImNvbG9yOiMyMkM1NUUiPjwvaT4gPHN0cm9uZz4nK2Rpck5hbWUrX2ZpbGVIYW5kbGUubmFtZSsnPC9zdHJvbmc+IDxzcGFuIHN0eWxlPSJjb2xvcjojMjJDNTVFO2ZvbnQtc2l6ZTouN3JlbSI+KHNhdXZlZ2FyZGUgYXV0b21hdGlxdWUpPC9zcGFuPic7CiAgICAgICAgICAgIGlmKGJ0bilidG4uc3R5bGUuZGlzcGxheT0naW5saW5lLWZsZXgnOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBlbC5pbm5lckhUTUw9JzxpIGNsYXNzPSJmYXMgZmEtdW5saW5rIiBzdHlsZT0iY29sb3I6I2FhYSI+PC9pPiA8c3BhbiBzdHlsZT0iY29sb3I6Izk5OSI+QXVjdW4gZG9zc2llciBzw6lsZWN0aW9ubsOpPC9zcGFuPic7CiAgICAgICAgICAgIGlmKGJ0bilidG4uc3R5bGUuZGlzcGxheT0nbm9uZSc7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFJlc3RhdXJlciBsZSBoYW5kbGUgYXUgZMOpbWFycmFnZQogICAgYXN5bmMgZnVuY3Rpb24gcmVzdG9yZUZpbGVIYW5kbGUoKXsKICAgICAgICBpZighd2luZG93LnNob3dEaXJlY3RvcnlQaWNrZXImJiF3aW5kb3cuc2hvd1NhdmVGaWxlUGlja2VyKXJldHVybjsKICAgICAgICB2YXIgZGg9YXdhaXQgZ2V0U3RvcmVkRGlySGFuZGxlKCk7CiAgICAgICAgaWYoZGgpX2RpckhhbmRsZT1kaDsKICAgICAgICB2YXIgaGFuZGxlPWF3YWl0IGdldFN0b3JlZEhhbmRsZSgpOwogICAgICAgIGlmKGhhbmRsZSl7CiAgICAgICAgICAgIF9maWxlSGFuZGxlPWhhbmRsZTsKICAgICAgICAgICAgdXBkYXRlRmlsZVVJKCk7CiAgICAgICAgICAgIC8vIFRlbnRlciBkZSBjaGFyZ2VyIGxlcyBkb25uw6llcyBkdSBmaWNoaWVyIChwbHVzIHLDqWNlbnRlcyA/KQogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICB2YXIgcGVybT1hd2FpdCBoYW5kbGUucXVlcnlQZXJtaXNzaW9uKHttb2RlOidyZWFkd3JpdGUnfSk7CiAgICAgICAgICAgICAgICBpZihwZXJtPT09J2dyYW50ZWQnKXsKICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZT1hd2FpdCBoYW5kbGUuZ2V0RmlsZSgpOwogICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0PWF3YWl0IGZpbGUudGV4dCgpOwogICAgICAgICAgICAgICAgICAgIHZhciBmaWxlRGF0YT1KU09OLnBhcnNlKHRleHQpOwogICAgICAgICAgICAgICAgICAgIC8vIENvbXBhcmVyIGxlcyB0aW1lc3RhbXBzIHBvdXIgcHJlbmRyZSBsZSBwbHVzIHLDqWNlbnQKICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZU1vZD1maWxlLmxhc3RNb2RpZmllZHx8MDsKICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxTdHI9bG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BlcmRpcl9waWxvdGVfdjEwJyk7CiAgICAgICAgICAgICAgICAgICAgaWYobG9jYWxTdHIpewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTaSBsZSBmaWNoaWVyIGVzdCBwbHVzIHLDqWNlbnQsIGNoYXJnZXIgZGVwdWlzIGxlIGZpY2hpZXIKICAgICAgICAgICAgICAgICAgICAgICAgYXBwRGF0YT1maWxlRGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BlcmRpcl9waWxvdGVfdjEwJyxKU09OLnN0cmluZ2lmeShhcHBEYXRhKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Y2F0Y2goZSl7Y29uc29sZS5sb2coJ1Jlc3RhdXJhdGlvbiBhdXRvOiBlbiBhdHRlbnRlIGRlIHBlcm1pc3Npb24gdXRpbGlzYXRldXInKTt9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNhdmVEYXRhKCl7CiAgICAgICAgdHJ5e2xvY2FsU3RvcmFnZS5zZXRJdGVtKCdwZXJkaXJfcGlsb3RlX3YxMCcsSlNPTi5zdHJpbmdpZnkoYXBwRGF0YSkpO2lmKF9maWxlSGFuZGxlKXdyaXRlVG9GaWxlKCk7fWNhdGNoKGUpe2NvbnNvbGUuZXJyb3IoJ3NhdmVEYXRhOicsZSk7fQogICAgICAgIHRyeXt2YXIgbXNnPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLXNhdmUtbXNnJyk7aWYobXNnKXttc2cuc3R5bGUuZGlzcGxheT0nZmxleCc7c2V0VGltZW91dChmdW5jdGlvbigpe21zZy5zdHlsZS5kaXNwbGF5PSdub25lJzt9LDEwMDApO319Y2F0Y2goZTIpe30KICAgIH0KICAgIAogICAgZnVuY3Rpb24gbG9hZERhdGEoKSB7IAogICAgICAgIGNvbnN0IGQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGVyZGlyX3BpbG90ZV92MTAnKTsgCiAgICAgICAgLy8gTWlncmF0aW9uIGRlcHVpcyB2OS45IHNpIG7DqWNlc3NhaXJlCiAgICAgICAgY29uc3Qgb2xkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BlcmRpcl9waWxvdGVfdjknKTsKICAgICAgICBpZihkKSB7CiAgICAgICAgICAgIGFwcERhdGEgPSBKU09OLnBhcnNlKGQpOyAKICAgICAgICB9IGVsc2UgaWYgKG9sZCkgewogICAgICAgICAgICBhcHBEYXRhID0gSlNPTi5wYXJzZShvbGQpOwogICAgICAgICAgICBzYXZlRGF0YSgpOyAvLyBTYXZlIGFzIG5ldyB2ZXJzaW9uCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEluaXQgc3RydWN0dXJlcyBpZiBtaXNzaW5nCiAgICAgICAgaWYoIWFwcERhdGEudG9kbykgYXBwRGF0YS50b2RvID0geyB1cmdlbnQ6W10sIHBsYW46W10sIHBvc3NpYmxlOltdLCBkZWxlZ2F0ZTpbXSB9OwogICAgICAgIGlmKCFhcHBEYXRhLnNldHRpbmdzLmN1c3RvbUVudFR5cGVzKSBhcHBEYXRhLnNldHRpbmdzLmN1c3RvbUVudFR5cGVzID0gW107CiAgICAgICAgaWYoIWFwcERhdGEuc2V0dGluZ3MuY3VzdG9tUmV1VHlwZXMpIGFwcERhdGEuc2V0dGluZ3MuY3VzdG9tUmV1VHlwZXMgPSBbXTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRDdXN0b21UeXBlKHNlbGVjdElkKSB7CiAgICAgICAgY29uc3QgbmV3VHlwZSA9IHByb21wdCgiRW50cmV6IGxlIG5vdXZlYXUgdHlwZSA6Iik7CiAgICAgICAgaWYgKG5ld1R5cGUpIHsKICAgICAgICAgICAgY29uc3Qgc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0SWQpOwogICAgICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICAgICAgb3B0LnRleHQgPSBuZXdUeXBlOwogICAgICAgICAgICBzZWwuYWRkKG9wdCwgc2VsW3NlbC5sZW5ndGggLSAxXSk7CiAgICAgICAgICAgIHNlbC52YWx1ZSA9IG5ld1R5cGU7CiAgICAgICAgICAgIGlmKHNlbGVjdElkID09PSAnZW50LXR5cGUnKSBhcHBEYXRhLnNldHRpbmdzLmN1c3RvbUVudFR5cGVzLnB1c2gobmV3VHlwZSk7CiAgICAgICAgICAgIGVsc2UgYXBwRGF0YS5zZXR0aW5ncy5jdXN0b21SZXVUeXBlcy5wdXNoKG5ld1R5cGUpOwogICAgICAgICAgICBzYXZlRGF0YSgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBsb2FkQ3VzdG9tVHlwZXMoKSB7CiAgICAgICAgY29uc3QgZW50U2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC10eXBlJyk7CiAgICAgICAgYXBwRGF0YS5zZXR0aW5ncy5jdXN0b21FbnRUeXBlcy5mb3JFYWNoKHQgPT4geyBpZighQXJyYXkuZnJvbShlbnRTZWwub3B0aW9ucykuc29tZShvID0+IG8udGV4dCA9PT0gdCkpIHsgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7IG9wdC50ZXh0ID0gdDsgZW50U2VsLmFkZChvcHQsIGVudFNlbFtlbnRTZWwubGVuZ3RoLTFdKTsgfSB9KTsKICAgICAgICBjb25zdCByZXVTZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LXR5cGUnKTsKICAgICAgICBhcHBEYXRhLnNldHRpbmdzLmN1c3RvbVJldVR5cGVzLmZvckVhY2godCA9PiB7IGlmKCFBcnJheS5mcm9tKHJldVNlbC5vcHRpb25zKS5zb21lKG8gPT4gby50ZXh0ID09PSB0KSkgeyBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsgb3B0LnRleHQgPSB0OyByZXVTZWwuYWRkKG9wdCwgcmV1U2VsW3JldVNlbC5sZW5ndGgtMV0pOyB9IH0pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzd2l0Y2hNZW51KGlkKSB7CiAgICAgICAgaWYoaWQgPT09ICdtZW51OCcpIHJlc2V0RWRpdE1vZGUoKTsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudS1pdGVtJykuZm9yRWFjaChlbD0+ZWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgIHZhciBtaSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1lbnU9IicraWQrJyJdJyk7CiAgICAgICAgaWYobWkpIG1pLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWN0aW9uJykuZm9yRWFjaChlbD0+ZWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICBjb25zdCB0ID0geydtZW51MSc6J1BhcmFtw6h0cmVzJywnbWVudTInOidUbyBEbyBMaXN0JywnbWVudTMnOidDYWxlbmRyaWVyJywnbWVudTQnOidDb25zZWlsIGRlIERpcmVjdGlvbicsJ21lbnU1JzonU3Vpdmkgw4lsw6h2ZScsJ21lbnU2JzonRW50cmV0aWVucycsJ21lbnU3JzonUsOpdW5pb25zJywnbWVudTgnOidIaXN0b3JpcXVlJywnbWVudTknOidUYWJsZWF1IGRlIEJvcmQnLCdtZW51MTAnOidBY3Rpdml0w6lzIHDDqWRhZ29naXF1ZXMnLCdtZW51MTEnOifDiWNow6lhbmNlcycsJ21lbnUxMic6J1Byb2PDqWR1cmVzJ307CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnQtdGl0bGUnKS5pbm5lclRleHQgPSB0W2lkXSB8fCAnQ0FESVInOwogICAgICAgIGlmKGlkPT09J21lbnUyJykgeyByZW5kZXJUb2RvKCk7IGNoZWNrRGFpbHlUYXNrcygpOyB9CiAgICAgICAgaWYoaWQ9PT0nbWVudTMnKSB7IHJlbmRlclVuaWZpZWRDYWwoKTsKICAgICAgICAvLyBEZWZhdWx0IHRvICdBZ2VuZGFzJyB2aWV3CiAgICAgICAgdHJ5eyBzZXRVY2FsVmlldygnYnljYWwnKTsgfWNhdGNoKGUpe30gfQogICAgICAgIGlmKGlkPT09J21lbnU4JykgcmVuZGVySGlzdG9yeSgpOwogICAgICAgIGlmKGlkPT09J21lbnU5JykgcmVuZGVyRGFzaGJvYXJkKCk7CiAgICAgICAgaWYoaWQ9PT0nbWVudTEnKXtsb2FkU2V0dGluZ3NVSSgpO3VwZGF0ZUZpbGVVSSgpO30KICAgICAgICBpZihpZD09PSdtZW51MTAnKSByZW5kZXJFdmVudHMoKTsKICAgICAgICBpZihpZD09PSdtZW51MTInKXthdXRvUmVzZXREb25lKCk7cmVuZGVyUHJvY2VkdXJlcygpO30KICAgICAgICBpZihpZD09PSdtZW51MTEnKSB7IGF1dG9SZXNldERvbmUoKTsgaWYoIXdpbmRvdy5fZ2FudHRSZWFkeSkgaW5pdEdhbnR0VmlldygpOyBndFRvZGF5KCk7IH0KICAgIH0KCiAgICAKICAgIC8vIOKVkOKVkOKVkCBURU1QTEFURVMgUEFSIETDiUZBVVQg4pWQ4pWQ4pWQCiAgICB2YXIgREVGQVVMVF9URU1QTEFURVMgPSB7CiAgICAgICAgZW50OiAnPHA+PHN0cm9uZz5PYmpldCA6PC9zdHJvbmc+IC4uLjwvcD48cD48c3Ryb25nPsOJY2hhbmdlcyA6PC9zdHJvbmc+PC9wPjx1bD48bGk+Li4uPC9saT48L3VsPjxwPjxzdHJvbmc+RMOpY2lzaW9ucyA6PC9zdHJvbmc+PC9wPjxwPi4uLjwvcD4nLAogICAgICAgIHJldTogJzxwPjxzdHJvbmc+T3JkcmUgZHUgam91ciA6PC9zdHJvbmc+IC4uLjwvcD48cD48c3Ryb25nPkTDqWxpYsOpcmF0aW9ucyA6PC9zdHJvbmc+PC9wPjx1bD48bGk+Li4uPC9saT48L3VsPicsCiAgICAgICAgZGlyOiAnPHA+PHN0cm9uZz5UaMOobWVzIGFib3Jkw6lzIDo8L3N0cm9uZz48L3A+PHVsPjxsaT5Qw6lkYWdvZ2llIDogLi4uPC9saT48bGk+VmllIFNjb2xhaXJlIDogLi4uPC9saT48bGk+U8OpY3VyaXTDqSA6IC4uLjwvbGk+PGxpPkRpdmVycyA6IC4uLjwvbGk+PC91bD4nLAogICAgICAgIHN1aXZpOiAnPHA+PHN0cm9uZz5TaXR1YXRpb25zIMOpbMOodmVzIDo8L3N0cm9uZz48L3A+PHVsPjxsaT5bTk9NIFByw6lub21dIDogLi4uPC9saT48L3VsPicKICAgIH07CgogICAgZnVuY3Rpb24gbG9hZFRlbXBsYXRlc1VJKCkgewogICAgICAgIHZhciB0cGxzID0gYXBwRGF0YS5zZXR0aW5ncy50ZW1wbGF0ZXMgfHwgREVGQVVMVF9URU1QTEFURVM7CiAgICAgICAgdmFyIGVsOwogICAgICAgIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RwbC1lbnQnKTsgaWYgKGVsKSBlbC5pbm5lckhUTUwgPSB0cGxzLmVudCB8fCBERUZBVUxUX1RFTVBMQVRFUy5lbnQ7CiAgICAgICAgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHBsLXJldScpOyBpZiAoZWwpIGVsLmlubmVySFRNTCA9IHRwbHMucmV1IHx8IERFRkFVTFRfVEVNUExBVEVTLnJldTsKICAgICAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cGwtZGlyJyk7IGlmIChlbCkgZWwuaW5uZXJIVE1MID0gdHBscy5kaXIgfHwgREVGQVVMVF9URU1QTEFURVMuZGlyOwogICAgICAgIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RwbC1zdWl2aScpOyBpZiAoZWwpIGVsLmlubmVySFRNTCA9IHRwbHMuc3VpdmkgfHwgREVGQVVMVF9URU1QTEFURVMuc3Vpdmk7CiAgICB9CgogICAgZnVuY3Rpb24gc2F2ZVRlbXBsYXRlcygpIHsKICAgICAgICBpZiAoIWFwcERhdGEuc2V0dGluZ3MpIGFwcERhdGEuc2V0dGluZ3MgPSB7fTsKICAgICAgICBhcHBEYXRhLnNldHRpbmdzLnRlbXBsYXRlcyA9IHsKICAgICAgICAgICAgZW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHBsLWVudCcpLmlubmVySFRNTCwKICAgICAgICAgICAgcmV1OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHBsLXJldScpLmlubmVySFRNTCwKICAgICAgICAgICAgZGlyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHBsLWRpcicpLmlubmVySFRNTCwKICAgICAgICAgICAgc3Vpdmk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cGwtc3VpdmknKS5pbm5lckhUTUwKICAgICAgICB9OwogICAgICAgIHNhdmVEYXRhKCk7CiAgICAgICAgYWxlcnQoJ01vZMOobGVzIGVucmVnaXN0csOpcyAhJyk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGUodHlwZSkgewogICAgICAgIHZhciB0cGxzID0gKGFwcERhdGEuc2V0dGluZ3MgJiYgYXBwRGF0YS5zZXR0aW5ncy50ZW1wbGF0ZXMpID8gYXBwRGF0YS5zZXR0aW5ncy50ZW1wbGF0ZXMgOiBERUZBVUxUX1RFTVBMQVRFUzsKICAgICAgICByZXR1cm4gdHBsc1t0eXBlXSB8fCBERUZBVUxUX1RFTVBMQVRFU1t0eXBlXSB8fCAnJzsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0RG9jVGVtcGxhdGVzKCkgewogICAgICAgIGNvbnN0IGhlYWRlciA9IGA8ZGl2IGNsYXNzPSJuby1wcmludCIgc3R5bGU9Im1hcmdpbi1ib3R0b206MjBweDsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI2VlZTsgcGFkZGluZy1ib3R0b206MTBweDsiPjxzdHJvbmc+JHthcHBEYXRhLnNldHRpbmdzLnNjaG9vbH08L3N0cm9uZz4gfCBEaXJlY3Rpb248L2Rpdj5gOwogICAgICAgIGNvbnN0IGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnQtY29udGVudScpOyBjb25zdCByZXUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LWNvbnRlbnUnKTsKICAgICAgICBjb25zdCBkaXJjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1jb250ZW51Jyk7IGNvbnN0IGRpcm4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLW5vdGVzJyk7CiAgICAgICAgY29uc3Qgc3VpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1aXZpLWNvbnRlbnUnKTsKCiAgICAgICAgaWYoZW50ICYmIGVudC5pbm5lclRleHQudHJpbSgpPT09IiIpIGVudC5pbm5lckhUTUwgPSBoZWFkZXIgKyBnZXRUZW1wbGF0ZSgnZW50Jyk7CiAgICAgICAgaWYocmV1ICYmIHJldS5pbm5lclRleHQudHJpbSgpPT09IiIpIHJldS5pbm5lckhUTUwgPSBoZWFkZXIgKyBnZXRUZW1wbGF0ZSgncmV1Jyk7CiAgICAgICAgaWYoZGlyYyAmJiBkaXJjLmlubmVyVGV4dC50cmltKCk9PT0iIikgZGlyYy5pbm5lckhUTUwgPSBnZXRUZW1wbGF0ZSgnZGlyJyk7CiAgICAgICAgaWYoZGlybiAmJiBkaXJuLmlubmVyVGV4dC50cmltKCk9PT0iIikgZGlybi5pbm5lckhUTUwgPSBgPHA+PGVtPk5vdGVzIGRlIHPDqWFuY2UuLi48L2VtPjwvcD5gOwogICAgICAgIGlmKHN1aSAmJiBzdWkuaW5uZXJUZXh0LnRyaW0oKT09PSIiKSBzdWkuaW5uZXJIVE1MID0gaGVhZGVyICsgZ2V0VGVtcGxhdGUoJ3N1aXZpJyk7CiAgICB9CgogICAgZnVuY3Rpb24gcmF6UGFnZShtb2RlKSB7CiAgICAgICAgaWYoIWNvbmZpcm0oIkVmZmFjZXIgdG91dCBsZSBjb250ZW51IGRlIGNldHRlIHBhZ2UgPyIpKSByZXR1cm47CiAgICAgICAgcmVzZXRFZGl0TW9kZSgpOwogICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgICAgICAgaWYobW9kZSA9PT0gJ0RJUicpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1kYXRlJykudmFsdWUgPSB0b2RheTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1wYXJ0cycpLnZhbHVlID0gIiI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXItY29udGVudScpLmlubmVySFRNTCA9ICIiOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLW5vdGVzJykuaW5uZXJIVE1MID0gIiI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXItYXR0YWNobWVudHMnKS5pbm5lckhUTUwgPSAiIjsgfQogICAgICAgIGVsc2UgaWYgKG1vZGUgPT09ICdTVUlWSScpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1aXZpLWRhdGUnKS52YWx1ZSA9IHRvZGF5OyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktcGFydHMnKS52YWx1ZSA9ICIiOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktY2xhc3NlcycpLnZhbHVlID0gIiI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1jb250ZW51JykuaW5uZXJIVE1MID0gIiI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1hdHRhY2htZW50cycpLmlubmVySFRNTCA9ICIiOyB9CiAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gJ0VOVCcpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC1kYXRlJykudmFsdWUgPSB0b2RheTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC1vYmpldCcpLnZhbHVlID0gIiI7IHJlc2V0TXVsdGkoJ2VudC1zdHVkZW50cy1jb250YWluZXInLCAnZW50LXN0dWRlbnQnLCAnTm9tIMOJbMOodmUnKTsgcmVzZXRNdWx0aSgnZW50LXRlYWNoZXJzLWNvbnRhaW5lcicsICdlbnQtdGVhY2hlcicsICdOb20gUGVyc29ubmVsJyk7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnQtY29udGVudScpLmlubmVySFRNTCA9ICIiOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW50LWF0dGFjaG1lbnRzJykuaW5uZXJIVE1MID0gIiI7IH0KICAgICAgICBlbHNlIGlmIChtb2RlID09PSAnUkVVJykgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LWRhdGUnKS52YWx1ZSA9IHRvZGF5OyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LW9kaicpLnZhbHVlID0gIiI7IHJlc2V0TXVsdGkoJ3JldS1zdHVkZW50cy1jb250YWluZXInLCAncmV1LXN0dWRlbnQnLCAnTm9tIMOJbMOodmUnKTsgcmVzZXRNdWx0aSgncmV1LXRlYWNoZXJzLWNvbnRhaW5lcicsICdyZXUtdGVhY2hlcicsICdOb20gUGVyc29ubmVsJyk7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXUtY29udGVudScpLmlubmVySFRNTCA9ICIiOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LWF0dGFjaG1lbnRzJykuaW5uZXJIVE1MID0gIiI7IH0KICAgICAgICBpbml0RG9jVGVtcGxhdGVzKCk7CiAgICB9CgogICAgLy8gLS0tIFRPRE8gTE9HSUMgKElNUFJPVkVEIFJFT1JERVJJTkcpIC0tLQogICAgbGV0IGRyYWdnZWRJdGVtSWQgPSBudWxsOwogICAgbGV0IHNvdXJjZUNvbHVtbiA9IG51bGw7CiAgICAKICAgIGZ1bmN0aW9uIGFkZFRvZG8odHlwZSkgeyBjb25zdCB0PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGB0b2RvLWlucHV0LSR7dHlwZX1gKS52YWx1ZS50cmltKCk7IGlmKHQpeyBhcHBEYXRhLnRvZG9bdHlwZV0ucHVzaCh7aWQ6RGF0ZS5ub3coKS50b1N0cmluZygpLCB0ZXh0OnQsIGlzRnJvbUFnZW5kYTpmYWxzZX0pOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgdG9kby1pbnB1dC0ke3R5cGV9YCkudmFsdWU9IiI7IHNhdmVEYXRhKCk7IHJlbmRlclRvZG8oKTsgfSB9CiAgICBmdW5jdGlvbiByZW1vdmVUb2RvKHR5cGUsIGlkKSB7IGFwcERhdGEudG9kb1t0eXBlXSA9IGFwcERhdGEudG9kb1t0eXBlXS5maWx0ZXIodCA9PiB0LmlkLnRvU3RyaW5nKCkgIT09IGlkLnRvU3RyaW5nKCkpOyBzYXZlRGF0YSgpOyByZW5kZXJUb2RvKCk7IH0KICAgIGZ1bmN0aW9uIHVwZGF0ZVRvZG9UZXh0KHR5cGUsIGlkLCBuZXdUZXh0KSB7IGNvbnN0IGl0ZW0gPSBhcHBEYXRhLnRvZG9bdHlwZV0uZmluZCh0ID0+IHQuaWQudG9TdHJpbmcoKSA9PT0gaWQudG9TdHJpbmcoKSk7IGlmKGl0ZW0pIHsgaXRlbS50ZXh0ID0gbmV3VGV4dDsgc2F2ZURhdGEoKTsgfSB9CiAgICBmdW5jdGlvbiBoYW5kbGVFbnRlcihlLHQpeyBpZihlLmtleT09PSdFbnRlcicpIGFkZFRvZG8odCk7IH0KICAgIAogICAgZnVuY3Rpb24gZHJhZ1RvZG8oZSwgaWQsIHNvdXJjZUNvbCkgeyAKICAgICAgICBkcmFnZ2VkSXRlbUlkID0gaWQudG9TdHJpbmcoKTsgCiAgICAgICAgc291cmNlQ29sdW1uID0gc291cmNlQ29sOyAKICAgICAgICBlLmRhdGFUcmFuc2Zlci5zZXREYXRhKCJ0ZXh0L3BsYWluIiwgaWQpOyAKICAgICAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gIm1vdmUiOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbGxvd0Ryb3AoZSkgeyAKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7IAogICAgICAgIGNvbnN0IHRhcmdldEl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCcudG9kby1pdGVtJyk7CiAgICAgICAgaWYgKHRhcmdldEl0ZW0pIHsKICAgICAgICAgICAgdGFyZ2V0SXRlbS5jbGFzc0xpc3QuYWRkKCdkcmFnLW92ZXItaXRlbScpOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kby1pdGVtJykuZm9yRWFjaChlbCA9PiB7CiAgICAgICAgICAgICAgICBpZihlbCAhPT0gdGFyZ2V0SXRlbSkgZWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZy1vdmVyLWl0ZW0nKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZS5jdXJyZW50VGFyZ2V0LmNsYXNzTGlzdC5hZGQoImRyYWctb3ZlciIpOyAKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGRyYWdMZWF2ZShlKSB7IAogICAgICAgIGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCJkcmFnLW92ZXIiKTsKICAgICAgICBpZihlLnRhcmdldC5jbG9zZXN0KCcudG9kby1pdGVtJykpIGUudGFyZ2V0LmNsb3Nlc3QoJy50b2RvLWl0ZW0nKS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnLW92ZXItaXRlbScpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBkcm9wKGUsIHRhcmdldENvbCkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kby1saXN0JykuZm9yRWFjaChlbCA9PiBlbC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnLW92ZXInKSk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZG8taXRlbScpLmZvckVhY2goZWwgPT4gZWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZy1vdmVyLWl0ZW0nKSk7CgogICAgICAgIGlmIChzb3VyY2VDb2x1bW4gPT09ICdBR0VOREFfU09VUkNFJykgewogICAgICAgICAgICBjb25zdCBhZ1Rhc2sgPSBhcHBEYXRhLmNhbGVuZGFyLmZpbmQoYyA9PiBjLmlkLnRvU3RyaW5nKCkgPT09IGRyYWdnZWRJdGVtSWQpOwogICAgICAgICAgICBpZihhZ1Rhc2spIGFwcERhdGEudG9kb1t0YXJnZXRDb2xdLnB1c2goe2lkOiBEYXRlLm5vdygpLnRvU3RyaW5nKCksIHRleHQ6IGFnVGFzay50YXNrLCBpc0Zyb21BZ2VuZGE6IHRydWV9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBzb3VyY2VMaXN0ID0gYXBwRGF0YS50b2RvW3NvdXJjZUNvbHVtbl07CiAgICAgICAgICAgIGNvbnN0IGl0ZW1JZHggPSBzb3VyY2VMaXN0LmZpbmRJbmRleCh0ID0+IHQuaWQudG9TdHJpbmcoKSA9PT0gZHJhZ2dlZEl0ZW1JZCk7CiAgICAgICAgICAgIGlmKGl0ZW1JZHggPT09IC0xKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IFttb3ZlZEl0ZW1dID0gc291cmNlTGlzdC5zcGxpY2UoaXRlbUlkeCwgMSk7CgogICAgICAgICAgICBjb25zdCBkcm9wVGFyZ2V0ID0gZS50YXJnZXQuY2xvc2VzdCgnLnRvZG8taXRlbScpOwogICAgICAgICAgICBpZihkcm9wVGFyZ2V0ICYmIHNvdXJjZUNvbHVtbiA9PT0gdGFyZ2V0Q29sKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRJZCA9IGRyb3BUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7CiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRJZHggPSBhcHBEYXRhLnRvZG9bdGFyZ2V0Q29sXS5maW5kSW5kZXgodCA9PiB0LmlkLnRvU3RyaW5nKCkgPT09IHRhcmdldElkKTsKICAgICAgICAgICAgICAgIGlmKHRhcmdldElkeCA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwRGF0YS50b2RvW3RhcmdldENvbF0uc3BsaWNlKHRhcmdldElkeCwgMCwgbW92ZWRJdGVtKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYXBwRGF0YS50b2RvW3RhcmdldENvbF0ucHVzaChtb3ZlZEl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIGFwcERhdGEudG9kb1t0YXJnZXRDb2xdLnB1c2gobW92ZWRJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzYXZlRGF0YSgpOyByZW5kZXJUb2RvKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVuZGVyVG9kbygpIHsKICAgICAgICBbJ3VyZ2VudCcsJ3BsYW4nLCdwb3NzaWJsZScsJ2RlbGVnYXRlJ10uZm9yRWFjaChjb2wgPT4gewogICAgICAgICAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgbGlzdC0ke2NvbH1gKTsgaWYoIWxpc3RFbCkgcmV0dXJuOyBsaXN0RWwuaW5uZXJIVE1MID0gIiI7CiAgICAgICAgICAgIGFwcERhdGEudG9kb1tjb2xdLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICAgICAgICBsaXN0RWwuaW5uZXJIVE1MICs9IGA8bGkgY2xhc3M9InRvZG8taXRlbSAke2l0ZW0uaXNGcm9tQWdlbmRhPydmcm9tLWFnZW5kYSc6Jyd9IiBkYXRhLWlkPSIke2l0ZW0uaWR9IiBkcmFnZ2FibGU9InRydWUiIG9uZHJhZ3N0YXJ0PSJkcmFnVG9kbyhldmVudCwgJyR7aXRlbS5pZH0nLCAnJHtjb2x9JykiIG9uZHJhZ292ZXI9ImFsbG93RHJvcChldmVudCkiIG9uZHJhZ2xlYXZlPSJkcmFnTGVhdmUoZXZlbnQpIj4ke2l0ZW0uaXNGcm9tQWdlbmRhPyc8aSBjbGFzcz0iZmFzIGZhLWJlbGwiIHN0eWxlPSJjb2xvcjojZjFjNDBmO21hcmdpbi1yaWdodDo4cHg7Ij48L2k+JzonJ308c3BhbiBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlVG9kb1RleHQoJyR7Y29sfScsJyR7aXRlbS5pZH0nLHRoaXMuaW5uZXJUZXh0KSI+JHtpdGVtLnRleHR9PC9zcGFuPjxkaXYgY2xhc3M9InRvZG8tYWN0aW9ucyI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCIgb25jbGljaz0icmVtb3ZlVG9kbygnJHtjb2x9JywnJHtpdGVtLmlkfScpIj48L2k+PC9kaXY+PC9saT5gOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyAtLS0gQ0FMRU5EQVIgLS0tCiAgICBmdW5jdGlvbiBhZGRDYWxlbmRhckV2ZW50KCkgewogICAgICAgIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLWRhdGUnKS52YWx1ZTsgY29uc3QgdGFzayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtdGFzaycpLnZhbHVlLnRyaW0oKTsKICAgICAgICBpZighZGF0ZSB8fCAhdGFzaykgcmV0dXJuIGFsZXJ0KCJTYWlzaWUgaW5jb21wbMOodGUiKTsKICAgICAgICBhcHBEYXRhLmNhbGVuZGFyLnB1c2goe2lkOkRhdGUubm93KCkudG9TdHJpbmcoKSwgZGF0ZSwgdGFza30pOyBhcHBEYXRhLmNhbGVuZGFyLnNvcnQoKGEsYik9PiBuZXcgRGF0ZShhLmRhdGUpIC0gbmV3IERhdGUoYi5kYXRlKSk7CiAgICAgICAgc2F2ZURhdGEoKTsgcmVuZGVyQ2FsZW5kYXIoKTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC10YXNrJykudmFsdWU9IiI7CiAgICB9CiAgICBmdW5jdGlvbiByZW5kZXJDYWxlbmRhcigpIHsKICAgICAgICB2YXIgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWxlbmRhci1saXN0Jyk7CiAgICAgICAgaWYgKCFsaXN0KSByZXR1cm47CiAgICAgICAgbGlzdC5pbm5lckhUTUwgPSAnJzsKICAgICAgICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgICAgICB2YXIgdXBjb21pbmcgPSBhcHBEYXRhLmNhbGVuZGFyLmZpbHRlcihmdW5jdGlvbihjKXsgcmV0dXJuIGMudGFzayAmJiBjLnRhc2sudHJpbSgpLmxlbmd0aCA+IDMgJiYgYy5kYXRlID49IHRvZGF5OyB9KTsKCiAgICAgICAgLy8gRnVzaW9ubmVyIGxlcyDDqXbDqW5lbWVudHMgR29vZ2xlIENhbGVuZGFyIHNpIGFjdGl2w6kKICAgICAgICBpZiAoX2djYWxFdmVudHMgJiYgX2djYWxFdmVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIF9nY2FsRXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZ2UpIHsKICAgICAgICAgICAgICAgIGlmIChnZS5kYXRlID49IHRvZGF5ICYmIGdlLnRpdGxlICYmIGdlLnRpdGxlLnRyaW0oKS5sZW5ndGggPiAzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGV4aXN0cyA9IHVwY29taW5nLnNvbWUoZnVuY3Rpb24odSl7IHJldHVybiB1LnRhc2sgPT09IGdlLnRpdGxlICYmIHUuZGF0ZSA9PT0gZ2UuZGF0ZTsgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFleGlzdHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXBjb21pbmcucHVzaCh7aWQ6J2djYWxfJytnZS5pZCwgZGF0ZTpnZS5kYXRlLCB0YXNrOiBnZS50aXRsZSwgZ2NhbDp0cnVlLCBjb2xvcjpnZS5jb2xvciwgY2FsTmFtZTpnZS5jYWxOYW1lLCB0aW1lOmdlLnRpbWV9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdXBjb21pbmcuc29ydChmdW5jdGlvbihhLGIpeyByZXR1cm4gYS5kYXRlLmxvY2FsZUNvbXBhcmUoYi5kYXRlKTsgfSk7CiAgICAgICAgaWYoIXVwY29taW5nLmxlbmd0aCkgeyBsaXN0LmlubmVySFRNTCA9ICc8dHI+PHRkIGNvbHNwYW49IjQiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjojYmJiO3BhZGRpbmc6MjBweCI+QXVjdW4gw6l2w6luZW1lbnQgw6AgdmVuaXI8L3RkPjwvdHI+JzsgfQogICAgICAgIHVwY29taW5nLmZvckVhY2goZnVuY3Rpb24oYykgewogICAgICAgICAgICB2YXIgaXNUb2RheSA9IGMuZGF0ZSA9PT0gdG9kYXk7CiAgICAgICAgICAgIHZhciBjbHMgPSBpc1RvZGF5ID8gJ3Jvdy10b2RheScgOiAnJzsKICAgICAgICAgICAgdmFyIHNyYyA9IGMuZ2NhbCA/ICc8c3BhbiBzdHlsZT0iY29sb3I6IzQyODVmNDtmb250LXNpemU6LjY1cmVtIiB0aXRsZT0iR29vZ2xlIj48aSBjbGFzcz0iZmFiIGZhLWdvb2dsZSI+PC9pPjwvc3Bhbj4nIDogJyc7CiAgICAgICAgICAgIHZhciB0aW1lU3RyID0gYy50aW1lID8gJzxzbWFsbCBzdHlsZT0iY29sb3I6Izg4OCI+ICcrYy50aW1lKyc8L3NtYWxsPicgOiAnJzsKICAgICAgICAgICAgdmFyIGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgaWYgKCFjLmdjYWwpIHsKICAgICAgICAgICAgICAgIGFjdGlvbnMgPSAnPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1zbSIgc3R5bGU9ImJhY2tncm91bmQ6bm9uZTtjb2xvcjojMzQ5OGRiO2JvcmRlcjpub25lO3BhZGRpbmc6MnB4IDRweCIgb25jbGljaz0iZWRpdENhbEV2ZW50KFwnJytjLmlkKydcJykiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+PC9idXR0b24+JzsKICAgICAgICAgICAgICAgIGFjdGlvbnMgKz0gJzxidXR0b24gY2xhc3M9ImJ0biBidG4tZGFuZ2VyIGJ0bi1zbSIgb25jbGljaz0iZGVsZXRlQ2FsRXZlbnQoXCcnK2MuaWQrJ1wnKSI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPjwvYnV0dG9uPic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGlzdC5pbm5lckhUTUwgKz0gJzx0ciBjbGFzcz0iJytjbHMrJyI+PHRkIHN0eWxlPSJ3aGl0ZS1zcGFjZTpub3dyYXAiPicrbmV3IERhdGUoYy5kYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJykrJzwvdGQ+PHRkPicrc3JjKycgJytjLnRhc2srdGltZVN0cisnPC90ZD48dGQgc3R5bGU9IndoaXRlLXNwYWNlOm5vd3JhcDt0ZXh0LWFsaWduOnJpZ2h0Ij4nK2FjdGlvbnMrJzwvdGQ+PC90cj4nOwogICAgICAgIH0pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBlZGl0Q2FsRXZlbnQoaWQpIHsKICAgICAgICB2YXIgaXRlbSA9IGFwcERhdGEuY2FsZW5kYXIuZmluZChmdW5jdGlvbihjKXsgcmV0dXJuIGMuaWQudG9TdHJpbmcoKSA9PT0gaWQudG9TdHJpbmcoKTsgfSk7CiAgICAgICAgaWYgKCFpdGVtKSByZXR1cm47CiAgICAgICAgdmFyIG5ld1Rhc2sgPSBwcm9tcHQoJ01vZGlmaWVyIGxcJ8OpdsOpbmVtZW50IDonLCBpdGVtLnRhc2spOwogICAgICAgIGlmIChuZXdUYXNrID09PSBudWxsKSByZXR1cm47CiAgICAgICAgdmFyIG5ld0RhdGUgPSBwcm9tcHQoJ0RhdGUgKEFBQUEtTU0tSkopIDonLCBpdGVtLmRhdGUpOwogICAgICAgIGlmIChuZXdEYXRlID09PSBudWxsKSByZXR1cm47CiAgICAgICAgaXRlbS50YXNrID0gbmV3VGFzazsKICAgICAgICBpdGVtLmRhdGUgPSBuZXdEYXRlOwogICAgICAgIHNhdmVEYXRhKCk7IHJlbmRlckNhbGVuZGFyKCk7IGNoZWNrRGFpbHlUYXNrcygpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbEV2ZW50KGlkKSB7CiAgICAgICAgYXBwRGF0YS5jYWxlbmRhciA9IGFwcERhdGEuY2FsZW5kYXIuZmlsdGVyKGZ1bmN0aW9uKGMpIHsgcmV0dXJuIGMuaWQudG9TdHJpbmcoKSAhPT0gaWQudG9TdHJpbmcoKTsgfSk7CiAgICAgICAgc2F2ZURhdGEoKTsgcmVuZGVyQ2FsZW5kYXIoKTsgY2hlY2tEYWlseVRhc2tzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBjaGVja0RhaWx5VGFza3MoKSB7CiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgICAgICAgdmFyIGxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9kby10b2RheS1saXN0Jyk7CiAgICAgICAgaWYgKCFsaXN0KSByZXR1cm47CiAgICAgICAgbGlzdC5pbm5lckhUTUwgPSAnJzsKICAgICAgICB2YXIgYyA9IDA7CiAgICAgICAgYXBwRGF0YS5jYWxlbmRhci5maWx0ZXIoZnVuY3Rpb24odCl7IHJldHVybiB0LnRhc2sgJiYgdC50YXNrLnRyaW0oKS5sZW5ndGggPiAzOyB9KS5mb3JFYWNoKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgaWYgKHQuZGF0ZSA9PT0gdG9kYXkpIHsKICAgICAgICAgICAgICAgIGMrKzsKICAgICAgICAgICAgICAgIGxpc3QuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPSJ0b2RvLXRvZGF5LWl0ZW0iIGRyYWdnYWJsZT0idHJ1ZSIgb25kcmFnc3RhcnQ9ImRyYWdUb2RvKGV2ZW50LCBcJycgKyB0LmlkICsgJ1wnLCBcJ0FHRU5EQV9TT1VSQ0VcJykiPjxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtYmVsbCIgc3R5bGU9ImNvbG9yOnJlZDsgbWFyZ2luLXJpZ2h0OjVweDsiPjwvaT4nICsgdC50YXNrICsgJzwvc3Bhbj4gPHNtYWxsIHN0eWxlPSJjb2xvcjojOTk5Ij48aSBjbGFzcz0iZmFzIGZhLWFycm93cy1hbHQiPjwvaT4gR2xpc3Nlcjwvc21hbGw+PC9kaXY+JzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2RvLXRvZGF5LXpvbmUnKS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBjID4gMCk7CiAgICB9CgogICAgLy8gLS0tIEFUVEFDSE1FTlRTICYgSEVMUEVSUyAtLS0KICAgIGZ1bmN0aW9uIGFkZE11bHRpUm93KGNJZCwgY2wsIHBoMSkgewogICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjSWQpOwogICAgICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICByb3cuY2xhc3NOYW1lID0gJ211bHRpLXJvdyAnICsgY2w7CiAgICAgICAgdmFyIGlucCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgaW5wLnR5cGUgPSAndGV4dCc7IGlucC5jbGFzc05hbWUgPSAnZm9ybS1jb250cm9sIG5hbWUnOyBpbnAucGxhY2Vob2xkZXIgPSBwaDE7CiAgICAgICAgdmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIGJ0bi5jbGFzc05hbWUgPSAnYnRuIGJ0bi1kYW5nZXIgYnRuLWljb24nOwogICAgICAgIGJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPic7CiAgICAgICAgYnRuLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsgdGhpcy5wYXJlbnRFbGVtZW50LnJlbW92ZSgpOyB9OwogICAgICAgIHJvdy5hcHBlbmRDaGlsZChpbnApOwogICAgICAgIHJvdy5hcHBlbmRDaGlsZChidG4pOwogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyb3cpOwogICAgICAgIGlmIChjbC5pbmRleE9mKCdzdHVkZW50JykgPj0gMCB8fCBjbC5pbmRleE9mKCdlbGV2ZScpID49IDApIHsgYXR0YWNoU3R1ZGVudEFDKGlucCk7IH0KICAgICAgICBpZiAoY2wuaW5kZXhPZigndGVhY2hlcicpID49IDApIHsgYXR0YWNoVGVhY2hlckFDKGlucCk7IH0KICAgIH0KICAgIGZ1bmN0aW9uIGdldE11bHRpRGF0YShjSWQsIGNsKSB7IGxldCByZXMgPSBbXTsgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgIyR7Y0lkfSAuJHtjbH1gKS5mb3JFYWNoKHJvdyA9PiB7IGNvbnN0IG4gPSByb3cucXVlcnlTZWxlY3RvcignLm5hbWUnKS52YWx1ZS50cmltKCk7IGlmKG4pIHJlcy5wdXNoKHtuYW1lOm59KTsgfSk7IHJldHVybiByZXM7IH0KICAgIGZ1bmN0aW9uIHJlc3RvcmVNdWx0aVJvd3MoY0lkLCBjbCwgZGF0YSwgcGgxKSB7IGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNJZCk7IGlmKCFjb250YWluZXIpIHJldHVybjsgY29udGFpbmVyLmlubmVySFRNTCA9ICIiOyBpZighZGF0YSB8fCBkYXRhLmxlbmd0aCA9PT0gMCkgeyByZXNldE11bHRpKGNJZCwgY2wsIHBoMSk7IHJldHVybjsgfSBkYXRhLmZvckVhY2goZCA9PiB7IGNvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9Im11bHRpLXJvdyAke2NsfSI+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgbmFtZSIgdmFsdWU9IiR7ZC5uYW1lfSIgcGxhY2Vob2xkZXI9IiR7cGgxfSI+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1kYW5nZXIgYnRuLWljb24iIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPjwvYnV0dG9uPjwvZGl2PmA7IH0pOyB9CiAgICBmdW5jdGlvbiByZXNldE11bHRpKGNJZCwgY2wsIHBoMSkgeyBjb25zdCBjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY0lkKTsgaWYoYykgYy5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0ibXVsdGktcm93ICR7Y2x9Ij48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCBuYW1lIiBwbGFjZWhvbGRlcj0iJHtwaDF9Ij48YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRhbmdlciBidG4taWNvbiIgb25jbGljaz0idGhpcy5wYXJlbnRFbGVtZW50LnJlbW92ZSgpIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+PC9idXR0b24+PC9kaXY+YDsgfQogICAgCiAgICBmdW5jdGlvbiBhZGRBdHRhY2htZW50KGxpc3RJZCwgaW5wdXQpIHsKICAgICAgICBjb25zdCBmaWxlID0gaW5wdXQuZmlsZXNbMF07CiAgICAgICAgaWYoIWZpbGUpIHJldHVybjsKICAgICAgICBpZiAoZmlsZS5zaXplID4gMTUwMDAwKSB7CiAgICAgICAgICAgICBhbGVydCgiRmljaGllciB0cm9wIHZvbHVtaW5ldXggcG91ciBsYSBzYXV2ZWdhcmRlIGxvY2FsZSAoPjE1MGtvKS4gU2V1bCBsZSBub20gZHUgZmljaGllciBzZXJhIGNvbnNlcnbDqSBlbiByw6lmw6lyZW5jZS4iKTsKICAgICAgICAgICAgIGFwcGVuZEF0dGFjaG1lbnRVSShsaXN0SWQsIHtuYW1lOiBmaWxlLm5hbWUsIGRhdGE6IG51bGwsIGlzUmVmOiB0cnVlfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZSkgeyBhcHBlbmRBdHRhY2htZW50VUkobGlzdElkLCB7bmFtZTogZmlsZS5uYW1lLCBkYXRhOiBlLnRhcmdldC5yZXN1bHQsIGlzUmVmOiBmYWxzZX0pOyB9OwogICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgICAgfQogICAgICAgIGlucHV0LnZhbHVlID0gIiI7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwZW5kQXR0YWNobWVudFVJKGxpc3RJZCwgZmlsZU9iaikgewogICAgICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdElkKTsKICAgICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgICAgbGkuY2xhc3NOYW1lID0gJ2F0dGFjaG1lbnQtaXRlbSc7CiAgICAgICAgbGkuZGF0YXNldC5uYW1lID0gZmlsZU9iai5uYW1lOwogICAgICAgIGxpLmRhdGFzZXQuZGF0YSA9IGZpbGVPYmouZGF0YSB8fCAiIjsKICAgICAgICBsaS5kYXRhc2V0LmlzUmVmID0gZmlsZU9iai5pc1JlZjsKICAgICAgICBjb25zdCBsaW5rID0gZmlsZU9iai5kYXRhID8gYDxhIGhyZWY9IiMiIG9uY2xpY2s9ImRvd25sb2FkQmFzZTY0KCcke2ZpbGVPYmouZGF0YX0nLCAnJHtmaWxlT2JqLm5hbWV9JykiPiR7ZmlsZU9iai5uYW1lfTwvYT5gIDogYDxzcGFuPiR7ZmlsZU9iai5uYW1lfSAoUsOpZsOpcmVuY2Ugc2V1bGUpPC9zcGFuPmA7CiAgICAgICAgbGkuaW5uZXJIVE1MID0gYDxkaXY+PGkgY2xhc3M9ImZhcyBmYS1maWxlIj48L2k+ICR7bGlua308L2Rpdj4gPGkgY2xhc3M9ImZhcyBmYS10cmFzaCIgc3R5bGU9ImNvbG9yOiNlNzRjM2M7IGN1cnNvcjpwb2ludGVyOyIgb25jbGljaz0idGhpcy5wYXJlbnRFbGVtZW50LnJlbW92ZSgpIj48L2k+YDsKICAgICAgICB1bC5hcHBlbmRDaGlsZChsaSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGRvd25sb2FkQmFzZTY0KGJhc2U2NCwgbmFtZSkgewogICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgYS5ocmVmID0gYmFzZTY0OwogICAgICAgIGEuZG93bmxvYWQgPSBuYW1lOwogICAgICAgIGEuY2xpY2soKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0QXR0YWNobWVudHNEYXRhKGxpc3RJZCkgewogICAgICAgIGNvbnN0IHJlcyA9IFtdOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYCMke2xpc3RJZH0gLmF0dGFjaG1lbnQtaXRlbWApLmZvckVhY2gobGkgPT4gewogICAgICAgICAgICByZXMucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiBsaS5kYXRhc2V0Lm5hbWUsCiAgICAgICAgICAgICAgICBkYXRhOiBsaS5kYXRhc2V0LmRhdGEgPT09ICJudWxsIiB8fCBsaS5kYXRhc2V0LmRhdGEgPT09ICIiID8gbnVsbCA6IGxpLmRhdGFzZXQuZGF0YSwKICAgICAgICAgICAgICAgIGlzUmVmOiBsaS5kYXRhc2V0LmlzUmVmID09PSAidHJ1ZSIKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVzdG9yZUF0dGFjaG1lbnRzKGxpc3RJZCwgZGF0YSkgewogICAgICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdElkKTsKICAgICAgICB1bC5pbm5lckhUTUwgPSAiIjsKICAgICAgICBpZighZGF0YSkgcmV0dXJuOwogICAgICAgIGRhdGEuZm9yRWFjaChkID0+IGFwcGVuZEF0dGFjaG1lbnRVSShsaXN0SWQsIGQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZXNldEVkaXRNb2RlKCkgeyBjdXJyZW50RWRpdElkID0gbnVsbDsgY3VycmVudEVkaXRUeXBlID0gbnVsbDsgWydidG4tc2F2ZS1lbnQnLCdidG4tc2F2ZS1yZXUnLCdidG4tc2F2ZS1kaXInLCdidG4tc2F2ZS1zdWl2aSddLmZvckVhY2goaWQgPT4geyBjb25zdCBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOyBpZihiKSB7IGIuaW5uZXJUZXh0ID0gKGlkLmluY2x1ZGVzKCdkaXInKSB8fCBpZC5pbmNsdWRlcygnc3VpdmknKSkgPyAiRW5yZWdpc3RyZXIgKEhpc3RvcmlxdWUpIiA6ICJFbnJlZ2lzdHJlciI7IGIuY2xhc3NOYW1lID0gYi5pZC5pbmNsdWRlcygnc3VpdmknKSA/ICJidG4gYnRuLWluZm8iIDogKGIuaWQuaW5jbHVkZXMoJ3JldScpID8gImJ0biBidG4tc3VjY2VzcyIgOiAiYnRuIGJ0bi1wcmltYXJ5Iik7IH0gfSk7IH0KICAgIGZ1bmN0aW9uIGFjdGl2YXRlRWRpdE1vZGUodCwgaWQpIHsgY3VycmVudEVkaXRJZCA9IGlkOyBjdXJyZW50RWRpdFR5cGUgPSB0OyBjb25zdCBtID0geydFTlQnOididG4tc2F2ZS1lbnQnLCdSRVUnOididG4tc2F2ZS1yZXUnLCdESVInOididG4tc2F2ZS1kaXInLCdTVUlWSSc6J2J0bi1zYXZlLXN1aXZpJ307IGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtW3RdKTsgaWYoYikgeyBiLmlubmVyVGV4dCA9ICJNZXR0cmUgw6Agam91ciBsZSBkb2N1bWVudCI7IGIuY2xhc3NOYW1lID0gImJ0biBidG4tdXBkYXRlLW1vZGUiOyB9IH0KCiAgICBmdW5jdGlvbiBsb2FkSXRlbUZvckVkaXQodHlwZSwgaWQpIHsKICAgICAgICBsZXQgaXQ7CiAgICAgICAgaWYodHlwZSA9PT0gJ0VOVCcpIHsKICAgICAgICAgICAgaXQgPSBhcHBEYXRhLmVudHJldGllbnMuZmluZCh4ID0+IHguaWQudG9TdHJpbmcoKSA9PT0gaWQudG9TdHJpbmcoKSk7IGlmKCFpdCkgcmV0dXJuOwogICAgICAgICAgICBzd2l0Y2hNZW51KCdtZW51NicpOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW50LWRhdGUnKS52YWx1ZSA9IGl0LmRhdGU7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnQtdHlwZScpLnZhbHVlID0gaXQudHlwZTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC1vYmpldCcpLnZhbHVlID0gaXQub2JqZXQ7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnQtY29udGVudScpLmlubmVySFRNTCA9IGl0LmJvZHk7CiAgICAgICAgICAgIHJlc3RvcmVNdWx0aVJvd3MoJ2VudC1zdHVkZW50cy1jb250YWluZXInLCAnZW50LXN0dWRlbnQnLCBpdC5zdHVkZW50cywgJ05vbSDDiWzDqHZlJyk7IHJlc3RvcmVNdWx0aVJvd3MoJ2VudC10ZWFjaGVycy1jb250YWluZXInLCAnZW50LXRlYWNoZXInLCBpdC50ZWFjaGVycywgJ05vbSBQZXJzb25uZWwnKTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2VudC1zdHVkZW50cy1jb250YWluZXIgLm5hbWUnKS5mb3JFYWNoKGF0dGFjaFN0dWRlbnRBQyk7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNlbnQtdGVhY2hlcnMtY29udGFpbmVyIC5uYW1lJykuZm9yRWFjaChhdHRhY2hUZWFjaGVyQUMpOwogICAgICAgICAgICByZXN0b3JlQXR0YWNobWVudHMoJ2VudC1hdHRhY2htZW50cycsIGl0LmF0dGFjaG1lbnRzKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdSRVUnKSB7CiAgICAgICAgICAgIGl0ID0gYXBwRGF0YS5yZXVuaW9ucy5maW5kKHggPT4geC5pZC50b1N0cmluZygpID09PSBpZC50b1N0cmluZygpKTsgaWYoIWl0KSByZXR1cm47CiAgICAgICAgICAgIGlmKGl0LnR5cGUgPT09ICJSw6l1bmlvbiBkZSBEaXJlY3Rpb24iKSB7IAogICAgICAgICAgICAgICAgc3dpdGNoTWVudSgnbWVudTQnKTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1kYXRlJykudmFsdWUgPSBpdC5kYXRlOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLXBhcnRzJykudmFsdWUgPSBpdC5wYXJ0cyB8fCAiIjsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1jb250ZW51JykuaW5uZXJIVE1MID0gaXQub2RqOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLW5vdGVzJykuaW5uZXJIVE1MID0gaXQuY3I7IAogICAgICAgICAgICAgICAgcmVzdG9yZUF0dGFjaG1lbnRzKCdkaXItYXR0YWNobWVudHMnLCBpdC5hdHRhY2htZW50cyk7CiAgICAgICAgICAgICAgICBhY3RpdmF0ZUVkaXRNb2RlKCdESVInLCBpZCk7IHJldHVybjsgCiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGVsc2UgeyAKICAgICAgICAgICAgICAgIHN3aXRjaE1lbnUoJ21lbnU3Jyk7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXUtZGF0ZScpLnZhbHVlID0gaXQuZGF0ZTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JldS10eXBlJykudmFsdWUgPSBpdC50eXBlOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LW9kaicpLnZhbHVlID0gaXQub2RqOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LWNvbnRlbnUnKS5pbm5lckhUTUwgPSBpdC5ib2R5OyAKICAgICAgICAgICAgICAgIHJlc3RvcmVNdWx0aVJvd3MoJ3JldS1zdHVkZW50cy1jb250YWluZXInLCAncmV1LXN0dWRlbnQnLCBpdC5zdHVkZW50cywgJ05vbSDDiWzDqHZlJyk7IHJlc3RvcmVNdWx0aVJvd3MoJ3JldS10ZWFjaGVycy1jb250YWluZXInLCAncmV1LXRlYWNoZXInLCBpdC50ZWFjaGVycywgJ05vbSBQZXJzb25uZWwnKTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI3JldS1zdHVkZW50cy1jb250YWluZXIgLm5hbWUnKS5mb3JFYWNoKGF0dGFjaFN0dWRlbnRBQyk7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNyZXUtdGVhY2hlcnMtY29udGFpbmVyIC5uYW1lJykuZm9yRWFjaChhdHRhY2hUZWFjaGVyQUMpOyAKICAgICAgICAgICAgICAgIHJlc3RvcmVBdHRhY2htZW50cygncmV1LWF0dGFjaG1lbnRzJywgaXQuYXR0YWNobWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnU1VJVkknKSB7CiAgICAgICAgICAgIGl0ID0gYXBwRGF0YS5zdWl2aUVsZXZlcy5maW5kKHggPT4geC5pZC50b1N0cmluZygpID09PSBpZC50b1N0cmluZygpKTsgaWYoIWl0KSByZXR1cm47CiAgICAgICAgICAgIHN3aXRjaE1lbnUoJ21lbnU1Jyk7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1kYXRlJykudmFsdWUgPSBpdC5kYXRlOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktcGFydHMnKS52YWx1ZSA9IGl0LnBhcnRpY2lwYW50czsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1aXZpLWNsYXNzZXMnKS52YWx1ZSA9IGl0LmNsYXNzZXM7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1jb250ZW51JykuaW5uZXJIVE1MID0gaXQuYm9keTsKICAgICAgICAgICAgcmVzdG9yZUF0dGFjaG1lbnRzKCdzdWl2aS1hdHRhY2htZW50cycsIGl0LmF0dGFjaG1lbnRzKTsKICAgICAgICB9CiAgICAgICAgYWN0aXZhdGVFZGl0TW9kZSh0eXBlLCBpZCk7CiAgICB9CgogICAgLy8gLS0tIFNBVklORyAtLS0KICAgIGZ1bmN0aW9uIHNhdmVQcmVwRGlyZWN0aW9uKCkgewogICAgICAgIGNvbnN0IGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLWRhdGUnKS52YWx1ZTsgaWYoIWQpIHJldHVybiBhbGVydCgiRGF0ZSByZXF1aXNlIik7CiAgICAgICAgY29uc3QgbiA9IHsgaWQ6IGN1cnJlbnRFZGl0SWQgfHwgRGF0ZS5ub3coKS50b1N0cmluZygpLCBkYXRlOmQsIHR5cGU6IlLDqXVuaW9uIGRlIERpcmVjdGlvbiIsIG9kajpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLWNvbnRlbnUnKS5pbm5lckhUTUwsIGNyOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXItbm90ZXMnKS5pbm5lckhUTUwsIHBhcnRzOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXItcGFydHMnKS52YWx1ZSwgYXR0YWNobWVudHM6IGdldEF0dGFjaG1lbnRzRGF0YSgnZGlyLWF0dGFjaG1lbnRzJykgfTsKICAgICAgICBpZihjdXJyZW50RWRpdElkKSB7IGNvbnN0IGlkeCA9IGFwcERhdGEucmV1bmlvbnMuZmluZEluZGV4KHggPT4geC5pZC50b1N0cmluZygpID09PSBjdXJyZW50RWRpdElkLnRvU3RyaW5nKCkpOyBpZihpZHggPiAtMSkgYXBwRGF0YS5yZXVuaW9uc1tpZHhdID0gbjsgfSBlbHNlIHsgYXBwRGF0YS5yZXVuaW9ucy51bnNoaWZ0KG4pOyB9CiAgICAgICAgc2F2ZURhdGEoKTsgcmVzZXRFZGl0TW9kZSgpOyBhbGVydCgiRW5yZWdpc3Ryw6kiKTsgc3dpdGNoTWVudSgnbWVudTgnKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhdmVTdWl2aUVsZXZlKCkgewogICAgICAgIGNvbnN0IGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktZGF0ZScpLnZhbHVlOyBpZighZCkgcmV0dXJuIGFsZXJ0KCJEYXRlIHJlcXVpc2UiKTsKICAgICAgICBjb25zdCBuID0geyBpZDogY3VycmVudEVkaXRJZCB8fCBEYXRlLm5vdygpLnRvU3RyaW5nKCksIGRhdGU6ZCwgdHlwZTogIlN1aXZpIMOJbMOodmUgLyBQb2ludCBDUEUiLCBwYXJ0aWNpcGFudHM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1wYXJ0cycpLnZhbHVlLCBjbGFzc2VzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktY2xhc3NlcycpLnZhbHVlLCBib2R5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktY29udGVudScpLmlubmVySFRNTCwgYXR0YWNobWVudHM6IGdldEF0dGFjaG1lbnRzRGF0YSgnc3VpdmktYXR0YWNobWVudHMnKSB9OwogICAgICAgIGlmKGN1cnJlbnRFZGl0SWQpIHsgY29uc3QgaWR4ID0gYXBwRGF0YS5zdWl2aUVsZXZlcy5maW5kSW5kZXgoeCA9PiB4LmlkLnRvU3RyaW5nKCkgPT09IGN1cnJlbnRFZGl0SWQudG9TdHJpbmcoKSk7IGlmKGlkeCA+IC0xKSBhcHBEYXRhLnN1aXZpRWxldmVzW2lkeF0gPSBuOyB9IGVsc2UgeyBhcHBEYXRhLnN1aXZpRWxldmVzLnVuc2hpZnQobik7IH0KICAgICAgICBzYXZlRGF0YSgpOyByZXNldEVkaXRNb2RlKCk7IGFsZXJ0KCJFbnJlZ2lzdHLDqSIpOyBzd2l0Y2hNZW51KCdtZW51OCcpOwogICAgfQogICAgZnVuY3Rpb24gc2F2ZUVudHJldGllbigpIHsKICAgICAgICBjb25zdCBkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC1kYXRlJykudmFsdWU7IGlmKCFkKSByZXR1cm4gYWxlcnQoIkRhdGUgcmVxdWlzZSIpOwogICAgICAgIGNvbnN0IG4gPSB7aWQ6IGN1cnJlbnRFZGl0SWQgfHwgRGF0ZS5ub3coKS50b1N0cmluZygpLCBkYXRlOmQsIHR5cGU6ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC10eXBlJykudmFsdWUsIG9iamV0OmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnQtb2JqZXQnKS52YWx1ZSwgYm9keTpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW50LWNvbnRlbnUnKS5pbm5lckhUTUwsIHN0dWRlbnRzOmdldE11bHRpRGF0YSgnZW50LXN0dWRlbnRzLWNvbnRhaW5lcicsJ2VudC1zdHVkZW50JyksIHRlYWNoZXJzOmdldE11bHRpRGF0YSgnZW50LXRlYWNoZXJzLWNvbnRhaW5lcicsJ2VudC10ZWFjaGVyJyksIGF0dGFjaG1lbnRzOiBnZXRBdHRhY2htZW50c0RhdGEoJ2VudC1hdHRhY2htZW50cycpfTsKICAgICAgICBpZihjdXJyZW50RWRpdElkKSB7IGNvbnN0IGlkeCA9IGFwcERhdGEuZW50cmV0aWVucy5maW5kSW5kZXgoeCA9PiB4LmlkLnRvU3RyaW5nKCkgPT09IGN1cnJlbnRFZGl0SWQudG9TdHJpbmcoKSk7IGlmKGlkeCA+IC0xKSBhcHBEYXRhLmVudHJldGllbnNbaWR4XSA9IG47IH0gZWxzZSB7IGFwcERhdGEuZW50cmV0aWVucy51bnNoaWZ0KG4pOyB9CiAgICAgICAgc2F2ZURhdGEoKTsgcmVzZXRFZGl0TW9kZSgpOyBhbGVydCgiRW5yZWdpc3Ryw6kiKTsgc3dpdGNoTWVudSgnbWVudTgnKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhdmVSZXVuaW9uKCkgewogICAgICAgIGNvbnN0IGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LWRhdGUnKS52YWx1ZTsgaWYoIWQpIHJldHVybiBhbGVydCgiRGF0ZSByZXF1aXNlIik7CiAgICAgICAgY29uc3QgbiA9IHtpZDogY3VycmVudEVkaXRJZCB8fCBEYXRlLm5vdygpLnRvU3RyaW5nKCksIGRhdGU6ZCwgdHlwZTpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LXR5cGUnKS52YWx1ZSwgb2RqOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXUtb2RqJykudmFsdWUsIGJvZHk6ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JldS1jb250ZW51JykuaW5uZXJIVE1MLCBzdHVkZW50czpnZXRNdWx0aURhdGEoJ3JldS1zdHVkZW50cy1jb250YWluZXInLCdyZXUtc3R1ZGVudCcpLCB0ZWFjaGVyczpnZXRNdWx0aURhdGEoJ3JldS10ZWFjaGVycy1jb250YWluZXInLCdyZXUtdGVhY2hlcicpLCBhdHRhY2htZW50czogZ2V0QXR0YWNobWVudHNEYXRhKCdyZXUtYXR0YWNobWVudHMnKX07CiAgICAgICAgaWYoY3VycmVudEVkaXRJZCkgeyBjb25zdCBpZHggPSBhcHBEYXRhLnJldW5pb25zLmZpbmRJbmRleCh4ID0+IHguaWQudG9TdHJpbmcoKSA9PT0gY3VycmVudEVkaXRJZC50b1N0cmluZygpKTsgaWYoaWR4ID4gLTEpIGFwcERhdGEucmV1bmlvbnNbaWR4XSA9IG47IH0gZWxzZSB7IGFwcERhdGEucmV1bmlvbnMudW5zaGlmdChuKTsgfQogICAgICAgIHNhdmVEYXRhKCk7IHJlc2V0RWRpdE1vZGUoKTsgYWxlcnQoIkVucmVnaXN0csOpIik7IHN3aXRjaE1lbnUoJ21lbnU4Jyk7CiAgICB9CgogICAgLy8gLS0tIFdPUkQgRVhQT1JUIFdJVEggSEVBREVSUyAoVEFCTEUgQkFTRUQpIC0tLQogICAgZnVuY3Rpb24gZXhwb3J0RG9jV29yZChtb2RlKSB7CiAgICAgICAgbGV0IHRpdGxlLCBjb250ZW50LCBtZXRhID0gIiI7CiAgICAgICAgCiAgICAgICAgLy8gUHJlcGFyZSBjb250ZW50IGJhc2VkIG9uIG1vZGUKICAgICAgICBpZihtb2RlID09PSAnRU5UJykgewogICAgICAgICAgICB0aXRsZSA9ICJDb21wdGUtUmVuZHUgZCdFbnRyZXRpZW4iOwogICAgICAgICAgICBtZXRhID0gYDxwPjxzdHJvbmc+T2JqZXQgOjwvc3Ryb25nPiAke2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnQtdHlwZScpLnZhbHVlfSAtICR7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC1vYmpldCcpLnZhbHVlfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPkRhdGU6PC9zdHJvbmc+ICR7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VudC1kYXRlJykudmFsdWV9PC9wPmA7CiAgICAgICAgICAgIGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW50LWNvbnRlbnUnKS5pbm5lckhUTUw7CiAgICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnUFJFUF9ESVInKSB7CiAgICAgICAgICAgIHRpdGxlID0gIlLDqXVuaW9uIGRlIERpcmVjdGlvbiI7CiAgICAgICAgICAgIG1ldGEgPSBgPHA+PHN0cm9uZz5EYXRlOjwvc3Ryb25nPiAke2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXItZGF0ZScpLnZhbHVlfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPlBhcnRpY2lwYW50czo8L3N0cm9uZz4gJHtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLXBhcnRzJykudmFsdWV9PC9wPmA7CiAgICAgICAgICAgIGNvbnRlbnQgPSBgPGg0Pk9yZHJlIGR1IGpvdXI8L2g0PiR7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1jb250ZW51JykuaW5uZXJIVE1MfTxocj48aDQ+Tm90ZXM8L2g0PiR7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1ub3RlcycpLmlubmVySFRNTH1gOwogICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ1JFVScpIHsKICAgICAgICAgICAgdGl0bGUgPSAiQ29tcHRlLVJlbmR1IDogIiArIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXUtdHlwZScpLnZhbHVlOwogICAgICAgICAgICBtZXRhID0gYDxwPjxzdHJvbmc+RGF0ZTo8L3N0cm9uZz4gJHtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LWRhdGUnKS52YWx1ZX08L3A+YDsKICAgICAgICAgICAgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXUtY29udGVudScpLmlubmVySFRNTDsKICAgICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdTVUlWSScpIHsKICAgICAgICAgICAgdGl0bGUgPSAiU3Vpdmkgw4lsw6h2ZSAvIFBvaW50IENQRSI7CiAgICAgICAgICAgIG1ldGEgPSBgPHA+PHN0cm9uZz5EYXRlOjwvc3Ryb25nPiAke2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1kYXRlJykudmFsdWV9PC9wPgogICAgICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+UGFydGljaXBhbnRzOjwvc3Ryb25nPiAke2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1wYXJ0cycpLnZhbHVlfTwvcD5gOwogICAgICAgICAgICBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1aXZpLWNvbnRlbnUnKS5pbm5lckhUTUw7CiAgICAgICAgfQoKICAgICAgICAvLyBIZWFkZXIgVGFibGUgZm9yIFdvcmQgKExlZnQ6IFNjaG9vbCwgUmlnaHQ6IExvZ28pCiAgICAgICAgY29uc3QgbG9nb0ltZyA9IGFwcERhdGEuc2V0dGluZ3MubG9nbyA/IGA8aW1nIHNyYz0iJHthcHBEYXRhLnNldHRpbmdzLmxvZ299IiB3aWR0aD0iMTUwIiBoZWlnaHQ9ImF1dG8iIGFsdD0iTG9nbyI+YCA6ICcnOwogICAgICAgIGNvbnN0IHNpZ0ltZyA9IGFwcERhdGEuc2V0dGluZ3Muc2lnbmF0dXJlID8gYDxpbWcgc3JjPSIke2FwcERhdGEuc2V0dGluZ3Muc2lnbmF0dXJlfSIgd2lkdGg9IjE1MCIgaGVpZ2h0PSJhdXRvIiBhbHQ9IlNpZ25hdHVyZSI+YCA6ICcnOwoKICAgICAgICBjb25zdCBoZWFkZXJTZWN0aW9uID0gYAogICAgICAgIDx0YWJsZSB3aWR0aD0iMTAwJSIgYm9yZGVyPSIwIiBjZWxscGFkZGluZz0iMCIgY2VsbHNwYWNpbmc9IjAiIHN0eWxlPSJtYXJnaW4tYm90dG9tOiAyMHB4OyBib3JkZXItYm90dG9tOiAycHggc29saWQgIzMzMzsiPgogICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICA8dGQgdmFsaWduPSJ0b3AiIHN0eWxlPSJ0ZXh0LWFsaWduOiBsZWZ0OyI+CiAgICAgICAgICAgICAgICAgICAgPGgxIHN0eWxlPSJmb250LXNpemU6IDI0cHg7IG1hcmdpbjogMDsgcGFkZGluZzogMDsiPiR7YXBwRGF0YS5zZXR0aW5ncy5zY2hvb2x9PC9oMT4KICAgICAgICAgICAgICAgICAgICA8cCBzdHlsZT0ibWFyZ2luOiA1cHggMCAxMHB4IDA7IGZvbnQtc2l6ZTogMTRweDsgY29sb3I6ICM2NjY7Ij5EaXJlY3Rpb248L3A+CiAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgPHRkIHZhbGlnbj0idG9wIiBzdHlsZT0idGV4dC1hbGlnbjogcmlnaHQ7Ij4KICAgICAgICAgICAgICAgICAgICAke2xvZ29JbWd9CiAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICA8L3RyPgogICAgICAgIDwvdGFibGU+YDsKCiAgICAgICAgY29uc3QgZm9vdGVyU2VjdGlvbiA9IGAKICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiA1MHB4OyB0ZXh0LWFsaWduOiByaWdodDsiPgogICAgICAgICAgICAke3NpZ0ltZ30KICAgICAgICAgICAgPHA+PHN0cm9uZz4ke2FwcERhdGEuc2V0dGluZ3MudXNlcn08L3N0cm9uZz48L3A+CiAgICAgICAgPC9kaXY+YDsKCiAgICAgICAgY29uc3QgaGVhZGVyID0gYDxodG1sIHhtbG5zOm89J3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZScgeG1sbnM6dz0ndXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6d29yZCcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnL1RSL1JFQy1odG1sNDAnPjxoZWFkPjxtZXRhIGNoYXJzZXQ9J3V0Zi04Jz48dGl0bGU+JHt0aXRsZX08L3RpdGxlPjwvaGVhZD48Ym9keT5gOwogICAgICAgIGNvbnN0IGZvb3RlciA9ICI8L2JvZHk+PC9odG1sPiI7CiAgICAgICAgCiAgICAgICAgY29uc3QgZnVsbEh0bWwgPSBoZWFkZXIgKyBoZWFkZXJTZWN0aW9uICsgYDxoMiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IG1hcmdpbi1ib3R0b206MjBweDsiPiR7dGl0bGV9PC9oMj5gICsgbWV0YSArIGA8aHI+YCArIGNvbnRlbnQgKyBmb290ZXJTZWN0aW9uICsgZm9vdGVyOwoKICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoWydcdWZlZmYnLCBmdWxsSHRtbF0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL21zd29yZCcgfSk7CiAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICBsaW5rLmRvd25sb2FkID0gYCR7dGl0bGUucmVwbGFjZSgvIC9nLCdfJyl9XyR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF19LmRvY2A7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTsKICAgIH0KCiAgICAvLyAtLS0gUFJJTlRJTkcgLS0tCiAgICBmdW5jdGlvbiBnZW5lcmF0ZU9mZmljaWFsUHJpbnQodGl0bGUsIGRhdGUsIHR5cGUsIHBTdHIsIGJvZHksIGF0dGFjaG1lbnRzKSB7CiAgICAgICAgY29uc3QgcyA9IGFwcERhdGEuc2V0dGluZ3MgfHwge307CiAgICAgICAgY29uc3Qgc2lnID0gcy5zaWduYXR1cmUgPyBgPGltZyBzcmM9IiR7cy5zaWduYXR1cmV9IiBjbGFzcz0ic2lnbmF0dXJlLWltZyI+YCA6ICcnOwogICAgICAgIGxldCBhdHRIdG1sID0gIiI7CiAgICAgICAgaWYoYXR0YWNobWVudHMgJiYgYXR0YWNobWVudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBhdHRIdG1sID0gYDxkaXYgY2xhc3M9ImF0dGFjaG1lbnQtcHJpbnQtbGlzdCI+PHN0cm9uZz5QacOoY2VzIGpvaW50ZXMgLyBEb2N1bWVudHMgbGnDqXMgOjwvc3Ryb25nPjx1bD5gICsgYXR0YWNobWVudHMubWFwKGEgPT4gYDxsaT4ke2EubmFtZX08L2xpPmApLmpvaW4oJycpICsgYDwvdWw+PC9kaXY+YDsKICAgICAgICB9CiAgICAgICAgY29uc3QgbGF5b3V0ICAgPSBzLnBkZkhlYWRlckxheW91dCAgIHx8ICdjbGFzc2lxdWUnOwogICAgICAgIGNvbnN0IGhDb2xvciAgID0gcy5wZGZIZWFkZXJDb2xvciAgICB8fCAnIzFiMjQzMyc7CiAgICAgICAgY29uc3Qgc3VidGl0bGUgPSBzLnBkZkhlYWRlclN1YnRpdGxlIHx8ICdEaXJlY3Rpb24nOwogICAgICAgIGNvbnN0IHNjaG9vbCAgID0gcy5zY2hvb2wgfHwgJyc7CiAgICAgICAgY29uc3QgY2l0eSAgICAgPSBzLmNpdHkgICB8fCAnJzsKICAgICAgICBjb25zdCB1c2VyICAgICA9IHMudXNlciB8fCBzLm5hbWUgfHwgJyc7CiAgICAgICAgY29uc3QgZGF0ZVN0ciAgPSBkYXRlID8gJ0xlwqAnICsgbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicpIDogJyc7CiAgICAgICAgY29uc3QgbG9nb1RhZyAgPSBzLmxvZ28gPyBgPGltZyBzcmM9IiR7cy5sb2dvfSIgc3R5bGU9Im1heC1oZWlnaHQ6ODBweDttYXgtd2lkdGg6MTYwcHg7b2JqZWN0LWZpdDpjb250YWluO2Rpc3BsYXk6YmxvY2s7LXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6ZXhhY3Q7cHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0OyI+YCA6ICcnOwogICAgICAgIGNvbnN0IGxvZ29UYWdTbT0gcy5sb2dvID8gYDxpbWcgc3JjPSIke3MubG9nb30iIHN0eWxlPSJtYXgtaGVpZ2h0OjUwcHg7bWF4LXdpZHRoOjExMHB4O29iamVjdC1maXQ6Y29udGFpbjtiYWNrZ3JvdW5kOndoaXRlO3BhZGRpbmc6M3B4O2JvcmRlci1yYWRpdXM6M3B4Oy13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0O3ByaW50LWNvbG9yLWFkanVzdDpleGFjdDsiPmAgOiAnJzsKCiAgICAgICAgbGV0IGhlYWRlckh0bWwgPSAnJzsKICAgICAgICBpZiAobGF5b3V0ID09PSAnbW9kZXJuZScpIHsKICAgICAgICAgICAgaGVhZGVySHRtbCA9IGA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjttYXJnaW4tYm90dG9tOjIwcHg7cGFkZGluZy1ib3R0b206MTVweDtib3JkZXItYm90dG9tOjNweCBzb2xpZCAke2hDb2xvcn07Ij4KICAgICAgICAgICAgICAgICR7cy5sb2dvID8gYDxpbWcgc3JjPSIke3MubG9nb30iIHN0eWxlPSJtYXgtaGVpZ2h0OjcwcHg7b2JqZWN0LWZpdDpjb250YWluO2Rpc3BsYXk6YmxvY2s7bWFyZ2luOjAgYXV0byA4cHg7LXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6ZXhhY3Q7cHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0OyI+YCA6ICcnfQogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEuM3JlbTtmb250LXdlaWdodDo5MDA7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO2xldHRlci1zcGFjaW5nOjJweDtjb2xvcjoke2hDb2xvcn07Ij4ke3NjaG9vbH08L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTouODJyZW07Y29sb3I6IzY2NjttYXJnaW4tdG9wOjJweDsiPiR7c3VidGl0bGV9JHtjaXR5ID8gJyDigJQgJyArIGNpdHkgOiAnJ308L2Rpdj4KICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICB9IGVsc2UgaWYgKGxheW91dCA9PT0gJ2JhbmRlYXUnKSB7CiAgICAgICAgICAgIGhlYWRlckh0bWwgPSBgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDoke2hDb2xvcn07Y29sb3I6d2hpdGU7cGFkZGluZzoxNHB4IDIwcHg7bWFyZ2luLWJvdHRvbToyMHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjE2cHg7LXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6ZXhhY3Q7cHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0OyI+CiAgICAgICAgICAgICAgICAke3MubG9nbyA/IGA8aW1nIHNyYz0iJHtzLmxvZ299IiBzdHlsZT0ibWF4LWhlaWdodDo1MnB4O21heC13aWR0aDoxMDBweDtvYmplY3QtZml0OmNvbnRhaW47YmFja2dyb3VuZDp3aGl0ZTtwYWRkaW5nOjRweDtib3JkZXItcmFkaXVzOjVweDtmbGV4LXNocmluazowOy13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0O3ByaW50LWNvbG9yLWFkanVzdDpleGFjdDsiPmAgOiAnJ30KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZsZXg6MTsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxLjFyZW07Zm9udC13ZWlnaHQ6OTAwO3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTtsZXR0ZXItc3BhY2luZzoxLjVweDsiPiR7c2Nob29sfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTouNzVyZW07b3BhY2l0eTouODU7bWFyZ2luLXRvcDoycHg7Ij4ke3N1YnRpdGxlfSR7Y2l0eSA/ICcg4oCUICcgKyBjaXR5IDogJyd9PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBDbGFzc2lxdWUKICAgICAgICAgICAgaGVhZGVySHRtbCA9IGA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6ZmxleC1zdGFydDttYXJnaW4tYm90dG9tOjIwcHg7Ym9yZGVyLWJvdHRvbToxLjVweCBzb2xpZCAjMDAwO3BhZGRpbmctYm90dG9tOjE1cHg7Ij4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7Zm9udC1zaXplOjEuMnJlbTsiPiR7c2Nob29sfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTouODJyZW07Y29sb3I6IzU1NTttYXJnaW4tdG9wOjJweDsiPiR7c3VidGl0bGV9JHtjaXR5ID8gJyDigJQgJyArIGNpdHkgOiAnJ308L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdj4ke2xvZ29UYWd9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InByaW50LXBhZ2UiPgogICAgICAgICAgICAke2hlYWRlckh0bWx9CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9mZmljaWFsLW1ldGEiPiR7ZGF0ZVN0cn08L2Rpdj4KICAgICAgICAgICAgPGgyIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPiR7dGl0bGV9PC9oMj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ib2ZmaWNpYWwtc3ViamVjdCI+T0JKRVTCoDogJHt0eXBlfTwvZGl2PgogICAgICAgICAgICAke3BTdHIgPyBgPGRpdiBjbGFzcz0ib2ZmaWNpYWwtcGFydGljaXBhbnRzIj4ke3BTdHJ9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJvZmZpY2lhbC1jb250ZW50Ij4ke2JvZHl9PC9kaXY+CiAgICAgICAgICAgICR7YXR0SHRtbH0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ib2ZmaWNpYWwtZm9vdGVyIj4ke3NpZ308c3Ryb25nPiR7dXNlcn08L3N0cm9uZz48L2Rpdj4KICAgICAgICA8L2Rpdj5gOwogICAgfQoKICAgIAogICAgCiAgICBmdW5jdGlvbiBydGVJbnNlcnRMb2dvKCkgewogICAgICAgIHZhciBsb2dvID0gYXBwRGF0YS5zZXR0aW5ncyAmJiBhcHBEYXRhLnNldHRpbmdzLmxvZ287CiAgICAgICAgaWYgKCFsb2dvKSB7IGFsZXJ0KCdBdWN1biBsb2dvIGTDqWZpbmkuIEFqb3V0ZXogdW4gbG9nbyBkYW5zIGxlcyBQYXJhbcOodHJlcy4nKTsgcmV0dXJuOyB9CiAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydEhUTUwnLCBmYWxzZSwgJzxpbWcgc3JjPSInK2xvZ28rJyIgY2xhc3M9InJ0ZS1sb2dvLWltZyIgc3R5bGU9Im1heC1oZWlnaHQ6NjBweDttYXgtd2lkdGg6MTIwcHg7dmVydGljYWwtYWxpZ246bWlkZGxlOyIgYWx0PSJMb2dvIj4nKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJ0ZUNvbG9yKGJ0bikgewogICAgICAgIHZhciBleGlzdGluZyA9IGJ0bi5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ydGUtY29sb3ItcG9wJyk7CiAgICAgICAgaWYgKGV4aXN0aW5nKSB7IGV4aXN0aW5nLnJlbW92ZSgpOyByZXR1cm47IH0KICAgICAgICB2YXIgY29sb3JzID0gWycjMDAwMDAwJywnI2U3NGMzYycsJyNlNjdlMjInLCcjZjFjNDBmJywnIzI3YWU2MCcsJyMyOTgwYjknLCcjOGU0NGFkJywnIzJjM2U1MCcsJyM5NWE1YTYnLCcjMWFiYzljJywnI2QzNTQwMCcsJyNjMDM5MmInLCcjMTZhMDg1JywnIzJlY2M3MScsJyMzNDk4ZGInLCcjOWI1OWI2J107CiAgICAgICAgdmFyIHBvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHBvcC5jbGFzc05hbWUgPSAncnRlLWNvbG9yLXBvcCc7CiAgICAgICAgY29sb3JzLmZvckVhY2goZnVuY3Rpb24oYykgewogICAgICAgICAgICB2YXIgc3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgc3cuY2xhc3NOYW1lID0gJ3J0ZS1jb2xvci1zdyc7CiAgICAgICAgICAgIHN3LnN0eWxlLmJhY2tncm91bmQgPSBjOwogICAgICAgICAgICBzdy5vbmNsaWNrID0gZnVuY3Rpb24oZSkgeyBlLnN0b3BQcm9wYWdhdGlvbigpOyBkb2N1bWVudC5leGVjQ29tbWFuZCgnZm9yZUNvbG9yJywgZmFsc2UsIGMpOyBwb3AucmVtb3ZlKCk7IH07CiAgICAgICAgICAgIHBvcC5hcHBlbmRDaGlsZChzdyk7CiAgICAgICAgfSk7CiAgICAgICAgYnRuLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgICAgICBidG4uYXBwZW5kQ2hpbGQocG9wKTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gaGFuZGxlcihlKXsgaWYoIXBvcC5jb250YWlucyhlLnRhcmdldCkpe3BvcC5yZW1vdmUoKTtkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsaGFuZGxlcik7fSB9LCB7b25jZTpmYWxzZX0pOyB9LDEwKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJ0ZUxpbmsoYnRuKSB7CiAgICAgICAgdmFyIHVybCA9IHByb21wdCgnVVJMIGR1IGxpZW4gOicsJ2h0dHBzOi8vJyk7CiAgICAgICAgaWYgKHVybCkgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NyZWF0ZUxpbmsnLCBmYWxzZSwgdXJsKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3YWl0Rm9ySW1hZ2VzVGhlblByaW50KCkgewogICAgICAgIHZhciB6b25lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByaW50LXpvbmUnKTsKICAgICAgICB2YXIgaW1ncyA9IHpvbmUucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7CiAgICAgICAgaWYgKGltZ3MubGVuZ3RoID09PSAwKSB7IHdpbmRvdy5wcmludCgpOyByZXR1cm47IH0KICAgICAgICB2YXIgbG9hZGVkID0gMDsKICAgICAgICB2YXIgdG90YWwgPSBpbWdzLmxlbmd0aDsKICAgICAgICB2YXIgZG9uZSA9IGZhbHNlOwogICAgICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsgaWYgKCFkb25lKSB7IGRvbmUgPSB0cnVlOyB3aW5kb3cucHJpbnQoKTsgfSB9LCAyMDAwKTsKICAgICAgICBpbWdzLmZvckVhY2goZnVuY3Rpb24oaW1nKSB7CiAgICAgICAgICAgIGlmIChpbWcuY29tcGxldGUgJiYgaW1nLm5hdHVyYWxIZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICBsb2FkZWQrKzsKICAgICAgICAgICAgICAgIGlmIChsb2FkZWQgPj0gdG90YWwgJiYgIWRvbmUpIHsgZG9uZSA9IHRydWU7IGNsZWFyVGltZW91dCh0aW1lb3V0KTsgd2luZG93LnByaW50KCk7IH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBpbWcub25lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGxvYWRlZCsrOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2FkZWQgPj0gdG90YWwgJiYgIWRvbmUpIHsgZG9uZSA9IHRydWU7IGNsZWFyVGltZW91dCh0aW1lb3V0KTsgd2luZG93LnByaW50KCk7IH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAvLyBGb3JjZSByZWxvYWQgZm9yIGJhc2U2NCBpbWFnZXMKICAgICAgICAgICAgICAgIGlmIChpbWcuc3JjICYmIGltZy5zcmMuaW5kZXhPZignZGF0YTonKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHZhciBzcmMgPSBpbWcuc3JjOwogICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpbWcuc3JjID0gc3JjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJpbnRDdXJyZW50Rm9ybShtb2RlKSB7CiAgICAgICAgbGV0IHRpdGxlLCBkYXRlLCB0eXBlLCBib2R5LCBwU3RyPSIiLCBhdHRzPVtdOwogICAgICAgIGlmKG1vZGUgPT09ICdFTlQnKSB7CiAgICAgICAgICAgIHRpdGxlID0gIkNvbXB0ZS1SZW5kdSBkJ0VudHJldGllbiI7IGRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW50LWRhdGUnKS52YWx1ZTsgdHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbnQtdHlwZScpLnZhbHVlICsgIiAtICIgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW50LW9iamV0JykudmFsdWU7IGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW50LWNvbnRlbnUnKS5pbm5lckhUTUw7CiAgICAgICAgICAgIGxldCBzID0gZ2V0TXVsdGlEYXRhKCdlbnQtc3R1ZGVudHMtY29udGFpbmVyJywgJ2VudC1zdHVkZW50Jyk7IGxldCB0ID0gZ2V0TXVsdGlEYXRhKCdlbnQtdGVhY2hlcnMtY29udGFpbmVyJywgJ2VudC10ZWFjaGVyJyk7CiAgICAgICAgICAgIGlmKHMubGVuZ3RoKSBwU3RyICs9ICI8c3Ryb25nPsOJbMOodmVzIGNvbmNlcm7DqXMgOjwvc3Ryb25nPiAiICsgcy5tYXAoeD0+eC5uYW1lKS5qb2luKCcsICcpICsgIjxicj4iOwogICAgICAgICAgICBpZih0Lmxlbmd0aCkgcFN0ciArPSAiPHN0cm9uZz5QcsOpc2VudHMgOjwvc3Ryb25nPiAiICsgdC5tYXAoeD0+eC5uYW1lKS5qb2luKCcsICcpOwogICAgICAgICAgICBhdHRzID0gZ2V0QXR0YWNobWVudHNEYXRhKCdlbnQtYXR0YWNobWVudHMnKTsKICAgICAgICB9IGVsc2UgaWYobW9kZSA9PT0gJ1JFVScpIHsKICAgICAgICAgICAgdGl0bGUgPSAiQ29tcHRlLVJlbmR1IGRlIFLDqXVuaW9uIjsgZGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXUtZGF0ZScpLnZhbHVlOyB0eXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JldS10eXBlJykudmFsdWU7IGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV1LWNvbnRlbnUnKS5pbm5lckhUTUw7CiAgICAgICAgICAgIGxldCBzID0gZ2V0TXVsdGlEYXRhKCdyZXUtc3R1ZGVudHMtY29udGFpbmVyJywgJ3JldS1zdHVkZW50Jyk7IGxldCB0ID0gZ2V0TXVsdGlEYXRhKCdyZXUtdGVhY2hlcnMtY29udGFpbmVyJywgJ3JldS10ZWFjaGVyJyk7CiAgICAgICAgICAgIGlmKHMubGVuZ3RoKSBwU3RyICs9ICI8c3Ryb25nPsOJbMOodmVzIGNvbmNlcm7DqXMgOjwvc3Ryb25nPiAiICsgcy5tYXAoeD0+eC5uYW1lKS5qb2luKCcsICcpICsgIjxicj4iOwogICAgICAgICAgICBpZih0Lmxlbmd0aCkgcFN0ciArPSAiPHN0cm9uZz5QYXJ0aWNpcGFudHMgOjwvc3Ryb25nPiAiICsgdC5tYXAoeD0+eC5uYW1lKS5qb2luKCcsICcpOwogICAgICAgICAgICBhdHRzID0gZ2V0QXR0YWNobWVudHNEYXRhKCdyZXUtYXR0YWNobWVudHMnKTsKICAgICAgICB9IGVsc2UgaWYobW9kZSA9PT0gJ1BSRVBfRElSJykgewogICAgICAgICAgICB0aXRsZSA9ICJSw6l1bmlvbiBkZSBEaXJlY3Rpb24iOyBkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1kYXRlJykudmFsdWU7IHR5cGUgPSAiQ29tcHRlLXJlbmR1IjsgcFN0ciA9ICI8c3Ryb25nPlByw6lzZW50cyA6PC9zdHJvbmc+ICIgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyLXBhcnRzJykudmFsdWU7CiAgICAgICAgICAgIGJvZHkgPSBgPGgzPk9SRFJFIERVIEpPVVI8L2gzPiR7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpci1jb250ZW51JykuaW5uZXJIVE1MfTxkaXYgY2xhc3M9InByaW50LXNlcGFyYXRvciIgc3R5bGU9Im1hcmdpbjoyMHB4IDA7IGJvcmRlci10b3A6MXB4IGRhc2hlZCAjY2NjIj48L2Rpdj48aDM+Tk9URVMgJiBEw4lDSVNJT05TPC9oMz4ke2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXItbm90ZXMnKS5pbm5lckhUTUx9YDsKICAgICAgICAgICAgYXR0cyA9IGdldEF0dGFjaG1lbnRzRGF0YSgnZGlyLWF0dGFjaG1lbnRzJyk7CiAgICAgICAgfSBlbHNlIGlmKG1vZGUgPT09ICdTVUlWSScpIHsKICAgICAgICAgICAgdGl0bGUgPSAiUG9pbnQgU3Vpdmkgw4lsw6h2ZSI7IGRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktZGF0ZScpLnZhbHVlOyB0eXBlID0gIkNvb3JkaW5hdGlvbiBDUEUgLyBEaXJlY3Rpb24iOyBwU3RyID0gIjxzdHJvbmc+UGFydGljaXBhbnRzIDo8L3N0cm9uZz4gIiArIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWl2aS1wYXJ0cycpLnZhbHVlICsgIiB8IDxzdHJvbmc+Tml2ZWF1eCA6PC9zdHJvbmc+ICIgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VpdmktY2xhc3NlcycpLnZhbHVlOwogICAgICAgICAgICBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1aXZpLWNvbnRlbnUnKS5pbm5lckhUTUw7CiAgICAgICAgICAgIGF0dHMgPSBnZXRBdHRhY2htZW50c0RhdGEoJ3N1aXZpLWF0dGFjaG1lbnRzJyk7CiAgICAgICAgfQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmludC16b25lJykuaW5uZXJIVE1MID0gZ2VuZXJhdGVPZmZpY2lhbFByaW50KHRpdGxlLCBkYXRlLCB0eXBlLCBwU3RyLCBib2R5LCBhdHRzKTsKICAgICAgICB3YWl0Rm9ySW1hZ2VzVGhlblByaW50KCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJpbnRTYXZlZERvYyh0eXBlLCBpZCkgewogICAgICAgIGxldCBpdCwgdGl0bGUsIHN1YiwgYm9keSwgcFN0cj0iIjsKICAgICAgICBpZih0eXBlPT09J0VOVCcpIHsgaXQgPSBhcHBEYXRhLmVudHJldGllbnMuZmluZCh4PT54LmlkLnRvU3RyaW5nKCk9PT1pZC50b1N0cmluZygpKTsgdGl0bGU9IkVudHJldGllbiI7IHN1Yj1pdC50eXBlKyIgLSAiK2l0Lm9iamV0OyBib2R5PWl0LmJvZHk7IGlmKGl0LnN0dWRlbnRzLmxlbmd0aCkgcFN0cis9IjxzdHJvbmc+w4lsw6h2ZXMgOjwvc3Ryb25nPiAiK2l0LnN0dWRlbnRzLm1hcCh4PT54Lm5hbWUpLmpvaW4oJywgJykrIjxicj4iOyBpZihpdC50ZWFjaGVycy5sZW5ndGgpIHBTdHIrPSI8c3Ryb25nPlByw6lzZW50cyA6PC9zdHJvbmc+ICIraXQudGVhY2hlcnMubWFwKHg9PngubmFtZSkuam9pbignLCAnKTsgfSAKICAgICAgICBlbHNlIGlmICh0eXBlPT09J1JFVScpIHsgaXQgPSBhcHBEYXRhLnJldW5pb25zLmZpbmQoeD0+eC5pZC50b1N0cmluZygpPT09aWQudG9TdHJpbmcoKSk7IGlmKGl0LnR5cGUgPT09ICJSw6l1bmlvbiBkZSBEaXJlY3Rpb24iKSB7IHRpdGxlPSJEaXJlY3Rpb24iOyBzdWI9IkNvbXB0ZS1yZW5kdSI7IHBTdHI9IjxzdHJvbmc+UHLDqXNlbnRzIDo8L3N0cm9uZz4gIisoaXQucGFydHMgfHwgIiIpOyBib2R5ID0gYDxoMz5PREo8L2gzPiR7aXQub2RqfTxkaXYgY2xhc3M9InByaW50LXNlcGFyYXRvciIgc3R5bGU9Im1hcmdpbjoyMHB4IDA7IGJvcmRlci10b3A6MXB4IGRhc2hlZCAjY2NjIj48L2Rpdj48aDM+Tk9URVM8L2gzPiR7aXQuY3J9YDsgfSBlbHNlIHsgdGl0bGU9IlLDqXVuaW9uIjsgc3ViPWl0LnR5cGU7IGJvZHk9aXQuYm9keTsgaWYoaXQuc3R1ZGVudHMubGVuZ3RoKSBwU3RyKz0iPHN0cm9uZz7DiWzDqHZlcyA6PC9zdHJvbmc+ICIraXQuc3R1ZGVudHMubWFwKHg9PngubmFtZSkuam9pbignLCAnKSsiPGJyPiI7IGlmKGl0LnRlYWNoZXJzLmxlbmd0aCkgcFN0cis9IjxzdHJvbmc+UGFydGljaXBhbnRzIDo8L3N0cm9uZz4gIitpdC50ZWFjaGVycy5tYXAoeD0+eC5uYW1lKS5qb2luKCcsICcpOyB9IH0gCiAgICAgICAgZWxzZSBpZiAodHlwZT09PSdTVUlWSScpIHsgaXQgPSBhcHBEYXRhLnN1aXZpRWxldmVzLmZpbmQoeD0+eC5pZC50b1N0cmluZygpPT09aWQudG9TdHJpbmcoKSk7IHRpdGxlPSJTdWl2aSI7IHN1Yj0iUG9pbnQgQ1BFIjsgYm9keT1pdC5ib2R5OyBwU3RyID0gIjxzdHJvbmc+UGFydGljaXBhbnRzIDo8L3N0cm9uZz4gIitpdC5wYXJ0aWNpcGFudHMrIiB8IDxzdHJvbmc+Tml2ZWF1eCA6PC9zdHJvbmc+ICIraXQuY2xhc3NlczsgfQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmludC16b25lJykuaW5uZXJIVE1MID0gZ2VuZXJhdGVPZmZpY2lhbFByaW50KHRpdGxlLCBpdC5kYXRlLCBzdWIsIHBTdHIsIGJvZHksIGl0LmF0dGFjaG1lbnRzKTsgd2FpdEZvckltYWdlc1RoZW5QcmludCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByaW50QWxsSGlzdG9yeSgpIHsKICAgICAgICBjb25zdCBsaXN0ID0gZ2V0SGlzdG9yeUxpc3QoKTsgaWYoIWxpc3QubGVuZ3RoKSByZXR1cm47CiAgICAgICAgbGV0IGh0bWwgPSAiIjsKICAgICAgICBsaXN0LmZvckVhY2goaSA9PiB7CiAgICAgICAgICAgIGxldCB0aXRsZSwgc3ViLCBib2R5LCBwU3RyPSIiOwogICAgICAgICAgICBpZihpLnQ9PT0nRU5UJykgeyB0aXRsZT0iRW50cmV0aWVuIjsgc3ViPWkuZC50eXBlKyIgLSAiK2kuZC5vYmpldDsgYm9keT1pLmQuYm9keTsgaWYoaS5kLnN0dWRlbnRzLmxlbmd0aCkgcFN0cis9IsOJbMOodmVzIDogIitpLmQuc3R1ZGVudHMubWFwKHg9PngubmFtZSkuam9pbignLCAnKSsiPGJyPiI7IGlmKGkuZC50ZWFjaGVycy5sZW5ndGgpIHBTdHIrPSJQcsOpc2VudHMgOiAiK2kuZC50ZWFjaGVycy5tYXAoeD0+eC5uYW1lKS5qb2luKCcsICcpOyB9IAogICAgICAgICAgICBlbHNlIGlmIChpLnQ9PT0nUkVVJykgeyBpZihpLmQudHlwZSA9PT0gIlLDqXVuaW9uIGRlIERpcmVjdGlvbiIpIHsgdGl0bGU9IkRpcmVjdGlvbiI7IHN1Yj0iQ29tcHRlLXJlbmR1IjsgcFN0cj0iUHLDqXNlbnRzIDogIisoaS5kLnBhcnRzIHx8ICIiKTsgYm9keSA9IGA8aDM+T0RKPC9oMz4ke2kuZC5vZGp9PGRpdiBzdHlsZT0ibWFyZ2luOjIwcHggMDsgYm9yZGVyLXRvcDoxcHggZGFzaGVkICNjY2MiPjwvZGl2PjxoMz5DUjwvaDM+JHtpLmQuY3J9YDsgfSBlbHNlIHsgdGl0bGU9IlLDqXVuaW9uIjsgc3ViPWkuZC50eXBlOyBib2R5PWkuZC5ib2R5OyBpZihpLmQuc3R1ZGVudHMubGVuZ3RoKSBwU3RyKz0iw4lsw6h2ZXMgOiAiK2kuZC5zdHVkZW50cy5tYXAoeD0+eC5uYW1lKS5qb2luKCcsICcpKyI8YnI+IjsgaWYoaS5kLnRlYWNoZXJzLmxlbmd0aCkgcFN0cis9IlBhcnRpY2lwYW50cyA6ICIraS5kLnRlYWNoZXJzLm1hcCh4PT54Lm5hbWUpLmpvaW4oJywgJyk7IH0gfSAKICAgICAgICAgICAgZWxzZSBpZiAoaS50PT09J1NVSVZJJykgeyB0aXRsZT0iU3VpdmkiOyBzdWI9IlBvaW50IENQRSI7IGJvZHk9aS5kLmJvZHk7IHBTdHIgPSAiUGFydGljaXBhbnRzIDogIitpLmQucGFydGljaXBhbnRzKyIgfCBDbGFzc2VzIDogIitpLmQuY2xhc3NlczsgfQogICAgICAgICAgICBodG1sICs9IGdlbmVyYXRlT2ZmaWNpYWxQcmludCh0aXRsZSwgaS5kLmRhdGUsIHN1YiwgcFN0ciwgYm9keSwgaS5kLmF0dGFjaG1lbnRzKTsKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJpbnQtem9uZScpLmlubmVySFRNTCA9IGh0bWw7IHdhaXRGb3JJbWFnZXNUaGVuUHJpbnQoKTsKICAgIH0KCiAgICAvLyAtLS0gSElTVE9SWSBSRU5ERVIgLS0tCiAgICBmdW5jdGlvbiBnZXRIaXN0b3J5TGlzdCgpIHsKICAgICAgICBjb25zdCBxID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaC1zdHVkZW50JykudmFsdWUudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgICAgY29uc3QgZiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gtdHlwZScpLnZhbHVlOwogICAgICAgIGxldCBsaXN0ID0gW107CiAgICAgICAgY29uc3QgaXNNID0gKGl0KSA9PiB7CiAgICAgICAgICAgIGlmICghcSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChpdC50eXBlPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpIHx8IGl0Lm9iamV0Py50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpIHx8IGl0Lm9kaj8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKSB8fCBpdC5ib2R5Py50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpIHx8IGl0LmNyPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpIHx8IGl0LnBhcnRpY2lwYW50cz8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKSB8fCBpdC5wYXJ0cz8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChpdC5zdHVkZW50cz8uc29tZShzID0+IHMubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpKSB8fCBpdC50ZWFjaGVycz8uc29tZSh0ID0+IHQubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9OwogICAgICAgIGlmKGY9PT0iQUxMInx8Zj09PSJFTlQiKSBhcHBEYXRhLmVudHJldGllbnMuZm9yRWFjaChlPT57IGlmKGlzTShlKSkgbGlzdC5wdXNoKHt0OidFTlQnLGQ6ZSx0aW1lOm5ldyBEYXRlKGUuZGF0ZSkuZ2V0VGltZSgpfSk7IH0pOwogICAgICAgIGlmKGY9PT0iQUxMInx8Zj09PSJSRVUifHxmPT09IkRJUiIpIGFwcERhdGEucmV1bmlvbnMuZm9yRWFjaChyPT57IGNvbnN0IGlzRCA9IHIudHlwZT09PSJSw6l1bmlvbiBkZSBEaXJlY3Rpb24iOyBpZihmPT09IkRJUiIgJiYgIWlzRCkgcmV0dXJuOyBpZihmPT09IlJFVSIgJiYgaXNEKSByZXR1cm47IGlmKGlzTShyKSkgbGlzdC5wdXNoKHt0OidSRVUnLGQ6cix0aW1lOm5ldyBEYXRlKHIuZGF0ZSkuZ2V0VGltZSgpfSk7IH0pOwogICAgICAgIGlmKGY9PT0iQUxMInx8Zj09PSJTVUlWSSIpIGFwcERhdGEuc3VpdmlFbGV2ZXMuZm9yRWFjaChzdT0+eyBpZihpc00oc3UpKSBsaXN0LnB1c2goe3Q6J1NVSVZJJyxkOnN1LHRpbWU6bmV3IERhdGUoc3UuZGF0ZSkuZ2V0VGltZSgpfSk7IH0pOwogICAgICAgIHJldHVybiBsaXN0LnNvcnQoKGEsYik9PmIudGltZS1hLnRpbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbmRlckhpc3RvcnkoKSB7CiAgICAgICAgY29uc3QgbGlzdCA9IGdldEhpc3RvcnlMaXN0KCk7IGNvbnN0IHRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2hpc3RvcnktdGFibGUgdGJvZHknKTsgdGJvZHkuaW5uZXJIVE1MPSIiOwogICAgICAgIGlmKCFsaXN0Lmxlbmd0aCkgeyB0Ym9keS5pbm5lckhUTUw9Ijx0cj48dGQgY29sc3Bhbj0nNCcgc3R5bGU9J3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOiM5OTk7cGFkZGluZzoyMHB4Jz5BdWN1biBkb2N1bWVudDwvdGQ+PC90cj4iOyByZXR1cm47IH0KICAgICAgICBsaXN0LmZvckVhY2goaT0+ewogICAgICAgICAgICBsZXQgZHRsID0gIiI7CiAgICAgICAgICAgIGlmKGkudD09PSdFTlQnKSB7CiAgICAgICAgICAgICAgICB2YXIgX2VzID0gKGkuZC5zdHVkZW50c3x8W10pLm1hcChzPT5zLm5hbWUpLmZpbHRlcihCb29sZWFuKTsKICAgICAgICAgICAgICAgIHZhciBfZXQgPSAoaS5kLnRlYWNoZXJzfHxbXSkubWFwKHQ9PnQubmFtZSkuZmlsdGVyKEJvb2xlYW4pOwogICAgICAgICAgICAgICAgZHRsID0gJzxzdHJvbmc+JytpLmQub2JqZXQrJzwvc3Ryb25nPjxicj4nOwogICAgICAgICAgICAgICAgaWYoX2VzLmxlbmd0aCkgZHRsICs9ICc8c21hbGw+PGkgY2xhc3M9ImZhcyBmYS11c2VyLWdyYWR1YXRlIiBzdHlsZT0iY29sb3I6I2U2N2UyMjttYXJnaW4tcmlnaHQ6M3B4Ij48L2k+JytfZXMuam9pbignLCAnKSsnPC9zbWFsbD4nOwogICAgICAgICAgICAgICAgaWYoX2V0Lmxlbmd0aCkgZHRsICs9ICc8YnI+PHNtYWxsPjxpIGNsYXNzPSJmYXMgZmEtY2hhbGtib2FyZC10ZWFjaGVyIiBzdHlsZT0iY29sb3I6IzI5ODBiOTttYXJnaW4tcmlnaHQ6M3B4Ij48L2k+JytfZXQuam9pbignLCAnKSsnPC9zbWFsbD4nOwogICAgICAgICAgICB9IGVsc2UgaWYoaS50PT09J1JFVScpIHsKICAgICAgICAgICAgICAgIHZhciBfcnMgPSAoaS5kLnN0dWRlbnRzfHxbXSkubWFwKHM9PnMubmFtZSkuZmlsdGVyKEJvb2xlYW4pOwogICAgICAgICAgICAgICAgdmFyIF9ydCA9IChpLmQudGVhY2hlcnN8fFtdKS5tYXAodD0+dC5uYW1lKS5maWx0ZXIoQm9vbGVhbik7CiAgICAgICAgICAgICAgICB2YXIgX2hkciA9IGkuZC50eXBlPT09IlLDqXVuaW9uIGRlIERpcmVjdGlvbiI/IkRpcmVjdGlvbiI6KGkuZC5vZGp8fCcnKS5yZXBsYWNlKC88W14+XSo+L2csICcnKS5zdWJzdHJpbmcoMCw1MCk7CiAgICAgICAgICAgICAgICBkdGwgPSAnPHN0cm9uZz4nK19oZHIrJzwvc3Ryb25nPjxicj4nOwogICAgICAgICAgICAgICAgaWYoX3JzLmxlbmd0aCkgZHRsICs9ICc8c21hbGw+PGkgY2xhc3M9ImZhcyBmYS11c2VyLWdyYWR1YXRlIiBzdHlsZT0iY29sb3I6I2U2N2UyMjttYXJnaW4tcmlnaHQ6M3B4Ij48L2k+JytfcnMuam9pbignLCAnKSsnPC9zbWFsbD4nOwogICAgICAgICAgICAgICAgaWYoX3J0Lmxlbmd0aCkgZHRsICs9ICc8YnI+PHNtYWxsPjxpIGNsYXNzPSJmYXMgZmEtY2hhbGtib2FyZC10ZWFjaGVyIiBzdHlsZT0iY29sb3I6IzI5ODBiOTttYXJnaW4tcmlnaHQ6M3B4Ij48L2k+JytfcnQuam9pbignLCAnKSsnPC9zbWFsbD4nOwogICAgICAgICAgICAgICAgaWYoIV9ycy5sZW5ndGggJiYgIV9ydC5sZW5ndGggJiYgaS5kLnBhcnRzKSBkdGwgKz0gJzxzbWFsbD4nK2kuZC5wYXJ0cysnPC9zbWFsbD4nOwogICAgICAgICAgICB9IGVsc2UgaWYoaS50PT09J1NVSVZJJykgZHRsID0gJzxzdHJvbmc+Q2xhc3NlcyA6ICcraS5kLmNsYXNzZXMrJzwvc3Ryb25nPjxicj48c21hbGw+JytpLmQucGFydGljaXBhbnRzKyc8L3NtYWxsPic7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBoYXNBdHQgPSAoaS5kLmF0dGFjaG1lbnRzICYmIGkuZC5hdHRhY2htZW50cy5sZW5ndGggPiAwKSA/ICc8aSBjbGFzcz0iZmFzIGZhLXBhcGVyY2xpcCIgc3R5bGU9ImNvbG9yOiM3ZjhjOGQ7IG1hcmdpbi1sZWZ0OjVweDsiPjwvaT4nIDogJyc7CgogICAgICAgICAgICB0Ym9keS5pbm5lckhUTUwgKz0gYDx0cj48dGQ+JHtuZXcgRGF0ZShpLmQuZGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicpfTwvdGQ+PHRkPjxzcGFuIGNsYXNzPSJiYWRnZSAke2kudD09PSdFTlQnPydiZy1lbnQnOihpLnQ9PT0nU1VJVkknPydiZy1zdWl2aSc6KGkuZC50eXBlLmluY2x1ZGVzKCdEaXInKT8nYmctZGlyJzonYmctcmV1JykpfSI+JHtpLmQudHlwZX08L3NwYW4+JHtoYXNBdHR9PC90ZD48dGQ+JHtkdGx9PC90ZD48dGQ+PGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi13YXJuaW5nIGJ0bi1zbSIgb25jbGljaz0ibG9hZEl0ZW1Gb3JFZGl0KCcke2kudH0nLCAnJHtpLmQuaWR9JykiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+PC9idXR0b24+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGFyayBidG4tc20iIG9uY2xpY2s9InByaW50U2F2ZWREb2MoJyR7aS50fScsJyR7aS5kLmlkfScpIj48aSBjbGFzcz0iZmFzIGZhLXByaW50Ij48L2k+PC9idXR0b24+IDxidXR0b24gY2xhc3M9ImJ0biBidG4tZGFuZ2VyIGJ0bi1zbSIgb25jbGljaz0iZGVsZXRlSXRlbSgnJHtpLnQ9PT0nRU5UJz8nZW50cmV0aWVucyc6KGkudD09PSdSRVUnPydyZXVuaW9ucyc6J3N1aXZpRWxldmVzJyl9Jywke2kuZC5pZH0pIj48aSBjbGFzcz0iZmFzIGZhLXRyYXNoIj48L2k+PC9idXR0b24+PC90ZD48L3RyPmA7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gLS0tIERBU0hCT0FSRCAmIFNUQVRTIC0tLQogICAgZnVuY3Rpb24gcmVuZGVyRGFzaGJvYXJkKCkgewogICAgICAgIGNvbnN0IHRzID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2twaS1lbnQnKS5pbm5lclRleHQgPSBhcHBEYXRhLmVudHJldGllbnMubGVuZ3RoOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdrcGktcmV1JykuaW5uZXJUZXh0ID0gYXBwRGF0YS5yZXVuaW9ucy5maWx0ZXIocj0+ci50eXBlIT09IlLDqXVuaW9uIGRlIERpcmVjdGlvbiIpLmxlbmd0aDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna3BpLWRpcicpLmlubmVyVGV4dCA9IGFwcERhdGEucmV1bmlvbnMuZmlsdGVyKHI9PnIudHlwZT09PSJSw6l1bmlvbiBkZSBEaXJlY3Rpb24iKS5sZW5ndGg7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2twaS1zdWl2aScpLmlubmVyVGV4dCA9IGFwcERhdGEuc3VpdmlFbGV2ZXMubGVuZ3RoOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdrcGktdG9kbycpLmlubmVyVGV4dCA9IGFwcERhdGEudG9kby51cmdlbnQubGVuZ3RoOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdrcGktY2FsJykuaW5uZXJUZXh0ID0gYXBwRGF0YS5jYWxlbmRhci5maWx0ZXIoYz0+Yy5kYXRlPj10cykubGVuZ3RoOwogICAgICAgIAogICAgICAgIHJlbmRlckNoYXJ0KCdjaGFydFR5cGVzJywgJ2RvdWdobnV0JywgeyAKICAgICAgICAgICAgbGFiZWxzOiBbJ1VyZ2VuY2VzJywgJ0RpcmVjdGlvbicsICdFbnRyZXRpZW5zJywgJ1LDqXVuaW9ucycsICdBZ2VuZGEnLCAnU3VpdmknXSwgCiAgICAgICAgICAgIGRhdGFzZXRzOiBbeyAKICAgICAgICAgICAgICAgIGRhdGE6IFthcHBEYXRhLnRvZG8udXJnZW50Lmxlbmd0aCwgYXBwRGF0YS5yZXVuaW9ucy5maWx0ZXIocj0+ci50eXBlPT09IlLDqXVuaW9uIGRlIERpcmVjdGlvbiIpLmxlbmd0aCwgYXBwRGF0YS5lbnRyZXRpZW5zLmxlbmd0aCwgYXBwRGF0YS5yZXVuaW9ucy5maWx0ZXIocj0+ci50eXBlIT09IlLDqXVuaW9uIGRlIERpcmVjdGlvbiIpLmxlbmd0aCwgYXBwRGF0YS5jYWxlbmRhci5sZW5ndGgsIGFwcERhdGEuc3VpdmlFbGV2ZXMubGVuZ3RoXSwgCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFsnI2U3NGMzYycsJyMyYzNlNTAnLCcjYzAzOTJiJywnIzI3YWU2MCcsJyNmMzljMTInLCcjMjk4MGI5J10gCiAgICAgICAgICAgIH1dIAogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGNvbnN0IHN0ID0gZ2V0TW9udGhseVN0YXRzKCk7IAogICAgICAgIHJlbmRlckNoYXJ0KCdjaGFydE1vbnRobHknLCAnbGluZScsIHsgbGFiZWxzOiBzdC5sYWJlbHMsIGRhdGFzZXRzOiBbeyBsYWJlbDogJ0FjdGl2aXTDqXMnLCBkYXRhOiBzdC52YWx1ZXMsIGJvcmRlckNvbG9yOiAnIzI5ODBiOScsIGZpbGw6IHRydWUsIHRlbnNpb246IDAuMyB9XSB9KTsKICAgICAgICByZW5kZXJUb3BTdHVkZW50cygpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbmRlclRvcFN0dWRlbnRzKCkgewogICAgICAgIGNvbnN0IGNvdW50cyA9IHt9OwogICAgICAgIFsuLi5hcHBEYXRhLmVudHJldGllbnMsIC4uLmFwcERhdGEucmV1bmlvbnNdLmZvckVhY2goaXQgPT4gewogICAgICAgICAgICBpZihpdC5zdHVkZW50cykgewogICAgICAgICAgICAgICAgaXQuc3R1ZGVudHMuZm9yRWFjaChzID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gcy5uYW1lLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZihuYW1lKSBjb3VudHNbbmFtZV0gPSAoY291bnRzW25hbWVdIHx8IDApICsgMTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgc29ydGVkID0gT2JqZWN0LmVudHJpZXMoY291bnRzKS5zb3J0KChhLGIpID0+IGJbMV0gLSBhWzFdKS5zbGljZSgwLCA1KTsKICAgICAgICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcC1zdHVkZW50cy1saXN0Jyk7CiAgICAgICAgbGlzdC5pbm5lckhUTUwgPSBzb3J0ZWQubGVuZ3RoID8gIiIgOiAiPGxpIHN0eWxlPSdjb2xvcjojOTk5Jz5BdWN1bmUgZG9ubsOpZSDDqWzDqHZlPC9saT4iOwogICAgICAgIHNvcnRlZC5mb3JFYWNoKChbbmFtZSwgY291bnRdKSA9PiB7CiAgICAgICAgICAgIGxpc3QuaW5uZXJIVE1MICs9IGA8bGkgY2xhc3M9InRvcC1zdHVkZW50LWl0ZW0iPjxzcGFuPiR7bmFtZX08L3NwYW4+IDxzdHJvbmc+JHtjb3VudH0gZm9pczwvc3Ryb25nPjwvbGk+YDsKICAgICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNb250aGx5U3RhdHMoKSB7CiAgICAgICAgY29uc3QgbXRocyA9IFtdOyBjb25zdCBuID0gbmV3IERhdGUoKTsKICAgICAgICBmb3IgKGxldCBpPTU7IGk+PTA7IGktLSkgeyBjb25zdCBkPW5ldyBEYXRlKG4uZ2V0RnVsbFllYXIoKSwgbi5nZXRNb250aCgpLWksIDEpOyBtdGhzLnB1c2goeyBsYWJlbDogZC50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJywge21vbnRoOidzaG9ydCcsIHllYXI6JzItZGlnaXQnfSksIGtleTogYCR7ZC5nZXRGdWxsWWVhcigpfS0ke1N0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfWAsIGNvdW50OiAwIH0pOyB9CiAgICAgICAgWy4uLmFwcERhdGEuZW50cmV0aWVucywgLi4uYXBwRGF0YS5yZXVuaW9ucywgLi4uYXBwRGF0YS5zdWl2aUVsZXZlc10uZm9yRWFjaChpdCA9PiB7IGlmKGl0LmRhdGUpIHsgY29uc3QgayA9IGl0LmRhdGUuc3Vic3RyaW5nKDAsNyk7IGNvbnN0IG0gPSBtdGhzLmZpbmQoeD0+eC5rZXk9PT1rKTsgaWYobSkgbS5jb3VudCsrOyB9IH0pOwogICAgICAgIHJldHVybiB7IGxhYmVsczogbXRocy5tYXAobT0+bS5sYWJlbCksIHZhbHVlczogbXRocy5tYXAobT0+bS5jb3VudCkgfTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJDaGFydChpZCwgdHlwZSwgZGF0YSkgewogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsgaWYoIWNhbnZhcykgcmV0dXJuOwogICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOyBpZihjaGFydEluc3RhbmNlc1tpZF0pIGNoYXJ0SW5zdGFuY2VzW2lkXS5kZXN0cm95KCk7CiAgICAgICAgY2hhcnRJbnN0YW5jZXNbaWRdID0gbmV3IENoYXJ0KGN0eCwgeyB0eXBlLCBkYXRhLCBvcHRpb25zOiB7IHJlc3BvbnNpdmU6IHRydWUsIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlIH0gfSk7CiAgICB9CgogICAgZnVuY3Rpb24gbG9hZFNldHRpbmdzVUkoKSB7CiAgICAgICAgbG9hZFRlbXBsYXRlc1VJKCk7IGxvYWRTZXBDb25maWcoKTsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NmZy1zY2hvb2wnKS52YWx1ZT1hcHBEYXRhLnNldHRpbmdzLnNjaG9vbDsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NmZy11c2VyJykudmFsdWU9YXBwRGF0YS5zZXR0aW5ncy51c2VyOyB1cGRhdGVQcmV2aWV3cygpOyB9CiAgICBmdW5jdGlvbiBzYXZlU2V0dGluZ3MoKSB7IGFwcERhdGEuc2V0dGluZ3Muc2Nob29sPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjZmctc2Nob29sJykudmFsdWU7IGFwcERhdGEuc2V0dGluZ3MudXNlcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2ZnLXVzZXInKS52YWx1ZTsgc2F2ZURhdGEoKTsgYWxlcnQoIkVucmVnaXN0csOpIik7IH0KICAgIGZ1bmN0aW9uIHVwZGF0ZVByZXZpZXdzKCkgeyBpZihhcHBEYXRhLnNldHRpbmdzLmxvZ28pIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NmZy1sb2dvLXByZXZpZXcnKS5zcmM9YXBwRGF0YS5zZXR0aW5ncy5sb2dvOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2ZnLWxvZ28tcHJldmlldycpLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsgfSBpZihhcHBEYXRhLnNldHRpbmdzLnNpZ25hdHVyZSkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2ZnLXNpZy1wcmV2aWV3Jykuc3JjPWFwcERhdGEuc2V0dGluZ3Muc2lnbmF0dXJlOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2ZnLXNpZy1wcmV2aWV3Jykuc3R5bGUuZGlzcGxheT0nYmxvY2snOyB9IH0KICAgIGZ1bmN0aW9uIGVuY29kZUltYWdlKGksIGlkLCBrKSB7IGNvbnN0IGY9aS5maWxlc1swXTsgY29uc3Qgcj1uZXcgRmlsZVJlYWRlcigpOyByLm9ubG9hZGVuZD0oKT0+eyBhcHBEYXRhLnNldHRpbmdzW2tdPXIucmVzdWx0OyBzYXZlRGF0YSgpOyB1cGRhdGVQcmV2aWV3cygpOyB9OyBpZihmKSByLnJlYWRBc0RhdGFVUkwoZik7IH0KICAgIGZ1bmN0aW9uIGRlbGV0ZUl0ZW0oYywgaWQpIHsgaWYoY29uZmlybSgiU3VwcHJpbWVyID8iKSkgeyBhcHBEYXRhW2NdPWFwcERhdGFbY10uZmlsdGVyKGk9PmkuaWQudG9TdHJpbmcoKSE9PWlkLnRvU3RyaW5nKCkpOyBzYXZlRGF0YSgpOyByZW5kZXJIaXN0b3J5KCk7IH0gfQogICAgZnVuY3Rpb24gY2xlYXJBbGwoKSB7IGlmKGNvbmZpcm0oIlN1cHByaW1lciBUT1VURVMgbGVzIGRvbm7DqWVzID8iKSkgeyBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncGVyZGlyX3BpbG90ZV92MTAnKTsgbG9jYXRpb24ucmVsb2FkKCk7IH0gfQogICAgZnVuY3Rpb24gZXhwb3J0RGF0YSgpIHsgY29uc3QgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7IGEuaHJlZj0iZGF0YTp0ZXh0L2pzb247Y2hhcnNldD11dGYtOCwiK2VuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShhcHBEYXRhKSk7IGEuZG93bmxvYWQ9InBlcmRpcl9iYWNrdXAuanNvbiI7IGEuY2xpY2soKTsgfQogICAgZnVuY3Rpb24gaW1wb3J0RGF0YShpKSB7IGNvbnN0IHI9bmV3IEZpbGVSZWFkZXIoKTsgci5vbmxvYWQ9ZT0+eyB0cnkgeyBhcHBEYXRhPUpTT04ucGFyc2UoZS50YXJnZXQucmVzdWx0KTsgc2F2ZURhdGEoKTsgbG9jYXRpb24ucmVsb2FkKCk7IH0gY2F0Y2goZXJyKSB7IGFsZXJ0KCJGb3JtYXQgaW52YWxpZGUiKTsgfSB9OyByLnJlYWRBc1RleHQoaS5maWxlc1swXSk7IH0KCiAgICAvLyDilZDilZDilZAgU0hBUkVEOiBUZWFjaGVyIGxpc3QgZnJvbSBQSUxPVEUgZG9ubsOpZXMg4pWQ4pWQ4pWQCiAgICB2YXIgX3RlYWNoZXJzID0gW107CiAgICB2YXIgX3N0dWRlbnRzID0gW107CiAgICBmdW5jdGlvbiBmaWxsVGVhY2hlclNlbChzZWxJZCwgdmFsKSB7CiAgICAgICAgdmFyIHNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbElkKTsgaWYoIXNlbCkgcmV0dXJuOwogICAgICAgIHZhciBoID0gJzxvcHRpb24gdmFsdWU9IiI+LS0gQ2hvaXNpciAtLTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9Il9fYyI+XHUyNzBGIFNhaXNpci4uLjwvb3B0aW9uPic7CiAgICAgICAgX3RlYWNoZXJzLmZvckVhY2goZnVuY3Rpb24odCl7CiAgICAgICAgICAgIHZhciBuID0gKCh0Lk5vbXx8dC5ub218fCcnKSArICcgJyArICh0WydQcsOpbm9tJ118fHQuUHJlbm9tfHx0WydwcsOpbm9tJ118fCcnKSkudHJpbSgpOwogICAgICAgICAgICBpZihuKSBoICs9ICc8b3B0aW9uIHZhbHVlPSInK24rJyInKyhuPT09dmFsPycgc2VsZWN0ZWQnOicnKSsnPicrbisnPC9vcHRpb24+JzsKICAgICAgICB9KTsKICAgICAgICBpZih2YWwgJiYgdmFsIT09J19fYycgJiYgaC5pbmRleE9mKCd2YWx1ZT0iJyt2YWwrJyInKTwwKSBoKz0nPG9wdGlvbiB2YWx1ZT0iJyt2YWwrJyIgc2VsZWN0ZWQ+Jyt2YWwrJzwvb3B0aW9uPic7CiAgICAgICAgc2VsLmlubmVySFRNTD1oOyBpZih2YWwpIHNlbC52YWx1ZT12YWw7CiAgICAgICAgc2VsLm9uY2hhbmdlPWZ1bmN0aW9uKCl7IGlmKHRoaXMudmFsdWU9PT0nX19jJyl7dmFyIHg9cHJvbXB0KCdOb20gOicpO2lmKHgmJngudHJpbSgpKXt0aGlzLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywnPG9wdGlvbiB2YWx1ZT0iJyt4LnRyaW0oKSsnIj4nK3gudHJpbSgpKyc8L29wdGlvbj4nKTt0aGlzLnZhbHVlPXgudHJpbSgpO31lbHNlIHRoaXMudmFsdWU9Jyc7fSB9OwogICAgfQoKICAgIC8vIOKVkOKVkOKVkCBFVkVORU1FTlRTIOKVkOKVkOKVkAogICAgdmFyIEVWX1M9e3RvZG86J8OAIGZhaXJlJyxwcm9ncmVzczonRW4gY291cnMnLGRvbmU6J1Rlcm1pbsOpJyxibG9ja2VkOidCbG9xdcOpJ307CiAgICB2YXIgRVZfQz17dG9kbzonI2U3NGMzYycscHJvZ3Jlc3M6JyNmMzljMTInLGRvbmU6JyMyN2FlNjAnLGJsb2NrZWQ6JyM5NWE1YTYnfTsKICAgIHZhciBFVl9QPXtoYXV0ZTonXHV7MUY1MzR9Jyxtb3llbm5lOidcdXsxRjdFMX0nLGJhc3NlOidcdXsxRjdFMn0nfTsKICAgIHZhciBfZXZGaWxlPW51bGw7CgoKICAgIC8vIOKVkOKVkOKVkCBBVVRPQ09NUExFVEUgw4lMw4hWRVMg4pWQ4pWQ4pWQCiAgICBmdW5jdGlvbiBnZXRTdHVkZW50TmFtZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zdHVkZW50cy5tYXAoZnVuY3Rpb24ocykgewogICAgICAgICAgICB2YXIgbm9tID0gKHMuTm9tfHxzLm5vbXx8JycpLnRyaW0oKTsKICAgICAgICAgICAgdmFyIHByZW5vbSA9IChzWydQcsOpbm9tJ118fHMuUHJlbm9tfHxzWydwcsOpbm9tJ118fHMucHJlbm9tfHwnJykudHJpbSgpOwogICAgICAgICAgICB2YXIgY2xhc3NlID0gKHMuQ2xhc3NlfHxzLmNsYXNzZXx8JycpLnRyaW0oKTsKICAgICAgICAgICAgcmV0dXJuIHsgZnVsbDogbm9tICsgJyAnICsgcHJlbm9tLCBjbGFzc2U6IGNsYXNzZSB9OwogICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbihzKSB7IHJldHVybiBzLmZ1bGwudHJpbSgpOyB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBhdHRhY2hTdHVkZW50QUMoaW5wdXQpIHsKICAgICAgICBpZiAoaW5wdXQuX2FjQXR0YWNoZWQpIHJldHVybjsKICAgICAgICBpbnB1dC5fYWNBdHRhY2hlZCA9IHRydWU7CiAgICAgICAgdmFyIHdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB3cmFwLmNsYXNzTmFtZSA9ICdhYy13cmFwJzsKICAgICAgICBpbnB1dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh3cmFwLCBpbnB1dCk7CiAgICAgICAgd3JhcC5hcHBlbmRDaGlsZChpbnB1dCk7CiAgICAgICAgdmFyIGxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBsaXN0LmNsYXNzTmFtZSA9ICdhYy1saXN0JzsKICAgICAgICB3cmFwLmFwcGVuZENoaWxkKGxpc3QpOwogICAgICAgIHZhciBzZWxJZHggPSAtMTsKCiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHEgPSB0aGlzLnZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBpZiAocS5sZW5ndGggPCAxIHx8ICFfc3R1ZGVudHMubGVuZ3RoKSB7IGxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyByZXR1cm47IH0KICAgICAgICAgICAgdmFyIG5hbWVzID0gZ2V0U3R1ZGVudE5hbWVzKCk7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbmFtZXMuZmlsdGVyKGZ1bmN0aW9uKHMpIHsgcmV0dXJuIHMuZnVsbC50b0xvd2VyQ2FzZSgpLmluZGV4T2YocSkgPj0gMDsgfSkuc2xpY2UoMCwgMTIpOwogICAgICAgICAgICBpZiAoIW1hdGNoZXMubGVuZ3RoKSB7IGxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyByZXR1cm47IH0KICAgICAgICAgICAgc2VsSWR4ID0gLTE7CiAgICAgICAgICAgIGxpc3QuaW5uZXJIVE1MID0gbWF0Y2hlcy5tYXAoZnVuY3Rpb24ocywgaSkgewogICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJhYy1pdGVtIiBkYXRhLXZhbD0iJyArIHMuZnVsbCArICciPjxzcGFuPicgKyBzLmZ1bGwgKyAnPC9zcGFuPicgKyAocy5jbGFzc2UgPyAnPHNwYW4gY2xhc3M9ImFjLWNsYXNzZSI+JyArIHMuY2xhc3NlICsgJzwvc3Bhbj4nIDogJycpICsgJzwvZGl2Pic7CiAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICBsaXN0LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgICAgICAgbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuYWMtaXRlbScpLmZvckVhY2goZnVuY3Rpb24oZWwpIHsKICAgICAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSB0aGlzLmRhdGFzZXQudmFsOwogICAgICAgICAgICAgICAgICAgIGxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgaXRlbXMgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hYy1pdGVtJyk7CiAgICAgICAgICAgIGlmICghaXRlbXMubGVuZ3RoIHx8ICFsaXN0LmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0Fycm93RG93bicpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyBzZWxJZHggPSBNYXRoLm1pbihzZWxJZHggKyAxLCBpdGVtcy5sZW5ndGggLSAxKTsgdXBkYXRlU2VsKGl0ZW1zKTsgfQogICAgICAgICAgICBlbHNlIGlmIChlLmtleSA9PT0gJ0Fycm93VXAnKSB7IGUucHJldmVudERlZmF1bHQoKTsgc2VsSWR4ID0gTWF0aC5tYXgoc2VsSWR4IC0gMSwgMCk7IHVwZGF0ZVNlbChpdGVtcyk7IH0KICAgICAgICAgICAgZWxzZSBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYgc2VsSWR4ID49IDApIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyBpbnB1dC52YWx1ZSA9IGl0ZW1zW3NlbElkeF0uZGF0YXNldC52YWw7IGxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyB9CiAgICAgICAgICAgIGVsc2UgaWYgKGUua2V5ID09PSAnRXNjYXBlJykgeyBsaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsgfQogICAgICAgIH0pOwoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVTZWwoaXRlbXMpIHsgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihlbCwgaSkgeyBlbC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpID09PSBzZWxJZHgpOyB9KTsgfQoKICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24oKSB7IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyB9LCAxNTApOyB9KTsKICAgIH0KCiAgICAvLyBBdXRvLWF0dGFjaCB0byBhbGwgZXhpc3Rpbmcgc3R1ZGVudCBuYW1lIGlucHV0cwogICAgZnVuY3Rpb24gaW5pdFN0dWRlbnRBQygpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjZW50LXN0dWRlbnRzLWNvbnRhaW5lciAubmFtZSwgI3JldS1zdHVkZW50cy1jb250YWluZXIgLm5hbWUsIFtkYXRhLXN0dWRlbnQtYWNdJykuZm9yRWFjaChhdHRhY2hTdHVkZW50QUMpOwogICAgfQoKICAgIC8vIOKVkOKVkOKVkCBBVVRPQ09NUExFVEUgRU5TRUlHTkFOVFMgLyBQRVJTT05ORUwg4pWQ4pWQ4pWQCiAgICBmdW5jdGlvbiBnZXRUZWFjaGVyTmFtZXMoKSB7CiAgICAgICAgcmV0dXJuIF90ZWFjaGVycy5tYXAoZnVuY3Rpb24odCkgewogICAgICAgICAgICB2YXIgbm9tID0gKHQuTm9tfHx0Lm5vbXx8JycpLnRyaW0oKTsKICAgICAgICAgICAgdmFyIHByZW5vbSA9ICh0WydQcsOpbm9tJ118fHQuUHJlbm9tfHx0WydwcsOpbm9tJ118fHQucHJlbm9tfHwnJykudHJpbSgpOwogICAgICAgICAgICByZXR1cm4geyBmdWxsOiBub20gKyAnICcgKyBwcmVub20gfTsKICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24odCkgeyByZXR1cm4gdC5mdWxsLnRyaW0oKTsgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gYXR0YWNoVGVhY2hlckFDKGlucHV0KSB7CiAgICAgICAgaWYgKGlucHV0Ll9hY0F0dGFjaGVkKSByZXR1cm47CiAgICAgICAgaW5wdXQuX2FjQXR0YWNoZWQgPSB0cnVlOwogICAgICAgIHZhciB3cmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgd3JhcC5jbGFzc05hbWUgPSAnYWMtd3JhcCc7CiAgICAgICAgaW5wdXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUod3JhcCwgaW5wdXQpOwogICAgICAgIHdyYXAuYXBwZW5kQ2hpbGQoaW5wdXQpOwogICAgICAgIHZhciBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgbGlzdC5jbGFzc05hbWUgPSAnYWMtbGlzdCc7CiAgICAgICAgd3JhcC5hcHBlbmRDaGlsZChsaXN0KTsKICAgICAgICB2YXIgc2VsSWR4ID0gLTE7CgogICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBxID0gdGhpcy52YWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgaWYgKHEubGVuZ3RoIDwgMSB8fCAhX3RlYWNoZXJzLmxlbmd0aCkgeyBsaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsgcmV0dXJuOyB9CiAgICAgICAgICAgIHZhciBuYW1lcyA9IGdldFRlYWNoZXJOYW1lcygpOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IG5hbWVzLmZpbHRlcihmdW5jdGlvbih0KSB7IHJldHVybiB0LmZ1bGwudG9Mb3dlckNhc2UoKS5pbmRleE9mKHEpID49IDA7IH0pLnNsaWNlKDAsIDEyKTsKICAgICAgICAgICAgaWYgKCFtYXRjaGVzLmxlbmd0aCkgeyBsaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsgcmV0dXJuOyB9CiAgICAgICAgICAgIHNlbElkeCA9IC0xOwogICAgICAgICAgICBsaXN0LmlubmVySFRNTCA9IG1hdGNoZXMubWFwKGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iYWMtaXRlbSIgZGF0YS12YWw9IicgKyB0LmZ1bGwgKyAnIj48c3Bhbj4nICsgdC5mdWxsICsgJzwvc3Bhbj48c3BhbiBjbGFzcz0iYWMtY2xhc3NlIj5Qcm9mPC9zcGFuPjwvZGl2Pic7CiAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICBsaXN0LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgICAgICAgbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuYWMtaXRlbScpLmZvckVhY2goZnVuY3Rpb24oZWwpIHsKICAgICAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSB0aGlzLmRhdGFzZXQudmFsOwogICAgICAgICAgICAgICAgICAgIGxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgaXRlbXMgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hYy1pdGVtJyk7CiAgICAgICAgICAgIGlmICghaXRlbXMubGVuZ3RoIHx8ICFsaXN0LmNsYXNzTGlzdC5jb250YWlucygnc2hvdycpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0Fycm93RG93bicpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyBzZWxJZHggPSBNYXRoLm1pbihzZWxJZHggKyAxLCBpdGVtcy5sZW5ndGggLSAxKTsgdXBkYXRlU2VsKGl0ZW1zKTsgfQogICAgICAgICAgICBlbHNlIGlmIChlLmtleSA9PT0gJ0Fycm93VXAnKSB7IGUucHJldmVudERlZmF1bHQoKTsgc2VsSWR4ID0gTWF0aC5tYXgoc2VsSWR4IC0gMSwgMCk7IHVwZGF0ZVNlbChpdGVtcyk7IH0KICAgICAgICAgICAgZWxzZSBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYgc2VsSWR4ID49IDApIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyBpbnB1dC52YWx1ZSA9IGl0ZW1zW3NlbElkeF0uZGF0YXNldC52YWw7IGxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOyB9CiAgICAgICAgICAgIGVsc2UgaWYgKGUua2V5ID09PSAnRXNjYXBlJykgeyBsaXN0LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsgfQogICAgICAgIH0pOwoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVTZWwoaXRlbXMpIHsgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihlbCwgaSkgeyBlbC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpID09PSBzZWxJZHgpOyB9KTsgfQogICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbigpIHsgc2V0VGltZW91dChmdW5jdGlvbigpIHsgbGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7IH0sIDE1MCk7IH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRUZWFjaGVyQUMoKSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2VudC10ZWFjaGVycy1jb250YWluZXIgLm5hbWUsICNyZXUtdGVhY2hlcnMtY29udGFpbmVyIC5uYW1lJykuZm9yRWFjaChhdHRhY2hUZWFjaGVyQUMpOwogICAgfQoKCiAgICBmdW5jdGlvbiBldlByZXZpZXdGaWxlKGlucCl7CiAgICAgICAgdmFyIGY9aW5wLmZpbGVzWzBdOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1mbmFtZScpLnRleHRDb250ZW50PWY/Zi5uYW1lKycgKCcrKGYuc2l6ZS8xMDI0KS50b0ZpeGVkKDApKycgS28pJzonJzsKICAgICAgICBpZihmJiZmLnNpemU+NSoxMDI0KjEwMjQpe2FsZXJ0KCdNYXggNSBNbycpO2lucC52YWx1ZT0nJztfZXZGaWxlPW51bGw7cmV0dXJuO30KICAgICAgICBfZXZGaWxlPWZ8fG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiB0b0I2NChmaWxlLGNiKXt2YXIgcj1uZXcgRmlsZVJlYWRlcigpO3Iub25sb2FkPWZ1bmN0aW9uKGUpe2NiKHtuYW1lOmZpbGUubmFtZSx0eXBlOmZpbGUudHlwZSxzaXplOmZpbGUuc2l6ZSxkYXRhOmUudGFyZ2V0LnJlc3VsdH0pO307ci5yZWFkQXNEYXRhVVJMKGZpbGUpO30KCiAgICBmdW5jdGlvbiBvcGVuRXZNb2RhbChpZCl7CiAgICAgICAgdmFyIF9ldm09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2TW9kJyk7X2V2bS5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7X2V2bS5zdHlsZS5kaXNwbGF5PSdmbGV4JzsKICAgICAgICBmaWxsVGVhY2hlclNlbCgnZXYtcmVzcCcpO2J1aWxkQ2xhc3NTZWxlY3QoKTtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtbXNncGFyZW50cycpLmNoZWNrZWQ9ZmFsc2U7CiAgICAgICAgCiAgICAgICAgaWYoaWQpewogICAgICAgICAgICB2YXIgcD0oYXBwRGF0YS5ldmVudHN8fFtdKS5maW5kKGZ1bmN0aW9uKHgpe3JldHVybiB4LmlkLnRvU3RyaW5nKCk9PT1pZC50b1N0cmluZygpO30pO2lmKCFwKXJldHVybjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LW10JykudGV4dENvbnRlbnQ9J01vZGlmaWVyIGxcdTIwMTnDqXbDqW5lbWVudCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1laWQnKS52YWx1ZT1pZDtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtbmFtZScpLnZhbHVlPXAubmFtZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LXN0YXJ0JykudmFsdWU9cC5zdGFydHx8Jyc7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LWRlYWQnKS52YWx1ZT1wLmRlYWRsaW5lfHwnJzsKICAgICAgICAgICAgX2V2Q2xhc3Nlcz0ocC5jbGFzc2VzfHxbXSkuc2xpY2UoKTtyZW5kZXJFdkNsYXNzZXMoKTsKICAgICAgICAgICAgZmlsbFRlYWNoZXJTZWwoJ2V2LXJlc3AnLHAucmVzcCk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1tc2dwYXJlbnRzJykuY2hlY2tlZD0hIXAubXNnUGFyZW50cztkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtZGVzYycpLmlubmVySFRNTD1wLmRlc2N8fCcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtdGFncycpLnZhbHVlPShwLnRhZ3N8fFtdKS5qb2luKCcsICcpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtZGVsLWJ0bicpLnN0eWxlLmRpc3BsYXk9J2ZsZXgnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1tdCcpLnRleHRDb250ZW50PSdOb3V2ZWwgw6l2w6luZW1lbnQnO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1laWQnKS52YWx1ZT0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LW5hbWUnKS52YWx1ZT0nJztkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtc3RhcnQnKS52YWx1ZT1uZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LWRlYWQnKS52YWx1ZT0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LWRlc2MnKS5pbm5lckhUTUw9Jyc7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LXRhZ3MnKS52YWx1ZT0nJzsKICAgICAgICAgICAgX2V2Q2xhc3Nlcz1bXTtyZW5kZXJFdkNsYXNzZXMoKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LWRlbC1idG4nKS5zdHlsZS5kaXNwbGF5PSdub25lJzsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBjbG9zZUV2TW9kYWwoKXt2YXIgbT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZNb2QnKTttLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTttLnN0eWxlLmRpc3BsYXk9J25vbmUnO30KICAgIGZ1bmN0aW9uIGRlbEV2RnJvbU1vZGFsKCl7dmFyIGlkPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1laWQnKS52YWx1ZTtpZihpZCYmY29uZmlybSgnU3VwcHJpbWVyID8nKSl7YXBwRGF0YS5ldmVudHM9KGFwcERhdGEuZXZlbnRzfHxbXSkuZmlsdGVyKGZ1bmN0aW9uKHApe3JldHVybiBwLmlkLnRvU3RyaW5nKCkhPT1pZC50b1N0cmluZygpO30pO3NhdmVEYXRhKCk7Y2xvc2VFdk1vZGFsKCk7cmVuZGVyRXZlbnRzKCk7fX0KCiAgICBmdW5jdGlvbiBzYXZlRXZlbnQoKXsKICAgICAgICB2YXIgbm09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LW5hbWUnKS52YWx1ZS50cmltKCk7aWYoIW5tKXthbGVydCgnSW50aXR1bMOpIHJlcXVpcycpO3JldHVybjt9CiAgICAgICAgdmFyIGVpZD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtZWlkJykudmFsdWU7CiAgICAgICAgdmFyIG9iaj17aWQ6ZWlkfHxEYXRlLm5vdygpLnRvU3RyaW5nKCksbmFtZTpubSxzdGFydDpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtc3RhcnQnKS52YWx1ZSwKICAgICAgICAgICAgZGVhZGxpbmU6ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LWRlYWQnKS52YWx1ZSxyZXNwOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1yZXNwJykudmFsdWUsY2xhc3NlczpfZXZDbGFzc2VzLnNsaWNlKCksCiAgICAgICAgICAgIG1zZ1BhcmVudHM6ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LW1zZ3BhcmVudHMnKS5jaGVja2VkLAogICAgICAgICAgICBkZXNjOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1kZXNjJykuaW5uZXJIVE1MLAogICAgICAgICAgICB0YWdzOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi10YWdzJykudmFsdWUuc3BsaXQoJywnKS5tYXAoZnVuY3Rpb24odCl7cmV0dXJuIHQudHJpbSgpO30pLmZpbHRlcihCb29sZWFuKSwKICAgICAgICAgICAgY3JlYXRlZDpuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9OwogICAgICAgIGlmKCFhcHBEYXRhLmV2ZW50cykgYXBwRGF0YS5ldmVudHM9W107CiAgICAgICAgaWYoZWlkKXsKICAgICAgICAgICAgdmFyIGlkeD0tMTtmb3IodmFyIGs9MDtrPGFwcERhdGEuZXZlbnRzLmxlbmd0aDtrKyspe2lmKFN0cmluZyhhcHBEYXRhLmV2ZW50c1trXS5pZCk9PT1TdHJpbmcoZWlkKSl7aWR4PWs7YnJlYWs7fX0KICAgICAgICAgICAgaWYoaWR4Pj0wKXtvYmouY3JlYXRlZD1hcHBEYXRhLmV2ZW50c1tpZHhdLmNyZWF0ZWQ7YXBwRGF0YS5ldmVudHNbaWR4XT1vYmo7fQogICAgICAgICAgICBlbHNle2FwcERhdGEuZXZlbnRzLnB1c2gob2JqKTt9CiAgICAgICAgfWVsc2V7YXBwRGF0YS5ldmVudHMucHVzaChvYmopO30KICAgICAgICBzYXZlRGF0YSgpO2Nsb3NlRXZNb2RhbCgpO3JlbmRlckV2ZW50cygpOwogICAgfQogICAgZnVuY3Rpb24gZGxFdkZpbGUoaWQpe3ZhciBwPShhcHBEYXRhLmV2ZW50c3x8W10pLmZpbmQoZnVuY3Rpb24oeCl7cmV0dXJuIHguaWQudG9TdHJpbmcoKT09PWlkLnRvU3RyaW5nKCk7fSk7aWYocCYmcC5maWxlKXt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7YS5ocmVmPXAuZmlsZS5kYXRhO2EuZG93bmxvYWQ9cC5maWxlLm5hbWU7YS5jbGljaygpO319CgogICAgZnVuY3Rpb24gcmVuZGVyRXZlbnRzKCl7CiAgICAgICAgaWYoIWFwcERhdGEuZXZlbnRzKWFwcERhdGEuZXZlbnRzPVtdOwogICAgICAgIHZhciBxcz0oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LXNlYXJjaCcpLnZhbHVlfHwnJykudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgICAgdmFyIHRkPW5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgICAgIHZhciBsaXN0PWFwcERhdGEuZXZlbnRzLmZpbHRlcihmdW5jdGlvbihwKXsKICAgICAgICAgICAgaWYocXMmJnAubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXMpPDAmJihwLnJlc3B8fCcnKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXMpPDApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgbGlzdC5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBEYXRlKGEuZGVhZGxpbmV8fGEuc3RhcnR8fCc5OTk5JyktbmV3IERhdGUoYi5kZWFkbGluZXx8Yi5zdGFydHx8Jzk5OTknKTt9KTsKICAgICAgICB2YXIgYWxsPWFwcERhdGEuZXZlbnRzOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdrcGktZXYtdG90JykudGV4dENvbnRlbnQ9YWxsLmxlbmd0aDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna3BpLWV2LW1zZycpLnRleHRDb250ZW50PWFsbC5maWx0ZXIoZnVuY3Rpb24ocCl7cmV0dXJuIHAubXNnUGFyZW50czt9KS5sZW5ndGg7CiAgICAgICAgdmFyIGJveD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtZ3JpZCcpOwogICAgICAgIGlmKCFsaXN0Lmxlbmd0aCl7Ym94LmlubmVySFRNTD0nPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6I2JiYjtwYWRkaW5nOjQwcHggMjBweDtncmlkLWNvbHVtbjoxLy0xIj48aSBjbGFzcz0iZmFzIGZhLWNhbGVuZGFyLWNoZWNrIiBzdHlsZT0iZm9udC1zaXplOjJyZW07bWFyZ2luLWJvdHRvbToxMHB4O2Rpc3BsYXk6YmxvY2siPjwvaT5BdWN1biDDqXbDqW5lbWVudDwvZGl2Pic7cmV0dXJuO30KICAgICAgICB2YXIgaD0nJztsaXN0LmZvckVhY2goZnVuY3Rpb24ocCl7CiAgICAgICAgICAgIHZhciBjPXAubXNnUGFyZW50cz8nIzI3YWU2MCc6J3ZhcigtLWhlYWRlciknLGxhdGU9cC5kZWFkbGluZSYmcC5kZWFkbGluZTx0ZDsKICAgICAgICAgICAgdmFyIGRzPXAuZGVhZGxpbmU/bmV3IERhdGUocC5kZWFkbGluZSkudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonbnVtZXJpYycsbW9udGg6J3Nob3J0J30pOicnOwogICAgICAgICAgICBoKz0nPGRpdiBjbGFzcz0iZXYtY2FyZCIgc3R5bGU9ImJvcmRlci1sZWZ0OjRweCBzb2xpZCAnK2MrJyI+JzsKICAgICAgICAgICAgaCs9JzxkaXYgY2xhc3M9ImV2LWNhcmQtaGQiPjxoND4nKyhwLm1zZ1BhcmVudHM/J1x1MjcwOVx1RkUwRiAnOicnKSsgcC5uYW1lKyc8L2g0PjxkaXYgY2xhc3M9ImV2LWNhcmQtYWN0cyI+PGJ1dHRvbiBvbmNsaWNrPSJvcGVuRXZNb2RhbChcJycrcC5pZCsnXCcpIiB0aXRsZT0iTW9kaWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+PC9idXR0b24+PGJ1dHRvbiBvbmNsaWNrPSJpZihjb25maXJtKFwnU3VwcHJpbWVyID9cJykpZGVsRXZEaXJlY3QoXCcnK3AuaWQrJ1wnKSIgdGl0bGU9IlN1cHByaW1lciI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPjwvYnV0dG9uPjwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgIGgrPSc8ZGl2IGNsYXNzPSJldi1jYXJkLW1ldGEiPic7CiAgICAgICAgICAgIGlmKGRzKSBoKz0nPHNwYW4+PGkgY2xhc3M9ImZhcyBmYS1mbGFnIj48L2k+ICcrZHMrKGxhdGU/JyA8YiBzdHlsZT0iY29sb3I6I2U3NGMzYyI+XHUyNkEwIMOJY2jDqWFuY2UgZMOpcGFzc8OpZTwvYj4nOicnKSsnPC9zcGFuPic7CiAgICAgICAgICAgIGlmKHAucmVzcCkgaCs9JzxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtdXNlciI+PC9pPiAnK3AucmVzcCsnPC9zcGFuPic7CiAgICAgICAgICAgIGlmKHAubXNnUGFyZW50cykgaCs9JzxzcGFuIHN0eWxlPSJjb2xvcjojMjdhZTYwO2ZvbnQtc2l6ZTouN3JlbTsiPjxpIGNsYXNzPSJmYXMgZmEtZW52ZWxvcGUiPjwvaT4gUGFyZW50cyBpbmZvcm3DqXM8L3NwYW4+JztoKz0nPC9kaXY+JzsKICAgICAgICAgICAgaWYocC5kZXNjKXtoKz0nPGRpdiBjbGFzcz0iZXYtY2FyZC1kZXNjIj4nK3AuZGVzYysnPC9kaXY+Jzt9CiAgICAgICAgICAgIGgrPSc8ZGl2IGNsYXNzPSJldi1jYXJkLWZ0Ij4nOwogICAgICAgICAgICBpZihwLnRhZ3MmJnAudGFncy5sZW5ndGgpIHAudGFncy5mb3JFYWNoKGZ1bmN0aW9uKHQpe2grPSc8c3BhbiBjbGFzcz0iZXYtdGFnIj4nK3QrJzwvc3Bhbj4nO30pOwogICAgICAgICAgICBpZihwLmZpbGUpIGgrPSc8c3BhbiBjbGFzcz0iZXYtYXR0YWNoIiBvbmNsaWNrPSJkbEV2RmlsZShcJycrcC5pZCsnXCcpIiB0aXRsZT0iVMOpbMOpY2hhcmdlciI+PGkgY2xhc3M9ImZhcyBmYS1wYXBlcmNsaXAiPjwvaT4gJytwLmZpbGUubmFtZSsnPC9zcGFuPic7CiAgICAgICAgICAgIAogICAgICAgICAgICBoKz0nPC9kaXY+PC9kaXY+JzsKICAgICAgICB9KTtib3guaW5uZXJIVE1MPWg7CiAgICB9CiAgICBmdW5jdGlvbiBkZWxFdkRpcmVjdChpZCl7YXBwRGF0YS5ldmVudHM9KGFwcERhdGEuZXZlbnRzfHxbXSkuZmlsdGVyKGZ1bmN0aW9uKHApe3JldHVybiBwLmlkLnRvU3RyaW5nKCkhPT1pZC50b1N0cmluZygpO30pO3NhdmVEYXRhKCk7cmVuZGVyRXZlbnRzKCk7fQoKICAgIC8vIOKVkOKVkOKVkCBHQU5UVCAvIFBST0NFRFVSRVMg4pWQ4pWQ4pWQCiAgICB2YXIgVkFDPXthbGw6WzQzLDQ0LDUyLDFdLEE6WzcsOCwxNSwxNl0sQjpbOCw5LDE2LDE3XSxDOls5LDEwLDE3LDE4XX07CiAgICB2YXIgX2d2cz1udWxsLF9ndmw9MTYsU1k9W107CiAgICBmdW5jdGlvbiBidWlsZFNZKCl7U1k9W107Zm9yKHZhciB3PTM2O3c8PTUzO3crKylTWS5wdXNoKHcpO2Zvcih2YXIgdz0xO3c8PTI2O3crKylTWS5wdXNoKHcpO30KICAgIGZ1bmN0aW9uIGdldFZXKCl7dmFyIHo9KGFwcERhdGEuc2V0dGluZ3MmJmFwcERhdGEuc2V0dGluZ3Muem9uZSl8fCdCJzt2YXIgdj1WQUMuYWxsLnNsaWNlKCk7aWYoVkFDW3pdKXY9di5jb25jYXQoVkFDW3pdKTtyZXR1cm4gdjt9CiAgICBmdW5jdGlvbiBpc29XKGQpe3ZhciBkdD1uZXcgRGF0ZShEYXRlLlVUQyhkLmdldEZ1bGxZZWFyKCksZC5nZXRNb250aCgpLGQuZ2V0RGF0ZSgpKSk7ZHQuc2V0VVRDRGF0ZShkdC5nZXRVVENEYXRlKCkrNC0oZHQuZ2V0VVRDRGF5KCl8fDcpKTt2YXIgeTA9bmV3IERhdGUoRGF0ZS5VVEMoZHQuZ2V0VVRDRnVsbFllYXIoKSwwLDEpKTtyZXR1cm4gTWF0aC5jZWlsKCgoKGR0LXkwKS84NjRlNSkrMSkvNyk7fQogICAgZnVuY3Rpb24gY3VyVygpe3JldHVybiBpc29XKG5ldyBEYXRlKCkpO30KICAgIGZ1bmN0aW9uIHdrTW8odyl7dmFyIHk9dz49MzY/MjAyNToyMDI2O3ZhciBqND1uZXcgRGF0ZSh5LDAsNCk7dmFyIGQ9bmV3IERhdGUoajQuZ2V0VGltZSgpKygody0xKSo3LSgoajQuZ2V0RGF5KCkrNiklNykpKjg2NGU1KTt2YXIgbW49ZC50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7bW9udGg6J3Nob3J0J30pLnJlcGxhY2UoJy4nLCcnKTtyZXR1cm4gbW4uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrbW4uc2xpY2UoMSk7fQogICAgZnVuY3Rpb24gaW5pdEdhbnR0Vmlldygpe2J1aWxkU1koKTt2YXIgY3c9Y3VyVygpLGk9U1kuaW5kZXhPZihjdyk7aWYoaTwwKWk9MDtfZ3ZzPU1hdGgubWF4KDAsaSk7X2d2bD0xNjt3aW5kb3cuX2dhbnR0UmVhZHk9dHJ1ZTt9CiAgICBmdW5jdGlvbiBndFByZXYoKXtfZ3ZzPU1hdGgubWF4KDAsX2d2cy1fZ3ZsKTtyZW5kZXJHYW50dCgpO30KICAgIGZ1bmN0aW9uIGd0TmV4dCgpe19ndnM9TWF0aC5taW4oU1kubGVuZ3RoLV9ndmwsX2d2cytfZ3ZsKTtpZihfZ3ZzPDApX2d2cz0wO3JlbmRlckdhbnR0KCk7fQogICAgZnVuY3Rpb24gZ3RUb2RheSgpe3ZhciBjdz1jdXJXKCksaT1TWS5pbmRleE9mKGN3KTtpZihpPDApaT0wO19ndnM9TWF0aC5tYXgoMCxpKTtfZ3ZsPTE2O3JlbmRlckdhbnR0KCk7fQogICAgZnVuY3Rpb24gZ3RZZWFyKCl7X2d2cz0wO19ndmw9U1kubGVuZ3RoO3JlbmRlckdhbnR0KCk7X2d2bD0xNjt9CgogICAgZnVuY3Rpb24gb3Blbkd0TW9kYWwoaWQpewogICAgICAgIHZhciBfZ3RtPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndE1vZCcpO19ndG0uY2xhc3NMaXN0LmFkZCgnb3BlbicpO19ndG0uc3R5bGUuZGlzcGxheT0nZmxleCc7CiAgICAgICAgZmlsbFRlYWNoZXJTZWwoJ2d0LXJlc3AnKTt2YXIgY3c9Y3VyVygpOwogICAgICAgIGlmKGlkKXt2YXIgZz0oYXBwRGF0YS5nYW50dHx8W10pLmZpbmQoZnVuY3Rpb24oeCl7cmV0dXJuIHguaWQudG9TdHJpbmcoKT09PWlkLnRvU3RyaW5nKCk7fSk7aWYoIWcpcmV0dXJuOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3QtbXQnKS50ZXh0Q29udGVudD0nTW9kaWZpZXIgbFx4MjfDqWNow6lhbmNlJztkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3QtZWlkJykudmFsdWU9aWQ7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1uYW1lJykudmFsdWU9Zy5uYW1lO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1jb2RlJykudmFsdWU9Zy5jb2RlfHwnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LWNhdCcpLnZhbHVlPWcuY2F0fHwnQXV0cmUnO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC13cycpLnZhbHVlPWcud3N0YXJ0fHxjdzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LXdlJykudmFsdWU9Zy53ZW5kfHxjdztmaWxsVGVhY2hlclNlbCgnZ3QtcmVzcCcsZy5yZXNwKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LW5vdGVzJykuaW5uZXJIVE1MPWcubm90ZXN8fCcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3QtZGVsLWJ0bicpLnN0eWxlLmRpc3BsYXk9J2ZsZXgnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1tdCcpLnRleHRDb250ZW50PSdOb3V2ZWxsZSDDqWNow6lhbmNlJztkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3QtZWlkJykudmFsdWU9Jyc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1uYW1lJykudmFsdWU9Jyc7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LWNvZGUnKS52YWx1ZT0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LWNhdCcpLnZhbHVlPSdBdXRyZSc7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LXdzJykudmFsdWU9Y3c7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC13ZScpLnZhbHVlPWN3O2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1ub3RlcycpLmlubmVySFRNTD0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LWRlbC1idG4nKS5zdHlsZS5kaXNwbGF5PSdub25lJzsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBjbG9zZUd0TW9kYWwoKXt2YXIgbT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3RNb2QnKTttLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTttLnN0eWxlLmRpc3BsYXk9J25vbmUnO30KICAgIGZ1bmN0aW9uIGRlbEd0RnJvbU1vZGFsKCl7dmFyIGlkPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1laWQnKS52YWx1ZTtpZihpZCYmY29uZmlybSgnU3VwcHJpbWVyIGNldHRlIHByb2PDqWR1cmUgPycpKXthcHBEYXRhLmdhbnR0PShhcHBEYXRhLmdhbnR0fHxbXSkuZmlsdGVyKGZ1bmN0aW9uKGcpe3JldHVybiBnLmlkLnRvU3RyaW5nKCkhPT1pZC50b1N0cmluZygpO30pO3NhdmVEYXRhKCk7Y2xvc2VHdE1vZGFsKCk7cmVuZGVyR2FudHQoKTt9fQogICAgZnVuY3Rpb24gdG9nZ2xlR3REb25lKGlkKXt2YXIgZz0oYXBwRGF0YS5nYW50dHx8W10pLmZpbmQoZnVuY3Rpb24oeCl7cmV0dXJuIHguaWQudG9TdHJpbmcoKT09PWlkLnRvU3RyaW5nKCk7fSk7aWYoZyl7Zy5kb25lPSFnLmRvbmU7c2F2ZURhdGEoKTtyZW5kZXJHYW50dCgpO319CiAgICBmdW5jdGlvbiBzYXZlR3QoKXsKICAgICAgICB2YXIgbm09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LW5hbWUnKS52YWx1ZS50cmltKCk7aWYoIW5tKXthbGVydCgnSW50aXR1bMOpIHJlcXVpcycpO3JldHVybjt9CiAgICAgICAgdmFyIGVpZD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3QtZWlkJykudmFsdWU7CiAgICAgICAgdmFyIHdzPXBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC13cycpLnZhbHVlKXx8MSx3ZT1wYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3Qtd2UnKS52YWx1ZSl8fHdzOwogICAgICAgIHZhciBvYmo9e2lkOmVpZHx8RGF0ZS5ub3coKS50b1N0cmluZygpLG5hbWU6bm0sY29kZTpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3QtY29kZScpLnZhbHVlLnRyaW0oKSwKICAgICAgICAgICAgY2F0OmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1jYXQnKS52YWx1ZSx3c3RhcnQ6d3Msd2VuZDp3ZSwKICAgICAgICAgICAgZG9uZTplaWQ/KChhcHBEYXRhLmdhbnR0fHxbXSkuZmluZChmdW5jdGlvbihnKXtyZXR1cm4gZy5pZC50b1N0cmluZygpPT09ZWlkLnRvU3RyaW5nKCl9KXx8e30pLmRvbmV8fGZhbHNlOmZhbHNlLAogICAgICAgICAgICByZXNwOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1yZXNwJykudmFsdWUsbm90ZXM6ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LW5vdGVzJykuaW5uZXJIVE1MfTsKICAgICAgICBpZighYXBwRGF0YS5nYW50dClhcHBEYXRhLmdhbnR0PVtdOwogICAgICAgIGlmKGVpZCl7dmFyIGk9YXBwRGF0YS5nYW50dC5maW5kSW5kZXgoZnVuY3Rpb24oZyl7cmV0dXJuIGcuaWQudG9TdHJpbmcoKT09PWVpZC50b1N0cmluZygpO30pO2lmKGk+PTApYXBwRGF0YS5nYW50dFtpXT1vYmo7ZWxzZSBhcHBEYXRhLmdhbnR0LnB1c2gob2JqKTt9CiAgICAgICAgZWxzZSBhcHBEYXRhLmdhbnR0LnB1c2gob2JqKTsKICAgICAgICBzYXZlRGF0YSgpO2Nsb3NlR3RNb2RhbCgpO3JlbmRlckdhbnR0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gd0luUih3LHdzLHdlKXtyZXR1cm4gd3M8PXdlPyh3Pj13cyYmdzw9d2UpOih3Pj13c3x8dzw9d2UpO30KCiAgICBmdW5jdGlvbiByZW5kZXJHYW50dCgpewogICAgICAgIGlmKCFTWS5sZW5ndGgpYnVpbGRTWSgpO2lmKF9ndnM9PT1udWxsKWluaXRHYW50dFZpZXcoKTsKICAgICAgICB2YXIgZmM9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LWZjJykudmFsdWU7CiAgICAgICAgdmFyIHByb2NzPShhcHBEYXRhLnByb2NlZHVyZXN8fFtdKS5maWx0ZXIoZnVuY3Rpb24ocCl7cmV0dXJuIChwLndzdGFydHx8cC5hbm5lZSkmJiFwLmRvbmUmJihmYz09PSdBTEwnfHxwLmNhdD09PWZjKTt9KTsKICAgICAgICAvLyBBbHNvIGluY2x1ZGUgc3RhbmRhbG9uZSBnYW50dCBpdGVtcyAow6ljaMOpYW5jZXMgbm90IGxpbmtlZCB0byBwcm9jZWR1cmVzKQogICAgICAgIHZhciBnYW50dEl0ZW1zPShhcHBEYXRhLmdhbnR0fHxbXSkuZmlsdGVyKGZ1bmN0aW9uKGcpe3JldHVybiBnLndzdGFydCYmIWcuZG9uZSYmKGZjPT09J0FMTCd8fGcuY2F0PT09ZmMpO30pOwogICAgICAgIGdhbnR0SXRlbXMuZm9yRWFjaChmdW5jdGlvbihnKXtpZighZy50aXRsZSlnLnRpdGxlPWcubmFtZTt9KTsKICAgICAgICBwcm9jcz1wcm9jcy5jb25jYXQoZ2FudHRJdGVtcyk7CiAgICAgICAgLy8gU29ydCBieSB3c3RhcnQgdGhlbiBjb2RlIG51bWJlcgogICAgICAgIHByb2NzLnNvcnQoZnVuY3Rpb24oYSxiKXsKICAgICAgICAgICAgLy8gYW5uZWUgaXRlbXMgZ28gdG8gdGhlIGVuZAogICAgICAgICAgICBpZihhLmFubmVlJiYhYi5hbm5lZSlyZXR1cm4gMTtpZighYS5hbm5lZSYmYi5hbm5lZSlyZXR1cm4gLTE7CiAgICAgICAgICAgIGlmKGEuYW5uZWUmJmIuYW5uZWUpcmV0dXJuIG5hdENvZGVTb3J0KGEsYik7CiAgICAgICAgICAgIC8vIG90aGVycyBieSB3c3RhcnQgdGhlbiB3ZW5kCiAgICAgICAgICAgIHZhciBpYT1TWS5pbmRleE9mKGEud3N0YXJ0KSxpYj1TWS5pbmRleE9mKGIud3N0YXJ0KTsKICAgICAgICAgICAgaWYoaWE8MClpYT05OTk7aWYoaWI8MClpYj05OTk7CiAgICAgICAgICAgIGlmKGlhIT09aWIpcmV0dXJuIGlhLWliOwogICAgICAgICAgICB2YXIgZWE9U1kuaW5kZXhPZihhLndlbmQpLGViPVNZLmluZGV4T2YoYi53ZW5kKTsKICAgICAgICAgICAgaWYoZWE8MCllYT05OTk7aWYoZWI8MCllYj05OTk7CiAgICAgICAgICAgIGlmKGVhIT09ZWIpcmV0dXJuIGVhLWViOwogICAgICAgICAgICByZXR1cm4gbmF0Q29kZVNvcnQoYSxiKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgdmw9TWF0aC5taW4oX2d2bCxTWS5sZW5ndGgtX2d2cyksdmlzPVNZLnNsaWNlKF9ndnMsX2d2cyt2bCksY3c9Y3VyVygpLHZ3PWdldFZXKCk7CiAgICAgICAgdmFyIGl0ZW1zPXByb2NzLmZpbHRlcihmdW5jdGlvbihnKXtpZihnLmFubmVlKXJldHVybiB0cnVlO2Zvcih2YXIgdmk9MDt2aTx2aXMubGVuZ3RoO3ZpKyspe2lmKHdJblIodmlzW3ZpXSxnLndzdGFydCxnLndlbmQpKXJldHVybiB0cnVlO31yZXR1cm4gZmFsc2U7fSk7CiAgICAgICAgaWYodmlzLmxlbmd0aCkgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LXBlcicpLnRleHRDb250ZW50PSdTJyt2aXNbMF0rJyBcdTIxOTIgUycrdmlzW3Zpcy5sZW5ndGgtMV0rJyAoJyt2aXMubGVuZ3RoKycgc2VtLiknOwogICAgICAgIC8vIE1vbnRoIGhlYWRlcnMKICAgICAgICB2YXIgbW9zPVtdLGNtPScnO3Zpcy5mb3JFYWNoKGZ1bmN0aW9uKHcpe3ZhciBtbD13a01vKHcpO2lmKG1sIT09Y20pe21vcy5wdXNoKHtuOm1sLHM6MX0pO2NtPW1sO31lbHNlIG1vc1ttb3MubGVuZ3RoLTFdLnMrKzt9KTsKICAgICAgICB2YXIgaD0nPHRoZWFkPjx0cj48dGggY2xhc3M9Imd0LW1vIGd0LWxjIiByb3dzcGFuPSIyIj5Qcm9jw6lkdXJlPC90aD48dGggY2xhc3M9Imd0LW1vIGd0LWRjIiByb3dzcGFuPSIyIj5cdTI3MTQ8L3RoPic7CiAgICAgICAgbW9zLmZvckVhY2goZnVuY3Rpb24obSl7aCs9Jzx0aCBjbGFzcz0iZ3QtbW8iIGNvbHNwYW49IicrbS5zKyciPicrbS5uKyc8L3RoPic7fSk7CiAgICAgICAgaCs9JzwvdHI+PHRyPic7dmlzLmZvckVhY2goZnVuY3Rpb24odyl7CiAgICAgICAgICAgIHZhciBjbHM9Jyc7CiAgICAgICAgICAgIGlmKHc9PT1jdykgY2xzPSdndC1jdyc7CiAgICAgICAgICAgIGVsc2UgaWYodncuaW5kZXhPZih3KT49MCkgY2xzPSdndC12YSc7CiAgICAgICAgICAgIGgrPSc8dGgnKyhjbHM/JyBjbGFzcz0iJytjbHMrJyInOicnKSsnPlMnK3crJzwvdGg+JzsKICAgICAgICB9KTsKICAgICAgICBoKz0nPC90cj48L3RoZWFkPjx0Ym9keT4nOwogICAgICAgIGlmKCFpdGVtcy5sZW5ndGgpIGgrPSc8dHI+PHRkIGNvbHNwYW49IicrKDIrdmlzLmxlbmd0aCkrJyIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO2NvbG9yOiNiYmI7cGFkZGluZzozMHB4Ij48aSBjbGFzcz0iZmFzIGZhLXN0cmVhbSIgc3R5bGU9ImZvbnQtc2l6ZToxLjNyZW07ZGlzcGxheTpibG9jazttYXJnaW4tYm90dG9tOjZweCI+PC9pPkF1Y3VuZSBwcm9jw6lkdXJlIOKAlCBjbGlxdWV6ICtHw6lyZXIgcG91ciBjb21tZW5jZXI8L3RkPjwvdHI+JzsKICAgICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGcpewogICAgICAgICAgICB2YXIgY29sPWdldFByb2NDb2xvcihnLmNvZGUpOwogICAgICAgICAgICBoKz0nPHRyJysoZy5kb25lPycgc3R5bGU9Im9wYWNpdHk6LjYiJzonJykrJz4nOwogICAgICAgICAgICB2YXIgaXNSZWFsUHJvYz0oYXBwRGF0YS5wcm9jZWR1cmVzfHxbXSkuaW5kZXhPZihnKT49MDsKICAgICAgICAgICAgdmFyIGhhc0xpbmtlZFByb2M9IWlzUmVhbFByb2MmJmcuY29kZSYmKGFwcERhdGEucHJvY2VkdXJlc3x8W10pLnNvbWUoZnVuY3Rpb24ocHApe3JldHVybiBwcC5jb2RlPT09Zy5jb2RlO30pOwogICAgICAgICAgICBpZihpc1JlYWxQcm9jJiZnLmNvZGUpewogICAgICAgICAgICAgICAgaCs9Jzx0ZCBjbGFzcz0iZ3QtbGEiIG9uY2xpY2s9IndpbmRvdy52aWV3UHJvY1JlYWRvbmx5KFwnJysoKGcuY29kZXx8JycpLnJlcGxhY2UoLycvZywiXFwnIikpKydcJykiIHN0eWxlPSJjdXJzb3I6cG9pbnRlciIgdGl0bGU9IlZvaXIgbGEgcHJvY8OpZHVyZSI+JysoZy50aXRsZXx8Zy5uYW1lfHwnJykrJzwvdGQ+JzsKICAgICAgICAgICAgfSBlbHNlIGlmKGhhc0xpbmtlZFByb2MpewogICAgICAgICAgICAgICAgaCs9Jzx0ZCBjbGFzcz0iZ3QtbGEiIHN0eWxlPSJjdXJzb3I6cG9pbnRlciI+JzsKICAgICAgICAgICAgICAgIGgrPSc8c3BhbiBvbmNsaWNrPSJ3aW5kb3cudmlld1Byb2NSZWFkb25seShcJycrKChnLmNvZGV8fCcnKS5yZXBsYWNlKC8nL2csIlxcJyIpKSsnXCcpIiB0aXRsZT0iVm9pciBsYSBwcm9jw6lkdXJlIj4nKyhnLnRpdGxlfHxnLm5hbWV8fCcnKSsnPC9zcGFuPic7CiAgICAgICAgICAgICAgICBoKz0nIDxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7d2luZG93Lm9wZW5HdE1vZGFsKFwnJytnLmlkKydcJykiIHN0eWxlPSJjb2xvcjojODg4O2ZvbnQtc2l6ZTouN3JlbTtjdXJzb3I6cG9pbnRlcjttYXJnaW4tbGVmdDo2cHgiIHRpdGxlPSJNb2RpZmllciBsXHgyN8OpY2jDqWFuY2UiPjwvaT4nOwogICAgICAgICAgICAgICAgaCs9JzwvdGQ+JzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGgrPSc8dGQgY2xhc3M9Imd0LWxhIiBvbmNsaWNrPSJ3aW5kb3cub3Blbkd0TW9kYWwoXCcnK2cuaWQrJ1wnKSIgc3R5bGU9ImN1cnNvcjpwb2ludGVyIiB0aXRsZT0iTW9kaWZpZXIgbFx4MjfDqWNow6lhbmNlIj4nKyhnLnRpdGxlfHxnLm5hbWV8fCcnKSsnPC90ZD4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpc0FubmVlPWcuYW5uZWV8fGZhbHNlOwogICAgICAgICAgICBoKz0nPHRkIGNsYXNzPSJndC1jayI+JysoaXNBbm5lZT8nPHNwYW4gdGl0bGU9IsOAIGxcJ2FubsOpZSIgc3R5bGU9ImNvbG9yOiNhYWE7Zm9udC1zaXplOi43cmVtIj5cdTIyMUU8L3NwYW4+JzonPGlucHV0IHR5cGU9ImNoZWNrYm94IiAnKyhnLmRvbmU/J2NoZWNrZWQnOicnKSsnIG9uY2hhbmdlPSJ3aW5kb3cudG9nZ2xlUHJvY0RvbmUoXCcnK2cuaWQrJ1wnKSIgdGl0bGU9IlRlcm1pbsOpZSI+JykrJzwvdGQ+JzsKICAgICAgICAgICAgdmlzLmZvckVhY2goZnVuY3Rpb24odyl7CiAgICAgICAgICAgICAgICB2YXIgdmFjPXZ3LmluZGV4T2Yodyk+PTAsIGlyPXdJblIodyxnLndzdGFydCxnLndlbmQpOwogICAgICAgICAgICAgICAgaCs9Jzx0ZCcrKHZhYz8nIGNsYXNzPSJndC12YSInOicnKSsnIHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZSI+JzsKICAgICAgICAgICAgICAgIGlmKGlyKSBoKz0nPGRpdiBjbGFzcz0iZ3QtY2YiIHN0eWxlPSJiYWNrZ3JvdW5kOicrY29sKyc7LXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6ZXhhY3Q7cHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0JysoZy5kb25lPyc7b3BhY2l0eTouNCc6JycpKyciPicrJzwvZGl2Pic7CiAgICAgICAgICAgICAgICBoKz0nPC90ZD4nOwogICAgICAgICAgICB9KTtoKz0nPC90cj4nOwogICAgICAgIH0pOwogICAgICAgIGgrPSc8L3Rib2R5Pic7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0LXRibCcpLmlubmVySFRNTD1oOwogICAgICAgIC8vIFVwZGF0ZSBmaWx0ZXIgb3B0aW9ucyBkeW5hbWljYWxseQogICAgICAgIHZhciBmc2VsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndC1mYycpO3ZhciBjdXJWYWw9ZnNlbC52YWx1ZTsKICAgICAgICB2YXIgY2F0czI9e307KGFwcERhdGEucHJvY2VkdXJlc3x8W10pLmZvckVhY2goZnVuY3Rpb24ocHApe2lmKHBwLmNhdCYmKHBwLndzdGFydHx8cHAuYW5uZWUpKWNhdHMyW3BwLmNhdF09MTt9KTsKICAgICAgICAoYXBwRGF0YS5nYW50dHx8W10pLmZvckVhY2goZnVuY3Rpb24oZ2cpe2lmKGdnLmNhdCYmZ2cud3N0YXJ0KWNhdHMyW2dnLmNhdF09MTt9KTsKICAgICAgICB2YXIgZm9wdHM9JzxvcHRpb24gdmFsdWU9IkFMTCI+VG91dGVzIGNhdMOpZ29yaWVzPC9vcHRpb24+JzsKICAgICAgICBPYmplY3Qua2V5cyhjYXRzMikuc29ydCgpLmZvckVhY2goZnVuY3Rpb24oYyl7Zm9wdHMrPSc8b3B0aW9uIHZhbHVlPSInK2MrJyInKyhjdXJWYWw9PT1jPycgc2VsZWN0ZWQnOicnKSsnPicrYysnPC9vcHRpb24+Jzt9KTsKICAgICAgICBmc2VsLmlubmVySFRNTD1mb3B0czsKICAgIH0KCgogICAgICAgIC8vIFNob3cgbGFzdCBleHBvcnQKICAgICAgICBpZihhcHBEYXRhLnNldHRpbmdzJiZhcHBEYXRhLnNldHRpbmdzLmxhc3RFeHBvcnQpewogICAgICAgICAgICB2YXIgZWw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhc3QtZXhwb3J0Jyk7CiAgICAgICAgICAgIGlmKGVsKWVsLnRleHRDb250ZW50PSdEZXJuaWVyIGV4cG9ydCA6ICcrbmV3IERhdGUoYXBwRGF0YS5zZXR0aW5ncy5sYXN0RXhwb3J0KS50b0xvY2FsZVN0cmluZygnZnItRlInKTsKICAgICAgICB9CgogICAgd2luZG93LnNhdmVFdmVudCA9IHNhdmVFdmVudDsKICAgIHdpbmRvdy5vcGVuRXZNb2RhbCA9IG9wZW5Fdk1vZGFsOwogICAgd2luZG93LmNsb3NlRXZNb2RhbCA9IGNsb3NlRXZNb2RhbDsKICAgIHdpbmRvdy5kZWxFdkZyb21Nb2RhbCA9IGRlbEV2RnJvbU1vZGFsOwogICAgd2luZG93LmZpbGxUZWFjaGVyU2VsID0gZmlsbFRlYWNoZXJTZWw7CiAgICB3aW5kb3cucGlja1NhdmVGaWxlID0gcGlja1NhdmVGaWxlOwogICAgd2luZG93LnBpY2tFeGlzdGluZ0ZpbGUgPSBwaWNrRXhpc3RpbmdGaWxlOwogICAgd2luZG93LnVubGlua0ZpbGUgPSB1bmxpbmtGaWxlOwogICAgd2luZG93LndyaXRlVG9GaWxlID0gd3JpdGVUb0ZpbGU7CiAgICB3aW5kb3cubG9hZEZyb21GaWxlID0gbG9hZEZyb21GaWxlOwogICAgd2luZG93LnVwZGF0ZUZpbGVVSSA9IHVwZGF0ZUZpbGVVSTsKICAgIHdpbmRvdy5yZXN0b3JlRmlsZUhhbmRsZSA9IHJlc3RvcmVGaWxlSGFuZGxlOwogICAgd2luZG93LmV4cG9ydERhdGEgPSBleHBvcnREYXRhOwogICAgd2luZG93LmltcG9ydERhdGEgPSBpbXBvcnREYXRhOwo8L3NjcmlwdD4KCjxzY3JpcHQ+CihmdW5jdGlvbigpewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKCFlLmRhdGEgfHwgZS5kYXRhLnR5cGUgIT09ICdwaWxvdGUtc2V0dGluZ3MnKSByZXR1cm47CiAgICAgICAgdmFyIHMgPSBlLmRhdGEuZGF0YTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAodHlwZW9mIGFwcERhdGEgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICBpZiAocy5zY2hvb2wpIGFwcERhdGEuc2V0dGluZ3Muc2Nob29sID0gcy5zY2hvb2w7CiAgICAgICAgICAgICAgICBpZiAocy5uYW1lKSBhcHBEYXRhLnNldHRpbmdzLnVzZXIgPSBzLm5hbWU7CiAgICAgICAgICAgICAgICBpZiAocy5sb2dvU3JjKSBhcHBEYXRhLnNldHRpbmdzLmxvZ28gPSBzLmxvZ29TcmM7CiAgICAgICAgICAgICAgICBpZiAocy5wZGZIZWFkZXJMYXlvdXQpICAgYXBwRGF0YS5zZXR0aW5ncy5wZGZIZWFkZXJMYXlvdXQgICA9IHMucGRmSGVhZGVyTGF5b3V0OwogICAgICAgICAgICAgICAgaWYgKHMucGRmSGVhZGVyQ29sb3IpICAgIGFwcERhdGEuc2V0dGluZ3MucGRmSGVhZGVyQ29sb3IgICAgPSBzLnBkZkhlYWRlckNvbG9yOwogICAgICAgICAgICAgICAgaWYgKHMucGRmSGVhZGVyU3VidGl0bGUpIGFwcERhdGEuc2V0dGluZ3MucGRmSGVhZGVyU3VidGl0bGUgPSBzLnBkZkhlYWRlclN1YnRpdGxlOwogICAgICAgICAgICAgICAgaWYgKHMuc2lnblNyYykgYXBwRGF0YS5zZXR0aW5ncy5zaWduYXR1cmUgPSBzLnNpZ25TcmM7CiAgICAgICAgICAgICAgICBpZiAocy56b25lKSBhcHBEYXRhLnNldHRpbmdzLnpvbmUgPSBzLnpvbmU7CiAgICAgICAgICAgICAgICBpZiAocy50ZWFjaGVycyAmJiBzLnRlYWNoZXJzLmxlbmd0aCkgeyBfdGVhY2hlcnMgPSBzLnRlYWNoZXJzOyB9CiAgICAgICAgICAgICAgICBpZiAocy5zdHVkZW50cyAmJiBzLnN0dWRlbnRzLmxlbmd0aCkgeyBfc3R1ZGVudHMgPSBzLnN0dWRlbnRzOyB9CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHMuZ2NhbEVuYWJsZWQgIT09ICd1bmRlZmluZWQnKSB7IHNldENhbGVuZGFyTW9kZShzLmdjYWxFbmFibGVkKTsgfQogICAgICAgICAgICAgICAgaWYgKHMuZ2NhbEV2ZW50cykgeyBfZ2NhbEV2ZW50cyA9IHMuZ2NhbEV2ZW50czsgcmVuZGVyVW5pZmllZENhbCgpOyB9CiAgICAgICAgICAgICAgICBpZiAocy5nY2FsQ2FsZW5kYXJzKSB7IF9nY2FsQ2FsZW5kYXJzID0gcy5nY2FsQ2FsZW5kYXJzOyB9CiAgICAgICAgICAgICAgICBpZiAocy5nY2FsU2VsKSB7IF9nY2FsU2VsZWN0ZWRJZHMgPSBzLmdjYWxTZWw7IH0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2F2ZURhdGEgPT09ICdmdW5jdGlvbicpIHNhdmVEYXRhKCk7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGluaXRTdHVkZW50QUMgPT09ICdmdW5jdGlvbicpIGluaXRTdHVkZW50QUMoKTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaW5pdFRlYWNoZXJBQyA9PT0gJ2Z1bmN0aW9uJykgaW5pdFRlYWNoZXJBQygpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaChlcnIpIHsgY29uc29sZS53YXJuKCdCcmlkZ2UgZXJyb3I6JywgZXJyKTsgfQogICAgfSk7CiAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHsgdHlwZTogJ3BpbG90ZS1tb2R1bGUtcmVhZHknLCBtb2R1bGU6ICdwZXJkaXInIH0sICcqJyk7CgogICAgCiAgICAvLyDilZDilZDilZAgVEFCIEtFWSBJTiBSVEUgRURJVE9SUyDilZDilZDilZAKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIGVsID0gZS50YXJnZXQ7CiAgICAgICAgaWYgKCFlbCB8fCAhZWwuY2xhc3NMaXN0IHx8ICFlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2RvYy1lZGl0b3InKSB8fCAhZWwuaXNDb250ZW50RWRpdGFibGUpIHJldHVybjsKICAgICAgICBpZiAoZS5rZXkgPT09ICdUYWInKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdvdXRkZW50JywgZmFsc2UsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luZGVudCcsIGZhbHNlLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIEZvcndhcmQga2V5Ym9hcmQgc2hvcnRjdXRzIHRvIHBhcmVudAogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAoIWUuY3RybEtleSB8fCBlLnNoaWZ0S2V5IHx8IGUuYWx0S2V5IHx8IGUubWV0YUtleSkgcmV0dXJuOwogICAgICAgIHZhciBrZXkgPSBlLmtleS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGlmIChbJ3AnLCdlJywnbycsJ2EnLCdkJ10uaW5kZXhPZihrZXkpID49IDApIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHt0eXBlOidwaWxvdGUtc2hvcnRjdXQnLCBrZXk6a2V5fSwgJyonKTsKICAgICAgICB9CiAgICB9KTsKCgogICAgLy8gTGlzdGVuIGZvciBnY2FsIENSVUQgcmVzcG9uc2VzCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGVPTCkgewogICAgICAgIGlmICghZU9MLmRhdGEgfHwgZU9MLmRhdGEudHlwZSAhPT0gJ3BpbG90ZS1vdXRsb29rJykgcmV0dXJuOwogICAgICAgIHZhciBvZCA9IGVPTC5kYXRhLmRhdGE7CiAgICAgICAgaWYgKG9kKSB7CiAgICAgICAgICAgIGlmIChvZC5vdXRsb29rRXZlbnRzKSB7IF9vdXRsb29rRXZlbnRzID0gb2Qub3V0bG9va0V2ZW50czsgcmVuZGVyVW5pZmllZENhbCgpOyB9CiAgICAgICAgICAgIGlmIChvZC5vdXRsb29rQ2FscykgX291dGxvb2tDYWxlbmRhcnMgPSBvZC5vdXRsb29rQ2FsczsKICAgICAgICAgICAgaWYgKHR5cGVvZiBvZC5vdXRsb29rRW5hYmxlZCAhPT0gJ3VuZGVmaW5lZCcpIF9vdXRsb29rRW5hYmxlZCA9IG9kLm91dGxvb2tFbmFibGVkOwogICAgICAgIH0KICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbihlMikgewogICAgICAgIGlmICghZTIuZGF0YSkgcmV0dXJuOwogICAgICAgIGlmIChlMi5kYXRhLnR5cGUgPT09ICdwaWxvdGUtZ2NhbC1jcnVkLW9rJykgewogICAgICAgICAgICAvLyBSZWZyZXNoIGFmdGVyIENSVUQKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpeyB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHt0eXBlOidwaWxvdGUtZ2NhbC1yZWZyZXNoJ30sICcqJyk7IH0sIDUwMCk7CiAgICAgICAgfQogICAgfSk7Cn0pKCk7CgogICAgCiAgICBmdW5jdGlvbiBlc2NIdG1sKHMpIHsgdmFyIGQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IGQudGV4dENvbnRlbnQ9czsgcmV0dXJuIGQuaW5uZXJIVE1MOyB9CgogICAgZnVuY3Rpb24gc2V0Q2FsZW5kYXJNb2RlKGVuYWJsZWQpIHsgX2djYWxFbmFibGVkID0gZW5hYmxlZDsgfQoKICAgIC8vIOKVkOKVkOKVkCBDQUxFTkRSSUVSIFVOSUZJw4kgVjEyLjEzIOKVkOKVkOKVkAogICAgdmFyIF9nY2FsRW5hYmxlZCA9IGZhbHNlOwogICAgdmFyIF9nY2FsRXZlbnRzID0gW107CiAgICB2YXIgX3VjYWxNb250aCA9IG5ldyBEYXRlKCkuZ2V0TW9udGgoKTsKICAgIHZhciBfdWNhbFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CiAgICB2YXIgX2djYWxDYWxlbmRhcnMgPSBbXTsgLy8gbGlzdCBvZiB7aWQsIG5hbWUsIGJnfQoKICAgIHZhciBfdWNhbFZpZXcgPSAnYnljYWwnOwogICAgdmFyIF91Y2FsUmFuZ2VTdGFydCA9IChmdW5jdGlvbigpeyB2YXIgZD1uZXcgRGF0ZSgpOyBkLnNldEhvdXJzKDAsMCwwLDApOyByZXR1cm4gZDsgfSkoKTsKICAgIHZhciBfZ2NhbFNlbGVjdGVkSWRzID0gW107IC8vIElEcyBzZWxlY3RlZCBpbiBtYXN0ZXIgc2V0dGluZ3MKICAgIHZhciBfb3V0bG9va0V2ZW50cyA9IFtdOwogICAgdmFyIF9vdXRsb29rQ2FsZW5kYXJzID0gW107CiAgICB2YXIgX291dGxvb2tFbmFibGVkID0gZmFsc2U7CgogICAgLy8gQ29sb3IgbWFwIGZvciBldmVudCB0eXBlcwogICAgdmFyIFVDQUxfQ09MT1JTID0gewogICAgICAgIGxvY2FsOiAnIzM0OThkYicsCiAgICAgICAgZmVyaWU6ICcjZTc0YzNjJywKICAgICAgICB2YWM6ICcjZTY3ZTIyJywKICAgICAgICBnY2FsRGVmYXVsdDogJyM0Mjg1ZjQnCiAgICB9OwoKICAgIGZ1bmN0aW9uIHVjYWxQcmV2KCkgewogICAgICAgIGlmIChfdWNhbFZpZXcgPT09ICdieWNhbCcpIHsgdmFyIGQ9bmV3IERhdGUoX3VjYWxSYW5nZVN0YXJ0KTsgZC5zZXREYXRlKGQuZ2V0RGF0ZSgpLTE0KTsgZC5zZXRIb3VycygwLDAsMCwwKTsgX3VjYWxSYW5nZVN0YXJ0PWQ7IHJlbmRlclVuaWZpZWRDYWwoKTsgcmV0dXJuOyB9CiAgICAgICAgX3VjYWxNb250aC0tOyBpZihfdWNhbE1vbnRoPDApe191Y2FsTW9udGg9MTE7X3VjYWxZZWFyLS07fSByZW5kZXJVbmlmaWVkQ2FsKCk7CiAgICB9IHJlbmRlclVuaWZpZWRDYWwoKTsgfQogICAgZnVuY3Rpb24gdWNhbE5leHQoKSB7CiAgICAgICAgaWYgKF91Y2FsVmlldyA9PT0gJ2J5Y2FsJykgeyB2YXIgZD1uZXcgRGF0ZShfdWNhbFJhbmdlU3RhcnQpOyBkLnNldERhdGUoZC5nZXREYXRlKCkrMTQpOyBkLnNldEhvdXJzKDAsMCwwLDApOyBfdWNhbFJhbmdlU3RhcnQ9ZDsgcmVuZGVyVW5pZmllZENhbCgpOyByZXR1cm47IH0KICAgICAgICBfdWNhbE1vbnRoKys7IGlmKF91Y2FsTW9udGg+MTEpe191Y2FsTW9udGg9MDtfdWNhbFllYXIrKzt9IHJlbmRlclVuaWZpZWRDYWwoKTsKICAgIH0gcmVuZGVyVW5pZmllZENhbCgpOyB9CiAgICBmdW5jdGlvbiB1Y2FsVG9kYXkoKSB7CiAgICAgICAgaWYgKF91Y2FsVmlldyA9PT0gJ2J5Y2FsJykgeyB2YXIgZD1uZXcgRGF0ZSgpOyBkLnNldEhvdXJzKDAsMCwwLDApOyBfdWNhbFJhbmdlU3RhcnQ9ZDsgcmVuZGVyVW5pZmllZENhbCgpOyByZXR1cm47IH0KICAgICAgICBfdWNhbE1vbnRoPW5ldyBEYXRlKCkuZ2V0TW9udGgoKTsgX3VjYWxZZWFyPW5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTsgcmVuZGVyVW5pZmllZENhbCgpOwogICAgfQogICAgZnVuY3Rpb24gdWNhbFJlZnJlc2goKSB7IHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2Uoe3R5cGU6J3BpbG90ZS1nY2FsLXJlZnJlc2gnfSwgJyonKTsgfQoKICAgIGZ1bmN0aW9uIHNldFVjYWxWaWV3KHYpeyBfdWNhbFZpZXc9djsgdmFyIGI9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWxWaWV3QnljYWwnKTsgdmFyIG09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWxWaWV3TW9udGgnKTsgaWYoYikgYi5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCB2PT09J2J5Y2FsJyk7IGlmKG0pIG0uY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgdj09PSdtb250aCcpOyByZW5kZXJVbmlmaWVkQ2FsKCk7IH0KCiAgICBmdW5jdGlvbiByZW5kZXJVbmlmaWVkQ2FsKCkgewogICAgICAgIC8vIFRvZ2dsZSBzdGF0ZQogICAgICAgIHZhciBiPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsVmlld0J5Y2FsJyk7IHZhciBtPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsVmlld01vbnRoJyk7CiAgICAgICAgaWYoYikgYi5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBfdWNhbFZpZXc9PT0nYnljYWwnKTsKICAgICAgICBpZihtKSBtLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIF91Y2FsVmlldz09PSdtb250aCcpOwogICAgICAgIGlmIChfdWNhbFZpZXcgPT09ICdieWNhbCcpIHsgcmVuZGVyVW5pZmllZEJ5Q2FsZW5kYXIoKTsgcmV0dXJuOyB9CgogICAgICAgIHZhciBtTmFtZXMgPSBbJ0phbnZpZXInLCdGw6l2cmllcicsJ01hcnMnLCdBdnJpbCcsJ01haScsJ0p1aW4nLCdKdWlsbGV0JywnQW/Du3QnLCdTZXB0ZW1icmUnLCdPY3RvYnJlJywnTm92ZW1icmUnLCdEw6ljZW1icmUnXTsKICAgICAgICB2YXIgdGl0bGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLXRpdGxlJyk7CiAgICAgICAgaWYgKHRpdGxlRWwpIHRpdGxlRWwudGV4dENvbnRlbnQgPSBtTmFtZXNbX3VjYWxNb250aF0gKyAnICcgKyBfdWNhbFllYXI7CgogICAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtYm9keScpOwogICAgICAgIGlmICghYm9keSkgcmV0dXJuOwogICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgICAgIHZhciBtU3RyID0gX3VjYWxZZWFyICsgJy0nICsgU3RyaW5nKF91Y2FsTW9udGgrMSkucGFkU3RhcnQoMiwnMCcpOwogICAgICAgIHZhciBpc0N1cnJlbnRNb250aCA9IChfdWNhbE1vbnRoID09PSBuZXcgRGF0ZSgpLmdldE1vbnRoKCkgJiYgX3VjYWxZZWFyID09PSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkpOwoKICAgICAgICAvLyBDb2xsZWN0IEFMTCBldmVudHMgZm9yIHRoaXMgbW9udGgKICAgICAgICB2YXIgYWxsID0gW107CgogICAgICAgIC8vIDEuIExvY2FsIGV2ZW50cwogICAgICAgIChhcHBEYXRhLmNhbGVuZGFyIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgaWYgKCFjLmRhdGUgfHwgIWMudGFzayB8fCBjLmRhdGUuc3Vic3RyaW5nKDAsNykgIT09IG1TdHIpIHJldHVybjsKICAgICAgICAgICAgdmFyIHR5cGUgPSAnbG9jYWwnOwogICAgICAgICAgICBpZiAoYy52YWNPZmZpY2llbCkgdHlwZSA9IGMudGFzay5pbmRleE9mKCfwn4er8J+HtycpID49IDAgPyAnZmVyaWUnIDogJ3ZhYyc7CiAgICAgICAgICAgIGFsbC5wdXNoKHsKICAgICAgICAgICAgICAgIGlkOiBjLmlkLCB0aXRsZTogYy50YXNrLCBkYXRlOiBjLmRhdGUsIHRpbWU6ICcnLCBlbmRUaW1lOiAnJywKICAgICAgICAgICAgICAgIHNyYzogJ2xvY2FsJywgdHlwZTogdHlwZSwKICAgICAgICAgICAgICAgIGNvbG9yOiB0eXBlID09PSAnZmVyaWUnID8gVUNBTF9DT0xPUlMuZmVyaWUgOiB0eXBlID09PSAndmFjJyA/IFVDQUxfQ09MT1JTLnZhYyA6IFVDQUxfQ09MT1JTLmxvY2FsLAogICAgICAgICAgICAgICAgY2FsTmFtZTogdHlwZSA9PT0gJ2ZlcmllJyA/ICdKb3VyIGbDqXJpw6knIDogdHlwZSA9PT0gJ3ZhYycgPyAnVmFjYW5jZXMnIDogJ0FnZW5kYSBsb2NhbCcsCiAgICAgICAgICAgICAgICBjYWxJZDogJycsIGVkaXRhYmxlOiB0eXBlID09PSAnbG9jYWwnCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLyAyLiBHb29nbGUgQ2FsZW5kYXIgZXZlbnRzCiAgICAgICAgKF9nY2FsRXZlbnRzIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgaWYgKCFlLmRhdGUgfHwgZS5kYXRlLnN1YnN0cmluZygwLDcpICE9PSBtU3RyKSByZXR1cm47CiAgICAgICAgICAgIC8vIEF2b2lkIGR1cGxpY2F0ZXMgd2l0aCBsb2NhbAogICAgICAgICAgICB2YXIgaXNEdXAgPSBhbGwuc29tZShmdW5jdGlvbihhKXsgcmV0dXJuIGEudGl0bGUgPT09IGUudGl0bGUgJiYgYS5kYXRlID09PSBlLmRhdGUgJiYgYS5zcmMgPT09ICdsb2NhbCc7IH0pOwogICAgICAgICAgICBpZiAoaXNEdXApIHJldHVybjsKICAgICAgICAgICAgYWxsLnB1c2goewogICAgICAgICAgICAgICAgaWQ6IGUuaWQsIHRpdGxlOiBlLnRpdGxlLCBkYXRlOiBlLmRhdGUsIHRpbWU6IGUudGltZSB8fCAnJywgZW5kVGltZTogZS5lbmRUaW1lIHx8ICcnLAogICAgICAgICAgICAgICAgc3JjOiAnZ2NhbCcsIHR5cGU6ICdnY2FsJywKICAgICAgICAgICAgICAgIGNvbG9yOiBlLmNvbG9yIHx8IFVDQUxfQ09MT1JTLmdjYWxEZWZhdWx0LAogICAgICAgICAgICAgICAgY2FsTmFtZTogZS5jYWxOYW1lIHx8ICdHb29nbGUnLCBjYWxJZDogZS5jYWxJZCB8fCAnJywKICAgICAgICAgICAgICAgIGVkaXRhYmxlOiAhIV9nY2FsRW5hYmxlZAogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gMy4gT3V0bG9vayBldmVudHMKICAgICAgICAoX291dGxvb2tFdmVudHMgfHwgW10pLmZvckVhY2goZnVuY3Rpb24oZSkgewogICAgICAgICAgICBpZiAoIWUuZGF0ZSB8fCBlLmRhdGUuc3Vic3RyaW5nKDAsNykgIT09IG1TdHIpIHJldHVybjsKICAgICAgICAgICAgdmFyIGlzRHVwID0gYWxsLnNvbWUoZnVuY3Rpb24oYSl7IHJldHVybiBhLnRpdGxlID09PSBlLnRpdGxlICYmIGEuZGF0ZSA9PT0gZS5kYXRlOyB9KTsKICAgICAgICAgICAgaWYgKGlzRHVwKSByZXR1cm47CiAgICAgICAgICAgIGFsbC5wdXNoKHsKICAgICAgICAgICAgICAgIGlkOiBlLmlkLCB0aXRsZTogZS50aXRsZSwgZGF0ZTogZS5kYXRlLCB0aW1lOiBlLnRpbWUgfHwgJycsIGVuZFRpbWU6IGUuZW5kVGltZSB8fCAnJywKICAgICAgICAgICAgICAgIHNyYzogJ291dGxvb2snLCB0eXBlOiAnb3V0bG9vaycsCiAgICAgICAgICAgICAgICBjb2xvcjogZS5jb2xvciB8fCAnIzAwNzhkNCcsCiAgICAgICAgICAgICAgICBjYWxOYW1lOiBlLmNhbE5hbWUgfHwgJ091dGxvb2snLCBjYWxJZDogZS5jYWxJZCB8fCAnJywKICAgICAgICAgICAgICAgIGVkaXRhYmxlOiAhIV9vdXRsb29rRW5hYmxlZAogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gU29ydCBieSBkYXRlK3RpbWUKICAgICAgICBhbGwuc29ydChmdW5jdGlvbihhLGIpIHsgcmV0dXJuIChhLmRhdGUrJyAnKyhhLnRpbWV8fCcwMDowMCcpKS5sb2NhbGVDb21wYXJlKGIuZGF0ZSsnICcrKGIudGltZXx8JzAwOjAwJykpOyB9KTsKCiAgICAgICAgLy8gRmlsdGVyOiBmb3IgY3VycmVudCBtb250aCwgb25seSBmdXR1cmUgZXZlbnRzCiAgICAgICAgaWYgKGlzQ3VycmVudE1vbnRoKSB7CiAgICAgICAgICAgIGFsbCA9IGFsbC5maWx0ZXIoZnVuY3Rpb24oZSkgeyByZXR1cm4gZS5kYXRlID49IHRvZGF5OyB9KTsKICAgICAgICB9CgogICAgICAgIGlmICghYWxsLmxlbmd0aCkgewogICAgICAgICAgICBib2R5LmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWVtcHR5Ij48aSBjbGFzcz0iZmFzIGZhLWNhbGVuZGFyLWNoZWNrIj48L2k+QXVjdW4gw6l2w6luZW1lbnQgY2UgbW9pczwvZGl2Pic7CiAgICAgICAgICAgIHJlbmRlclVjYWxMZWdlbmQoW10pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBHcm91cCBieSBkYXkKICAgICAgICB2YXIgZ3JvdXBzID0ge307CiAgICAgICAgYWxsLmZvckVhY2goZnVuY3Rpb24oZSkgeyBpZighZ3JvdXBzW2UuZGF0ZV0pIGdyb3Vwc1tlLmRhdGVdPVtdOyBncm91cHNbZS5kYXRlXS5wdXNoKGUpOyB9KTsKCiAgICAgICAgdmFyIGh0bWwgPSAnJzsKICAgICAgICB2YXIgc3JjU2V0ID0gbmV3IFNldCgpOwogICAgICAgIE9iamVjdC5rZXlzKGdyb3Vwcykuc29ydCgpLmZvckVhY2goZnVuY3Rpb24oZGF0ZSkgewogICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKGRhdGUgKyAnVDEyOjAwOjAwJyk7CiAgICAgICAgICAgIHZhciBkYXlOYW1lID0gZC50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJywge3dlZWtkYXk6J2xvbmcnLCBkYXk6J251bWVyaWMnLCBtb250aDonbG9uZyd9KTsKICAgICAgICAgICAgZGF5TmFtZSA9IGRheU5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXlOYW1lLnNsaWNlKDEpOwogICAgICAgICAgICB2YXIgaXNUb2RheSA9IGRhdGUgPT09IHRvZGF5OwoKICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC1kYXktZ3JvdXAiPic7CiAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9InVjYWwtZGF5LWhkcicrKGlzVG9kYXk/JyBpcy10b2RheSc6JycpKyciPicrKGlzVG9kYXk/JzxpIGNsYXNzPSJmYXMgZmEtc3RhciIgc3R5bGU9ImNvbG9yOiNlNjdlMjI7bWFyZ2luLXJpZ2h0OjRweDtmb250LXNpemU6LjdyZW0iPjwvaT4nOicnKStkYXlOYW1lKyc8L2Rpdj4nOwoKICAgICAgICAgICAgZ3JvdXBzW2RhdGVdLmZvckVhY2goZnVuY3Rpb24oZXYpIHsKICAgICAgICAgICAgICAgIHNyY1NldC5hZGQoZXYudHlwZSA9PT0gJ2djYWwnID8gZXYuY2FsTmFtZSA6IGV2LnR5cGUpOwogICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC1pdGVtIj4nOwogICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC1kb3QiIHN0eWxlPSJiYWNrZ3JvdW5kOicrZXYuY29sb3IrJyI+PC9kaXY+JzsKICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9InVjYWwtbGVmdCI+JzsKICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9InVjYWwtaXRlbS10aW1lIj4nKyhldi50aW1lID8gZXYudGltZSsoZXYuZW5kVGltZT8nIOKAkyAnK2V2LmVuZFRpbWU6JycpIDogJzxzcGFuIHN0eWxlPSJjb2xvcjojY2NjIj5Kb3VybsOpZTwvc3Bhbj4nKSsnPC9kaXY+JzsKICAgICAgICAgICAgICAgIGlmIChldi5lZGl0YWJsZSB8fCBldi5zcmM9PT0nZ2NhbCcpIHsKICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWl0ZW0tYWN0aW9ucyI+JzsKICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8YnV0dG9uIG9uY2xpY2s9ImVkaXRVY2FsRXZlbnQoXCcnK2V2LmlkKydcJyxcJycrZXYuc3JjKydcJyxcJycrZXYuY2FsSWQucmVwbGFjZSgvJy9nLCJcXCciKSsnXCcpIj48aSBjbGFzcz0iZmFzIGZhLXBlbiI+PC9pPjwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPGJ1dHRvbiBjbGFzcz0iYWN0LWRlbCIgb25jbGljaz0iZGVsZXRlVWNhbEV2ZW50KFwnJytldi5pZCsnXCcsXCcnK2V2LnNyYysnXCcsXCcnK2V2LmNhbElkLnJlcGxhY2UoLycvZywiXFwnIikrJ1wnKSI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPjwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvZGl2Pic7CiAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWluZm8iPic7CiAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWl0ZW0tdGl0bGUiPicrZXNjSHRtbChldi50aXRsZSkrJzwvZGl2Pic7CiAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWl0ZW0tbWV0YSI+Jytlc2NIdG1sKGV2LmNhbE5hbWUpOwogICAgICAgICAgICAgICAgaWYgKGV2LnNyYz09PSdnY2FsJykgaHRtbCArPSAnIDxzcGFuIGNsYXNzPSJ1Y2FsLXNyYy1iYWRnZSIgc3R5bGU9ImJhY2tncm91bmQ6IzQyODVmNCI+Rzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvZGl2Pic7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBodG1sICs9ICc8L2Rpdj4nOwogICAgICAgIH0pOwogICAgICAgIGJvZHkuaW5uZXJIVE1MID0gaHRtbDsKICAgICAgICByZW5kZXJVY2FsTGVnZW5kKHNyY1NldCk7CiAgICB9CgogICAgZnVuY3Rpb24gX3VjYWxGbXRGUihkKXsgcmV0dXJuIGQudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonMi1kaWdpdCcsbW9udGg6JzItZGlnaXQnfSk7IH0KICAgIGZ1bmN0aW9uIF91Y2FsSXNvKGQpeyByZXR1cm4gZC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07IH0KICAgIGZ1bmN0aW9uIF91Y2FsU2FmZVRpbWUodCl7IHJldHVybiAodHx8JycpLnN1YnN0cmluZygwLDUpOyB9CgogICAgZnVuY3Rpb24gX3VjYWxDb2xsZWN0QWxsRXZlbnRzKCkgewogICAgICAgIHZhciBhbGwgPSBbXTsKICAgICAgICAvLyAxKSBMb2NhbCBldmVudHMgKENBRElSKQogICAgICAgIChhcHBEYXRhLmNhbGVuZGFyIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGMpewogICAgICAgICAgICBpZiAoIWMuZGF0ZSB8fCAhYy50YXNrKSByZXR1cm47CiAgICAgICAgICAgIHZhciB0eXBlID0gJ2xvY2FsJzsKICAgICAgICAgICAgaWYgKGMudmFjT2ZmaWNpZWwpIHR5cGUgPSBjLnRhc2suaW5kZXhPZign8J+Hq/Cfh7cnKSA+PSAwID8gJ2ZlcmllJyA6ICd2YWMnOwogICAgICAgICAgICBhbGwucHVzaCh7IGlkOmMuaWQsIHRpdGxlOmMudGFzaywgZGF0ZTpjLmRhdGUsIHRpbWU6JycsIGVuZFRpbWU6JycsIHNyYzonbG9jYWwnLCBjYWxOYW1lOidMb2NhbCcsIGNvbG9yOicjOGU0NGFkJyB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gMikgR29vZ2xlIGV2ZW50cyAoZnJvbSB3cmFwcGVyIHN5bmMpCiAgICAgICAgKF9nY2FsRXZlbnRzIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGV2KXsKICAgICAgICAgICAgaWYoIWV2LmRhdGUpIHJldHVybjsKICAgICAgICAgICAgYWxsLnB1c2goeyBpZDpldi5pZCwgdGl0bGU6ZXYudGl0bGUsIGRhdGU6ZXYuZGF0ZSwgdGltZTpfdWNhbFNhZmVUaW1lKGV2LnRpbWUpLCBlbmRUaW1lOl91Y2FsU2FmZVRpbWUoZXYuZW5kVGltZSksIHNyYzonZ2NhbCcsIGNhbElkOmV2LmNhbElkLCBjYWxOYW1lOmV2LmNhbE5hbWV8fCdHb29nbGUnLCBjb2xvcjpldi5jb2xvcnx8JyM0Mjg1ZjQnIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLyAzKSBPdXRsb29rIGV2ZW50cyAoZnJvbSB3cmFwcGVyIHN5bmMpCiAgICAgICAgKF9vdXRsb29rRXZlbnRzIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGV2KXsKICAgICAgICAgICAgaWYoIWV2LmRhdGUpIHJldHVybjsKICAgICAgICAgICAgYWxsLnB1c2goeyBpZDpldi5pZCwgdGl0bGU6ZXYudGl0bGUsIGRhdGU6ZXYuZGF0ZSwgdGltZTpfdWNhbFNhZmVUaW1lKGV2LnRpbWUpLCBlbmRUaW1lOl91Y2FsU2FmZVRpbWUoZXYuZW5kVGltZSksIHNyYzonb3V0bG9vaycsIGNhbElkOmV2LmNhbElkLCBjYWxOYW1lOmV2LmNhbE5hbWV8fCdPdXRsb29rJywgY29sb3I6ZXYuY29sb3J8fCcjMDA3OGQ0JyB9KTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGFsbDsKICAgIH0KCiAgICAKZnVuY3Rpb24gdWNhbEp1bXBUb05leHRFdmVudCgpewogICAgdHJ5ewogICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7IHRvZGF5LnNldEhvdXJzKDAsMCwwLDApOwogICAgICAgIHZhciBhbGwgPSBfdWNhbENvbGxlY3RBbGxFdmVudHMoKS5zbGljZSgpLnNvcnQoZnVuY3Rpb24oYSxiKXsKICAgICAgICAgICAgdmFyIGthPWEuZGF0ZSsnICcrKGEudGltZXx8JzAwOjAwJyk7IHZhciBrYj1iLmRhdGUrJyAnKyhiLnRpbWV8fCcwMDowMCcpOyByZXR1cm4ga2EubG9jYWxlQ29tcGFyZShrYik7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIG5leHQgPSBhbGwuZmluZChmdW5jdGlvbihldil7IHJldHVybiBldi5kYXRlID49IF91Y2FsSXNvKHRvZGF5KTsgfSk7CiAgICAgICAgaWYoIW5leHQpeyBhbGVydCgiQXVjdW4gw6l2w6luZW1lbnQgw6AgdmVuaXIgZGFucyBsZXMgZG9ubsOpZXMgc3luY2hyb25pc8OpZXMuIik7IHJldHVybjsgfQogICAgICAgIHZhciBkID0gbmV3IERhdGUobmV4dC5kYXRlICsgJ1QwMDowMDowMCcpOyBkLnNldEhvdXJzKDAsMCwwLDApOwogICAgICAgIF91Y2FsUmFuZ2VTdGFydCA9IGQ7CiAgICAgICAgcmVuZGVyVW5pZmllZENhbCgpOwogICAgfWNhdGNoKGUpeyBjb25zb2xlLndhcm4oZSk7IH0KfQpmdW5jdGlvbiByZW5kZXJVbmlmaWVkQnlDYWxlbmRhcigpIHsKICAgICAgICB2YXIgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWJvZHknKTsKICAgICAgICBpZiAoIWJvZHkpIHJldHVybjsKCiAgICAgICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoX3VjYWxSYW5nZVN0YXJ0KTsgc3RhcnQuc2V0SG91cnMoMCwwLDAsMCk7CiAgICAgICAgdmFyIGVuZCA9IG5ldyBEYXRlKHN0YXJ0KTsgZW5kLnNldERhdGUoZW5kLmdldERhdGUoKSsxNCk7IGVuZC5zZXRIb3VycygwLDAsMCwwKTsKCiAgICAgICAgLy8gVGl0bGUgPSByYW5nZQogICAgICAgIHZhciB0aXRsZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtdGl0bGUnKTsKICAgICAgICBpZiAodGl0bGVFbCkgdGl0bGVFbC50ZXh0Q29udGVudCA9ICdEdSAnICsgX3VjYWxGbXRGUihzdGFydCkgKyAnIGF1ICcgKyBfdWNhbEZtdEZSKG5ldyBEYXRlKGVuZC5nZXRUaW1lKCktMSkpOwogICAgICAgIGlmICh0aXRsZUVsKSB7IHRpdGxlRWwuaW5uZXJIVE1MID0gdGl0bGVFbC50ZXh0Q29udGVudCArICcgPHNwYW4gc3R5bGU9XCJmb250LXNpemU6Ljc1cmVtO2NvbG9yOiM5NGEzYjg7Zm9udC13ZWlnaHQ6NzAwXCI+KEdvb2dsZTogJyArICgoX2djYWxFdmVudHN8fFtdKS5sZW5ndGgpICsgJywgT3V0bG9vazogJyArICgoX291dGxvb2tFdmVudHN8fFtdKS5sZW5ndGgpICsgJyk8L3NwYW4+JzsgfQoKICAgICAgICAvLyBMZWdlbmQgYnkgY2FsZW5kYXJzIHNlbGVjdGVkIChiZXN0IGVmZm9ydCkKICAgICAgICB2YXIgbGVnZW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtbGVnZW5kJyk7CiAgICAgICAgaWYgKGxlZ2VuZCkgewogICAgICAgICAgICB2YXIgY2FscyA9IHt9OwogICAgICAgICAgICAoX2djYWxDYWxlbmRhcnMgfHwgW10pLmZvckVhY2goZnVuY3Rpb24oYyl7IGNhbHNbYy5uYW1lXT1jLmJnfHxjLmJhY2tncm91bmRDb2xvcnx8Yy5jb2xvcnx8JyM0Mjg1ZjQnOyB9KTsKICAgICAgICAgICAgKF9vdXRsb29rQ2FsZW5kYXJzIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGMpeyBjYWxzW2MubmFtZV09Yy5jb2xvcnx8JyMwMDc4ZDQnOyB9KTsKICAgICAgICAgICAgY2Fsc1snTG9jYWwnXSA9ICcjOGU0NGFkJzsKICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhjYWxzKTsKICAgICAgICAgICAgbGVnZW5kLmlubmVySFRNTCA9IGtleXMuc2xpY2UoMCw2KS5tYXAoZnVuY3Rpb24oayl7CiAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPSJkaXNwbGF5OmlubGluZS1mbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6NnB4O21hcmdpbi1yaWdodDoxMHB4O2ZvbnQtc2l6ZTouNzJyZW07Y29sb3I6IzY0NzQ4Yjtmb250LXdlaWdodDo4MDA7Ij4nCiAgICAgICAgICAgICAgICAgICAgKyAnPHNwYW4gc3R5bGU9IndpZHRoOjEwcHg7aGVpZ2h0OjEwcHg7Ym9yZGVyLXJhZGl1czo5OTlweDtiYWNrZ3JvdW5kOicrY2Fsc1trXSsnO2Rpc3BsYXk6aW5saW5lLWJsb2NrOyI+PC9zcGFuPicKICAgICAgICAgICAgICAgICAgICArIGVzY0h0bWwoaykgKyAnPC9zcGFuPic7CiAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0YXJ0SXNvID0gX3VjYWxJc28oc3RhcnQpOwogICAgICAgIHZhciBlbmRJc28gPSBfdWNhbElzbyhlbmQpOwoKICAgICAgICB2YXIgYWxsID0gX3VjYWxDb2xsZWN0QWxsRXZlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKGV2KXsKICAgICAgICAgICAgcmV0dXJuIGV2LmRhdGUgPj0gc3RhcnRJc28gJiYgZXYuZGF0ZSA8IGVuZElzbzsKICAgICAgICB9KTsKCiAgICAgICAgLy8gR3JvdXAgYnkgY2FsZW5kYXIgbmFtZSAoYW5kIGNvbG9yKQogICAgICAgIHZhciBncm91cHMgPSB7fTsKICAgICAgICBhbGwuZm9yRWFjaChmdW5jdGlvbihldil7CiAgICAgICAgICAgIHZhciBrZXkgPSAoZXYuY2FsTmFtZXx8J0FnZW5kYScpICsgJ3x8JyArIChldi5jb2xvcnx8JyM5OTknKTsKICAgICAgICAgICAgaWYoIWdyb3Vwc1trZXldKSBncm91cHNba2V5XSA9IHtuYW1lOiBldi5jYWxOYW1lfHwnQWdlbmRhJywgY29sb3I6IGV2LmNvbG9yfHwnIzk5OScsIGV2ZW50czpbXX07CiAgICAgICAgICAgIGdyb3Vwc1trZXldLmV2ZW50cy5wdXNoKGV2KTsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGdyb3VwTGlzdCA9IE9iamVjdC52YWx1ZXMoZ3JvdXBzKTsKICAgICAgICAvLyBTb3J0IGdyb3VwcyBieSBuYW1lCiAgICAgICAgZ3JvdXBMaXN0LnNvcnQoZnVuY3Rpb24oYSxiKXsgcmV0dXJuIChhLm5hbWV8fCcnKS5sb2NhbGVDb21wYXJlKGIubmFtZXx8JycpOyB9KTsKICAgICAgICAvLyBTb3J0IGV2ZW50cyBpbiBlYWNoIGdyb3VwCiAgICAgICAgZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24oZyl7CiAgICAgICAgICAgIGcuZXZlbnRzLnNvcnQoZnVuY3Rpb24oYSxiKXsKICAgICAgICAgICAgICAgIHZhciBrYSA9IGEuZGF0ZSArICcgJyArIChhLnRpbWV8fCcwMDowMCcpOwogICAgICAgICAgICAgICAgdmFyIGtiID0gYi5kYXRlICsgJyAnICsgKGIudGltZXx8JzAwOjAwJyk7CiAgICAgICAgICAgICAgICByZXR1cm4ga2EubG9jYWxlQ29tcGFyZShrYik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoIWdyb3VwTGlzdC5sZW5ndGgpIHsKICAgICAgICAgICAgYm9keS5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0iYmFja2dyb3VuZDojZmZmO2JvcmRlcjoxcHggZGFzaGVkIHJnYmEoMCwwLDAsLjE1KTtib3JkZXItcmFkaXVzOjE0cHg7cGFkZGluZzoxNnB4O2NvbG9yOiM2NDc0OGI7Zm9udC13ZWlnaHQ6ODAwOyI+QXVjdW4gw6l2w6luZW1lbnQgc3VyIGNldHRlIHDDqXJpb2RlLiA8c3BhbiBzdHlsZT0iZm9udC13ZWlnaHQ6NzAwO2NvbG9yOiM5NGEzYjgiPlBlbnNleiDDoCBzeW5jaHJvbmlzZXIgKGJvdXRvbiDin7MpLjwvc3Bhbj48L2Rpdj4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWNhbGdyaWQiPic7CiAgICAgICAgZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24oZyl7CiAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9InVjYWwtY2FsYmxvY2siPic7CiAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9InVjYWwtY2FsaGVhZCI+JzsKICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC1jYWxuYW1lIj48c3BhbiBjbGFzcz0idWNhbC1kb3QiIHN0eWxlPSJiYWNrZ3JvdW5kOicrZy5jb2xvcisnIj48L3NwYW4+JyArIGVzY0h0bWwoZy5uYW1lKSArICc8L2Rpdj4nOwogICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWNhbGxpbWl0Ij4nICsgZy5ldmVudHMubGVuZ3RoICsgJyDDqXYuPC9kaXY+JzsKICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+JzsKICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC1zZXAiPjwvZGl2Pic7CiAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9InVjYWwtY2FsbGlzdCI+JzsKICAgICAgICAgICAgZy5ldmVudHMuZm9yRWFjaChmdW5jdGlvbihldil7CiAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKGV2LmRhdGUgKyAnVDAwOjAwOjAwJyk7CiAgICAgICAgICAgICAgICB2YXIgZGF5ID0gZC50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7d2Vla2RheTonc2hvcnQnfSkucmVwbGFjZSgnLicsJycpOwogICAgICAgICAgICAgICAgdmFyIHdoZW4gPSBkYXkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrZGF5LnNsaWNlKDEpICsgJyAnICsgX3VjYWxGbXRGUihkKTsKICAgICAgICAgICAgICAgIHZhciB0aW1lID0gJyc7CiAgICAgICAgICAgICAgICBpZiAoZXYudGltZSkgdGltZSA9IGV2LnRpbWUgKyAoZXYuZW5kVGltZSA/ICfigJMnK2V2LmVuZFRpbWUgOiAnJyk7CiAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPSJ1Y2FsLWV2ZW50cm93Ij4nOwogICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC13aGVuIj48ZGl2IGNsYXNzPSJ1Y2FsLWRhdGUiPicrZXNjSHRtbCh3aGVuKSsnPC9kaXY+PGRpdiBjbGFzcz0idWNhbC10aW1lIj4nKyh0aW1lP2VzY0h0bWwodGltZSk6JycpKyc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBzdHlsZT0iZmxleDoxO21pbi13aWR0aDowIj4nOwogICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC10aXRsZTIiPicrZXNjSHRtbChldi50aXRsZXx8JyhzYW5zIHRpdHJlKScpKyc8L2Rpdj4nOwogICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz0idWNhbC1tdXRlZCI+Jytlc2NIdG1sKGcubmFtZSkrJzwvZGl2Pic7CiAgICAgICAgICAgICAgICBodG1sICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICB9KTsKICAgICAgICBodG1sICs9ICc8L2Rpdj4nOwogICAgICAgIGJvZHkuaW5uZXJIVE1MID0gaHRtbDsKICAgIH0KCgogICAgZnVuY3Rpb24gcmVuZGVyVWNhbExlZ2VuZChzcmNTZXQpIHsKICAgICAgICB2YXIgbGVnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtbGVnZW5kJyk7CiAgICAgICAgaWYgKCFsZWcpIHJldHVybjsKICAgICAgICB2YXIgaXRlbXMgPSBbCiAgICAgICAgICAgIHtsYWJlbDonTG9jYWwnLCBjb2xvcjpVQ0FMX0NPTE9SUy5sb2NhbCwga2V5Oidsb2NhbCd9LAogICAgICAgICAgICB7bGFiZWw6J0bDqXJpw6lzJywgY29sb3I6VUNBTF9DT0xPUlMuZmVyaWUsIGtleTonZmVyaWUnfSwKICAgICAgICAgICAge2xhYmVsOidWYWNhbmNlcycsIGNvbG9yOlVDQUxfQ09MT1JTLnZhYywga2V5Oid2YWMnfSwKICAgICAgICAgICAge2xhYmVsOidPdXRsb29rJywgY29sb3I6JyMwMDc4ZDQnLCBrZXk6J291dGxvb2snfQogICAgICAgIF07CiAgICAgICAgLy8gQWRkIGdjYWwgY2FsZW5kYXJzCiAgICAgICAgKF9nY2FsRXZlbnRzIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgaWYgKGUuY2FsTmFtZSAmJiAhaXRlbXMuc29tZShmdW5jdGlvbihpKXtyZXR1cm4gaS5sYWJlbD09PWUuY2FsTmFtZTt9KSkgewogICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7bGFiZWw6ZS5jYWxOYW1lLCBjb2xvcjplLmNvbG9yfHxVQ0FMX0NPTE9SUy5nY2FsRGVmYXVsdCwga2V5OmUuY2FsTmFtZX0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgbGVnLmlubmVySFRNTCA9IGl0ZW1zLm1hcChmdW5jdGlvbihpKXsKICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj48c3BhbiBjbGFzcz0idWNhbC1sZWdlbmQtZG90IiBzdHlsZT0iYmFja2dyb3VuZDonK2kuY29sb3IrJyI+PC9zcGFuPicraS5sYWJlbCsnPC9zcGFuPic7CiAgICAgICAgfSkuam9pbignJyk7CiAgICB9CgogICAgLy8g4pSA4pSAIENSVUQg4pSA4pSACiAgICBmdW5jdGlvbiBvcGVuVWNhbEFkZE1vZGFsKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWVpZCcpLnZhbHVlID0gJyc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtZXNyYycpLnZhbHVlID0gJ2xvY2FsJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1lY2FsaWQnKS52YWx1ZSA9ICcnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWRhdGUnKS52YWx1ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLXRpbWUnKS52YWx1ZSA9ICcnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWVuZHRpbWUnKS52YWx1ZSA9ICcnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLXRhc2snKS52YWx1ZSA9ICcnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLW1vZGFsLXRpdGxlJykudGV4dENvbnRlbnQgPSAnTm91dmVsIMOpdsOpbmVtZW50JzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1kZXN0LXdyYXAnKS5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgc2V0VWNhbERlc3QoJ2xvY2FsJyk7CiAgICAgICAgdXBkYXRlR2NhbFRhcmdldExpc3QoKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbE1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZVVjYWxNb2RhbCgpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWxNb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0KCiAgICBmdW5jdGlvbiBzZXRVY2FsRGVzdChkZXN0KSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnVjYWwtZGVzdC1vcHQnKS5mb3JFYWNoKGZ1bmN0aW9uKGVsKXsKICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgZWwuZGF0YXNldC5kZXN0ID09PSBkZXN0KTsKICAgICAgICAgICAgZWwucXVlcnlTZWxlY3RvcignaW5wdXQnKS5jaGVja2VkID0gZWwuZGF0YXNldC5kZXN0ID09PSBkZXN0OwogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWdjYWwtdGFyZ2V0Jykuc3R5bGUuZGlzcGxheSA9IChkZXN0ID09PSAnZ2NhbCcgfHwgZGVzdCA9PT0gJ291dGxvb2snKSA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgICAgaWYgKGRlc3QgPT09ICdvdXRsb29rJykgdXBkYXRlT3V0bG9va1RhcmdldExpc3QoKTsKICAgICAgICBlbHNlIGlmIChkZXN0ID09PSAnZ2NhbCcpIHVwZGF0ZUdjYWxUYXJnZXRMaXN0KCk7CiAgICB9CgogICAgLy8gV2lyZSB1cCBkZXN0IGJ1dHRvbnMKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBvcHQgPSBlLnRhcmdldC5jbG9zZXN0KCcudWNhbC1kZXN0LW9wdCcpOwogICAgICAgIGlmIChvcHQpIHNldFVjYWxEZXN0KG9wdC5kYXRhc2V0LmRlc3QpOwogICAgfSk7CgogICAgZnVuY3Rpb24gdXBkYXRlT3V0bG9va1RhcmdldExpc3QoKSB7CiAgICAgICAgdmFyIHNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWdjYWwtdGFyZ2V0Jyk7CiAgICAgICAgc2VsLmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPuKAlCBDaG9pc2lyIHVuIGFnZW5kYSDigJQ8L29wdGlvbj4nOwogICAgICAgIChfb3V0bG9va0NhbGVuZGFycyB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbihjKSB7CiAgICAgICAgICAgIHNlbC5pbm5lckhUTUwgKz0gJzxvcHRpb24gdmFsdWU9IicrZXNjSHRtbChjLmlkKSsnIj4nK2VzY0h0bWwoYy5uYW1lKSsnPC9vcHRpb24+JzsKICAgICAgICB9KTsKICAgICAgICB2YXIgb3V0bG9va09wdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy51Y2FsLWRlc3Qtb3B0W2RhdGEtZGVzdD0ib3V0bG9vayJdJyk7CiAgICAgICAgaWYgKG91dGxvb2tPcHQpIG91dGxvb2tPcHQuc3R5bGUuZGlzcGxheSA9IChfb3V0bG9va0NhbGVuZGFycyAmJiBfb3V0bG9va0NhbGVuZGFycy5sZW5ndGgpID8gJycgOiAnbm9uZSc7CiAgICB9CiAgICBmdW5jdGlvbiB1cGRhdGVHY2FsVGFyZ2V0TGlzdCgpIHsKICAgICAgICB2YXIgc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtZ2NhbC10YXJnZXQnKTsKICAgICAgICBzZWwuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+4oCUIENob2lzaXIgdW4gYWdlbmRhIOKAlDwvb3B0aW9uPic7CiAgICAgICAgLy8gT25seSBzaG93IGNhbGVuZGFycyBzZWxlY3RlZCBpbiBtYXN0ZXIgc2V0dGluZ3MgKGdjYWxTZWwpCiAgICAgICAgdmFyIHNlbGVjdGVkSWRzID0gX2djYWxTZWxlY3RlZElkcyB8fCBbXTsKICAgICAgICAoX2djYWxDYWxlbmRhcnMgfHwgW10pLmZvckVhY2goZnVuY3Rpb24oYykgewogICAgICAgICAgICBpZiAoc2VsZWN0ZWRJZHMubGVuZ3RoID09PSAwIHx8IHNlbGVjdGVkSWRzLmluZGV4T2YoYy5pZCkgPj0gMCkgewogICAgICAgICAgICAgICAgc2VsLmlubmVySFRNTCArPSAnPG9wdGlvbiB2YWx1ZT0iJytlc2NIdG1sKGMuaWQpKyciPicrZXNjSHRtbChjLm5hbWUpKyc8L29wdGlvbj4nOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgLy8gSWYgbm8gR29vZ2xlIGNhbGVuZGFycyBhdmFpbGFibGUsIGhpZGUgR29vZ2xlIG9wdGlvbgogICAgICAgIHZhciBnY2FsT3B0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnVjYWwtZGVzdC1vcHRbZGF0YS1kZXN0PSJnY2FsIl0nKTsKICAgICAgICB2YXIgb3V0bG9va09wdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy51Y2FsLWRlc3Qtb3B0W2RhdGEtZGVzdD0ib3V0bG9vayJdJyk7CiAgICAgICAgaWYgKGdjYWxPcHQpIGdjYWxPcHQuc3R5bGUuZGlzcGxheSA9IChfZ2NhbENhbGVuZGFycyAmJiBfZ2NhbENhbGVuZGFycy5sZW5ndGgpID8gJycgOiAnbm9uZSc7CiAgICB9CgogICAgZnVuY3Rpb24gZWRpdFVjYWxFdmVudChpZCwgc3JjLCBjYWxJZCkgewogICAgICAgIGlmIChzcmMgPT09ICdsb2NhbCcpIHsKICAgICAgICAgICAgdmFyIGl0ZW0gPSAoYXBwRGF0YS5jYWxlbmRhcnx8W10pLmZpbmQoZnVuY3Rpb24oYyl7IHJldHVybiBjLmlkLnRvU3RyaW5nKCk9PT1pZC50b1N0cmluZygpOyB9KTsKICAgICAgICAgICAgaWYgKCFpdGVtKSByZXR1cm47CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWVpZCcpLnZhbHVlID0gaWQ7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWVzcmMnKS52YWx1ZSA9ICdsb2NhbCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWVjYWxpZCcpLnZhbHVlID0gJyc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWRhdGUnKS52YWx1ZSA9IGl0ZW0uZGF0ZSB8fCAnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtdGltZScpLnZhbHVlID0gaXRlbS50aW1lIHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1lbmR0aW1lJykudmFsdWUgPSBpdGVtLmVuZFRpbWUgfHwgJyc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLXRhc2snKS52YWx1ZSA9IGl0ZW0udGFzayB8fCAnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtbW9kYWwtdGl0bGUnKS50ZXh0Q29udGVudCA9ICdNb2RpZmllciBsXCfDqXbDqW5lbWVudCc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWRlc3Qtd3JhcCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsTW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgIH0gZWxzZSBpZiAoc3JjID09PSAnZ2NhbCcpIHsKICAgICAgICAgICAgdmFyIGV2ID0gKF9nY2FsRXZlbnRzfHxbXSkuZmluZChmdW5jdGlvbihlKXsgcmV0dXJuIGUuaWQ9PT1pZDsgfSk7CiAgICAgICAgICAgIGlmICghZXYpIHJldHVybjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtZWlkJykudmFsdWUgPSBpZDsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtZXNyYycpLnZhbHVlID0gJ2djYWwnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1lY2FsaWQnKS52YWx1ZSA9IGNhbElkIHx8IGV2LmNhbElkIHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1kYXRlJykudmFsdWUgPSBldi5kYXRlIHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC10aW1lJykudmFsdWUgPSBldi50aW1lIHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1lbmR0aW1lJykudmFsdWUgPSBldi5lbmRUaW1lIHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC10YXNrJykudmFsdWUgPSBldi50aXRsZSB8fCAnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtbW9kYWwtdGl0bGUnKS50ZXh0Q29udGVudCA9ICdNb2RpZmllciAoR29vZ2xlIEFnZW5kYSknOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1kZXN0LXdyYXAnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbE1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2F2ZVVjYWxFdmVudCgpIHsKICAgICAgICB2YXIgaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1laWQnKS52YWx1ZTsKICAgICAgICB2YXIgc3JjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtZXNyYycpLnZhbHVlOwogICAgICAgIHZhciBjYWxJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1Y2FsLWVjYWxpZCcpLnZhbHVlOwogICAgICAgIHZhciBkYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtZGF0ZScpLnZhbHVlOwogICAgICAgIHZhciB0aW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtdGltZScpLnZhbHVlOwogICAgICAgIHZhciBlbmRUaW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtZW5kdGltZScpLnZhbHVlOwogICAgICAgIHZhciB0YXNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VjYWwtdGFzaycpLnZhbHVlLnRyaW0oKTsKICAgICAgICBpZiAoIWRhdGUgfHwgIXRhc2spIHJldHVybiBhbGVydCgnRGF0ZSBldCBpbnRpdHVsw6kgcmVxdWlzJyk7CgogICAgICAgIGlmIChpZCAmJiBzcmMgPT09ICdsb2NhbCcpIHsKICAgICAgICAgICAgLy8gVXBkYXRlIGxvY2FsCiAgICAgICAgICAgIHZhciBpdGVtID0gKGFwcERhdGEuY2FsZW5kYXJ8fFtdKS5maW5kKGZ1bmN0aW9uKGMpeyByZXR1cm4gYy5pZC50b1N0cmluZygpPT09aWQudG9TdHJpbmcoKTsgfSk7CiAgICAgICAgICAgIGlmIChpdGVtKSB7IGl0ZW0uZGF0ZSA9IGRhdGU7IGl0ZW0udGFzayA9IHRhc2s7IGl0ZW0udGltZSA9IHRpbWU7IGl0ZW0uZW5kVGltZSA9IGVuZFRpbWU7IH0KICAgICAgICAgICAgc2F2ZURhdGEoKTsKICAgICAgICB9IGVsc2UgaWYgKGlkICYmIHNyYyA9PT0gJ2djYWwnKSB7CiAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2Uoe3R5cGU6J3BpbG90ZS1nY2FsLXVwZGF0ZScsIGV2ZW50SWQ6aWQsIGNhbElkOmNhbElkLCB0aXRsZTp0YXNrLCBkYXRlOmRhdGUsIHRpbWU6dGltZSwgZW5kVGltZTplbmRUaW1lfSwgJyonKTsKICAgICAgICB9IGVsc2UgaWYgKGlkICYmIHNyYyA9PT0gJ291dGxvb2snKSB7CiAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2Uoe3R5cGU6J3BpbG90ZS1vdXRsb29rLXVwZGF0ZScsIGV2ZW50SWQ6aWQsIGNhbElkOmNhbElkLCB0aXRsZTp0YXNrLCBkYXRlOmRhdGUsIHRpbWU6dGltZSwgZW5kVGltZTplbmRUaW1lfSwgJyonKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBOZXcgZXZlbnQKICAgICAgICAgICAgdmFyIGRlc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ1Y2FsLWRlc3QiXTpjaGVja2VkJyk7CiAgICAgICAgICAgIHZhciBkZXN0VmFsID0gZGVzdCA/IGRlc3QudmFsdWUgOiAnbG9jYWwnOwogICAgICAgICAgICBpZiAoZGVzdFZhbCA9PT0gJ2xvY2FsJykgewogICAgICAgICAgICAgICAgYXBwRGF0YS5jYWxlbmRhci5wdXNoKHtpZDpEYXRlLm5vdygpLnRvU3RyaW5nKCksIGRhdGU6ZGF0ZSwgdGFzazp0YXNrLCB0aW1lOnRpbWUsIGVuZFRpbWU6ZW5kVGltZX0pOwogICAgICAgICAgICAgICAgc2F2ZURhdGEoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB0YXJnZXRDYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndWNhbC1nY2FsLXRhcmdldCcpLnZhbHVlOwogICAgICAgICAgICAgICAgaWYgKCF0YXJnZXRDYWwpIHJldHVybiBhbGVydCgnU8OpbGVjdGlvbm5leiB1biBhZ2VuZGEgR29vZ2xlJyk7CiAgICAgICAgICAgICAgICB2YXIgZGVzdFZhbDIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ1Y2FsLWRlc3QiXTpjaGVja2VkJykudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoZGVzdFZhbDIgPT09ICdnY2FsJykgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2Uoe3R5cGU6J3BpbG90ZS1nY2FsLWFkZCcsIGNhbElkOnRhcmdldENhbCwgdGl0bGU6dGFzaywgZGF0ZTpkYXRlLCB0aW1lOnRpbWUsIGVuZFRpbWU6ZW5kVGltZX0sICcqJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlc3RWYWwyID09PSAnb3V0bG9vaycpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHt0eXBlOidwaWxvdGUtb3V0bG9vay1hZGQnLCBjYWxJZDp0YXJnZXRDYWwsIHRpdGxlOnRhc2ssIGRhdGU6ZGF0ZSwgdGltZTp0aW1lLCBlbmRUaW1lOmVuZFRpbWV9LCAnKicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsb3NlVWNhbE1vZGFsKCk7CiAgICAgICAgcmVuZGVyVW5pZmllZENhbCgpOwogICAgICAgIGlmKHR5cGVvZiBjaGVja0RhaWx5VGFza3MgPT09ICdmdW5jdGlvbicpIGNoZWNrRGFpbHlUYXNrcygpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbGV0ZVVjYWxFdmVudChpZCwgc3JjLCBjYWxJZCkgewogICAgICAgIGlmICghY29uZmlybSgnU3VwcHJpbWVyIGNldCDDqXbDqW5lbWVudCA/JykpIHJldHVybjsKICAgICAgICBpZiAoc3JjID09PSAnbG9jYWwnKSB7CiAgICAgICAgICAgIGFwcERhdGEuY2FsZW5kYXIgPSAoYXBwRGF0YS5jYWxlbmRhcnx8W10pLmZpbHRlcihmdW5jdGlvbihjKXsgcmV0dXJuIGMuaWQudG9TdHJpbmcoKSE9PWlkLnRvU3RyaW5nKCk7IH0pOwogICAgICAgICAgICBzYXZlRGF0YSgpOwogICAgICAgICAgICByZW5kZXJVbmlmaWVkQ2FsKCk7CiAgICAgICAgICAgIGlmKHR5cGVvZiBjaGVja0RhaWx5VGFza3MgPT09ICdmdW5jdGlvbicpIGNoZWNrRGFpbHlUYXNrcygpOwogICAgICAgIH0gZWxzZSBpZiAoc3JjID09PSAnZ2NhbCcpIHsKICAgICAgICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7dHlwZToncGlsb3RlLWdjYWwtZGVsZXRlJywgZXZlbnRJZDppZCwgY2FsSWQ6Y2FsSWR9LCAnKicpOwogICAgICAgICAgICBfZ2NhbEV2ZW50cyA9IF9nY2FsRXZlbnRzLmZpbHRlcihmdW5jdGlvbihlKXsgcmV0dXJuIGUuaWQgIT09IGlkOyB9KTsKICAgICAgICAgICAgcmVuZGVyVW5pZmllZENhbCgpOwogICAgICAgIH0gZWxzZSBpZiAoc3JjID09PSAnb3V0bG9vaycpIHsKICAgICAgICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7dHlwZToncGlsb3RlLW91dGxvb2stZGVsZXRlJywgZXZlbnRJZDppZCwgY2FsSWQ6Y2FsSWR9LCAnKicpOwogICAgICAgICAgICBfb3V0bG9va0V2ZW50cyA9IF9vdXRsb29rRXZlbnRzLmZpbHRlcihmdW5jdGlvbihlKXsgcmV0dXJuIGUuaWQgIT09IGlkOyB9KTsKICAgICAgICAgICAgcmVuZGVyVW5pZmllZENhbCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBPdmVycmlkZSBvbGQgcmVuZGVyQ2FsZW5kYXIgdG8gdXNlIHVuaWZpZWQKICAgIGZ1bmN0aW9uIHJlbmRlckNhbGVuZGFyKCkgeyByZW5kZXJVbmlmaWVkQ2FsKCk7IH0KCiAgICBmdW5jdGlvbiBtYWpWYWNhbmNlcygpIHsKICAgICAgICB2YXIgem9uZSA9IChhcHBEYXRhLnNldHRpbmdzICYmIGFwcERhdGEuc2V0dGluZ3Muem9uZSkgfHwgJ0InOwogICAgICAgIHZhciB6b25lTmFtZSA9ICdab25lICcgKyB6b25lOwoKICAgICAgICAvLyBEw6l0ZXJtaW5lciBsJ2FubsOpZSBzY29sYWlyZSBjb3VyYW50ZSAoc2VwdCDDoCBhb8O7dCkKICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgeWVhciA9IG5vdy5nZXRNb250aCgpID49IDggPyBub3cuZ2V0RnVsbFllYXIoKSA6IG5vdy5nZXRGdWxsWWVhcigpIC0gMTsKICAgICAgICB2YXIgYW5uZWVTY28gPSB5ZWFyICsgJy0nICsgKHllYXIgKyAxKTsKCiAgICAgICAgLy8gSm91cnMgZsOpcmnDqXMgZnJhbsOnYWlzIChjYWxjdWzDqXMgZHluYW1pcXVlbWVudCkKICAgICAgICBmdW5jdGlvbiBqb3Vyc0Zlcmllcyh5KSB7CiAgICAgICAgICAgIC8vIENhbGN1bCBkZSBQw6JxdWVzIChhbGdvcml0aG1lIGRlIE1lZXVzKQogICAgICAgICAgICB2YXIgYT15JTE5LCBiPU1hdGguZmxvb3IoeS8xMDApLCBjPXklMTAwLCBkPU1hdGguZmxvb3IoYi80KSwgZT1iJTQ7CiAgICAgICAgICAgIHZhciBmPU1hdGguZmxvb3IoKGIrOCkvMjUpLCBnPU1hdGguZmxvb3IoKGItZisxKS8zKSwgaD0oMTkqYStiLWQtZysxNSklMzA7CiAgICAgICAgICAgIHZhciBpPU1hdGguZmxvb3IoYy80KSwgaz1jJTQsIGw9KDMyKzIqZSsyKmktaC1rKSU3OwogICAgICAgICAgICB2YXIgbT1NYXRoLmZsb29yKChhKzExKmgrMjIqbCkvNDUxKSwgbW9udGg9TWF0aC5mbG9vcigoaCtsLTcqbSsxMTQpLzMxKS0xOwogICAgICAgICAgICB2YXIgZGF5PShoK2wtNyptKzExNCklMzErMTsKICAgICAgICAgICAgdmFyIHBhcXVlcyA9IG5ldyBEYXRlKHksIG1vbnRoLCBkYXkpOwogICAgICAgICAgICB2YXIgdG9JU08gPSBmdW5jdGlvbihkKXsgcmV0dXJuIGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOyB9OwogICAgICAgICAgICB2YXIgYWRkRGF5cyA9IGZ1bmN0aW9uKGQsbil7IHZhciByPW5ldyBEYXRlKGQpOyByLnNldERhdGUoci5nZXREYXRlKCkrbik7IHJldHVybiByOyB9OwogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAge25hbWU6J0pvdXIgZGUgbFwnQW4nLCBkYXRlOnRvSVNPKG5ldyBEYXRlKHksMCwxKSl9LAogICAgICAgICAgICAgICAge25hbWU6J0x1bmRpIGRlIFDDonF1ZXMnLCBkYXRlOnRvSVNPKGFkZERheXMocGFxdWVzLDEpKX0sCiAgICAgICAgICAgICAgICB7bmFtZTonRsOqdGUgZHUgVHJhdmFpbCcsIGRhdGU6dG9JU08obmV3IERhdGUoeSw0LDEpKX0sCiAgICAgICAgICAgICAgICB7bmFtZTonVmljdG9pcmUgMTk0NScsIGRhdGU6dG9JU08obmV3IERhdGUoeSw0LDgpKX0sCiAgICAgICAgICAgICAgICB7bmFtZTonQXNjZW5zaW9uJywgZGF0ZTp0b0lTTyhhZGREYXlzKHBhcXVlcywzOSkpfSwKICAgICAgICAgICAgICAgIHtuYW1lOidMdW5kaSBkZSBQZW50ZWPDtHRlJywgZGF0ZTp0b0lTTyhhZGREYXlzKHBhcXVlcyw1MCkpfSwKICAgICAgICAgICAgICAgIHtuYW1lOidGw6p0ZSBOYXRpb25hbGUnLCBkYXRlOnRvSVNPKG5ldyBEYXRlKHksNiwxNCkpfSwKICAgICAgICAgICAgICAgIHtuYW1lOidBc3NvbXB0aW9uJywgZGF0ZTp0b0lTTyhuZXcgRGF0ZSh5LDcsMTUpKX0sCiAgICAgICAgICAgICAgICB7bmFtZTonVG91c3NhaW50JywgZGF0ZTp0b0lTTyhuZXcgRGF0ZSh5LDEwLDEpKX0sCiAgICAgICAgICAgICAgICB7bmFtZTonQXJtaXN0aWNlJywgZGF0ZTp0b0lTTyhuZXcgRGF0ZSh5LDEwLDExKSl9LAogICAgICAgICAgICAgICAge25hbWU6J05vw6tsJywgZGF0ZTp0b0lTTyhuZXcgRGF0ZSh5LDExLDI1KSl9CiAgICAgICAgICAgIF07CiAgICAgICAgfQoKICAgICAgICAvLyBUZW50ZXIgbGUgZmV0Y2ggQVBJIG9mZmljaWVsbGUKICAgICAgICB2YXIgYXBpVXJsID0gJ2h0dHBzOi8vZGF0YS5lZHVjYXRpb24uZ291di5mci9hcGkvZXhwbG9yZS92Mi4xL2NhdGFsb2cvZGF0YXNldHMvZnItZW4tY2FsZW5kcmllci1zY29sYWlyZS9yZWNvcmRzP3doZXJlPWFubmVlX3Njb2xhaXJlJTNEJTIyJyArIGFubmVlU2NvICsgJyUyMiUyMEFORCUyMCh6b25lcyUzRCUyMicgKyB6b25lTmFtZSArICclMjIlMjBPUiUyMHpvbmVzJTNEJTIyRnJhbmNlJTIwZW50acOocmUlMjIpJmxpbWl0PTUwJm9yZGVyX2J5PXN0YXJ0X2RhdGUnOwoKICAgICAgICB2YXIgYnRuID0gZXZlbnQgJiYgZXZlbnQudGFyZ2V0ID8gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJ2J1dHRvbicpIDogbnVsbDsKICAgICAgICBpZiAoYnRuKSB7IGJ0bi5kaXNhYmxlZCA9IHRydWU7IGJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iPjwvaT4gQ2hhcmdlbWVudC4uLic7IH0KCiAgICAgICAgZmV0Y2goYXBpVXJsKS50aGVuKGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgaWYgKCFyLm9rKSB0aHJvdyBuZXcgRXJyb3IoJ0hUVFAgJyArIHIuc3RhdHVzKTsKICAgICAgICAgICAgcmV0dXJuIHIuanNvbigpOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICBpZiAoIWRhdGEucmVzdWx0cyB8fCAhZGF0YS5yZXN1bHRzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCdBdWN1bmUgZG9ubsOpZScpOwoKICAgICAgICAgICAgLy8gU3VwcHJpbWVyIGFuY2llbm5lcyBlbnRyw6llcwogICAgICAgICAgICBhcHBEYXRhLmNhbGVuZGFyID0gYXBwRGF0YS5jYWxlbmRhci5maWx0ZXIoZnVuY3Rpb24oYykgeyByZXR1cm4gIWMudmFjT2ZmaWNpZWw7IH0pOwogICAgICAgICAgICB2YXIgYWRkZWQgPSAwOwoKICAgICAgICAgICAgZGF0YS5yZXN1bHRzLmZvckVhY2goZnVuY3Rpb24ocmVjKSB7CiAgICAgICAgICAgICAgICB2YXIgZGVzYyA9IHJlYy5kZXNjcmlwdGlvbiB8fCAnJzsKICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IChyZWMuc3RhcnRfZGF0ZSB8fCAnJykuc3BsaXQoJ1QnKVswXTsKICAgICAgICAgICAgICAgIHZhciBlbmQgPSAocmVjLmVuZF9kYXRlIHx8ICcnKS5zcGxpdCgnVCcpWzBdOwogICAgICAgICAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSByZXR1cm47CgogICAgICAgICAgICAgICAgdmFyIGlkID0gJ3ZhY18nICsgZGVzYy5yZXBsYWNlKC9bXmEtekEtWjAtOV0vZywnXycpICsgJ18nICsgc3RhcnQ7CiAgICAgICAgICAgICAgICBpZiAoIWFwcERhdGEuY2FsZW5kYXIuc29tZShmdW5jdGlvbihjKXsgcmV0dXJuIGMuaWQgPT09IGlkOyB9KSkgewogICAgICAgICAgICAgICAgICAgIGFwcERhdGEuY2FsZW5kYXIucHVzaCh7aWQ6IGlkLCBkYXRlOiBzdGFydCwgdGFzazogJ1x1ezFGM0Q2fSBEw6lidXQgJyArIGRlc2MgKyAnICgnICsgem9uZU5hbWUgKyAnKScsIHZhY09mZmljaWVsOiB0cnVlfSk7CiAgICAgICAgICAgICAgICAgICAgYXBwRGF0YS5jYWxlbmRhci5wdXNoKHtpZDogaWQrJ19lbmQnLCBkYXRlOiBlbmQsIHRhc2s6ICdcdXsxRjREQX0gUmVwcmlzZSAnICsgZGVzYyArICcgKCcgKyB6b25lTmFtZSArICcpJywgdmFjT2ZmaWNpZWw6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICBhZGRlZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEFqb3V0ZXIgam91cnMgZsOpcmnDqXMgcG91ciBsZXMgMiBhbm7DqWVzIGNpdmlsZXMKICAgICAgICAgICAgW3llYXIsIHllYXIrMV0uZm9yRWFjaChmdW5jdGlvbih5KSB7CiAgICAgICAgICAgICAgICBqb3Vyc0Zlcmllcyh5KS5mb3JFYWNoKGZ1bmN0aW9uKGpmKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGpmLmRhdGUgPj0geWVhcisnLTA5LTAxJyAmJiBqZi5kYXRlIDw9ICh5ZWFyKzEpKyctMDgtMzEnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWQgPSAnZmVyaWVfJyArIGpmLmRhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYXBwRGF0YS5jYWxlbmRhci5zb21lKGZ1bmN0aW9uKGMpeyByZXR1cm4gYy5pZCA9PT0gZmlkOyB9KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwRGF0YS5jYWxlbmRhci5wdXNoKHtpZDogZmlkLCBkYXRlOiBqZi5kYXRlLCB0YXNrOiAnXHV7MUYxRUJ9XHV7MUYxRjd9ICcgKyBqZi5uYW1lLCB2YWNPZmZpY2llbDogdHJ1ZX0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIE1BSiBzZW1haW5lcyB2YWNhbmNlcyBwb3VyIEdhbnR0CiAgICAgICAgICAgIHVwZGF0ZVZhY1dlZWtzRnJvbUFQSShkYXRhLnJlc3VsdHMsIHpvbmUpOwoKICAgICAgICAgICAgc2F2ZURhdGEoKTsgcmVuZGVyQ2FsZW5kYXIoKTsKICAgICAgICAgICAgaWYodHlwZW9mIGNoZWNrRGFpbHlUYXNrcyA9PT0gJ2Z1bmN0aW9uJykgY2hlY2tEYWlseVRhc2tzKCk7CiAgICAgICAgICAgIGFsZXJ0KCdcdTI3MDUgQ2FsZW5kcmllciAnICsgYW5uZWVTY28gKyAnIG1pcyDDoCBqb3VyICFcblxuJyArIHpvbmVOYW1lICsgJyDigJQgJyArIGFkZGVkICsgJyBlbnRyw6llKHMpIGFqb3V0w6llKHMpXG5cblNvdXJjZSA6IGRhdGEuZWR1Y2F0aW9uLmdvdXYuZnIgKEFQSSBvZmZpY2llbGxlKScpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICBjb25zb2xlLndhcm4oJ0FQSSBpbmRpc3BvbmlibGUsIGZhbGxiYWNrIGRvbm7DqWVzIGxvY2FsZXM6JywgZXJyKTsKICAgICAgICAgICAgbWFqVmFjYW5jZXNGYWxsYmFjayh6b25lLCB6b25lTmFtZSk7CiAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKGJ0bikgeyBidG4uZGlzYWJsZWQgPSBmYWxzZTsgYnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXN5bmMiPjwvaT4gTUFKIFZhY2FuY2VzJzsgfQogICAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhY1dlZWtzRnJvbUFQSShyZXN1bHRzLCB6b25lKSB7CiAgICAgICAgdmFyIG5ld1ZBQyA9IHthbGw6W10sIEE6W10sIEI6W10sIEM6W119OwogICAgICAgIHJlc3VsdHMuZm9yRWFjaChmdW5jdGlvbihyZWMpIHsKICAgICAgICAgICAgdmFyIHN0YXJ0ID0gcmVjLnN0YXJ0X2RhdGUgPyBuZXcgRGF0ZShyZWMuc3RhcnRfZGF0ZSkgOiBudWxsOwogICAgICAgICAgICB2YXIgZW5kID0gcmVjLmVuZF9kYXRlID8gbmV3IERhdGUocmVjLmVuZF9kYXRlKSA6IG51bGw7CiAgICAgICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkgcmV0dXJuOwogICAgICAgICAgICB2YXIgem9uZXMgPSByZWMuem9uZXMgfHwgJyc7CiAgICAgICAgICAgIGZvciAodmFyIGQgPSBuZXcgRGF0ZShzdGFydCk7IGQgPCBlbmQ7IGQuc2V0RGF0ZShkLmdldERhdGUoKSs3KSkgewogICAgICAgICAgICAgICAgdmFyIHcgPSBnZXRJU09XZWVrKGQpOwogICAgICAgICAgICAgICAgaWYgKHpvbmVzLmluZGV4T2YoJ0ZyYW5jZScpID49IDApIHsgaWYgKG5ld1ZBQy5hbGwuaW5kZXhPZih3KTwwKSBuZXdWQUMuYWxsLnB1c2godyk7IH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHpvbmVzLmluZGV4T2YoJ0EnKSA+PSAwKSB7IGlmIChuZXdWQUMuQS5pbmRleE9mKHcpPDApIG5ld1ZBQy5BLnB1c2godyk7IH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHpvbmVzLmluZGV4T2YoJ0InKSA+PSAwKSB7IGlmIChuZXdWQUMuQi5pbmRleE9mKHcpPDApIG5ld1ZBQy5CLnB1c2godyk7IH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHpvbmVzLmluZGV4T2YoJ0MnKSA+PSAwKSB7IGlmIChuZXdWQUMuQy5pbmRleE9mKHcpPDApIG5ld1ZBQy5DLnB1c2godyk7IH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChuZXdWQUMuYWxsLmxlbmd0aCkgVkFDID0gbmV3VkFDOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldElTT1dlZWsoZCkgewogICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoZC5nZXRUaW1lKCkpOwogICAgICAgIGRhdGUuc2V0SG91cnMoMCwwLDAsMCk7CiAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpKzMtKGRhdGUuZ2V0RGF5KCkrNiklNyk7CiAgICAgICAgdmFyIHdlZWsxID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLDAsNCk7CiAgICAgICAgcmV0dXJuIDErTWF0aC5yb3VuZCgoKGRhdGUuZ2V0VGltZSgpLXdlZWsxLmdldFRpbWUoKSkvODY0MDAwMDAtMysod2VlazEuZ2V0RGF5KCkrNiklNykvNyk7CiAgICB9CgogICAgZnVuY3Rpb24gbWFqVmFjYW5jZXNGYWxsYmFjayh6b25lLCB6b25lTmFtZSkgewogICAgICAgIHZhciBWQUNBTkNFUyA9IHsKICAgICAgICAgICAgYWxsOlt7bmFtZTonVG91c3NhaW50JyxzdGFydDonMjAyNS0xMC0xOCcsZW5kOicyMDI1LTExLTAzJ30se25hbWU6J05vw6tsJyxzdGFydDonMjAyNS0xMi0yMCcsZW5kOicyMDI2LTAxLTA1J30se25hbWU6J0FzY2Vuc2lvbicsc3RhcnQ6JzIwMjYtMDUtMTMnLGVuZDonMjAyNi0wNS0xOCd9LHtuYW1lOifDiXTDqScsc3RhcnQ6JzIwMjYtMDctMDQnLGVuZDonMjAyNi0wOS0wMSd9XSwKICAgICAgICAgICAgQTpbe25hbWU6J0hpdmVyJyxzdGFydDonMjAyNi0wMi0wNycsZW5kOicyMDI2LTAyLTIzJ30se25hbWU6J1ByaW50ZW1wcycsc3RhcnQ6JzIwMjYtMDQtMDQnLGVuZDonMjAyNi0wNC0yMCd9XSwKICAgICAgICAgICAgQjpbe25hbWU6J0hpdmVyJyxzdGFydDonMjAyNi0wMi0xNCcsZW5kOicyMDI2LTAzLTAyJ30se25hbWU6J1ByaW50ZW1wcycsc3RhcnQ6JzIwMjYtMDQtMTEnLGVuZDonMjAyNi0wNC0yNyd9XSwKICAgICAgICAgICAgQzpbe25hbWU6J0hpdmVyJyxzdGFydDonMjAyNi0wMi0yMScsZW5kOicyMDI2LTAzLTA5J30se25hbWU6J1ByaW50ZW1wcycsc3RhcnQ6JzIwMjYtMDQtMTgnLGVuZDonMjAyNi0wNS0wNCd9XQogICAgICAgIH07CiAgICAgICAgYXBwRGF0YS5jYWxlbmRhciA9IGFwcERhdGEuY2FsZW5kYXIuZmlsdGVyKGZ1bmN0aW9uKGMpeyByZXR1cm4gIWMudmFjT2ZmaWNpZWw7IH0pOwogICAgICAgIHZhciBwZXJpb2RzID0gVkFDQU5DRVMuYWxsLmNvbmNhdChWQUNBTkNFU1t6b25lXXx8W10pOwogICAgICAgIHZhciBhZGRlZCA9IDA7CiAgICAgICAgcGVyaW9kcy5mb3JFYWNoKGZ1bmN0aW9uKHYpIHsKICAgICAgICAgICAgdmFyIGlkID0gJ3ZhY18nK3YubmFtZS5yZXBsYWNlKC9ccy9nLCdfJykrJ18nK3Yuc3RhcnQ7CiAgICAgICAgICAgIGFwcERhdGEuY2FsZW5kYXIucHVzaCh7aWQ6aWQsZGF0ZTp2LnN0YXJ0LHRhc2s6J1x1ezFGM0Q2fSBEw6lidXQgVmFjLiAnK3YubmFtZSsnICgnK3pvbmVOYW1lKycpJyx2YWNPZmZpY2llbDp0cnVlfSk7CiAgICAgICAgICAgIGFwcERhdGEuY2FsZW5kYXIucHVzaCh7aWQ6aWQrJ19lbmQnLGRhdGU6di5lbmQsdGFzazonXHV7MUY0REF9IFJlcHJpc2UgJyt2Lm5hbWUrJyAoJyt6b25lTmFtZSsnKScsdmFjT2ZmaWNpZWw6dHJ1ZX0pOwogICAgICAgICAgICBhZGRlZCsrOwogICAgICAgIH0pOwogICAgICAgIHZhciBuZXdWQUMgPSB7YWxsOls0Myw0NCw1MiwxXSxBOls3LDgsMTUsMTZdLEI6WzgsOSwxNiwxN10sQzpbOSwxMCwxNywxOF19OwogICAgICAgIFZBQyA9IG5ld1ZBQzsKICAgICAgICBzYXZlRGF0YSgpOyByZW5kZXJDYWxlbmRhcigpOwogICAgICAgIGlmKHR5cGVvZiBjaGVja0RhaWx5VGFza3MgPT09ICdmdW5jdGlvbicpIGNoZWNrRGFpbHlUYXNrcygpOwogICAgICAgIGFsZXJ0KCdcdTI3MDUgQ2FsZW5kcmllciBtaXMgw6Agam91ciAoZG9ubsOpZXMgaW50w6lncsOpZXMpXG5cbicgKyB6b25lTmFtZSArICcg4oCUICcgKyBhZGRlZCArICcgcMOpcmlvZGUocylcblxu4pqgIEFQSSBpbmRpc3BvbmlibGUsIGRvbm7DqWVzIDIwMjUtMjAyNiB1dGlsaXPDqWVzLicpOwogICAgfQoKCiAgICAKICAgIC8vIOKVkOKVkOKVkCBQUk9Dw4lEVVJFUyDilZDilZDilZAKICAgIHZhciBQUk9DX0NPTE9SUz17QTonIzNCODJGNicsQjonIzhCNUNGNicsQzonI0VDNDg5OScsRDonI0VGNDQ0NCcsRTonI0Y5NzMxNicsRjonIzZCNzI4MCcsRzonIzZCNzI4MCcsSDonIzZCNzI4MCcsSTonI0VBQjMwOCcsSjonIzZCNzI4MCcsSzonIzZCNzI4MCcsTDonIzZCNzI4MCcsTTonIzZCNzI4MCcsTjonIzIyQzU1RScsTzonIzEwQjk4MScsUDonIzYzNjZGMScsUTonIzZCNzI4MCcsUjonI0E4NTVGNycsUzonI0ZCNzE4NScsVDonIzZCNzI4MCcsVTonIzZCNzI4MCcsVjonIzZCNzI4MCcsVzonIzZCNzI4MCcsWDonIzZCNzI4MCcsWTonIzZCNzI4MCcsWjonIzZCNzI4MCd9OwogICAgZnVuY3Rpb24gZ2V0UHJvY0NvbG9yKGNvZGUpe2lmKCFjb2RlKXJldHVybicjODg4Jzt2YXIgYz1jb2RlLnRyaW0oKS50b1VwcGVyQ2FzZSgpO2lmKGMuaW5kZXhPZignUE8nKT09PTApcmV0dXJuJyMwNkI2RDQnO2lmKGMuaW5kZXhPZignUkgnKT09PTApcmV0dXJuJyNBODU1RjcnO3ZhciBsPWMuY2hhckF0KDApO3JldHVybiBQUk9DX0NPTE9SU1tsXXx8JyM4ODgnO30KICAgIHdpbmRvdy53aW5kb3cuX3Byb2NFZGl0SWQ9bnVsbDsKICAgIGZ1bmN0aW9uIG9wZW5Qcm9jTW9kYWwoaWQpewogICAgICAgIHdpbmRvdy5fcHJvY0VkaXRJZD1pZHx8bnVsbDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY01vZC10aXRsZScpLnRleHRDb250ZW50PWlkPydNb2RpZmllciBsYSBwcm9jw6lkdXJlJzonTm91dmVsbGUgcHJvY8OpZHVyZSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtZGVsLWJ0bicpLnN0eWxlLmRpc3BsYXk9aWQ/Jyc6J25vbmUnOwogICAgICAgIGlmKGlkKXsKICAgICAgICAgICAgdmFyIHA9KGFwcERhdGEucHJvY2VkdXJlc3x8W10pLmZpbmQoZnVuY3Rpb24oeCl7cmV0dXJuIHguaWQ9PT1pZDt9KTsKICAgICAgICAgICAgaWYocCl7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1jb2RlJykudmFsdWU9cC5jb2RlfHwnJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXRpdGxlJykudmFsdWU9cC50aXRsZXx8Jyc7CiAgICAgICAgICAgICAgICB2YXIgc2VsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLWNhdCcpOwogICAgICAgICAgICAgICAgdmFyIGZvdW5kPWZhbHNlOwogICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxzZWwub3B0aW9ucy5sZW5ndGg7aSsrKXtpZihzZWwub3B0aW9uc1tpXS52YWx1ZT09PXAuY2F0KXtmb3VuZD10cnVlO2JyZWFrO319CiAgICAgICAgICAgICAgICBpZighZm91bmQmJnAuY2F0KXt2YXIgb3B0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO29wdC52YWx1ZT1wLmNhdDtvcHQudGV4dD1wLmNhdDtzZWwuaW5zZXJ0QmVmb3JlKG9wdCxzZWwucXVlcnlTZWxlY3Rvcignb3B0aW9uW3ZhbHVlPSJfX25ld19fIl0nKSk7fTsKICAgICAgICAgICAgICAgIHNlbC52YWx1ZT1wLmNhdHx8Jyc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1hbm5lZScpLmNoZWNrZWQ9ISFwLmFubmVlOwogICAgICAgICAgICAgICAgaWYocC5hbm5lZSl7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd3MnKS52YWx1ZT0nJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLnZhbHVlPScnOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXdzJykuZGlzYWJsZWQ9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLmRpc2FibGVkPXRydWU7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd3MnKS5zdHlsZS5vcGFjaXR5PScuNCc7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd2UnKS5zdHlsZS5vcGFjaXR5PScuNCc7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13cycpLnZhbHVlPXAud3N0YXJ0fHwnJzsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLnZhbHVlPXAud2VuZHx8Jyc7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd3MnKS5kaXNhYmxlZD1mYWxzZTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLmRpc2FibGVkPWZhbHNlOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXdzJykuc3R5bGUub3BhY2l0eT0nMSc7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd2UnKS5zdHlsZS5vcGFjaXR5PScxJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXoyJykuaW5uZXJIVE1MPXAuem9uZTJ8fCcnOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtejMnKS5pbm5lckhUTUw9cC56b25lM3x8Jyc7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtY29kZScpLnZhbHVlPScnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy10aXRsZScpLnZhbHVlPScnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1jYXQnKS52YWx1ZT0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd3MnKS52YWx1ZT0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd2UnKS52YWx1ZT0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtYW5uZWUnKS5jaGVja2VkPWZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13cycpLmRpc2FibGVkPWZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLmRpc2FibGVkPWZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13cycpLnN0eWxlLm9wYWNpdHk9JzEnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLnN0eWxlLm9wYWNpdHk9JzEnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy16MicpLmlubmVySFRNTD0nJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtejMnKS5pbm5lckhUTUw9Jyc7CiAgICAgICAgfQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jTW9kJykuc3R5bGUuZGlzcGxheT0nZmxleCc7CiAgICB9CiAgICBmdW5jdGlvbiBjbG9zZVByb2NNb2RhbCgpe3ZhciBwbT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvY01vZCcpO3BtLnN0eWxlLmRpc3BsYXk9J25vbmUnO3BtLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTt3aW5kb3cuX3Byb2NFZGl0SWQ9bnVsbDt9CiAgICBmdW5jdGlvbiBwcm9jSW5zZXJ0SWNvbih0eXBlKXsKICAgICAgICB2YXIgaWNvbnM9e21haWw6JzxzcGFuIGNsYXNzPSJwcm9jLWljb24tbWFpbCI+PGkgY2xhc3M9ImZhcyBmYS1lbnZlbG9wZSI+PC9pPjwvc3Bhbj4nLGFsZXJ0Oic8c3BhbiBjbGFzcz0icHJvYy1pY29uLWFsZXJ0Ij48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uIj48L2k+PC9zcGFuPicsaWRlYTonPHNwYW4gY2xhc3M9InByb2MtaWNvbi1pZGVhIj48aSBjbGFzcz0iZmFzIGZhLWxpZ2h0YnVsYiI+PC9pPjwvc3Bhbj4nfTsKICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0SFRNTCcsZmFsc2UsaWNvbnNbdHlwZV0rJyZuYnNwOycpOwogICAgfQogICAgZnVuY3Rpb24gc2F2ZVByb2MoKXsKICAgICAgICB0cnl7CiAgICAgICAgdmFyIHJhd0NvZGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtY29kZScpLnZhbHVlLnRyaW0oKS50b1VwcGVyQ2FzZSgpOwogICAgICAgIHZhciBjb2RlPXJhd0NvZGUucmVwbGFjZSgvXihbQS1aXSspKFxkKS8sJyQxICQyJyk7CiAgICAgICAgdmFyIHRpdGxlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXRpdGxlJykudmFsdWUudHJpbSgpOwogICAgICAgIGlmKCFjb2RlfHwhdGl0bGUpe2FsZXJ0KCdDb2RlIGV0IHRpdHJlIHJlcXVpcy4nKTtyZXR1cm47fQogICAgICAgIGlmKCFhcHBEYXRhLnByb2NlZHVyZXMpYXBwRGF0YS5wcm9jZWR1cmVzPVtdOwogICAgICAgIHZhciBhbm5lZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1hbm5lZScpLmNoZWNrZWQ7CiAgICAgICAgdmFyIHdzPWFubmVlPzA6KHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXdzJykudmFsdWUpfHwwKTsKICAgICAgICB2YXIgd2U9YW5uZWU/MDoocGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd2UnKS52YWx1ZSl8fHdzKTsKICAgICAgICB2YXIgb2JqPXtpZDp3aW5kb3cuX3Byb2NFZGl0SWR8fERhdGUubm93KCkudG9TdHJpbmcoKSxjb2RlOmNvZGUsdGl0bGU6dGl0bGUsY2F0OmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLWNhdCcpLnZhbHVlLHdzdGFydDp3cyx3ZW5kOndlLGFubmVlOmFubmVlLHpvbmUyOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXoyJykuaW5uZXJIVE1MLHpvbmUzOmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXozJykuaW5uZXJIVE1MLHVwZGF0ZWQ6bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF19OwogICAgICAgIGlmKHdpbmRvdy5fcHJvY0VkaXRJZCl7dmFyIGlkeD1hcHBEYXRhLnByb2NlZHVyZXMuZmluZEluZGV4KGZ1bmN0aW9uKHgpe3JldHVybiB4LmlkPT09d2luZG93Ll9wcm9jRWRpdElkO30pO2lmKGlkeD49MClhcHBEYXRhLnByb2NlZHVyZXNbaWR4XT1vYmo7fQogICAgICAgIGVsc2V7YXBwRGF0YS5wcm9jZWR1cmVzLnB1c2gob2JqKTt9CiAgICAgICAgc2F2ZURhdGEoKTtjbG9zZVByb2NNb2RhbCgpO3JlbmRlclByb2NlZHVyZXMoKTsKICAgICAgICB9Y2F0Y2goZXJyKXthbGVydCgnRXJyZXVyIHNhdXZlZ2FyZGU6ICcrZXJyLm1lc3NhZ2UpO2NvbnNvbGUuZXJyb3IoZXJyKTt9CiAgICB9CiAgICBmdW5jdGlvbiBkZWxQcm9jKCl7CiAgICAgICAgaWYoIV9wcm9jRWRpdElkKXJldHVybjtpZighY29uZmlybSgnU3VwcHJpbWVyIGNldHRlIHByb2PDqWR1cmUgPycpKXJldHVybjsKICAgICAgICBhcHBEYXRhLnByb2NlZHVyZXM9KGFwcERhdGEucHJvY2VkdXJlc3x8W10pLmZpbHRlcihmdW5jdGlvbih4KXtyZXR1cm4geC5pZCE9PXdpbmRvdy5fcHJvY0VkaXRJZDt9KTsKICAgICAgICBzYXZlRGF0YSgpO2Nsb3NlUHJvY01vZGFsKCk7cmVuZGVyUHJvY2VkdXJlcygpOwogICAgfQogICAgd2luZG93Ll9wcm9jRmlsdGVyQ2F0PScnOwogICAgCiAgICBmdW5jdGlvbiBmb3JtYXREYXRlRlIoZCkgewogICAgICAgIGlmKCFkKSByZXR1cm4gJyc7CiAgICAgICAgdmFyIGR0ID0gKGQgaW5zdGFuY2VvZiBEYXRlKSA/IGQgOiBuZXcgRGF0ZShkKTsKICAgICAgICBpZihpc05hTihkdC5nZXRUaW1lKCkpKSByZXR1cm4gZDsKICAgICAgICByZXR1cm4gZHQudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonMi1kaWdpdCcsbW9udGg6J2xvbmcnLHllYXI6J251bWVyaWMnfSk7CiAgICB9CgogICAgCiAgICAvLyBBbm7DqWUgc2NvbGFpcmUgY291cmFudGUgKGV4OiAiMjAyNS0yMDI2IikKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRTY2hvb2xZZWFyKCl7CiAgICAgICAgdmFyIG5vdz1uZXcgRGF0ZSgpLG09bm93LmdldE1vbnRoKCkrMSx5PW5vdy5nZXRGdWxsWWVhcigpOwogICAgICAgIHJldHVybiBtPj04Pyh5KyctJysoeSsxKSk6KCh5LTEpKyctJyt5KTsKICAgIH0KICAgIC8vIEF1dG8tcmVzZXQ6IHLDqXRhYmxpdCBsZXMgcHJvY8OpZHVyZXMgdGVybWluw6llcyBkJ3VuZSBhbm7DqWUgcHLDqWPDqWRlbnRlCiAgICBmdW5jdGlvbiBhdXRvUmVzZXREb25lKCl7CiAgICAgICAgdmFyIHN5PWdldEN1cnJlbnRTY2hvb2xZZWFyKCk7dmFyIGNoYW5nZWQ9ZmFsc2U7CiAgICAgICAgKGFwcERhdGEucHJvY2VkdXJlc3x8W10pLmZvckVhY2goZnVuY3Rpb24ocCl7CiAgICAgICAgICAgIGlmKHAuZG9uZSYmcC5kb25lU1kmJnAuZG9uZVNZIT09c3kpe3AuZG9uZT1mYWxzZTtwLmRvbmVTWT0nJztjaGFuZ2VkPXRydWU7fQogICAgICAgIH0pOwogICAgICAgIChhcHBEYXRhLmdhbnR0fHxbXSkuZm9yRWFjaChmdW5jdGlvbihnKXsKICAgICAgICAgICAgaWYoZy5kb25lJiZnLmRvbmVTWSYmZy5kb25lU1khPT1zeSl7Zy5kb25lPWZhbHNlO2cuZG9uZVNZPScnO2NoYW5nZWQ9dHJ1ZTt9CiAgICAgICAgfSk7CiAgICAgICAgaWYoY2hhbmdlZClzYXZlRGF0YSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIG5hdENvZGVTb3J0KGEsYil7CiAgICAgICAgdmFyIGNhPShhLmNvZGV8fCcnKSxjYj0oYi5jb2RlfHwnJyk7CiAgICAgICAgdmFyIHBhPWNhLm1hdGNoKC9eKFtBLVphLXpdKylccyooXGQqKSQvKXx8WycnLCcnLDBdOwogICAgICAgIHZhciBwYj1jYi5tYXRjaCgvXihbQS1aYS16XSspXHMqKFxkKikkLyl8fFsnJywnJywwXTsKICAgICAgICB2YXIgbGE9cGFbMV0udG9VcHBlckNhc2UoKSxsYj1wYlsxXS50b1VwcGVyQ2FzZSgpOwogICAgICAgIGlmKGxhPGxiKXJldHVybiAtMTtpZihsYT5sYilyZXR1cm4gMTsKICAgICAgICByZXR1cm4ocGFyc2VJbnQocGFbMl0pfHwwKS0ocGFyc2VJbnQocGJbMl0pfHwwKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlbmRlclByb2NlZHVyZXMoKXsKICAgICAgICB2YXIgcHJvY3M9KGFwcERhdGEucHJvY2VkdXJlc3x8W10pLnNsaWNlKCkuc29ydChuYXRDb2RlU29ydCk7CiAgICAgICAgdmFyIGNhdHM9e307cHJvY3MuZm9yRWFjaChmdW5jdGlvbihwKXtpZihwLmNhdCljYXRzW3AuY2F0XT0oY2F0c1twLmNhdF18fDApKzE7fSk7CiAgICAgICAgdmFyIGZoPSc8YnV0dG9uIGNsYXNzPSInKyghX3Byb2NGaWx0ZXJDYXQ/J2FjdGl2ZSc6JycpKyciIG9uY2xpY2s9Il9wcm9jRmlsdGVyQ2F0PVwnXCc7cmVuZGVyUHJvY2VkdXJlcygpIj5Ub3VzICgnK3Byb2NzLmxlbmd0aCsnKTwvYnV0dG9uPic7CiAgICAgICAgT2JqZWN0LmtleXMoY2F0cykuc29ydCgpLmZvckVhY2goZnVuY3Rpb24oYyl7ZmgrPSc8YnV0dG9uIGNsYXNzPSInKyhfcHJvY0ZpbHRlckNhdD09PWM/J2FjdGl2ZSc6JycpKyciIG9uY2xpY2s9Il9wcm9jRmlsdGVyQ2F0PVwnJytjLnJlcGxhY2UoLycvZywiXFwnIikrJ1wnO3JlbmRlclByb2NlZHVyZXMoKSI+JytjKycgKCcrY2F0c1tjXSsnKTwvYnV0dG9uPic7fSk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtZmlsdGVycycpLmlubmVySFRNTD1maDsKICAgICAgICB2YXIgZmlsdGVyZWQ9X3Byb2NGaWx0ZXJDYXQ/cHJvY3MuZmlsdGVyKGZ1bmN0aW9uKHApe3JldHVybiBwLmNhdD09PV9wcm9jRmlsdGVyQ2F0O30pOnByb2NzOwogICAgICAgIHZhciBoPScnOwogICAgICAgIGlmKCFmaWx0ZXJlZC5sZW5ndGgpe2g9JzxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6NDBweDtjb2xvcjojOTk5Ij48aSBjbGFzcz0iZmFzIGZhLWJvb2siIHN0eWxlPSJmb250LXNpemU6MnJlbTttYXJnaW4tYm90dG9tOjEwcHg7ZGlzcGxheTpibG9jayI+PC9pPkF1Y3VuZSBwcm9jw6lkdXJlPC9kaXY+Jzt9CiAgICAgICAgZmlsdGVyZWQuZm9yRWFjaChmdW5jdGlvbihwKXsKICAgICAgICAgICAgdmFyIGNvbD1nZXRQcm9jQ29sb3IocC5jb2RlKTsKICAgICAgICAgICAgaCs9JzxkaXYgY2xhc3M9InByb2MtY2FyZCIgb25jbGljaz0idmlld1Byb2MoXCcnK3AuaWQrJ1wnKSIgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7cGFkZGluZzoxMHB4IDE0cHgiPic7CiAgICAgICAgICAgIGgrPSc8c3BhbiBjbGFzcz0icHJvYy1jb2RlIiBzdHlsZT0iYmFja2dyb3VuZDonK2NvbCsnO3BhZGRpbmc6NnB4IDEwcHg7Ym9yZGVyLXJhZGl1czo4cHg7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTouOHJlbTtjb2xvcjojZmZmO21pbi13aWR0aDo0MHB4O3RleHQtYWxpZ246Y2VudGVyIj4nKyhwLmNvZGV8fCc/JykrJzwvc3Bhbj4nOwogICAgICAgICAgICBoKz0nPHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OjYwMDtmb250LXNpemU6Ljg4cmVtO2NvbG9yOiMzMzM7ZmxleDoxO3doaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpcyI+JysocC50aXRsZXx8J1NhbnMgdGl0cmUnKSsnPC9zcGFuPic7CiAgICAgICAgICAgIGgrPSc8c3BhbiBzdHlsZT0iZm9udC1zaXplOi43MnJlbTtjb2xvcjojOTk5O3doaXRlLXNwYWNlOm5vd3JhcCI+Jytmb3JtYXREYXRlRlIocC51cGRhdGVkKSsnPC9zcGFuPic7CiAgICAgICAgICAgIGgrPShwLmNhdD8nPHNwYW4gY2xhc3M9InByb2MtY2FyZC1jYXQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTpub3dyYXAiPicrcC5jYXQrJzwvc3Bhbj4nOicnKTsKICAgICAgICAgICAgaCs9JzxkaXYgY2xhc3M9InByb2MtY2FyZC1hY3Rpb25zIiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo0cHg7bWFyZ2luLWxlZnQ6NHB4Ij48YnV0dG9uIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO29wZW5Qcm9jTW9kYWwoXCcnK3AuaWQrJ1wnKSIgdGl0bGU9Ik1vZGlmaWVyIj48aSBjbGFzcz0iZmFzIGZhLXBlbiI+PC9pPjwvYnV0dG9uPic7CiAgICAgICAgICAgIGgrPSc8YnV0dG9uIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO3ByaW50UHJvYyhcJycrcC5pZCsnXCcpIiB0aXRsZT0iSW1wcmltZXIiPjxpIGNsYXNzPSJmYXMgZmEtcHJpbnQiPjwvaT48L2J1dHRvbj48L2Rpdj48L2Rpdj4nOwogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLWxpc3QnKS5pbm5lckhUTUw9aDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy12aWV3LWFyZWEnKS5zdHlsZS5kaXNwbGF5PSdub25lJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1saXN0Jykuc3R5bGUuZGlzcGxheT0nJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1maWx0ZXJzJykuc3R5bGUuZGlzcGxheT0nJzsKICAgIH0KICAgIGZ1bmN0aW9uIHZpZXdQcm9jKGlkKXsKICAgICAgICB2YXIgcD0oYXBwRGF0YS5wcm9jZWR1cmVzfHxbXSkuZmluZChmdW5jdGlvbih4KXtyZXR1cm4geC5pZD09PWlkO30pO2lmKCFwKXJldHVybjsKICAgICAgICB2YXIgY29sPWdldFByb2NDb2xvcihwLmNvZGUpOwogICAgICAgIHZhciBoPSc8ZGl2IGNsYXNzPSJwcm9jLXZpZXciPjxkaXYgY2xhc3M9InByb2Mtdmlldy1oZWFkZXIiIHN0eWxlPSJiYWNrZ3JvdW5kOicrY29sKyciPjxoMj4nKyhwLnRpdGxlfHwnJykrJzwvaDI+PGRpdiBjbGFzcz0icHYtY29kZSI+JysocC5jb2RlfHwnJykrKHAuY2F0Pycg4oCUICcrcC5jYXQ6JycpKyc8L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJwcm9jLXZpZXctYm9keSI+JzsKICAgICAgICBoKz0nPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxNnB4O2Rpc3BsYXk6ZmxleDtnYXA6OHB4Ij48YnV0dG9uIGNsYXNzPSJtYiBtYi1vayIgb25jbGljaz0ib3BlblByb2NNb2RhbChcJycraWQrJ1wnKSI+PGkgY2xhc3M9ImZhcyBmYS1wZW4iPjwvaT4gTW9kaWZpZXI8L2J1dHRvbj48YnV0dG9uIGNsYXNzPSJtYiIgc3R5bGU9ImJhY2tncm91bmQ6IzU1NTtjb2xvcjojZmZmIiBvbmNsaWNrPSJwcmludFByb2MoXCcnK2lkKydcJykiPjxpIGNsYXNzPSJmYXMgZmEtcHJpbnQiPjwvaT4gSW1wcmltZXI8L2J1dHRvbj48YnV0dG9uIGNsYXNzPSJtYiBtYi1jIiBvbmNsaWNrPSJyZW5kZXJQcm9jZWR1cmVzKCkiPjxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctbGVmdCI+PC9pPiBSZXRvdXI8L2J1dHRvbj48L2Rpdj4nOwogICAgICAgIGlmKHAuem9uZTIpaCs9JzxkaXYgY2xhc3M9InByb2Mtem9uZSIgc3R5bGU9ImJvcmRlci1sZWZ0LWNvbG9yOicrY29sKyciPjxoND5BY3Rpb25zIC8gw4l0YXBlczwvaDQ+PGRpdiBjbGFzcz0icHJvYy16b25lLWNvbnRlbnQiPicrcC56b25lMisnPC9kaXY+PC9kaXY+JzsKICAgICAgICBpZihwLnpvbmUzKWgrPSc8ZGl2IGNsYXNzPSJwcm9jLXpvbmUiIHN0eWxlPSJib3JkZXItbGVmdC1jb2xvcjonK2NvbCsnIj48aDQ+Tm90ZXM8L2g0PjxkaXYgY2xhc3M9InByb2Mtem9uZS1jb250ZW50Ij4nK3Auem9uZTMrJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgaCs9JzwvZGl2PjwvZGl2Pic7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtdmlldy1hcmVhJykuaW5uZXJIVE1MPWg7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtdmlldy1hcmVhJykuc3R5bGUuZGlzcGxheT0nJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1saXN0Jykuc3R5bGUuZGlzcGxheT0nbm9uZSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2MtZmlsdGVycycpLnN0eWxlLmRpc3BsYXk9J25vbmUnOwogICAgfQogICAgZnVuY3Rpb24gcHJpbnRQcm9jKGlkKXsKICAgICAgICB2YXIgcD0oYXBwRGF0YS5wcm9jZWR1cmVzfHxbXSkuZmluZChmdW5jdGlvbih4KXtyZXR1cm4geC5pZD09PWlkO30pO2lmKCFwKXJldHVybjsKICAgICAgICB2YXIgY29sPWdldFByb2NDb2xvcihwLmNvZGUpOwogICAgICAgIC8vIExpZ2h0ZW4gY29sb3IgZm9yIHpvbmUgYmcKICAgICAgICBmdW5jdGlvbiBoZXhUb1JnYmEoaGV4LGEpewogICAgICAgICAgICB2YXIgcj1wYXJzZUludChoZXguc2xpY2UoMSwzKSwxNiksZz1wYXJzZUludChoZXguc2xpY2UoMyw1KSwxNiksYj1wYXJzZUludChoZXguc2xpY2UoNSw3KSwxNik7CiAgICAgICAgICAgIHJldHVybidyZ2JhKCcrcisnLCcrZysnLCcrYisnLCcrYSsnKSc7CiAgICAgICAgfQogICAgICAgIHZhciBsaWdodENvbD1oZXhUb1JnYmEoY29sLDAuMik7CiAgICAgICAgdmFyIGxvZ29TcmM9KGFwcERhdGEuc2V0dGluZ3MmJmFwcERhdGEuc2V0dGluZ3MubG9nbyl8fCcnOwogICAgICAgIHZhciB0b2RheT1uZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInLHtkYXk6JzItZGlnaXQnLG1vbnRoOidsb25nJyx5ZWFyOidudW1lcmljJ30pOwogICAgICAgIHZhciB1c2VyTmFtZT0oYXBwRGF0YS5zZXR0aW5ncyYmYXBwRGF0YS5zZXR0aW5ncy51c2VyKXx8Jyc7CiAgICAgICAgdmFyIGh0bWw9Jyc7CiAgICAgICAgaHRtbCs9JzxzdHlsZT5AcGFnZXtzaXplOkE0O21hcmdpbjo1bW0gNW1tIDI1bW0gNW1tfWJvZHl7bWFyZ2luOjA7cGFkZGluZzowfTwvc3R5bGU+JzsKICAgICAgICBodG1sKz0nPGRpdiBzdHlsZT0iZm9udC1mYW1pbHk6QXJpYWwsc2Fucy1zZXJpZjtwYWRkaW5nLWJvdHRvbToyNW1tIj4nOwogICAgICAgIGh0bWwrPSc8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOicrY29sKyc7Y29sb3I6I2ZmZjtwYWRkaW5nOjEwcHggMTRweDstd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDpleGFjdDtwcmludC1jb2xvci1hZGp1c3Q6ZXhhY3Q7dGV4dC1hbGlnbjpyaWdodCI+JzsKICAgICAgICBodG1sKz0nPGgxIHN0eWxlPSJtYXJnaW46MDtmb250LXNpemU6MS4zcmVtO2ZvbnQtd2VpZ2h0OjcwMCI+JytwLmNvZGUrJyAtICcrcC50aXRsZSsnPC9oMT4nOwogICAgICAgIGh0bWwrPSc8L2Rpdj4nOwogICAgICAgIGh0bWwrPSc8ZGl2IHN0eWxlPSJwYWRkaW5nOjhweCAxMHB4O2NvbG9yOiMzMzMiPic7CiAgICAgICAgaWYocC56b25lMil7CiAgICAgICAgaHRtbCs9JzxkaXYgc3R5bGU9Im1hcmdpbjo4cHggMDtwYWRkaW5nOjAiPic7CiAgICAgICAgaHRtbCs9JzxkaXYgc3R5bGU9ImJhY2tncm91bmQ6JytsaWdodENvbCsnO3BhZGRpbmc6OHB4IDE0cHg7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTouODVyZW07Y29sb3I6IzMzMzt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7bGV0dGVyLXNwYWNpbmc6LjVweDtib3JkZXItcmFkaXVzOjZweCA2cHggMCAwOy13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0O3ByaW50LWNvbG9yLWFkanVzdDpleGFjdCI+QWN0aW9ucyAvIMOJdGFwZXM8L2Rpdj4nOwogICAgICAgIGh0bWwrPSc8ZGl2IHN0eWxlPSJwYWRkaW5nOjhweCAxNHB4O2ZvbnQtc2l6ZTouOXJlbTtsaW5lLWhlaWdodDoxLjY1O2NvbG9yOiM0NDQ7Ym9yZGVyLWxlZnQ6NHB4IHNvbGlkICcrY29sKyciPicrcC56b25lMisnPC9kaXY+PC9kaXY+Jzt9CiAgICAgICAgaWYocC56b25lMyl7CiAgICAgICAgaHRtbCs9JzxkaXYgc3R5bGU9Im1hcmdpbjo4cHggMDtwYWRkaW5nOjAiPic7CiAgICAgICAgaHRtbCs9JzxkaXYgc3R5bGU9ImJhY2tncm91bmQ6JytsaWdodENvbCsnO3BhZGRpbmc6OHB4IDE0cHg7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTouODVyZW07Y29sb3I6IzMzMzt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7bGV0dGVyLXNwYWNpbmc6LjVweDtib3JkZXItcmFkaXVzOjZweCA2cHggMCAwOy13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0O3ByaW50LWNvbG9yLWFkanVzdDpleGFjdCI+Tm90ZXMgLyBSZW1hcnF1ZXM8L2Rpdj4nOwogICAgICAgIGh0bWwrPSc8ZGl2IHN0eWxlPSJwYWRkaW5nOjhweCAxNHB4O2ZvbnQtc2l6ZTouOXJlbTtsaW5lLWhlaWdodDoxLjY1O2NvbG9yOiM0NDQ7Ym9yZGVyLWxlZnQ6NHB4IHNvbGlkICcrY29sKyciPicrcC56b25lMysnPC9kaXY+PC9kaXY+Jzt9CiAgICAgICAgaHRtbCs9JzwvZGl2PjwvZGl2Pic7CiAgICAgICAgaHRtbCs9JzxkaXYgc3R5bGU9InBvc2l0aW9uOmZpeGVkO2JvdHRvbTowO2xlZnQ6MDtyaWdodDowO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47cGFkZGluZzo2cHggMTBweDtib3JkZXItdG9wOjJweCBzb2xpZCAjY2NjO2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWY7LXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6ZXhhY3Q7cHJpbnQtY29sb3ItYWRqdXN0OmV4YWN0O2JhY2tncm91bmQ6I2ZmZiI+JzsKICAgICAgICBpZihsb2dvU3JjKWh0bWwrPSc8aW1nIHNyYz0iJytsb2dvU3JjKyciIHN0eWxlPSJoZWlnaHQ6MWNtIj4nOwogICAgICAgIGh0bWwrPSc8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0Ij48ZGl2IHN0eWxlPSJmb250LXNpemU6LjhyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiM1NTUiPicrcC5jb2RlKycgLSAnK3AudGl0bGUrJzwvZGl2Pic7CiAgICAgICAgaHRtbCs9JzxkaXYgc3R5bGU9ImZvbnQtc2l6ZTouNjJyZW07Y29sb3I6Izk5OSI+JysodXNlck5hbWU/dXNlck5hbWUrJyAtICc6JycpK3RvZGF5Kyc8L2Rpdj48L2Rpdj4nOwogICAgICAgIGh0bWwrPSc8L2Rpdj4nOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmludC16b25lJykuaW5uZXJIVE1MPWh0bWw7CiAgICAgICAgdmFyIG9sZFRpdGxlPWRvY3VtZW50LnRpdGxlO2RvY3VtZW50LnRpdGxlPXAuY29kZSsnIC0gJytwLnRpdGxlOwogICAgICAgIHRyeXt3aW5kb3cucGFyZW50LmRvY3VtZW50LnRpdGxlPXAuY29kZSsnIC0gJytwLnRpdGxlO31jYXRjaChlKXt9CiAgICAgICAgd2FpdEZvckltYWdlc1RoZW5QcmludCgpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtkb2N1bWVudC50aXRsZT1vbGRUaXRsZTt0cnl7d2luZG93LnBhcmVudC5kb2N1bWVudC50aXRsZT0nUElMT1RFIFx1MjAxNCBTdWl0ZSBkZSBEaXJlY3Rpb24nO31jYXRjaChlKXt9fSwzMDAwKTsKICAgIH0KICAgIC8vIOKVkOKVkOKVkCBTw4lQQVJBVEVVUlMg4pWQ4pWQ4pWQCiAgICBmdW5jdGlvbiBsb2FkU2VwQ29uZmlnKCl7CiAgICAgICAgdmFyIGJveD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VwLWNvbmZpZycpO2lmKCFib3gpcmV0dXJuOwogICAgICAgIHZhciBpdGVtcz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudS1pdGVtW2RhdGEtbWVudV0nKTsKICAgICAgICB2YXIgc2Vwcz0oYXBwRGF0YS5zZXR0aW5ncyYmYXBwRGF0YS5zZXR0aW5ncy5zZXBhcmF0b3JzKXx8W107CiAgICAgICAgdmFyIGg9Jyc7CiAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKXt2YXIgbWVudUlkPWl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLW1lbnUnKTtpZihtZW51SWQ9PT0nbWVudTEnKXJldHVybjt2YXIgbGFiZWw9aXRlbS50ZXh0Q29udGVudC50cmltKCk7dmFyIGNoZWNrZWQ9c2Vwcy5pbmRleE9mKG1lbnVJZCk+PTA/JyBjaGVja2VkJzonJztoKz0nPGxhYmVsIHN0eWxlPSJmb250LXNpemU6Ljc4cmVtO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDtjdXJzb3I6cG9pbnRlciI+PGlucHV0IHR5cGU9ImNoZWNrYm94IiB2YWx1ZT0iJyttZW51SWQrJyInK2NoZWNrZWQrJyBvbmNoYW5nZT0ic2F2ZVNlcENvbmZpZygpIj4gJytsYWJlbCsnPC9sYWJlbD4nO30pOwogICAgICAgIGJveC5pbm5lckhUTUw9aDsKICAgIH0KICAgIGZ1bmN0aW9uIHNhdmVTZXBDb25maWcoKXsKICAgICAgICB2YXIgY2hlY2tzPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNzZXAtY29uZmlnIGlucHV0W3R5cGU9Y2hlY2tib3hdOmNoZWNrZWQnKTsKICAgICAgICB2YXIgc2Vwcz1bXTtjaGVja3MuZm9yRWFjaChmdW5jdGlvbihjKXtzZXBzLnB1c2goYy52YWx1ZSk7fSk7CiAgICAgICAgaWYoIWFwcERhdGEuc2V0dGluZ3MpYXBwRGF0YS5zZXR0aW5ncz17fTthcHBEYXRhLnNldHRpbmdzLnNlcGFyYXRvcnM9c2VwcztzYXZlRGF0YSgpO2FwcGx5U2VwYXJhdG9ycygpOwogICAgfQogICAgZnVuY3Rpb24gYXBwbHlTZXBhcmF0b3JzKCl7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnUtc2VwYXJhdG9yJykuZm9yRWFjaChmdW5jdGlvbihzKXtzLnJlbW92ZSgpO30pOwogICAgICAgIHZhciBzZXBzPShhcHBEYXRhLnNldHRpbmdzJiZhcHBEYXRhLnNldHRpbmdzLnNlcGFyYXRvcnMpfHxbXTsKICAgICAgICBzZXBzLmZvckVhY2goZnVuY3Rpb24obWVudUlkKXt2YXIgaXRlbT1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWVudS1pdGVtW2RhdGEtbWVudT0iJyttZW51SWQrJyJdJyk7aWYoaXRlbSYmaXRlbS5uZXh0RWxlbWVudFNpYmxpbmcpe3ZhciBzZXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7c2VwLmNsYXNzTmFtZT0nbWVudS1zZXBhcmF0b3InO2l0ZW0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VwLGl0ZW0ubmV4dEVsZW1lbnRTaWJsaW5nKTt9fSk7CiAgICB9CiAgICAvLyBFeHBvc2UgcHJvYyBmdW5jdGlvbnMgdG8gZ2xvYmFsIHNjb3BlIChJSUZFIGNsb3N1cmUpCiAgICAKICAgIC8vIFZpZXcgcHJvY2VkdXJlIGZyb20gR2FudHQgKHJlYWQtb25seSBwb3B1cCkKICAgIGZ1bmN0aW9uIHZpZXdQcm9jUmVhZG9ubHkoY29kZSkgewogICAgICAgIGlmKCFjb2RlKSByZXR1cm47CiAgICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHBvcHVwCiAgICAgICAgdmFyIG9sZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXJvLXBvcHVwJyk7CiAgICAgICAgaWYob2xkKSBvbGQucmVtb3ZlKCk7CiAgICAgICAgLy8gU2VhcmNoIGluIHByb2NlZHVyZXMgZmlyc3QsIHRoZW4gZmFsbCBiYWNrIHRvIGdhbnR0IGl0ZW0KICAgICAgICB2YXIgcHJvY3MgPSBhcHBEYXRhLnByb2NlZHVyZXMgfHwgW107CiAgICAgICAgdmFyIHByb2MgPSBwcm9jcy5maW5kKGZ1bmN0aW9uKHgpeyByZXR1cm4geC5jb2RlICYmIHguY29kZS50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gY29kZS50cmltKCkudG9VcHBlckNhc2UoKTsgfSk7CiAgICAgICAgdmFyIGdhbnR0SXRlbSA9IChhcHBEYXRhLmdhbnR0fHxbXSkuZmluZChmdW5jdGlvbih4KXsgcmV0dXJuIHguY29kZSAmJiB4LmNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCkgPT09IGNvZGUudHJpbSgpLnRvVXBwZXJDYXNlKCk7IH0pOwogICAgICAgIGlmKCFwcm9jICYmICFnYW50dEl0ZW0pIHsgYWxlcnQoJ0F1Y3VuZSBwcm9jw6lkdXJlIHRyb3V2w6llIGF2ZWMgbGUgY29kZSAiJyArIGNvZGUgKyAnIicpOyByZXR1cm47IH0KICAgICAgICAvLyBVc2UgcHJvY2VkdXJlIGRhdGEgaWYgYXZhaWxhYmxlLCBvdGhlcndpc2UgYnVpbGQgZnJvbSBnYW50dAogICAgICAgIHZhciB0aXRsZSA9IHByb2MgPyBwcm9jLnRpdGxlIDogKGdhbnR0SXRlbSA/IGdhbnR0SXRlbS5uYW1lIDogJycpOwogICAgICAgIHZhciBwQ29kZSA9IHByb2MgPyBwcm9jLmNvZGUgOiBjb2RlOwogICAgICAgIHZhciBjYXQgPSBwcm9jID8gcHJvYy5jYXQgOiAoZ2FudHRJdGVtID8gZ2FudHRJdGVtLmNhdCA6ICcnKTsKICAgICAgICAKICAgICAgICB2YXIgejIgPSBwcm9jID8gKHByb2Muem9uZTJ8fCcnKSA6ICcnOwogICAgICAgIHZhciB6MyA9IHByb2MgPyAocHJvYy56b25lM3x8JycpIDogKGdhbnR0SXRlbSAmJiBnYW50dEl0ZW0ubm90ZXMgPyBnYW50dEl0ZW0ubm90ZXMgOiAnJyk7CiAgICAgICAgdmFyIHBJZCA9IHByb2MgPyBwcm9jLmlkIDogbnVsbDsKICAgICAgICB2YXIgYmcgPSAodHlwZW9mIGdldFByb2NDb2xvcj09PSdmdW5jdGlvbicpID8gZ2V0UHJvY0NvbG9yKHBDb2RlKSA6ICcjMmMzZTUwJzsKICAgICAgICAvLyBCdWlsZCBwb3B1cAogICAgICAgIHZhciBoID0gJzxkaXYgc3R5bGU9InBvc2l0aW9uOmZpeGVkO3RvcDowO2xlZnQ6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuNSk7ei1pbmRleDo5OTk5O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlciIgb25jbGljaz0iaWYoZXZlbnQudGFyZ2V0PT09dGhpcyl0aGlzLnJlbW92ZSgpIiBpZD0icHJvYy1yby1wb3B1cCI+JzsKICAgICAgICBoICs9ICc8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyLXJhZGl1czoxNHB4O3dpZHRoOjgwdnc7bWF4LWhlaWdodDo4NXZoO292ZXJmbG93LXk6YXV0bztib3gtc2hhZG93OjAgMjBweCA2MHB4IHJnYmEoMCwwLDAsLjI1KSI+JzsKICAgICAgICBoICs9ICc8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOicrYmcrJztjb2xvcjojZmZmO3BhZGRpbmc6MThweCAyMnB4O2JvcmRlci1yYWRpdXM6MTRweCAxNHB4IDAgMDtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuIj4nOwogICAgICAgIGggKz0gJzxkaXY+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxLjFyZW07Zm9udC13ZWlnaHQ6NzAwO29wYWNpdHk6Ljk7YmFja2dyb3VuZDpyZ2JhKDI1NSwyNTUsMjU1LC4yKTtwYWRkaW5nOjRweCAxMnB4O2JvcmRlci1yYWRpdXM6NnB4O21hcmdpbi1yaWdodDoxMnB4Ij4nK3BDb2RlKyc8L3NwYW4+JzsKICAgICAgICBoICs9ICc8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEuMXJlbTtmb250LXdlaWdodDo3MDAiPicrdGl0bGUrJzwvc3Bhbj48L2Rpdj4nOwogICAgICAgIGggKz0gJzxidXR0b24gb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXHgyN3Byb2Mtcm8tcG9wdXBceDI3KS5yZW1vdmUoKSIgc3R5bGU9ImJhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwuMik7Ym9yZGVyOm5vbmU7Y29sb3I6I2ZmZjt3aWR0aDozMnB4O2hlaWdodDozMnB4O2JvcmRlci1yYWRpdXM6NTAlO2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZToxLjFyZW0iPiZ0aW1lczs8L2J1dHRvbj4nOwogICAgICAgIGggKz0gJzwvZGl2Pic7CiAgICAgICAgaWYoY2F0KSBoICs9ICc8ZGl2IHN0eWxlPSJwYWRkaW5nOjEwcHggMjJweCAwO2ZvbnQtc2l6ZTouNzhyZW07Y29sb3I6Izg4OCI+Q2F0w6lnb3JpZSA6IDxzdHJvbmc+JytjYXQrJzwvc3Ryb25nPjwvZGl2Pic7CiAgICAgICAgaWYoIXByb2MpIGggKz0gJzxkaXYgc3R5bGU9InBhZGRpbmc6MTBweCAyMnB4IDA7Zm9udC1zaXplOi43OHJlbTtjb2xvcjojZTY3ZTIyIj48aSBjbGFzcz0iZmFzIGZhLWluZm8tY2lyY2xlIj48L2k+IEF1Y3VuZSBmaWNoZSBwcm9jw6lkdXJlIGFzc29jacOpZSDigJQgY3LDqWV6LWxhIGRhbnMgbGUgc291cy1tZW51IFByb2PDqWR1cmVzIGF2ZWMgbGUgY29kZSA8c3Ryb25nPicrcENvZGUrJzwvc3Ryb25nPjwvZGl2Pic7CiAgICAgICAgdmFyIHpvbmVzID0gWwogICAgICAgICAgICB7bGFiZWw6J0FjdGlvbnMgLyDDiXRhcGVzJywgaWNvbjoncHJvYy1pY29uLWFsZXJ0JywgY29udGVudDp6Mn0sCiAgICAgICAgICAgIHtsYWJlbDonTm90ZXMgLyBSZW1hcnF1ZXMnLCBpY29uOidwcm9jLWljb24taWRlYScsIGNvbnRlbnQ6ejN9CiAgICAgICAgXTsKICAgICAgICB2YXIgaGFzQ29udGVudCA9IHoyfHx6MzsKICAgICAgICBoICs9ICc8ZGl2IHN0eWxlPSJwYWRkaW5nOjE2cHggMjJweCI+JzsKICAgICAgICBpZihoYXNDb250ZW50KSB7CiAgICAgICAgICAgIHpvbmVzLmZvckVhY2goZnVuY3Rpb24oeil7CiAgICAgICAgICAgICAgICBpZih6LmNvbnRlbnQpIHsKICAgICAgICAgICAgICAgICAgICBoICs9ICc8ZGl2IHN0eWxlPSJib3JkZXItbGVmdDozcHggc29saWQgI2RkZDtwYWRkaW5nOjEwcHggMTRweDttYXJnaW46MTJweCAwO2JhY2tncm91bmQ6I2ZhZmFmYTtib3JkZXItcmFkaXVzOjAgOHB4IDhweCAwIj4nOwogICAgICAgICAgICAgICAgICAgIGggKz0gJzxoNCBzdHlsZT0iZm9udC1zaXplOi43OHJlbTtmb250LXdlaWdodDo2MDA7Y29sb3I6Izk5OTttYXJnaW46MCAwIDZweDt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7bGV0dGVyLXNwYWNpbmc6LjVweCI+PHNwYW4gY2xhc3M9Iicrei5pY29uKyciIHN0eWxlPSJtYXJnaW4tcmlnaHQ6NnB4Ij48L3NwYW4+Jyt6LmxhYmVsKyc8L2g0Pic7CiAgICAgICAgICAgICAgICAgICAgaCArPSAnPGRpdiBzdHlsZT0iZm9udC1zaXplOi44NXJlbTtsaW5lLWhlaWdodDoxLjU7Y29sb3I6IzQ0NCI+Jyt6LmNvbnRlbnQrJzwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgaCArPSAnPC9kaXY+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaCArPSAnPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzozMHB4O2NvbG9yOiNiYmIiPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS1hbHQiIHN0eWxlPSJmb250LXNpemU6MnJlbTtkaXNwbGF5OmJsb2NrO21hcmdpbi1ib3R0b206OHB4Ij48L2k+QXVjdW4gY29udGVudSByZW5zZWlnbsOpPC9kaXY+JzsKICAgICAgICB9CiAgICAgICAgaCArPSAnPC9kaXY+JzsKICAgICAgICBoICs9ICc8ZGl2IHN0eWxlPSJwYWRkaW5nOjEycHggMjJweCAxOHB4O3RleHQtYWxpZ246cmlnaHQ7Ym9yZGVyLXRvcDoxcHggc29saWQgI2VlZSI+JzsKICAgICAgICBoICs9ICc8YnV0dG9uIG9uY2xpY2s9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFx4Mjdwcm9jLXJvLXBvcHVwXHgyNykucmVtb3ZlKCkiIHN0eWxlPSJwYWRkaW5nOjhweCAyMHB4O2JvcmRlcjoxcHggc29saWQgI2RkZDtib3JkZXItcmFkaXVzOjhweDtiYWNrZ3JvdW5kOiNmZmY7Y3Vyc29yOnBvaW50ZXI7bWFyZ2luLXJpZ2h0OjhweDtmb250LXNpemU6Ljg1cmVtIj5GZXJtZXI8L2J1dHRvbj4nOwogICAgICAgIGlmKHBJZCkgaCArPSAnPGJ1dHRvbiBvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZChceDI3cHJvYy1yby1wb3B1cFx4MjcpLnJlbW92ZSgpO3N3aXRjaE1lbnUoXHgyN21lbnUxMlx4MjcpO3NldFRpbWVvdXQoZnVuY3Rpb24oKXt2aWV3UHJvYyhceDI3JytwSWQrJ1x4MjcpfSwyMDApIiBzdHlsZT0icGFkZGluZzo4cHggMjBweDtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjhweDtiYWNrZ3JvdW5kOnZhcigtLWhlYWRlciwjMmMzZTUwKTtjb2xvcjojZmZmO2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZTouODVyZW0iPjxpIGNsYXNzPSJmYXMgZmEtZWRpdCI+PC9pPiBPdXZyaXIgZGFucyBQcm9jw6lkdXJlczwvYnV0dG9uPic7CiAgICAgICAgaCArPSAnPC9kaXY+PC9kaXY+PC9kaXY+JzsKICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgaCk7CiAgICB9CgogICAgCiAgICB2YXIgX1BST0NfQ0FUX01BUCA9IFsKICAgICAgICB7cHJlZml4OidQTycsIGNhdDonUG9ydGVzIE91dmVydGVzJ30sCiAgICAgICAge3ByZWZpeDonUkgnLCBjYXQ6J1Jlc3NvdXJjZXMgSHVtYWluZXMnfSwKICAgICAgICB7cHJlZml4OidBJywgY2F0OidBZG1pbmlzdHJhdGlmJ30sCiAgICAgICAge3ByZWZpeDonQicsIGNhdDonw4lsw6h2ZXMgQkVQJ30sCiAgICAgICAge3ByZWZpeDonQycsIGNhdDonQ29uY2VydGF0aW9ucyd9LAogICAgICAgIHtwcmVmaXg6J0QnLCBjYXQ6J0Rpc3Bvc2l0aWZzIFDDqWRhZ29naXF1ZXMnfSwKICAgICAgICB7cHJlZml4OidFJywgY2F0OidTdWl2aSBkZXMgw6lsw6h2ZXMnfSwKICAgICAgICB7cHJlZml4OidJJywgY2F0OidJbnRlcnZlbmFudHMnfSwKICAgICAgICB7cHJlZml4OidOJywgY2F0OidOdW3DqXJpcXVlJ30sCiAgICAgICAge3ByZWZpeDonTycsIGNhdDonT3JpZW50YXRpb24nfSwKICAgICAgICB7cHJlZml4OidQJywgY2F0OidQcm9qZXRzJ30sCiAgICAgICAge3ByZWZpeDonUycsIGNhdDonU8OpY3VyaXTDqSd9CiAgICBdOwogICAgZnVuY3Rpb24gYXV0b1Byb2NDYXQoY29kZSkgewogICAgICAgIGlmKCFjb2RlKSByZXR1cm47CiAgICAgICAgdmFyIGMgPSBjb2RlLnRyaW0oKS50b1VwcGVyQ2FzZSgpOwogICAgICAgIHZhciBzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy1jYXQnKTsKICAgICAgICBmb3IodmFyIGk9MDtpPF9QUk9DX0NBVF9NQVAubGVuZ3RoO2krKyl7CiAgICAgICAgICAgIGlmKGMuaW5kZXhPZihfUFJPQ19DQVRfTUFQW2ldLnByZWZpeCk9PT0wKXsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIG9wdGlvbiBleGlzdHMKICAgICAgICAgICAgICAgIHZhciBmb3VuZD1mYWxzZTsKICAgICAgICAgICAgICAgIGZvcih2YXIgaj0wO2o8c2VsLm9wdGlvbnMubGVuZ3RoO2orKyl7aWYoc2VsLm9wdGlvbnNbal0udmFsdWU9PT1fUFJPQ19DQVRfTUFQW2ldLmNhdCl7Zm91bmQ9dHJ1ZTticmVhazt9fQogICAgICAgICAgICAgICAgaWYoZm91bmQpIHNlbC52YWx1ZT1fUFJPQ19DQVRfTUFQW2ldLmNhdDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAKICAgIAogICAgZnVuY3Rpb24gcHJpbnRHYW50dCgpewogICAgICAgIHZhciBzdz1wcm9tcHQoJ1NlbWFpbmUgZGUgZMOpYnV0IChleDogMzYpOicsJzM2Jyk7aWYoIXN3KXJldHVybjtzdz1wYXJzZUludChzdyk7CiAgICAgICAgdmFyIGV3PXByb21wdCgnU2VtYWluZSBkZSBmaW4gKGV4OiAyNik6JywnMjYnKTtpZighZXcpcmV0dXJuO2V3PXBhcnNlSW50KGV3KTsKICAgICAgICBpZighc3d8fCFldylyZXR1cm47CiAgICAgICAgLy8gQnVpbGQgd2VlayBsaXN0CiAgICAgICAgdmFyIHdlZWtzPVtdOwogICAgICAgIGlmKHN3PmV3KXtmb3IodmFyIHc9c3c7dzw9NTM7dysrKXdlZWtzLnB1c2godyk7Zm9yKHZhciB3PTE7dzw9ZXc7dysrKXdlZWtzLnB1c2godyk7fQogICAgICAgIGVsc2V7Zm9yKHZhciB3PXN3O3c8PWV3O3crKyl3ZWVrcy5wdXNoKHcpO30KICAgICAgICB2YXIgcHJvY3M9KGFwcERhdGEucHJvY2VkdXJlc3x8W10pLmZpbHRlcihmdW5jdGlvbihwKXtyZXR1cm4gcC53c3RhcnQ7fSk7CiAgICAgICAgcHJvY3Muc29ydChmdW5jdGlvbihhLGIpewogICAgICAgICAgICB2YXIgaWE9d2Vla3MuaW5kZXhPZihhLndzdGFydCksaWI9d2Vla3MuaW5kZXhPZihiLndzdGFydCk7CiAgICAgICAgICAgIGlmKGlhPDApaWE9OTk5O2lmKGliPDApaWI9OTk5OwogICAgICAgICAgICBpZihpYSE9PWliKXJldHVybiBpYS1pYjsKICAgICAgICAgICAgdmFyIG5hPXBhcnNlSW50KChhLmNvZGV8fCcnKS5yZXBsYWNlKC9bXjAtOV0vZywnJykpfHwwOwogICAgICAgICAgICB2YXIgbmI9cGFyc2VJbnQoKGIuY29kZXx8JycpLnJlcGxhY2UoL1teMC05XS9nLCcnKSl8fDA7CiAgICAgICAgICAgIHJldHVybiBuYS1uYjsKICAgICAgICB9KTsKICAgICAgICB2YXIgdnc9Z2V0VlcoKTsKICAgICAgICB2YXIgbW9zPVtdLGNtPScnO3dlZWtzLmZvckVhY2goZnVuY3Rpb24odyl7dmFyIG1sPXdrTW8odyk7aWYobWwhPT1jbSl7bW9zLnB1c2goe246bWwsczoxfSk7Y209bWw7fWVsc2UgbW9zW21vcy5sZW5ndGgtMV0ucysrO30pOwogICAgICAgIHZhciBjdz1jdXJXKCk7CiAgICAgICAgdmFyIGg9JzxzdHlsZT5AcGFnZXtzaXplOkEzIGxhbmRzY2FwZTttYXJnaW46NW1tfWJvZHl7Zm9udC1mYW1pbHk6QXJpYWwsc2Fucy1zZXJpZjttYXJnaW46MH10YWJsZXtib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7d2lkdGg6MTAwJTtmb250LXNpemU6LjU1cmVtfXRoLHRke2JvcmRlcjoxcHggc29saWQgI2NjYztwYWRkaW5nOjJweCAzcHg7dGV4dC1hbGlnbjpjZW50ZXJ9dGh7YmFja2dyb3VuZDojZjVmNWY1O2ZvbnQtd2VpZ2h0OjYwMH0uZ3QtY3d7YmFja2dyb3VuZDojZmZmM2NkIWltcG9ydGFudH0uZ3QtdmF7YmFja2dyb3VuZDojZjhmOGY4fS5iYXJ7cG9zaXRpb246YWJzb2x1dGU7aW5zZXQ6MnB4IDFweDtib3JkZXItcmFkaXVzOjJweDstd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDpleGFjdDtwcmludC1jb2xvci1hZGp1c3Q6ZXhhY3R9Lmxhe3RleHQtYWxpZ246bGVmdDtmb250LXNpemU6LjZyZW07d2hpdGUtc3BhY2U6bm93cmFwO21heC13aWR0aDoyMDBweDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpc30uZnR7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtwYWRkaW5nOjRweCAxMHB4O21hcmdpbi10b3A6OHB4O2ZvbnQtc2l6ZTouNnJlbTtjb2xvcjojOTk5fTwvc3R5bGU+JzsKICAgICAgICBoKz0nPHRhYmxlPjx0aGVhZD48dHI+PHRoIHJvd3NwYW49IjIiIHN0eWxlPSJtaW4td2lkdGg6MTYwcHg7dGV4dC1hbGlnbjpsZWZ0Ij5Qcm9jw6lkdXJlPC90aD4nOwogICAgICAgIG1vcy5mb3JFYWNoKGZ1bmN0aW9uKG0pe2grPSc8dGggY29sc3Bhbj0iJyttLnMrJyI+JyttLm4rJzwvdGg+Jzt9KTsKICAgICAgICBoKz0nPC90cj48dHI+JzsKICAgICAgICB3ZWVrcy5mb3JFYWNoKGZ1bmN0aW9uKHcpewogICAgICAgICAgICB2YXIgY2xzPScnO2lmKHc9PT1jdyljbHM9J2d0LWN3JztlbHNlIGlmKHZ3LmluZGV4T2Yodyk+PTApY2xzPSdndC12YSc7CiAgICAgICAgICAgIGgrPSc8dGgnKyhjbHM/JyBjbGFzcz0iJytjbHMrJyInOicnKSsnPicrdysnPC90aD4nOwogICAgICAgIH0pOwogICAgICAgIGgrPSc8L3RyPjwvdGhlYWQ+PHRib2R5Pic7CiAgICAgICAgcHJvY3MuZm9yRWFjaChmdW5jdGlvbihnKXsKICAgICAgICAgICAgdmFyIGNvbD1nZXRQcm9jQ29sb3IoZy5jb2RlKTsKICAgICAgICAgICAgaCs9Jzx0cj48dGQgY2xhc3M9ImxhIj4nK2cuY29kZSsnIC0gJysoZy50aXRsZXx8JycpKyc8L3RkPic7CiAgICAgICAgICAgIHdlZWtzLmZvckVhY2goZnVuY3Rpb24odyl7CiAgICAgICAgICAgICAgICB2YXIgdmFjPXZ3LmluZGV4T2Yodyk+PTAsaXI9d0luUih3LGcud3N0YXJ0LGcud2VuZCk7CiAgICAgICAgICAgICAgICBoKz0nPHRkJysodmFjPycgY2xhc3M9Imd0LXZhIic6JycpKycgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoxNHB4Ij4nOwogICAgICAgICAgICAgICAgaWYoaXIpaCs9JzxkaXYgY2xhc3M9ImJhciIgc3R5bGU9ImJhY2tncm91bmQ6Jytjb2wrJyI+PC9kaXY+JzsKICAgICAgICAgICAgICAgIGgrPSc8L3RkPic7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBoKz0nPC90cj4nOwogICAgICAgIH0pOwogICAgICAgIGgrPSc8L3Rib2R5PjwvdGFibGU+JzsKICAgICAgICB2YXIgbG9nb1NyYz0oYXBwRGF0YS5zZXR0aW5ncyYmYXBwRGF0YS5zZXR0aW5ncy5sb2dvKXx8Jyc7CiAgICAgICAgdmFyIHRvZGF5PW5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonMi1kaWdpdCcsbW9udGg6J2xvbmcnLHllYXI6J251bWVyaWMnfSk7CiAgICAgICAgaCs9JzxkaXYgY2xhc3M9ImZ0Ij4nOwogICAgICAgIGlmKGxvZ29TcmMpaCs9JzxpbWcgc3JjPSInK2xvZ29TcmMrJyIgc3R5bGU9ImhlaWdodDoxY20iPic7CiAgICAgICAgaCs9JzxzcGFuPicrdG9kYXkrJzwvc3Bhbj48L2Rpdj4nOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmludC16b25lJykuaW5uZXJIVE1MPWg7CiAgICAgICAgd2FpdEZvckltYWdlc1RoZW5QcmludCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvZ2dsZVByb2NEb25lKGlkKXsKICAgICAgICB2YXIgc3k9Z2V0Q3VycmVudFNjaG9vbFllYXIoKTsKICAgICAgICB2YXIgcDI9KGFwcERhdGEucHJvY2VkdXJlc3x8W10pLmZpbmQoZnVuY3Rpb24oeCl7cmV0dXJuIHguaWQ9PT1pZDt9KTsKICAgICAgICBpZihwMil7cDIuZG9uZT0hcDIuZG9uZTtwMi5kb25lU1k9cDIuZG9uZT9zeTonJztzYXZlRGF0YSgpO3JlbmRlckdhbnR0KCk7cmV0dXJuO30KICAgICAgICB2YXIgZz0oYXBwRGF0YS5nYW50dHx8W10pLmZpbmQoZnVuY3Rpb24oeCl7cmV0dXJuIHguaWQ9PT1pZDt9KTsKICAgICAgICBpZihnKXtnLmRvbmU9IWcuZG9uZTtnLmRvbmVTWT1nLmRvbmU/c3k6Jyc7c2F2ZURhdGEoKTtyZW5kZXJHYW50dCgpO30KICAgIH0KCiAgICB3aW5kb3cub3BlblByb2NNb2RhbCA9IG9wZW5Qcm9jTW9kYWw7CiAgICB3aW5kb3cuY2xvc2VQcm9jTW9kYWwgPSBjbG9zZVByb2NNb2RhbDsKICAgIHdpbmRvdy5zYXZlUHJvYyA9IHNhdmVQcm9jOwogICAgd2luZG93LmRlbFByb2MgPSBkZWxQcm9jOwogICAgd2luZG93LnJlbmRlclByb2NlZHVyZXMgPSByZW5kZXJQcm9jZWR1cmVzOwogICAgd2luZG93LnZpZXdQcm9jID0gdmlld1Byb2M7CiAgICB3aW5kb3cucHJpbnRQcm9jID0gcHJpbnRQcm9jOwogICAgd2luZG93LnByb2NJbnNlcnRJY29uID0gcHJvY0luc2VydEljb247CiAgICB3aW5kb3cubG9hZFNlcENvbmZpZyA9IGxvYWRTZXBDb25maWc7CiAgICB3aW5kb3cuc2F2ZVNlcENvbmZpZyA9IHNhdmVTZXBDb25maWc7CiAgICB3aW5kb3cuYXBwbHlTZXBhcmF0b3JzID0gYXBwbHlTZXBhcmF0b3JzOwogICAgd2luZG93LnZpZXdQcm9jUmVhZG9ubHkgPSB2aWV3UHJvY1JlYWRvbmx5OwogICAgd2luZG93LnRvZ2dsZVByb2NEb25lID0gdG9nZ2xlUHJvY0RvbmU7CiAgICB3aW5kb3cucHJpbnRHYW50dCA9IHByaW50R2FudHQ7CiAgICAKICAgIGZ1bmN0aW9uIHJ0ZUltZ1Jlc2l6ZShzaXplKXsKICAgICAgICB2YXIgc2VsPXdpbmRvdy5nZXRTZWxlY3Rpb24oKTtpZighc2VsLnJhbmdlQ291bnQpcmV0dXJuOwogICAgICAgIHZhciBub2RlPXNlbC5hbmNob3JOb2RlOwogICAgICAgIC8vIEZpbmQgbmVhcmVzdCBpbWcKICAgICAgICB2YXIgZWw9bm9kZTt3aGlsZShlbCYmZWwudGFnTmFtZSE9PSdJTUcnKXtpZihlbC5jaGlsZE5vZGVzKXtmb3IodmFyIGk9MDtpPGVsLmNoaWxkTm9kZXMubGVuZ3RoO2krKyl7aWYoZWwuY2hpbGROb2Rlc1tpXS50YWdOYW1lPT09J0lNRycpe2VsPWVsLmNoaWxkTm9kZXNbaV07YnJlYWs7fX19aWYoZWwudGFnTmFtZSE9PSdJTUcnKWVsPWVsLnBhcmVudE5vZGU7fQogICAgICAgIGlmKCFlbHx8ZWwudGFnTmFtZSE9PSdJTUcnKXsKICAgICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgYW55IHNlbGVjdGVkIGltZwogICAgICAgICAgICB2YXIgaW1ncz1zZWwuYW5jaG9yTm9kZS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZycpOwogICAgICAgICAgICBpZihpbWdzLmxlbmd0aD09PTEpZWw9aW1nc1swXTsKICAgICAgICAgICAgZWxzZXthbGVydCgnU8OpbGVjdGlvbm5leiB1bmUgaW1hZ2UgZFwnYWJvcmQnKTtyZXR1cm47fQogICAgICAgIH0KICAgICAgICB2YXIgc2l6ZXM9eydzbWFsbCc6JzI1JScsJ21lZGl1bSc6JzUwJScsJ2xhcmdlJzonNzUlJywnZnVsbCc6JzEwMCUnfTsKICAgICAgICBlbC5zdHlsZS53aWR0aD1zaXplc1tzaXplXXx8JzUwJSc7ZWwuc3R5bGUuaGVpZ2h0PSdhdXRvJzsKICAgIH0KICAgIHdpbmRvdy5ydGVJbWdSZXNpemUgPSBydGVJbWdSZXNpemU7CiAgICBmdW5jdGlvbiBleHBvcnREYXRhKCl7CiAgICAgICAgdmFyIGpzb249SlNPTi5zdHJpbmdpZnkoYXBwRGF0YSxudWxsLDIpOwogICAgICAgIHZhciBibG9iPW5ldyBCbG9iKFtqc29uXSx7dHlwZTonYXBwbGljYXRpb24vanNvbid9KTsKICAgICAgICB2YXIgdXJsPVVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgdmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIHZhciBkPW5ldyBEYXRlKCk7CiAgICAgICAgdmFyIGZuYW1lPSdDQURJUl9iYWNrdXBfJytkLmdldEZ1bGxZZWFyKCkrJy0nK1N0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpKyctJytTdHJpbmcoZC5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsJzAnKSsnXycrU3RyaW5nKGQuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwnMCcpKydoJytTdHJpbmcoZC5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsJzAnKSsnLmpzb24nOwogICAgICAgIGEuaHJlZj11cmw7YS5kb3dubG9hZD1mbmFtZTthLmNsaWNrKCk7VVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogICAgICAgIHZhciBlbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGFzdC1leHBvcnQnKTsKICAgICAgICBpZihlbCllbC50ZXh0Q29udGVudD0nRGVybmllciBleHBvcnQgOiAnK2QudG9Mb2NhbGVTdHJpbmcoJ2ZyLUZSJyk7CiAgICAgICAgYXBwRGF0YS5zZXR0aW5ncy5sYXN0RXhwb3J0PWQudG9JU09TdHJpbmcoKTtzYXZlRGF0YSgpOwogICAgfQogICAgZnVuY3Rpb24gaW1wb3J0RGF0YShpbnB1dCl7CiAgICAgICAgaWYoIWlucHV0LmZpbGVzfHwhaW5wdXQuZmlsZXNbMF0pcmV0dXJuOwogICAgICAgIGlmKCFjb25maXJtKCfimqDvuI8gSW1wb3J0ZXIgdmEgUkVNUExBQ0VSIHRvdXRlcyB2b3MgZG9ubsOpZXMgYWN0dWVsbGVzLlxuXG5Wb3VsZXotdm91cyBjb250aW51ZXIgPycpKXJldHVybjsKICAgICAgICB2YXIgcmVhZGVyPW5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgcmVhZGVyLm9ubG9hZD1mdW5jdGlvbihlKXsKICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgdmFyIGRhdGE9SlNPTi5wYXJzZShlLnRhcmdldC5yZXN1bHQpOwogICAgICAgICAgICAgICAgaWYoIWRhdGEuc2V0dGluZ3Mpe2FsZXJ0KCdGaWNoaWVyIGludmFsaWRlIDogcGFzIGRlIHNlY3Rpb24gc2V0dGluZ3MnKTtyZXR1cm47fQogICAgICAgICAgICAgICAgLy8gTWVyZ2UgaW50byBhcHBEYXRhCiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhkYXRhKS5mb3JFYWNoKGZ1bmN0aW9uKGspe2FwcERhdGFba109ZGF0YVtrXTt9KTsKICAgICAgICAgICAgICAgIHNhdmVEYXRhKCk7CiAgICAgICAgICAgICAgICBhbGVydCgn4pyFIEltcG9ydCByw6l1c3NpICEgTGEgcGFnZSB2YSBzZSByZWNoYXJnZXIuJyk7CiAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgfWNhdGNoKGVycil7CiAgICAgICAgICAgICAgICBhbGVydCgnRXJyZXVyIGRlIGxlY3R1cmUgOiAnK2Vyci5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoaW5wdXQuZmlsZXNbMF0pOwogICAgICAgIGlucHV0LnZhbHVlPScnOwogICAgfQogICAgd2luZG93LmV4cG9ydERhdGEgPSBleHBvcnREYXRhOwogICAgd2luZG93LmltcG9ydERhdGEgPSBpbXBvcnREYXRhOwoKICAgIHZhciBfZXZDbGFzc2VzPVtdOwogICAgZnVuY3Rpb24gYnVpbGRDbGFzc1NlbGVjdCgpewogICAgICAgIHZhciBzZWw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2LWNsYXNzZScpO2lmKCFzZWwpcmV0dXJuOwogICAgICAgIHZhciBjbGFzc2VzPXt9OwogICAgICAgIChhcHBEYXRhLnN0dWRlbnRzfHxbXSkuZm9yRWFjaChmdW5jdGlvbihzKXt2YXIgYz1zLkNsYXNzZXx8cy5jbGFzc2U7aWYoYyljbGFzc2VzW2NdPTE7fSk7CiAgICAgICAgdmFyIGg9JzxvcHRpb24gdmFsdWU9IiI+LS0gQ2hvaXNpciBvdSBzYWlzaXIgLS08L29wdGlvbj4nOwogICAgICAgIE9iamVjdC5rZXlzKGNsYXNzZXMpLnNvcnQoKS5mb3JFYWNoKGZ1bmN0aW9uKGMpe2grPSc8b3B0aW9uIHZhbHVlPSInK2MrJyI+JytjKyc8L29wdGlvbj4nO30pOwogICAgICAgIGgrPSc8b3B0aW9uIHZhbHVlPSJfX2N1c3RvbSI+XHUyNzBGIFNhaXNpci4uLjwvb3B0aW9uPic7CiAgICAgICAgc2VsLmlubmVySFRNTD1oOwogICAgfQogICAgZnVuY3Rpb24gYWRkRXZDbGFzc2UoKXsKICAgICAgICB2YXIgc2VsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldi1jbGFzc2UnKTsKICAgICAgICB2YXIgdj1zZWwudmFsdWU7CiAgICAgICAgaWYodj09PSdfX2N1c3RvbScpe3Y9cHJvbXB0KCdDbGFzc2UgOicpO2lmKCF2KXJldHVybjt9CiAgICAgICAgaWYoIXYpcmV0dXJuOwogICAgICAgIGlmKF9ldkNsYXNzZXMuaW5kZXhPZih2KTwwKV9ldkNsYXNzZXMucHVzaCh2KTsKICAgICAgICByZW5kZXJFdkNsYXNzZXMoKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlbW92ZUV2Q2xhc3NlKGMpe19ldkNsYXNzZXM9X2V2Q2xhc3Nlcy5maWx0ZXIoZnVuY3Rpb24oeCl7cmV0dXJuIHghPT1jO30pO3JlbmRlckV2Q2xhc3NlcygpO30KICAgIGZ1bmN0aW9uIHJlbmRlckV2Q2xhc3NlcygpewogICAgICAgIHZhciBoPScnO19ldkNsYXNzZXMuZm9yRWFjaChmdW5jdGlvbihjKXsKICAgICAgICAgICAgaCs9JzxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOiNlMGU3ZmY7Y29sb3I6IzM3MzBhMztwYWRkaW5nOjNweCA4cHg7Ym9yZGVyLXJhZGl1czoxMnB4O2ZvbnQtc2l6ZTouNzVyZW07ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjRweCI+JytjKycgPHNwYW4gc3R5bGU9ImN1cnNvcjpwb2ludGVyO2ZvbnQtd2VpZ2h0OjcwMCIgb25jbGljaz0id2luZG93LnJlbW92ZUV2Q2xhc3NlKFwnJytjKydcJykiPlx1MDBENzwvc3Bhbj48L3NwYW4+JzsKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXYtY2xhc3Nlcy1saXN0JykuaW5uZXJIVE1MPWg7CiAgICB9CiAgICB3aW5kb3cuYWRkRXZDbGFzc2UgPSBhZGRFdkNsYXNzZTsKICAgIHdpbmRvdy5yZW1vdmVFdkNsYXNzZSA9IHJlbW92ZUV2Q2xhc3NlOwogICAgd2luZG93LmJ1aWxkQ2xhc3NTZWxlY3QgPSBidWlsZENsYXNzU2VsZWN0OwogICAgd2luZG93LnNhdmVFdmVudCA9IHR5cGVvZiBzYXZlRXZlbnQhPT0ndW5kZWZpbmVkJz9zYXZlRXZlbnQ6ZnVuY3Rpb24oKXt9OwogICAgd2luZG93LmNsb3NlRXZNb2RhbCA9IHR5cGVvZiBjbG9zZUV2TW9kYWwhPT0ndW5kZWZpbmVkJz9jbG9zZUV2TW9kYWw6ZnVuY3Rpb24oKXt9OwogICAgd2luZG93LmRlbEV2RnJvbU1vZGFsID0gdHlwZW9mIGRlbEV2RnJvbU1vZGFsIT09J3VuZGVmaW5lZCc/ZGVsRXZGcm9tTW9kYWw6ZnVuY3Rpb24oKXt9OwogICAgd2luZG93Lm9wZW5Fdk1vZGFsID0gdHlwZW9mIG9wZW5Fdk1vZGFsIT09J3VuZGVmaW5lZCc/b3BlbkV2TW9kYWw6ZnVuY3Rpb24oKXt9OwoKCiAgICB3aW5kb3cuYXV0b1Byb2NDYXQgPSBhdXRvUHJvY0NhdDsKICAgIHdpbmRvdy5hdXRvUmVzZXREb25lID0gYXV0b1Jlc2V0RG9uZTsKICAgIHdpbmRvdy5nZXRDdXJyZW50U2Nob29sWWVhciA9IGdldEN1cnJlbnRTY2hvb2xZZWFyOwogICAgd2luZG93LnNhdmVHdCA9IHNhdmVHdDsKICAgIHdpbmRvdy5vcGVuR3RNb2RhbCA9IG9wZW5HdE1vZGFsOwogICAgd2luZG93LmNsb3NlR3RNb2RhbCA9IGNsb3NlR3RNb2RhbDsKICAgIHdpbmRvdy5kZWxHdEZyb21Nb2RhbCA9IGRlbEd0RnJvbU1vZGFsOwogICAgd2luZG93LnRvZ2dsZUd0RG9uZSA9IHRvZ2dsZUd0RG9uZTsKICAgIHdpbmRvdy5yZW5kZXJHYW50dCA9IHJlbmRlckdhbnR0OwogICAgd2luZG93Lmd0UHJldiA9IGd0UHJldjsKICAgIHdpbmRvdy5ndE5leHQgPSBndE5leHQ7CiAgICB3aW5kb3cuZ3RUb2RheSA9IGd0VG9kYXk7CiAgICB3aW5kb3cuZ3RZZWFyID0gZ3RZZWFyOwogICAgd2luZG93LmZpbGxUZWFjaGVyU2VsID0gZmlsbFRlYWNoZXJTZWw7CgoKICAgIAovLyBBdXRvLXJlc2V0IGF1IGTDqW1hcnJhZ2UKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCl7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGlmKHR5cGVvZiBhdXRvUmVzZXREb25lPT09J2Z1bmN0aW9uJykgYXV0b1Jlc2V0RG9uZSgpOyB9LCA1MDApOwogICAgc2V0VGltZW91dChmdW5jdGlvbigpeyBpZih0eXBlb2YgcmVzdG9yZUZpbGVIYW5kbGU9PT0nZnVuY3Rpb24nKSByZXN0b3JlRmlsZUhhbmRsZSgpOyB9LCAzMDApOwp9KTsKCgogICAgLy8gPT09IFdPUkQgUEFTVEUg4oCUIENvbGxhZ2UgaW50ZWxsaWdlbnQgZGVwdWlzIFdvcmQgPT09CiAgICBmdW5jdGlvbiBjbGVhbldvcmRIdG1sKGh0bWwpIHsKICAgICAgICAvLyDilIDilIAgMS4gU3VwcHJpbWVyIGNvbW1lbnRhaXJlcyBjb25kaXRpb25uZWxzIFdvcmQg4pSA4pSACiAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvPCEtLVxbaWZbXlxdXSpcXT5bXHNcU10qPzwhXFtlbmRpZlxdLS0+L2dpLCAnJyk7CgogICAgICAgIC8vIOKUgOKUgCAyLiBTdXBwcmltZXIgYmFsaXNlcyBYTUwgV29yZCAobzosIHc6LCBtOikg4pSA4pSACiAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvPFwvP286W2EtekEtWl1bXj5dKj4vZ2ksICcnKTsKICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKC88XC8/dzpbYS16QS1aXVtePl0qPi9naSwgJycpOwogICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UoLzxcLz9tOlthLXpBLVpdW14+XSo+L2dpLCAnJyk7CiAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvPHY6W14+XSs+W1xzXFNdKj88XC92OltePl0rPi9naSwgJycpOwogICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UoLzxcLz92OltePl0rPi9naSwgJycpOwoKICAgICAgICAvLyDilIDilIAgMy4gQ29udmVydGlyIGxpc3RlcyBXb3JkIGF2ZWMgbml2ZWF1eCDilIDilIAKICAgICAgICAvLyBXb3JkIGVuY29kZTogPHAgY2xhc3M9Ik1zb0xpc3RQYXJhZ3JhcGgiIHN0eWxlPSIuLi5tc28tbGlzdDpsMCBsZXZlbDIgbGZvMS4uLiI+CiAgICAgICAgLy8gT24gZXh0cmFpdCBsZSBuaXZlYXUgZXQgY29uc3RydWl0IHVuZSBsaXN0ZSBpbWJyaXF1w6llCgogICAgICAgIC8vIDNhLiBQYXJzZXIgY2hhcXVlIHBhcmFncmFwaGUgbGlzdGUgZW4gb2JqZXQge2xldmVsLCBvcmRlcmVkLCBjb250ZW50fQogICAgICAgIHZhciBsaXN0SXRlbXMgPSBbXTsKICAgICAgICB2YXIgbGlzdFJhbmdlcyA9IFtdOyAvLyBwb3NpdGlvbnMgZGFucyBsZSBIVE1MIHBvdXIgcmVjb25zdHJ1Y3Rpb24KCiAgICAgICAgdmFyIHBMaXN0UmUgPSAvPHAoW14+XSooPzptc28tbGlzdHxNc29MaXN0KVtePl0qKT4oW1xzXFNdKj8pPFwvcD4vZ2k7CiAgICAgICAgdmFyIG1hdGNoOwogICAgICAgIHdoaWxlICgobWF0Y2ggPSBwTGlzdFJlLmV4ZWMoaHRtbCkpICE9PSBudWxsKSB7CiAgICAgICAgICAgIHZhciBhdHRycyA9IG1hdGNoWzFdOwogICAgICAgICAgICB2YXIgaW5uZXIgPSBtYXRjaFsyXTsKICAgICAgICAgICAgdmFyIGxldmVsTSA9IC9tc28tbGlzdDpbXjtdKj9sZXZlbChcZCspL2kuZXhlYyhhdHRycyk7CiAgICAgICAgICAgIHZhciBsZXZlbCA9IGxldmVsTSA/IHBhcnNlSW50KGxldmVsTVsxXSkgOiAxOwogICAgICAgICAgICBpZiAobGV2ZWwgPCAxKSBsZXZlbCA9IDE7CiAgICAgICAgICAgIGlmIChsZXZlbCA+IDMpIGxldmVsID0gMzsKCiAgICAgICAgICAgIC8vIETDqXRlY3RlciBsaXN0ZSBvcmRvbm7DqWU6IGxlIHNwYW4gZGUgcHVjZSBjb250aWVudCBjaGlmZnJlL2xldHRyZStwb25jdHVhdGlvbgogICAgICAgICAgICB2YXIgaXNPcmRlcmVkID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBmaXJzdFNwYW4gPSBpbm5lci5tYXRjaCgvPHNwYW5bXj5dKj4oW1xzXFNdKj8pPFwvc3Bhbj4vaSk7CiAgICAgICAgICAgIGlmIChmaXJzdFNwYW4pIHsKICAgICAgICAgICAgICAgIHZhciB0eHQgPSBmaXJzdFNwYW5bMV0ucmVwbGFjZSgvPFtePl0rPi9nLCcnKS5yZXBsYWNlKC8mbmJzcDsvZywnICcpLnRyaW0oKTsKICAgICAgICAgICAgICAgIGlzT3JkZXJlZCA9IC9eW1xkXHddK1suKV1ccyokLy50ZXN0KHR4dCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE5ldHRveWVyIGxlIGNvbnRlbnU6IHN1cHByaW1lciBsZSBzcGFuIGRlIHB1Y2UgKFN5bWJvbC9XaW5nZGluZ3MvbXNvLWxpc3QpCiAgICAgICAgICAgIGlubmVyID0gaW5uZXIucmVwbGFjZSgvPHNwYW5bXj5dKmZvbnQtZmFtaWx5XHMqOlxzKlsnIl0/XHMqKD86U3ltYm9sfFdpbmdkaW5ncylbXj5dKj5bXHNcU10qPzxcL3NwYW4+L2dpLCAnJyk7CiAgICAgICAgICAgIGlubmVyID0gaW5uZXIucmVwbGFjZSgvPHNwYW5bXj5dKm1zby1saXN0W14+XSo+W1xzXFNdKj88XC9zcGFuPi9naSwgJycpOwogICAgICAgICAgICAvLyBTdXBwcmltZXIgbGVzICZuYnNwOyBkJ2luZGVudGF0aW9uIGVuIGTDqWJ1dAogICAgICAgICAgICBpbm5lciA9IGlubmVyLnJlcGxhY2UoL14oXHMqJm5ic3A7XHMqKSsvLCAnJyk7CiAgICAgICAgICAgIGlubmVyID0gaW5uZXIudHJpbSgpOwoKICAgICAgICAgICAgbGlzdEl0ZW1zLnB1c2goeyBsZXZlbDogbGV2ZWwsIG9yZGVyZWQ6IGlzT3JkZXJlZCwgY29udGVudDogaW5uZXIsIGZ1bGw6IG1hdGNoWzBdLCBpbmRleDogbWF0Y2guaW5kZXggfSk7CiAgICAgICAgICAgIGxpc3RSYW5nZXMucHVzaCh7IHN0YXJ0OiBtYXRjaC5pbmRleCwgZW5kOiBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aCB9KTsKICAgICAgICB9CgogICAgICAgIC8vIDNiLiBDb25zdHJ1aXJlIGwnSFRNTCBkZSBsaXN0ZSBpbWJyaXF1w6llIMOgIHBhcnRpciBkZXMgaXRlbXMKICAgICAgICBmdW5jdGlvbiBidWlsZE5lc3RlZExpc3QoaXRlbXMpIHsKICAgICAgICAgICAgaWYgKCFpdGVtcy5sZW5ndGgpIHJldHVybiAnJzsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwogICAgICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzR3JvdXAocGFyZW50TGV2ZWwpIHsKICAgICAgICAgICAgICAgIHZhciBncm91cEh0bWwgPSAnJzsKICAgICAgICAgICAgICAgIHZhciBsaXN0VGFnID0gbnVsbDsKICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgaXRlbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5sZXZlbCA8IHBhcmVudExldmVsKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5sZXZlbCA+IHBhcmVudExldmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNvdXMtbGlzdGUgw6AgbCdpbnTDqXJpZXVyIGR1IGRlcm5pZXIgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViVGFnID0gaXRlbS5vcmRlcmVkID8gJ29sJyA6ICd1bCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwSHRtbCArPSAnPCcgKyBzdWJUYWcgKyAnIHN0eWxlPSJtYXJnaW46MnB4IDAgMnB4IDIycHg7cGFkZGluZy1sZWZ0OjA7Ij4nOwogICAgICAgICAgICAgICAgICAgICAgICBncm91cEh0bWwgKz0gcHJvY2Vzc0dyb3VwKGl0ZW0ubGV2ZWwpOwogICAgICAgICAgICAgICAgICAgICAgICBncm91cEh0bWwgKz0gJzwvJyArIHN1YlRhZyArICc+JzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBNw6ptZSBuaXZlYXUKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1clRhZyA9IGl0ZW0ub3JkZXJlZCA/ICdvbCcgOiAndWwnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxpc3RUYWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RUYWcgPSBjdXJUYWc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cEh0bWwgPSAnPCcgKyBjdXJUYWcgKyAnIHN0eWxlPSJtYXJnaW46NHB4IDA7cGFkZGluZy1sZWZ0OjIycHg7Ij4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN1clRhZyAhPT0gbGlzdFRhZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBIdG1sICs9ICc8LycgKyBsaXN0VGFnICsgJz48JyArIGN1clRhZyArICcgc3R5bGU9Im1hcmdpbjo0cHggMDtwYWRkaW5nLWxlZnQ6MjJweDsiPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0VGFnID0gY3VyVGFnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwSHRtbCArPSAnPGxpPicgKyBpdGVtLmNvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVsOpcmlmaWVyIHNpIGxlIHByb2NoYWluIGl0ZW0gZXN0IHVuIHNvdXMtbml2ZWF1CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpIDwgaXRlbXMubGVuZ3RoICYmIGl0ZW1zW2ldLmxldmVsID4gcGFyZW50TGV2ZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwSHRtbCArPSBwcm9jZXNzR3JvdXAoaXRlbXNbaV0ubGV2ZWwpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwSHRtbCArPSAnPC9saT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsaXN0VGFnKSBncm91cEh0bWwgKz0gJzwvJyArIGxpc3RUYWcgKyAnPic7CiAgICAgICAgICAgICAgICByZXR1cm4gZ3JvdXBIdG1sOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcHJvY2Vzc0dyb3VwKDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxpc3RJdGVtcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIC8vIFJlbXBsYWNlciBsZXMgYmxvY3MgZGUgbGlzdGUgZGFucyBsZSBIVE1MCiAgICAgICAgICAgIC8vIFRyb3V2ZXIgbGVzIGdyb3VwZXMgZGUgbGlzdGVzIGNvbnPDqWN1dGl2ZXMKICAgICAgICAgICAgdmFyIGdyb3VwcyA9IFtdOwogICAgICAgICAgICB2YXIgY3VycmVudEdyb3VwID0gW2xpc3RJdGVtc1swXV07CiAgICAgICAgICAgIGZvciAodmFyIGdpID0gMTsgZ2kgPCBsaXN0SXRlbXMubGVuZ3RoOyBnaSsrKSB7CiAgICAgICAgICAgICAgICAvLyBDb25zw6ljdXRpZiBzaSBsZXMgcG9zaXRpb25zIHNvbnQgcHJvY2hlcyAocGFzIGQnYXV0cmUgY29udGVudSBlbnRyZSBldXgpCiAgICAgICAgICAgICAgICB2YXIgcHJldkVuZCA9IGxpc3RSYW5nZXNbZ2ktMV0uZW5kOwogICAgICAgICAgICAgICAgdmFyIG5leHRTdGFydCA9IGxpc3RSYW5nZXNbZ2ldLnN0YXJ0OwogICAgICAgICAgICAgICAgdmFyIGJldHdlZW4gPSBodG1sLnN1YnN0cmluZyhwcmV2RW5kLCBuZXh0U3RhcnQpLnJlcGxhY2UoL1xzKy9nLCcnKTsKICAgICAgICAgICAgICAgIGlmIChiZXR3ZWVuID09PSAnJyB8fCBiZXR3ZWVuLmxlbmd0aCA8IDUwKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEdyb3VwLnB1c2gobGlzdEl0ZW1zW2dpXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKHsgaXRlbXM6IGN1cnJlbnRHcm91cCwgc3RhcnQ6IGxpc3RSYW5nZXNbZ2kgLSBjdXJyZW50R3JvdXAubGVuZ3RoXS5zdGFydCwgZW5kOiBsaXN0UmFuZ2VzW2dpLTFdLmVuZCB9KTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50R3JvdXAgPSBbbGlzdEl0ZW1zW2dpXV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ3JvdXBzLnB1c2goeyBpdGVtczogY3VycmVudEdyb3VwLCBzdGFydDogbGlzdFJhbmdlc1tsaXN0SXRlbXMubGVuZ3RoIC0gY3VycmVudEdyb3VwLmxlbmd0aF0uc3RhcnQsIGVuZDogbGlzdFJhbmdlc1tsaXN0SXRlbXMubGVuZ3RoLTFdLmVuZCB9KTsKCiAgICAgICAgICAgIC8vIFJlY29uc3RydWlyZSBsZSBIVE1MIGVuIHJlbXBsYcOnYW50IGNoYXF1ZSBncm91cGUKICAgICAgICAgICAgdmFyIG5ld0h0bWwgPSAnJzsKICAgICAgICAgICAgdmFyIGxhc3RQb3MgPSAwOwogICAgICAgICAgICBncm91cHMuZm9yRWFjaChmdW5jdGlvbihncm91cCkgewogICAgICAgICAgICAgICAgbmV3SHRtbCArPSBodG1sLnN1YnN0cmluZyhsYXN0UG9zLCBncm91cC5zdGFydCk7CiAgICAgICAgICAgICAgICBuZXdIdG1sICs9IGJ1aWxkTmVzdGVkTGlzdChncm91cC5pdGVtcyk7CiAgICAgICAgICAgICAgICBsYXN0UG9zID0gZ3JvdXAuZW5kOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbmV3SHRtbCArPSBodG1sLnN1YnN0cmluZyhsYXN0UG9zKTsKICAgICAgICAgICAgaHRtbCA9IG5ld0h0bWw7CiAgICAgICAgfQoKICAgICAgICAvLyDilIDilIAgNC4gSW1hZ2VzIDogZ2FyZGVyIGRhdGE6IGV0IGh0dHA6LCBzdXBwcmltZXIgZmlsZTovLyDilIDilIAKICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKC88aW1nKFtePl0qKT4vZ2ksIGZ1bmN0aW9uKG0sIGF0dHJzKSB7CiAgICAgICAgICAgIHZhciBzcmNNID0gL3NyY1xzKj1ccypbIiddKFteIiddKylbIiddL2kuZXhlYyhhdHRycyk7CiAgICAgICAgICAgIGlmICghc3JjTSkgcmV0dXJuICcnOwogICAgICAgICAgICB2YXIgc3JjID0gc3JjTVsxXTsKICAgICAgICAgICAgaWYgKHNyYy5zdGFydHNXaXRoKCdkYXRhOicpIHx8IHNyYy5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgc3JjLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnPGltZyBzcmM9IicgKyBzcmMgKyAnIiBzdHlsZT0ibWF4LXdpZHRoOjEwMCU7aGVpZ2h0OmF1dG87Ij4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9KTsKCiAgICAgICAgLy8g4pSA4pSAIDUuIFN1cHByaW1lciBwcm9wcmnDqXTDqXMgbXNvLSBkYW5zIHN0eWxlcyDilIDilIAKICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKC9tc28tW2EtekEtWlwtXStccyo6W147Il0qKDt8KD89XHMqIikpL2csICcnKTsKCiAgICAgICAgLy8g4pSA4pSAIDYuIFN1cHByaW1lciBmb250LWZhbWlseSBTeW1ib2wvV2luZ2RpbmdzIOKUgOKUgAogICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UoL2ZvbnQtZmFtaWx5XHMqOlxzKlsiJ10/XHMqKD86U3ltYm9sfFdpbmdkaW5nc1teOywnIl0qKVxzKlsiJ10/XHMqOz8vZ2ksICcnKTsKCiAgICAgICAgLy8g4pSA4pSAIDcuIFN1cHByaW1lciBjbGFzc2VzIE1zbyDilIDilIAKICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKC9ccypjbGFzcz0iTXNvW14iXSoiL2dpLCAnJyk7CgogICAgICAgIC8vIOKUgOKUgCA4LiBOZXR0b3llciBzdHlsZXMgdmlkZXMgZXQgcGFyYWdyYXBoZXMgdmlkZXMg4pSA4pSACiAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvXHMqc3R5bGU9IlxzKjs/XHMqIi9naSwgJycpOwogICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UoLzxwW14+XSo+XHMqKDxiclxzKlwvPz4pP1xzKjxcL3A+L2dpLCAnJyk7CiAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZSgvPHNwYW5ccyo+KFtcc1xTXSo/KTxcL3NwYW4+L2dpLCAnJDEnKTsKCiAgICAgICAgcmV0dXJuIGh0bWwudHJpbSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcGx5Q2xlYW5QYXN0ZShlZGl0b3IsIGh0bWwpIHsKICAgICAgICB2YXIgY2xlYW5lZCA9IGNsZWFuV29yZEh0bWwoaHRtbCk7CiAgICAgICAgZWRpdG9yLmZvY3VzKCk7CiAgICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKICAgICAgICB2YXIgcmFuZ2UgPSBzZWwgJiYgc2VsLnJhbmdlQ291bnQgPyBzZWwuZ2V0UmFuZ2VBdCgwKSA6IG51bGw7CiAgICAgICAgaWYgKHJhbmdlICYmIGVkaXRvci5jb250YWlucyhyYW5nZS5jb21tb25BbmNlc3RvckNvbnRhaW5lcikpIHsKICAgICAgICAgICAgcmFuZ2UuZGVsZXRlQ29udGVudHMoKTsKICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gY2xlYW5lZDsKICAgICAgICAgICAgdmFyIGZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgICAgIHZhciBub2RlOwogICAgICAgICAgICB3aGlsZSAoKG5vZGUgPSBkaXYuZmlyc3RDaGlsZCkpIGZyYWcuYXBwZW5kQ2hpbGQobm9kZSk7CiAgICAgICAgICAgIHJhbmdlLmluc2VydE5vZGUoZnJhZyk7CiAgICAgICAgICAgIC8vIE1vdmUgY3Vyc29yIHRvIGVuZCBvZiBpbnNlcnRlZCBjb250ZW50CiAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKGZhbHNlKTsKICAgICAgICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpOwogICAgICAgICAgICBzZWwuYWRkUmFuZ2UocmFuZ2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRIVE1MJywgZmFsc2UsIGNsZWFuZWQpOwogICAgICAgIH0KICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBwYXN0ZUZyb21Xb3JkKCkgewogICAgICAgIC8vIFVzZSB0cmFja2VkIGVkaXRvciAoYnV0dG9uIGNsaWNrIHN0ZWFscyBmb2N1cyBmcm9tIGNvbnRlbnRlZGl0YWJsZSkKICAgICAgICB2YXIgZWRpdG9yID0gd2luZG93Ll9sYXN0Rm9jdXNlZEVkaXRvciB8fCBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwogICAgICAgIGlmICghZWRpdG9yIHx8ICFlZGl0b3IuaXNDb250ZW50RWRpdGFibGUpIHsKICAgICAgICAgICAgYWxlcnQoJ0NsaXF1ZXogZFwnYWJvcmQgZGFucyBsYSB6b25lIGRlIHRleHRlLCBwdWlzIHV0aWxpc2V6IGNlIGJvdXRvbi4nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBlZGl0b3IuZm9jdXMoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIW5hdmlnYXRvci5jbGlwYm9hcmQgfHwgIW5hdmlnYXRvci5jbGlwYm9hcmQucmVhZCkgdGhyb3cgbmV3IEVycm9yKCdBUEkgbm9uIGRpc3BvbmlibGUnKTsKICAgICAgICAgICAgdmFyIGl0ZW1zID0gYXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC5yZWFkKCk7CiAgICAgICAgICAgIGZvciAodmFyIGl0ZW0gb2YgaXRlbXMpIHsKICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGVzLmluY2x1ZGVzKCd0ZXh0L2h0bWwnKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gYXdhaXQgaXRlbS5nZXRUeXBlKCd0ZXh0L2h0bWwnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGF3YWl0IGJsb2IudGV4dCgpOwogICAgICAgICAgICAgICAgICAgIGFwcGx5Q2xlYW5QYXN0ZShlZGl0b3IsIGh0bWwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGVzLmluY2x1ZGVzKCd0ZXh0L3BsYWluJykpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IGF3YWl0IGl0ZW0uZ2V0VHlwZSgndGV4dC9wbGFpbicpOwogICAgICAgICAgICAgICAgICAgIHZhciB0eHQgPSBhd2FpdCBibG9iLnRleHQoKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VGV4dCcsIGZhbHNlLCB0eHQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAvLyBGYWxsYmFjazogYXNrIHVzZXIgdG8gdXNlIEN0cmwrViDigJQgdGhlIHBhc3RlIGV2ZW50IGxpc3RlbmVyIHdpbGwgY2xlYW4gaXQKICAgICAgICAgICAgYWxlcnQoJ1V0aWxpc2V6IEN0cmwrViBkaXJlY3RlbWVudCBkYW5zIGxcJ8OpZGl0ZXVyIDogbGEgbWlzZSBlbiBmb3JtZSBXb3JkIHNlcmEgYXV0b21hdGlxdWVtZW50IHByw6lzZXJ2w6llIGV0IG5ldHRvecOpZS4nKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdFdvcmRQYXN0ZSgpIHsKICAgICAgICAvLyBBam91dGVyIHVuIMOpY291dGV1ciBkZSBjb2xsYWdlIHN1ciBUT1VTIGxlcyDDqWRpdGV1cnMKICAgICAgICAvLyBDJ2VzdCBsYSBtw6l0aG9kZSBsYSBwbHVzIGZpYWJsZSA6IGludGVyY2VwdGUgQ3RybCtWIG5hdGl2ZW1lbnQKICAgICAgICBmdW5jdGlvbiB3b3JkUGFzdGVIYW5kbGVyKGUpIHsKICAgICAgICAgICAgdmFyIGNkID0gZS5jbGlwYm9hcmREYXRhIHx8IHdpbmRvdy5jbGlwYm9hcmREYXRhOwogICAgICAgICAgICBpZiAoIWNkKSByZXR1cm47CiAgICAgICAgICAgIHZhciBlZGl0b3IgPSBlLmN1cnJlbnRUYXJnZXQ7CgogICAgICAgICAgICAvLyDilIDilIAgQ2hlcmNoZXIgdW5lIGltYWdlIGRhbnMgaXRlbXMgKHNjcmVlbnNob3QsIGNvcGllIGQnaW1hZ2UpIOKUgOKUgAogICAgICAgICAgICBmdW5jdGlvbiBnZXRJbWFnZUl0ZW0oY2QpIHsKICAgICAgICAgICAgICAgIGlmICghY2QuaXRlbXMpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjZC5pdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChjZC5pdGVtc1tpXS50eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKSByZXR1cm4gY2QuaXRlbXNbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGh0bWwgPSBjZC5nZXREYXRhKCd0ZXh0L2h0bWwnKTsKICAgICAgICAgICAgdmFyIGltZ0l0ZW0gPSBnZXRJbWFnZUl0ZW0oY2QpOwoKICAgICAgICAgICAgLy8g4pSA4pSAIENhcyAxIDogSW1hZ2Ugc2V1bGUgKHBhcyBkZSBIVE1MIG91IEhUTUwgdmlkZSkg4pSA4pSACiAgICAgICAgICAgIGlmIChpbWdJdGVtICYmICghaHRtbCB8fCBodG1sLnRyaW0oKSA9PT0gJycpKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IGltZ0l0ZW0uZ2V0QXNGaWxlKCk7CiAgICAgICAgICAgICAgICBpZiAoIWJsb2IpIHJldHVybjsKICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGV2KSB7CiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydEhUTUwnLCBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbWcgc3JjPSInICsgZXYudGFyZ2V0LnJlc3VsdCArICciIHN0eWxlPSJtYXgtd2lkdGg6MTAwJTtoZWlnaHQ6YXV0bztkaXNwbGF5OmJsb2NrO21hcmdpbjo0cHggMDsiPicpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGJsb2IpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWh0bWwpIHJldHVybjsKCiAgICAgICAgICAgIC8vIFNpIHBhcyBkZSBtYXJxdWV1ciBXb3JkIG5pIEhUTUwgcmljaGUg4oaSIGxhaXNzZXIgbGUgbmF2aWdhdGV1ciBnw6lyZXIKICAgICAgICAgICAgdmFyIGlzV29yZCA9IGh0bWwuaW5jbHVkZXMoJ21zby0nKSB8fCBodG1sLmluY2x1ZGVzKCd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tJykgfHwKICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWwuaW5jbHVkZXMoJ01zb05vcm1hbCcpIHx8IGh0bWwuaW5jbHVkZXMoJ1dvcmREb2N1bWVudCcpOwogICAgICAgICAgICB2YXIgaXNSaWNoSHRtbCA9IGh0bWwuaW5jbHVkZXMoJzx1bCcpIHx8IGh0bWwuaW5jbHVkZXMoJzxvbCcpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbC5pbmNsdWRlcygnPHRhYmxlJykgfHwgaHRtbC5pbmNsdWRlcygnPGltZycpOwogICAgICAgICAgICBpZiAoIWlzV29yZCAmJiAhaXNSaWNoSHRtbCkgcmV0dXJuOwoKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgLy8g4pSA4pSAIENhcyAyIDogSFRNTCBXb3JkIGF2ZWMgcG9zc2libGVzIGltYWdlcyBpbmxpbmUg4pSA4pSACiAgICAgICAgICAgIGlmIChpbWdJdGVtICYmIGlzV29yZCkgewogICAgICAgICAgICAgICAgdmFyIGJsb2IyID0gaW1nSXRlbS5nZXRBc0ZpbGUoKTsKICAgICAgICAgICAgICAgIGlmIChibG9iMikgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgICAgICAgICByZWFkZXIyLm9ubG9hZCA9IGZ1bmN0aW9uKGV2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbXBsYWNlciBsZSBwcmVtaWVyIDxpbWc+IHNhbnMgZGF0YTogc3JjIHBhciBjZXR0ZSBpbWFnZQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc2VkSHRtbCA9IGh0bWwucmVwbGFjZSgvPGltZyhbXj5dKik+L2ksIGZ1bmN0aW9uKG0sIGF0dHJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3JjTSA9IC9zcmNccyo9XHMqWyInXShbXiInXSspWyInXS9pLmV4ZWMoYXR0cnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNyY00gJiYgc3JjTVsxXS5zdGFydHNXaXRoKCdkYXRhOicpKSByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGltZyBzcmM9IicgKyBldi50YXJnZXQucmVzdWx0ICsgJyIgc3R5bGU9Im1heC13aWR0aDoxMDAlO2hlaWdodDphdXRvOyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5Q2xlYW5QYXN0ZShlZGl0b3IsIHByb2Nlc3NlZEh0bWwpOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcmVhZGVyMi5yZWFkQXNEYXRhVVJMKGJsb2IyKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFwcGx5Q2xlYW5QYXN0ZShlZGl0b3IsIGh0bWwpOwogICAgICAgIH0KICAgICAgICAvLyBBdHRhY2hlciDDoCB0b3VzIGxlcyDDqWRpdGV1cnMgZXhpc3RhbnRzCiAgICAgICAgLy8gVHJhY2sgbGFzdCBmb2N1c2VkIGVkaXRvciBzbyBidXR0b24gY2xpY2sgZG9lc24ndCBicmVhayBmb2N1cyBkZXRlY3Rpb24KICAgICAgICBmdW5jdGlvbiB0cmFja0ZvY3VzKGVsKSB7CiAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZnVuY3Rpb24oKSB7IHdpbmRvdy5fbGFzdEZvY3VzZWRFZGl0b3IgPSBlbDsgfSk7CiAgICAgICAgfQogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tjb250ZW50ZWRpdGFibGU9InRydWUiXScpLmZvckVhY2goZnVuY3Rpb24oZWwpIHsKICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGFzdGUnLCB3b3JkUGFzdGVIYW5kbGVyKTsKICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigncGFzdGUnLCB3b3JkUGFzdGVIYW5kbGVyKTsKICAgICAgICAgICAgdHJhY2tGb2N1cyhlbCk7CiAgICAgICAgfSk7CiAgICAgICAgLy8gT2JzZXJ2ZXIgcG91ciBmdXR1cnMgw6lkaXRldXJzIGR5bmFtaXF1ZXMKICAgICAgICBpZiAod2luZG93Ll93b3JkUGFzdGVPYnNlcnZlcikgd2luZG93Ll93b3JkUGFzdGVPYnNlcnZlci5kaXNjb25uZWN0KCk7CiAgICAgICAgd2luZG93Ll93b3JkUGFzdGVPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICBtLmFkZGVkTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuY29udGVudEVkaXRhYmxlID09PSAndHJ1ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcigncGFzdGUnLCB3b3JkUGFzdGVIYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCBmdW5jdGlvbigpIHsgd2luZG93Ll9sYXN0Rm9jdXNlZEVkaXRvciA9IG5vZGU7IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucXVlcnlTZWxlY3RvckFsbCAmJiBub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tjb250ZW50ZWRpdGFibGU9InRydWUiXScpLmZvckVhY2goZnVuY3Rpb24oZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgd29yZFBhc3RlSGFuZGxlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIGZ1bmN0aW9uKCkgeyB3aW5kb3cuX2xhc3RGb2N1c2VkRWRpdG9yID0gZWw7IH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgd2luZG93Ll93b3JkUGFzdGVPYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwogICAgfQoKICAgIDwvc2NyaXB0PgoKICAgIDwhLS0gTW9kYWwgUHJvY8OpZHVyZSAtLT4KICAgIDxkaXYgaWQ9InByb2NNb2QiIGNsYXNzPSJtLW92IiBzdHlsZT0iZGlzcGxheTpub25lO2xlZnQ6MjgwcHgiIG9uY2xpY2s9ImlmKGV2ZW50LnRhcmdldD09PXRoaXMpY2xvc2VQcm9jTW9kYWwoKSI+CiAgICAgICAgPGRpdiBjbGFzcz0ibS1ib3giIHN0eWxlPSJ3aWR0aDpjYWxjKDEwMHZ3IC0gMjgwcHgpO21heC13aWR0aDpjYWxjKDEwMHZ3IC0gMjgwcHgpO2hlaWdodDoxMDB2aDttYXgtaGVpZ2h0OjEwMHZoO2JvcmRlci1yYWRpdXM6MDtwYWRkaW5nOjIwcHggMjhweDtib3gtc2l6aW5nOmJvcmRlci1ib3g7bWFyZ2luLWxlZnQ6YXV0byI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im0taGVhZCI+PGgzIGlkPSJwcm9jTW9kLXRpdGxlIj5Ob3V2ZWxsZSBwcm9jw6lkdXJlPC9oMz48YnV0dG9uIGNsYXNzPSJtLWNscyIgb25jbGljaz0id2luZG93LmNsb3NlUHJvY01vZGFsKCkiPiZ0aW1lczs8L2J1dHRvbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibS1ib2R5IiBzdHlsZT0ibWF4LWhlaWdodDo3OHZoO292ZXJmbG93LXk6YXV0byI+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjE0cHg7bWFyZ2luLWJvdHRvbToxNnB4O2JhY2tncm91bmQ6I2Y4ZjlmYTtwYWRkaW5nOjE2cHg7Ym9yZGVyLXJhZGl1czoxMHB4O2JvcmRlcjoxcHggc29saWQgI2VlZSI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDowIDAgMTEwcHgiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImRpc3BsYXk6YmxvY2s7Zm9udC1zaXplOi43cmVtO2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojODg4O3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTtsZXR0ZXItc3BhY2luZzouNXB4O21hcmdpbi1ib3R0b206NnB4Ij5Db2RlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJwcm9jLWNvZGUiIHBsYWNlaG9sZGVyPSJBIDEiIG1heGxlbmd0aD0iMTAiIG9uaW5wdXQ9ImF1dG9Qcm9jQ2F0KHRoaXMudmFsdWUpIiBzdHlsZT0id2lkdGg6MTAwJTtwYWRkaW5nOjEwcHggMTJweDtib3JkZXI6MnB4IHNvbGlkICNlMGUwZTA7Ym9yZGVyLXJhZGl1czo4cHg7Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NzAwO3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTt0ZXh0LWFsaWduOmNlbnRlcjtiYWNrZ3JvdW5kOiNmZmY7dHJhbnNpdGlvbjpib3JkZXItY29sb3IgLjJzO291dGxpbmU6bm9uZTtib3gtc2l6aW5nOmJvcmRlci1ib3giIG9uZm9jdXM9InRoaXMuc3R5bGUuYm9yZGVyQ29sb3I9J3ZhcigtLWhlYWRlciwjMmMzZTUwKSciIG9uYmx1cj0idGhpcy5zdHlsZS5ib3JkZXJDb2xvcj0nI2UwZTBlMCciPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZsZXg6MSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZGlzcGxheTpibG9jaztmb250LXNpemU6LjdyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiM4ODg7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO2xldHRlci1zcGFjaW5nOi41cHg7bWFyZ2luLWJvdHRvbTo2cHgiPlRpdHJlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJwcm9jLXRpdGxlIiBwbGFjZWhvbGRlcj0iVGl0cmUgZGUgbGEgcHJvY8OpZHVyZSIgc3R5bGU9IndpZHRoOjEwMCU7cGFkZGluZzoxMHB4IDEycHg7Ym9yZGVyOjJweCBzb2xpZCAjZTBlMGUwO2JvcmRlci1yYWRpdXM6OHB4O2ZvbnQtc2l6ZTouOTVyZW07YmFja2dyb3VuZDojZmZmO3RyYW5zaXRpb246Ym9yZGVyLWNvbG9yIC4ycztvdXRsaW5lOm5vbmU7Ym94LXNpemluZzpib3JkZXItYm94IiBvbmZvY3VzPSJ0aGlzLnN0eWxlLmJvcmRlckNvbG9yPSd2YXIoLS1oZWFkZXIsIzJjM2U1MCknIiBvbmJsdXI9InRoaXMuc3R5bGUuYm9yZGVyQ29sb3I9JyNlMGUwZTAnIj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmbGV4OjAgMCAyMjBweCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZGlzcGxheTpibG9jaztmb250LXNpemU6LjdyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiM4ODg7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO2xldHRlci1zcGFjaW5nOi41cHg7bWFyZ2luLWJvdHRvbTo2cHgiPkNhdMOpZ29yaWU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9InByb2MtY2F0IiBzdHlsZT0id2lkdGg6MTAwJTtwYWRkaW5nOjEwcHggMTJweDtib3JkZXI6MnB4IHNvbGlkICNlMGUwZTA7Ym9yZGVyLXJhZGl1czo4cHg7Zm9udC1zaXplOi44OHJlbTtiYWNrZ3JvdW5kOiNmZmY7Y3Vyc29yOnBvaW50ZXI7b3V0bGluZTpub25lO3RyYW5zaXRpb246Ym9yZGVyLWNvbG9yIC4yczthcHBlYXJhbmNlOmF1dG87Ym94LXNpemluZzpib3JkZXItYm94IiBvbmNoYW5nZT0iaWYodGhpcy52YWx1ZT09PSdfX25ld19fJyl7dmFyIG49cHJvbXB0KCdOb3V2ZWxsZSBjYXTDqWdvcmllIDonKTtpZihuKXt2YXIgbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtvLnZhbHVlPW47by50ZXh0PW47dGhpcy5pbnNlcnRCZWZvcmUobyx0aGlzLmxhc3RDaGlsZCk7dGhpcy52YWx1ZT1uO31lbHNle3RoaXMudmFsdWU9Jyc7fX0iPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPuKAlCBDaG9pc2lyIOKAlDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IkFkbWluaXN0cmF0aWYiPkFkbWluaXN0cmF0aWY8L29wdGlvbj48b3B0aW9uIHZhbHVlPSLDiWzDqHZlcyBCRVAiPsOJbMOodmVzIEJFUDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IkNvbmNlcnRhdGlvbnMiPkNvbmNlcnRhdGlvbnM8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJEaXNwb3NpdGlmcyBQw6lkYWdvZ2lxdWVzIj5EaXNwb3NpdGlmcyBQw6lkYWdvZ2lxdWVzPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iU3VpdmkgZGVzIMOpbMOodmVzIj5TdWl2aSBkZXMgw6lsw6h2ZXM8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJJbnRlcnZlbmFudHMiPkludGVydmVuYW50czwvb3B0aW9uPjxvcHRpb24gdmFsdWU9Ik51bcOpcmlxdWUiPk51bcOpcmlxdWU8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJPcmllbnRhdGlvbiI+T3JpZW50YXRpb248L29wdGlvbj48b3B0aW9uIHZhbHVlPSJQcm9qZXRzIj5Qcm9qZXRzPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iUG9ydGVzIE91dmVydGVzIj5Qb3J0ZXMgT3V2ZXJ0ZXM8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJSZXNzb3VyY2VzIEh1bWFpbmVzIj5SZXNzb3VyY2VzIEh1bWFpbmVzPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iU8OpY3VyaXTDqSI+U8OpY3VyaXTDqTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9Il9fbmV3X18iPisgTm91dmVsbGUgY2F0w6lnb3JpZeKApjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjE0cHg7bWFyZ2luLWJvdHRvbToxNnB4O2JhY2tncm91bmQ6I2Y4ZjlmYTtwYWRkaW5nOjEycHggMTZweDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjFweCBzb2xpZCAjZWVlO2FsaWduLWl0ZW1zOmNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0id2lkdGg6ODBweDtmbGV4LXNocmluazowIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJkaXNwbGF5OmJsb2NrO2ZvbnQtc2l6ZTouN3JlbTtmb250LXdlaWdodDo2MDA7Y29sb3I6Izg4ODt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7bGV0dGVyLXNwYWNpbmc6LjVweDttYXJnaW4tYm90dG9tOjZweCI+U2VtLiBkw6lidXQ8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0icHJvYy13cyIgbWluPSIxIiBtYXg9IjUzIiBzdHlsZT0id2lkdGg6ODBweDtwYWRkaW5nOjhweCA2cHg7Ym9yZGVyOjJweCBzb2xpZCAjZTBlMGUwO2JvcmRlci1yYWRpdXM6OHB4O2ZvbnQtc2l6ZTouOXJlbTt0ZXh0LWFsaWduOmNlbnRlcjtib3gtc2l6aW5nOmJvcmRlci1ib3giPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOjgwcHg7ZmxleC1zaHJpbms6MCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZGlzcGxheTpibG9jaztmb250LXNpemU6LjdyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiM4ODg7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO2xldHRlci1zcGFjaW5nOi41cHg7bWFyZ2luLWJvdHRvbTo2cHgiPlNlbS4gZmluPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9InByb2Mtd2UiIG1pbj0iMSIgbWF4PSI1MyIgc3R5bGU9IndpZHRoOjgwcHg7cGFkZGluZzo4cHggNnB4O2JvcmRlcjoycHggc29saWQgI2UwZTBlMDtib3JkZXItcmFkaXVzOjhweDtmb250LXNpemU6LjlyZW07dGV4dC1hbGlnbjpjZW50ZXI7Ym94LXNpemluZzpib3JkZXItYm94Ij4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo2cHg7cGFkZGluZy10b3A6MTRweCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InByb2MtYW5uZWUiIHN0eWxlPSJ3aWR0aDoxOHB4O2hlaWdodDoxOHB4O2N1cnNvcjpwb2ludGVyIiBvbmNoYW5nZT0idmFyIGQ9dGhpcy5jaGVja2VkO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXdzJykuZGlzYWJsZWQ9ZDtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLmRpc2FibGVkPWQ7aWYoZCl7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd3MnKS52YWx1ZT0nJztkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvYy13ZScpLnZhbHVlPScnO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXdzJykuc3R5bGUub3BhY2l0eT0nLjQnO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXdlJykuc3R5bGUub3BhY2l0eT0nLjQnO31lbHNle2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9jLXdzJykuc3R5bGUub3BhY2l0eT0nMSc7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2Mtd2UnKS5zdHlsZS5vcGFjaXR5PScxJzt9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icHJvYy1hbm5lZSIgc3R5bGU9Im1hcmdpbjowO2N1cnNvcjpwb2ludGVyO2ZvbnQtc2l6ZTouOHJlbTtmb250LXdlaWdodDo2MDA7Y29sb3I6IzU1NTt3aGl0ZS1zcGFjZTpub3dyYXAiPsOAIGwnYW5uw6llPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjhweCI+PGxhYmVsIHN0eWxlPSJkaXNwbGF5OmJsb2NrO2ZvbnQtc2l6ZTouODJyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOiM1NTU7bWFyZ2luLWJvdHRvbTo2cHgiPkFjdGlvbnMgLyDDiXRhcGVzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJydGUtYmFyIj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2JvbGQnKSIgdGl0bGU9IkdyYXMiPjxiPkc8L2I+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpdGFsaWMnKSIgdGl0bGU9Ikl0YWxpcXVlIj48aT5JPC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgndW5kZXJsaW5lJykiIHRpdGxlPSJTb3VsaWduw6kiPjx1PlM8L3U+PC9idXR0b24+PHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFVub3JkZXJlZExpc3QnKSIgdGl0bGU9IlB1Y2VzIj48aSBjbGFzcz0iZmFzIGZhLWxpc3QtdWwiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydE9yZGVyZWRMaXN0JykiIHRpdGxlPSJOdW3DqXJvdMOpZSI+PGkgY2xhc3M9ImZhcyBmYS1saXN0LW9sIj48L2k+PC9idXR0b24+PHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icHJvY0luc2VydEljb24oJ21haWwnKSIgdGl0bGU9Ik1haWwiPjxzcGFuIGNsYXNzPSJwcm9jLWljb24tbWFpbCI+PGkgY2xhc3M9ImZhcyBmYS1lbnZlbG9wZSI+PC9pPjwvc3Bhbj48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icHJvY0luc2VydEljb24oJ2FsZXJ0JykiIHRpdGxlPSJBbGVydGUiPjxzcGFuIGNsYXNzPSJwcm9jLWljb24tYWxlcnQiPjxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24iPjwvaT48L3NwYW4+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InByb2NJbnNlcnRJY29uKCdpZGVhJykiIHRpdGxlPSJJZMOpZSI+PHNwYW4gY2xhc3M9InByb2MtaWNvbi1pZGVhIj48aSBjbGFzcz0iZmFzIGZhLWxpZ2h0YnVsYiI+PC9pPjwvc3Bhbj48L2J1dHRvbj48c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJydGVDb2xvcih0aGlzKSIgdGl0bGU9IkNvdWxldXIiPjxpIGNsYXNzPSJmYXMgZmEtcGFsZXR0ZSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgndW5kbycpIiB0aXRsZT0iQW5udWxlciI+PGkgY2xhc3M9ImZhcyBmYS11bmRvIj48L2k+PC9idXR0b24+PHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlSW1nUmVzaXplKCdzbWFsbCcpIiB0aXRsZT0iSW1hZ2UgMjUlIj4mI3gxRjVCQztTPC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUltZ1Jlc2l6ZSgnbWVkaXVtJykiIHRpdGxlPSJJbWFnZSA1MCUiPiYjeDFGNUJDO008L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlSW1nUmVzaXplKCdsYXJnZScpIiB0aXRsZT0iSW1hZ2UgNzUlIj4mI3gxRjVCQztMPC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUltZ1Jlc2l6ZSgnZnVsbCcpIiB0aXRsZT0iSW1hZ2UgMTAwJSI+JiN4MUY1QkM7RjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5TGVmdCcpIiB0aXRsZT0iQWxpZ25lciDDoCBnYXVjaGUiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tbGVmdCI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUNlbnRlcicpIiB0aXRsZT0iQ2VudHJlciI+PGkgY2xhc3M9ImZhcyBmYS1hbGlnbi1jZW50ZXIiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlGdWxsJykiIHRpdGxlPSJKdXN0aWZpZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tanVzdGlmeSI+PC9pPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwYXN0ZUZyb21Xb3JkKCkiIHRpdGxlPSJDb2xsZXIgZGVwdWlzIFdvcmQgZW4gY29uc2VydmFudCBsYSBtaXNlIGVuIHBhZ2UiIHN0eWxlPSJtYXJnaW4tbGVmdDo2cHg7YmFja2dyb3VuZDojMmI1NzlhO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NHB4O3BhZGRpbmc6MnB4IDhweDtmb250LXNpemU6LjY4cmVtO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OmluaGVyaXQ7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7Ij48aSBjbGFzcz0iZmFzIGZhLWZpbGUtd29yZCI+PC9pPsKgV29yZDwvYnV0dG9uPgo8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJwcm9jLXoyIiBjbGFzcz0icnRlLWJvZHkiIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgc3R5bGU9Im1pbi1oZWlnaHQ6MTIwcHg7Ym9yZGVyOjJweCBzb2xpZCAjZTBlMGUwO2JvcmRlci1yYWRpdXM6MCAwIDhweCA4cHg7cGFkZGluZzoxMHB4Ij48L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbTo4cHgiPjxsYWJlbCBzdHlsZT0iZGlzcGxheTpibG9jaztmb250LXNpemU6LjgycmVtO2ZvbnQtd2VpZ2h0OjYwMDtjb2xvcjojNTU1O21hcmdpbi1ib3R0b206NnB4Ij5Ob3RlcyAvIFJlbWFycXVlczwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icnRlLWJhciI+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdib2xkJykiIHRpdGxlPSJHcmFzIj48Yj5HPC9iPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnaXRhbGljJykiIHRpdGxlPSJJdGFsaXF1ZSI+PGk+STwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VuZGVybGluZScpIiB0aXRsZT0iU291bGlnbsOpIj48dT5TPC91PjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRVbm9yZGVyZWRMaXN0JykiIHRpdGxlPSJQdWNlcyI+PGkgY2xhc3M9ImZhcyBmYS1saXN0LXVsIj48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRPcmRlcmVkTGlzdCcpIiB0aXRsZT0iTnVtw6lyb3TDqWUiPjxpIGNsYXNzPSJmYXMgZmEtbGlzdC1vbCI+PC9pPjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InByb2NJbnNlcnRJY29uKCdtYWlsJykiIHRpdGxlPSJNYWlsIj48c3BhbiBjbGFzcz0icHJvYy1pY29uLW1haWwiPjxpIGNsYXNzPSJmYXMgZmEtZW52ZWxvcGUiPjwvaT48L3NwYW4+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InByb2NJbnNlcnRJY29uKCdhbGVydCcpIiB0aXRsZT0iQWxlcnRlIj48c3BhbiBjbGFzcz0icHJvYy1pY29uLWFsZXJ0Ij48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uIj48L2k+PC9zcGFuPjwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwcm9jSW5zZXJ0SWNvbignaWRlYScpIiB0aXRsZT0iSWTDqWUiPjxzcGFuIGNsYXNzPSJwcm9jLWljb24taWRlYSI+PGkgY2xhc3M9ImZhcyBmYS1saWdodGJ1bGIiPjwvaT48L3NwYW4+PC9idXR0b24+PHNwYW4gY2xhc3M9InJ0ZS1zZXAiPjwvc3Bhbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnRlQ29sb3IodGhpcykiIHRpdGxlPSJDb3VsZXVyIj48aSBjbGFzcz0iZmFzIGZhLXBhbGV0dGUiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VuZG8nKSIgdGl0bGU9IkFubnVsZXIiPjxpIGNsYXNzPSJmYXMgZmEtdW5kbyI+PC9pPjwvYnV0dG9uPjxzcGFuIGNsYXNzPSJydGUtc2VwIj48L3NwYW4+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUltZ1Jlc2l6ZSgnc21hbGwnKSIgdGl0bGU9IkltYWdlIDI1JSI+JiN4MUY1QkM7UzwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJydGVJbWdSZXNpemUoJ21lZGl1bScpIiB0aXRsZT0iSW1hZ2UgNTAlIj4mI3gxRjVCQztNPC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ0ZUltZ1Jlc2l6ZSgnbGFyZ2UnKSIgdGl0bGU9IkltYWdlIDc1JSI+JiN4MUY1QkM7TDwvYnV0dG9uPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJydGVJbWdSZXNpemUoJ2Z1bGwnKSIgdGl0bGU9IkltYWdlIDEwMCUiPiYjeDFGNUJDO0Y8L2J1dHRvbj48c3BhbiBjbGFzcz0icnRlLXNlcCI+PC9zcGFuPjxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkb2N1bWVudC5leGVjQ29tbWFuZCgnanVzdGlmeUxlZnQnKSIgdGl0bGU9IkFsaWduZXIgw6AgZ2F1Y2hlIj48aSBjbGFzcz0iZmFzIGZhLWFsaWduLWxlZnQiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2p1c3RpZnlDZW50ZXInKSIgdGl0bGU9IkNlbnRyZXIiPjxpIGNsYXNzPSJmYXMgZmEtYWxpZ24tY2VudGVyIj48L2k+PC9idXR0b24+PGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRvY3VtZW50LmV4ZWNDb21tYW5kKCdqdXN0aWZ5RnVsbCcpIiB0aXRsZT0iSnVzdGlmaWVyIj48aSBjbGFzcz0iZmFzIGZhLWFsaWduLWp1c3RpZnkiPjwvaT48L2J1dHRvbj48YnV0dG9uIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icGFzdGVGcm9tV29yZCgpIiB0aXRsZT0iQ29sbGVyIGRlcHVpcyBXb3JkIGVuIGNvbnNlcnZhbnQgbGEgbWlzZSBlbiBwYWdlIiBzdHlsZT0ibWFyZ2luLWxlZnQ6NnB4O2JhY2tncm91bmQ6IzJiNTc5YTtjb2xvcjp3aGl0ZTtib3JkZXItcmFkaXVzOjRweDtwYWRkaW5nOjJweCA4cHg7Zm9udC1zaXplOi42OHJlbTtib3JkZXI6bm9uZTtjdXJzb3I6cG9pbnRlcjtmb250LWZhbWlseTppbmhlcml0O2Rpc3BsYXk6aW5saW5lLWZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDozcHg7dmVydGljYWwtYWxpZ246bWlkZGxlOyI+PGkgY2xhc3M9ImZhcyBmYS1maWxlLXdvcmQiPjwvaT7CoFdvcmQ8L2J1dHRvbj4KPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0icHJvYy16MyIgY2xhc3M9InJ0ZS1ib2R5IiBjb250ZW50ZWRpdGFibGU9InRydWUiIHN0eWxlPSJtaW4taGVpZ2h0OjEyMHB4O2JvcmRlcjoycHggc29saWQgI2UwZTBlMDtib3JkZXItcmFkaXVzOjAgMCA4cHggOHB4O3BhZGRpbmc6MTBweCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im0tYWN0cyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgaWQ9InByb2MtZGVsLWJ0biIgY2xhc3M9Im1iIiBzdHlsZT0iYmFja2dyb3VuZDojZTc0YzNjO2NvbG9yOiNmZmY7ZGlzcGxheTpub25lIiBvbmNsaWNrPSJ3aW5kb3cuZGVsUHJvYygpIj48aSBjbGFzcz0iZmFzIGZhLXRyYXNoIj48L2k+IFN1cHByaW1lcjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJtYiBtYi1jIiBvbmNsaWNrPSJ3aW5kb3cuY2xvc2VQcm9jTW9kYWwoKSI+QW5udWxlcjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJtYiBtYi1vayIgb25jbGljaz0id2luZG93LnNhdmVQcm9jKCkiPjxpIGNsYXNzPSJmYXMgZmEtY2hlY2siPjwvaT4gRW5yZWdpc3RyZXI8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCgo8L2JvZHk+CjwvaHRtbD4=", "exam": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImZyIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+UEVSRElSRk9STUFOQ0UgRE5CIEJMQU5DIEVDUklUIFYxMSAtIEdlc3Rpb24gQ29tcGzDqHRlPC90aXRsZT4KICAgIAogICAgPCEtLSBSZWFjdCAmIFJlYWN0RE9NIC0tPgogICAgPHNjcmlwdCBjcm9zc29yaWdpbiBzcmM9Imh0dHBzOi8vdW5wa2cuY29tL3JlYWN0QDE4L3VtZC9yZWFjdC5kZXZlbG9wbWVudC5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IGNyb3Nzb3JpZ2luIHNyYz0iaHR0cHM6Ly91bnBrZy5jb20vcmVhY3QtZG9tQDE4L3VtZC9yZWFjdC1kb20uZGV2ZWxvcG1lbnQuanMiPjwvc2NyaXB0PgogICAgCiAgICA8IS0tIEJhYmVsIGZvciBKU1ggLS0+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly91bnBrZy5jb20vQGJhYmVsL3N0YW5kYWxvbmUvYmFiZWwubWluLmpzIj48L3NjcmlwdD4KICAgIAogICAgPCEtLSBUYWlsd2luZCBDU1MgLS0+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48L3NjcmlwdD4KICAgIDxzY3JpcHQ+CiAgICAgICAgdGFpbHdpbmQuY29uZmlnID0gewogICAgICAgICAgICB0aGVtZTogewogICAgICAgICAgICAgICAgZXh0ZW5kOiB7CiAgICAgICAgICAgICAgICAgICAgY29sb3JzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnk6ICcjMGVhNWU5JywgLy8gU2t5IDUwMAogICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5RGFyazogJyMwMjg0YzcnLCAvLyBTa3kgNjAwCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZGFyeTogJyNmOTczMTYnLCAvLyBPcmFuZ2UgNTAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgPC9zY3JpcHQ+CiAgICAKICAgIDwhLS0gTGlicmFyaWVzIGZvciBFeGNlbCBhbmQgUERGIC0tPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLnNoZWV0anMuY29tL3hsc3gtMC4yMC4xL3BhY2thZ2UvZGlzdC94bHN4LmZ1bGwubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9qc3BkZi8yLjUuMS9qc3BkZi51bWQubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9qc3BkZi1hdXRvdGFibGUvMy41LjMxL2pzcGRmLnBsdWdpbi5hdXRvdGFibGUubWluLmpzIj48L3NjcmlwdD4KICAgIAogICAgPHN0eWxlPgogICAgICAgIEBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PU91dGZpdDp3Z2h0QDMwMDs0MDA7NTAwOzYwMCZkaXNwbGF5PXN3YXAnKTsKICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6ICdPdXRmaXQnLCBzYW5zLXNlcmlmOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBmOWZmOyB9IC8qIEZvbmQgdHLDqHMgbMOpZ2VyIGJsZXUgKi8KICAgICAgICAKICAgICAgICAvKiBDdXN0b20gU2Nyb2xsYmFyICovCiAgICAgICAgOjotd2Via2l0LXNjcm9sbGJhciB7IHdpZHRoOiA4cHg7IGhlaWdodDogOHB4OyB9CiAgICAgICAgOjotd2Via2l0LXNjcm9sbGJhci10cmFjayB7IGJhY2tncm91bmQ6ICNmMGY5ZmY7IH0KICAgICAgICA6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsgYmFja2dyb3VuZDogI2JhZTZmZDsgYm9yZGVyLXJhZGl1czogNHB4OyB9CiAgICAgICAgOjotd2Via2l0LXNjcm9sbGJhci10aHVtYjpob3ZlciB7IGJhY2tncm91bmQ6ICM3ZGQzZmM7IH0KCiAgICAgICAgLmFuaW1hdGUtZmFkZS1pbiB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFkZUluIDAuM3MgZWFzZS1vdXQ7CiAgICAgICAgfQogICAgICAgIEBrZXlmcmFtZXMgZmFkZUluIHsKICAgICAgICAgICAgZnJvbSB7IG9wYWNpdHk6IDA7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgxMHB4KTsgfQogICAgICAgICAgICB0byB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsgfQogICAgICAgIH0KCiAgICAgICAgLyogRHJhZyAmIERyb3AgU3R5bGVzICovCiAgICAgICAgLmRyYWdnYWJsZS1pdGVtIHsKICAgICAgICAgICAgY3Vyc29yOiBncmFiOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4xNXMgZWFzZTsKICAgICAgICB9CiAgICAgICAgLmRyYWdnYWJsZS1pdGVtOmFjdGl2ZSB7CiAgICAgICAgICAgIGN1cnNvcjogZ3JhYmJpbmc7CiAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMS4wMik7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMTBweCAxNXB4IC0zcHggcmdiYSgwLCAwLCAwLCAwLjEpOwogICAgICAgIH0KICAgICAgICAuZHJvcC16b25lIHsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsKICAgICAgICB9CiAgICAgICAgLmRyb3Atem9uZS5kcmFnLW92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZTBmMmZlOyAvKiBTa3kgMTAwICovCiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogIzBlYTVlOTsKICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjAxKTsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGRpdiBpZD0icm9vdCI+PC9kaXY+CgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2JhYmVsIj4KICAgICAgICBjb25zdCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVJlZiB9ID0gUmVhY3Q7CgogICAgICAgIC8vIC0tLSBDT05TVEFOVEVTIFBBUiBEw4lGQVVUIC0tLQogICAgICAgIGNvbnN0IEFQUF9WRVJTSU9OID0gIjExLjAiOwogICAgICAgIGNvbnN0IFNUT1JBR0VfS0VZX1YxMSA9ICdQRVJESVJGT1JNQU5DRV9ETkJfREFUQV9WMTEnOwogICAgICAgIGNvbnN0IFNUT1JBR0VfS0VZX1YxMCA9ICdQRVJESVJGT1JNQU5DRV9ETkJfREFUQV9WMTAnOyAvLyBQb3VyIG1pZ3JhdGlvbgoKICAgICAgICBjb25zdCBERUZBVUxUX1NVQkpFQ1RTID0gWwogICAgICAgICAgICB7IGlkOiAxLCBuYW1lOiAiTWF0aMOpbWF0aXF1ZXMiLCBkYXRlOiAiTHVuZGkgMzAgSnVpbiAyMDI1IiwgdGltZTogIjE0OjMwIC0gMTY6MzAiLCB0aW1lVFQ6ICIxNDozMCAtIDE3OjEwIiB9LAogICAgICAgICAgICB7IGlkOiAyLCBuYW1lOiAiRnJhbsOnYWlzIiwgZGF0ZTogIkx1bmRpIDMwIEp1aW4gMjAyNSIsIHRpbWU6ICIwOTowMCAtIDEyOjE1IiwgdGltZVRUOiAiMDk6MDAgLSAxMzoyMCIgfSwKICAgICAgICAgICAgeyBpZDogMywgbmFtZTogIkhpc3RvaXJlLUfDqW8gRU1DIiwgZGF0ZTogIk1hcmRpIDAxIEp1aWxsZXQgMjAyNSIsIHRpbWU6ICIwOTowMCAtIDExOjAwIiwgdGltZVRUOiAiMDk6MDAgLSAxMTo0MCIgfSwKICAgICAgICAgICAgeyBpZDogNCwgbmFtZTogIlNjaWVuY2VzIiwgZGF0ZTogIk1hcmRpIDAxIEp1aWxsZXQgMjAyNSIsIHRpbWU6ICIxMzozMCAtIDE0OjMwIiwgdGltZVRUOiAiMTM6MzAgLSAxNDo1MCIsIGRpc2NpcGxpbmVzOiBbXSB9CiAgICAgICAgXTsKCiAgICAgICAgY29uc3QgREVGQVVMVF9TQ0hPT0xfQ09ORklHID0gewogICAgICAgICAgICBuYW1lOiAiQ29sbMOoZ2UgTGFtYmRhIiwKICAgICAgICAgICAgY2l0eTogIkJhc3NlLVRlcnJlIiwKICAgICAgICAgICAgcHJpbmNpcGFsOiAiTS4gTGUgUHJpbmNpcGFsIiwKICAgICAgICAgICAgbG9nb1VybDogbnVsbCwKICAgICAgICAgICAgbG9nb1JhdGlvOiAxLCAvLyBSYXRpbyBXaWR0aC9IZWlnaHQgcGFyIGTDqWZhdXQKICAgICAgICAgICAgc3RhbXBVcmw6IG51bGwsCiAgICAgICAgICAgIHN0YW1wUmF0aW86IDEsCiAgICAgICAgICAgIHNlc3Npb25OYW1lOiAiRE5CIEJsYW5jIE7CsDEiCiAgICAgICAgfTsKCiAgICAgICAgLy8gLS0tIE1PRMOITEVTIERFIERPQ1VNRU5UUyBQQVIgRMOJRkFVVCAoVjEwL1YxMSkgLS0tCiAgICAgICAgY29uc3QgREVGQVVMVF9ET0NfVEVNUExBVEVTID0gewogICAgICAgICAgICBzdHVkZW50OiB7CiAgICAgICAgICAgICAgICB0aXRsZTogIkNPTlZPQ0FUSU9OIiwKICAgICAgICAgICAgICAgIHN1YnRpdGxlOiAiRElQTMOUTUUgTkFUSU9OQUwgRFUgQlJFVkVUIiwKICAgICAgICAgICAgICAgIGludHJvOiAiVm91cyDDqnRlcyBjb252b3F1w6koZSkgcG91ciBwYXNzZXIgbGVzIMOpcHJldXZlcyDDqWNyaXRlcyBkdSBEaXBsw7RtZSBOYXRpb25hbCBkdSBCcmV2ZXQgKFNlc3Npb24gQmxhbmNoZSkgYXV4IGhvcmFpcmVzIGluZGlxdcOpcyBjaS1kZXNzb3VzIDoiLAogICAgICAgICAgICAgICAgY29uc2lnbmVzOiAiLSBWZXVpbGxleiB2b3VzIHByw6lzZW50ZXIgMTUgbWludXRlcyBhdmFudCBsZSBkw6lidXQgZGUgY2hhcXVlIMOpcHJldXZlLlxuLSBVbmUgcGnDqGNlIGQnaWRlbnRpdMOpIGF2ZWMgcGhvdG8gZXN0IG9ibGlnYXRvaXJlIHBvdXIgbCdhY2PDqHMgZW4gc2FsbGUuXG4tIExlcyB0w6lsw6lwaG9uZXMgcG9ydGFibGVzIGV0IG1vbnRyZXMgY29ubmVjdMOpZXMgc29udCBzdHJpY3RlbWVudCBpbnRlcmRpdHMuXG4tIExlIG1hdMOpcmllbCAoc3R5bG9zLCByw6hnbGUsIGNhbGN1bGF0cmljZSBtb2RlIGV4YW1lbikgZXN0IHNvdXMgbGEgcmVzcG9uc2FiaWxpdMOpIGR1IGNhbmRpZGF0LiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VydmVpbGxhbnQ6IHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiQ09OVk9DQVRJT04gREUgU1VSVkVJTExBTkNFIiwKICAgICAgICAgICAgICAgIHN1YnRpdGxlOiAiRElQTMOUTUUgTkFUSU9OQUwgRFUgQlJFVkVUIiwKICAgICAgICAgICAgICAgIGludHJvOiAiVm91cyDDqnRlcyBjb252b3F1w6koZSkgcG91ciBhc3N1cmVyIGxhIHN1cnZlaWxsYW5jZSBkZXMgw6lwcmV1dmVzIGRlIGxhIHNlc3Npb24uIiwKICAgICAgICAgICAgICAgIGNvbnNpZ25lczogIi0gTWVyY2kgZGUgdm91cyBwcsOpc2VudGVyIGVuIHNhbGxlIDE1IG1pbnV0ZXMgYXZhbnQgbGUgZMOpYnV0IGRlIHZvdHJlIGNyw6luZWF1LlxuLSBWw6lyaWZpZXIgbCdpZGVudGl0w6kgZGVzIGNhbmRpZGF0cyBldCBzJ2Fzc3VyZXIgZHUgYm9uIHBsYWNlbWVudC5cbi0gRmFpcmUgw6ltYXJnZXIgbGVzIGNhbmRpZGF0cyBwcsOpc2VudHMgKHbDqXJpZmllciBsZXMgVGllcnMgVGVtcHMpLlxuLSBBdWN1bmUgc29ydGllIGRlIGNhbmRpZGF0IGF1dG9yaXPDqWUgYXZhbnQgbGEgcHJlbWnDqHJlIGhldXJlIGQnw6lwcmV1dmUuIgogICAgICAgICAgICB9LAogICAgICAgICAgICBhZXNoOiB7CiAgICAgICAgICAgICAgICB0aXRsZTogIkNPTlZPQ0FUSU9OIEFDQ09NUEFHTkFOVCAoQUVTSCkiLAogICAgICAgICAgICAgICAgc3VidGl0bGU6ICJESVBMw5RNRSBOQVRJT05BTCBEVSBCUkVWRVQiLAogICAgICAgICAgICAgICAgaW50cm86ICJWb3VzIMOqdGVzIGNvbnZvcXXDqShlKSBwb3VyIGwnYWNjb21wYWduZW1lbnQgZGVzIMOpbMOodmVzIHN1aXZhbnRzLiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2VjcmV0YXJpYXQ6IHsKICAgICAgICAgICAgICAgIHRpdGxlOiAiT1JEUkUgREUgTUlTU0lPTiAtIFNFQ1LDiVRBUklBVCIsCiAgICAgICAgICAgICAgICBzdWJ0aXRsZTogIkRJUEzDlE1FIE5BVElPTkFMIERVIEJSRVZFVCIsCiAgICAgICAgICAgICAgICBpbnRybzogIlZvdXMgw6p0ZXMgZMOpc2lnbsOpKGUpIHBvdXIgYXNzdXJlciBsZSBzZWNyw6l0YXJpYXQgw6AgbCdpc3N1ZSBkZXMgw6lwcmV1dmVzIHN1aXZhbnRlcyA6IiwKICAgICAgICAgICAgICAgIG1pc3Npb25zOiAiLSBSw6ljZXB0aW9ubmVyIGV0IHbDqXJpZmllciBsZXMgcGFxdWV0cyBkZSBjb3BpZXMuXG4tIENvbnRyw7RsZXIgbGVzIGxpc3RlcyBkJ8OpbWFyZ2VtZW50LlxuLSBQcsOpcGFyZXIgbGVzIGxvdHMgcG91ciBsYSBjb3JyZWN0aW9uLiIKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8vIC0tLSBGT05DVElPTiBVVElMSVRBSVJFIDogQ0FMQ1VMIERFUyBUUkFOQ0hFUyBIT1JBSVJFUyAoMWggbWF4KSAtLS0KICAgICAgICBjb25zdCBjYWxjdWxhdGVUaW1lU2xvdHMgPSAodGltZVJhbmdlU3RyKSA9PiB7CiAgICAgICAgICAgIGlmICghdGltZVJhbmdlU3RyKSByZXR1cm4gW107CiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gdGltZVJhbmdlU3RyLnNwbGl0KCctJykubWFwKHMgPT4gcy50cmltKCkpOwogICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoICE9PSAyKSByZXR1cm4gW3sgc3RhcnQ6ICI/Pzo/PyIsIGVuZDogIj8/Oj8/IiwgbGFiZWw6IHRpbWVSYW5nZVN0ciB9XTsKCiAgICAgICAgICAgIGNvbnN0IFtzdGFydFN0ciwgZW5kU3RyXSA9IHBhcnRzOwoKICAgICAgICAgICAgY29uc3QgcGFyc2VUaW1lID0gKHQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IFtoLCBtXSA9IHQuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTsKICAgICAgICAgICAgICAgIHJldHVybiBoICogNjAgKyBtOwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZm9ybWF0VGltZSA9IChtaW51dGVzKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gTWF0aC5mbG9vcihtaW51dGVzIC8gNjApOwogICAgICAgICAgICAgICAgY29uc3QgbSA9IG1pbnV0ZXMgJSA2MDsKICAgICAgICAgICAgICAgIHJldHVybiBgJHtTdHJpbmcoaCkucGFkU3RhcnQoMiwgJzAnKX06JHtTdHJpbmcobSkucGFkU3RhcnQoMiwgJzAnKX1gOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgbGV0IGN1cnJlbnQgPSBwYXJzZVRpbWUoc3RhcnRTdHIpOwogICAgICAgICAgICBjb25zdCBlbmQgPSBwYXJzZVRpbWUoZW5kU3RyKTsKICAgICAgICAgICAgY29uc3Qgc2xvdHMgPSBbXTsKCiAgICAgICAgICAgIHdoaWxlIChjdXJyZW50IDwgZW5kKSB7CiAgICAgICAgICAgICAgICBsZXQgbmV4dCA9IGN1cnJlbnQgKyA2MDsKICAgICAgICAgICAgICAgIGlmIChuZXh0ID4gZW5kKSBuZXh0ID0gZW5kOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2xvdHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGZvcm1hdFRpbWUoY3VycmVudCksCiAgICAgICAgICAgICAgICAgICAgZW5kOiBmb3JtYXRUaW1lKG5leHQpLAogICAgICAgICAgICAgICAgICAgIGxhYmVsOiBgJHtmb3JtYXRUaW1lKGN1cnJlbnQpfSAtICR7Zm9ybWF0VGltZShuZXh0KX1gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBuZXh0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzbG90czsKICAgICAgICB9OwoKICAgICAgICAvLyAtLS0gTk9VVkVBVVggVVRJTElUQUlSRVMgUE9VUiBHRVNUSU9OIEhPUkFJUkUgVjEwL1YxMSAtLS0KICAgICAgICBjb25zdCBwYXJzZVRpbWVSYW5nZSA9IChyYW5nZVN0cikgPT4gewogICAgICAgICAgICBpZiAoIXJhbmdlU3RyIHx8ICFyYW5nZVN0ci5pbmNsdWRlcygnLScpKSByZXR1cm4geyBzdGFydDogIjA5OjAwIiwgZW5kOiAiMTA6MDAiIH07CiAgICAgICAgICAgIGNvbnN0IFtzdGFydCwgZW5kXSA9IHJhbmdlU3RyLnNwbGl0KCctJykubWFwKHMgPT4gcy50cmltKCkpOwogICAgICAgICAgICByZXR1cm4geyBzdGFydCwgZW5kIH07CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgdGltZVRvTWludXRlcyA9ICh0aW1lU3RyKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IFtoLCBtXSA9IHRpbWVTdHIuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTsKICAgICAgICAgICAgcmV0dXJuIGggKiA2MCArIG07CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgbWludXRlc1RvVGltZSA9IChtaW5zKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGggPSBNYXRoLmZsb29yKG1pbnMgLyA2MCkgJSAyNDsKICAgICAgICAgICAgY29uc3QgbSA9IE1hdGguZmxvb3IobWlucyAlIDYwKTsKICAgICAgICAgICAgcmV0dXJuIGAke1N0cmluZyhoKS5wYWRTdGFydCgyLCAnMCcpfToke1N0cmluZyhtKS5wYWRTdGFydCgyLCAnMCcpfWA7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgY2FsY3VsYXRlQXV0b1RUID0gKHN0YW5kYXJkU3RhcnQsIHN0YW5kYXJkRW5kKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aW1lVG9NaW51dGVzKHN0YW5kYXJkU3RhcnQpOwogICAgICAgICAgICBjb25zdCBlID0gdGltZVRvTWludXRlcyhzdGFuZGFyZEVuZCk7CiAgICAgICAgICAgIGxldCBkdXJhdGlvbiA9IGUgLSBzOwogICAgICAgICAgICBpZiAoZHVyYXRpb24gPCAwKSBkdXJhdGlvbiArPSAyNCAqIDYwOyAvLyBQYXNzYWdlIG1pbnVpdAogICAgICAgICAgICBjb25zdCB0dER1cmF0aW9uID0gTWF0aC5jZWlsKGR1cmF0aW9uICogNCAvIDMpOyAvLyArIDEvMwogICAgICAgICAgICBjb25zdCB0dEVuZCA9IHMgKyB0dER1cmF0aW9uOwogICAgICAgICAgICByZXR1cm4gYCR7c3RhbmRhcmRTdGFydH0gLSAke21pbnV0ZXNUb1RpbWUodHRFbmQpfWA7CiAgICAgICAgfTsKCiAgICAgICAgLy8gLS0tIE5PVVZFQVVYIFVUSUxJVEFJUkVTIFBPVVIgR0VTVElPTiBEQVRFIChDQUxFTkRSSUVSKSAtLS0KICAgICAgICAvLyBDb252ZXJ0aXQgIjIwMjUtMDYtMzAiIC0+ICJMdW5kaSAzMCBKdWluIDIwMjUiCiAgICAgICAgY29uc3QgZm9ybWF0RGF0ZVRvRnJlbmNoU3RyaW5nID0gKGlzb0RhdGUpID0+IHsKICAgICAgICAgICAgaWYgKCFpc29EYXRlKSByZXR1cm4gIiI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDT1JSRUNUSU9OIERVIETDiUNBTEFHRSBIT1JBSVJFIDoKICAgICAgICAgICAgLy8gQXUgbGlldSBkZSBuZXcgRGF0ZShpc29EYXRlKSBxdWkgcGV1dCBpbnRlcnByw6l0ZXIgZW4gVVRDIGV0IGTDqWNhbGVyLAogICAgICAgICAgICAvLyBvbiBkw6ljb21wb3NlIG1hbnVlbGxlbWVudCBwb3VyIGZvcmNlciBsYSBkYXRlIGxvY2FsZSBtaWRpIChwb3VyIMOpdml0ZXIgdG91dCBwcm9ibMOobWUgZCdoZXVyZSBkJ8OpdMOpL2hpdmVyKQogICAgICAgICAgICBjb25zdCBbeWVhciwgbW9udGgsIGRheV0gPSBpc29EYXRlLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgMTIsIDAsIDApOyAvLyBGb3JjZSBtaWRpIHBvdXIgw6p0cmUgc8O7ciBkZSByZXN0ZXIgbGUgYm9uIGpvdXIKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IHdlZWtkYXk6ICdsb25nJywgZGF5OiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIHllYXI6ICdudW1lcmljJyB9OwogICAgICAgICAgICAvLyBGb3JtYXRhZ2UgbmF0aWYKICAgICAgICAgICAgbGV0IHN0ciA9IGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicsIG9wdGlvbnMpOwogICAgICAgICAgICAvLyBDYXBpdGFsaXNhdGlvbiBkZXMgbW90cyAoTHVuZGksIEp1aW4pIHBvdXIgY29ycmVzcG9uZHJlIGF1IHN0eWxlIGV4aXN0YW50CiAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvXGJcdy9nLCBsID0+IGwudG9VcHBlckNhc2UoKSk7CiAgICAgICAgfTsKCiAgICAgICAgLy8gVGVudGUgZGUgY29udmVydGlyICJMdW5kaSAzMCBKdWluIDIwMjUiIC0+ICIyMDI1LTA2LTMwIiBwb3VyIGwnaW5wdXQgZGF0ZQogICAgICAgIGNvbnN0IHBhcnNlRnJlbmNoU3RyaW5nVG9Jc28gPSAoZGF0ZVN0cikgPT4gewogICAgICAgICAgICBpZiAoIWRhdGVTdHIpIHJldHVybiAiIjsKICAgICAgICAgICAgLy8gU2kgYydlc3QgZMOpasOgIHVuIGZvcm1hdCBJU08gKHZpZXV4IGJ1ZyBvdSBhdXRyZSksIG9uIGxlIHJlbnZvaWUKICAgICAgICAgICAgaWYgKGRhdGVTdHIubWF0Y2goL15cZHs0fS1cZHsyfS1cZHsyfSQvKSkgcmV0dXJuIGRhdGVTdHI7CgogICAgICAgICAgICBjb25zdCBtb250aHMgPSB7CiAgICAgICAgICAgICAgICAnamFudmllcic6ICcwMScsICdmw6l2cmllcic6ICcwMicsICdmZXZyaWVyJzogJzAyJywgJ21hcnMnOiAnMDMnLCAnYXZyaWwnOiAnMDQnLCAnbWFpJzogJzA1JywgJ2p1aW4nOiAnMDYnLAogICAgICAgICAgICAgICAgJ2p1aWxsZXQnOiAnMDcnLCAnYW/Du3QnOiAnMDgnLCAnYW91dCc6ICcwOCcsICdzZXB0ZW1icmUnOiAnMDknLCAnb2N0b2JyZSc6ICcxMCcsICdub3ZlbWJyZSc6ICcxMScsICdkw6ljZW1icmUnOiAnMTInLCAnZGVjZW1icmUnOiAnMTInCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gTmV0dG95YWdlIGV0IGTDqWNvdXBhZ2UgOiAiTHVuZGkgMzAgSnVpbiAyMDI1IiAtPiBbIkx1bmRpIiwgIjMwIiwgIkp1aW4iLCAiMjAyNSJdCiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGRhdGVTdHIudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8sL2csICcnKS5zcGxpdCgnICcpLmZpbHRlcihwID0+IHAudHJpbSgpICE9PSAnJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE9uIGNoZXJjaGUgbGUgam91ciAoY2hpZmZyZSksIGxlIG1vaXMgKHRleHRlKSBldCBsJ2FubsOpZSAoNCBjaGlmZnJlcykKICAgICAgICAgICAgICAgIGxldCBkYXkgPSBwYXJ0cy5maW5kKHAgPT4gcC5tYXRjaCgvXlxkezEsMn0kLykpOwogICAgICAgICAgICAgICAgbGV0IHllYXIgPSBwYXJ0cy5maW5kKHAgPT4gcC5tYXRjaCgvXlxkezR9JC8pKTsKICAgICAgICAgICAgICAgIGxldCBtb250aE5hbWUgPSBwYXJ0cy5maW5kKHAgPT4gbW9udGhzW3BdKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGRheSAmJiB5ZWFyICYmIG1vbnRoTmFtZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gbW9udGhzW21vbnRoTmFtZV07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGgucGFkU3RhcnQoMiwgJzAnKX0tJHtkYXkucGFkU3RhcnQoMiwgJzAnKX1gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7IC8vIMOJY2hlYyBzaWxlbmNpZXV4CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH07CgogICAgICAgIC8vIC0tLSBCSUJMSU9USMOIUVVFIEQnSUPDlE5FUyBJTlRFUk5FIChTVkcpIC0tLQogICAgICAgIGNvbnN0IEljb25CYXNlID0gKHsgY2hpbGRyZW4sIGNsYXNzTmFtZSA9ICIiIH0pID0+ICgKICAgICAgICAgICAgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlV2lkdGg9IjIiIHN0cm9rZUxpbmVjYXA9InJvdW5kIiBzdHJva2VMaW5lam9pbj0icm91bmQiIGNsYXNzTmFtZT17Y2xhc3NOYW1lfT4KICAgICAgICAgICAgICAgIHtjaGlsZHJlbn0KICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgKTsKCiAgICAgICAgY29uc3QgU2Nob29sID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJtNCA2IDgtNCA4IDQiIC8+PHBhdGggZD0ibTE4IDEwIDQgMnY4YTIgMiAwIDAgMS0yIDJINGEyIDIgMCAwIDEtMi0ydi04bDQtMiIgLz48cGF0aCBkPSJNMTQgMjJ2LTRhMiAyIDAgMCAwLTItMnYwYTIgMiAwIDAgMC0yIDJ2NCIgLz48cGF0aCBkPSJNMTggNXYxNyIgLz48cGF0aCBkPSJNNiA1djE3IiAvPjxjaXJjbGUgY3g9IjEyIiBjeT0iOSIgcj0iMiIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBVc2VycyA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTE2IDIxdi0yYTQgNCAwIDAgMC00LTRINmE0IDQgMCAwIDAtNCA0djIiIC8+PGNpcmNsZSBjeD0iOSIgY3k9IjciIHI9IjQiIC8+PHBhdGggZD0iTTIyIDIxdi0yYTQgNCAwIDAgMC0zLTMuODciIC8+PHBhdGggZD0iTTE2IDMuMTNhNCA0IDAgMCAxIDAgNy43NSIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBMYXlvdXREYXNoYm9hcmQgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjkiIHg9IjMiIHk9IjMiIHJ4PSIxIiAvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjUiIHg9IjE0IiB5PSIzIiByeD0iMSIgLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSI5IiB4PSIxNCIgeT0iMTIiIHJ4PSIxIiAvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjUiIHg9IjMiIHk9IjE2IiByeD0iMSIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBGaWxlU3ByZWFkc2hlZXQgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xNSAySDZhMiAyIDAgMCAwLTIgMnYxNmEyIDIgMCAwIDAgMiAyaDEyYTIgMiAwIDAgMCAyLTJWN1oiIC8+PHBhdGggZD0iTTE0IDJ2NGEyIDIgMCAwIDAgMiAyaDQiIC8+PHBhdGggZD0iTTggMTNoMiIgLz48cGF0aCBkPSJNMTQgMTNoMiIgLz48cGF0aCBkPSJNOCAxN2gyIiAvPjxwYXRoIGQ9Ik0xNCAxN2gyIiAvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IFNldHRpbmdzID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMTIuMjIgMmgtLjQ0YTIgMiAwIDAgMC0yIDJ2LjE4YTIgMiAwIDAgMS0xIDEuNzNsLS40My4yNWEyIDIgMCAwIDEtMiAwbC0uMTUtLjA4YTIgMiAwIDAgMC0yLjczLjczbC0uMjIuMzhhMiAyIDAgMCAwIC43MyAyLjczbC4xNS4xYTIgMiAwIDAgMSAxIDEuNzJ2LjUxYTIgMiAwIDAgMS0xIDEuNzRsLS4xNS4wOWEyIDIgMCAwIDAtLjczIDIuNzNsLjIyLjM4YTIgMiAwIDAgMCAyLjczLjczbC4xNS0uMDhhMiAyIDAgMCAxIDIgMGwuNDMuMjVhMiAyIDAgMCAxIDEgMS43M1YyMGEyIDIgMCAwIDAgMiAyaC40NGEyIDIgMCAwIDAgMi0ydi0uMThhMiAyIDAgMCAxIDEtMS43M2wuNDMtLjI1YTIgMiAwIDAgMSAyIDBsLjE1LjA4YTIgMiAwIDAgMCAyLjczLS43M2wuMjItLjM4YTIgMiAwIDAgMC0uNzMtMi43M2wtLjE1LS4xYTIgMiAwIDAgMS0xLTEuNzJ2LS41MWEyIDIgMCAwIDEgMS0xLjc0bC4xNS0uMDlhMiAyIDAgMCAwIC43My0yLjczbC0uMjItLjM4YTIgMiAwIDAgMC0yLjczLS43M2wtLjE1LjA4YTIgMiAwIDAgMS0yIDBsLS40My0uMjVhMiAyIDAgMCAxLTEtMS43M1Y0YTIgMiAwIDAgMC0yLTJ6IiAvPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgRmlsZVRleHQgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xNSAySDZhMiAyIDAgMCAwLTIgMnYxNmEyIDIgMCAwIDAgMiAyaDEyYTIgMiAwIDAgMCAyLTJWN1oiIC8+PHBhdGggZD0iTTE0IDJ2NGEyIDIgMCAwIDAgMiAyaDQiIC8+PHBhdGggZD0iTTEwIDlIOCIgLz48cGF0aCBkPSJNMTYgMTNIOCIgLz48cGF0aCBkPSJNMTYgMTdIOCIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBQcmludGVyID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cG9seWxpbmUgcG9pbnRzPSI2IDkgNiAyIDE4IDIgMTggOSIgLz48cGF0aCBkPSJNNiAxOEg0YTIgMiAwIDAgMS0yLTJ2LTVhMiAyIDAgMCAxIDItMmgxNmEyIDIgMCAwIDEgMiAydjVhMiAyIDAgMCAxLTIgMmgtMiIgLz48cmVjdCB3aWR0aD0iMTIiIGhlaWdodD0iOCIgeD0iNiIgeT0iMTQiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgU2F2ZSA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTE1LjIgM2EyIDIgMCAwIDEgMS40LjZsMy44IDMuOGEyIDIgMCAwIDEgLjYgMS40VjE5YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0yVjVhMiAyIDAgMCAxIDItMnoiIC8+PHBhdGggZD0iTTE3IDIxdi04SDd2OCIgLz48cGF0aCBkPSJNNyAzdjVoOCIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBVcGxvYWQgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0yMSAxNXY0YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0ydi00IiAvPjxwb2x5bGluZSBwb2ludHM9IjE3IDggMTIgMyA3IDgiIC8+PGxpbmUgeDE9IjEyIiB4Mj0iMTIiIHkxPSIzIiB5Mj0iMTUiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgVHJhc2gyID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMyA2aDE4IiAvPjxwYXRoIGQ9Ik0xOSA2djE0YzAgMS0xIDItMiAySDdjLTEgMC0yLTEtMi0yVjYiIC8+PHBhdGggZD0iTTggNlY0YzAtMSAxLTIgMi0yaDRjMSAwIDIgMSAyIDJ2MiIgLz48bGluZSB4MT0iMTAiIHgyPSIxMCIgeTE9IjExIiB5Mj0iMTciIC8+PGxpbmUgeDE9IjE0IiB4Mj0iMTQiIHkxPSIxMSIgeTI9IjE3IiAvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IENoZWNrQ2lyY2xlID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMjIgMTEuMDhWMTJhMTAgMTAgMCAxIDEtNS45My05LjE0IiAvPjxwb2x5bGluZSBwb2ludHM9IjIyIDQgMTIgMTQuMDEgOSAxMS4wMSIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBBbGVydENpcmNsZSA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIC8+PGxpbmUgeDE9IjEyIiB4Mj0iMTIiIHkxPSI4IiB5Mj0iMTIiIC8+PGxpbmUgeDE9IjEyIiB4Mj0iMTIuMDEiIHkxPSIxNiIgeTI9IjE2IiAvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IFJlZnJlc2hDdyA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTMgMTJhOSA5IDAgMCAxIDktOSA5Ljc1IDkuNzUgMCAwIDEgNi43NCAyLjc0TDIxIDgiIC8+PHBhdGggZD0iTTIxIDN2NWgtNSIgLz48cGF0aCBkPSJNMjEgMTJhOSA5IDAgMCAxLTkgOSA5Ljc1IDkuNzUgMCAwIDEtNi43NC0yLjc0TDMgMTYiIC8+PHBhdGggZD0iTTggMTZIM3Y1IiAvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IFJvdGF0ZUNjdyA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTMgMTJhOSA5IDAgMSAwIDktOSA5Ljc1IDkuNzUgMCAwIDAtNi43NC0yLjc0TDMgMTIiIC8+PHBhdGggZD0iTTMgNXY3aDciIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgRG93bmxvYWQgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0yMSAxNXY0YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0ydi00IiAvPjxwb2x5bGluZSBwb2ludHM9IjcgMTAgMTIgMTUgMTcgMTAiIC8+PGxpbmUgeDE9IjEyIiB4Mj0iMTIiIHkxPSIxNSIgeTI9IjMiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgUGx1cyA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PGxpbmUgeDE9IjEyIiB5MT0iNSIgeDI9IjEyIiB5Mj0iMTkiIC8+PGxpbmUgeDE9IjUiIHkxPSIxMiIgeDI9IjE5IiB5Mj0iMTIiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgQnJpZWZjYXNlID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cmVjdCB3aWR0aD0iMjAiIGhlaWdodD0iMTQiIHg9IjIiIHk9IjciIHJ4PSIyIiByeT0iMiIgLz48cGF0aCBkPSJNMTYgMjFWNWEyIDIgMCAwIDAtMi0yaC00YTIgMiAwIDAgMC0yIDJ2MTYiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgTG9jayA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHJlY3QgeD0iMyIgeT0iMTEiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxMSIgcng9IjIiIHJ5PSIyIiAvPjxwYXRoIGQ9Ik03IDExVjdhNSA1IDAgMCAxIDEwIDB2NCIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBVbmxvY2sgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxyZWN0IHg9IjMiIHk9IjExIiB3aWR0aD0iMTgiIGhlaWdodD0iMTEiIHJ4PSIyIiByeT0iMiIgLz48cGF0aCBkPSJNNyAxMVY3YTUgNSAwIDAgMSA5LjktMSIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBFZGl0ID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMTEgNEg0YTIgMiAwIDAgMC0yIDJ2MTRhMiAyIDAgMCAwIDIgMmgxNGEyIDIgMCAwIDAgMi0ydi03IiAvPjxwYXRoIGQ9Ik0xOC41IDIuNWEyLjEyMSAyLjEyMSAwIDAgMSAzIDNMMTIgMTVsLTQgMSAxLTQgOS41LTkuNXoiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgQ2hlY2sgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9Pjxwb2x5bGluZSBwb2ludHM9IjIwIDYgOSAxNyA0IDEyIiAvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IEdyaWQgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjciIHg9IjMiIHk9IjMiIHJ4PSIxIiAvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjciIHg9IjE0IiB5PSIzIiByeD0iMSIgLz48cmVjdCB3aWR0aD0iNyIgaGVpZ2h0PSI3IiB4PSIxNCIgeT0iMTQiIHJ4PSIxIiAvPjxyZWN0IHdpZHRoPSI3IiBoZWlnaHQ9IjciIHg9IjMiIHk9IjE0IiByeD0iMSIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBMaXN0ID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48bGluZSB4MT0iOCIgeDI9IjIxIiB5MT0iNiIgeTI9IjYiIC8+PGxpbmUgeDE9IjgiIHgyPSIyMSIgeTE9IjEyIiB5Mj0iMTIiIC8+PGxpbmUgeDE9IjgiIHgyPSIyMSIgeTE9IjE4IiB5Mj0iMTgiIC8+PGxpbmUgeDE9IjMiIHgyPSIzLjAxIiB5MT0iNiIgeTI9IjYiIC8+PGxpbmUgeDE9IjMiIHgyPSIzLjAxIiB5MT0iMTIiIHkyPSIxMiIgLz48bGluZSB4MT0iMyIgeDI9IjMuMDEiIHkxPSIxOCIgeTI9IjE4IiAvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IEJlYWtlciA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTQuNSAzaDE1Ii8+PHBhdGggZD0iTTYgM3YxNmEyIDIgMCAwIDAgMiAyaDhhMiAyIDAgMCAwIDItMlYzIi8+PHBhdGggZD0iTTYgMTRoMTIiLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBCb29rT3BlbiA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTIgM2g2YTQgNCAwIDAgMSA0IDR2MTRhMyAzIDAgMCAwLTMtM0gyeiIvPjxwYXRoIGQ9Ik0yMiAzaC02YTQgNCAwIDAgMC00IDR2MTRhMyAzIDAgMCAxIDMtM2g3eiIvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IENsb2NrID0gKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIvPjxwb2x5bGluZSBwb2ludHM9IjEyIDYgMTIgMTIgMTYgMTQiLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBFeWUgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xIDEyczQtOCAxMS04IDExIDggMTEgOC0xMSA4LTQgOC0xMSA4LTExLTgtMTEtOHoiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIi8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgQXJjaGl2ZSA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBvbHlsaW5lIHBvaW50cz0iMjEgOCAyMSAyMSAzIDIxIDMgOCIgLz48cmVjdCB4PSIxIiB5PSIzIiB3aWR0aD0iMjIiIGhlaWdodD0iNSIgLz48bGluZSB4MT0iMTAiIHkxPSIxMiIgeDI9IjE0IiB5Mj0iMTIiIC8+PC9JY29uQmFzZT47CiAgICAgICAgY29uc3QgSGVscENpcmNsZSA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIC8+PHBhdGggZD0iTTkuMDkgOWEzIDMgMCAwIDEgNS44MyAxYzAgMi0zIDMtMyAzIiAvPjxsaW5lIHgxPSIxMiIgeDI9IjEyLjAxIiB5MT0iMTciIHkyPSIxNyIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBFZGl0MyA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTEyIDIwaDkiIC8+PHBhdGggZD0iTTE2LjUgMy41YTIuMTIxIDIuMTIxIDAgMCAxIDMgM0w3IDE5bC00IDEgMS00TDE2LjUgMy41eiIgLz48L0ljb25CYXNlPjsKICAgICAgICBjb25zdCBTdGFtcCA9IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTEyIDJMMiA3bDEwIDUgMTAtNS0xMC01ek0yIDE3bDEwIDUgMTAtNU0yIDEybDEwIDUgMTAtNSIvPjwvSWNvbkJhc2U+OwogICAgICAgIGNvbnN0IENhbGN1bGF0b3IgPSAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxyZWN0IHg9IjQiIHk9IjIiIHdpZHRoPSIxNiIgaGVpZ2h0PSIyMCIgcng9IjIiLz48bGluZSB4MT0iOCIgeDI9IjE2IiB5MT0iNiIgeTI9IjYiLz48bGluZSB4MT0iOCIgeDI9IjE2IiB5MT0iMTAiIHkyPSIxMCIvPjxsaW5lIHgxPSI4IiB4Mj0iMTYiIHkxPSIxNCIgeTI9IjE0Ii8+PGxpbmUgeDE9IjgiIHgyPSIxNiIgeTE9IjE4IiB5Mj0iMTgiLz48L0ljb25CYXNlPjsKCiAgICAgICAgLy8gLS0tIENvbXBvc2FudHMgVUkgLS0tCgogICAgICAgIGNvbnN0IEJ1dHRvbiA9ICh7IGNoaWxkcmVuLCBvbkNsaWNrLCB2YXJpYW50ID0gJ3ByaW1hcnknLCBjbGFzc05hbWUgPSAnJywgaWNvbjogSWNvbiwgZGlzYWJsZWQgPSBmYWxzZSwgdGl0bGUgPSAnJyB9KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGJhc2VTdHlsZSA9ICJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBweC00IHB5LTIgcm91bmRlZC1sZyB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLW9mZnNldC0xIGZvbnQtbWVkaXVtIHNoYWRvdy1zbSBhY3RpdmU6c2NhbGUtOTUgZGlzYWJsZWQ6b3BhY2l0eS01MCBkaXNhYmxlZDpjdXJzb3Itbm90LWFsbG93ZWQiOwogICAgICAgICAgICBjb25zdCB2YXJpYW50cyA9IHsKICAgICAgICAgICAgICAgIHByaW1hcnk6ICJiZy1za3ktNTAwIHRleHQtd2hpdGUgaG92ZXI6Ymctc2t5LTYwMCBmb2N1czpyaW5nLXNreS0zMDAgc2hhZG93LXNreS0xMDAiLAogICAgICAgICAgICAgICAgc2Vjb25kYXJ5OiAiYmctd2hpdGUgdGV4dC1zbGF0ZS03MDAgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAgaG92ZXI6Ymctc2xhdGUtNTAgZm9jdXM6cmluZy1zbGF0ZS0yMDAiLAogICAgICAgICAgICAgICAgZGFuZ2VyOiAiYmctcm9zZS00MDAgdGV4dC13aGl0ZSBob3ZlcjpiZy1yb3NlLTUwMCBmb2N1czpyaW5nLXJvc2UtMzAwIHNoYWRvdy1yb3NlLTEwMCIsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiAiYmctZW1lcmFsZC01MDAgdGV4dC13aGl0ZSBob3ZlcjpiZy1lbWVyYWxkLTYwMCBmb2N1czpyaW5nLWVtZXJhbGQtMzAwIHNoYWRvdy1lbWVyYWxkLTEwMCIsCiAgICAgICAgICAgICAgICB3YXJuaW5nOiAiYmctYW1iZXItNDAwIHRleHQtd2hpdGUgaG92ZXI6YmctYW1iZXItNTAwIGZvY3VzOnJpbmctYW1iZXItMzAwIHNoYWRvdy1hbWJlci0xMDAiCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e29uQ2xpY2t9IGRpc2FibGVkPXtkaXNhYmxlZH0gY2xhc3NOYW1lPXtgJHtiYXNlU3R5bGV9ICR7dmFyaWFudHNbdmFyaWFudF19ICR7Y2xhc3NOYW1lfWB9IHRpdGxlPXt0aXRsZX0+CiAgICAgICAgICAgICAgICAgICAge0ljb24gJiYgPEljb24gY2xhc3NOYW1lPSJ3LTQgaC00IG1yLTIiIC8+fQogICAgICAgICAgICAgICAgICAgIHtjaGlsZHJlbn0KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICApOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IENhcmQgPSAoeyB0aXRsZSwgY2hpbGRyZW4sIGNsYXNzTmFtZSA9ICcnLCBoZWFkZXJBY3Rpb24gPSBudWxsIH0pID0+ICgKICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2BiZy13aGl0ZSByb3VuZGVkLXhsIHNoYWRvdy1zbSBib3JkZXIgYm9yZGVyLXNsYXRlLTEwMCBwLTYgJHtjbGFzc05hbWV9YH0+CiAgICAgICAgICAgICAgICB7dGl0bGUgJiYgPGgzIGNsYXNzTmFtZT0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtc2xhdGUtODAwIG1iLTUgYm9yZGVyLWIgYm9yZGVyLXNsYXRlLTUwIHBiLTMgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJiZy1za3ktMTAwIHctMiBoLTYgcm91bmRlZC1mdWxsIG1yLTMgYmxvY2siPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAge3RpdGxlfQogICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICB7aGVhZGVyQWN0aW9ufQogICAgICAgICAgICAgICAgPC9oMz59CiAgICAgICAgICAgICAgICB7Y2hpbGRyZW59CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICk7CgogICAgICAgIGNvbnN0IENvbmZpcm1hdGlvbk1vZGFsID0gKHsgaXNPcGVuLCB0aXRsZSwgbWVzc2FnZSwgb25Db25maXJtLCBvbkNhbmNlbCB9KSA9PiB7CiAgICAgICAgICAgIGlmICghaXNPcGVuKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmaXhlZCBpbnNldC0wIGJnLWJsYWNrLzUwIGJhY2tkcm9wLWJsdXItc20gei01MCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBwLTQgYW5pbWF0ZS1mYWRlLWluIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcm91bmRlZC14bCBzaGFkb3ctMnhsIG1heC13LW1kIHctZnVsbCBvdmVyZmxvdy1oaWRkZW4gdHJhbnNmb3JtIHRyYW5zaXRpb24tYWxsIHNjYWxlLTEwMCBib3JkZXIgYm9yZGVyLXNsYXRlLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzTmFtZT0idGV4dC1sZyBmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAgbWItMiBmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEFsZXJ0Q2lyY2xlIGNsYXNzTmFtZT0idy02IGgtNiB0ZXh0LXNreS01MDAgbXItMiIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dGl0bGV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTYwMCB3aGl0ZXNwYWNlLXByZS1saW5lIj57bWVzc2FnZX08L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctc2xhdGUtNTAgcHgtNiBweS00IGZsZXgganVzdGlmeS1lbmQgc3BhY2UteC0zIGJvcmRlci10IGJvcmRlci1zbGF0ZS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtvbkNhbmNlbH0gY2xhc3NOYW1lPSJweC00IHB5LTIgcm91bmRlZC1sZyB0ZXh0LXNsYXRlLTYwMCBob3ZlcjpiZy1zbGF0ZS0yMDAgZm9udC1tZWRpdW0gdHJhbnNpdGlvbi1jb2xvcnMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFubnVsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtvbkNvbmZpcm19IGNsYXNzTmFtZT0icHgtNCBweS0yIHJvdW5kZWQtbGcgYmctc2t5LTYwMCB0ZXh0LXdoaXRlIGhvdmVyOmJnLXNreS03MDAgZm9udC1tZWRpdW0gdHJhbnNpdGlvbi1jb2xvcnMgc2hhZG93LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maXJtZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApOwogICAgICAgIH07CgogICAgICAgIC8vIC0tLSBDT01QT1NBTlQgOiBNT0RBTCBERSBTQUlTSUUgLS0tCiAgICAgICAgY29uc3QgSW5wdXRNb2RhbCA9ICh7IGlzT3BlbiwgdGl0bGUsIG1lc3NhZ2UsIGRlZmF1bHRWYWx1ZSwgb25Db25maXJtLCBvbkNhbmNlbCB9KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgc2V0VmFsdWVdID0gdXNlU3RhdGUoZGVmYXVsdFZhbHVlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoaXNPcGVuKSBzZXRWYWx1ZShkZWZhdWx0VmFsdWUpOwogICAgICAgICAgICB9LCBbaXNPcGVuLCBkZWZhdWx0VmFsdWVdKTsKCiAgICAgICAgICAgIGlmICghaXNPcGVuKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZml4ZWQgaW5zZXQtMCBiZy1ibGFjay81MCBiYWNrZHJvcC1ibHVyLXNtIHotNTAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcC00IGFuaW1hdGUtZmFkZS1pbiI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHJvdW5kZWQteGwgc2hhZG93LTJ4bCBtYXgtdy1tZCB3LWZ1bGwgb3ZlcmZsb3ctaGlkZGVuIHRyYW5zZm9ybSB0cmFuc2l0aW9uLWFsbCBzY2FsZS0xMDAgYm9yZGVyIGJvcmRlci1zbGF0ZS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icC02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtbGcgZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIG1iLTIgZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTYXZlIGNsYXNzTmFtZT0idy02IGgtNiB0ZXh0LXNreS01MDAgbXItMiIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dGl0bGV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTYwMCBtYi00IHRleHQtc20iPnttZXNzYWdlfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0ZXh0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dmFsdWV9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0VmFsdWUoZS50YXJnZXQudmFsdWUpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLXNsYXRlLTMwMCByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLXNreS0yMDAgb3V0bGluZS1ub25lIGZvbnQtbWVkaXVtIHRleHQtc2xhdGUtNzAwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9Gb2N1cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uS2V5RG93bj17KGUpID0+IHsgaWYoZS5rZXkgPT09ICdFbnRlcicpIG9uQ29uZmlybSh2YWx1ZSk7IH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXNsYXRlLTUwIHB4LTYgcHktNCBmbGV4IGp1c3RpZnktZW5kIHNwYWNlLXgtMyBib3JkZXItdCBib3JkZXItc2xhdGUtMTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17b25DYW5jZWx9IGNsYXNzTmFtZT0icHgtNCBweS0yIHJvdW5kZWQtbGcgdGV4dC1zbGF0ZS02MDAgaG92ZXI6Ymctc2xhdGUtMjAwIGZvbnQtbWVkaXVtIHRyYW5zaXRpb24tY29sb3JzIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFubnVsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBvbkNvbmZpcm0odmFsdWUpfSBjbGFzc05hbWU9InB4LTQgcHktMiByb3VuZGVkLWxnIGJnLXNreS02MDAgdGV4dC13aGl0ZSBob3ZlcjpiZy1za3ktNzAwIGZvbnQtbWVkaXVtIHRyYW5zaXRpb24tY29sb3JzIHNoYWRvdy1zbSB0ZXh0LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYXV2ZWdhcmRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgLy8gLS0tIENPTVBPU0FOVCA6IMOJRElURVVSIERFIE1PRMOITEVTIERFIERPQ1VNRU5UUyAtLS0KICAgICAgICBjb25zdCBEb2NUZW1wbGF0ZUVkaXRvciA9ICh7IHRlbXBsYXRlcywgc2V0VGVtcGxhdGVzLCBvbkNsb3NlIH0pID0+IHsKICAgICAgICAgICAgY29uc3QgW2FjdGl2ZVRhYiwgc2V0QWN0aXZlVGFiXSA9IHVzZVN0YXRlKCdzdHVkZW50Jyk7CgogICAgICAgICAgICBjb25zdCBoYW5kbGVDaGFuZ2UgPSAoZmllbGQsIHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRUZW1wbGF0ZXMocHJldiA9PiAoewogICAgICAgICAgICAgICAgICAgIC4uLnByZXYsCiAgICAgICAgICAgICAgICAgICAgW2FjdGl2ZVRhYl06IHsKICAgICAgICAgICAgICAgICAgICAgICAgLi4ucHJldlthY3RpdmVUYWJdLAogICAgICAgICAgICAgICAgICAgICAgICBbZmllbGRdOiB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IHRhYnMgPSBbCiAgICAgICAgICAgICAgICB7IGlkOiAnc3R1ZGVudCcsIGxhYmVsOiAnQ29udm9jLiDDiWzDqHZlJywgaWNvbjogVXNlcnMgfSwKICAgICAgICAgICAgICAgIHsgaWQ6ICdzdXJ2ZWlsbGFudCcsIGxhYmVsOiAnQ29udm9jLiBTdXJ2ZWlsbGFudCcsIGljb246IEV5ZSB9LAogICAgICAgICAgICAgICAgeyBpZDogJ2Flc2gnLCBsYWJlbDogJ0NvbnZvYy4gQUVTSCcsIGljb246IEhlbHBDaXJjbGUgfSwKICAgICAgICAgICAgICAgIHsgaWQ6ICdzZWNyZXRhcmlhdCcsIGxhYmVsOiAnT3JkcmUgTWlzc2lvbiBTZWNyw6l0LicsIGljb246IEFyY2hpdmUgfSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctc2xhdGUtNTAgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBvdmVyZmxvdy1oaWRkZW4gbWItNiBhbmltYXRlLWZhZGUtaW4iPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcC00IGJvcmRlci1iIGJvcmRlci1zbGF0ZS0yMDAgYmctd2hpdGUiPgogICAgICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAgZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPEVkaXQzIGNsYXNzTmFtZT0idy01IGgtNSBtci0yIHRleHQtc2t5LTYwMCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIMOJZGl0ZXVyIGRlIE1vZMOobGVzIChWMTApCiAgICAgICAgICAgICAgICAgICAgICAgIDwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17b25DbG9zZX0gY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTQwMCBob3Zlcjp0ZXh0LXNsYXRlLTYwMCBwLTEiPkZlcm1lcjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJvcmRlci1iIGJvcmRlci1zbGF0ZS0yMDAgYmctd2hpdGUgb3ZlcmZsb3cteC1hdXRvIj4KICAgICAgICAgICAgICAgICAgICAgICAge3RhYnMubWFwKHRhYiA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17dGFiLmlkfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldEFjdGl2ZVRhYih0YWIuaWQpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YGZsZXggaXRlbXMtY2VudGVyIHB4LTQgcHktMyB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRyYW5zaXRpb24tY29sb3JzIGJvcmRlci1iLTIgd2hpdGVzcGFjZS1ub3dyYXAgJHthY3RpdmVUYWIgPT09IHRhYi5pZCA/ICdib3JkZXItc2t5LTUwMCB0ZXh0LXNreS02MDAgYmctc2t5LTUwJyA6ICdib3JkZXItdHJhbnNwYXJlbnQgdGV4dC1zbGF0ZS01MDAgaG92ZXI6dGV4dC1zbGF0ZS03MDAgaG92ZXI6Ymctc2xhdGUtNTAnfWB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRhYi5pY29uIGNsYXNzTmFtZT0idy00IGgtNCBtci0yIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0YWIubGFiZWx9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJwLTYgZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTUwMCB1cHBlcmNhc2UgbWItMSI+VGl0cmUgZHUgRG9jdW1lbnQ8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0idGV4dCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0ZW1wbGF0ZXNbYWN0aXZlVGFiXS50aXRsZX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gaGFuZGxlQ2hhbmdlKCd0aXRsZScsIGUudGFyZ2V0LnZhbHVlKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItc2xhdGUtMzAwIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctc2t5LTIwMCBvdXRsaW5lLW5vbmUgZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iYmxvY2sgdGV4dC14cyBmb250LWJvbGQgdGV4dC1zbGF0ZS01MDAgdXBwZXJjYXNlIG1iLTEiPlNvdXMtdGl0cmU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0idGV4dCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0ZW1wbGF0ZXNbYWN0aXZlVGFiXS5zdWJ0aXRsZX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gaGFuZGxlQ2hhbmdlKCdzdWJ0aXRsZScsIGUudGFyZ2V0LnZhbHVlKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItc2xhdGUtMzAwIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctc2t5LTIwMCBvdXRsaW5lLW5vbmUgdGV4dC1zbGF0ZS03MDAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAge3RlbXBsYXRlc1thY3RpdmVUYWJdLmludHJvICE9PSB1bmRlZmluZWQgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQteHMgZm9udC1ib2xkIHRleHQtc2xhdGUtNTAwIHVwcGVyY2FzZSBtYi0xIj5UZXh0ZSBkJ0ludHJvZHVjdGlvbjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3M9ezN9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGVtcGxhdGVzW2FjdGl2ZVRhYl0uaW50cm99IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBoYW5kbGVDaGFuZ2UoJ2ludHJvJywgZS50YXJnZXQudmFsdWUpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItc2xhdGUtMzAwIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctc2t5LTIwMCBvdXRsaW5lLW5vbmUgdGV4dC1zbSB0ZXh0LXNsYXRlLTcwMCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ic3BhY2UteS00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0ZW1wbGF0ZXNbYWN0aXZlVGFiXS5jb25zaWduZXMgIT09IHVuZGVmaW5lZCAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iYmxvY2sgdGV4dC14cyBmb250LWJvbGQgdGV4dC1zbGF0ZS01MDAgdXBwZXJjYXNlIG1iLTEiPkNvbnNpZ25lcyAoMSBwYXIgbGlnbmUpPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93cz17OH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0ZW1wbGF0ZXNbYWN0aXZlVGFiXS5jb25zaWduZXN9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBoYW5kbGVDaGFuZ2UoJ2NvbnNpZ25lcycsIGUudGFyZ2V0LnZhbHVlKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLXNsYXRlLTMwMCByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLXNreS0yMDAgb3V0bGluZS1ub25lIHRleHQtc20gdGV4dC1zbGF0ZS03MDAgZm9udC1tb25vIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9Ii0gQ29uc2lnbmUgMS4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LVsxMHB4XSB0ZXh0LXNsYXRlLTQwMCBtdC0xIj5DaGFxdWUgc2F1dCBkZSBsaWduZSBjcsOpZXJhIHVuZSBub3V2ZWxsZSBsaWduZSBkYW5zIGxlIFBERi48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAge3RlbXBsYXRlc1thY3RpdmVUYWJdLm1pc3Npb25zICE9PSB1bmRlZmluZWQgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQteHMgZm9udC1ib2xkIHRleHQtc2xhdGUtNTAwIHVwcGVyY2FzZSBtYi0xIj5NaXNzaW9ucyAoMSBwYXIgbGlnbmUpPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93cz17OH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0ZW1wbGF0ZXNbYWN0aXZlVGFiXS5taXNzaW9uc30gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IGhhbmRsZUNoYW5nZSgnbWlzc2lvbnMnLCBlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBwLTIgYm9yZGVyIGJvcmRlci1zbGF0ZS0zMDAgcm91bmRlZCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1za3ktMjAwIG91dGxpbmUtbm9uZSB0ZXh0LXNtIHRleHQtc2xhdGUtNzAwIGZvbnQtbW9ubyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy15ZWxsb3ctNTAgcC0zIGJvcmRlci10IGJvcmRlci15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCB0ZXh0LXhzIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPEFsZXJ0Q2lyY2xlIGNsYXNzTmFtZT0idy00IGgtNCBtci0yIiAvPgogICAgICAgICAgICAgICAgICAgICAgICBMZXMgbW9kaWZpY2F0aW9ucyBzb250IGVucmVnaXN0csOpZXMgYXV0b21hdGlxdWVtZW50LgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgLy8gLS0tIE1PRFVMRSBTRUNSRVRBUklBVCAtLS0KICAgICAgICBjb25zdCBTZWNyZXRhcmlhdFBhbmVsID0gKHsgc3ViamVjdHMsIHJvb21zLCB0ZWFjaGVycywgYXNzaWdubWVudHMsIG9uQXNzaWdubWVudENoYW5nZSB9KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IFtzZWxlY3RlZFN1YmplY3RJZCwgc2V0U2VsZWN0ZWRTdWJqZWN0SWRdID0gdXNlU3RhdGUoc3ViamVjdHNbMF0/LmlkIHx8IG51bGwpOwogICAgICAgICAgICBjb25zdCBjdXJyZW50U3ViamVjdCA9IHN1YmplY3RzLmZpbmQocyA9PiBzLmlkID09PSBwYXJzZUludChzZWxlY3RlZFN1YmplY3RJZCkpOwoKICAgICAgICAgICAgY29uc3QgY3VycmVudEFzc2lnbm1lbnQgPSBhc3NpZ25tZW50c1tjdXJyZW50U3ViamVjdD8uaWRdIHx8IHsgcm9vbUlkOiAiIiwgdGVhY2hlcklkczogW10gfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVJvb21DaGFuZ2UgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50U3ViamVjdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgb25Bc3NpZ25tZW50Q2hhbmdlKGN1cnJlbnRTdWJqZWN0LmlkLCB7IC4uLmN1cnJlbnRBc3NpZ25tZW50LCByb29tSWQ6IGUudGFyZ2V0LnZhbHVlIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgdG9nZ2xlVGVhY2hlciA9ICh0SWQpID0+IHsKICAgICAgICAgICAgICAgIGlmICghY3VycmVudFN1YmplY3QpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJZHMgPSBjdXJyZW50QXNzaWdubWVudC50ZWFjaGVySWRzIHx8IFtdOwogICAgICAgICAgICAgICAgY29uc3QgbmV3SWRzID0gY3VycmVudElkcy5pbmNsdWRlcyh0SWQpIAogICAgICAgICAgICAgICAgICAgID8gY3VycmVudElkcy5maWx0ZXIoaWQgPT4gaWQgIT09IHRJZCkKICAgICAgICAgICAgICAgICAgICA6IFsuLi5jdXJyZW50SWRzLCB0SWRdOwogICAgICAgICAgICAgICAgb25Bc3NpZ25tZW50Q2hhbmdlKGN1cnJlbnRTdWJqZWN0LmlkLCB7IC4uLmN1cnJlbnRBc3NpZ25tZW50LCB0ZWFjaGVySWRzOiBuZXdJZHMgfSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBzb3J0ZWRUZWFjaGVycyA9IFsuLi50ZWFjaGVyc10uc29ydCgoYSxiKSA9PiBhLmxhc3RuYW1lLmxvY2FsZUNvbXBhcmUoYi5sYXN0bmFtZSkpOwoKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTYgYW5pbWF0ZS1mYWRlLWluIj4KICAgICAgICAgICAgICAgICAgICA8Q2FyZCB0aXRsZT0iR2VzdGlvbiBkdSBTZWNyw6l0YXJpYXQgZCdFeGFtZW4iIGNsYXNzTmFtZT0iYm9yZGVyLWwtNCBib3JkZXItbC1wdXJwbGUtNTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgbWQ6ZmxleC1yb3cgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIENvbG9ubmUgR2F1Y2hlIDogU8OpbGVjdGlvbiBFcHJldXZlICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctZnVsbCBtZDp3LTEvMyBzcGFjZS15LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1zbGF0ZS03MDAiPkNob2lzaXIgbCfDqXByZXV2ZSAoRmluIGQnw6lwcmV1dmUpIDo8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTIgbWF4LWgtWzQwMHB4XSBvdmVyZmxvdy15LWF1dG8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3ViamVjdHMubWFwKHN1YiA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17c3ViLmlkfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldFNlbGVjdGVkU3ViamVjdElkKHN1Yi5pZCl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgdy1mdWxsIHRleHQtbGVmdCBwLTMgcm91bmRlZC1sZyBib3JkZXIgdHJhbnNpdGlvbi1hbGwgJHtzZWxlY3RlZFN1YmplY3RJZCA9PT0gc3ViLmlkID8gJ2JnLXB1cnBsZS01MCBib3JkZXItcHVycGxlLTUwMCByaW5nLTEgcmluZy1wdXJwbGUtMjAwJyA6ICdiZy13aGl0ZSBib3JkZXItc2xhdGUtMjAwIGhvdmVyOmJnLXNsYXRlLTUwJ31gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAiPntzdWIubmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LXNsYXRlLTUwMCI+e3N1Yi5kYXRlfSDigKIge3N1Yi50aW1lfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIENvbG9ubmUgRHJvaXRlIDogQ29uZmlndXJhdGlvbiAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LWZ1bGwgbWQ6dy0yLzMgYmctc2xhdGUtNTAgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtjdXJyZW50U3ViamVjdCA/ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktNiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXNsYXRlLTcwMCBtYi0xIj4xLiBTYWxsZSBkdSBTZWNyw6l0YXJpYXQ8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LXNsYXRlLTUwMCBtYi0yIj5MaWV1IGRlIHJldG91ciBkZXMgY29waWVzIGV0IGQnw6ltYXJnZW1lbnQgZmluYWwuPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtjdXJyZW50QXNzaWdubWVudC5yb29tSWR9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlUm9vbUNoYW5nZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItc2xhdGUtMzAwIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctcHVycGxlLTIwMCBvdXRsaW5lLW5vbmUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPi0tIFPDqWxlY3Rpb25uZXIgdW5lIHNhbGxlIC0tPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyb29tcy5tYXAociA9PiA8b3B0aW9uIGtleT17ci5pZH0gdmFsdWU9e3IuaWR9PntyLm5hbWV9ICh7ci5jYXBhY2l0eX0gcGwuKTwvb3B0aW9uPil9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXNsYXRlLTcwMCBtYi0xIj4yLiBQZXJzb25uZWxzIGFmZmVjdMOpczwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtc2xhdGUtNTAwIG1iLTIiPlPDqWxlY3Rpb25uZXogbGVzIHByb2Zlc3NldXJzIGNoYXJnw6lzIGR1IHNlY3LDqXRhcmlhdC48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIGJvcmRlciBib3JkZXItc2xhdGUtMzAwIHJvdW5kZWQgaC02MCBvdmVyZmxvdy15LWF1dG8gcC0yIGdyaWQgZ3JpZC1jb2xzLTEgc206Z3JpZC1jb2xzLTIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c29ydGVkVGVhY2hlcnMubWFwKHQgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGtleT17dC5pZH0gY2xhc3NOYW1lPXtgZmxleCBpdGVtcy1jZW50ZXIgc3BhY2UteC0yIHAtMiByb3VuZGVkIGN1cnNvci1wb2ludGVyIGhvdmVyOmJnLXB1cnBsZS01MCBib3JkZXIgdHJhbnNpdGlvbi1jb2xvcnMgJHtjdXJyZW50QXNzaWdubWVudC50ZWFjaGVySWRzPy5pbmNsdWRlcyh0LmlkKSA/ICdiZy1wdXJwbGUtNTAgYm9yZGVyLXB1cnBsZS0yMDAnIDogJ2JvcmRlci10cmFuc3BhcmVudCd9YH0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e2N1cnJlbnRBc3NpZ25tZW50LnRlYWNoZXJJZHM/LmluY2x1ZGVzKHQuaWQpIHx8IGZhbHNlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KCkgPT4gdG9nZ2xlVGVhY2hlcih0LmlkKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJyb3VuZGVkIHRleHQtcHVycGxlLTYwMCBmb2N1czpyaW5nLXB1cnBsZS01MDAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtc20gdHJ1bmNhdGUiPnt0Lmxhc3RuYW1lfSB7dC5maXJzdG5hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im10LTIgdGV4dC1yaWdodCB0ZXh0LXhzIHRleHQtc2xhdGUtNTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2N1cnJlbnRBc3NpZ25tZW50LnRlYWNoZXJJZHM/Lmxlbmd0aCB8fCAwfSBwcm9mZXNzZXVyKHMpIHPDqWxlY3Rpb25uw6kocykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtY2VudGVyIHRleHQtc2xhdGUtNDAwIHB5LTEwIGl0YWxpYyI+U8OpbGVjdGlvbm5leiB1bmUgw6lwcmV1dmU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvQ2FyZD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApOwogICAgICAgIH07CgogICAgICAgIC8vIC0tLSBNT0RVTEUgRVhURVJORSA6IEdFU1RJT04gREVTIFNVUlZFSUxMQU5UUyAtLS0KICAgICAgICBjb25zdCBTdXJ2ZWlsbGFuY2VQYW5lbCA9ICh7IHN1YmplY3RzLCByb29tcywgdGVhY2hlcnMsIHN0dWRlbnRzLCBhc3NpZ25tZW50cywgb25Bc3NpZ25tZW50Q2hhbmdlLCBzY2hvb2xDb25maWcsIG1vZGUsIHNldE1vZGUgfSkgPT4gewogICAgICAgICAgICBjb25zdCBbc2VsZWN0ZWRTdWJqZWN0SWQsIHNldFNlbGVjdGVkU3ViamVjdElkXSA9IHVzZVN0YXRlKHN1YmplY3RzWzBdPy5pZCB8fCBudWxsKTsKICAgICAgICAgICAgY29uc3QgY3VycmVudFN1YmplY3QgPSBzdWJqZWN0cy5maW5kKHMgPT4gcy5pZCA9PT0gcGFyc2VJbnQoc2VsZWN0ZWRTdWJqZWN0SWQpKTsKCiAgICAgICAgICAgIGNvbnN0IGV4cG9ydFN1cnZlaWxsYW5jZVBERiA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmKCFjdXJyZW50U3ViamVjdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOwogICAgICAgICAgICAgICAgY29uc3QgZG9jID0gbmV3IGpzUERGKCk7CiAgICAgICAgICAgICAgICBnZW5lcmF0ZVN1YmplY3RQYWdlKGRvYywgY3VycmVudFN1YmplY3QpOwogICAgICAgICAgICAgICAgZG9jLnNhdmUoYHN1cnZlaWxsYW5jZV8ke2N1cnJlbnRTdWJqZWN0Lm5hbWV9LnBkZmApOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgZXhwb3J0R2xvYmFsU3VydmVpbGxhbmNlUERGID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOwogICAgICAgICAgICAgICAgY29uc3QgZG9jID0gbmV3IGpzUERGKCk7CiAgICAgICAgICAgICAgICBzdWJqZWN0cy5mb3JFYWNoKChzdWIsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gMCkgZG9jLmFkZFBhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZVN1YmplY3RQYWdlKGRvYywgc3ViKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZG9jLnNhdmUoInBsYW5uaW5nX3N1cnZlaWxsYW5jZV9jb21wbGV0X2dsb2JhbC5wZGYiKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGV4cG9ydEdsb2JhbFN1cnZlaWxsYW5jZVdvcmQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXIgPSAiPGh0bWwgeG1sbnM6bz0ndXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6b2ZmaWNlJyB4bWxuczp3PSd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTp3b3JkJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvVFIvUkVDLWh0bWw0MCc+PGhlYWQ+PG1ldGEgY2hhcnNldD0ndXRmLTgnPjx0aXRsZT5QbGFubmluZyBTdXJ2ZWlsbGFuY2U8L3RpdGxlPjxzdHlsZT5ib2R5IHsgZm9udC1mYW1pbHk6IEFyaWFsOyB9IHRhYmxlIHsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsgd2lkdGg6IDEwMCU7IH0gdGQsIHRoIHsgYm9yZGVyOiAxcHggc29saWQgIzAwMDsgcGFkZGluZzogNXB4OyB9IC5wYWdlLWJyZWFrIHsgcGFnZS1icmVhay1iZWZvcmU6IGFsd2F5czsgfTwvc3R5bGU+PC9oZWFkPjxib2R5PiI7CiAgICAgICAgICAgICAgICBjb25zdCBmb290ZXIgPSAiPC9ib2R5PjwvaHRtbD4iOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9ICIiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzdWJqZWN0cy5mb3JFYWNoKChzdWIsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gMCkgY29udGVudCArPSAiPGRpdiBjbGFzcz0ncGFnZS1icmVhayc+PC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb250ZW50ICs9IGA8aDEgc3R5bGU9J3RleHQtYWxpZ246Y2VudGVyJz5QTEFOTklORyBERSBTVVJWRUlMTEFOQ0U8L2gxPmA7CiAgICAgICAgICAgICAgICAgICAgY29udGVudCArPSBgPGgyIHN0eWxlPSd0ZXh0LWFsaWduOmNlbnRlcic+RXByZXV2ZSA6ICR7c3ViLm5hbWV9PC9oMj5gOwogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gYDxoMyBzdHlsZT0ndGV4dC1hbGlnbjpjZW50ZXInPiR7c3ViLmRhdGV9IC0gJHtzdWIudGltZX08L2gzPmA7CiAgICAgICAgICAgICAgICAgICAgY29udGVudCArPSBgPHAgc3R5bGU9J3RleHQtYWxpZ246Y2VudGVyJz5Nb2RlIDogJHttb2RlID09PSAnd2l0aF9yb3RhdGlvbicgPyAnUm90YXRpb25zIGhvcmFpcmVzJyA6ICdTYW5zIHJvdGF0aW9uJ308L3A+YDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb250ZW50ICs9ICI8dGFibGU+PHRoZWFkPjx0ciBzdHlsZT0nYmFja2dyb3VuZC1jb2xvcjojZWVlJz48dGg+U2FsbGU8L3RoPjx0aD5TdXJ2ZWlsbGFudHM8L3RoPjwvdHI+PC90aGVhZD48dGJvZHk+IjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByb29tcy5mb3JFYWNoKHJvb20gPT4gewogICAgICAgICAgICAgICAgICAgICAgICAvLyBERVRFQ1RFUiBTSSBFTEVWRSBUVCBFU1QgREFOUyBMQSBTQUxMRQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNUVCA9IHN0dWRlbnRzLnNvbWUocyA9PiBzLnJvb21JZCA9PT0gcm9vbS5pZCAmJiBzLmlzVFQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVUaW1lID0gaGFzVFQgJiYgc3ViLnRpbWVUVCA/IHN1Yi50aW1lVFQgOiBzdWIudGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZVNsb3RzID0gbW9kZSA9PT0gJ3dpdGhfcm90YXRpb24nID8gY2FsY3VsYXRlVGltZVNsb3RzKGFjdGl2ZVRpbWUpIDogW3sgbGFiZWw6IGFjdGl2ZVRpbWUgfV07CgogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2VsbENvbnRlbnQgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNsb3RzLmZvckVhY2goKHNsb3QsIHNsb3RJbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduS2V5ID0gYCR7c3ViLmlkfS0ke3Jvb20uaWR9LSR7c2xvdEluZGV4fWA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NpZ25lZFRlYWNoZXJJZHMgPSBhc3NpZ25tZW50c1thc3NpZ25LZXldIHx8IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduZWROYW1lcyA9IGFzc2lnbmVkVGVhY2hlcklkcy5tYXAoaWQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0ZWFjaGVycy5maW5kKHRlYSA9PiB0ZWEuaWQgPT09IGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCA/IGAke3QuY2l2fSAke3QubGFzdG5hbWV9ICR7dC5maXJzdG5hbWUuY2hhckF0KDApfS5gIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5maWx0ZXIobiA9PiBuKS5qb2luKCIgJiAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGxDb250ZW50ICE9PSAiIikgY2VsbENvbnRlbnQgKz0gIjxici8+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxDb250ZW50ICs9IGA8c3Ryb25nPiR7c2xvdC5sYWJlbH08L3N0cm9uZz4gOiAke2Fzc2lnbmVkTmFtZXMgfHwgIk5PTiBBU1NJR07DiSJ9YDsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb29tTGFiZWwgPSBoYXNUVCA/IGAke3Jvb20ubmFtZX0gKFRUKWAgOiByb29tLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gYDx0cj48dGQ+PHN0cm9uZz4ke3Jvb21MYWJlbH08L3N0cm9uZz48L3RkPjx0ZD4ke2NlbGxDb250ZW50fTwvdGQ+PC90cj5gOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gIjwvdGJvZHk+PC90YWJsZT4iOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUhUTUwgPSBoZWFkZXIgKyBjb250ZW50ICsgZm9vdGVyOwogICAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFsnXHVmZWZmJywgc291cmNlSFRNTF0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL21zd29yZCcgfSk7CiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICAgICAgY29uc3QgZmlsZURvd25sb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmaWxlRG93bmxvYWQpOwogICAgICAgICAgICAgICAgZmlsZURvd25sb2FkLmhyZWYgPSB1cmw7CiAgICAgICAgICAgICAgICBmaWxlRG93bmxvYWQuZG93bmxvYWQgPSAncGxhbm5pbmdfc3VydmVpbGxhbmNlX2dsb2JhbC5kb2MnOwogICAgICAgICAgICAgICAgZmlsZURvd25sb2FkLmNsaWNrKCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGZpbGVEb3dubG9hZCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBnZW5lcmF0ZVN1YmplY3RQYWdlID0gKGRvYywgc3ViamVjdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHNjaG9vbENvbmZpZyAmJiBzY2hvb2xDb25maWcubG9nb1VybCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gc2Nob29sQ29uZmlnLmxvZ29SYXRpbyB8fCAxOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhEaW0gPSAyNTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFyZ2luID0gMTA7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB3ID0gbWF4RGltOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaCA9IHcgLyByYXRpbzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGggPiBtYXhEaW0pIHsgaCA9IG1heERpbTsgdyA9IGggKiByYXRpbzsgfQogICAgICAgICAgICAgICAgICAgICAgICBkb2MuYWRkSW1hZ2Uoc2Nob29sQ29uZmlnLmxvZ29VcmwsICdKUEVHJywgbWFyZ2luLCAxMCwgdywgaCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxNik7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAiYm9sZCIpOyBkb2Muc2V0VGV4dENvbG9yKDAsIDAsIDApOwogICAgICAgICAgICAgICAgZG9jLnRleHQoYFBMQU5OSU5HIERFIFNVUlZFSUxMQU5DRWAsIDEwNSwgMTUsIHthbGlnbjogJ2NlbnRlcid9KTsKICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMik7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7CiAgICAgICAgICAgICAgICBkb2MudGV4dChgRXByZXV2ZSA6ICR7c3ViamVjdC5uYW1lfWAsIDEwNSwgMjUsIHthbGlnbjogJ2NlbnRlcid9KTsKICAgICAgICAgICAgICAgIGRvYy50ZXh0KGBEYXRlIDogJHtzdWJqZWN0LmRhdGV9IC0gSG9yYWlyZSA6ICR7c3ViamVjdC50aW1lfWAsIDEwNSwgMzIsIHthbGlnbjogJ2NlbnRlcid9KTsKICAgICAgICAgICAgICAgIGRvYy50ZXh0KGBNb2RlIDogJHttb2RlID09PSAnd2l0aF9yb3RhdGlvbicgPyAnUm90YXRpb25zIGhvcmFpcmVzJyA6ICdTYW5zIHJvdGF0aW9uJ31gLCAxMDUsIDM5LCB7YWxpZ246ICdjZW50ZXInfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlRGF0YSA9IHJvb21zLm1hcChyb29tID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBERVRFQ1RFUiBTSSBFTEVWRSBUVCBFU1QgREFOUyBMQSBTQUxMRQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc1RUID0gc3R1ZGVudHMuc29tZShzID0+IHMucm9vbUlkID09PSByb29tLmlkICYmIHMuaXNUVCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlVGltZSA9IGhhc1RUICYmIHN1YmplY3QudGltZVRUID8gc3ViamVjdC50aW1lVFQgOiBzdWJqZWN0LnRpbWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZVNsb3RzID0gbW9kZSA9PT0gJ3dpdGhfcm90YXRpb24nID8gY2FsY3VsYXRlVGltZVNsb3RzKGFjdGl2ZVRpbWUpIDogW3sgbGFiZWw6IGFjdGl2ZVRpbWUgfV07CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSB0aW1lU2xvdHMubWFwKChzbG90LCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NpZ25LZXkgPSBgJHtzdWJqZWN0LmlkfS0ke3Jvb20uaWR9LSR7aW5kZXh9YDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduZWRUZWFjaGVySWRzID0gYXNzaWdubWVudHNbYXNzaWduS2V5XSB8fCBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduZWROYW1lcyA9IGFzc2lnbmVkVGVhY2hlcklkcy5tYXAoaWQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHRlYWNoZXJzLmZpbmQodGVhID0+IHRlYS5pZCA9PT0gaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQgPyBgJHt0LmNpdn0gJHt0Lmxhc3RuYW1lfSAke3QuZmlyc3RuYW1lLmNoYXJBdCgwKX0uYCA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICB9KS5maWx0ZXIobiA9PiBuKS5qb2luKCIgJiAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke3Nsb3QubGFiZWx9IDogJHthc3NpZ25lZE5hbWVzIHx8ICJOT04gQVNTSUdOw4kifWA7CiAgICAgICAgICAgICAgICAgICAgfSkuam9pbigiXG4iKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zdCByb29tTGFiZWwgPSBoYXNUVCA/IGAke3Jvb20ubmFtZX1cbihUaWVycy1UZW1wcylgIDogcm9vbS5uYW1lOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbcm9vbUxhYmVsLCBkZXRhaWxzXTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRvYy5hdXRvVGFibGUoewogICAgICAgICAgICAgICAgICAgIHN0YXJ0WTogNDUsCiAgICAgICAgICAgICAgICAgICAgaGVhZDogW1snU2FsbGUnLCAnU3VydmVpbGxhbnRzIEFmZmVjdMOpcyddXSwKICAgICAgICAgICAgICAgICAgICBib2R5OiB0YWJsZURhdGEsCiAgICAgICAgICAgICAgICAgICAgdGhlbWU6ICdncmlkJywKICAgICAgICAgICAgICAgICAgICBoZWFkU3R5bGVzOiB7IGZpbGxDb2xvcjogWzIyMCwgMjIwLCAyMjBdLCB0ZXh0Q29sb3I6IFswLCAwLCAwXSwgZm9udFN0eWxlOiAnYm9sZCcsIGxpbmVXaWR0aDogMC4xLCBsaW5lQ29sb3I6IFswLCAwLCAwXSB9LAogICAgICAgICAgICAgICAgICAgIHN0eWxlczogeyBtaW5DZWxsSGVpZ2h0OiAxNSwgdmFsaWduOiAnbWlkZGxlJywgZm9udFNpemU6IDEwLCBjZWxsUGFkZGluZzogNCwgdGV4dENvbG9yOiBbMCwgMCwgMF0sIGxpbmVDb2xvcjogWzAsIDAsIDBdLCBsaW5lV2lkdGg6IDAuMSB9LAogICAgICAgICAgICAgICAgICAgIGNvbHVtblN0eWxlczogeyAwOiB7IGNlbGxXaWR0aDogNDAsIGZvbnRTdHlsZTogJ2JvbGQnIH0sIDE6IHsgY2VsbFdpZHRoOiAnYXV0bycgfSB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ic3BhY2UteS02IGFuaW1hdGUtZmFkZS1pbiI+CiAgICAgICAgICAgICAgICAgICAgPENhcmQgdGl0bGU9Ikdlc3Rpb24gZGVzIFN1cnZlaWxsYW50cyIgY2xhc3NOYW1lPSJib3JkZXItbC00IGJvcmRlci1sLWluZGlnby01MDAiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBtZDpmbGV4LXJvdyBnYXAtNiBtYi02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LWZ1bGwgbWQ6dy0xLzMgc3BhY2UteS00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctaW5kaWdvLTUwLzUwIHAtNCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItaW5kaWdvLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQtc20gZm9udC1ib2xkIHRleHQtaW5kaWdvLTkwMCBtYi0yIj5Nb2RlIGQnb3JnYW5pc2F0aW9uIDo8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ic3BhY2UteS0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGN1cnNvci1wb2ludGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9InJhZGlvIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT0ic3VydmVpbGxhbmNlTW9kZSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e21vZGUgPT09ICd3aXRoX3JvdGF0aW9uJ30gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoKSA9PiBzZXRNb2RlKCd3aXRoX3JvdGF0aW9uJyl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iZm9ybS1yYWRpbyB0ZXh0LWluZGlnby02MDAgZm9jdXM6cmluZy1pbmRpZ28tNTAwIGgtNCB3LTQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9Im1sLTIgdGV4dC1zbSB0ZXh0LXNsYXRlLTcwMCI+QXZlYyByb3RhdGlvbnMgKFRyYW5jaGVzIGQnMWgpPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGN1cnNvci1wb2ludGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9InJhZGlvIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT0ic3VydmVpbGxhbmNlTW9kZSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e21vZGUgPT09ICdub19yb3RhdGlvbid9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KCkgPT4gc2V0TW9kZSgnbm9fcm90YXRpb24nKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJmb3JtLXJhZGlvIHRleHQtaW5kaWdvLTYwMCBmb2N1czpyaW5nLWluZGlnby01MDAgaC00IHctNCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0ibWwtMiB0ZXh0LXNtIHRleHQtc2xhdGUtNzAwIj5TYW5zIHJvdGF0aW9uIChEdXLDqWUgY29tcGzDqHRlKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtc2xhdGUtNzAwIj5DaG9pc2lyIGxlIGNyw6luZWF1IGQnw6lwcmV1dmUgOjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdWJqZWN0cy5tYXAoc3ViID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24ga2V5PXtzdWIuaWR9IG9uQ2xpY2s9eygpID0+IHNldFNlbGVjdGVkU3ViamVjdElkKHN1Yi5pZCl9IGNsYXNzTmFtZT17YHctZnVsbCB0ZXh0LWxlZnQgcC0zIHJvdW5kZWQtbGcgYm9yZGVyIHRyYW5zaXRpb24tYWxsICR7c2VsZWN0ZWRTdWJqZWN0SWQgPT09IHN1Yi5pZCA/ICdiZy1pbmRpZ28tNTAgYm9yZGVyLWluZGlnby01MDAgcmluZy0xIHJpbmctaW5kaWdvLTIwMCcgOiAnYmctd2hpdGUgYm9yZGVyLXNsYXRlLTIwMCBob3ZlcjpiZy1zbGF0ZS01MCd9YH0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXNsYXRlLTgwMCI+e3N1Yi5uYW1lfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtc2xhdGUtNTAwIj57c3ViLmRhdGV9IOKAoiB7c3ViLnRpbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InB0LTQgYm9yZGVyLXQgYm9yZGVyLXNsYXRlLTEwMCBmbGV4IGZsZXgtY29sIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXtleHBvcnRTdXJ2ZWlsbGFuY2VQREZ9IGljb249e1ByaW50ZXJ9IHZhcmlhbnQ9InNlY29uZGFyeSIgY2xhc3NOYW1lPSJ3LWZ1bGwgdGV4dC14cyI+SW1wcmltZXIgUGxhbm5pbmcgKFPDqWxlY3Rpb24pPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17ZXhwb3J0R2xvYmFsU3VydmVpbGxhbmNlUERGfSBpY29uPXtGaWxlVGV4dH0gdmFyaWFudD0icHJpbWFyeSIgY2xhc3NOYW1lPSJ3LWZ1bGwgdGV4dC14cyI+SW1wcmltZXIgUGxhbm5pbmcgR2xvYmFsIChUb3V0KTwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2V4cG9ydEdsb2JhbFN1cnZlaWxsYW5jZVdvcmR9IGljb249e0Rvd25sb2FkfSB2YXJpYW50PSJwcmltYXJ5IiBjbGFzc05hbWU9InctZnVsbCB0ZXh0LXhzIGJnLWJsdWUtNzAwIGhvdmVyOmJnLWJsdWUtODAwIj5FeHBvcnRlciBHbG9iYWwgKC5kb2MpPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LWZ1bGwgbWQ6dy0yLzMgYmctc2xhdGUtNTAgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBwLTQgb3ZlcmZsb3cteS1hdXRvIG1heC1oLVs2MDBweF0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtjdXJyZW50U3ViamVjdCA/ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAgbWItMiI+QWZmZWN0YXRpb25zIHBvdXIge2N1cnJlbnRTdWJqZWN0Lm5hbWV9PC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LXNsYXRlLTUwMCBtYi00IGJnLWJsdWUtNTAgcC0yIHJvdW5kZWQgYm9yZGVyIGJvcmRlci1ibHVlLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4oS577iPIHttb2RlID09PSAnd2l0aF9yb3RhdGlvbicgPyAiTGVzIGV4YW1lbnMgc29udCBkw6ljb3Vww6lzIGVuIHRyYW5jaGVzIGhvcmFpcmVzICgxaCBtYXgpLiIgOiAiVW4gc2V1bCBjcsOpbmVhdSBkZSBzdXJ2ZWlsbGFuY2UgcG91ciB0b3V0ZSBsYSBkdXLDqWUgZGUgbCfDqXByZXV2ZS4ifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxici8+4pqg77iPIExlcyBob3JhaXJlcyBzJ2FkYXB0ZW50IGF1dG9tYXRpcXVlbWVudCBhdSBUaWVycy1UZW1wcyAoVFQpIHNpIHVuIMOpbMOodmUgY29uY2VybsOpIGVzdCBkYW5zIGxhIHNhbGxlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3Jvb21zLm1hcChyb29tID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBERVRFQ1RFUiBTSSBFTEVWRSBUVCBFU1QgREFOUyBMQSBTQUxMRSBQT1VSIEFEQVBURVIgTEVTIEhPUkFJUkVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzVFQgPSBzdHVkZW50cy5zb21lKHMgPT4gcy5yb29tSWQgPT09IHJvb20uaWQgJiYgcy5pc1RUKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVUaW1lID0gaGFzVFQgJiYgY3VycmVudFN1YmplY3QudGltZVRUID8gY3VycmVudFN1YmplY3QudGltZVRUIDogY3VycmVudFN1YmplY3QudGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lU2xvdHMgPSBtb2RlID09PSAnd2l0aF9yb3RhdGlvbicgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gY2FsY3VsYXRlVGltZVNsb3RzKGFjdGl2ZVRpbWUpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFt7IGxhYmVsOiBhY3RpdmVUaW1lIH1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtyb29tLmlkfSBjbGFzc05hbWU9ImJnLXdoaXRlIHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAgc2hhZG93LXNtIG92ZXJmbG93LWhpZGRlbiBtYi00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1zbGF0ZS01MCBweC00IHB5LTIgYm9yZGVyLWIgYm9yZGVyLXNsYXRlLTIwMCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtaW5kaWdvLTcwMCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3Jvb20ubmFtZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2hhc1RUICYmIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMTBweF0gYmctcm9zZS0xMDAgdGV4dC1yb3NlLTcwMCBweC0xLjUgcHktMC41IHJvdW5kZWQgYm9yZGVyIGJvcmRlci1yb3NlLTIwMCIgdGl0bGU9IkhvcmFpcmUgYW3DqW5hZ8OpIChUaWVycy1UZW1wcykiPkhvcmFpcmUgVFQ8L3NwYW4+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtWzEwcHhdIHRleHQtc2xhdGUtNDAwIGZvbnQtbm9ybWFsIj57cm9vbS5jYXBhY2l0eX0gcGxhY2VzPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icC0zIHNwYWNlLXktMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3RpbWVTbG90cy5tYXAoKHNsb3QsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2lnbktleSA9IGAke2N1cnJlbnRTdWJqZWN0LmlkfS0ke3Jvb20uaWR9LSR7aW5kZXh9YDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFzc2lnbnMgPSBhc3NpZ25tZW50c1thc3NpZ25LZXldIHx8IFsiIiwgIiJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBrZXk9e2luZGV4fSBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgaXRlbXMtY2VudGVyIGdhcC0zIGJvcmRlci1iIGJvcmRlci1zbGF0ZS0xMDAgcGItMiBsYXN0OmJvcmRlci0wIGxhc3Q6cGItMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2B3LWZ1bGwgc206dy0xLzQgdGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcHktMSByb3VuZGVkIHRleHQtY2VudGVyICR7aGFzVFQgPyAnYmctcm9zZS01MCB0ZXh0LXJvc2UtNjAwIGJvcmRlciBib3JkZXItcm9zZS0xMDAnIDogJ2JnLXNsYXRlLTEwMCB0ZXh0LXNsYXRlLTYwMCd9YH0+e3Nsb3QubGFiZWx9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgtMSB3LWZ1bGwgZ3JpZCBncmlkLWNvbHMtMiBnYXAtMiI+e1swLCAxXS5tYXAoaWR4ID0+ICg8c2VsZWN0IGtleT17aWR4fSBjbGFzc05hbWU9InRleHQteHMgcC0yIGJvcmRlciBib3JkZXItc2xhdGUtMzAwIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctaW5kaWdvLTIwMCBvdXRsaW5lLW5vbmUiIHZhbHVlPXtjdXJyZW50QXNzaWduc1tpZHhdIHx8ICIifSBvbkNoYW5nZT17KGUpID0+IHsgY29uc3QgbmV3QXNzaWducyA9IFsuLi5jdXJyZW50QXNzaWduc107IG5ld0Fzc2lnbnNbaWR4XSA9IGUudGFyZ2V0LnZhbHVlOyBvbkFzc2lnbm1lbnRDaGFuZ2UoYXNzaWduS2V5LCBuZXdBc3NpZ25zKTsgfX0+PG9wdGlvbiB2YWx1ZT0iIj4tLSBTdXJ2LiB7aWR4ICsgMX0gLS08L29wdGlvbj57dGVhY2hlcnMubWFwKHQgPT4gKDxvcHRpb24ga2V5PXt0LmlkfSB2YWx1ZT17dC5pZH0+e3QubGFzdG5hbWV9IHt0LmZpcnN0bmFtZX08L29wdGlvbj4pKX08L3NlbGVjdD4pKX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtY2VudGVyIHRleHQtc2xhdGUtNDAwIHB5LTEwIGl0YWxpYyI+U8OpbGVjdGlvbm5leiB1bmUgw6lwcmV1dmUgw6AgZ2F1Y2hlPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L0NhcmQ+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICAvLyAtLS0gTU9EVUxFIEFJREVTIC0tLQogICAgICAgIGNvbnN0IEhlbHBQYW5lbCA9ICgpID0+ICgKICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktNiBhbmltYXRlLWZhZGUtaW4iPgogICAgICAgICAgICAgICAgPENhcmQgdGl0bGU9Ik1vZGUgZCdFbXBsb2kgLSBQRVJESVJGT1JNQU5DRSBETkIgQkxBTkMgVjExIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1zbGF0ZS02MDAgc3BhY2UteS02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LWxnIGZvbnQtbGlnaHQgdGV4dC1zbGF0ZS04MDAiPkJpZW52ZW51ZSBkYW5zIGwnb3V0aWwgZCdvcmdhbmlzYXRpb24gZCdleGFtZW4gYmxhbmMuIFN1aXZleiBjZXMgw6l0YXBlcyBwb3VyIHVuZSBnZXN0aW9uIGZsdWlkZSBkZSB2b3RyZSBzZXNzaW9uLjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXNreS01MCBwLTUgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNreS0xMDAgc2hhZG93LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1za3ktODAwIGZsZXggaXRlbXMtY2VudGVyIG1iLTMgdGV4dC1sZyI+PHNwYW4gY2xhc3NOYW1lPSJiZy1za3ktMjAwIHRleHQtc2t5LTgwMCB3LTYgaC02IHJvdW5kZWQtZnVsbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXhzIG1yLTIiPjE8L3NwYW4+IEFjY3VlaWwgJiBDb25maWd1cmF0aW9uPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPSJsaXN0LWRpc2MgcGwtNSB0ZXh0LXNtIHNwYWNlLXktMiB0ZXh0LXNsYXRlLTcwMCI+PGxpPkluZm9zIEV0YWIsIExvZ28sIERpc2NpcGxpbmVzIFNjaWVuY2VzLCBIb3JhaXJlcy48L2xpPjwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLWVtZXJhbGQtNTAgcC01IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci1lbWVyYWxkLTEwMCBzaGFkb3ctc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWVtZXJhbGQtODAwIGZsZXggaXRlbXMtY2VudGVyIG1iLTMgdGV4dC1sZyI+PHNwYW4gY2xhc3NOYW1lPSJiZy1lbWVyYWxkLTIwMCB0ZXh0LWVtZXJhbGQtODAwIHctNiBoLTYgcm91bmRlZC1mdWxsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQteHMgbXItMiI+Mjwvc3Bhbj4gSW1wb3J0IGRlcyBEb25uw6llcyAoRXhjZWwvQ1NWKTwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtc20gdGV4dC1zbGF0ZS03MDAgc3BhY2UteS0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJmb250LW1lZGl1bSB1bmRlcmxpbmUiPkNvbG9ubmVzIGF0dGVuZHVlcyAoMcOocmUgbGlnbmUgPSBlbi10w6p0ZSkgOjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT0ibGlzdC1kaXNjIHBsLTUgc3BhY2UteS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPsOJbMOodmVzIDo8L3N0cm9uZz4gTm9tLCBQcsOpbm9tLCBDbGFzc2UsIFRpZXJzLVRlbXBzIChvdSBUVCksIEFFU0gsIElORS48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+U2FsbGVzIDo8L3N0cm9uZz4gTm9tIGRlIGxhIHNhbGxlICgxw6hyZSBjb2wpLCBDYXBhY2l0w6kgKDLDqG1lIGNvbCkuPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPlByb2Zlc3NldXJzIDo8L3N0cm9uZz4gTm9tLCBQcsOpbm9tLCBDaXZpbGl0w6ksIERpc2NpcGxpbmUuPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1vcmFuZ2UtNTAgcC01IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci1vcmFuZ2UtMTAwIHNoYWRvdy1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtb3JhbmdlLTgwMCBmbGV4IGl0ZW1zLWNlbnRlciBtYi0zIHRleHQtbGciPjxzcGFuIGNsYXNzTmFtZT0iYmctb3JhbmdlLTIwMCB0ZXh0LW9yYW5nZS04MDAgdy02IGgtNiByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC14cyBtci0yIj4zPC9zcGFuPiBSw6lwYXJ0aXRpb248L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9Imxpc3QtZGlzYyBwbC01IHRleHQtc20gc3BhY2UteS0yIHRleHQtc2xhdGUtNzAwIj48bGk+QW5vbnltYXQsIFLDqXBhcnRpdGlvbiBBdXRvL01hbnVlbGxlLjwvbGk+PC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLWluZGlnby01MCBwLTUgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLWluZGlnby0xMDAgc2hhZG93LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1pbmRpZ28tODAwIGZsZXggaXRlbXMtY2VudGVyIG1iLTMgdGV4dC1sZyI+PHNwYW4gY2xhc3NOYW1lPSJiZy1pbmRpZ28tMjAwIHRleHQtaW5kaWdvLTgwMCB3LTYgaC02IHJvdW5kZWQtZnVsbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXhzIG1yLTIiPjQ8L3NwYW4+IFN1cnZlaWxsYW50cyAmIFNlY3LDqXRhcmlhdDwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT0ibGlzdC1kaXNjIHBsLTUgdGV4dC1zbSBzcGFjZS15LTIgdGV4dC1zbGF0ZS03MDAiPjxsaT5QbGFubmluZyBzdXJ2ZWlsbGFuY2UgZXQgZ2VzdGlvbiBkZSBmaW4gZCfDqXByZXV2ZS48L2xpPjwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1wdXJwbGUtNTAgcC01IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci1wdXJwbGUtMTAwIHNoYWRvdy1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtcHVycGxlLTgwMCBmbGV4IGl0ZW1zLWNlbnRlciBtYi0zIHRleHQtbGciPjxzcGFuIGNsYXNzTmFtZT0iYmctcHVycGxlLTIwMCB0ZXh0LXB1cnBsZS04MDAgdy02IGgtNiByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC14cyBtci0yIj41PC9zcGFuPiBDb3JyZWN0aW9uPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPSJsaXN0LWRpc2MgcGwtNSB0ZXh0LXNtIHNwYWNlLXktMiB0ZXh0LXNsYXRlLTcwMCI+PGxpPlLDqXBhcnRpdGlvbiBkZXMgbG90cyBldCBsaXN0ZXMgZGUgY29udHLDtGxlLjwvbGk+PC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1zbGF0ZS0xMDAgcC01IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAgc2hhZG93LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAgZmxleCBpdGVtcy1jZW50ZXIgbWItMyB0ZXh0LWxnIj48c3BhbiBjbGFzc05hbWU9ImJnLXNsYXRlLTMwMCB0ZXh0LXNsYXRlLTgwMCB3LTYgaC02IHJvdW5kZWQtZnVsbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXhzIG1yLTIiPjY8L3NwYW4+IERvY3VtZW50cyAmIEV4cG9ydHM8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9Imxpc3QtZGlzYyBwbC01IHRleHQtc20gc3BhY2UteS0yIHRleHQtc2xhdGUtNzAwIj48bGk+VG91cyBsZXMgUERGLCBwZXJzb25uYWxpc2FibGVzIHZpYSBsJ8OpZGl0ZXVyLjwvbGk+PC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvQ2FyZD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgKTsKCiAgICAgICAgLy8gLS0tIEFwcGxpY2F0aW9uIFByaW5jaXBhbGUgLS0tCiAgICAgICAgY29uc3QgQXBwID0gKCkgPT4gewogICAgICAgICAgICBjb25zdCBbYWN0aXZlVGFiLCBzZXRBY3RpdmVUYWJdID0gdXNlU3RhdGUoJ2NvbmZpZycpOwogICAgICAgICAgICBjb25zdCBbaXNBbm9ueW1pdHlMb2NrZWQsIHNldElzQW5vbnltaXR5TG9ja2VkXSA9IHVzZVN0YXRlKHRydWUpOyAKICAgICAgICAgICAgY29uc3QgW2lzU3R1ZGVudExpc3RFZGl0YWJsZSwgc2V0SXNTdHVkZW50TGlzdEVkaXRhYmxlXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgICAgICAgICAgY29uc3QgW3JlcGFydGl0aW9uVmlldywgc2V0UmVwYXJ0aXRpb25WaWV3XSA9IHVzZVN0YXRlKCdib2FyZCcpOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IFtzdXJ2ZWlsbGFuY2VNb2RlLCBzZXRTdXJ2ZWlsbGFuY2VNb2RlXSA9IHVzZVN0YXRlKCd3aXRoX3JvdGF0aW9uJyk7IAoKICAgICAgICAgICAgY29uc3QgW3NlbGVjdGVkQ29ycmVjdGlvblN1YmplY3QsIHNldFNlbGVjdGVkQ29ycmVjdGlvblN1YmplY3RdID0gdXNlU3RhdGUobnVsbCk7CiAgICAgICAgICAgIGNvbnN0IFtzZWxlY3RlZFRlYWNoZXJzRm9yQ29ycmVjdGlvbiwgc2V0U2VsZWN0ZWRUZWFjaGVyc0ZvckNvcnJlY3Rpb25dID0gdXNlU3RhdGUoW10pOwogICAgICAgICAgICAvLyBBam91dCBFdGF0IHBvdXIgZm9yY2VyIGFmZmljaGFnZSB0b3VzIHByb2ZzCiAgICAgICAgICAgIGNvbnN0IFtmb3JjZUFsbFRlYWNoZXJzQ29ycmVjdGlvbiwgc2V0Rm9yY2VBbGxUZWFjaGVyc0NvcnJlY3Rpb25dID0gdXNlU3RhdGUoZmFsc2UpOwoKICAgICAgICAgICAgY29uc3QgW3RlYWNoZXJBc3NpZ25tZW50cywgc2V0VGVhY2hlckFzc2lnbm1lbnRzXSA9IHVzZVN0YXRlKHt9KTsgCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBbc3VydmVpbGxhbmNlQXNzaWdubWVudHMsIHNldFN1cnZlaWxsYW5jZUFzc2lnbm1lbnRzXSA9IHVzZVN0YXRlKHt9KTsgCiAgICAgICAgICAgIGNvbnN0IFtzZWNyZXRhcmlhdEFzc2lnbm1lbnRzLCBzZXRTZWNyZXRhcmlhdEFzc2lnbm1lbnRzXSA9IHVzZVN0YXRlKHt9KTsKCiAgICAgICAgICAgIGNvbnN0IFtkcmFnZ2VkU3R1ZGVudElkLCBzZXREcmFnZ2VkU3R1ZGVudElkXSA9IHVzZVN0YXRlKG51bGwpOwogICAgICAgICAgICBjb25zdCBbbW9kYWxDb25maWcsIHNldE1vZGFsQ29uZmlnXSA9IHVzZVN0YXRlKHsgaXNPcGVuOiBmYWxzZSwgdGl0bGU6ICcnLCBtZXNzYWdlOiAnJywgb25Db25maXJtOiBudWxsIH0pOwogICAgICAgICAgICAvLyBBam91dCBkdSBzdGF0ZSBwb3VyIGxlIG1vZGFsIGRlIHNhaXNpZQogICAgICAgICAgICBjb25zdCBbaW5wdXRNb2RhbENvbmZpZywgc2V0SW5wdXRNb2RhbENvbmZpZ10gPSB1c2VTdGF0ZSh7IGlzT3BlbjogZmFsc2UsIHRpdGxlOiAnJywgbWVzc2FnZTogJycsIGRlZmF1bHRWYWx1ZTogJycsIG9uQ29uZmlybTogbnVsbCB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IFtzY2hvb2xDb25maWcsIHNldFNjaG9vbENvbmZpZ10gPSB1c2VTdGF0ZShERUZBVUxUX1NDSE9PTF9DT05GSUcpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIFNUQVRFIFBPVVIgTEVTIFRFTVBMQVRFUyBERSBET0NTIC0tLQogICAgICAgICAgICBjb25zdCBbZG9jVGVtcGxhdGVzLCBzZXREb2NUZW1wbGF0ZXNdID0gdXNlU3RhdGUoREVGQVVMVF9ET0NfVEVNUExBVEVTKTsKICAgICAgICAgICAgLy8gQWpvdXQgw6l0YXQgcG91ciBsJ8OpZGl0ZXVyIGRlIHRlbXBsYXRlcwogICAgICAgICAgICBjb25zdCBbaXNUZW1wbGF0ZUVkaXRvck9wZW4sIHNldElzVGVtcGxhdGVFZGl0b3JPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTsKCiAgICAgICAgICAgIGNvbnN0IFtyb29tcywgc2V0Um9vbXNdID0gdXNlU3RhdGUoW10pOyAKICAgICAgICAgICAgY29uc3QgW3N0dWRlbnRzLCBzZXRTdHVkZW50c10gPSB1c2VTdGF0ZShbXSk7CiAgICAgICAgICAgIGNvbnN0IFt0ZWFjaGVycywgc2V0VGVhY2hlcnNdID0gdXNlU3RhdGUoW10pOwogICAgICAgICAgICBjb25zdCBbc3ViamVjdHMsIHNldFN1YmplY3RzXSA9IHVzZVN0YXRlKERFRkFVTFRfU1VCSkVDVFMpOwogICAgICAgICAgICBjb25zdCBbbmV3U3ViamVjdCwgc2V0TmV3U3ViamVjdF0gPSB1c2VTdGF0ZSh7IG5hbWU6ICcnLCBkYXRlOiAnJywgdGltZTogJycsIHRpbWVUVDogJycgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gTk9VVkVBVSBTVEFURSBQT1VSIEwnQUpPVVQgTUFOVUVMIERFIFNBTExFIC0tLQogICAgICAgICAgICBjb25zdCBbbmV3Um9vbSwgc2V0TmV3Um9vbV0gPSB1c2VTdGF0ZSh7IG5hbWU6ICcnLCBjYXBhY2l0eTogMjAgfSk7CgogICAgICAgICAgICBjb25zdCBbbm90aWZpY2F0aW9uLCBzZXROb3RpZmljYXRpb25dID0gdXNlU3RhdGUobnVsbCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzaG93Tm90aWZpY2F0aW9uID0gKG1zZywgdHlwZSA9ICdzdWNjZXNzJykgPT4geyBzZXROb3RpZmljYXRpb24oeyBtc2csIHR5cGUgfSk7IHNldFRpbWVvdXQoKCkgPT4gc2V0Tm90aWZpY2F0aW9uKG51bGwpLCAzMDAwKTsgfTsKCiAgICAgICAgICAgIC8vIC0tLSBBVVRPIFNBVkUgJiBMT0FEIEFNw4lMSU9Sw4lTIChWMTEgYXZlYyBtaWdyYXRpb24gVjEwKSAtLS0KICAgICAgICAgICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAgIC8vIFRlbnRlciBkZSBjaGFyZ2VyIFYxMQogICAgICAgICAgICAgICAgY29uc3Qgc2F2ZWREYXRhVjExID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlfVjExKTsKICAgICAgICAgICAgICAgIGlmIChzYXZlZERhdGFWMTEpIHsKICAgICAgICAgICAgICAgICAgICBsb2FkRGF0YShKU09OLnBhcnNlKHNhdmVkRGF0YVYxMSksICJWMTEiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGVudGVyIG1pZ3JhdGlvbiBkZXB1aXMgVjEwCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2F2ZWREYXRhVjEwID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlfVjEwKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZWREYXRhVjEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJNaWdyYXRpb24gZGVwdWlzIFYxMC4uLiIpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2FkRGF0YShKU09OLnBhcnNlKHNhdmVkRGF0YVYxMCksICJWMTAgKE1pZ3LDqSkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbigiRG9ubsOpZXMgbWlncsOpZXMgZGVwdWlzIGxhIHZlcnNpb24gcHLDqWPDqWRlbnRlIChWMTApLiIsICJzdWNjZXNzIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBbXSk7CgogICAgICAgICAgICBjb25zdCBsb2FkRGF0YSA9IChkYXRhLCB2ZXJzaW9uTGFiZWwpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIEdFU1RJT04gSU5URUxMSUdFTlRFIERFUyBWRVJTSU9OUyAoUEFTU8OJRVMgRVQgRlVUVVJFUykgLS0tCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRMOpdGVjdGlvbiBkZXMgdmVyc2lvbnMgZnV0dXJlcwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRlZFZlcnNpb24gPSBwYXJzZUZsb2F0KGRhdGEudmVyc2lvbikgfHwgMDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VmVyc2lvbiA9IHBhcnNlRmxvYXQoQVBQX1ZFUlNJT04pOwoKICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGVkVmVyc2lvbiA+IGN1cnJlbnRWZXJzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oYEluZm8gOiBTYXV2ZWdhcmRlIGlzc3VlIGQndW5lIHZlcnNpb24gcGx1cyByw6ljZW50ZSAoJHtkYXRhLnZlcnNpb24gfHwgJ0luY29ubnVlJ30pLiBMZXMgZG9ubsOpZXMgY29tcGF0aWJsZXMgc2Vyb250IGNoYXJnw6llcy5gLCAid2FybmluZyIpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gQ29uZmlnIEV0YWJsaXNzZW1lbnQKICAgICAgICAgICAgICAgICAgICAvLyBPbiBwYXJ0IGRlcyBkw6lmYXV0cyBldCBvbiBmdXNpb25uZSBhdmVjIGNlIHF1aSBleGlzdGUgZGFucyBsZSBKU09OIChzaSBwcsOpc2VudCkKICAgICAgICAgICAgICAgICAgICAvLyBMJ29ww6lyYXRldXIgLi4uIHBlcm1ldCBkZSBjb25zZXJ2ZXIgZGVzIGNoYW1wcyBmdXR1cnMgaW5jb25udXMgZGUgbGEgVjEwCiAgICAgICAgICAgICAgICAgICAgc2V0U2Nob29sQ29uZmlnKHByZXYgPT4gKHsgCiAgICAgICAgICAgICAgICAgICAgICAgIC4uLkRFRkFVTFRfU0NIT09MX0NPTkZJRywgCiAgICAgICAgICAgICAgICAgICAgICAgIC4uLihkYXRhLnNjaG9vbENvbmZpZyB8fCB7fSkgCiAgICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgICAvLyAyLiBTYWxsZXMKICAgICAgICAgICAgICAgICAgICAvLyBTw6ljdXJpc2F0aW9uIHNpIGRhdGEucm9vbXMgZXN0IG51bGwgb3UgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9hZGVkUm9vbXMgPSBBcnJheS5pc0FycmF5KGRhdGEucm9vbXMpID8gZGF0YS5yb29tcyA6IFtdOwogICAgICAgICAgICAgICAgICAgIHNldFJvb21zKGxvYWRlZFJvb21zLm1hcChyID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnIsIC8vIE9uIGdhcmRlIHRvdXRlcyBsZXMgcHJvcHJpw6l0w6lzIGV4aXN0YW50ZXMgKG3Dqm1lIGZ1dHVyZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiByLmlkIHx8IGByb29tLW1pZ3JhdGVkLSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsIC8vIFPDqWN1cml0w6kgSUQgbWFucXVhbnQKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogci5uYW1lIHx8ICJTYWxsZSBzYW5zIG5vbSIsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbXBhdGliaWxpdMOpIFYxLVY5IChjYXBhY2l0eSBvdSBtYXhDYXBhY2l0eSkKICAgICAgICAgICAgICAgICAgICAgICAgY2FwYWNpdHk6IHBhcnNlSW50KHIuY2FwYWNpdHkpIHx8IHBhcnNlSW50KHIubWF4Q2FwYWNpdHkpIHx8IDIwLCAKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogci50eXBlIHx8ICdzdGFuZGFyZCcKICAgICAgICAgICAgICAgICAgICB9KSkpOwoKICAgICAgICAgICAgICAgICAgICAvLyAzLiDDiWzDqHZlcwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRlZFN0dWRlbnRzID0gQXJyYXkuaXNBcnJheShkYXRhLnN0dWRlbnRzKSA/IGRhdGEuc3R1ZGVudHMgOiBbXTsKICAgICAgICAgICAgICAgICAgICBzZXRTdHVkZW50cyhsb2FkZWRTdHVkZW50cy5tYXAocyA9PiAoewogICAgICAgICAgICAgICAgICAgICAgICAuLi5zLCAvLyBDUlVDSUFMIDogT24gY29uc2VydmUgbGVzIGNoYW1wcyBwb3RlbnRpZWxzIGRlcyB2ZXJzaW9ucyBmdXR1cmVzIChleDogJ2dyb3VwZUNvbXBldGVuY2UnIGRlIGxhIFYxMikKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHMuaWQgfHwgYHN0dWRlbnQtbWlncmF0ZWQtJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3VwcG9ydCBjbMOpcyBmcmFuw6dhaXNlcyBhbmNpZW5uZXMgdmVyc2lvbnMgKG5vbS9wcmVub20pCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RuYW1lOiBzLmxhc3RuYW1lIHx8IHMubm9tIHx8ICJJbmNvbm51IiwgCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0bmFtZTogcy5maXJzdG5hbWUgfHwgcy5wcmVub20gfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzOiBzLmNsYXNzIHx8IHMuY2xhc3NlIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDb21wYXRpYmlsaXTDqSBib29sw6llbm5lIHJvYnVzdGUgKGlzVFQsIHRpZXJzVGVtcHMsIHR0LCBvdSBjaGHDrm5lICJPVUkiKQogICAgICAgICAgICAgICAgICAgICAgICBpc1RUOiAocy5pc1RUICE9PSB1bmRlZmluZWQpID8gcy5pc1RUIDogKCEhcy50aWVyc1RlbXBzIHx8ICEhcy50dCB8fCBzLnR0ID09PSAiT1VJIiksCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFPDqWN1cml0w6kgOiByb29tSWQgZG9pdCDDqnRyZSBudWxsIHNpIGludmFsaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHJvb21JZDogcy5yb29tSWQgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgaW5lOiBzLmluZSB8fCAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgYWVzaDogcy5hZXNoIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBhbm9ueW1vdXNJZDogcy5hbm9ueW1vdXNJZCB8fCAiIiAKICAgICAgICAgICAgICAgICAgICB9KSkpOwoKICAgICAgICAgICAgICAgICAgICAvLyA0LiBQcm9mZXNzZXVycwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRlZFRlYWNoZXJzID0gQXJyYXkuaXNBcnJheShkYXRhLnRlYWNoZXJzKSA/IGRhdGEudGVhY2hlcnMgOiBbXTsKICAgICAgICAgICAgICAgICAgICBzZXRUZWFjaGVycyhsb2FkZWRUZWFjaGVycy5tYXAodCA9PiAoewogICAgICAgICAgICAgICAgICAgICAgICAuLi50LCAvLyBDb25zZXJ2YXRpb24gZGVzIGNoYW1wcyBmdXR1cnMKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHQuaWQgfHwgYHByb2YtbWlncmF0ZWQtJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3VwcG9ydCBjbMOpcyBmcmFuw6dhaXNlcyBhbmNpZW5uZXMKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdG5hbWU6IHQubGFzdG5hbWUgfHwgdC5ub20gfHwgIlByb2Zlc3NldXIiLAogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdG5hbWU6IHQuZmlyc3RuYW1lIHx8IHQucHJlbm9tIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBjaXY6IHQuY2l2IHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0IGRpc2NpcGxpbmUvbWF0aWVyZQogICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiB0LnN1YmplY3QgfHwgdC5kaXNjaXBsaW5lIHx8IHQubWF0aWVyZSB8fCAnTm9uIGTDqWZpbmknCiAgICAgICAgICAgICAgICAgICAgfSkpKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gNS4gTWF0acOocmVzIChDcnVjaWFsIHBvdXIgVjEwL1YxMSkKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWJqZWN0cyAmJiBBcnJheS5pc0FycmF5KGRhdGEuc3ViamVjdHMpICYmIGRhdGEuc3ViamVjdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZXRTdWJqZWN0cyhkYXRhLnN1YmplY3RzLm1hcChzID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHBhcnNlSW50KHMuaWQpIHx8IHMuaWQgfHwgRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHMubmFtZSB8fCAiw4lwcmV1dmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogcy5kYXRlIHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogcy50aW1lIHx8ICIwMDowMCAtIDAwOjAwIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1pZ3JhdGlvbiBWMTAgOiBzaSBwYXMgZGUgdGltZVRULCBvbiB1dGlsaXNlIHRpbWUgc3RhbmRhcmQgcGFyIGTDqWZhdXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVUVDogcy50aW1lVFQgfHwgcy50aW1lIHx8ICIwMDowMCAtIDAwOjAwIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1pZ3JhdGlvbiBWMTAgOiB0YWJsZWF1IHZpZGUgc2kgYWJzZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjaXBsaW5lczogQXJyYXkuaXNBcnJheShzLmRpc2NpcGxpbmVzKSA/IHMuZGlzY2lwbGluZXMgOiBbXQogICAgICAgICAgICAgICAgICAgICAgICB9KSkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5zdWJqZWN0cykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBTaSBsYSBjbMOpIGV4aXN0ZSBtYWlzIGVzdCB2aWRlIG91IGludmFsaWRlLCBvbiByZW1ldCBsZXMgZMOpZmF1dHMgb3UgdmlkZSBzZWxvbiBsZSBjYXMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWNpIG9uIGNvbnNlcnZlIGxlcyBzdWpldHMgZXhpc3RhbnRzIGRlIGwnYXBwIHNpIGxlIEpTT04gbidlbiBhIHBhcywgb3Ugb24gbWV0IHZpZGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUG91ciDDqXZpdGVyIGRlIHBlcmRyZSBsZXMgZG9ubsOpZXMsIHNpIGxlIEpTT04gbidhIHBhcyBkZSBzdWpldHMsIG9uIHN1cHBvc2UgcXUnaWwgbidlbiBhdmFpdCBwYXMuCiAgICAgICAgICAgICAgICAgICAgICAgIHNldFN1YmplY3RzKFtdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogU2kgZGF0YS5zdWJqZWN0cyBlc3QgdW5kZWZpbmVkICh0csOocyB2aWVpbGxlIHNhdXZlZ2FyZGUgcGFydGllbGxlKSwgb24gZ2FyZGUgbGVzIERFRkFVTFRfU1VCSkVDVFMgaW5pdGlhbGlzw6lzIGF1IGTDqW1hcnJhZ2UKCiAgICAgICAgICAgICAgICAgICAgLy8gNi4gQWZmZWN0YXRpb25zCiAgICAgICAgICAgICAgICAgICAgc2V0VGVhY2hlckFzc2lnbm1lbnRzKGRhdGEudGVhY2hlckFzc2lnbm1lbnRzIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICBzZXRTdXJ2ZWlsbGFuY2VBc3NpZ25tZW50cyhkYXRhLnN1cnZlaWxsYW5jZUFzc2lnbm1lbnRzIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICBzZXRTZWNyZXRhcmlhdEFzc2lnbm1lbnRzKGRhdGEuc2VjcmV0YXJpYXRBc3NpZ25tZW50cyB8fCB7fSk7CgogICAgICAgICAgICAgICAgICAgIC8vIDcuIFBhcmFtw6h0cmVzCiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VydmVpbGxhbmNlTW9kZSkgc2V0U3VydmVpbGxhbmNlTW9kZShkYXRhLnN1cnZlaWxsYW5jZU1vZGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmlzQW5vbnltaXR5TG9ja2VkICE9PSB1bmRlZmluZWQpIHNldElzQW5vbnltaXR5TG9ja2VkKGRhdGEuaXNBbm9ueW1pdHlMb2NrZWQpOwoKICAgICAgICAgICAgICAgICAgICAvLyA4LiBUZW1wbGF0ZXMgZGUgZG9jdW1lbnRzIChNaWdyYXRpb24gVjEwIGNyaXRpcXVlKQogICAgICAgICAgICAgICAgICAgIC8vIE9uIGFzc3VyZSBxdWUgdG91dGVzIGxlcyBjbMOpcyBkdSB0ZW1wbGF0ZSBWMTAgZXhpc3RlbnQgbcOqbWUgc2kgbGEgc2F1dmVnYXJkZSBlc3QgYW5jaWVubmUKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2FkZWRUZW1wbGF0ZXMgPSBkYXRhLmRvY1RlbXBsYXRlcyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXJnZWRUZW1wbGF0ZXMgPSB7IC4uLkRFRkFVTFRfRE9DX1RFTVBMQVRFUyB9OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKERFRkFVTFRfRE9DX1RFTVBMQVRFUykuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAvLyBPbiBwcmVuZCBsZSB0ZW1wbGF0ZSBwYXIgZMOpZmF1dCBjb21tZSBiYXNlCiAgICAgICAgICAgICAgICAgICAgICAgIG1lcmdlZFRlbXBsYXRlc1trZXldID0geyAuLi5ERUZBVUxUX0RPQ19URU1QTEFURVNba2V5XSB9OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2kgbGEgc2F1dmVnYXJkZSBjb250aWVudCBkZXMgaW5mb3MgcG91ciBjZSB0ZW1wbGF0ZSwgb24gZnVzaW9ubmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRlZFRlbXBsYXRlc1trZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXJnZWRUZW1wbGF0ZXNba2V5XSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5tZXJnZWRUZW1wbGF0ZXNba2V5XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5sb2FkZWRUZW1wbGF0ZXNba2V5XSAvLyDDiWNyYXNlIGF2ZWMgbGVzIHZhbGV1cnMgY2hhcmfDqWVzLCBpZ25vcmUgbGVzIGNsw6lzIGluY29ubnVlcyBzaSBvbiB2b3VsYWl0IMOqdHJlIHN0cmljdCwgbWFpcyBpY2kgb24gZXN0IHBlcm1pc3NpZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNldERvY1RlbXBsYXRlcyhtZXJnZWRUZW1wbGF0ZXMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGVkVmVyc2lvbiA8PSBjdXJyZW50VmVyc2lvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbihgRG9ubsOpZXMgcmVzdGF1csOpZXMgYXZlYyBzdWNjw6hzICgke3ZlcnNpb25MYWJlbCB8fCAiRmljaGllciBleHRlcm5lIn0pYCwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyZXVyIGNoYXJnZW1lbnQgZG9ubsOpZXMiLCBlKTsKICAgICAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJBdHRlbnRpb24gOiBGaWNoaWVyIGRlIHNhdXZlZ2FyZGUgY29ycm9tcHUgb3UgZm9ybWF0IGluY29ubnUuIiwgImVycm9yIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBTYXV2ZWdhcmRlciBhdXRvbWF0aXF1ZW1lbnQgw6AgY2hhcXVlIGNoYW5nZW1lbnQgKFYxMSBFWEhBVVNUSVZFKQogICAgICAgICAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZGF0YVRvU2F2ZSA9IHsKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBBUFBfVkVSU0lPTiwKICAgICAgICAgICAgICAgICAgICBzY2hvb2xDb25maWcsCiAgICAgICAgICAgICAgICAgICAgcm9vbXMsCiAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHMsCiAgICAgICAgICAgICAgICAgICAgdGVhY2hlcnMsCiAgICAgICAgICAgICAgICAgICAgc3ViamVjdHMsCiAgICAgICAgICAgICAgICAgICAgdGVhY2hlckFzc2lnbm1lbnRzLAogICAgICAgICAgICAgICAgICAgIHN1cnZlaWxsYW5jZUFzc2lnbm1lbnRzLAogICAgICAgICAgICAgICAgICAgIHNlY3JldGFyaWF0QXNzaWdubWVudHMsCiAgICAgICAgICAgICAgICAgICAgc3VydmVpbGxhbmNlTW9kZSwKICAgICAgICAgICAgICAgICAgICBkb2NUZW1wbGF0ZXMsCiAgICAgICAgICAgICAgICAgICAgaXNBbm9ueW1pdHlMb2NrZWQsIC8vIFNhdXZlZ2FyZGUgZGUgbCfDqXRhdCBkdSB2ZXJyb3UKICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZX1YxMSwgSlNPTi5zdHJpbmdpZnkoZGF0YVRvU2F2ZSkpOwogICAgICAgICAgICB9LCBbc2Nob29sQ29uZmlnLCByb29tcywgc3R1ZGVudHMsIHRlYWNoZXJzLCBzdWJqZWN0cywgdGVhY2hlckFzc2lnbm1lbnRzLCBzdXJ2ZWlsbGFuY2VBc3NpZ25tZW50cywgc2VjcmV0YXJpYXRBc3NpZ25tZW50cywgc3VydmVpbGxhbmNlTW9kZSwgZG9jVGVtcGxhdGVzLCBpc0Fub255bWl0eUxvY2tlZF0pOwoKICAgICAgICAgICAgY29uc3QgZ2V0Um9vbU9jY3VwYW5jeSA9IChyb29tSWQpID0+IHN0dWRlbnRzLmZpbHRlcihzID0+IHMucm9vbUlkID09PSByb29tSWQpLmxlbmd0aDsKICAgICAgICAgICAgY29uc3Qgb3Blbk1vZGFsID0gKHRpdGxlLCBtZXNzYWdlLCBhY3Rpb24pID0+IHNldE1vZGFsQ29uZmlnKHsgaXNPcGVuOiB0cnVlLCB0aXRsZSwgbWVzc2FnZSwgb25Db25maXJtOiBhY3Rpb24gfSk7CiAgICAgICAgICAgIGNvbnN0IGNsb3NlTW9kYWwgPSAoKSA9PiBzZXRNb2RhbENvbmZpZyh7IC4uLm1vZGFsQ29uZmlnLCBpc09wZW46IGZhbHNlIH0pOwogICAgICAgICAgICBjb25zdCBoYW5kbGVNb2RhbENvbmZpcm0gPSAoKSA9PiB7IGlmIChtb2RhbENvbmZpZy5vbkNvbmZpcm0pIG1vZGFsQ29uZmlnLm9uQ29uZmlybSgpOyBjbG9zZU1vZGFsKCk7IH07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIZWxwZXJzIHBvdXIgbGUgSW5wdXRNb2RhbCAoQ29ycmVjdGlvbjogZnVuY3Rpb25hbCB1cGRhdGUpCiAgICAgICAgICAgIGNvbnN0IGNsb3NlSW5wdXRNb2RhbCA9ICgpID0+IHNldElucHV0TW9kYWxDb25maWcocHJldiA9PiAoeyAuLi5wcmV2LCBpc09wZW46IGZhbHNlIH0pKTsKCiAgICAgICAgICAgIGNvbnN0IGdldFNjaWVuY2VTdWJqZWN0ID0gKCkgPT4gc3ViamVjdHMuZmluZChzID0+IHMuaWQgPT09IDQpOwoKICAgICAgICAgICAgY29uc3QgdG9nZ2xlU2NpZW5jZURpc2NpcGxpbmUgPSAoZGlzYykgPT4gewogICAgICAgICAgICAgICAgc2V0U3ViamVjdHMocHJldiA9PiBwcmV2Lm1hcChzID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocy5pZCAhPT0gNCkgcmV0dXJuIHM7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHMuZGlzY2lwbGluZXMgfHwgW107CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQuaW5jbHVkZXMoZGlzYykpIHJldHVybiB7IC4uLnMsIGRpc2NpcGxpbmVzOiBjdXJyZW50LmZpbHRlcihkID0+IGQgIT09IGRpc2MpIH07CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7IGlmIChjdXJyZW50Lmxlbmd0aCA+PSAyKSB7IHNob3dOb3RpZmljYXRpb24oIk1heGltdW0gMiBkaXNjaXBsaW5lcyAhIiwgImVycm9yIik7IHJldHVybiBzOyB9IHJldHVybiB7IC4uLnMsIGRpc2NpcGxpbmVzOiBbLi4uY3VycmVudCwgZGlzY10uc29ydCgpIH07IH0KICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUdsb2JhbFJlc2V0ID0gKCkgPT4gewogICAgICAgICAgICAgICAgb3Blbk1vZGFsKCJOb3V2ZWxsZSBTZXNzaW9uIC8gUkFaIiwgIkF0dGVudGlvbiA6IFLDqWluaXRpYWxpc2F0aW9uIGNvbXBsw6h0ZSAhIiwgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFNjaG9vbENvbmZpZyhERUZBVUxUX1NDSE9PTF9DT05GSUcpOyBzZXRSb29tcyhbXSk7IHNldFN0dWRlbnRzKFtdKTsgc2V0VGVhY2hlcnMoW10pOyBzZXRTdWJqZWN0cyhERUZBVUxUX1NVQkpFQ1RTKTsgc2V0VGVhY2hlckFzc2lnbm1lbnRzKHt9KTsgc2V0U3VydmVpbGxhbmNlQXNzaWdubWVudHMoe30pOyBzZXRTZWNyZXRhcmlhdEFzc2lnbm1lbnRzKHt9KTsgc2V0RG9jVGVtcGxhdGVzKERFRkFVTFRfRE9DX1RFTVBMQVRFUyk7IHNldElzQW5vbnltaXR5TG9ja2VkKHRydWUpOyBzaG93Tm90aWZpY2F0aW9uKCJSQVogZWZmZWN0dcOpZSAhIiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gLS0tIE5PVVZFQVUgOiBGT05DVElPTiBEJ0FKT1VUIE1BTlVFTCBERSBTQUxMRSAtLS0KICAgICAgICAgICAgY29uc3QgaGFuZGxlQWRkUm9vbSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChuZXdSb29tLm5hbWUgJiYgbmV3Um9vbS5jYXBhY2l0eSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBzZXRSb29tcyhbLi4ucm9vbXMsIHsgaWQ6IGByb29tLW1hbnVhbC0ke0RhdGUubm93KCl9YCwgbmFtZTogbmV3Um9vbS5uYW1lLCBjYXBhY2l0eTogbmV3Um9vbS5jYXBhY2l0eSwgdHlwZTogJ3N0YW5kYXJkJyB9XSk7CiAgICAgICAgICAgICAgICAgICAgc2V0TmV3Um9vbSh7IG5hbWU6ICcnLCBjYXBhY2l0eTogMjAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbigiU2FsbGUgYWpvdXTDqWUgISIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJOb20gZXQgY2FwYWNpdMOpIHJlcXVpcyIsICJlcnJvciIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gLS0tIE5PVVZFQVUgOiBGT05DVElPTiBDSEFSR0VNRU5UIERFTU8gLS0tCiAgICAgICAgICAgIGNvbnN0IGxvYWRHbG9iYWxEZW1vRGF0YSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIG9wZW5Nb2RhbCgiQ2hhcmdlbWVudCBEw6ltbyIsICJBdHRlbnRpb24gOiBDZWxhIHZhIHJlbXBsYWNlciB0b3V0ZXMgdm9zIGRvbm7DqWVzIGFjdHVlbGxlcyAow6lsw6h2ZXMsIHByb2ZzLCBzYWxsZXMpIHBhciBkZXMgZG9ubsOpZXMgZmljdGl2ZXMuIENvbnRpbnVlciA/IiwgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gU2FsbGVzCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVtb1Jvb21zID0gWwogICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAncjEnLCBuYW1lOiAnU2FsbGUgMTAxJywgY2FwYWNpdHk6IDIwIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdyMicsIG5hbWU6ICdTYWxsZSAxMDInLCBjYXBhY2l0eTogMjAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogJ3IzJywgbmFtZTogJ1NhbGxlIDEwMycsIGNhcGFjaXR5OiAyMCB9LAogICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAncjQnLCBuYW1lOiAnU2FsbGUgMTA0JywgY2FwYWNpdHk6IDE1IH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdyNScsIG5hbWU6ICdQZXJtYW5lbmNlJywgY2FwYWNpdHk6IDMwIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdyNicsIG5hbWU6ICdTYWxsZSBUVCcsIGNhcGFjaXR5OiAxMCB9LAogICAgICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgICAgIC8vIDIuIFByb2Zlc3NldXJzCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViamVjdHNMaXN0ID0gWyJNYXRow6ltYXRpcXVlcyIsICJGcmFuw6dhaXMiLCAiSGlzdG9pcmUtR8OpbyIsICJBbmdsYWlzIiwgIkVzcGFnbm9sIiwgIlNWVCIsICJQaHlzaXF1ZS1DaGltaWUiLCAiVGVjaG5vbG9naWUiLCAiTXVzaXF1ZSIsICJBcnRzIFBsYXN0aXF1ZXMiXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZW1vVGVhY2hlcnMgPSBBcnJheS5mcm9tKHtsZW5ndGg6IDIwfSwgKF8sIGkpID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBgcHJvZi0ke2l9YCwKICAgICAgICAgICAgICAgICAgICAgICAgY2l2OiBpICUgMiA9PT0gMCA/ICJNLiIgOiAiTW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdG5hbWU6IGBQUk9GJHtpKzF9YCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RuYW1lOiAiVGVzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHN1YmplY3RzTGlzdFtpICUgc3ViamVjdHNMaXN0Lmxlbmd0aF0KICAgICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICAgIC8vIDMuIMOJbMOodmVzCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlZElkcyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZW1vU3R1ZGVudHMgPSBBcnJheS5mcm9tKHtsZW5ndGg6IDEwMH0sIChfLCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdWZmaXg7IGxldCBpZDsKICAgICAgICAgICAgICAgICAgICAgICAgZG8geyBzdWZmaXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5OTkpICsgMTsgaWQgPSBgRE5CJHt5ZWFyfSR7U3RyaW5nKHN1ZmZpeCkucGFkU3RhcnQoMywgJzAnKX1gOyB9IHdoaWxlKHVzZWRJZHMuaGFzKGlkKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZWRJZHMuYWRkKGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzVFQgPSBNYXRoLnJhbmRvbSgpIDwgMC4xOyAvLyAxMCUgVGllcnMgVGVtcHMKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzQWVzaCA9IGlzVFQgJiYgTWF0aC5yYW5kb20oKSA8IDAuNTsgLy8gNTAlIGRlcyBUVCBvbnQgdW4gQUVTSAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBgc3R1ZGVudC0ke2l9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RuYW1lOiBgRUxFVkUke2krMX1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RuYW1lOiBgUHLDqW5vbSR7aSsxfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogaSA8IDI1ID8gJzPDqG1lIEEnIDogKGkgPCA1MCA/ICczw6htZSBCJyA6IChpIDwgNzUgPyAnM8OobWUgQycgOiAnM8OobWUgRCcpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVFQ6IGlzVFQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZXNoOiBoYXNBZXNoID8gIkFFU0ggVGVzdCIgOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZTogU3RyaW5nKDEwMDAwMDAwMDAgKyBpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFub255bW91c0lkOiBpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb21JZDogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNldFJvb21zKGRlbW9Sb29tcyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGVhY2hlcnMoZGVtb1RlYWNoZXJzKTsKICAgICAgICAgICAgICAgICAgICBzZXRTdHVkZW50cyhkZW1vU3R1ZGVudHMpOwogICAgICAgICAgICAgICAgICAgIHNldFRlYWNoZXJBc3NpZ25tZW50cyh7fSk7CiAgICAgICAgICAgICAgICAgICAgc2V0U3VydmVpbGxhbmNlQXNzaWdubWVudHMoe30pOwogICAgICAgICAgICAgICAgICAgIHNldFNlY3JldGFyaWF0QXNzaWdubWVudHMoe30pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oIkRvbm7DqWVzIGRlIGTDqW1vbnN0cmF0aW9uIGNoYXJnw6llcyAhIiwgInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gLi4uIChDb3JyZWN0aW9uIGZ1bmN0aW9ucykgLi4uCiAgICAgICAgICAgIGNvbnN0IGlzVGVhY2hlckZvclN1YmplY3QgPSAodGVhY2hlciwgc3ViamVjdCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCF0ZWFjaGVyLnN1YmplY3QpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnN0IHRTdWIgPSB0ZWFjaGVyLnN1YmplY3QudG9VcHBlckNhc2UoKS50cmltKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzTmFtZSA9IHN1YmplY3QubmFtZS50b1VwcGVyQ2FzZSgpLnRyaW0oKTsKICAgICAgICAgICAgICAgIGlmIChzTmFtZS5pbmNsdWRlcygiTUFUSCIpICYmIHRTdWIuaW5jbHVkZXMoIk1BVEgiKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICBpZiAoc05hbWUuaW5jbHVkZXMoIkZSQU7Dh0FJUyIpICYmICh0U3ViLmluY2x1ZGVzKCJGUkFOw4dBSVMiKSB8fCB0U3ViLmluY2x1ZGVzKCJGUkFOQ0FJUyIpIHx8IHRTdWIuaW5jbHVkZXMoIkxFVFRSRSIpKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICBpZiAoKHNOYW1lLmluY2x1ZGVzKCJISVNUT0lSRSIpIHx8IHNOYW1lLmluY2x1ZGVzKCJHRU8iKSB8fCBzTmFtZS5pbmNsdWRlcygiSEciKSkgJiYgKHRTdWIuaW5jbHVkZXMoIkhJU1QiKSB8fCB0U3ViLmluY2x1ZGVzKCJHRU8iKSB8fCB0U3ViLmluY2x1ZGVzKCJIRyIpIHx8IHRTdWIuaW5jbHVkZXMoIkVNQyIpKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICBpZiAoc05hbWUuaW5jbHVkZXMoIlNDSUVOQ0VTIikpIHsgY29uc3QgZGlzY2lwbGluZXMgPSBzdWJqZWN0LmRpc2NpcGxpbmVzIHx8IFtdOyBpZiAodFN1Yi5pbmNsdWRlcygiU0NJRU5DRSIpIHx8IHRTdWIuaW5jbHVkZXMoIlNWVCIpIHx8IHRTdWIuaW5jbHVkZXMoIlBIWSIpIHx8IHRTdWIuaW5jbHVkZXMoIlRFQ0hOTyIpIHx8IHRTdWIuaW5jbHVkZXMoIkNISU1JRSIpKSByZXR1cm4gdHJ1ZTsgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgaGFuZGxlU3ViamVjdFNlbGVjdEZvckNvcnJlY3Rpb24gPSAoc3ViamVjdElkKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJqZWN0ID0gc3ViamVjdHMuZmluZChzID0+IHMuaWQgPT09IHBhcnNlSW50KHN1YmplY3RJZCkpOwogICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdChzdWJqZWN0KTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbGV2YW50VGVhY2hlcnMgPSB0ZWFjaGVycy5maWx0ZXIodCA9PiBpc1RlYWNoZXJGb3JTdWJqZWN0KHQsIHN1YmplY3QpKTsKICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkVGVhY2hlcnNGb3JDb3JyZWN0aW9uKHJlbGV2YW50VGVhY2hlcnMubWFwKHQgPT4gdC5pZCkpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgZGlzdHJpYnV0ZUNvcGllcyA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlVGVhY2hlcnMgPSB0ZWFjaGVycy5maWx0ZXIodCA9PiBzZWxlY3RlZFRlYWNoZXJzRm9yQ29ycmVjdGlvbi5pbmNsdWRlcyh0LmlkKSk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlVGVhY2hlcnMubGVuZ3RoID09PSAwKSB7IHNob3dOb3RpZmljYXRpb24oIkF1Y3VuIHByb2Zlc3NldXIgISIsICJlcnJvciIpOyByZXR1cm47IH0KICAgICAgICAgICAgICAgIGNvbnN0IGFub255bWl6ZWRTdHVkZW50cyA9IHN0dWRlbnRzLmZpbHRlcihzID0+IHMuYW5vbnltb3VzSWQpLnNvcnQoKGEsIGIpID0+IGEuYW5vbnltb3VzSWQubG9jYWxlQ29tcGFyZShiLmFub255bW91c0lkKSk7CiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbENvcGllcyA9IGFub255bWl6ZWRTdHVkZW50cy5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAodG90YWxDb3BpZXMgPT09IDApIHsgc2hvd05vdGlmaWNhdGlvbigiQXVjdW4gw6lsw6h2ZSBhbm9ueW1lICEiLCAiZXJyb3IiKTsgcmV0dXJuOyB9CiAgICAgICAgICAgICAgICBjb25zdCBiYXNlQ291bnQgPSBNYXRoLmZsb29yKHRvdGFsQ29waWVzIC8gYWN0aXZlVGVhY2hlcnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbWFpbmRlciA9IHRvdGFsQ29waWVzICUgYWN0aXZlVGVhY2hlcnMubGVuZ3RoOwogICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRJbmRleCA9IDA7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdBc3NpZ25tZW50cyA9IGFjdGl2ZVRlYWNoZXJzLm1hcCgodGVhY2hlciwgaWR4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBiYXNlQ291bnQgKyAoaWR4IDwgcmVtYWluZGVyID8gMSA6IDApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0SWR4ID0gY3VycmVudEluZGV4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZElkeCA9IGN1cnJlbnRJbmRleCArIGNvdW50IC0gMTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXggKz0gY291bnQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgdGVhY2hlcklkOiB0ZWFjaGVyLmlkLCB0ZWFjaGVyTmFtZTogYCR7dGVhY2hlci5sYXN0bmFtZX0gJHt0ZWFjaGVyLmZpcnN0bmFtZX1gLCBjb3VudDogY291bnQsIHN0YXJ0UmFuazogc3RhcnRJZHggKyAxLCBlbmRSYW5rOiBlbmRJZHggKyAxLCBzdGFydEFub255bTogYW5vbnltaXplZFN0dWRlbnRzW3N0YXJ0SWR4XT8uYW5vbnltb3VzSWQgfHwgJz8nLCBlbmRBbm9ueW06IGFub255bWl6ZWRTdHVkZW50c1tlbmRJZHhdPy5hbm9ueW1vdXNJZCB8fCAnPycgfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2V0VGVhY2hlckFzc2lnbm1lbnRzKHByZXYgPT4gKHsgLi4ucHJldiwgW3NlbGVjdGVkQ29ycmVjdGlvblN1YmplY3QuaWRdOiBuZXdBc3NpZ25tZW50cyB9KSk7CiAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJSw6lwYXJ0aXRpb24gY2FsY3Vsw6llICEiKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZU1hbnVhbEFzc2lnbm1lbnQgPSAoaWR4LCBmaWVsZCwgdmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGlmICghc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFzc2lnbm1lbnRzID0gWy4uLih0ZWFjaGVyQXNzaWdubWVudHNbc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdC5pZF0gfHwgW10pXTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZCA9PT0gJ2NvdW50JykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ZhbCA9IHBhcnNlSW50KHZhbHVlKSB8fCAwOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBc3NpZ25tZW50c1tpZHhdLmNvdW50ID0gbmV3VmFsOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFub255bWl6ZWRTdHVkZW50cyA9IHN0dWRlbnRzLmZpbHRlcihzID0+IHMuYW5vbnltb3VzSWQpLnNvcnQoKGEsIGIpID0+IGEuYW5vbnltb3VzSWQubG9jYWxlQ29tcGFyZShiLmFub255bW91c0lkKSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRSYW5rID0gMDsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXNzaWdubWVudHMuZm9yRWFjaChhc3NpZ24gPT4gewogICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ24uc3RhcnRSYW5rID0gY3VycmVudFJhbmsgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ24uZW5kUmFuayA9IGN1cnJlbnRSYW5rICsgYXNzaWduLmNvdW50OwogICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ24uc3RhcnRBbm9ueW0gPSBhbm9ueW1pemVkU3R1ZGVudHNbYXNzaWduLnN0YXJ0UmFuayAtIDFdPy5hbm9ueW1vdXNJZCB8fCAoYXNzaWduLmNvdW50ID4gMCA/ICc/JyA6ICctJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbi5lbmRBbm9ueW0gPSBhbm9ueW1pemVkU3R1ZGVudHNbYXNzaWduLmVuZFJhbmsgLSAxXT8uYW5vbnltb3VzSWQgfHwgKGFzc2lnbi5jb3VudCA+IDAgPyAnPycgOiAnLScpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UmFuayArPSBhc3NpZ24uY291bnQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRUZWFjaGVyQXNzaWdubWVudHMocHJldiA9PiAoeyAuLi5wcmV2LCBbc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdC5pZF06IGN1cnJlbnRBc3NpZ25tZW50cyB9KSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyAuLi4gKEltcG9ydHMvRXhwb3J0cy9EYXRhIGhhbmRsaW5nKSAuLi4KICAgICAgICAgICAgY29uc3QgaGFuZGxlTG9nb1VwbG9hZCA9IChlKSA9PiB7IAogICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdOyAKICAgICAgICAgICAgICAgIGlmIChmaWxlKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7IAogICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiB7IAogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3V2ZWF1IGNhbGN1bCBkdSByYXRpbyBsb2dvCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBpbWcud2lkdGggLyBpbWcuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2Nob29sQ29uZmlnKHByZXYgPT4gKHsgLi4ucHJldiwgbG9nb1VybDogcmVhZGVyLnJlc3VsdCwgbG9nb1JhdGlvOiByYXRpbyB9KSk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbigiTG9nbyBpbXBvcnTDqSAhIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGltZy5zcmMgPSByZWFkZXIucmVzdWx0OwogICAgICAgICAgICAgICAgICAgIH07IAogICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOyAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVN0YW1wVXBsb2FkID0gKGUpID0+IHsgCiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07IAogICAgICAgICAgICAgICAgaWYgKGZpbGUpIHsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsgCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9ICgpID0+IHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBpbWcud2lkdGggLyBpbWcuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2Nob29sQ29uZmlnKHByZXYgPT4gKHsgLi4ucHJldiwgc3RhbXBVcmw6IHJlYWRlci5yZXN1bHQsIHN0YW1wUmF0aW86IHJhdGlvIH0pKTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJDYWNoZXQgaW1wb3J0w6kgISIpOyAKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IHJlYWRlci5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgfTsgCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7IAogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgfTsgCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUFkZFN1YmplY3QgPSAoKSA9PiB7IGlmIChuZXdTdWJqZWN0Lm5hbWUgJiYgbmV3U3ViamVjdC5kYXRlKSB7IHNldFN1YmplY3RzKFsuLi5zdWJqZWN0cywgeyAuLi5uZXdTdWJqZWN0LCBpZDogRGF0ZS5ub3coKSB9XSk7IHNldE5ld1N1YmplY3QoeyBuYW1lOiAnJywgZGF0ZTogJycsIHRpbWU6ICcnLCB0aW1lVFQ6ICcnIH0pOyBzaG93Tm90aWZpY2F0aW9uKCLDiXByZXV2ZSBham91dMOpZSAhIik7IH0gfTsKICAgICAgICAgICAgY29uc3QgaGFuZGxlRGVsZXRlU3ViamVjdCA9IChpZCkgPT4geyBzZXRTdWJqZWN0cyhzdWJqZWN0cy5maWx0ZXIocyA9PiBzLmlkICE9PSBpZCkpOyB9OwogICAgICAgICAgICBjb25zdCBoYW5kbGVVcGRhdGVTdWJqZWN0ID0gKGlkLCBmaWVsZCwgdmFsdWUpID0+IHsgc2V0U3ViamVjdHMoc3ViamVjdHMubWFwKHMgPT4gcy5pZCA9PT0gaWQgPyB7IC4uLnMsIFtmaWVsZF06IHZhbHVlIH0gOiBzKSk7IH07CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVVwZGF0ZVN0dWRlbnQgPSAoaWQsIGZpZWxkLCB2YWx1ZSkgPT4geyBzZXRTdHVkZW50cyhzdHVkZW50cy5tYXAocyA9PiBzLmlkID09PSBpZCA/IHsgLi4ucywgW2ZpZWxkXTogdmFsdWUgfSA6IHMpKTsgfTsKICAgICAgICAgICAgY29uc3QgaGFuZGxlRGVsZXRlU3R1ZGVudCA9IChpZCkgPT4geyBvcGVuTW9kYWwoIlN1cHByZXNzaW9uIiwgIlZvdWxlei12b3VzIHZyYWltZW50IHN1cHByaW1lciBjZXQgw6lsw6h2ZSA/IiwgKCkgPT4geyBzZXRTdHVkZW50cyhwcmV2ID0+IHByZXYuZmlsdGVyKHMgPT4gcy5pZCAhPT0gaWQpKTsgc2hvd05vdGlmaWNhdGlvbigiw4lsw6h2ZSBzdXBwcmltw6kuIiwgInN1Y2Nlc3MiKTsgfSk7IH07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGb25jdGlvbiBwb3VyIG1ldHRyZSDDoCBqb3VyIGwnaG9yYWlyZSBldCBzeW5jaHJvbmlzZXIgbGUgVFQKICAgICAgICAgICAgY29uc3QgaGFuZGxlVGltZVVwZGF0ZSA9IChzdWJqZWN0SWQsIHR5cGUsIG5ld1N0YXJ0LCBuZXdFbmQpID0+IHsKICAgICAgICAgICAgICAgIC8vIENvbnN0cnVjdGlvbiBkZSBsYSBub3V2ZWxsZSBwbGFnZSBicnV0ZQogICAgICAgICAgICAgICAgY29uc3QgbmV3UmFuZ2UgPSBgJHtuZXdTdGFydH0gLSAke25ld0VuZH1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZXRTdWJqZWN0cyhwcmV2U3ViamVjdHMgPT4gcHJldlN1YmplY3RzLm1hcChzdWIgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChzdWIuaWQgIT09IHN1YmplY3RJZCkgcmV0dXJuIHN1YjsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgdXBkYXRlcyA9IHsgLi4uc3ViLCBbdHlwZV06IG5ld1JhbmdlIH07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsIGRlIGxhIGR1csOpZSBkZSBsJ8OpcHJldXZlIHN0YW5kYXJkIGFjdHVlbGxlIChvdSBub3V2ZWxsZSBzaSBjJ2VzdCBjZSBxdSdvbiBtb2RpZmllKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ZFJhbmdlVG9DaGVjayA9IHR5cGUgPT09ICd0aW1lJyA/IG5ld1JhbmdlIDogc3ViLnRpbWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RkUGFydHMgPSBwYXJzZVRpbWVSYW5nZShzdGRSYW5nZVRvQ2hlY2spOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ZFN0YXJ0TWlucyA9IHRpbWVUb01pbnV0ZXMoc3RkUGFydHMuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ZEVuZE1pbnMgPSB0aW1lVG9NaW51dGVzKHN0ZFBhcnRzLmVuZCk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN0ZER1cmF0aW9uID0gc3RkRW5kTWlucyAtIHN0ZFN0YXJ0TWluczsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RkRHVyYXRpb24gPCAwKSBzdGREdXJhdGlvbiArPSAyNCAqIDYwOyAvLyBHZXN0aW9uIG51aXQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWwgZGUgbGEgZHVyw6llIHRow6lvcmlxdWUgZHUgVGllcnMtVGVtcHMgKER1csOpZSB4IDEuMzMpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHREdXJhdGlvbiA9IE1hdGguY2VpbChzdGREdXJhdGlvbiAqIDQgLyAzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gTE9HSVFVRSBEJ0FEQVBUQVRJT04KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3RpbWUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhcyAxIDogT24gbW9kaWZpZSBsJ2hvcmFpcmUgU1RBTkRBUkQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLT4gTGUgZMOpYnV0IFRUIHMnYWxpZ25lIHN1ciBsZSBkw6lidXQgU3RhbmRhcmQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLT4gTGEgZmluIFRUIGVzdCByZWNhbGN1bMOpZSAoRMOpYnV0ICsgRHVyw6llIFRUKQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0dEVuZE1pbnMgPSBzdGRTdGFydE1pbnMgKyB0dER1cmF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0dEVuZCA9IG1pbnV0ZXNUb1RpbWUodHRFbmRNaW5zKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlcy50aW1lVFQgPSBgJHtzdGRQYXJ0cy5zdGFydH0gLSAke3R0RW5kfWA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAndGltZVRUJykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBDYXMgMiA6IE9uIG1vZGlmaWUgbGUgZMOpYnV0IGR1IFRUIE1BTlVFTExFTUVOVCAoVm90cmUgZGVtYW5kZSkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLT4gT24gcHJlbmQgbGUgTk9VVkVBVSBkw6lidXQgc2Fpc2kKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLT4gT24gcmVjYWxjdWxlIGxhIGZpbiBwb3VyIGdhcmFudGlyIHF1ZSBsYSBkdXLDqWUgVFQgZXN0IHJlc3BlY3TDqWUKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHROZXdTdGFydE1pbnMgPSB0aW1lVG9NaW51dGVzKG5ld1N0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHROZXdFbmRNaW5zID0gdHROZXdTdGFydE1pbnMgKyB0dER1cmF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0dE5ld0VuZCA9IG1pbnV0ZXNUb1RpbWUodHROZXdFbmRNaW5zKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlcy50aW1lVFQgPSBgJHtuZXdTdGFydH0gLSAke3R0TmV3RW5kfWA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVzOwogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gR2VzdGlvbiBkdSBjaGFuZ2VtZW50IGRlIGRhdGUgdmlhIGNhbGVuZHJpZXIKICAgICAgICAgICAgY29uc3QgaGFuZGxlRGF0ZUNoYW5nZSA9IChpZCwgaXNvRGF0ZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZnJlbmNoRGF0ZSA9IGZvcm1hdERhdGVUb0ZyZW5jaFN0cmluZyhpc29EYXRlKTsKICAgICAgICAgICAgICAgIGlmIChpZCA9PT0gJ25ldycpIHsKICAgICAgICAgICAgICAgICAgICBzZXROZXdTdWJqZWN0KHsuLi5uZXdTdWJqZWN0LCBkYXRlOiBmcmVuY2hEYXRlfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVVwZGF0ZVN1YmplY3QoaWQsICdkYXRlJywgZnJlbmNoRGF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCB0cmlnZ2VyQXV0b1RUID0gKHN1YmplY3RJZCkgPT4gewogICAgICAgICAgICAgICAgc2V0U3ViamVjdHMocHJldiA9PiBwcmV2Lm1hcChzID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAocy5pZCAhPT0gc3ViamVjdElkKSByZXR1cm4gczsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHN0YXJ0LCBlbmQgfSA9IHBhcnNlVGltZVJhbmdlKHMudGltZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXV0b1RUID0gY2FsY3VsYXRlQXV0b1RUKHN0YXJ0LCBlbmQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnMsIHRpbWVUVDogYXV0b1RUIH07CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJUaWVycy1UZW1wcyBjYWxjdWzDqSAoRHVyw6llIHggMS4zMykiKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZURlbGV0ZVJvb20gPSAoaWQpID0+IHsgb3Blbk1vZGFsKCJTdXBwcmVzc2lvbiIsICJWb3VsZXotdm91cyB2cmFpbWVudCBzdXBwcmltZXIgY2V0dGUgc2FsbGUgPyIsICgpID0+IHsgc2V0Um9vbXMocHJldiA9PiBwcmV2LmZpbHRlcihyID0+IHIuaWQgIT09IGlkKSk7IHNob3dOb3RpZmljYXRpb24oIlNhbGxlIHN1cHByaW3DqWUuIiwgInN1Y2Nlc3MiKTsgfSk7IH07CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCByZWdlbmVyYXRlQW5vbnltaXR5ID0gKCkgPT4geyAKICAgICAgICAgICAgICAgIGlmIChpc0Fub255bWl0eUxvY2tlZCkgeyAKICAgICAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJEw6l2ZXJyb3VpbGxleiBkJ2Fib3JkICEiLCAiZXJyb3IiKTsgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBjb25zdCB5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOyAKICAgICAgICAgICAgICAgIGNvbnN0IHVzZWRJZHMgPSBuZXcgU2V0KCk7IAogICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0dWRlbnRzID0gc3R1ZGVudHMubWFwKChzKSA9PiB7IAogICAgICAgICAgICAgICAgICAgIGxldCBzdWZmaXg7IAogICAgICAgICAgICAgICAgICAgIGxldCBuZXdJZDsgCiAgICAgICAgICAgICAgICAgICAgbGV0IGF0dGVtcHRzID0gMDsgCiAgICAgICAgICAgICAgICAgICAgZG8geyAKICAgICAgICAgICAgICAgICAgICAgICAgc3VmZml4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOTk5KSArIDE7IAogICAgICAgICAgICAgICAgICAgICAgICBuZXdJZCA9IGBETkIke3llYXJ9JHtTdHJpbmcoc3VmZml4KS5wYWRTdGFydCgzLCAnMCcpfWA7IAogICAgICAgICAgICAgICAgICAgICAgICBhdHRlbXB0cysrOyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXR0ZW1wdHMgPiA1MDAwKSBicmVhazsgCiAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAodXNlZElkcy5oYXMobmV3SWQpKTsgCiAgICAgICAgICAgICAgICAgICAgdXNlZElkcy5hZGQobmV3SWQpOyAKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5zLCBhbm9ueW1vdXNJZDogbmV3SWQgfTsgCiAgICAgICAgICAgICAgICB9KTsgCiAgICAgICAgICAgICAgICBzZXRTdHVkZW50cyh1cGRhdGVkU3R1ZGVudHMpOyAKICAgICAgICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oIkFub255bWF0IHLDqWfDqW7DqXLDqSAhIik7IAogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgaGFuZGxlRmlsZVVwbG9hZCA9IChlLCB0eXBlKSA9PiB7IGNvbnN0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTsgaWYgKCFmaWxlKSByZXR1cm47IGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7IHJlYWRlci5vbmxvYWQgPSAoZXZ0KSA9PiB7IGNvbnN0IGJzdHIgPSBldnQudGFyZ2V0LnJlc3VsdDsgY29uc3Qgd2IgPSBYTFNYLnJlYWQoYnN0ciwgeyB0eXBlOiAnYmluYXJ5JyB9KTsgY29uc3Qgd3NuYW1lID0gd2IuU2hlZXROYW1lc1swXTsgY29uc3Qgd3MgPSB3Yi5TaGVldHNbd3NuYW1lXTsgY29uc3QgZGF0YSA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3cywgeyBoZWFkZXI6IDEgfSk7IGlmICh0eXBlID09PSAnc3R1ZGVudHMnKSBwcm9jZXNzU3R1ZGVudERhdGEoZGF0YSk7IGVsc2UgaWYgKHR5cGUgPT09ICdyb29tcycpIHByb2Nlc3NSb29tRGF0YShkYXRhKTsgZWxzZSBpZiAodHlwZSA9PT0gJ3RlYWNoZXJzJykgcHJvY2Vzc1RlYWNoZXJEYXRhKGRhdGEpOyB9OyByZWFkZXIucmVhZEFzQmluYXJ5U3RyaW5nKGZpbGUpOyB9OwogICAgICAgICAgICBjb25zdCBoYW5kbGVFeHBvcnQgPSAodHlwZSkgPT4geyAKICAgICAgICAgICAgICAgIGxldCBkYXRhID0gW107IAogICAgICAgICAgICAgICAgbGV0IGZpbGVuYW1lID0gIiI7IAogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzdHVkZW50cycpIHsgCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHN0dWRlbnRzLm1hcChzID0+ICh7ICJOb20iOiBzLmxhc3RuYW1lLCAiUHLDqW5vbSI6IHMuZmlyc3RuYW1lLCAiQ2xhc3NlIjogcy5jbGFzcywgIlRpZXJzIFRlbXBzIjogcy5pc1RUID8gIk9VSSIgOiAiTk9OIiwgIkFFU0giOiBzLmFlc2ggfHwgIiIsICJJTkUiOiBzLmluZSB8fCAiIiwgIkFub255bWF0Ijogcy5hbm9ueW1vdXNJZCwgIlNhbGxlIjogcm9vbXMuZmluZChyID0+IHIuaWQgPT09IHMucm9vbUlkKT8ubmFtZSB8fCAiIiB9KSk7IAogICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gImV4cG9ydF9lbGV2ZXMueGxzeCI7IAogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAncm9vbXMnKSB7IAogICAgICAgICAgICAgICAgICAgIGRhdGEgPSByb29tcy5tYXAociA9PiAoeyAiTm9tIjogci5uYW1lLCAiQ2FwYWNpdMOpIjogci5jYXBhY2l0eSwgIk9jY3Vww6kiOiBnZXRSb29tT2NjdXBhbmN5KHIuaWQpIH0pKTsgCiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUgPSAiZXhwb3J0X3NhbGxlcy54bHN4IjsgCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICd0ZWFjaGVycycpIHsgCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHRlYWNoZXJzLm1hcCh0ID0+ICh7ICJDaXZpbGl0w6kiOiB0LmNpdiwgIk5vbSI6IHQubGFzdG5hbWUsICJQcsOpbm9tIjogdC5maXJzdG5hbWUsICJEaXNjaXBsaW5lIjogdC5zdWJqZWN0IH0pKTsgCiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUgPSAiZXhwb3J0X3Byb2Zlc3NldXJzLnhsc3giOyAKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2NvcHlfbGFiZWxzJyB8fCB0eXBlID09PSAnY29weV9sYWJlbHNfc2luZ2xlJykgeyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJqZWN0c1RvRXhwb3J0ID0gKHR5cGUgPT09ICdjb3B5X2xhYmVsc19zaW5nbGUnICYmIHNlbGVjdGVkQ29ycmVjdGlvblN1YmplY3QpID8gW3NlbGVjdGVkQ29ycmVjdGlvblN1YmplY3RdIDogc3ViamVjdHM7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRTdHVkZW50cyA9IHN0dWRlbnRzLmZpbHRlcihzID0+IHMuYW5vbnltb3VzSWQpLnNvcnQoKGEsIGIpID0+IGEubGFzdG5hbWUubG9jYWxlQ29tcGFyZShiLmxhc3RuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgc3ViamVjdHNUb0V4cG9ydC5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1Yk5hbWUgPSAoc3ViLmRpc2NpcGxpbmVzICYmIHN1Yi5kaXNjaXBsaW5lcy5sZW5ndGggPiAwKSA/IGAke3N1Yi5uYW1lfSAoJHtzdWIuZGlzY2lwbGluZXMuam9pbignLScpfSlgIDogc3ViLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkU3R1ZGVudHMuZm9yRWFjaChzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh7ICJOwrAgQ2FuZGlkYXQiOiBzLmluZSB8fCAiIiwgIk7CsCBBbm9ueW1hdCI6IHMuYW5vbnltb3VzSWQsICJNYXRpw6hyZSI6IHN1Yk5hbWUsICJOb20iOiBzLmxhc3RuYW1lLCAiUHLDqW5vbSI6IHMuZmlyc3RuYW1lLCAiQ2xhc3NlIjogcy5jbGFzcyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUgPSAiZXhwb3J0X2V0aXF1ZXR0ZXNfY29waWVzLnhsc3giOyAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdzID0gWExTWC51dGlscy5qc29uX3RvX3NoZWV0KGRhdGEpOyAKICAgICAgICAgICAgICAgICAgICBjb25zdCB3YiA9IFhMU1gudXRpbHMuYm9va19uZXcoKTsgCiAgICAgICAgICAgICAgICAgICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3MsICJEb25uw6llcyIpOyAKICAgICAgICAgICAgICAgICAgICBYTFNYLndyaXRlRmlsZSh3YiwgZmlsZW5hbWUpOyAKICAgICAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uKCJFeHBvcnQgdGVybWluw6kgISIpOyAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NTdHVkZW50RGF0YSA9IChyb3dzKSA9PiB7IGNvbnN0IG5ld1N0dWRlbnRzID0gW107IGNvbnN0IGhlYWRlcnMgPSByb3dzWzBdLm1hcChoID0+IFN0cmluZyhoKS50b0xvd2VyQ2FzZSgpKTsgY29uc3QgaWR4Tm9tID0gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCdub20nKSk7IGNvbnN0IGlkeFByZW5vbSA9IGhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygncHLDqW5vbScpIHx8IGguaW5jbHVkZXMoJ3ByZW5vbScpKTsgY29uc3QgaWR4Q2xhc3NlID0gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCdjbGFzc2UnKSB8fCBoLmluY2x1ZGVzKCdkaXYnKSk7IGNvbnN0IGlkeFRUID0gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCd0dCcpIHx8IGguaW5jbHVkZXMoJ2ViZXAnKSB8fCBoLmluY2x1ZGVzKCd0aWVycycpKTsgY29uc3QgaWR4SW5lID0gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCdpbmUnKSB8fCBoLmluY2x1ZGVzKCdudW1lcm8nKSk7IGNvbnN0IGlkeEFlc2ggPSBoZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoJ2Flc2gnKSB8fCBoLmluY2x1ZGVzKCdhdnMnKSk7IGlmIChpZHhOb20gPT09IC0xKSByZXR1cm47IGNvbnN0IGN1cnJlbnRZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOyBjb25zdCB1c2VkSWRzID0gbmV3IFNldCgpOyBmb3IgKGxldCBpID0gMTsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHsgY29uc3Qgcm93ID0gcm93c1tpXTsgaWYgKHJvd1tpZHhOb21dKSB7IGxldCBzdWZmaXgsIGFub255bUlkOyBkbyB7IHN1ZmZpeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5OSkgKyAxOyBhbm9ueW1JZCA9IGBETkIke2N1cnJlbnRZZWFyfSR7U3RyaW5nKHN1ZmZpeCkucGFkU3RhcnQoMywgJzAnKX1gOyB9IHdoaWxlICh1c2VkSWRzLmhhcyhhbm9ueW1JZCkpOyB1c2VkSWRzLmFkZChhbm9ueW1JZCk7IG5ld1N0dWRlbnRzLnB1c2goeyBpZDogaSwgbGFzdG5hbWU6IHJvd1tpZHhOb21dLCBmaXJzdG5hbWU6IHJvd1tpZHhQcmVub21dIHx8ICcnLCBjbGFzczogcm93W2lkeENsYXNzZV0gfHwgJzPDqG1lJywgaXNUVDogaWR4VFQgPiAtMSA/ICghIXJvd1tpZHhUVF0pIDogZmFsc2UsIGFub255bW91c0lkOiBhbm9ueW1JZCwgcm9vbUlkOiBudWxsLCBpbmU6IGlkeEluZSA+IC0xID8gcm93W2lkeEluZV0gOiAnJywgYWVzaDogaWR4QWVzaCA+IC0xID8gcm93W2lkeEFlc2hdIDogJycgfSk7IH0gfSBuZXdTdHVkZW50cy5zb3J0KChhLCBiKSA9PiBhLmxhc3RuYW1lLmxvY2FsZUNvbXBhcmUoYi5sYXN0bmFtZSkpOyBzZXRTdHVkZW50cyhuZXdTdHVkZW50cyk7IHNob3dOb3RpZmljYXRpb24oYCR7bmV3U3R1ZGVudHMubGVuZ3RofSDDqWzDqHZlcyBpbXBvcnTDqXMuYCk7IH07CiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NSb29tRGF0YSA9IChyb3dzKSA9PiB7IGNvbnN0IG5ld1Jvb21zID0gW107IGZvciAobGV0IGkgPSAxOyBpIDwgcm93cy5sZW5ndGg7IGkrKykgeyBjb25zdCByb3cgPSByb3dzW2ldOyBpZiAocm93WzBdKSBuZXdSb29tcy5wdXNoKHsgaWQ6IGByb29tLSR7aX1gLCBuYW1lOiByb3dbMF0sIGNhcGFjaXR5OiBwYXJzZUludChyb3dbMV0pIHx8IDIwLCBhc3NpZ25lZENvdW50OiAwLCB0eXBlOiAnc3RhbmRhcmQnIH0pOyB9IHNldFJvb21zKG5ld1Jvb21zKTsgc2hvd05vdGlmaWNhdGlvbihgJHtuZXdSb29tcy5sZW5ndGh9IHNhbGxlcyBpbXBvcnTDqWVzLmApOyB9OwogICAgICAgICAgICBjb25zdCBwcm9jZXNzVGVhY2hlckRhdGEgPSAocm93cykgPT4geyBjb25zdCBuZXdUZWFjaGVycyA9IFtdOyBjb25zdCBoZWFkZXJzID0gcm93c1swXS5tYXAoaCA9PiBTdHJpbmcoaCkudG9Mb3dlckNhc2UoKSk7IGNvbnN0IGlkeE5vbSA9IGhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygnbm9tJykpOyBjb25zdCBpZHhQcmVub20gPSBoZWFkZXJzLmZpbmRJbmRleChoID0+IGguaW5jbHVkZXMoJ3Byw6lub20nKSk7IGNvbnN0IGlkeENpdiA9IGhlYWRlcnMuZmluZEluZGV4KGggPT4gaC5pbmNsdWRlcygnY2l2JykpOyBjb25zdCBpZHhEaXNjID0gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBoLmluY2x1ZGVzKCdkaXNjaXBsaW5lJykpOyBpZiAoaWR4Tm9tID09PSAtMSkgcmV0dXJuOyBmb3IgKGxldCBpID0gMTsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHsgY29uc3Qgcm93ID0gcm93c1tpXTsgaWYgKHJvd1tpZHhOb21dKSBuZXdUZWFjaGVycy5wdXNoKHsgaWQ6IGBwcm9mLSR7aX1gLCBjaXY6IGlkeENpdiA+IC0xID8gcm93W2lkeENpdl0gOiAnJywgbGFzdG5hbWU6IHJvd1tpZHhOb21dLCBmaXJzdG5hbWU6IGlkeFByZW5vbSA+IC0xID8gcm93W2lkeFByZW5vbV0gOiAnJywgc3ViamVjdDogaWR4RGlzYyA+IC0xID8gcm93W2lkeERpc2NdIDogJ05vbiBkw6lmaW5pJyB9KTsgfSBzZXRUZWFjaGVycyhuZXdUZWFjaGVycyk7IHNob3dOb3RpZmljYXRpb24oYCR7bmV3VGVhY2hlcnMubGVuZ3RofSBwcm9mZXNzZXVycyBpbXBvcnTDqXMuYCk7IH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVEcmFnU3RhcnQgPSAoZSwgc3R1ZGVudElkKSA9PiB7IHNldERyYWdnZWRTdHVkZW50SWQoc3R1ZGVudElkKTsgZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICJtb3ZlIjsgfTsKICAgICAgICAgICAgY29uc3QgaGFuZGxlRHJhZ092ZXIgPSAoZSkgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QuYWRkKCdkcmFnLW92ZXInKTsgfTsKICAgICAgICAgICAgY29uc3QgaGFuZGxlRHJhZ0xlYXZlID0gKGUpID0+IHsgZS5jdXJyZW50VGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWctb3ZlcicpOyB9OwogICAgICAgICAgICBjb25zdCBoYW5kbGVEcm9wID0gKGUsIHJvb21JZCkgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnLW92ZXInKTsgaWYgKGRyYWdnZWRTdHVkZW50SWQgIT09IG51bGwpIHsgaGFuZGxlTWFudWFsQXNzaWduKGRyYWdnZWRTdHVkZW50SWQsIHJvb21JZCk7IHNldERyYWdnZWRTdHVkZW50SWQobnVsbCk7IH0gfTsKICAgICAgICAgICAgY29uc3QgZXhlY3V0ZUFzc2lnbm1lbnQgPSAoc3R1ZGVudElkLCB0YXJnZXRSb29tSWQpID0+IHsgc2V0U3R1ZGVudHMocHJldiA9PiBwcmV2Lm1hcChzID0+IHMuaWQgPT09IHN0dWRlbnRJZCA/IHsgLi4ucywgcm9vbUlkOiB0YXJnZXRSb29tSWQgfSA6IHMpKTsgfTsKICAgICAgICAgICAgY29uc3QgaGFuZGxlTWFudWFsQXNzaWduID0gKHN0dWRlbnRJZCwgcm9vbUlkKSA9PiB7IGNvbnN0IHRhcmdldFJvb21JZCA9IHJvb21JZCA9PT0gIiIgPyBudWxsIDogcm9vbUlkOyBpZiAodGFyZ2V0Um9vbUlkKSB7IGNvbnN0IHJvb20gPSByb29tcy5maW5kKHIgPT4gci5pZCA9PT0gdGFyZ2V0Um9vbUlkKTsgY29uc3QgY3VycmVudE9jY3VwYW5jeSA9IGdldFJvb21PY2N1cGFuY3kodGFyZ2V0Um9vbUlkKTsgY29uc3Qgc3R1ZGVudCA9IHN0dWRlbnRzLmZpbmQocyA9PiBzLmlkID09PSBzdHVkZW50SWQpOyBpZiAoY3VycmVudE9jY3VwYW5jeSA+PSByb29tLmNhcGFjaXR5ICYmIHN0dWRlbnQucm9vbUlkICE9PSB0YXJnZXRSb29tSWQpIHsgb3Blbk1vZGFsKCJDYXBhY2l0w6kgZMOpcGFzc8OpZSIsIGBMYSBzYWxsZSAke3Jvb20ubmFtZX0gZXN0IHBsZWluZS4gQWpvdXRlciBxdWFuZCBtw6ptZSA/YCwgKCkgPT4gZXhlY3V0ZUFzc2lnbm1lbnQoc3R1ZGVudElkLCB0YXJnZXRSb29tSWQpKTsgcmV0dXJuOyB9IH0gZXhlY3V0ZUFzc2lnbm1lbnQoc3R1ZGVudElkLCB0YXJnZXRSb29tSWQpOyB9OwogICAgICAgICAgICBjb25zdCBkaXN0cmlidXRlU3R1ZGVudHMgPSAoKSA9PiB7IGlmIChzdHVkZW50cy5sZW5ndGggPT09IDAgfHwgcm9vbXMubGVuZ3RoID09PSAwKSB7IHNob3dOb3RpZmljYXRpb24oIkRvbm7DqWVzIG1hbnF1YW50ZXMuIiwgImVycm9yIik7IHJldHVybjsgfSBjb25zdCBuZXdTdHVkZW50cyA9IHN0dWRlbnRzLm1hcChzID0+ICh7IC4uLnMsIHJvb21JZDogbnVsbCB9KSk7IGNvbnN0IHNvcnRlZFJvb21zID0gWy4uLnJvb21zXS5zb3J0KChhLCBiKSA9PiBhLmNhcGFjaXR5IC0gYi5jYXBhY2l0eSk7IGNvbnN0IHR0U3R1ZGVudHMgPSBuZXdTdHVkZW50cy5maWx0ZXIocyA9PiBzLmlzVFQpOyBjb25zdCBzdGRTdHVkZW50cyA9IG5ld1N0dWRlbnRzLmZpbHRlcihzID0+ICFzLmlzVFQpOyBjb25zdCBmaWxsID0gKGdyb3VwLCByTGlzdCkgPT4geyBsZXQgaWR4ID0gMDsgZ3JvdXAuZm9yRWFjaChzID0+IHsgbGV0IHBsYWNlZCA9IGZhbHNlOyB3aGlsZSAoIXBsYWNlZCAmJiBpZHggPCByTGlzdC5sZW5ndGgpIHsgY29uc3QgciA9IHJMaXN0W2lkeCAlIHJMaXN0Lmxlbmd0aF07IGlmIChuZXdTdHVkZW50cy5maWx0ZXIoc3QgPT4gc3Qucm9vbUlkID09PSByLmlkKS5sZW5ndGggPCByLmNhcGFjaXR5KSB7IGNvbnN0IHNpID0gbmV3U3R1ZGVudHMuZmluZEluZGV4KHggPT4geC5pZCA9PT0gcy5pZCk7IG5ld1N0dWRlbnRzW3NpXS5yb29tSWQgPSByLmlkOyBwbGFjZWQgPSB0cnVlOyB9IGVsc2UgeyBpZHgrKzsgfSB9IH0pOyB9OyBmaWxsKHR0U3R1ZGVudHMsIHNvcnRlZFJvb21zKTsgZmlsbChzdGRTdHVkZW50cywgWy4uLnJvb21zXS5zb3J0KChhLCBiKSA9PiBiLmNhcGFjaXR5IC0gYS5jYXBhY2l0eSkpOyBzZXRTdHVkZW50cyhuZXdTdHVkZW50cyk7IHNob3dOb3RpZmljYXRpb24oIlLDqXBhcnRpdGlvbiB0ZXJtaW7DqWUuIik7IH07CiAgICAgICAgICAgIGNvbnN0IHJlc2V0RGlzdHJpYnV0aW9uID0gKCkgPT4geyBvcGVuTW9kYWwoIlLDqWluaXRpYWxpc2F0aW9uIiwgIlZpZGVyIGxlcyBzYWxsZXMgPyIsICgpID0+IHsgc2V0U3R1ZGVudHMocHJldiA9PiBwcmV2Lm1hcChzID0+ICh7IC4uLnMsIHJvb21JZDogbnVsbCB9KSkpOyBzaG93Tm90aWZpY2F0aW9uKCJTYWxsZXMgdmlkw6llcyAhIik7IH0pOyB9OwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgaGFuZGxlU2F2ZVdvcmsgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBkZWZhdWx0TmFtZSA9IGBkbmJfYmFja3VwX3YxMV8ke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKX1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZXRJbnB1dE1vZGFsQ29uZmlnKHsKICAgICAgICAgICAgICAgICAgICBpc09wZW46IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJTYXV2ZWdhcmRlciBsYSBzZXNzaW9uIiwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiTm9tbWV6IHZvdHJlIGZpY2hpZXIgZGUgc2F1dmVnYXJkZSAoZXg6IGFwcmVzX3JlcGFydGl0aW9uLCBmaW5hbCwgZXRjLikgOiIsCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBkZWZhdWx0TmFtZSwKICAgICAgICAgICAgICAgICAgICBvbkNvbmZpcm06IChmaWxlTmFtZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5hbE5hbWUgPSBmaWxlTmFtZS50cmltKCkgPyAoZmlsZU5hbWUuZW5kc1dpdGgoJy5qc29uJykgPyBmaWxlTmFtZSA6IGAke2ZpbGVOYW1lfS5qc29uYCkgOiBgJHtkZWZhdWx0TmFtZX0uanNvbmA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogQVBQX1ZFUlNJT04sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nob29sQ29uZmlnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb21zLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlYWNoZXJzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3RzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlYWNoZXJBc3NpZ25tZW50cywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXJ2ZWlsbGFuY2VBc3NpZ25tZW50cywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWNyZXRhcmlhdEFzc2lnbm1lbnRzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cnZlaWxsYW5jZU1vZGUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jVGVtcGxhdGVzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQW5vbnltaXR5TG9ja2VkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgCiAgICAgICAgICAgICAgICAgICAgICAgIH07IAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW0pTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpXSwgeyB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIgfSk7IAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOyAKICAgICAgICAgICAgICAgICAgICAgICAgbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsuZG93bmxvYWQgPSBmaW5hbE5hbWU7IAogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOyAKICAgICAgICAgICAgICAgICAgICAgICAgbGluay5jbGljaygpOyAKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oYFNhdXZlZ2FyZMOpIHNvdXMgOiAke2ZpbmFsTmFtZX1gLCAic3VjY2VzcyIpOwogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUlucHV0TW9kYWwoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUxvYWRXb3JrID0gKGUpID0+IHsgCiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07IAogICAgICAgICAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47IAogICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsgCiAgICAgICAgICAgICAgICByZWFkZXIub25sb2FkID0gKGV2dCkgPT4geyAKICAgICAgICAgICAgICAgICAgICB0cnkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoZXZ0LnRhcmdldC5yZXN1bHQpOyAKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZERhdGEoZGF0YSwgIkZpY2hpZXIiKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dOb3RpZmljYXRpb24oIkRvbm7DqWVzIHJlc3RhdXLDqWVzIGF2ZWMgc3VjY8OocyAhIik7IAogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgeyAKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbigiRXJyZXVyIGxlY3R1cmUgZmljaGllciIsICJlcnJvciIpOyAKICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNldCBpbnB1dCB0byBhbGxvdyByZWxvYWRpbmcgc2FtZSBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsgCiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsgCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyAtLS0gR0VORVJBVEUgUERGIE1PRElGScOJIFBPVVIgVVRJTElTRVIgTEVTIFRFTVBMQVRFUyAtLS0KICAgICAgICAgICAgY29uc3QgZ2VuZXJhdGVQREYgPSAoZG9jVHlwZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOwogICAgICAgICAgICAgICAgY29uc3QgZG9jID0gbmV3IGpzUERGKCk7CiAgICAgICAgICAgICAgICBjb25zdCBwYWdlV2lkdGggPSBkb2MuaW50ZXJuYWwucGFnZVNpemUud2lkdGg7CiAgICAgICAgICAgICAgICBjb25zdCBwYWdlSGVpZ2h0ID0gZG9jLmludGVybmFsLnBhZ2VTaXplLmhlaWdodDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSGVscGVyIGRpbWVuc2lvbnMgY2FjaGV0IChNYXggNTB4MjVtbSAtIFJhdGlvIGNvbnNlcnbDqSkKICAgICAgICAgICAgICAgIGNvbnN0IGdldFN0YW1wRGltcyA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXNjaG9vbENvbmZpZy5zdGFtcFVybCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgTUFYX1cgPSA1MCwgTUFYX0ggPSAyNTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gc2Nob29sQ29uZmlnLnN0YW1wUmF0aW8gfHwgMTsKICAgICAgICAgICAgICAgICAgICBsZXQgdyA9IDI1LCBoID0gMjU7CiAgICAgICAgICAgICAgICAgICAgaWYgKHIgPiAoTUFYX1cgLyBNQVhfSCkpIHsgdyA9IE1BWF9XOyBoID0gTUFYX1cgLyByOyB9IAogICAgICAgICAgICAgICAgICAgIGVsc2UgeyBoID0gTUFYX0g7IHcgPSBNQVhfSCAqIHI7IH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4geyB3LCBoIH07CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIEhlbHBlciBkaW1lbnNpb25zIExvZ28gKEV2aXRlIGTDqWZvcm1hdGlvbikKICAgICAgICAgICAgICAgIGNvbnN0IGdldExvZ29EaW1zID0gKG1heFcsIG1heEgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXNjaG9vbENvbmZpZy5sb2dvVXJsKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICBjb25zdCByYXRpbyA9IHNjaG9vbENvbmZpZy5sb2dvUmF0aW8gfHwgMTsKICAgICAgICAgICAgICAgICAgICBsZXQgdyA9IG1heFc7CiAgICAgICAgICAgICAgICAgICAgbGV0IGggPSB3IC8gcmF0aW87CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2kgbGEgaGF1dGV1ciBjYWxjdWzDqWUgZMOpcGFzc2UgbGUgbWF4LCBvbiBmaXhlIGxhIGhhdXRldXIgZXQgcmVjYWxjdWxlIGxhIGxhcmdldXIKICAgICAgICAgICAgICAgICAgICBpZiAoaCA+IG1heEgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaCA9IG1heEg7CiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSBoICogcmF0aW87CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHcsIGggfTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgY29uc3QgYWRkSGVhZGVyID0gKHRpdGxlLCBzdWJ0aXRsZSA9ICIiKSA9PiB7IAogICAgICAgICAgICAgICAgICAgIC8vIEFqb3V0IGxvZ28gc2FucyBkw6lmb3JtYXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoc2Nob29sQ29uZmlnLmxvZ29VcmwpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9nbyA9IGdldExvZ29EaW1zKDIwLCAyMCk7IC8vIEJvaXRlIG1heCAyMHgyMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmFkZEltYWdlKHNjaG9vbENvbmZpZy5sb2dvVXJsLCAnSlBFRycsIDEwLCAxMCwgbG9nby53LCBsb2dvLmgpOyAKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7fSAKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMCk7IGRvYy50ZXh0KHNjaG9vbENvbmZpZy5uYW1lLCAzNSwgMTUpOyBkb2Muc2V0Rm9udFNpemUoOSk7IGRvYy50ZXh0KHNjaG9vbENvbmZpZy5jaXR5LCAzNSwgMjApOyBkb2Muc2V0Rm9udFNpemUoMTQpOyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgZG9jLnRleHQoKHNjaG9vbENvbmZpZy5zZXNzaW9uTmFtZSB8fCAiU0VTU0lPTiAyMDI1IikudG9VcHBlckNhc2UoKSwgcGFnZVdpZHRoIC8gMiwgMzIsIHsgYWxpZ246ICdjZW50ZXInIH0pOyBkb2Muc2V0Rm9udFNpemUoMTQpOyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgIm5vcm1hbCIpOyBkb2MudGV4dCh0aXRsZSwgcGFnZVdpZHRoIC8gMiwgNDAsIHsgYWxpZ246ICdjZW50ZXInIH0pOyBpZiAoc3VidGl0bGUpIHsgZG9jLnNldEZvbnRTaXplKDExKTsgZG9jLnRleHQoc3VidGl0bGUsIHBhZ2VXaWR0aCAvIDIsIDQ2LCB7IGFsaWduOiAnY2VudGVyJyB9KTsgfSBkb2Muc2V0TGluZVdpZHRoKDAuNSk7IGRvYy5saW5lKDEwLCA1MCwgcGFnZVdpZHRoIC0gMTAsIDUwKTsgcmV0dXJuIDYwOyAKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gLS0tIEhFTFBFUiA6IEVOQ0FEUsOJIERFU1RJTkFUQUlSRSBVTklGScOJIC0tLQogICAgICAgICAgICAgICAgY29uc3QgYWRkUmVjaXBpZW50Qm94ID0gKGxpbmVzLCB5UG9zLCBpc1RUID0gZmFsc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICBkb2Muc2V0RHJhd0NvbG9yKDApOyAKICAgICAgICAgICAgICAgICAgICBkb2Muc2V0TGluZVdpZHRoKDAuMSk7IAogICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGaWxsQ29sb3IoMjUwLCAyNTAsIDI1MCk7IC8vIEdyaXMgdHLDqHMgbMOpZ2VyCiAgICAgICAgICAgICAgICAgICAgZG9jLnJvdW5kZWRSZWN0KDE1LCB5UG9zLCBwYWdlV2lkdGggLSAzMCwgMjYsIDMsIDMsICdGJyk7IC8vIE9wdGltaXNhdGlvbjogQm9pdGUgcGx1cyBjb21wYWN0ZSAoMjYgYXUgbGlldSBkZSAzMikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTIpOyAKICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgCiAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQobGluZXNbMF0gfHwgIiIsIDI1LCB5UG9zICsgOCk7IC8vIEFqdXN0ZW1lbnQgWQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMSk7IAogICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7IAogICAgICAgICAgICAgICAgICAgIGlmIChsaW5lc1sxXSkgZG9jLnRleHQobGluZXNbMV0sIDI1LCB5UG9zICsgMTUpOyAvLyBBanVzdGVtZW50IFkKICAgICAgICAgICAgICAgICAgICBpZiAobGluZXNbMl0pIGRvYy50ZXh0KGxpbmVzWzJdLCAyNSwgeVBvcyArIDIyKTsgLy8gQWp1c3RlbWVudCBZCgogICAgICAgICAgICAgICAgICAgIGlmIChpc1RUKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0VGV4dENvbG9yKDIyMCwgMzgsIDM4KTsgCiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAiYm9sZCIpOyAKICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoIkFNw4lOQUdFTUVOVCA6IFRJRVJTIFRFTVBTIEFDQ09SRMOJIiwgMTEwLCB5UG9zICsgOCk7IAogICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0VGV4dENvbG9yKDApOyAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHlQb3MgKyAzMjsgLy8gTm91dmVsbGUgWSBhcHLDqHMgbGEgYm9pdGUgcsOpZHVpdGUKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gLS0tIEhFTFBFUiA6IFNJR05BVFVSRSBCQVMgREUgUEFHRSAtLS0KICAgICAgICAgICAgICAgIGNvbnN0IGFkZFNpZ25hdHVyZUJvdHRvbSA9IChjdXJyZW50WSkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uIGNpYmxlIDogUmVtb250w6llIHBvdXIgw6l2aXRlciBsYSBjb3VwdXJlIHRlY2huaXF1ZSBkZSBsJ2ltcHJpbWFudGUgKDU1bW0gZHUgYmFzIGF1IGxpZXUgZGUgNDVtbSkKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRZID0gcGFnZUhlaWdodCAtIDU1OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFNpIGxlIGNvbnRlbnUgYWN0dWVsIGTDqXBhc3NlIGxhIHpvbmUgZGUgc2lnbmF0dXJlLCBvbiBham91dGUgdW5lIHBhZ2UKICAgICAgICAgICAgICAgICAgICBsZXQgc2lnblkgPSB0YXJnZXRZOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50WSA+IHRhcmdldFkgLSAxMCkgewogICAgICAgICAgICAgICAgICAgICAgICBkb2MuYWRkUGFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdXIgbm91dmVsbGUgcGFnZSwgbGEgc2lnbmF0dXJlIHJlc3RlIGVuIGJhcwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZVN0ciA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicpOwogICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMSk7IAogICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7CiAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYEZhaXQgw6AgJHtzY2hvb2xDb25maWcuY2l0eSB8fCAnLi4uLi4uLi4uLi4uLi4nfSwgbGUgJHtkYXRlU3RyfWAsIDExMCwgc2lnblkpOwogICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KCJMZSBDaGVmIGQnw6l0YWJsaXNzZW1lbnQsIiwgMTEwLCBzaWduWSArIDYpOyAKICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsKICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChzY2hvb2xDb25maWcucHJpbmNpcGFsLCAxMTAsIHNpZ25ZICsgMTQpOyAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDYWNoZXQKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFtcCA9IGdldFN0YW1wRGltcygpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGFtcCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsgZG9jLmFkZEltYWdlKHNjaG9vbENvbmZpZy5zdGFtcFVybCwgJ0pQRUcnLCAxMjAsIHNpZ25ZICsgMTYsIHN0YW1wLncsIHN0YW1wLmgpOyB9IGNhdGNoIChlKSB7fSAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGlmIChkb2NUeXBlID09PSAnY29udm9jYXRpb25zX3NlY3JldGFyaWF0JykgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLSBDT05WT0NBVElPTlMgU0VDUkVUQVJJQVQgLS0tCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHBsID0gZG9jVGVtcGxhdGVzLnNlY3JldGFyaWF0OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2lnbm1lbnRzQnlUZWFjaGVyID0ge307IAogICAgICAgICAgICAgICAgICAgIHN1YmplY3RzLmZvckVhY2goc3ViID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduID0gc2VjcmV0YXJpYXRBc3NpZ25tZW50c1tzdWIuaWRdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWduICYmIGFzc2lnbi50ZWFjaGVySWRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ24udGVhY2hlcklkcy5mb3JFYWNoKHRpZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhc3NpZ25tZW50c0J5VGVhY2hlclt0aWRdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0ZWFjaGVycy5maW5kKHRlYSA9PiB0ZWEuaWQgPT09IHRpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0KSBhc3NpZ25tZW50c0J5VGVhY2hlclt0aWRdID0geyBpbmZvOiB0LCBtaXNzaW9uczogW10gfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2lnbm1lbnRzQnlUZWFjaGVyW3RpZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9vbU5hbWUgPSByb29tcy5maW5kKHIgPT4gci5pZCA9PT0gYXNzaWduLnJvb21JZCk/Lm5hbWUgfHwgIk5vbiBkw6lmaW5pZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnRzQnlUZWFjaGVyW3RpZF0ubWlzc2lvbnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBzdWIuZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHN1Yi5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbTogcm9vbU5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdElkcyA9IE9iamVjdC5rZXlzKGFzc2lnbm1lbnRzQnlUZWFjaGVyKS5zb3J0KChhLGIpID0+IGFzc2lnbm1lbnRzQnlUZWFjaGVyW2FdLmluZm8ubGFzdG5hbWUubG9jYWxlQ29tcGFyZShhc3NpZ25tZW50c0J5VGVhY2hlcltiXS5pbmZvLmxhc3RuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHRJZHMubGVuZ3RoID09PSAwKSB7IHNob3dOb3RpZmljYXRpb24oIkF1Y3VuIHBlcnNvbm5lbCBhZmZlY3TDqSBhdSBzZWNyw6l0YXJpYXQuIiwgImVycm9yIik7IHJldHVybjsgfQoKICAgICAgICAgICAgICAgICAgICB0SWRzLmZvckVhY2goKHRpZCwgaWR4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHggPiAwKSBkb2MuYWRkUGFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gYXNzaWdubWVudHNCeVRlYWNoZXJbdGlkXTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHkgPSBhZGRIZWFkZXIodHBsLnRpdGxlLCB0cGwuc3VidGl0bGUpOwogICAgICAgICAgICAgICAgICAgICAgICB5IC09IDU7IC8vIEFqdXN0ZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFV0aWxpc2F0aW9uIEJvaXRlIFVuaWZpw6llCiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBhZGRSZWNpcGllbnRCb3goWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYERlc3RpbmF0YWlyZSA6ICR7ZGF0YS5pbmZvLmNpdn0gJHtkYXRhLmluZm8ubGFzdG5hbWV9ICR7ZGF0YS5pbmZvLmZpcnN0bmFtZX1gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYE1pc3Npb24gOiBTZWNyw6l0YXJpYXQgZCdFeGFtZW5gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYFNlc3Npb24gOiAke3NjaG9vbENvbmZpZy5zZXNzaW9uTmFtZSB8fCAnRE5CIEJsYW5jJ31gCiAgICAgICAgICAgICAgICAgICAgICAgIF0sIHkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJub3JtYWwiKTsgZG9jLnNldEZvbnRTaXplKDExKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW50cm8gVGVtcGxhdGUKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRJbnRybyA9IGRvYy5zcGxpdFRleHRUb1NpemUodHBsLmludHJvLCBwYWdlV2lkdGggLSAzMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KHNwbGl0SW50cm8sIDE1LCB5KTsKICAgICAgICAgICAgICAgICAgICAgICAgeSArPSAoc3BsaXRJbnRyby5sZW5ndGggKiA2KSArIDM7IC8vIE9wdGltaXPDqQoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFibGVCb2R5ID0gZGF0YS5taXNzaW9ucy5tYXAobSA9PiBbbS5kYXRlLCBtLnN1YmplY3QsICJGaW4gZCfDqXByZXV2ZSIsIG0ucm9vbV0pOwogICAgICAgICAgICAgICAgICAgICAgICBkb2MuYXV0b1RhYmxlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0WTogeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IFtbJ0RhdGUnLCAnRXByZXV2ZScsICdIb3JhaXJlJywgJ0xpZXUgKFNhbGxlKSddXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IHRhYmxlQm9keSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW1lOiAnZ3JpZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkU3R5bGVzOiB7IGZpbGxDb2xvcjogWzIzMCwgMjMwLCAyMzBdLCB0ZXh0Q29sb3I6IFswLDAsMF0sIGZvbnRTdHlsZTogJ2JvbGQnLCBsaW5lQ29sb3I6IFswLDAsMF0sIGxpbmVXaWR0aDogMC4xIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXM6IHsgZm9udFNpemU6IDksIGNlbGxQYWRkaW5nOiAyLjUsIHZhbGlnbjogJ21pZGRsZScsIGxpbmVDb2xvcjogWzAsMCwwXSwgbGluZVdpZHRoOiAwLjEsIHRleHRDb2xvcjogWzAsMCwwXSB9IC8vIE9wdGltaXPDqQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmaW5hbFkgPSBkb2MubGFzdEF1dG9UYWJsZS5maW5hbFkgKyA4OyAvLyBPcHRpbWlzw6kKICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnRTaXplKDEwKTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJib2xkIik7IGRvYy50ZXh0KCJNSVNTSU9OUyA6IiwgMjAsIGZpbmFsWSk7IGZpbmFsWSArPSA2OwogICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgIm5vcm1hbCIpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlzc2lvbkxpbmVzID0gdHBsLm1pc3Npb25zLnNwbGl0KCdcbicpLmZpbHRlcihsID0+IGwudHJpbSgpICE9PSAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pc3Npb25MaW5lcy5mb3JFYWNoKGxpbmUgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQobGluZSwgMjAsIGZpbmFsWSk7IGZpbmFsWSArPSA0LjU7IC8vIE9wdGltaXPDqQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpZ25hdHVyZSBVbmlmacOpZSBCYXMgZGUgUGFnZQogICAgICAgICAgICAgICAgICAgICAgICBhZGRTaWduYXR1cmVCb3R0b20oZmluYWxZKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBkb2Muc2F2ZSgiY29udm9jYXRpb25zX3NlY3JldGFyaWF0LnBkZiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gLi4uIChPdGhlciBQREZzKSAuLi4KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRvY1R5cGUgPT09ICdlbWFyZ2VtZW50JyB8fCBkb2NUeXBlID09PSAnZW1hcmdlbWVudF90dCcpIHsKICAgICAgICAgICAgICAgICAgICAvLyAoQ29kZSDDqW1hcmdlbWVudCBpZGVudGlxdWUgLSBpbmNoYW5nw6kpCiAgICAgICAgICAgICAgICAgICAgc3ViamVjdHMuZm9yRWFjaCgoc3ViamVjdCwgc0lkeCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByb29tcy5mb3JFYWNoKChyb29tLCBySWR4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc0lkeCA+IDAgfHwgcklkeCA+IDApIGRvYy5hZGRQYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb29tU3R1ZGVudHMgPSBzdHVkZW50cy5maWx0ZXIocyA9PiBzLnJvb21JZCA9PT0gcm9vbS5pZCkuc29ydCgoYSwgYikgPT4gYS5sYXN0bmFtZS5sb2NhbGVDb21wYXJlKGIubGFzdG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1Yk5hbWUgPSAoc3ViamVjdC5kaXNjaXBsaW5lcyAmJiBzdWJqZWN0LmRpc2NpcGxpbmVzLmxlbmd0aCA+IDApID8gYCR7c3ViamVjdC5uYW1lfSAoJHtzdWJqZWN0LmRpc2NpcGxpbmVzLmpvaW4oJy0nKX0pYCA6IHN1YmplY3QubmFtZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTEpOyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgZG9jLnRleHQoc2Nob29sQ29uZmlnLm5hbWUudG9VcHBlckNhc2UoKSwgMTUsIDE1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7IGRvYy5zZXRGb250U2l6ZSgxMCk7IGRvYy50ZXh0KGBDZW50cmUgOiAke3NjaG9vbENvbmZpZy5uYW1lfWAsIDE1LCAyMCk7IGRvYy50ZXh0KCJTw6lyaWUgR8OpbsOpcmFsZSIsIDE1LCAyNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTQpOyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgZG9jLnRleHQoYEVwcmV1dmUgOiAke3N1Yk5hbWUudG9VcHBlckNhc2UoKX1gLCBwYWdlV2lkdGggLyAyLCAzNSwgeyBhbGlnbjogJ2NlbnRlcicgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTIpOyBkb2MucmVjdChwYWdlV2lkdGggLSA2MCwgMTAsIDUwLCAxMik7IGRvYy50ZXh0KGBTQUxMRSAke3Jvb20ubmFtZX1gLCBwYWdlV2lkdGggLSAzNSwgMTgsIHsgYWxpZ246ICdjZW50ZXInIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnRTaXplKDEwKTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJub3JtYWwiKTsgZG9jLnRleHQoYERhdGUgOiAke3N1YmplY3QuZGF0ZX0gLSAke3N1YmplY3QudGltZX1gLCAxNSwgNDUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBoZWFkID0gW1snTsKwJywgJ05PTScsICdQUsOJTk9NJywgJ1AvQScsICdFbWFyZ2VtZW50JywgJ0VtYXJnZW1lbnQgUmV0b3VyJywgJ1JlbWlzZSBDb3BpZSddXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb2xTdHlsZXMgPSB7IDA6IHsgY2VsbFdpZHRoOiAxMCB9LCAxOiB7IGNlbGxXaWR0aDogNDAgfSwgMjogeyBjZWxsV2lkdGg6IDM1IH0sIDM6IHsgY2VsbFdpZHRoOiAxMCB9LCA0OiB7IGNlbGxXaWR0aDogMzUgfSwgNTogeyBjZWxsV2lkdGg6IDM1IH0sIDY6IHsgY2VsbFdpZHRoOiAyNSB9IH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvY1R5cGUgPT09ICdlbWFyZ2VtZW50X3R0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQgPSBbWydOwrAnLCAnTk9NJywgJ1BSw4lOT00nLCAnVFQnLCAnUC9BJywgJ0VtYXJnZW1lbnQnLCAnRW1hcmcuIFJldG91cicsICdSZW1pc2UnXV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sU3R5bGVzID0geyAwOiB7IGNlbGxXaWR0aDogOCB9LCAxOiB7IGNlbGxXaWR0aDogMzUgfSwgMjogeyBjZWxsV2lkdGg6IDMwIH0sIDM6IHsgY2VsbFdpZHRoOiAxMCwgdGV4dENvbG9yOiBbMjAwLDAsMF0gfSwgNDogeyBjZWxsV2lkdGg6IDggfSwgNTogeyBjZWxsV2lkdGg6IDMwIH0sIDY6IHsgY2VsbFdpZHRoOiAzMCB9LCA3OiB7IGNlbGxXaWR0aDogMjAgfSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlRGF0YSA9IHJvb21TdHVkZW50cy5tYXAoKHMsIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcm93ID0gW2kgKyAxLCBzLmxhc3RuYW1lLnRvVXBwZXJDYXNlKCksIHMuZmlyc3RuYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9jVHlwZSA9PT0gJ2VtYXJnZW1lbnRfdHQnKSByb3cucHVzaChzLmlzVFQgPyAiT1VJIiA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cucHVzaCgiIiwgIiIsICIiLCAiIik7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3c7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuYXV0b1RhYmxlKHsgc3RhcnRZOiA1MCwgaGVhZDogaGVhZCwgYm9keTogdGFibGVEYXRhLCB0aGVtZTogJ3BsYWluJywgc3R5bGVzOiB7IGxpbmVDb2xvcjogMCwgbGluZVdpZHRoOiAwLjIsIHRleHRDb2xvcjogMCwgZm9udFNpemU6IDksIG1pbkNlbGxIZWlnaHQ6IDEyLCB2YWxpZ246ICdtaWRkbGUnIH0sIGhlYWRTdHlsZXM6IHsgZmlsbENvbG9yOiAyMjAsIGZvbnRTdHlsZTogJ2JvbGQnLCBoYWxpZ246ICdjZW50ZXInIH0sIGNvbHVtblN0eWxlczogY29sU3R5bGVzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQVgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZpbmFsWSA9IGRvYy5sYXN0QXV0b1RhYmxlLmZpbmFsWSArIDEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsWSArIDcwID4gZG9jLmludGVybmFsLnBhZ2VTaXplLmhlaWdodCkgeyBkb2MuYWRkUGFnZSgpOyBmaW5hbFkgPSAyMDsgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnJlY3QoMTAsIGZpbmFsWSwgcGFnZVdpZHRoIC0gMjAsIDcwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMik7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAiYm9sZCIpOyBkb2MudGV4dChgUFYgZGUgc2FsbGUgJHtyb29tLm5hbWV9YCwgMTUsIGZpbmFsWSArIDgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmxpbmUoMTAsIGZpbmFsWSArIDEwLCBwYWdlV2lkdGggLSAxMCwgZmluYWxZICsgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3kgPSBmaW5hbFkgKyAxODsgZG9jLnNldEZvbnRTaXplKDEwKTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJub3JtYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KGBFcHJldXZlIDogJHtzdWJOYW1lfWAsIDE1LCBjeSk7IGN5ICs9IDY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgRGF0ZSA6ICR7c3ViamVjdC5kYXRlfWAsIDE1LCBjeSk7IGN5ICs9IDEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYENhbmRpZGF0cyA6ICR7cm9vbVN0dWRlbnRzLmxlbmd0aH1gLCAxNSwgY3kpOyBjeSArPSA4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYFByw6lzZW50cyA6IC4uLi4uLi5gLCAxNSwgY3kpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgU3VydmVpbGxhbnRzIDpgLCAxMDAsIGZpbmFsWSArIDE4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KGBOb20gOiAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4gU2lnbiA6YCwgMTAwLCBmaW5hbFkgKyAyNik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgTm9tIDogLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uIFNpZ24gOmAsIDEwMCwgZmluYWxZICsgMzYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgT2JzZXJ2YXRpb25zIDpgLCAxNSwgZmluYWxZICsgNTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmxpbmUoNDAsIGZpbmFsWSArIDUwLCBwYWdlV2lkdGggLSAxNSwgZmluYWxZICsgNTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmxpbmUoMTUsIGZpbmFsWSArIDU3LCBwYWdlV2lkdGggLSAxNSwgZmluYWxZICsgNTcpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBkb2Muc2F2ZSgibGlzdGVzX2VtYXJnZW1lbnQucGRmIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChkb2NUeXBlID09PSAnZXRpcXVldHRlc19hbm9ueW1hdCcgfHwgZG9jVHlwZSA9PT0gJ2V0aXF1ZXR0ZXNfdGFibGVfYW1lbmFnZW1lbnRzJyB8fCBkb2NUeXBlID09PSAnZXRpcXVldHRlc19jb3BpZXNfcGRmJyB8fCBkb2NUeXBlID09PSAncG9jaGV0dGVzJyB8fCBkb2NUeXBlID09PSAnY29udm9jYXRpb25zJyB8fCBkb2NUeXBlID09PSAnY29udm9jYXRpb25zX3N1cnZlaWxsYW50cycgfHwgZG9jVHlwZSA9PT0gJ2NvbnZvY2F0aW9uc19hZXNoJyB8fCBkb2NUeXBlID09PSAnbGlzdGVzX2NvcnJlY3Rpb25fZGV0YWlsJyB8fCBkb2NUeXBlID09PSAncGxhbnNfc2FsbGUnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY1R5cGUgPT09ICdldGlxdWV0dGVzX2Fub255bWF0JyB8fCBkb2NUeXBlID09PSAnZXRpcXVldHRlc190YWJsZV9hbWVuYWdlbWVudHMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAvLyAoQ29kZSDDqXRpcXVldHRlcyBpbmNoYW5nw6kpCiAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdyA9IDEwNTsgbGV0IGggPSAzNTsgbGV0IGdhcFggPSAwOyBsZXQgZ2FwWSA9IDA7IGxldCB4U3RhcnQgPSAwOyBsZXQgeVN0YXJ0ID0gOC41OwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29sID0gMCwgcm93ID0gMDsgY29uc3QgaXRlbXNQZXJQYWdlID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzLmZpbHRlcihzID0+IHMucm9vbUlkKS5mb3JFYWNoKChzLCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDAgJiYgaSAlIGl0ZW1zUGVyUGFnZSA9PT0gMCkgeyBkb2MuYWRkUGFnZSgpOyBjb2wgPSAwOyByb3cgPSAwOyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgeCA9IHhTdGFydCArIGNvbCAqICh3ICsgZ2FwWCk7IGxldCB5ID0geVN0YXJ0ICsgcm93ICogKGggKyBnYXBZKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXREcmF3Q29sb3IoMjAwKTsgZG9jLnNldExpbmVXaWR0aCgwLjEpOyBkb2MucmVjdCh4LCB5LCB3LCBoKTsgZG9jLnNldFRleHRDb2xvcigwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSg4KTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJub3JtYWwiKTsgZG9jLnNldFRleHRDb2xvcigxMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoc2Nob29sQ29uZmlnLm5hbWUuc3Vic3RyaW5nKDAsIDQ1KSwgeCArIHcvMiwgeSArIDcsIHsgYWxpZ246ICdjZW50ZXInIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnRTaXplKDEyKTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJib2xkIik7IGRvYy5zZXRUZXh0Q29sb3IoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgJHtzLmxhc3RuYW1lfSAke3MuZmlyc3RuYW1lfWAuc3Vic3RyaW5nKDAsIDMwKSwgeCArIHcvMiwgeSArIDE3LCB7IGFsaWduOiAnY2VudGVyJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMCk7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgSU5FIDogJHtzLmluZSB8fCAnLSd9YCwgeCArIHcvMiwgeSArIDI0LCB7IGFsaWduOiAnY2VudGVyJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvb21OYW1lID0gcm9vbXMuZmluZChyID0+IHIuaWQgPT09IHMucm9vbUlkKT8ubmFtZSB8fCAnPyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgZG9jLnRleHQoYFNhbGxlIDogJHtyb29tTmFtZX1gLCB4ICsgdy8yLCB5ICsgMzAsIHsgYWxpZ246ICdjZW50ZXInIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvY1R5cGUgPT09ICdldGlxdWV0dGVzX3RhYmxlX2FtZW5hZ2VtZW50cycgJiYgcy5pc1RUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldFRleHRDb2xvcigyMjAsIDM4LCAzOCk7IGRvYy5zZXRGb250U2l6ZSg5KTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJib2xkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoIlRJRVJTIFRFTVBTIiwgeCArIHcgLSA1LCB5ICsgOCwgeyBhbGlnbjogJ3JpZ2h0JyB9KTsgZG9jLnNldFRleHRDb2xvcigwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCsrOyBpZiAoY29sID49IDIpIHsgY29sID0gMDsgcm93Kys7IH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zYXZlKGRvY1R5cGUgKyAiLnBkZiIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jVHlwZSA9PT0gJ3BsYW5zX3NhbGxlJykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAoQ29kZSBwbGFuIGRlIHNhbGxlIGluY2hhbmfDqSkKICAgICAgICAgICAgICAgICAgICAgICAgcm9vbXMuZm9yRWFjaCgocm9vbSwgaWR4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gMCkgZG9jLmFkZFBhZ2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB5ID0gYWRkSGVhZGVyKGBQTEFOIERFIFNBTExFIC0gJHtyb29tLm5hbWV9YCwgYENhcGFjaXTDqTogJHtyb29tLmNhcGFjaXR5fSBwbGFjZXNgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVuaXF1ZURhdGVzID0gWy4uLm5ldyBTZXQoc3ViamVjdHMubWFwKHMgPT4gcy5kYXRlKSldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGVyaW9kU3RyID0gdW5pcXVlRGF0ZXMubGVuZ3RoID4gMSA/IGDDiXByZXV2ZXMgZHUgJHt1bmlxdWVEYXRlc1swXX0gYXUgJHt1bmlxdWVEYXRlc1t1bmlxdWVEYXRlcy5sZW5ndGgtMV19YCA6ICh1bmlxdWVEYXRlcy5sZW5ndGggPT09IDEgPyBgw4lwcmV1dmVzIGxlICR7dW5pcXVlRGF0ZXNbMF19YCA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZXJpb2RTdHIpIHsgZG9jLnNldEZvbnRTaXplKDEwKTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJpdGFsaWMiKTsgZG9jLnRleHQocGVyaW9kU3RyLCBwYWdlV2lkdGggLyAyLCB5IC0gNiwgeyBhbGlnbjogJ2NlbnRlcicgfSk7IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvb21TdHVkZW50cyA9IHN0dWRlbnRzLmZpbHRlcihzID0+IHMucm9vbUlkID09PSByb29tLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlRGF0YSA9IHJvb21TdHVkZW50cy5tYXAoKHMsIGkpID0+IFtpICsgMSwgcy5sYXN0bmFtZS50b1VwcGVyQ2FzZSgpLCBzLmZpcnN0bmFtZSwgcy5pc1RUID8gIk9VSSIgOiAiTk9OIiwgcy5pbmUgfHwgIiJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5hdXRvVGFibGUoeyBzdGFydFk6IHksIGhlYWQ6IFtbJ1BsYWNlJywgJ05vbScsICdQcsOpbm9tJywgJ1RpZXJzIFRlbXBzJywgJ0lORSddXSwgYm9keTogdGFibGVEYXRhLCB0aGVtZTogJ2dyaWQnLCBoZWFkU3R5bGVzOiB7IGZpbGxDb2xvcjogWzUwLCA1MCwgNTBdLCB0ZXh0Q29sb3I6IFsyNTUsIDI1NSwgMjU1XSB9IH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYEVmZmVjdGlmIDogJHtyb29tU3R1ZGVudHMubGVuZ3RofWAsIDE0LCBkb2MubGFzdEF1dG9UYWJsZS5maW5hbFkgKyAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgU2lnbmF0dXJlIDpgLCAxMzAsIGRvYy5sYXN0QXV0b1RhYmxlLmZpbmFsWSArIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zYXZlKCJwbGFuc19kZV9zYWxsZS5wZGYiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRvY1R5cGUgPT09ICdwb2NoZXR0ZXMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIChDb2RlIHBvY2hldHRlcyBpbmNoYW5nw6kpCiAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXNGaXJzdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0cy5mb3JFYWNoKChzdWJqZWN0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tcy5mb3JFYWNoKChyb29tKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0ZpcnN0KSBkb2MuYWRkUGFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnJlY3QoMTAsIDEwLCBwYWdlV2lkdGggLSAyMCwgZG9jLmludGVybmFsLnBhZ2VTaXplLmhlaWdodCAtIDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Nob29sQ29uZmlnLmxvZ29VcmwpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9nbyA9IGdldExvZ29EaW1zKDI1LCAyNSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuYWRkSW1hZ2Uoc2Nob29sQ29uZmlnLmxvZ29VcmwsICdKUEVHJywgMTUsIDE1LCBsb2dvLncsIGxvZ28uaCk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7IH0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgyNCk7IGRvYy50ZXh0KHNjaG9vbENvbmZpZy5uYW1lLCBwYWdlV2lkdGgvMiwgNDAsIHthbGlnbjogJ2NlbnRlcid9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoNDApOyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgZG9jLnRleHQoKHNjaG9vbENvbmZpZy5zZXNzaW9uTmFtZSB8fCAiRE5CIDIwMjUiKS50b1VwcGVyQ2FzZSgpLCBwYWdlV2lkdGgvMiwgNzAsIHthbGlnbjogJ2NlbnRlcid9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMjApOyBkb2MudGV4dChgU2FsbGUgOiAke3Jvb20ubmFtZX1gLCBwYWdlV2lkdGgvMiwgMTAwLCB7YWxpZ246ICdjZW50ZXInfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViTmFtZSA9IChzdWJqZWN0LmRpc2NpcGxpbmVzICYmIHN1YmplY3QuZGlzY2lwbGluZXMubGVuZ3RoID4gMCkgPyBgJHtzdWJqZWN0Lm5hbWV9ICgke3N1YmplY3QuZGlzY2lwbGluZXMuam9pbignIC0gJyl9KWAgOiBzdWJqZWN0Lm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnJlY3QoMzAsIDEyMCwgcGFnZVdpZHRoIC0gNjAsIDYwKTsgZG9jLnNldEZvbnRTaXplKDE4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgRGlzY2lwbGluZSA6ICR7c3ViTmFtZX1gLCBwYWdlV2lkdGgvMiwgMTM1LCB7YWxpZ246ICdjZW50ZXInfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYERhdGUgOiAke3N1YmplY3QuZGF0ZX1gLCBwYWdlV2lkdGgvMiwgMTUwLCB7YWxpZ246ICdjZW50ZXInfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYEhvcmFpcmUgOiAke3N1YmplY3QudGltZX1gLCBwYWdlV2lkdGgvMiwgMTY1LCB7YWxpZ246ICdjZW50ZXInfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnRTaXplKDE2KTsgZG9jLnRleHQoYE5vbWJyZSBkZSBjYW5kaWRhdHMgOiAuLi4uLi4uYCwgNDAsIDIwMCk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxNik7IGRvYy50ZXh0KGBPYnNlcnZhdGlvbnMgOiAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLmAsIDQwLCAyNTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2F2ZSgiZXRpcXVldHRlc19wb2NoZXR0ZXMucGRmIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2NUeXBlID09PSAnZXRpcXVldHRlc19jb3BpZXNfcGRmJykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAoQ29kZSDDqXRpcXVldHRlcyBjb3BpZXMgaW5jaGFuZ8OpKQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3ID0gMTA1OyBjb25zdCBoID0gMzU7IGNvbnN0IHhTdGFydCA9IDA7IGNvbnN0IHlTdGFydCA9IDguNTsgY29uc3QgaXRlbXNQZXJQYWdlID0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3RzLmZvckVhY2goKHN1YmplY3QsIHNJZHgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZFN0dWRlbnRzID0gWy4uLnN0dWRlbnRzXS5zb3J0KChhLGIpID0+IGEubGFzdG5hbWUubG9jYWxlQ29tcGFyZShiLmxhc3RuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29sID0gMDsgbGV0IHJvdyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc0lkeCA+IDApIHsgZG9jLmFkZFBhZ2UoKTsgY29sID0gMDsgcm93ID0gMDsgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydGVkU3R1ZGVudHMuZm9yRWFjaCgocywgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCAmJiBpICUgaXRlbXNQZXJQYWdlID09PSAwKSB7IGRvYy5hZGRQYWdlKCk7IGNvbCA9IDA7IHJvdyA9IDA7IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgeCA9IHhTdGFydCArIGNvbCAqIHc7IGxldCB5ID0geVN0YXJ0ICsgcm93ICogaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0RHJhd0NvbG9yKDIwMCk7IGRvYy5zZXRMaW5lV2lkdGgoMC4xKTsgZG9jLnNldExpbmVEYXNoUGF0dGVybihbXSwgMCk7IGRvYy5yZWN0KHgsIHksIHcsIGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0WCA9IHggKyAodyAvIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXREcmF3Q29sb3IoMCk7IGRvYy5zZXRMaW5lRGFzaFBhdHRlcm4oWzMsIDNdLCAwKTsgZG9jLmxpbmUoc3BsaXRYLCB5LCBzcGxpdFgsIHkgKyBoKTsgZG9jLnNldExpbmVEYXNoUGF0dGVybihbXSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VudGVyTGVmdFggPSB4ICsgKHcgLyA0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0VGV4dENvbG9yKDApOyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgZG9jLnNldEZvbnRTaXplKDE0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChzLmFub255bW91c0lkLCBjZW50ZXJMZWZ0WCwgeSArIDE1LCB7IGFsaWduOiAnY2VudGVyJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoOSk7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViTmFtZVNob3J0ID0gc3ViamVjdC5uYW1lLmxlbmd0aCA+IDIyID8gc3ViamVjdC5uYW1lLnN1YnN0cmluZygwLCAyMCkgKyAiLiIgOiBzdWJqZWN0Lm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoc3ViTmFtZVNob3J0LCBjZW50ZXJMZWZ0WCwgeSArIDI1LCB7IGFsaWduOiAnY2VudGVyJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0WCA9IHNwbGl0WCArIDU7IGxldCB0ZXh0WSA9IHkgKyA3OyBjb25zdCBsaW5lSGVpZ2h0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTApOyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgJHtzLmxhc3RuYW1lfSAke3MuZmlyc3RuYW1lfWAuc3Vic3RyaW5nKDAsIDMwKSwgdGV4dFgsIHRleHRZKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0WSArPSBsaW5lSGVpZ2h0OyBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgIm5vcm1hbCIpOyBkb2Muc2V0Rm9udFNpemUoOSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYENsYXNzZSA6ICR7cy5jbGFzc31gLCB0ZXh0WCwgdGV4dFkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRZICs9IGxpbmVIZWlnaHQ7IGRvYy50ZXh0KGBNYXRpw6hyZSA6ICR7c3ViamVjdC5uYW1lfWAsIHRleHRYLCB0ZXh0WSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFkgKz0gbGluZUhlaWdodCArIDI7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAiYm9sZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KGBOwrAgQW5vbnltYXQgOiAke3MuYW5vbnltb3VzSWR9YCwgdGV4dFgsIHRleHRZKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wrKzsgaWYgKGNvbCA+PSAyKSB7IGNvbCA9IDA7IHJvdysrOyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zYXZlKCJldGlxdWV0dGVzX2NvcGllc19jb21wbGV0LnBkZiIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jVHlwZSA9PT0gJ2xpc3Rlc19jb3JyZWN0aW9uX2RldGFpbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIChDb2RlIGxpc3RlIGNvcnJlY3Rpb24gaW5jaGFuZ8OpKQogICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0IHx8ICF0ZWFjaGVyQXNzaWdubWVudHNbc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdC5pZF0pIHsgc2hvd05vdGlmaWNhdGlvbigiQXVjdW5lIHLDqXBhcnRpdGlvbiAhIiwgImVycm9yIik7IHJldHVybjsgfQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhc3NpZ25tZW50cyA9IHRlYWNoZXJBc3NpZ25tZW50c1tzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0LmlkXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYW5vbnltaXplZFN0dWRlbnRzID0gc3R1ZGVudHMuZmlsdGVyKHMgPT4gcy5hbm9ueW1vdXNJZCkuc29ydCgoYSwgYikgPT4gYS5hbm9ueW1vdXNJZC5sb2NhbGVDb21wYXJlKGIuYW5vbnltb3VzSWQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViTmFtZVVwcGVyID0gc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdC5uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzSEdFTUMgPSBzdWJOYW1lVXBwZXIuaW5jbHVkZXMoIkhJU1RPSVJFIikgfHwgc3ViTmFtZVVwcGVyLmluY2x1ZGVzKCJHRU8iKSB8fCBzdWJOYW1lVXBwZXIuaW5jbHVkZXMoIkhHIikgfHwgc3ViTmFtZVVwcGVyLmluY2x1ZGVzKCJFTUMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNTY2llbmNlcyA9IHN1Yk5hbWVVcHBlci5pbmNsdWRlcygiU0NJRU5DRSIpIHx8IHN1Yk5hbWVVcHBlci5pbmNsdWRlcygiU1ZUIikgfHwgc3ViTmFtZVVwcGVyLmluY2x1ZGVzKCJQSFkiKSB8fCBzdWJOYW1lVXBwZXIuaW5jbHVkZXMoIlRFQ0hOTyIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudHMuZm9yRWFjaCgoYXNzaWduLCBpZHgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHggPiAwKSBkb2MuYWRkUGFnZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHkgPSBhZGRIZWFkZXIoYExJU1RFIERFIENPTlRSw5RMRSBERSBDT1JSRUNUSU9OYCwgYCR7c2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdC5uYW1lfWApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSArPSAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMSk7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAiYm9sZCIpOyBkb2Muc2V0VGV4dENvbG9yKDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYENvcnJlY3RldXIgOiAke2Fzc2lnbi50ZWFjaGVyTmFtZX1gLCAxNCwgeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgIm5vcm1hbCIpOyBkb2Muc2V0Rm9udFNpemUoMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoYExvdCA6ICR7YXNzaWduLnN0YXJ0QW5vbnltfSDDoCAke2Fzc2lnbi5lbmRBbm9ueW19ICgke2Fzc2lnbi5jb3VudH0gY29waWVzKWAsIDE0LCB5ICsgNik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ICs9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmF0Y2hTdHVkZW50cyA9IGFub255bWl6ZWRTdHVkZW50cy5zbGljZShhc3NpZ24uc3RhcnRSYW5rIC0gMSwgYXNzaWduLmVuZFJhbmspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGhlYWRSb3csIGJvZHlEYXRhLCBjb2xTdHlsZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNIR0VNQykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRSb3cgPSBbWydOwrAgQW5vbnltYXQnLCAnTm90ZSBIRycsICdOb3RlIEVNQycsICdUT1RBTCcsICdPYnNlcnZhdGlvbnMgLyBBcHByw6ljaWF0aW9ucyddXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5RGF0YSA9IGJhdGNoU3R1ZGVudHMubWFwKHMgPT4gW3MuYW5vbnltb3VzSWQsICIiLCAiIiwgIiIsICIiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sU3R5bGVzID0geyAwOiB7IGNlbGxXaWR0aDogMzAsIGhhbGlnbjogJ2NlbnRlcicgfSwgMTogeyBjZWxsV2lkdGg6IDIwLCBoYWxpZ246ICdjZW50ZXInIH0sIDI6IHsgY2VsbFdpZHRoOiAyMCwgaGFsaWduOiAnY2VudGVyJyB9LCAzOiB7IGNlbGxXaWR0aDogMjAsIGhhbGlnbjogJ2NlbnRlcicsIGZvbnRTdHlsZTogJ2JvbGQnIH0sIDQ6IHsgY2VsbFdpZHRoOiAnYXV0bycgfSB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1NjaWVuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFJvdyA9IFtbJ07CsCBBbm9ueW1hdCcsICdTQ0lFTkNFIDEnLCAnU0NJRU5DRSAyJywgJ1RPVEFMJywgJ09ic2VydmF0aW9ucyAvIEFwcHLDqWNpYXRpb25zJ11dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlEYXRhID0gYmF0Y2hTdHVkZW50cy5tYXAocyA9PiBbcy5hbm9ueW1vdXNJZCwgIiIsICIiLCAiIiwgIiJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xTdHlsZXMgPSB7IDA6IHsgY2VsbFdpZHRoOiAzMCwgaGFsaWduOiAnY2VudGVyJyB9LCAxOiB7IGNlbGxXaWR0aDogMjAsIGhhbGlnbjogJ2NlbnRlcicgfSwgMjogeyBjZWxsV2lkdGg6IDIwLCBoYWxpZ246ICdjZW50ZXInIH0sIDM6IHsgY2VsbFdpZHRoOiAyMCwgaGFsaWduOiAnY2VudGVyJywgZm9udFN0eWxlOiAnYm9sZCcgfSwgNDogeyBjZWxsV2lkdGg6ICdhdXRvJyB9IH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRSb3cgPSBbWydOwrAgQW5vbnltYXQnLCAnTm90ZScsICdPYnNlcnZhdGlvbnMgLyBBcHByw6ljaWF0aW9ucyddXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5RGF0YSA9IGJhdGNoU3R1ZGVudHMubWFwKHMgPT4gW3MuYW5vbnltb3VzSWQsICIiLCAiIl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbFN0eWxlcyA9IHsgMDogeyBjZWxsV2lkdGg6IDQwLCBoYWxpZ246ICdjZW50ZXInIH0sIDE6IHsgY2VsbFdpZHRoOiAzMCwgaGFsaWduOiAnY2VudGVyJyB9LCAyOiB7IGNlbGxXaWR0aDogJ2F1dG8nIH0gfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5hdXRvVGFibGUoeyBzdGFydFk6IHksIGhlYWQ6IGhlYWRSb3csIGJvZHk6IGJvZHlEYXRhLCB0aGVtZTogJ2dyaWQnLCBoZWFkU3R5bGVzOiB7IGZpbGxDb2xvcjogWzUwLCA1MCwgNTBdLCB0ZXh0Q29sb3I6IFsyNTUsIDI1NSwgMjU1XSB9LCBjb2x1bW5TdHlsZXM6IGNvbFN0eWxlcywgc3R5bGVzOiB7IG1pbkNlbGxIZWlnaHQ6IDEwLCBmb250U2l6ZTogMTAsIGxpbmVDb2xvcjogWzE1MCwgMTUwLCAxNTBdIH0sIG1hcmdpbjogeyBib3R0b206IDIwIH0gfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFkgPSBkb2MubGFzdEF1dG9UYWJsZS5maW5hbFkgKyAyMDsgZG9jLnNldEZvbnRTaXplKDEwKTsgZG9jLnRleHQoIlNpZ25hdHVyZSBkdSBjb3JyZWN0ZXVyIDoiLCAxMzAsIGZpbmFsWSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2F2ZShgbGlzdGVzX2NvcnJlY3Rpb25fJHtzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0Lm5hbWV9LnBkZmApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jVHlwZSA9PT0gJ2NvbnZvY2F0aW9ucycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tIENPTlZPQ0FUSU9OUyBFTEVWRVMgLS0tCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRwbCA9IGRvY1RlbXBsYXRlcy5zdHVkZW50OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3J0ZWRTdHVkZW50cyA9IFsuLi5zdHVkZW50c10uc29ydCgoYSwgYikgPT4gYS5sYXN0bmFtZS5sb2NhbGVDb21wYXJlKGIubGFzdG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgc29ydGVkU3R1ZGVudHMuZm9yRWFjaCgoc3R1ZGVudCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IDApIGRvYy5hZGRQYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgeSA9IGFkZEhlYWRlcih0cGwudGl0bGUsIHRwbC5zdWJ0aXRsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5IC09IDU7IC8vIEFqdXN0ZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVdGlsaXNhdGlvbiBCb2l0ZSBVbmlmacOpZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSA9IGFkZFJlY2lwaWVudEJveChbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYENhbmRpZGF0IDogJHtzdHVkZW50Lmxhc3RuYW1lfSAke3N0dWRlbnQuZmlyc3RuYW1lfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYENsYXNzZSA6ICR7c3R1ZGVudC5jbGFzc31gLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBJTkUgLyBJZGVudGlmaWFudCA6ICR7c3R1ZGVudC5pbmUgfHwgJ05vbiByZW5zZWlnbsOpJ31gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLCB5LCBzdHVkZW50LmlzVFQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFERElUSU9OOiBJbnRybyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHBsLmludHJvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJub3JtYWwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0SW50cm8gPSBkb2Muc3BsaXRUZXh0VG9TaXplKHRwbC5pbnRybywgcGFnZVdpZHRoIC0gMzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KHNwbGl0SW50cm8sIDE1LCB5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ICs9IChzcGxpdEludHJvLmxlbmd0aCAqIDYpICsgMzsgLy8gT3B0aW1pc8OpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFTkQgQURESVRJT04KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50Um9vbSA9IHJvb21zLmZpbmQociA9PiByLmlkID09PSBzdHVkZW50LnJvb21JZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb29tTmFtZSA9IHN0dWRlbnRSb29tID8gc3R1ZGVudFJvb20ubmFtZSA6ICJOT04gQUZGRUNUw4kgKFZvaXIgYWRtaW5pc3RyYXRpb24pIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlRGF0YSA9IHN1YmplY3RzLm1hcChzdWIgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlUaW1lID0gKHN0dWRlbnQuaXNUVCAmJiBzdWIudGltZVRUKSA/IHN1Yi50aW1lVFQgOiBzdWIudGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJMYWJlbCA9IChzdWIuZGlzY2lwbGluZXMgJiYgc3ViLmRpc2NpcGxpbmVzLmxlbmd0aCA+IDApID8gYCR7c3ViLm5hbWV9XG4oJHtzdWIuZGlzY2lwbGluZXMuam9pbignIC0gJyl9KWAgOiBzdWIubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3N1Yi5kYXRlLCBkaXNwbGF5VGltZSwgc3ViTGFiZWwsIHJvb21OYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3R5bGUgR3JpZCBVbmlmacOpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuYXV0b1RhYmxlKHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRZOiB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBbWydEYXRlJywgJ0hvcmFpcmUnLCAnw4lwcmV1dmUnLCAnU2FsbGUnXV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IHRhYmxlRGF0YSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbWU6ICdncmlkJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFN0eWxlczogeyBmaWxsQ29sb3I6IFsyMzAsIDIzMCwgMjMwXSwgdGV4dENvbG9yOiBbMCwgMCwgMF0sIGZvbnRTdHlsZTogJ2JvbGQnLCBsaW5lV2lkdGg6IDAuMSwgbGluZUNvbG9yOiBbMCwgMCwgMF0gfSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiB7IGZvbnRTaXplOiA5LCBjZWxsUGFkZGluZzogMi41LCB2YWxpZ246ICdtaWRkbGUnLCBsaW5lQ29sb3I6IFswLCAwLCAwXSwgbGluZVdpZHRoOiAwLjEsIHRleHRDb2xvcjogWzAsIDAsIDBdIH0sIC8vIE9wdGltaXPDqQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtblN0eWxlczogeyAwOiB7IGNlbGxXaWR0aDogNDAgfSwgMTogeyBjZWxsV2lkdGg6IDM1LCBmb250U3R5bGU6ICdib2xkJyB9LCAyOiB7IGNlbGxXaWR0aDogJ2F1dG8nIH0sIDM6IHsgY2VsbFdpZHRoOiA0MCwgaGFsaWduOiAnY2VudGVyJywgZm9udFN0eWxlOiAnYm9sZCcgfSB9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFkgPSBkb2MubGFzdEF1dG9UYWJsZS5maW5hbFkgKyA4OyAvLyBPcHRpbWlzw6kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMCk7IGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAiYm9sZCIpOyBkb2MudGV4dCgiQ09OU0lHTkVTIElNUE9SVEFOVEVTIDoiLCAxNSwgZmluYWxZKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7IGRvYy5zZXRGb250U2l6ZSg5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXRpbGlzYXRpb24gZGVzIGNvbnNpZ25lcyBkdSB0ZW1wbGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0cGwuY29uc2lnbmVzLnNwbGl0KCdcbicpLmZpbHRlcihsID0+IGwudHJpbSgpICE9PSAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGluZVkgPSBmaW5hbFkgKyA2OyBsaW5lcy5mb3JFYWNoKGxpbmUgPT4geyBkb2MudGV4dChsaW5lLCAxNSwgbGluZVkpOyBsaW5lWSArPSA0LjU7IH0pOyAvLyBPcHRpbWlzw6kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2lnbmF0dXJlIFVuaWZpw6llIEJhcyBkZSBQYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRTaWduYXR1cmVCb3R0b20obGluZVkpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNhdmUoImNvbnZvY2F0aW9uc19lbGV2ZXMucGRmIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2NUeXBlID09PSAnY29udm9jYXRpb25zX3N1cnZlaWxsYW50cycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBDT05WT0NBVElPTlMgU1VSVkVJTExBTlRTIC0tLQogICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHBsID0gZG9jVGVtcGxhdGVzLnN1cnZlaWxsYW50OwogICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWdubWVudHNCeVRlYWNoZXIgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdHMuZm9yRWFjaChzdWIgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbXMuZm9yRWFjaChyb29tID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBERVRFQ1RFUiBTSSBFTEVWRSBUVCBFU1QgREFOUyBMQSBTQUxMRSBQT1VSIEFEQVBURVIgTEVTIEhPUkFJUkVTIERFUyBTVVJWRUlMTEFOVFMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNUVCA9IHN0dWRlbnRzLnNvbWUocyA9PiBzLnJvb21JZCA9PT0gcm9vbS5pZCAmJiBzLmlzVFQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVRpbWUgPSBoYXNUVCAmJiBzdWIudGltZVRUID8gc3ViLnRpbWVUVCA6IHN1Yi50aW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVTbG90cyA9IHN1cnZlaWxsYW5jZU1vZGUgPT09ICd3aXRoX3JvdGF0aW9uJyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBjYWxjdWxhdGVUaW1lU2xvdHMoYWN0aXZlVGltZSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogW3sgbGFiZWw6IGFjdGl2ZVRpbWUgfV07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTbG90cy5mb3JFYWNoKChzbG90LCBzbG90SW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWduS2V5ID0gYCR7c3ViLmlkfS0ke3Jvb20uaWR9LSR7c2xvdEluZGV4fWA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzc2lnbmVkVGVhY2hlcklkcyA9IHN1cnZlaWxsYW5jZUFzc2lnbm1lbnRzW2Fzc2lnbktleV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25lZFRlYWNoZXJJZHMgJiYgYXNzaWduZWRUZWFjaGVySWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbmVkVGVhY2hlcklkcy5mb3JFYWNoKHRpZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aWQpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFzc2lnbm1lbnRzQnlUZWFjaGVyW3RpZF0pIHsgY29uc3QgdGVhY2hlciA9IHRlYWNoZXJzLmZpbmQodCA9PiB0LmlkID09PSB0aWQpOyBpZiAodGVhY2hlcikgYXNzaWdubWVudHNCeVRlYWNoZXJbdGlkXSA9IHsgaW5mbzogdGVhY2hlciwgc2xvdHM6IFtdIH07IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWdubWVudHNCeVRlYWNoZXJbdGlkXSkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9vbUxhYmVsID0gaGFzVFQgPyBgJHtyb29tLm5hbWV9IChUVClgIDogcm9vbS5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50c0J5VGVhY2hlclt0aWRdLnNsb3RzLnB1c2goeyBzdWJqZWN0OiBzdWIubmFtZSwgZGF0ZTogc3ViLmRhdGUsIHRpbWU6IHNsb3QubGFiZWwsIHJvb206IHJvb21MYWJlbCB9KTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVhY2hlcklkcyA9IE9iamVjdC5rZXlzKGFzc2lnbm1lbnRzQnlUZWFjaGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlYWNoZXJJZHMubGVuZ3RoID09PSAwKSB7IHNob3dOb3RpZmljYXRpb24oIkF1Y3VuZSBzdXJ2ZWlsbGFuY2UgISIsICJlcnJvciIpOyByZXR1cm47IH0KICAgICAgICAgICAgICAgICAgICAgICAgdGVhY2hlcklkcy5zb3J0KChhLGIpID0+IGFzc2lnbm1lbnRzQnlUZWFjaGVyW2FdLmluZm8ubGFzdG5hbWUubG9jYWxlQ29tcGFyZShhc3NpZ25tZW50c0J5VGVhY2hlcltiXS5pbmZvLmxhc3RuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlYWNoZXJJZHMuZm9yRWFjaCgodGlkLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gMCkgZG9jLmFkZFBhZ2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhc3NpZ25tZW50c0J5VGVhY2hlclt0aWRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHkgPSBhZGRIZWFkZXIodHBsLnRpdGxlLCB0cGwuc3VidGl0bGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSAtPSA1OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFV0aWxpc2F0aW9uIEJvaXRlIFVuaWZpw6llCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0gYWRkUmVjaXBpZW50Qm94KFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgRGVzdGluYXRhaXJlIDogJHtkYXRhLmluZm8uY2l2fSAke2RhdGEuaW5mby5sYXN0bmFtZX0gJHtkYXRhLmluZm8uZmlyc3RuYW1lfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYFN0YXR1dCA6IFN1cnZlaWxsYW50IGQnZXhhbWVuYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgU2Vzc2lvbiA6ICR7c2Nob29sQ29uZmlnLnNlc3Npb25OYW1lIHx8ICdETkIgQmxhbmMnfWAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sIHkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7IGRvYy5zZXRGb250U2l6ZSgxMSk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW50cm8gdGVtcGxhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0SW50cm8gPSBkb2Muc3BsaXRUZXh0VG9TaXplKHRwbC5pbnRybywgcGFnZVdpZHRoIC0gMzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnRleHQoc3BsaXRJbnRybywgMTUsIHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeSArPSAoc3BsaXRJbnRyby5sZW5ndGggKiA2KSArIDM7IC8vIE9wdGltaXPDqQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsgZG9jLnRleHQoIlBsYW5uaW5nIGRlIHZvcyBzdXJ2ZWlsbGFuY2VzIDoiLCAyMCwgeSk7IHkgKz0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc2xvdHMuc29ydCgoYSwgYikgPT4geyBpZiAoYS5kYXRlICE9PSBiLmRhdGUpIHJldHVybiBhLmRhdGUubG9jYWxlQ29tcGFyZShiLmRhdGUpOyByZXR1cm4gYS50aW1lLmxvY2FsZUNvbXBhcmUoYi50aW1lKTsgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWJsZUJvZHkgPSBkYXRhLnNsb3RzLm1hcChzbG90ID0+IFtzbG90LmRhdGUsIHNsb3QudGltZSwgc2xvdC5zdWJqZWN0LCBzbG90LnJvb21dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5hdXRvVGFibGUoeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFk6IHksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQ6IFtbJ0RhdGUnLCAnQ3LDqW5lYXUnLCAnw4lwcmV1dmUnLCAnU2FsbGUnXV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IHRhYmxlQm9keSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbWU6ICdncmlkJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFN0eWxlczogeyBmaWxsQ29sb3I6IFsyMzAsIDIzMCwgMjMwXSwgdGV4dENvbG9yOiBbMCwwLDBdLCBmb250U3R5bGU6ICdib2xkJywgbGluZUNvbG9yOiBbMCwwLDBdLCBsaW5lV2lkdGg6IDAuMSB9LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5TdHlsZXM6IHsgMDogeyBjZWxsV2lkdGg6IDM1IH0sIDE6IHsgY2VsbFdpZHRoOiA0MCwgZm9udFN0eWxlOiAnYm9sZCcgfSwgMjogeyBjZWxsV2lkdGg6ICdhdXRvJyB9LCAzOiB7IGNlbGxXaWR0aDogMzAsIGhhbGlnbjogJ2NlbnRlcicsIGZvbnRTdHlsZTogJ2JvbGQnIH0gfSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiB7IGZvbnRTaXplOiA5LCBjZWxsUGFkZGluZzogMi41LCB2YWxpZ246ICdtaWRkbGUnLCBsaW5lQ29sb3I6IFswLDAsMF0sIGxpbmVXaWR0aDogMC4xLCB0ZXh0Q29sb3I6IFswLDAsMF0gfSAvLyBPcHRpbWlzw6kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZpbmFsWSA9IGRvYy5sYXN0QXV0b1RhYmxlLmZpbmFsWSArIDg7IC8vIE9wdGltaXPDqQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnRTaXplKDEwKTsgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJib2xkIik7IGRvYy50ZXh0KCJDT05TSUdORVMgREUgU1VSVkVJTExBTkNFIDoiLCAyMCwgZmluYWxZKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250KCJoZWx2ZXRpY2EiLCAibm9ybWFsIik7IGZpbmFsWSArPSA2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVdGlsaXNhdGlvbiBjb25zaWduZXMgdGVtcGxhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnNpZ25lcyA9IHRwbC5jb25zaWduZXMuc3BsaXQoJ1xuJykuZmlsdGVyKGwgPT4gbC50cmltKCkgIT09ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNpZ25lcy5mb3JFYWNoKGxpbmUgPT4geyBkb2MudGV4dChsaW5lLCAyMCwgZmluYWxZKTsgZmluYWxZICs9IDQuNTsgfSk7IC8vIE9wdGltaXPDqQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTaWduYXR1cmUgVW5pZmnDqWUgQmFzIGRlIFBhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFNpZ25hdHVyZUJvdHRvbShmaW5hbFkpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNhdmUoImNvbnZvY2F0aW9uc19zdXJ2ZWlsbGFudHMucGRmIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2NUeXBlID09PSAnY29udm9jYXRpb25zX2Flc2gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gQ09OVk9DQVRJT05TIEFFU0ggLS0tCiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cGwgPSBkb2NUZW1wbGF0ZXMuYWVzaDsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFlc2hlcyA9IHt9OyAKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHMuZmlsdGVyKHMgPT4gcy5hZXNoICYmIHMuYWVzaC50cmltKCkgIT09ICIiKS5mb3JFYWNoKHN0dWRlbnQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWVzaE5hbWUgPSBzdHVkZW50LmFlc2gudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFlc2hlc1thZXNoTmFtZV0pIGFlc2hlc1thZXNoTmFtZV0gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0dWRlbnRSb29tID0gcm9vbXMuZmluZChyID0+IHIuaWQgPT09IHN0dWRlbnQucm9vbUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvb21OYW1lID0gc3R1ZGVudFJvb20gPyBzdHVkZW50Um9vbS5uYW1lIDogIk5PTiBBRkZFQ1TDiSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0cy5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IHN1Yi50aW1lVFQgPyBzdWIudGltZVRUIDogc3ViLnRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWVzaGVzW2Flc2hOYW1lXS5wdXNoKHsgZGF0ZTogc3ViLmRhdGUsIHRpbWU6IHRpbWUsIHN1YmplY3Q6IHN1Yi5uYW1lLCBzdHVkZW50TmFtZTogYCR7c3R1ZGVudC5sYXN0bmFtZX0gJHtzdHVkZW50LmZpcnN0bmFtZX1gLCBzdHVkZW50Q2xhc3M6IHN0dWRlbnQuY2xhc3MsIHJvb206IHJvb21OYW1lIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhZXNoTmFtZXMgPSBPYmplY3Qua2V5cyhhZXNoZXMpLnNvcnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFlc2hOYW1lcy5sZW5ndGggPT09IDApIHsgc2hvd05vdGlmaWNhdGlvbigiQXVjdW4gQUVTSCAhIiwgImVycm9yIik7IHJldHVybjsgfQogICAgICAgICAgICAgICAgICAgICAgICBhZXNoTmFtZXMuZm9yRWFjaCgobmFtZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IDApIGRvYy5hZGRQYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzbG90cyA9IGFlc2hlc1tuYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB5ID0gYWRkSGVhZGVyKHRwbC50aXRsZSwgdHBsLnN1YnRpdGxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgLT0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXRpbGlzYXRpb24gQm9pdGUgVW5pZmnDqWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgPSBhZGRSZWNpcGllbnRCb3goWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBEZXN0aW5hdGFpcmUgOiAke25hbWV9YCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgU3RhdHV0IDogQWNjb21wYWduYW50IChBRVNIKWAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYFNlc3Npb24gOiAke3NjaG9vbENvbmZpZy5zZXNzaW9uTmFtZSB8fCAnRE5CIEJsYW5jJ31gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLCB5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgIm5vcm1hbCIpOyBkb2Muc2V0Rm9udFNpemUoMTEpOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEludHJvIHRlbXBsYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGxpdEludHJvID0gZG9jLnNwbGl0VGV4dFRvU2l6ZSh0cGwuaW50cm8sIHBhZ2VXaWR0aCAtIDMwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KHNwbGl0SW50cm8sIDE1LCB5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgKz0gKHNwbGl0SW50cm8ubGVuZ3RoICogNikgKyAzOyAvLyBPcHRpbWlzw6kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJib2xkIik7IGRvYy50ZXh0KCJQbGFubmluZyBkJ2FjY29tcGFnbmVtZW50IDoiLCAyMCwgeSk7IHkgKz0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlQm9keSA9IHNsb3RzLm1hcChzbG90ID0+IFtzbG90LmRhdGUsIHNsb3QudGltZSwgYCR7c2xvdC5zdHVkZW50TmFtZX1cbigke3Nsb3Quc3R1ZGVudENsYXNzfSlgLCBzbG90LnN1YmplY3QsIHNsb3Qucm9vbV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmF1dG9UYWJsZSh7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0WTogeSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZDogW1snRGF0ZScsICdIb3JhaXJlJywgJ8OJbMOodmUnLCAnw4lwcmV1dmUnLCAnU2FsbGUnXV0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IHRhYmxlQm9keSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbWU6ICdncmlkJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFN0eWxlczogeyBmaWxsQ29sb3I6IFsyMzAsIDIzMCwgMjMwXSwgdGV4dENvbG9yOiBbMCwwLDBdLCBmb250U3R5bGU6ICdib2xkJywgbGluZUNvbG9yOiBbMCwwLDBdLCBsaW5lV2lkdGg6IDAuMSB9LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXM6IHsgZm9udFNpemU6IDksIGNlbGxQYWRkaW5nOiAyLjUsIHZhbGlnbjogJ21pZGRsZScsIGxpbmVDb2xvcjogWzAsMCwwXSwgbGluZVdpZHRoOiAwLjEsIHRleHRDb2xvcjogWzAsMCwwXSB9IC8vIE9wdGltaXPDqQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZmluYWxZID0gZG9jLmxhc3RBdXRvVGFibGUuZmluYWxZICsgODsgLy8gT3B0aW1pc8OpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNpZ25hdHVyZSBVbmlmacOpZSBCYXMgZGUgUGFnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkU2lnbmF0dXJlQm90dG9tKGZpbmFsWSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBkb2Muc2F2ZSgiY29udm9jYXRpb25zX2Flc2gucGRmIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gLS0tIE5PVVZFQVUgUkVOREVSIFBPVVIgRE9DVU1FTlRTIEFWRUMgRURJVEVVUiAtLS0KICAgICAgICAgICAgY29uc3QgcmVuZGVyRG9jdW1lbnRzID0gKCkgPT4gKAogICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktNiBhbmltYXRlLWZhZGUtaW4iPgogICAgICAgICAgICAgICAgICAgIHsvKiBCb3V0b24gcG91ciBvdXZyaXIgbCfDqWRpdGV1ciBkZSB0ZW1wbGF0ZXMgKi99CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBiZy13aGl0ZSBwLTQgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTEwMCBzaGFkb3ctc20iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzTmFtZT0idGV4dC1sZyBmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAiPkNlbnRyZSBkJ2ltcHJlc3Npb248L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LXNtIHRleHQtc2xhdGUtNTAwIj5Hw6luw6lyZXogdm9zIGRvY3VtZW50cyBvZmZpY2llbHMuIFZvdXMgcG91dmV6IHBlcnNvbm5hbGlzZXIgbGVzIHRleHRlcyBhdmFudCBpbXByZXNzaW9uLjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRJc1RlbXBsYXRlRWRpdG9yT3BlbighaXNUZW1wbGF0ZUVkaXRvck9wZW4pfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9InNlY29uZGFyeSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uPXtpc1RlbXBsYXRlRWRpdG9yT3BlbiA/IENoZWNrIDogRWRpdDN9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2lzVGVtcGxhdGVFZGl0b3JPcGVuID8gImJnLXNreS01MCB0ZXh0LXNreS02MDAgYm9yZGVyLXNreS0yMDAiIDogIiJ9CiAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpc1RlbXBsYXRlRWRpdG9yT3BlbiA/ICJNYXNxdWVyIGwnw6lkaXRldXIiIDogIkNvbmZpZ3VyZXIgbGVzIE1vZMOobGVzIn0KICAgICAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIHsvKiDDiWRpdGV1ciBkZSBtb2TDqGxlcyAoQ29uZGl0aW9ubmVsKSAqL30KICAgICAgICAgICAgICAgICAgICB7aXNUZW1wbGF0ZUVkaXRvck9wZW4gJiYgKAogICAgICAgICAgICAgICAgICAgICAgICA8RG9jVGVtcGxhdGVFZGl0b3IgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZXM9e2RvY1RlbXBsYXRlc30gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUZW1wbGF0ZXM9e3NldERvY1RlbXBsYXRlc30gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlPXsoKSA9PiBzZXRJc1RlbXBsYXRlRWRpdG9yT3BlbihmYWxzZSl9CiAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgbGc6Z3JpZC1jb2xzLTMgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICB7WwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogJ2V0aXF1ZXR0ZXNfYW5vbnltYXQnLCBsYWJlbDogIsOJdGlxdWV0dGVzIGRlIHRhYmxlIiwgaWNvbjogRmlsZVRleHQsIGRlc2M6ICJQbGFuY2hlIGQnw6l0aXF1ZXR0ZXMgYXZlYyBOb20sIFByw6lub20sIElORSBldCBTYWxsZS4iIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAnZXRpcXVldHRlc190YWJsZV9hbWVuYWdlbWVudHMnLCBsYWJlbDogIsOJdGlxdWV0dGVzIFRhYmxlIChBdmVjIE1lbnRpb24gVFQpIiwgaWNvbjogQ2xvY2ssIGRlc2M6ICJJZGVudGlxdWUgYXV4IMOpdGlxdWV0dGVzIHN0YW5kYXJkcyBhdmVjIG1lbnRpb24gJ1RJRVJTIFRFTVBTJyBlbiByb3VnZS4iIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAncGxhbnNfc2FsbGUnLCBsYWJlbDogIlBsYW5zIGRlIFNhbGxlIiwgaWNvbjogTGF5b3V0RGFzaGJvYXJkLCBkZXNjOiAiTGlzdGUgZGVzIMOpbMOodmVzIHBhciBzYWxsZSBwb3VyIGFmZmljaGFnZS4iIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAnZW1hcmdlbWVudCcsIGxhYmVsOiAiTGlzdGVzIGQnw4ltYXJnZW1lbnQiLCBpY29uOiBGaWxlU3ByZWFkc2hlZXQsIGRlc2M6ICJGZXVpbGxlcyBkZSBzaWduYXR1cmVzIHN0YW5kYXJkcyBwYXIgw6lwcmV1dmUuIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogJ2VtYXJnZW1lbnRfdHQnLCBsYWJlbDogIsOJbWFyZ2VtZW50IChBdmVjIE1lbnRpb24gVFQpIiwgaWNvbjogRmlsZVNwcmVhZHNoZWV0LCBkZXNjOiAiTGlzdGVzIGF2ZWMgY29sb25uZSBzcMOpY2lmaXF1ZSBwb3VyIHbDqXJpZmllciBsZXMgYW3DqW5hZ2VtZW50cy4iIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAncG9jaGV0dGVzJywgbGFiZWw6ICJQb2NoZXR0ZXMgZGUgQ29waWVzIiwgaWNvbjogRmlsZVRleHQsIGRlc2M6ICJHcmFuZGVzIMOpdGlxdWV0dGVzIHBvdXIgbGVzIGVudmVsb3BwZXMuIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogJ2V0aXF1ZXR0ZXNfY29waWVzX2luZGl2aWR1ZWxsZXMnLCBsYWJlbDogIsOJdGlxdWV0dGVzIENvcGllcyAoRXhjZWwpIiwgaWNvbjogRmlsZVNwcmVhZHNoZWV0LCBkZXNjOiAiRmljaGllciBFeGNlbCBwb3VyIHB1YmxpcG9zdGFnZSAoTsKwICsgTWF0acOocmUgKyBOb20pLiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdldGlxdWV0dGVzX2NvcGllc19wZGYnLCBsYWJlbDogIsOJdGlxdWV0dGVzIENvcGllcyAoUERGKSIsIGljb246IFByaW50ZXIsIGRlc2M6ICJGb3JtYXQgMTA1eDM1bW0uIFBhcnRpZSBBbm9ueW1hdCBkw6l0YWNow6llLiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdsaXN0ZXNfY29ycmVjdGlvbl9kZXRhaWwnLCBsYWJlbDogIkxpc3RlcyBkZSBDb250csO0bGUgKEE0KSIsIGljb246IExpc3QsIGRlc2M6ICJGZXVpbGxlIEE0IHBhciBjb3JyZWN0ZXVyIGF2ZWMgbGlzdGUgZGVzIG51bcOpcm9zIMOgIGNvcnJpZ2VyLiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvY3VtZW50cyBQZXJzb25uYWxpc2FibGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAnY29udm9jYXRpb25zJywgbGFiZWw6ICJDb252b2NhdGlvbnMgw4lsw6h2ZXMiLCBpY29uOiBGaWxlVGV4dCwgZGVzYzogIkNvbnZvY2F0aW9ucyBpbmRpdmlkdWVsbGVzIEE0IGF2ZWMgZW1wbG9pIGR1IHRlbXBzIGV0IHNhbGxlLiIsIGN1c3RvbTogdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogJ2NvbnZvY2F0aW9uc19zdXJ2ZWlsbGFudHMnLCBsYWJlbDogIkNvbnZvY2F0aW9ucyBTdXJ2ZWlsbGFudHMiLCBpY29uOiBFeWUsIGRlc2M6ICJPcmRyZXMgZGUgbWlzc2lvbiBpbmRpdmlkdWVscyBwb3VyIGxhIHN1cnZlaWxsYW5jZS4iLCBjdXN0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdjb252b2NhdGlvbnNfYWVzaCcsIGxhYmVsOiAiQ29udm9jYXRpb25zIEFFU0giLCBpY29uOiBVc2VycywgZGVzYzogIk9yZHJlcyBkZSBtaXNzaW9uIHBvdXIgbGVzIGFjY29tcGFnbmFudHMgcGFyIMOpbMOodmUuIiwgY3VzdG9tOiB0cnVlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAnY29udm9jYXRpb25zX3NlY3JldGFyaWF0JywgbGFiZWw6ICJDb252b2NhdGlvbnMgU2VjcsOpdGFyaWF0IiwgaWNvbjogQXJjaGl2ZSwgZGVzYzogIk9yZHJlcyBkZSBtaXNzaW9uIHBvdXIgbGEgZ2VzdGlvbiBkZSBmaW4gZCfDqXByZXV2ZS4iLCBjdXN0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgXS5tYXAoZG9jID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtkb2MuaWR9IGNsYXNzTmFtZT17YGJnLXdoaXRlIGJvcmRlciByb3VuZGVkLXhsIHAtNiBob3ZlcjpzaGFkb3ctbGcgdHJhbnNpdGlvbi1hbGwgdHJhbnNmb3JtIGhvdmVyOi10cmFuc2xhdGUteS0xIHRleHQtY2VudGVyIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGN1cnNvci1wb2ludGVyICR7ZG9jLmN1c3RvbSA/ICdib3JkZXItc2t5LTEwMCByaW5nLTEgcmluZy1za3ktNTAnIDogJ2JvcmRlci1zbGF0ZS0xMDAnfWB9IG9uQ2xpY2s9eygpID0+IGRvYy5pZCAhPT0gJ2V0aXF1ZXR0ZXNfY29waWVzX2luZGl2aWR1ZWxsZXMnID8gZ2VuZXJhdGVQREYoZG9jLmlkKSA6IGhhbmRsZUV4cG9ydCgnY29weV9sYWJlbHMnKX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2BwLTQgcm91bmRlZC1mdWxsIG1iLTQgJHtkb2MuY3VzdG9tID8gJ2JnLXNreS0xMDAnIDogJ2JnLXNsYXRlLTUwJ31gfT57ZG9jLmljb24gPyA8ZG9jLmljb24gY2xhc3NOYW1lPXtgdy04IGgtOCAke2RvYy5jdXN0b20gPyAndGV4dC1za3ktNjAwJyA6ICd0ZXh0LXNsYXRlLTUwMCd9YH0gLz4gOiBudWxsfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtbGcgZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIG1iLTIiPntkb2MubGFiZWx9PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtc20gdGV4dC1zbGF0ZS01MDAgbWItNiBmbGV4LWdyb3ciPntkb2MuZGVzY308L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2RvYy5pZCAhPT0gJ2V0aXF1ZXR0ZXNfY29waWVzX2luZGl2aWR1ZWxsZXMnICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXsoZSkgPT4geyBlLnN0b3BQcm9wYWdhdGlvbigpOyBnZW5lcmF0ZVBERihkb2MuaWQpOyB9fSBpY29uPXtQcmludGVyfSBjbGFzc05hbWU9InctZnVsbCI+R8OpbsOpcmVyIFBERjwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtkb2MuaWQgPT09ICdldGlxdWV0dGVzX2NvcGllc19pbmRpdmlkdWVsbGVzJyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eyhlKSA9PiB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IGhhbmRsZUV4cG9ydCgnY29weV9sYWJlbHMnKTsgfX0gdmFyaWFudD0icHJpbWFyeSIgaWNvbj17RmlsZVNwcmVhZHNoZWV0fSBjbGFzc05hbWU9InctZnVsbCI+RXhwb3J0ZXIgRXhjZWw8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtkb2MuY3VzdG9tICYmIDxzcGFuIGNsYXNzTmFtZT0ibXQtMiB0ZXh0LVsxMHB4XSB0ZXh0LXNreS01MDAgZm9udC1tZWRpdW0gYmctc2t5LTUwIHB4LTIgcHktMC41IHJvdW5kZWQtZnVsbCI+VGV4dGUgUGVyc29ubmFsaXNhYmxlPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApOwoKICAgICAgICAgICAgLy8gLS0tIFJFTkRFUiBDT05GSUcgLS0tCiAgICAgICAgICAgIGNvbnN0IHJlbmRlckNvbmZpZyA9ICgpID0+ICgKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTYgYW5pbWF0ZS1mYWRlLWluIj4KICAgICAgICAgICAgICAgICAgICB7LyogRMOJUExBQ8OJIEVOIEhBVVQgOiBCTE9DIEFETUlOSVNUUkFUSU9OICovfQogICAgICAgICAgICAgICAgICAgIDxDYXJkIHRpdGxlPSJBZG1pbmlzdHJhdGlvbiBkZXMgRG9ubsOpZXMiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBsZzpncmlkLWNvbHMtNCBnYXAtNiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctc2t5LTUwIHAtNiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItc2t5LTEwMCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciB0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtMyByb3VuZGVkLWZ1bGwgc2hhZG93LXNtIG1iLTMiPjxTYXZlIGNsYXNzTmFtZT0idy02IGgtNiB0ZXh0LXNreS01MDAiIC8+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzTmFtZT0iZm9udC1zZW1pYm9sZCB0ZXh0LXNsYXRlLTgwMCI+U2F1dmVnYXJkZXI8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17aGFuZGxlU2F2ZVdvcmt9IGljb249e0Rvd25sb2FkfSBjbGFzc05hbWU9Im10LTQgdy1mdWxsIHRleHQteHMiPlTDqWzDqWNoYXJnZXIgKEpTT04pPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1lbWVyYWxkLTUwIHAtNiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItZW1lcmFsZC0xMDAgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy13aGl0ZSBwLTMgcm91bmRlZC1mdWxsIHNoYWRvdy1zbSBtYi0zIj48VXBsb2FkIGNsYXNzTmFtZT0idy02IGgtNiB0ZXh0LWVtZXJhbGQtNTAwIiAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtc2VtaWJvbGQgdGV4dC1zbGF0ZS04MDAiPlJlc3RhdXJlcjwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0ibXQtNCBjdXJzb3ItcG9pbnRlciBiZy13aGl0ZSBweS0yIHB4LTQgYm9yZGVyIGJvcmRlci1lbWVyYWxkLTIwMCByb3VuZGVkLWxnIHNoYWRvdy1zbSB0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZW1lcmFsZC02MDAgaG92ZXI6YmctZW1lcmFsZC01MCB3LWZ1bGwgaW5saW5lLWJsb2NrIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+Q2hvaXNpciBmaWNoaWVyLi4uPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgY2xhc3NOYW1lPSJzci1vbmx5IiBhY2NlcHQ9Ii5qc29uIiBvbkNoYW5nZT17aGFuZGxlTG9hZFdvcmt9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctaW5kaWdvLTUwIHAtNiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItaW5kaWdvLTEwMCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciB0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtMyByb3VuZGVkLWZ1bGwgc2hhZG93LXNtIG1iLTMiPjxCZWFrZXIgY2xhc3NOYW1lPSJ3LTYgaC02IHRleHQtaW5kaWdvLTUwMCIgLz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LXNlbWlib2xkIHRleHQtc2xhdGUtODAwIj5Nb2RlIETDqW1vPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2xvYWRHbG9iYWxEZW1vRGF0YX0gdmFyaWFudD0icHJpbWFyeSIgY2xhc3NOYW1lPSJtdC00IHctZnVsbCBiZy1pbmRpZ28tNTAwIGhvdmVyOmJnLWluZGlnby02MDAgdGV4dC14cyI+Q2hhcmdlciBEb25uw6llczwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXJvc2UtNTAgcC02IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci1yb3NlLTEwMCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciB0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtMyByb3VuZGVkLWZ1bGwgc2hhZG93LXNtIG1iLTMiPjxSb3RhdGVDY3cgY2xhc3NOYW1lPSJ3LTYgaC02IHRleHQtcm9zZS01MDAiIC8+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzTmFtZT0iZm9udC1zZW1pYm9sZCB0ZXh0LXNsYXRlLTgwMCI+Wm9uZSBkZSBEYW5nZXI8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17aGFuZGxlR2xvYmFsUmVzZXR9IHZhcmlhbnQ9ImRhbmdlciIgY2xhc3NOYW1lPSJtdC00IHctZnVsbCB0ZXh0LXhzIj5Sw6lpbml0aWFsaXNhdGlvbjwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvQ2FyZD4KCiAgICAgICAgICAgICAgICAgICAgPENhcmQgdGl0bGU9IkNvbmZpZ3VyYXRpb24gZGUgbCfDiXRhYmxpc3NlbWVudCIgaWNvbj17U2Nob29sfT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtc2xhdGUtNzAwIj5Ob20gZHUgQ29sbMOoZ2U8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT17c2Nob29sQ29uZmlnLm5hbWV9IG9uQ2hhbmdlPXsoZSkgPT4gc2V0U2Nob29sQ29uZmlnKHsuLi5zY2hvb2xDb25maWcsIG5hbWU6IGUudGFyZ2V0LnZhbHVlfSl9IGNsYXNzTmFtZT0idy1mdWxsIHAtMiBib3JkZXIgcm91bmRlZCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1za3ktMjAwIG91dGxpbmUtbm9uZSIgLz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1zbGF0ZS03MDAiPlZpbGxlPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgdmFsdWU9e3NjaG9vbENvbmZpZy5jaXR5fSBvbkNoYW5nZT17KGUpID0+IHNldFNjaG9vbENvbmZpZyh7Li4uc2Nob29sQ29uZmlnLCBjaXR5OiBlLnRhcmdldC52YWx1ZX0pfSBjbGFzc05hbWU9InctZnVsbCBwLTIgYm9yZGVyIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctc2t5LTIwMCBvdXRsaW5lLW5vbmUiIC8+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtc2xhdGUtNzAwIj5Ob20gZHUgQ2hlZiBkJ8OJdGFibGlzc2VtZW50PC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgdmFsdWU9e3NjaG9vbENvbmZpZy5wcmluY2lwYWx9IG9uQ2hhbmdlPXsoZSkgPT4gc2V0U2Nob29sQ29uZmlnKHsuLi5zY2hvb2xDb25maWcsIHByaW5jaXBhbDogZS50YXJnZXQudmFsdWV9KX0gY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLXNreS0yMDAgb3V0bGluZS1ub25lIiAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGxhYmVsIGNsYXNzTmFtZT0iYmxvY2sgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LXNsYXRlLTcwMCI+Tm9tIGRlIGxhIFNlc3Npb248L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT17c2Nob29sQ29uZmlnLnNlc3Npb25OYW1lfSBvbkNoYW5nZT17KGUpID0+IHNldFNjaG9vbENvbmZpZyh7Li4uc2Nob29sQ29uZmlnLCBzZXNzaW9uTmFtZTogZS50YXJnZXQudmFsdWV9KX0gY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLXNreS0yMDAgb3V0bGluZS1ub25lIiAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJvcmRlci0yIGJvcmRlci1kYXNoZWQgYm9yZGVyLXNsYXRlLTMwMCByb3VuZGVkLWxnIHAtMyBiZy1zbGF0ZS01MCBmbGV4LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2Nob29sQ29uZmlnLmxvZ29VcmwgPyA8aW1nIHNyYz17c2Nob29sQ29uZmlnLmxvZ29Vcmx9IGFsdD0iTG9nbyIgY2xhc3NOYW1lPSJoLTE2IG9iamVjdC1jb250YWluIG1iLTIiIC8+IDogPGRpdiBjbGFzc05hbWU9ImgtMTYgdy0xNiBiZy1zbGF0ZS0yMDAgcm91bmRlZC1mdWxsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIG1iLTIgdGV4dC1zbGF0ZS00MDAiPjxTY2hvb2wgY2xhc3NOYW1lPSJ3LTggaC04IiAvPjwvZGl2Pn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iY3Vyc29yLXBvaW50ZXIgYmctd2hpdGUgYm9yZGVyIGJvcmRlci1zbGF0ZS0zMDAgaG92ZXI6Ymctc2xhdGUtNTAgdGV4dC1zbGF0ZS03MDAgZm9udC1tZWRpdW0gcHktMS41IHB4LTMgdGV4dC14cyByb3VuZGVkLWxnIHNoYWRvdy1zbSB0cmFuc2l0aW9uLWFsbCI+PFVwbG9hZCBjbGFzc05hbWU9InctMyBoLTMgaW5saW5lIG1yLTEiIC8+SW1wb3J0ZXIgTG9nbzxpbnB1dCB0eXBlPSJmaWxlIiBhY2NlcHQ9ImltYWdlLyoiIG9uQ2hhbmdlPXtoYW5kbGVMb2dvVXBsb2FkfSBjbGFzc05hbWU9ImhpZGRlbiIgLz48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBib3JkZXItMiBib3JkZXItZGFzaGVkIGJvcmRlci1pbmRpZ28tMjAwIHJvdW5kZWQtbGcgcC0zIGJnLWluZGlnby01MCBmbGV4LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2Nob29sQ29uZmlnLnN0YW1wVXJsID8gPGltZyBzcmM9e3NjaG9vbENvbmZpZy5zdGFtcFVybH0gYWx0PSJDYWNoZXQiIGNsYXNzTmFtZT0iaC0xNiBvYmplY3QtY29udGFpbiBtYi0yIiAvPiA6IDxkaXYgY2xhc3NOYW1lPSJoLTE2IHctMTYgYmctaW5kaWdvLTIwMCByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgbWItMiB0ZXh0LWluZGlnby00MDAiPjxTdGFtcCBjbGFzc05hbWU9InctOCBoLTgiIC8+PC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJjdXJzb3ItcG9pbnRlciBiZy13aGl0ZSBib3JkZXIgYm9yZGVyLWluZGlnby0zMDAgaG92ZXI6YmctaW5kaWdvLTUwIHRleHQtaW5kaWdvLTcwMCBmb250LW1lZGl1bSBweS0xLjUgcHgtMyB0ZXh0LXhzIHJvdW5kZWQtbGcgc2hhZG93LXNtIHRyYW5zaXRpb24tYWxsIj48VXBsb2FkIGNsYXNzTmFtZT0idy0zIGgtMyBpbmxpbmUgbXItMSIgLz5JbXBvcnRlciBDYWNoZXQ8aW5wdXQgdHlwZT0iZmlsZSIgYWNjZXB0PSJpbWFnZS8qIiBvbkNoYW5nZT17aGFuZGxlU3RhbXBVcGxvYWR9IGNsYXNzTmFtZT0iaGlkZGVuIiAvPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9DYXJkPgoKICAgICAgICAgICAgICAgICAgICA8Q2FyZCB0aXRsZT0iQ29uZmlndXJhdGlvbiBkZXMgw4lwcmV1dmVzIiBpY29uPXtDbG9ja30+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAge3N1YmplY3RzLm1hcChzdWJqZWN0ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lcyA9IHBhcnNlVGltZVJhbmdlKHN1YmplY3QudGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZXNUVCA9IHBhcnNlVGltZVJhbmdlKHN1YmplY3QudGltZVRUKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtzdWJqZWN0LmlkfSBjbGFzc05hbWU9ImJnLXNsYXRlLTUwIHAtNCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIGZsZXggZmxleC1jb2wgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleC1ncm93IGdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTEyIGdhcC00IHctZnVsbCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1kOmNvbC1zcGFuLTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQtWzEwcHhdIHVwcGVyY2FzZSBmb250LWJvbGQgdGV4dC1zbGF0ZS00MDAgbWItMSI+Tm9tIGRlIGwnw6lwcmV1dmU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT17c3ViamVjdC5uYW1lfSBvbkNoYW5nZT17KGUpID0+IGhhbmRsZVVwZGF0ZVN1YmplY3Qoc3ViamVjdC5pZCwgJ25hbWUnLCBlLnRhcmdldC52YWx1ZSl9IGNsYXNzTmFtZT0idy1mdWxsIHAtMiBib3JkZXIgcm91bmRlZCBmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctc2t5LTIwMCBvdXRsaW5lLW5vbmUiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtZDpjb2wtc3Bhbi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LVsxMHB4XSB1cHBlcmNhc2UgZm9udC1ib2xkIHRleHQtc2xhdGUtNDAwIG1iLTEiPkRhdGU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBSZW1wbGFjZW1lbnQgZHUgY2hhbXAgdGV4dGUgcGFyIHVuIGNoYW1wIERBVEUgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJkYXRlIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3BhcnNlRnJlbmNoU3RyaW5nVG9Jc28oc3ViamVjdC5kYXRlKX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gaGFuZGxlRGF0ZUNoYW5nZShzdWJqZWN0LmlkLCBlLnRhcmdldC52YWx1ZSl9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBwLTIgYm9yZGVyIHJvdW5kZWQgdGV4dC1zbSBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1za3ktMjAwIG91dGxpbmUtbm9uZSBjdXJzb3ItcG9pbnRlciIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogQWZmaWNoYWdlIGRpc2NyZXQgZGUgbGEgZGF0ZSBmb3JtYXTDqWUgcG91ciBjb250csO0bGUgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtWzEwcHhdIHRleHQtc2xhdGUtNDAwIG10LTAuNSB0cnVuY2F0ZSBwbC0xIj57c3ViamVjdC5kYXRlfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBOb3V2ZWF1IFPDqWxlY3RldXIgZCdIb3JhaXJlIFN0YW5kYXJkICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1kOmNvbC1zcGFuLTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQtWzEwcHhdIHVwcGVyY2FzZSBmb250LWJvbGQgdGV4dC1zbGF0ZS00MDAgbWItMSI+SG9yYWlyZSAoU3RhbmRhcmQpPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgc3BhY2UteC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0idGltZSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGltZXMuc3RhcnR9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBoYW5kbGVUaW1lVXBkYXRlKHN1YmplY3QuaWQsICd0aW1lJywgZS50YXJnZXQudmFsdWUsIHRpbWVzLmVuZCl9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJwLTIgYm9yZGVyIGJvcmRlci1zbGF0ZS0zMDAgcm91bmRlZCB0ZXh0LXNtIHctZnVsbCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1za3ktMjAwIG91dGxpbmUtbm9uZSBmb250LW1vbm8iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtc2xhdGUtNDAwIj4tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0aW1lIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0aW1lcy5lbmR9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBoYW5kbGVUaW1lVXBkYXRlKHN1YmplY3QuaWQsICd0aW1lJywgdGltZXMuc3RhcnQsIGUudGFyZ2V0LnZhbHVlKX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InAtMiBib3JkZXIgYm9yZGVyLXNsYXRlLTMwMCByb3VuZGVkIHRleHQtc20gdy1mdWxsIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLXNreS0yMDAgb3V0bGluZS1ub25lIGZvbnQtbW9ubyIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogTm91dmVhdSBTw6lsZWN0ZXVyIGQnSG9yYWlyZSBUVCBhdmVjIENhbGN1bCBBdXRvICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1kOmNvbC1zcGFuLTMgcmVsYXRpdmUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgbWItMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQtWzEwcHhdIHVwcGVyY2FzZSBmb250LWJvbGQgdGV4dC1yb3NlLTQwMCI+SG9yYWlyZSAoVGllcnMtVGVtcHMpPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHRyaWdnZXJBdXRvVFQoc3ViamVjdC5pZCl9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ0ZXh0LVs5cHhdIGJnLXJvc2UtNTAgdGV4dC1yb3NlLTYwMCBweC0yIHB5LTAuNSByb3VuZGVkIGJvcmRlciBib3JkZXItcm9zZS0xMDAgaG92ZXI6Ymctcm9zZS0xMDAgZmxleCBpdGVtcy1jZW50ZXIgdHJhbnNpdGlvbi1jb2xvcnMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT0iQ2FsY3VsZXIgYXV0b21hdGlxdWVtZW50ICgrMS8zIGR1IHRlbXBzKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPENhbGN1bGF0b3IgY2xhc3NOYW1lPSJ3LTMgaC0zIG1yLTEiIC8+IEF1dG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9InRpbWUiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RpbWVzVFQuc3RhcnR9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBoYW5kbGVUaW1lVXBkYXRlKHN1YmplY3QuaWQsICd0aW1lVFQnLCBlLnRhcmdldC52YWx1ZSwgdGltZXNUVC5lbmQpfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0icC0yIGJvcmRlciBib3JkZXItcm9zZS0yMDAgcm91bmRlZCB0ZXh0LXNtIHctZnVsbCB0ZXh0LXJvc2UtNzAwIGZvbnQtYm9sZCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1yb3NlLTIwMCBvdXRsaW5lLW5vbmUgZm9udC1tb25vIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTQwMCI+LTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0idGltZSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGltZXNUVC5lbmR9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZE9ubHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0icC0yIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIGJnLXNsYXRlLTEwMCByb3VuZGVkIHRleHQtc20gdy1mdWxsIHRleHQtc2xhdGUtNTAwIGZvbnQtYm9sZCBmb250LW1vbm8gY3Vyc29yLW5vdC1hbGxvd2VkIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJDYWxjdWzDqSBhdXRvbWF0aXF1ZW1lbnQgdmlhIGxlIGJvdXRvbiBBdXRvIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1kOmNvbC1zcGFuLTEgZmxleCBqdXN0aWZ5LWVuZCBpdGVtcy1lbmQgaC1mdWxsIHBiLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gaGFuZGxlRGVsZXRlU3ViamVjdChzdWJqZWN0LmlkKX0gY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTMwMCBob3Zlcjp0ZXh0LXJlZC01MDAgcC0yIHRyYW5zaXRpb24tY29sb3JzIj48VHJhc2gyIGNsYXNzTmFtZT0idy01IGgtNSIgLz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3N1YmplY3QuaWQgPT09IDQgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctZnVsbCBtdC0yIHB0LTIgYm9yZGVyLXQgYm9yZGVyLXNsYXRlLTEwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTUwMCBtci0yIj5EaXNjaXBsaW5lcyA6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtbJ1BoeXNpcXVlLUNoaW1pZScsICdTVlQnLCAnVGVjaG5vbG9naWUnXS5tYXAoZGlzYyA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24ga2V5PXtkaXNjfSBvbkNsaWNrPXsoKSA9PiB0b2dnbGVTY2llbmNlRGlzY2lwbGluZShkaXNjKX0gY2xhc3NOYW1lPXtgcHgtMiBweS0xIHRleHQteHMgcm91bmRlZCBib3JkZXIgdHJhbnNpdGlvbi1jb2xvcnMgJHtzdWJqZWN0LmRpc2NpcGxpbmVzLmluY2x1ZGVzKGRpc2MpID8gJ2JnLWdyZWVuLTEwMCBib3JkZXItZ3JlZW4tMzAwIHRleHQtZ3JlZW4tODAwIGZvbnQtbWVkaXVtIHNoYWRvdy1zbScgOiAnYmctd2hpdGUgYm9yZGVyLXNsYXRlLTMwMCB0ZXh0LXNsYXRlLTQwMCBob3ZlcjpiZy1zbGF0ZS01MCd9YH0+e2Rpc2N9PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7fSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBnYXAtNCBpdGVtcy1lbmQgYmctc2t5LTUwIHAtNCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItc2t5LTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgtZ3JvdyBncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy00IGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9InRleHQteHMgdGV4dC1za3ktNzAwIGZvbnQtYm9sZCI+Tm91dmVsbGUgw4lwcmV1dmU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHZhbHVlPXtuZXdTdWJqZWN0Lm5hbWV9IG9uQ2hhbmdlPXsoZSkgPT4gc2V0TmV3U3ViamVjdCh7Li4ubmV3U3ViamVjdCwgbmFtZTogZS50YXJnZXQudmFsdWV9KX0gY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciByb3VuZGVkIiBwbGFjZWhvbGRlcj0iTm9tIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9InRleHQteHMgdGV4dC1za3ktNzAwIGZvbnQtYm9sZCI+RGF0ZTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogQ2hhbXAgRGF0ZSBwb3VyIE5vdXZlbGxlIMOJcHJldXZlICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9ImRhdGUiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtwYXJzZUZyZW5jaFN0cmluZ1RvSXNvKG5ld1N1YmplY3QuZGF0ZSl9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gaGFuZGxlRGF0ZUNoYW5nZSgnbmV3JywgZS50YXJnZXQudmFsdWUpfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBwLTIgYm9yZGVyIHJvdW5kZWQgY3Vyc29yLXBvaW50ZXIiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGxhYmVsIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LXNreS03MDAgZm9udC1ib2xkIj5Ib3JhaXJlPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgdmFsdWU9e25ld1N1YmplY3QudGltZX0gb25DaGFuZ2U9eyhlKSA9PiBzZXROZXdTdWJqZWN0KHsuLi5uZXdTdWJqZWN0LCB0aW1lOiBlLnRhcmdldC52YWx1ZX0pfSBjbGFzc05hbWU9InctZnVsbCBwLTIgYm9yZGVyIHJvdW5kZWQiIHBsYWNlaG9sZGVyPSIwMDowMCAtIDAwOjAwIiAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxsYWJlbCBjbGFzc05hbWU9InRleHQteHMgdGV4dC1za3ktNzAwIGZvbnQtYm9sZCI+SG9yYWlyZSBUVDwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIHZhbHVlPXtuZXdTdWJqZWN0LnRpbWVUVH0gb25DaGFuZ2U9eyhlKSA9PiBzZXROZXdTdWJqZWN0KHsuLi5uZXdTdWJqZWN0LCB0aW1lVFQ6IGUudGFyZ2V0LnZhbHVlfSl9IGNsYXNzTmFtZT0idy1mdWxsIHAtMiBib3JkZXIgcm91bmRlZCIgcGxhY2Vob2xkZXI9IjAwOjAwIC0gMDA6MDAiIC8+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXtoYW5kbGVBZGRTdWJqZWN0fSBpY29uPXtQbHVzfT5Bam91dGVyPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9DYXJkPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyAtLS0gUkVOREVSIERBVEEgLS0tCiAgICAgICAgICAgIGNvbnN0IHJlbmRlckRhdGEgPSAoKSA9PiAoCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ic3BhY2UteS02IGFuaW1hdGUtZmFkZS1pbiI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTMgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICB7WwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAnc3R1ZGVudHMnLCBsYWJlbDogJ8OJbMOodmVzJywgaWNvbjogVXNlcnMsIGRhdGE6IHN0dWRlbnRzLCBjb2xvcjogJ3NreScgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3Jvb21zJywgbGFiZWw6ICdTYWxsZXMnLCBpY29uOiBMYXlvdXREYXNoYm9hcmQsIGRhdGE6IHJvb21zLCBjb2xvcjogJ2VtZXJhbGQnIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZWFjaGVycycsIGxhYmVsOiAnUHJvZmVzc2V1cnMnLCBpY29uOiBCcmllZmNhc2UsIGRhdGE6IHRlYWNoZXJzLCBjb2xvcjogJ29yYW5nZScgfQogICAgICAgICAgICAgICAgICAgICAgICBdLm1hcChzZWN0aW9uID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDYXJkIGtleT17c2VjdGlvbi50eXBlfSB0aXRsZT17YCR7c2VjdGlvbi5sYWJlbH0gKCR7c2VjdGlvbi5kYXRhLmxlbmd0aH0pYH0gY2xhc3NOYW1lPSJoLWZ1bGwgZmxleCBmbGV4LWNvbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgZ2FwLTMgbWItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9e2BmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB3LWZ1bGwgcHktMyBib3JkZXItMiBib3JkZXItZGFzaGVkIGJvcmRlci0ke3NlY3Rpb24uY29sb3J9LTIwMCByb3VuZGVkLWxnIGJnLSR7c2VjdGlvbi5jb2xvcn0tNTAgdGV4dC0ke3NlY3Rpb24uY29sb3J9LTcwMCBjdXJzb3ItcG9pbnRlciBob3ZlcjpiZy0ke3NlY3Rpb24uY29sb3J9LTEwMCB0cmFuc2l0aW9uLWNvbG9yc2B9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFVwbG9hZCBjbGFzc05hbWU9InctNSBoLTUgbXItMiIgLz4gSW1wb3J0IEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgYWNjZXB0PSIueGxzeCwgLnhscywgLmNzdiIgb25DaGFuZ2U9eyhlKSA9PiBoYW5kbGVGaWxlVXBsb2FkKGUsIHNlY3Rpb24udHlwZSl9IGNsYXNzTmFtZT0iaGlkZGVuIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IGhhbmRsZUV4cG9ydChzZWN0aW9uLnR5cGUpfSB2YXJpYW50PSJzZWNvbmRhcnkiIGljb249e0Rvd25sb2FkfSBjbGFzc05hbWU9InctZnVsbCB0ZXh0LXhzIj5FeHBvcnRlcjwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4LWdyb3cgb3ZlcmZsb3cteS1hdXRvIG1heC1oLTYwIGJvcmRlciByb3VuZGVkIGJnLXNsYXRlLTUwIHAtMiBzcGFjZS15LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2VjdGlvbi5kYXRhLm1hcCgoaXRlbSwgaSkgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBrZXk9e2l0ZW0uaWR9IGNsYXNzTmFtZT0iYmctd2hpdGUgcC0yIHJvdW5kZWQgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAgdGV4dC14cyBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idHJ1bmNhdGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2VjdGlvbi50eXBlID09PSAnc3R1ZGVudHMnICYmIGAke2l0ZW0ubGFzdG5hbWV9ICR7aXRlbS5maXJzdG5hbWV9ICgke2l0ZW0uY2xhc3N9KWB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWN0aW9uLnR5cGUgPT09ICdyb29tcycgJiYgYCR7aXRlbS5uYW1lfSAoJHtpdGVtLmNhcGFjaXR5fSBwbC4pYH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3NlY3Rpb24udHlwZSA9PT0gJ3RlYWNoZXJzJyAmJiBgJHtpdGVtLmxhc3RuYW1lfSAke2l0ZW0uZmlyc3RuYW1lfWB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlY3Rpb24udHlwZSA9PT0gJ3N0dWRlbnRzJykgaGFuZGxlRGVsZXRlU3R1ZGVudChpdGVtLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlY3Rpb24udHlwZSA9PT0gJ3Jvb21zJykgaGFuZGxlRGVsZXRlUm9vbShpdGVtLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0ZWFjaGVyIGRlbGV0ZSBsb2dpYyBpZiBuZWVkZWQgb3IganVzdCBnZW5lcmljCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InRleHQtc2xhdGUtMzAwIGhvdmVyOnRleHQtcmVkLTUwMCBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRyYXNoMiBjbGFzc05hbWU9InctMyBoLTMiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWN0aW9uLmRhdGEubGVuZ3RoID09PSAwICYmIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciB0ZXh0LXNsYXRlLTQwMCBpdGFsaWMgcHktNCI+QXVjdW5lIGRvbm7DqWU8L2Rpdj59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0NhcmQ+CiAgICAgICAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICB7LyogU0VDVElPTiBBUEVSw4dVIFNBTExFUyAoTkVXKSAqL30KICAgICAgICAgICAgICAgICAgICA8Q2FyZCB0aXRsZT0iQXBlcsOndSAmIENvbmZpZ3VyYXRpb24gU2FsbGVzIiBjbGFzc05hbWU9Im1heC1oLTk2IG92ZXJmbG93LWhpZGRlbiBmbGV4IGZsZXgtY29sIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im92ZXJmbG93LXktYXV0byBwci0yIG1iLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzTmFtZT0ibWluLXctZnVsbCB0ZXh0LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3NOYW1lPSJiZy1zbGF0ZS01MCBzdGlja3kgdG9wLTAgei0xMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9InB4LTQgcHktMiB0ZXh0LWxlZnQgdGV4dC1zbGF0ZS01MDAgZm9udC1tZWRpdW0iPk5vbSBkZSBsYSBzYWxsZTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJweC00IHB5LTIgdGV4dC1jZW50ZXIgdGV4dC1zbGF0ZS01MDAgZm9udC1tZWRpdW0iPkNhcGFjaXTDqTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJweC00IHB5LTIgdGV4dC1yaWdodCI+QWN0aW9uPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keSBjbGFzc05hbWU9ImRpdmlkZS15IGRpdmlkZS1zbGF0ZS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cm9vbXMubGVuZ3RoID4gMCA/IHJvb21zLm1hcCgocikgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGtleT17ci5pZH0gY2xhc3NOYW1lPSJob3ZlcjpiZy1zbGF0ZS01MCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0icHgtNCBweS0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0idGV4dCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17ci5uYW1lfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gaGFuZGxlVXBkYXRlUm9vbShyLmlkLCAnbmFtZScsIGUudGFyZ2V0LnZhbHVlKX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBiZy10cmFuc3BhcmVudCBib3JkZXItYiBib3JkZXItdHJhbnNwYXJlbnQgZm9jdXM6Ym9yZGVyLXNreS01MDAgZm9jdXM6b3V0bGluZS1ub25lIHRyYW5zaXRpb24tY29sb3JzIGZvbnQtbWVkaXVtIHRleHQtc2xhdGUtNzAwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0icHgtNCBweS0yIHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0ibnVtYmVyIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtyLmNhcGFjaXR5fSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gaGFuZGxlVXBkYXRlUm9vbShyLmlkLCAnY2FwYWNpdHknLCBwYXJzZUludChlLnRhcmdldC52YWx1ZSkpfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0idy0yMCB0ZXh0LWNlbnRlciBib3JkZXIgYm9yZGVyLXNsYXRlLTMwMCByb3VuZGVkIHB4LTIgcHktMSB0ZXh0LXNsYXRlLTcwMCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1za3ktNTAwIGZvY3VzOmJvcmRlci10cmFuc3BhcmVudCBmb250LWJvbGQgYmctd2hpdGUiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluPSIxIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0icHgtNCBweS0yIHRleHQtcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IGhhbmRsZURlbGV0ZVJvb20oci5pZCl9IGNsYXNzTmFtZT0idGV4dC1yb3NlLTQwMCBob3Zlcjp0ZXh0LXJvc2UtNjAwIHAtMSByb3VuZGVkLWZ1bGwgaG92ZXI6Ymctcm9zZS01MCB0cmFuc2l0aW9uLWNvbG9ycyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VHJhc2gyIGNsYXNzTmFtZT0idy00IGgtNCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpIDogKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjb2xTcGFuPSIzIiBjbGFzc05hbWU9InRleHQtY2VudGVyIHB5LTQgdGV4dC1zbGF0ZS00MDAgaXRhbGljIj5BdWN1bmUgc2FsbGUgY29uZmlndXLDqWUuPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgey8qIFpvbmUgZCdham91dCBtYW51ZWwgZGUgc2FsbGUgKi99CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC1hdXRvIHB0LTQgYm9yZGVyLXQgYm9yZGVyLXNsYXRlLTEwMCBiZy1zbGF0ZS01MCBwLTQgcm91bmRlZC1sZyBmbGV4IGl0ZW1zLWVuZCBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleC1ncm93IGdyaWQgZ3JpZC1jb2xzLTIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQteHMgZm9udC1ib2xkIHRleHQtc2xhdGUtNTAwIHVwcGVyY2FzZSBtYi0xIj5Ob20gZGUgbGEgc2FsbGU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0ZXh0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtuZXdSb29tLm5hbWV9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXROZXdSb29tKHsuLi5uZXdSb29tLCBuYW1lOiBlLnRhcmdldC52YWx1ZX0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItc2xhdGUtMzAwIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctZW1lcmFsZC0yMDAgb3V0bGluZS1ub25lIHRleHQtc20iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iRXg6IFNhbGxlIDEwMSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTUwMCB1cHBlcmNhc2UgbWItMSI+Q2FwYWNpdMOpPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0ibnVtYmVyIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtuZXdSb29tLmNhcGFjaXR5fSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0TmV3Um9vbSh7Li4ubmV3Um9vbSwgY2FwYWNpdHk6IHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlKSB8fCAwfSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBwLTIgYm9yZGVyIGJvcmRlci1zbGF0ZS0zMDAgcm91bmRlZCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1lbWVyYWxkLTIwMCBvdXRsaW5lLW5vbmUgdGV4dC1zbSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbj0iMSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXtoYW5kbGVBZGRSb29tfSBpY29uPXtQbHVzfSB2YXJpYW50PSJzdWNjZXNzIiBjbGFzc05hbWU9ImgtWzM4cHhdIj5Bam91dGVyPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvQ2FyZD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApOwoKICAgICAgICAgICAgLy8gLS0tIFJFTkRFUiBSRVBBUlRJVElPTiAtLS0KICAgICAgICAgICAgY29uc3QgcmVuZGVyUmVwYXJ0aXRpb24gPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50c1dpdGhvdXRSb29tID0gc3R1ZGVudHMuZmlsdGVyKHMgPT4gIXMucm9vbUlkKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0dWRlbnRzV2l0aFJvb20gPSBzdHVkZW50cy5maWx0ZXIocyA9PiBzLnJvb21JZCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktNiBhbmltYXRlLWZhZGUtaW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcC00IHJvdW5kZWQteGwgc2hhZG93LXNtIGJvcmRlciBib3JkZXItc2xhdGUtMTAwIGZsZXggZmxleC1jb2wgbWQ6ZmxleC1yb3cganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMiBiZy1zbGF0ZS0xMDAgcC0xIHJvdW5kZWQtbGciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldElzQW5vbnltaXR5TG9ja2VkKCFpc0Fub255bWl0eUxvY2tlZCl9IGNsYXNzTmFtZT17YHAtMiByb3VuZGVkLW1kIHRyYW5zaXRpb24tY29sb3JzICR7aXNBbm9ueW1pdHlMb2NrZWQgPyAnYmctd2hpdGUgc2hhZG93IHRleHQtZW1lcmFsZC02MDAnIDogJ3RleHQtc2xhdGUtNTAwJ31gfSB0aXRsZT17aXNBbm9ueW1pdHlMb2NrZWQgPyAiQW5vbnltYXQgVmVycm91aWxsw6kiIDogIkTDqXZlcnJvdWlsbMOpIn0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7aXNBbm9ueW1pdHlMb2NrZWQgPyA8TG9jayBjbGFzc05hbWU9InctNSBoLTUiIC8+IDogPFVubG9jayBjbGFzc05hbWU9InctNSBoLTUiIC8+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXtyZWdlbmVyYXRlQW5vbnltaXR5fSBkaXNhYmxlZD17aXNBbm9ueW1pdHlMb2NrZWR9IHZhcmlhbnQ9InNlY29uZGFyeSIgY2xhc3NOYW1lPSJ0ZXh0LXhzIj5Hw6luw6lyZXIgQW5vbnltYXQ8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2Rpc3RyaWJ1dGVTdHVkZW50c30gaWNvbj17UmVmcmVzaEN3fT5Sw6lwYXJ0aXRpb24gQXV0bzwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17cmVzZXREaXN0cmlidXRpb259IHZhcmlhbnQ9ImRhbmdlciIgaWNvbj17VHJhc2gyfT5Ub3V0IFZpZGVyPC9CdXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCB0ZXh0LXNtIHRleHQtc2xhdGUtNjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIj48ZGl2IGNsYXNzTmFtZT0idy0zIGgtMyByb3VuZGVkLWZ1bGwgYmctZW1lcmFsZC01MDAgbXItMiI+PC9kaXY+UGxhY8OpczogPHN0cm9uZz57c3R1ZGVudHNXaXRoUm9vbS5sZW5ndGh9PC9zdHJvbmc+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIiPjxkaXYgY2xhc3NOYW1lPSJ3LTMgaC0zIHJvdW5kZWQtZnVsbCBiZy1yb3NlLTUwMCBtci0yIj48L2Rpdj5FbiBhdHRlbnRlOiA8c3Ryb25nPntzdHVkZW50c1dpdGhvdXRSb29tLmxlbmd0aH08L3N0cm9uZz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtMSBsZzpncmlkLWNvbHMtNCBnYXAtNiBoLVs2MDBweF0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIExlZnQ6IFN0dWRlbnRzIExpc3QgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibGc6Y29sLXNwYW4tMSBiZy13aGl0ZSByb3VuZGVkLXhsIHNoYWRvdy1zbSBib3JkZXIgYm9yZGVyLXNsYXRlLTEwMCBmbGV4IGZsZXgtY29sIG92ZXJmbG93LWhpZGRlbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InAtMyBib3JkZXItYiBib3JkZXItc2xhdGUtMTAwIGJnLXNsYXRlLTUwIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTcwMCBmbGV4IGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPsOJbMOodmVzIHNhbnMgc2FsbGU8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iYmctcm9zZS0xMDAgdGV4dC1yb3NlLTYwMCBweC0yIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIGZsZXggaXRlbXMtY2VudGVyIj57c3R1ZGVudHNXaXRob3V0Um9vbS5sZW5ndGh9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4LWdyb3cgb3ZlcmZsb3cteS1hdXRvIHAtMiBzcGFjZS15LTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3R1ZGVudHNXaXRob3V0Um9vbS5tYXAoc3R1ZGVudCA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17c3R1ZGVudC5pZH0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dhYmxlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRHJhZ1N0YXJ0PXsoZSkgPT4gaGFuZGxlRHJhZ1N0YXJ0KGUsIHN0dWRlbnQuaWQpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iYmctd2hpdGUgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAgcC0zIHJvdW5kZWQtbGcgc2hhZG93LXNtIGhvdmVyOnNoYWRvdy1tZCBjdXJzb3ItZ3JhYiBhY3RpdmU6Y3Vyc29yLWdyYWJiaW5nIGJvcmRlci1sLTQgYm9yZGVyLWwtc2xhdGUtNDAwIGdyb3VwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAgdGV4dC1zbSI+e3N0dWRlbnQubGFzdG5hbWV9IHtzdHVkZW50LmZpcnN0bmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIG10LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQteHMgdGV4dC1zbGF0ZS01MDAgYmctc2xhdGUtMTAwIHB4LTEgcm91bmRlZCI+e3N0dWRlbnQuY2xhc3N9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBnYXAtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3R1ZGVudC5pc1RUICYmIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMTBweF0gYmctYW1iZXItMTAwIHRleHQtYW1iZXItNzAwIHB4LTEgcm91bmRlZCBmb250LWJvbGQiPlRUPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHVkZW50LmFlc2ggJiYgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LVsxMHB4XSBiZy1wdXJwbGUtMTAwIHRleHQtcHVycGxlLTcwMCBweC0xIHJvdW5kZWQgZm9udC1ib2xkIiB0aXRsZT17c3R1ZGVudC5hZXNofT5BRVNIPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogUmlnaHQ6IFJvb21zIEdyaWQgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibGc6Y29sLXNwYW4tMyBiZy1zbGF0ZS01MCByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIHAtNCBvdmVyZmxvdy15LWF1dG8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJncmlkIGdyaWQtY29scy0xIHNtOmdyaWQtY29scy0yIGxnOmdyaWQtY29scy0zIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3Jvb21zLm1hcChyb29tID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9jY3VwYW5jeSA9IGdldFJvb21PY2N1cGFuY3kocm9vbS5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gTWF0aC5yb3VuZCgob2NjdXBhbmN5IC8gcm9vbS5jYXBhY2l0eSkgKiAxMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNGdWxsID0gb2NjdXBhbmN5ID49IHJvb20uY2FwYWNpdHk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb29tU3R1ZGVudHMgPSBzdHVkZW50cy5maWx0ZXIocyA9PiBzLnJvb21JZCA9PT0gcm9vbS5pZCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e3Jvb20uaWR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRHJhZ092ZXI9e2hhbmRsZURyYWdPdmVyfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkRyYWdMZWF2ZT17aGFuZGxlRHJhZ0xlYXZlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkRyb3A9eyhlKSA9PiBoYW5kbGVEcm9wKGUsIHJvb20uaWQpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2BiZy13aGl0ZSByb3VuZGVkLXhsIGJvcmRlci0yIHRyYW5zaXRpb24tYWxsICR7aXNGdWxsID8gJ2JvcmRlci1zbGF0ZS0yMDAnIDogJ2JvcmRlci1kYXNoZWQgYm9yZGVyLXNsYXRlLTMwMCBob3Zlcjpib3JkZXItc2t5LTQwMCBob3ZlcjpiZy1za3ktNTAnfSBkcm9wLXpvbmUgZmxleCBmbGV4LWNvbCBoLTY0YH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJwLTMgYm9yZGVyLWIgYm9yZGVyLXNsYXRlLTEwMCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgYmctd2hpdGUgcm91bmRlZC10LXhsIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIj57cm9vbS5uYW1lfTwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteHMgdGV4dC1zbGF0ZS01MDAiPntvY2N1cGFuY3l9IC8ge3Jvb20uY2FwYWNpdHl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgdy0xMCBoLTEwIHJvdW5kZWQtZnVsbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXhzIGZvbnQtYm9sZCAke2lzRnVsbCA/ICdiZy1yb3NlLTEwMCB0ZXh0LXJvc2UtNjAwJyA6ICdiZy1lbWVyYWxkLTEwMCB0ZXh0LWVtZXJhbGQtNjAwJ31gfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cGVyY2VudGFnZX0lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4LWdyb3cgb3ZlcmZsb3cteS1hdXRvIHAtMiBzcGFjZS15LTEgYmctc2xhdGUtNTAvNTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3Jvb21TdHVkZW50cy5tYXAocyA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBrZXk9e3MuaWR9IGNsYXNzTmFtZT0idGV4dC14cyBiZy13aGl0ZSBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBwLTEuNSByb3VuZGVkIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idHJ1bmNhdGUgbWF4LXctWzEyMHB4XSI+e3MubGFzdG5hbWV9IHtzLmZpcnN0bmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gZXhlY3V0ZUFzc2lnbm1lbnQocy5pZCwgbnVsbCl9IGNsYXNzTmFtZT0idGV4dC1zbGF0ZS0zMDAgaG92ZXI6dGV4dC1yZWQtNTAwIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCI+PFRyYXNoMiBjbGFzc05hbWU9InctMyBoLTMiIC8+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyAtLS0gUkVOREVSIENPUlJFQ1RJT04gLS0tCiAgICAgICAgICAgIGNvbnN0IHJlbmRlckNvcnJlY3Rpb24gPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QXNzaWdubWVudHMgPSBzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0ID8gKHRlYWNoZXJBc3NpZ25tZW50c1tzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0LmlkXSB8fCBbXSkgOiBbXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTG9naXF1ZSBkZSB0cmkgZGVzIHByb2Zlc3NldXJzCiAgICAgICAgICAgICAgICBjb25zdCBnZXRWaXNpYmxlVGVhY2hlcnMgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0KSByZXR1cm4gW107CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbHRlcmVkID0gdGVhY2hlcnM7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3JjZUFsbFRlYWNoZXJzQ29ycmVjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZCA9IHRlYWNoZXJzLmZpbHRlcih0ID0+IGlzVGVhY2hlckZvclN1YmplY3QodCwgc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdCkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gVHJpIDogUHJvZnMgZGUgbGEgbWF0acOocmUgZW4gcHJlbWllciwgcHVpcyBhbHBoYWLDqXRpcXVlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsuLi5maWx0ZXJlZF0uc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1N1YkEgPSBpc1RlYWNoZXJGb3JTdWJqZWN0KGEsIHNlbGVjdGVkQ29ycmVjdGlvblN1YmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1N1YkIgPSBpc1RlYWNoZXJGb3JTdWJqZWN0KGIsIHNlbGVjdGVkQ29ycmVjdGlvblN1YmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNTdWJBICYmICFpc1N1YkIpIHJldHVybiAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1N1YkEgJiYgaXNTdWJCKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEubGFzdG5hbWUubG9jYWxlQ29tcGFyZShiLmxhc3RuYW1lKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgY29uc3QgdmlzaWJsZVRlYWNoZXJzID0gZ2V0VmlzaWJsZVRlYWNoZXJzKCk7CgogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ic3BhY2UteS02IGFuaW1hdGUtZmFkZS1pbiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxDYXJkIHRpdGxlPSJSw6lwYXJ0aXRpb24gZGUgbGEgQ29ycmVjdGlvbiIgaWNvbj17Q2hlY2tDaXJjbGV9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTMgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXNtIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTcwMCI+MS4gQ2hvaXNpciBsJ8OJcHJldXZlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLXNsYXRlLTMwMCByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLXNreS0yMDAgb3V0bGluZS1ub25lIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBoYW5kbGVTdWJqZWN0U2VsZWN0Rm9yQ29ycmVjdGlvbihlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17c2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdD8uaWQgfHwgJyd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+LS0gU8OpbGVjdGlvbm5lciAtLTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3N1YmplY3RzLm1hcChzID0+IDxvcHRpb24ga2V5PXtzLmlkfSB2YWx1ZT17cy5pZH0+e3MubmFtZX08L29wdGlvbj4pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0ICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1za3ktNTAgcC0zIHJvdW5kZWQgYm9yZGVyIGJvcmRlci1za3ktMTAwIHRleHQtc20gdGV4dC1za3ktODAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPntzdHVkZW50cy5maWx0ZXIocyA9PiBzLmFub255bW91c0lkKS5sZW5ndGh9PC9zdHJvbmc+IGNvcGllcyDDoCBjb3JyaWdlci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWQ6Y29sLXNwYW4tMiBzcGFjZS15LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQtc20gZm9udC1ib2xkIHRleHQtc2xhdGUtNzAwIj4yLiBTw6lsZWN0aW9ubmVyIGxlcyBDb3JyZWN0ZXVyczwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBzcGFjZS14LTIgdGV4dC14cyB0ZXh0LXNsYXRlLTUwMCBjdXJzb3ItcG9pbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e2ZvcmNlQWxsVGVhY2hlcnNDb3JyZWN0aW9ufSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eygpID0+IHNldEZvcmNlQWxsVGVhY2hlcnNDb3JyZWN0aW9uKCFmb3JjZUFsbFRlYWNoZXJzQ29ycmVjdGlvbil9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0icm91bmRlZCB0ZXh0LXNreS01MDAgZm9jdXM6cmluZy1za3ktNDAwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+QWZmaWNoZXIgdG91cyBsZXMgcHJvZmVzc2V1cnM8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZENvcnJlY3Rpb25TdWJqZWN0ID8gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIHJvdW5kZWQgcC0zIGgtNjAgb3ZlcmZsb3cteS1hdXRvIGdyaWQgZ3JpZC1jb2xzLTEgc206Z3JpZC1jb2xzLTIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt2aXNpYmxlVGVhY2hlcnMubGVuZ3RoID4gMCA/IHZpc2libGVUZWFjaGVycy5tYXAodCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU3ViamVjdFRlYWNoZXIgPSBpc1RlYWNoZXJGb3JTdWJqZWN0KHQsIHNlbGVjdGVkQ29ycmVjdGlvblN1YmplY3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGtleT17dC5pZH0gY2xhc3NOYW1lPXtgZmxleCBpdGVtcy1jZW50ZXIgc3BhY2UteC0yIHRleHQtc20gY3Vyc29yLXBvaW50ZXIgaG92ZXI6Ymctc2xhdGUtNTAgcC0yIHJvdW5kZWQgYm9yZGVyICR7aXNTdWJqZWN0VGVhY2hlciA/ICdib3JkZXItZW1lcmFsZC0yMDAgYmctZW1lcmFsZC01MC8zMCcgOiAnYm9yZGVyLXRyYW5zcGFyZW50J31gfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9ImNoZWNrYm94IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17c2VsZWN0ZWRUZWFjaGVyc0ZvckNvcnJlY3Rpb24uaW5jbHVkZXModC5pZCl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTZWxlY3RlZFRlYWNoZXJzRm9yQ29ycmVjdGlvbihwcmV2ID0+IHByZXYuaW5jbHVkZXModC5pZCkgPyBwcmV2LmZpbHRlcihpZCA9PiBpZCAhPT0gdC5pZCkgOiBbLi4ucHJldiwgdC5pZF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InJvdW5kZWQgdGV4dC1za3ktNTAwIGZvY3VzOnJpbmctc2t5LTQwMCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtpc1N1YmplY3RUZWFjaGVyID8gImZvbnQtc2VtaWJvbGQgdGV4dC1lbWVyYWxkLTgwMCIgOiAiIn0+e3QubGFzdG5hbWV9IHt0LmZpcnN0bmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMTBweF0gdGV4dC1zbGF0ZS00MDAiPnt0LnN1YmplY3R9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSA6ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtc2xhdGUtNDAwIGl0YWxpYyBjb2wtc3Bhbi0yIHRleHQtY2VudGVyIHB5LTQiPkF1Y3VuIHByb2Zlc3NldXIgdHJvdXbDqS4gRXNzYXlleiAiQWZmaWNoZXIgdG91cyBsZXMgcHJvZmVzc2V1cnMiLjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6IDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTQwMCBpdGFsaWMgcC00IGJvcmRlciBib3JkZXItZGFzaGVkIHJvdW5kZWQgdGV4dC1jZW50ZXIiPkVuIGF0dGVudGUgZGUgc8OpbGVjdGlvbiBkJ8OpcHJldXZlLi4uPC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2Rpc3RyaWJ1dGVDb3BpZXN9IGRpc2FibGVkPXshc2VsZWN0ZWRDb3JyZWN0aW9uU3ViamVjdCB8fCBzZWxlY3RlZFRlYWNoZXJzRm9yQ29ycmVjdGlvbi5sZW5ndGggPT09IDB9IGNsYXNzTmFtZT0idy1mdWxsIj5DYWxjdWxlciBsZXMgTG90czwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAge2N1cnJlbnRBc3NpZ25tZW50cy5sZW5ndGggPiAwICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibXQtOCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXNsYXRlLTcwMCBtYi00IGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4zLiBMb3RzIEF0dHJpYnXDqXM8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IGdlbmVyYXRlUERGKCdsaXN0ZXNfY29ycmVjdGlvbl9kZXRhaWwnKX0gdmFyaWFudD0ic2Vjb25kYXJ5IiBpY29uPXtQcmludGVyfSBjbGFzc05hbWU9InRleHQteHMiPkltcHJpbWVyIExpc3RlcyBkZSBDb250csO0bGU8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im92ZXJmbG93LXgtYXV0byBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCByb3VuZGVkLWxnIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzc05hbWU9InctZnVsbCB0ZXh0LXNtIHRleHQtbGVmdCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkIGNsYXNzTmFtZT0iYmctc2xhdGUtNTAgdGV4dC1zbGF0ZS03MDAgZm9udC1ib2xkIGJvcmRlci1iIGJvcmRlci1zbGF0ZS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJwLTMiPkNvcnJlY3RldXI8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzTmFtZT0icC0zIHctMjQiPk5iIENvcGllczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJwLTMiPlByZW1pZXIgTsKwPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9InAtMyI+RGVybmllciBOwrA8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGhlYWQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5IGNsYXNzTmFtZT0iZGl2aWRlLXkgZGl2aWRlLXNsYXRlLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtjdXJyZW50QXNzaWdubWVudHMubWFwKChhc3NpZ24sIGlkeCkgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGtleT17aWR4fSBjbGFzc05hbWU9ImhvdmVyOmJnLXNsYXRlLTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJwLTMgZm9udC1tZWRpdW0gdGV4dC1zbGF0ZS04MDAiPnthc3NpZ24udGVhY2hlck5hbWV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJwLTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJudW1iZXIiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2Fzc2lnbi5jb3VudH0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHVwZGF0ZU1hbnVhbEFzc2lnbm1lbnQoaWR4LCAnY291bnQnLCBlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctMTYgcC0xIGJvcmRlciByb3VuZGVkIHRleHQtY2VudGVyIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLXNreS0yMDAgb3V0bGluZS1ub25lIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0icC0zIGZvbnQtbW9ubyB0ZXh0LXNsYXRlLTUwMCI+e2Fzc2lnbi5zdGFydEFub255bX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9InAtMyBmb250LW1vbm8gdGV4dC1zbGF0ZS01MDAiPnthc3NpZ24uZW5kQW5vbnltfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICA8L0NhcmQ+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtaW4taC1zY3JlZW4gZmxleCBmbGV4LWNvbCI+CiAgICAgICAgICAgICAgICAgICAgPENvbmZpcm1hdGlvbk1vZGFsIGlzT3Blbj17bW9kYWxDb25maWcuaXNPcGVufSB0aXRsZT17bW9kYWxDb25maWcudGl0bGV9IG1lc3NhZ2U9e21vZGFsQ29uZmlnLm1lc3NhZ2V9IG9uQ29uZmlybT17aGFuZGxlTW9kYWxDb25maXJtfSBvbkNhbmNlbD17Y2xvc2VNb2RhbH0gLz4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB7LyogTW9kYWwgZGUgU2Fpc2llIHBvdXIgbGEgU2F1dmVnYXJkZSAqL30KICAgICAgICAgICAgICAgICAgICA8SW5wdXRNb2RhbCAKICAgICAgICAgICAgICAgICAgICAgICAgaXNPcGVuPXtpbnB1dE1vZGFsQ29uZmlnLmlzT3Blbn0gCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXtpbnB1dE1vZGFsQ29uZmlnLnRpdGxlfSAKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZT17aW5wdXRNb2RhbENvbmZpZy5tZXNzYWdlfSAKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlPXtpbnB1dE1vZGFsQ29uZmlnLmRlZmF1bHRWYWx1ZX0gCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29uZmlybT17aW5wdXRNb2RhbENvbmZpZy5vbkNvbmZpcm19IAogICAgICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbD17Y2xvc2VJbnB1dE1vZGFsfSAKICAgICAgICAgICAgICAgICAgICAvPgoKICAgICAgICAgICAgICAgICAgICA8aGVhZGVyIGNsYXNzTmFtZT0iYmctZ3JhZGllbnQtdG8tciBmcm9tLWN5YW4tNTAwIHRvLWJsdWUtNjAwIHNoYWRvdy1tZCBzdGlja3kgdG9wLTAgei0xMCI+PGRpdiBjbGFzc05hbWU9Im1heC13LTd4bCBteC1hdXRvIHB4LTQgaC0xNiBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iPjxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciI+PFNjaG9vbCBjbGFzc05hbWU9InctNiBoLTYgdGV4dC13aGl0ZSBtci0zIiAvPjxoMSBjbGFzc05hbWU9InRleHQteGwgZm9udC1ib2xkIHRleHQtd2hpdGUiPlBFUkRJUkZPUk1BTkNFIEROQiBCTEFOQyBFQ1JJVCBWMTE8L2gxPjwvZGl2PjxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIHRleHQtc2t5LTEwMCBoaWRkZW4gbWQ6YmxvY2siPk9yZ2FuaXNhdGlvbiBkJ0V4YW1lbiBCbGFuYzwvZGl2PjwvZGl2PjwvaGVhZGVyPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy13aGl0ZSBib3JkZXItYiBzaGFkb3ctc20iPjxkaXYgY2xhc3NOYW1lPSJtYXgtdy03eGwgbXgtYXV0byBweC00Ij48bmF2IGNsYXNzTmFtZT0iLW1iLXB4IGZsZXggc3BhY2UteC04IG92ZXJmbG93LXgtYXV0byI+CiAgICAgICAgICAgICAgICAgICAgICAgIHtbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAnY29uZmlnJywgbGFiZWw6ICdBY2N1ZWlsJywgaWNvbjogU2V0dGluZ3MgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdkYXRhJywgbGFiZWw6ICdJbXBvcnQnLCBpY29uOiBVcGxvYWQgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdyZXBhcnRpdGlvbicsIGxhYmVsOiAnUsOpcGFydGl0aW9uJywgaWNvbjogVXNlcnMgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdzdXJ2ZWlsbGFuY2UnLCBsYWJlbDogJ1N1cnZlaWxsYW5jZScsIGljb246IEV5ZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogJ3NlY3JldGFyaWF0JywgbGFiZWw6ICdTZWNyw6l0YXJpYXQnLCBpY29uOiBBcmNoaXZlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAnY29ycmVjdGlvbicsIGxhYmVsOiAnQ29ycmVjdGlvbicsIGljb246IENoZWNrQ2lyY2xlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGlkOiAnZG9jdW1lbnRzJywgbGFiZWw6ICdEb2N1bWVudHMnLCBpY29uOiBGaWxlVGV4dCB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogJ2hlbHAnLCBsYWJlbDogJ0FpZGVzJywgaWNvbjogSGVscENpcmNsZSB9CiAgICAgICAgICAgICAgICAgICAgICAgIF0ubWFwKHRhYiA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGtleT17dGFiLmlkfSBvbkNsaWNrPXsoKSA9PiBzZXRBY3RpdmVUYWIodGFiLmlkKX0gY2xhc3NOYW1lPXtgcHktNCBweC0zIGJvcmRlci1iLTIgZm9udC1tZWRpdW0gdGV4dC1zbSBmbGV4IGl0ZW1zLWNlbnRlciAke2FjdGl2ZVRhYiA9PT0gdGFiLmlkID8gJ2JvcmRlci1pbmRpZ28tNTAwIHRleHQtaW5kaWdvLTYwMCcgOiAnYm9yZGVyLXRyYW5zcGFyZW50IHRleHQtc2xhdGUtNTAwIGhvdmVyOnRleHQtc2xhdGUtNzAwJ31gfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFiLmljb24gY2xhc3NOYW1lPXtgdy00IGgtNCBtci0yICR7YWN0aXZlVGFiID09PSB0YWIuaWQgPyAndGV4dC1pbmRpZ28tNTAwJyA6ICd0ZXh0LXNsYXRlLTQwMCd9YH0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dGFiLmxhYmVsfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgICAgIDwvbmF2PjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxtYWluIGNsYXNzTmFtZT0iZmxleC1ncm93IG1heC13LTd4bCB3LWZ1bGwgbXgtYXV0byBweC00IHB5LTgiPgogICAgICAgICAgICAgICAgICAgICAgICB7bm90aWZpY2F0aW9uICYmIDxkaXYgY2xhc3NOYW1lPSJmaXhlZCBib3R0b20tNiByaWdodC02IHAtNCByb3VuZGVkLXhsIHNoYWRvdy14bCBiZy1lbWVyYWxkLTUwMCB0ZXh0LXdoaXRlIHotNTAiPntub3RpZmljYXRpb24ubXNnfTwvZGl2Pn0KICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZVRhYiA9PT0gJ2NvbmZpZycgJiYgcmVuZGVyQ29uZmlnKCl9CiAgICAgICAgICAgICAgICAgICAgICAgIHthY3RpdmVUYWIgPT09ICdkYXRhJyAmJiByZW5kZXJEYXRhKCl9CiAgICAgICAgICAgICAgICAgICAgICAgIHthY3RpdmVUYWIgPT09ICdyZXBhcnRpdGlvbicgJiYgcmVuZGVyUmVwYXJ0aXRpb24oKX0KICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZVRhYiA9PT0gJ3N1cnZlaWxsYW5jZScgJiYgPFN1cnZlaWxsYW5jZVBhbmVsIHN1YmplY3RzPXtzdWJqZWN0c30gcm9vbXM9e3Jvb21zfSB0ZWFjaGVycz17dGVhY2hlcnN9IHN0dWRlbnRzPXtzdHVkZW50c30gYXNzaWdubWVudHM9e3N1cnZlaWxsYW5jZUFzc2lnbm1lbnRzfSBvbkFzc2lnbm1lbnRDaGFuZ2U9eyhrLCB2KSA9PiBzZXRTdXJ2ZWlsbGFuY2VBc3NpZ25tZW50cyhwcmV2ID0+ICh7Li4ucHJldiwgW2tdOiB2fSkpfSBzY2hvb2xDb25maWc9e3NjaG9vbENvbmZpZ30gbW9kZT17c3VydmVpbGxhbmNlTW9kZX0gc2V0TW9kZT17c2V0U3VydmVpbGxhbmNlTW9kZX0gLz59CiAgICAgICAgICAgICAgICAgICAgICAgIHthY3RpdmVUYWIgPT09ICdzZWNyZXRhcmlhdCcgJiYgPFNlY3JldGFyaWF0UGFuZWwgc3ViamVjdHM9e3N1YmplY3RzfSByb29tcz17cm9vbXN9IHRlYWNoZXJzPXt0ZWFjaGVyc30gYXNzaWdubWVudHM9e3NlY3JldGFyaWF0QXNzaWdubWVudHN9IG9uQXNzaWdubWVudENoYW5nZT17KHNpZCwgZGF0YSkgPT4gc2V0U2VjcmV0YXJpYXRBc3NpZ25tZW50cyhwcmV2ID0+ICh7Li4ucHJldiwgW3NpZF06IGRhdGF9KSl9IC8+fQogICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlVGFiID09PSAnY29ycmVjdGlvbicgJiYgcmVuZGVyQ29ycmVjdGlvbigpfQogICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlVGFiID09PSAnZG9jdW1lbnRzJyAmJiByZW5kZXJEb2N1bWVudHMoKX0KICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZVRhYiA9PT0gJ2hlbHAnICYmIDxIZWxwUGFuZWwgLz59CiAgICAgICAgICAgICAgICAgICAgPC9tYWluPgogICAgICAgICAgICAgICAgICAgIDxmb290ZXIgY2xhc3NOYW1lPSJiZy13aGl0ZSBib3JkZXItdCBweS04IHRleHQtY2VudGVyIHRleHQtc2xhdGUtNDAwIHRleHQtc20iPlBFUkRJUkZPUk1BTkNFIEROQiBCTEFOQyBFQ1JJVCBWMTEgcHJvcG9zw6kgcGFyIFlhbm5pcyBDSFJJU1RPTjwvZm9vdGVyPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3Qgcm9vdCA9IFJlYWN0RE9NLmNyZWF0ZVJvb3QoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3QnKSk7CiAgICAgICAgcm9vdC5yZW5kZXIoPEFwcCAvPik7CiAgICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+", "oral": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImZyIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+T1JBTCBCTEFOQyBETkItQ0ZHLUdPIFBFUkRJUkZPUk1BTkNFIFYxMTwvdGl0bGU+CiAgICAKICAgIDwhLS0gUmVhY3QgJiBSZWFjdERPTSAtLT4KICAgIDxzY3JpcHQgY3Jvc3NvcmlnaW4gc3JjPSJodHRwczovL3VucGtnLmNvbS9yZWFjdEAxOC91bWQvcmVhY3QuZGV2ZWxvcG1lbnQuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBjcm9zc29yaWdpbiBzcmM9Imh0dHBzOi8vdW5wa2cuY29tL3JlYWN0LWRvbUAxOC91bWQvcmVhY3QtZG9tLmRldmVsb3BtZW50LmpzIj48L3NjcmlwdD4KICAgIAogICAgPCEtLSBCYWJlbCBmb3IgSlNYIC0tPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vdW5wa2cuY29tL0BiYWJlbC9zdGFuZGFsb25lL2JhYmVsLm1pbi5qcyI+PC9zY3JpcHQ+CiAgICAKICAgIDwhLS0gVGFpbHdpbmQgQ1NTIC0tPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLnRhaWx3aW5kY3NzLmNvbSI+PC9zY3JpcHQ+CiAgICAKICAgIDwhLS0gUGFwYVBhcnNlIGZvciBDU1YgLS0+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvUGFwYVBhcnNlLzUuMy4wL3BhcGFwYXJzZS5taW4uanMiPjwvc2NyaXB0PgogICAgCiAgICA8c3R5bGU+CiAgICAgICAgQGltcG9ydCB1cmwoJ2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9Um9ib3RvOndnaHRAMzAwOzQwMDs1MDA7NzAwJmRpc3BsYXk9c3dhcCcpOwogICAgICAgIAogICAgICAgIGJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogJ1JvYm90bycsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmM2Y0ZjY7CiAgICAgICAgfQoKICAgICAgICAvKiBBbmltYXRpb24gU2NpbnRpbGxhbnRlIHBvdXIgbGUgYm91dG9uIFJFVE9VUiAqLwogICAgICAgIEBrZXlmcmFtZXMgZ2xvd2luZyB7CiAgICAgICAgICAgIDAlIHsgYm94LXNoYWRvdzogMCAwIDVweCAjZWY0NDQ0OyB0cmFuc2Zvcm06IHNjYWxlKDEpOyB9CiAgICAgICAgICAgIDUwJSB7IGJveC1zaGFkb3c6IDAgMCAyMHB4ICNlZjQ0NDQ7IHRyYW5zZm9ybTogc2NhbGUoMS4wNSk7IH0KICAgICAgICAgICAgMTAwJSB7IGJveC1zaGFkb3c6IDAgMCA1cHggI2VmNDQ0NDsgdHJhbnNmb3JtOiBzY2FsZSgxKTsgfQogICAgICAgIH0KICAgICAgICAuYnRuLXJldG91ci1zY2ludGlsbGFudCB7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZ2xvd2luZyAycyBpbmZpbml0ZSBlYXNlLWluLW91dDsKICAgICAgICB9CgogICAgICAgIC5tb2RhbC1lbnRlciB7IG9wYWNpdHk6IDA7IHRyYW5zZm9ybTogc2NhbGUoMC45KTsgfQogICAgICAgIC5tb2RhbC1lbnRlci1hY3RpdmUgeyBvcGFjaXR5OiAxOyB0cmFuc2Zvcm06IHNjYWxlKDEpOyB0cmFuc2l0aW9uOiBvcGFjaXR5IDMwMG1zLCB0cmFuc2Zvcm0gMzAwbXM7IH0KICAgICAgICAubW9kYWwtZXhpdCB7IG9wYWNpdHk6IDE7IH0KICAgICAgICAubW9kYWwtZXhpdC1hY3RpdmUgeyBvcGFjaXR5OiAwOyB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7IHRyYW5zaXRpb246IG9wYWNpdHkgMzAwbXMsIHRyYW5zZm9ybSAzMDBtczsgfQoKICAgICAgICBAa2V5ZnJhbWVzIHNjYWxlSW4gewogICAgICAgICAgICBmcm9tIHsgb3BhY2l0eTogMDsgdHJhbnNmb3JtOiBzY2FsZSgwLjk1KTsgfQogICAgICAgICAgICB0byB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogc2NhbGUoMSk7IH0KICAgICAgICB9CiAgICAgICAgLmFuaW1hdGUtc2NhbGUtaW4gewogICAgICAgICAgICBhbmltYXRpb246IHNjYWxlSW4gMC4ycyBlYXNlLW91dCBmb3J3YXJkczsKICAgICAgICB9CgogICAgICAgIC8qIC0tLSBTVFlMRVMgRCdJTVBSRVNTSU9OIFNUUklDVFMgLS0tICovCiAgICAgICAgCiAgICAgICAgLyogU3R5bGVzIEE0IHZpc2libGUgw6AgbCfDqWNyYW4gKi8KICAgICAgICAuQTQtc2hlZXQgewogICAgICAgICAgICB3aWR0aDogMjEwbW07CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDI5N21tOyAvKiBDaGFuZ8OpIGhlaWdodCBlbiBtaW4taGVpZ2h0IHBvdXIgw6l2aXRlciBjb3VwdXJlcyDDqWNyYW4gKi8KICAgICAgICAgICAgaGVpZ2h0OiBhdXRvOwogICAgICAgICAgICBwYWRkaW5nOiAxMG1tOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICAgICAgICAgICAgbWFyZ2luOiAwIGF1dG8gMnJlbSBhdXRvOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCA2cHggLTFweCByZ2JhKDAsIDAsIDAsIDAuMSksIDAgMnB4IDRweCAtMXB4IHJnYmEoMCwgMCwgMCwgMC4wNik7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC5BNC1sYW5kc2NhcGUtc2hlZXQgewogICAgICAgICAgICB3aWR0aDogMjk3bW07CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDIxMG1tOwogICAgICAgICAgICBoZWlnaHQ6IGF1dG87CiAgICAgICAgICAgIHBhZGRpbmc6IDEwbW07CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICBtYXJnaW46IDAgYXV0byAycmVtIGF1dG87CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDZweCAtMXB4IHJnYmEoMCwgMCwgMCwgMC4xKSwgMCAycHggNHB4IC0xcHggcmdiYSgwLCAwLCAwLCAwLjA2KTsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIH0KCiAgICAgICAgLyogU2Nyb2xsYmFyIGN1c3RvbSBwb3VyIGxhIHNpZGViYXIgKi8KICAgICAgICAuY3VzdG9tLXNjcm9sbGJhcjo6LXdlYmtpdC1zY3JvbGxiYXIgewogICAgICAgICAgICB3aWR0aDogNnB4OwogICAgICAgIH0KICAgICAgICAuY3VzdG9tLXNjcm9sbGJhcjo6LXdlYmtpdC1zY3JvbGxiYXItdHJhY2sgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSk7CiAgICAgICAgfQogICAgICAgIC5jdXN0b20tc2Nyb2xsYmFyOjotd2Via2l0LXNjcm9sbGJhci10aHVtYiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgICAgIH0KCiAgICAgICAgQG1lZGlhIHByaW50IHsKICAgICAgICAgICAgQHBhZ2UgeyAKICAgICAgICAgICAgICAgIHNpemU6IEE0OyAKICAgICAgICAgICAgICAgIG1hcmdpbjogMDsgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGJvZHksIGh0bWwgewogICAgICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICAgICAgcGFkZGluZzogMDsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIENhY2hlciB0b3V0IGNlIHF1aSBuJ2VzdCBwYXMgbGEgem9uZSBkJ2ltcHJlc3Npb24gKi8KICAgICAgICAgICAgLm5vLXByaW50LCAucHJpbnQtc2lkZWJhciB7IAogICAgICAgICAgICAgICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyogQ29udGVuZXVyIHByaW5jaXBhbCBkJ2ltcHJlc3Npb24gKi8KICAgICAgICAgICAgLnByaW50LW1vZGFsIHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdGF0aWMgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZSAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgaGVpZ2h0OiBhdXRvICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgb3ZlcmZsb3c6IHZpc2libGUgIWltcG9ydGFudDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLnByaW50LWNvbnRlbnQtYXJlYSB7CiAgICAgICAgICAgICAgICBtYXJnaW46IDAgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDAgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGhlaWdodDogYXV0byAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCUgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgb3ZlcmZsb3c6IHZpc2libGUgIWltcG9ydGFudDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLnByaW50LXdyYXBwZXIgewogICAgICAgICAgICAgICAgbWF4LXdpZHRoOiBub25lICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBtYXJnaW46IDAgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIEdlc3Rpb24gZGVzIHNhdXRzIGRlIHBhZ2UgKi8KICAgICAgICAgICAgLkE0LXNoZWV0LCAuQTQtbGFuZHNjYXBlLXNoZWV0IHsKICAgICAgICAgICAgICAgIG1hcmdpbjogMCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgYm94LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgcGFnZS1icmVhay1hZnRlcjogYWx3YXlzICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBicmVhay1hZnRlcjogcGFnZSAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgcGFnZS1icmVhay1pbnNpZGU6IGF2b2lkICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IGF1dG8gIWltcG9ydGFudDsgLyogTGFpc3NlciBsYSBoYXV0ZXVyIGF1dG8gcG91ciBsJ2ltcHJlc3Npb24gKi8KICAgICAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDAgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIG92ZXJmbG93OiB2aXNpYmxlICFpbXBvcnRhbnQ7IC8qIENSVUNJQUwgOiBuZSBwYXMgY2FjaGVyIGxlIGNvbnRlbnUgcXVpIGTDqXBhc3NlICovCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC5BNC1zaGVldDpsYXN0LWNoaWxkLCAuQTQtbGFuZHNjYXBlLXNoZWV0Omxhc3QtY2hpbGQgeyAKICAgICAgICAgICAgICAgIHBhZ2UtYnJlYWstYWZ0ZXI6IGF1dG8gIWltcG9ydGFudDsgCiAgICAgICAgICAgICAgICBicmVhay1hZnRlcjogYXV0byAhaW1wb3J0YW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDxkaXYgaWQ9InJvb3QiPjwvZGl2PgoKICAgIDxzY3JpcHQgdHlwZT0idGV4dC9iYWJlbCI+CiAgICAgICAgY29uc3QgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0LCB1c2VSZWYgfSA9IFJlYWN0OwoKICAgICAgICAvKiAtLS0gSUNPTlMgLS0tICovCiAgICAgICAgY29uc3QgSWNvbkJhc2UgPSAoeyBjaGlsZHJlbiwgc2l6ZSA9IDI0LCBjb2xvciA9ICJjdXJyZW50Q29sb3IiLCBjbGFzc05hbWUgPSAiIiB9KSA9PiAoCiAgICAgICAgICAgIDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD17c2l6ZX0gaGVpZ2h0PXtzaXplfSB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT17Y29sb3J9IHN0cm9rZVdpZHRoPSIyIiBzdHJva2VMaW5lY2FwPSJyb3VuZCIgc3Ryb2tlTGluZWpvaW49InJvdW5kIiBjbGFzc05hbWU9e2NsYXNzTmFtZX0+CiAgICAgICAgICAgICAgICB7Y2hpbGRyZW59CiAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICk7CgogICAgICAgIGNvbnN0IEljb25zID0gewogICAgICAgICAgICBTYXZlOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xOSAyMUg1YTIgMiAwIDAgMS0yLTJWNWEyIDIgMCAwIDEgMi0yaDExbDUgNXYxMWEyIDIgMCAwIDEtMiAyeiIvPjxwb2x5bGluZSBwb2ludHM9IjE3IDIxIDE3IDEzIDcgMTMgNyAyMSIvPjxwb2x5bGluZSBwb2ludHM9IjcgMyA3IDggMTUgOCIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBVcGxvYWQ6IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTIxIDE1djRhMiAyIDAgMCAxLTIgMkg1YTIgMiAwIDAgMS0yLTJ2LTQiLz48cG9seWxpbmUgcG9pbnRzPSIxNyA4IDEyIDMgNyA4Ii8+PGxpbmUgeDE9IjEyIiB5MT0iMyIgeDI9IjEyIiB5Mj0iMTUiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgVHJhc2gyOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9Pjxwb2x5bGluZSBwb2ludHM9IjMgNiA1IDYgMjEgNiIvPjxwYXRoIGQ9Ik0xOSA2djE0YTIgMiAwIDAgMS0yLTJIN2EyIDIgMCAwIDEtMi0yVjZtMyAwVjRhMiAyIDAgMCAxIDItMmg0YTIgMiAwIDAgMSAyIDJ2MiIvPjxsaW5lIHgxPSIxMCIgeTE9IjExIiB4Mj0iMTAiIHkyPSIxNyIvPjxsaW5lIHgxPSIxNCIgeTE9IjExIiB4Mj0iMTQiIHkyPSIxNyIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBQcmludGVyOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9Pjxwb2x5bGluZSBwb2ludHM9IjYgOSA2IDIgMTggMiAxOCA5Ii8+PHBhdGggZD0iTTYgMThINGEyIDIgMCAwIDEtMi0ydi01YTIgMiAwIDAgMSAyLTJoMTZhMiAyIDAgMCAxIDIgMnY1YTIgMiAwIDAgMS0yIDJoLTIiLz48cmVjdCB4PSI2IiB5PSIxNCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjgiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgVXNlcnM6IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTE3IDIxdi0yYTQgNCAwIDAgMC00LTRINWE0IDQgMCAwIDAtNCA0djIiLz48Y2lyY2xlIGN4PSI5IiBjeT0iNyIgcj0iNCIvPjxwYXRoIGQ9Ik0yMyAyMXYtMmE0IDQgMCAwIDAtMy0zLjg3Ii8+PHBhdGggZD0iTTE2IDMuMTNhNCA0IDAgMCAxIDAgNy43NSIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBDbG9jazogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIvPjxwb2x5bGluZSBwb2ludHM9IjEyIDYgMTIgMTIgMTYgMTQiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgQWxlcnRUcmlhbmdsZTogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMTAuMjkgMy44NkwxLjgyIDE4YTIgMiAwIDAgMCAxLjcxIDNoMTYuOTRhMiAyIDAgMCAwIDEuNzEtM0wxMy43MSAzLjg2YTIgMiAwIDAgMC0zLjQyIDB6Ii8+PGxpbmUgeDE9IjEyIiB5MT0iOSIgeDI9IjEyIiB5Mj0iMTMiLz48bGluZSB4MT0iMTIiIHkxPSIxNyIgeDI9IjEyLjAxIiB5Mj0iMTciLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgRmlsZVVwOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xNC41IDJINmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY3LjVMMTQuNSAyeiIvPjxwb2x5bGluZSBwb2ludHM9IjE0IDIgMTQgOCAyMCA4Ii8+PHBhdGggZD0iTTEyIDEydjYiLz48cGF0aCBkPSJNOSAxNWwzLTMgMyAzIi8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIERvd25sb2FkOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0yMSAxNXY0YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0ydi00Ii8+PHBvbHlsaW5lIHBvaW50cz0iNyAxMCAxMiAxNSAxNyAxMCIvPjxsaW5lIHgxPSIxMiIgeTE9IjE1IiB4Mj0iMTIiIHkyPSIzIi8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIFJvdGF0ZUNjdzogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cG9seWxpbmUgcG9pbnRzPSIxIDQgMSAxMCA3IDEwIi8+PHBhdGggZD0iTTMuNTEgMTVhOSA5IDAgMSAwIDIuMTMtOS4zNkwxIDEwIi8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIFNoaWVsZEFsZXJ0OiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xMiAyMnM4LTQgOC0xMFY1bC04LTMtOCAzdjdjMCA2IDggMTAgOCAxMHoiLz48bGluZSB4MT0iMTIiIHkxPSI4IiB4Mj0iMTIiIHkyPSIxMiIvPjxsaW5lIHgxPSIxMiIgeTE9IjE2IiB4Mj0iMTIuMDEiIHkyPSIxNiIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBFZGl0OiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xMSA0SDRhMiAyIDAgMCAwLTIgMnYxNGEyIDIgMCAwIDAgMiAyaDE0YTIgMiAwIDAgMCAyLTJ2LTciLz48cGF0aCBkPSJNMTguNSAyLjVhMi4xMjEgMi4xMjEgMCAwIDEgMyAzTDEyIDE1bC00IDEgMS00IDkuNS05LjV6Ii8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIENoZWNrQ2lyY2xlOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0yMiAxMS4wOFYxMmExMCAxMCAwIDEgMS01LjkzLTkuMTQiLz48cG9seWxpbmUgcG9pbnRzPSIyMiA0IDEyIDE0LjAxIDkgMTEuMDEiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgQ2xpcGJvYXJkTGlzdDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMTYgNGgyYTIgMiAwIDAgMSAyIDJ2MTRhMiAyIDAgMCAxLTIgMkg2YTIgMiAwIDAgMS0yLTJWNmEyIDIgMCAwIDEgMi0yaDIiLz48cmVjdCB4PSI4IiB5PSIyIiB3aWR0aD0iOCIgaGVpZ2h0PSI0IiByeD0iMSIgcnk9IjEiLz48cGF0aCBkPSJNOSAxNGwyIDIgNC00Ii8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIENhbGVuZGFyOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxyZWN0IHg9IjMiIHk9IjQiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIi8+PGxpbmUgeDE9IjE2IiB5MT0iMiIgeDI9IjE2IiB5Mj0iNiIvPjxsaW5lIHgxPSI4IiB5MT0iMiIgeDI9IjgiIHkyPSI2Ii8+PGxpbmUgeDE9IjMiIHkxPSIxMCIgeDI9IjIxIiB5Mj0iMTAiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgQ2hldnJvblVwOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9Pjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBDaGV2cm9uRG93bjogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cG9seWxpbmUgcG9pbnRzPSI2IDkgMTIgMTUgMTggOSIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBTcGFya2xlczogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJtMTIgMy0xLjkxMiA1LjgxM2EyIDIgMCAwIDEtMS4yNzUgMS4yNzVMMyAxMmw1LjgxMyAxLjkxMmEyIDIgMCAwIDEgMS4yNzUgMS4yNzVMMTIgMjFsMS45MTItNS44MTNhMiAyIDAgMCAxIDEuMjc1LTEuMjc1TDIxIDEybC01LjgxMy0xLjkxMmEyIDIgMCAwIDEtMS4yNzUtMS4yNzVMMTIgM1oiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgWmFwOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9Pjxwb2x5Z29uIHBvaW50cz0iMTMgMiAzIDE0IDEyIDE0IDExIDIyIDIxIDEwIDEyIDEwIDEzIDIiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgQ29mZmVlOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xOCA4aDFhNCA0IDAgMCAxIDAgOGgtMSIvPjxwYXRoIGQ9Ik0yIDhoMTZ2OWE0IDQgMCAwIDEtNCA0SDZhNCA0IDAgMCAxLTQtNFY4eiIvPjxsaW5lIHgxPSI2IiB5MT0iMSIgeDI9IjYiIHkyPSI0Ii8+PGxpbmUgeDE9IjEwIiB5MT0iMSIgeDI9IjEwIiB5Mj0iNCIvPjxsaW5lIHgxPSIxNCIgeTE9IjEiIHgyPSIxNCIgeTI9IjQiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgTWludXM6IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PGxpbmUgeDE9IjUiIHkxPSIxMiIgeDI9IjE5IiB5Mj0iMTIiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgUGx1czogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48bGluZSB4MT0iMTIiIHkxPSI1IiB4Mj0iMTIiIHkyPSIxOSIvPjxsaW5lIHgxPSI1IiB5MT0iMTIiIHgyPSIxOSIgeTI9IjEyIi8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIEJvb2tPcGVuOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0yIDNoNmE0IDQgMCAwIDEgNCA0djE0YTMgMyAwIDAgMC0zLTNIMnoiLz48cGF0aCBkPSJNMjIgM2gtNmE0IDQgMCAwIDAtNCA0djE0YTMgMyAwIDAgMSAzLTNoN3oiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgR3JhZHVhdGlvbkNhcDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMjIgMTB2Nk0yIDEwbDEwLTUgMTAgNS0xMCA1eiIvPjxwYXRoIGQ9Ik02IDEydjVjMyAzIDkgMyAxMiAwdi01Ii8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIENoZXZyb25SaWdodDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cG9seWxpbmUgcG9pbnRzPSI5IDE4IDE1IDEyIDkgNiIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBBd2FyZDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48Y2lyY2xlIGN4PSIxMiIgY3k9IjgiIHI9IjciIC8+PHBvbHlsaW5lIHBvaW50cz0iOC4yMSAxMy44OSA3IDIzIDEyIDIwIDE3IDIzIDE1Ljc5IDEzLjg4IiAvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBNaWM6IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTEyIDFhMyAzIDAgMCAwLTMgM3Y4YTMgMyAwIDAgMCA2IDBWNGEzIDMgMCAwIDAtMy0zeiIvPjxwYXRoIGQ9Ik0xOSAxMHYyYTcgNyAwIDAgMS0xNCAwdi0yIi8+PGxpbmUgeDE9IjEyIiB5MT0iMTkiIHgyPSIxMiIgeTI9IjIzIi8+PGxpbmUgeDE9IjgiIHkxPSIyMyIgeDI9IjE2IiB5Mj0iMjMiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgUGllQ2hhcnQ6IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTIxLjIxIDE1Ljg5QTEwIDEwIDAgMSAxIDggMi44MyIgLz48cGF0aCBkPSJNMjIgMTJBMTAgMTAgMCAwIDAgMTIgMnYxMHoiIC8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIFNlYXJjaDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48Y2lyY2xlIGN4PSIxMSIgY3k9IjExIiByPSI4Ij48L2NpcmNsZT48bGluZSB4MT0iMjEiIHkxPSIyMSIgeDI9IjE2LjY1IiB5Mj0iMTYuNjUiPjwvbGluZT48L0ljb25CYXNlPiwKICAgICAgICAgICAgU2F2ZUxvY2FsOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0xOSAyMUg1YTIgMiAwIDAgMS0yLTJWNWEyIDIgMCAwIDEgMi0yaDExbDUgNXYxMWEyIDIgMCAwIDEtMiAyeiI+PC9wYXRoPjxwb2x5bGluZSBwb2ludHM9IjE3IDIxIDE3IDEzIDcgMTMgNyAyMSI+PC9wb2x5bGluZT48cG9seWxpbmUgcG9pbnRzPSI3IDMgNyA4IDE1IDgiPjwvcG9seWxpbmU+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIEhhbmRIZWFydDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMTkgMTRjMS40OS0xLjQ2IDMtMy4yMSAzLTUuNUE1LjUgNS41IDAgMCAwIDE2LjUgM2MtMS43NiAwLTMgLjUtNC41IDItMS41LTEuNS0yLjc0LTItNC41LTJBNS41IDUuNSAwIDAgMCAyIDguNWMwIDIuMyAxLjUgNC4wNSAzIDUuNWw3IDdaIiAvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBGaWxlVGV4dDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMTQgMkg2YTIgMiAwIDAgMC0yIDJ2MTZhMiAyIDAgMCAwIDIgMmgxMmEyIDIgMCAwIDAgMi0yVjh6Ij48L3BhdGg+PHBvbHlsaW5lIHBvaW50cz0iMTQgMiAxNCA4IDIwIDgiPjwvcG9seWxpbmU+PGxpbmUgeDE9IjE2IiB5MT0iMTMiIHgyPSI4IiB5Mj0iMTMiPjwvbGluZT48bGluZSB4MT0iMTYiIHkxPSIxNyIgeDI9IjgiIHkyPSIxNyI+PC9saW5lPjxwb2x5bGluZSBwb2ludHM9IjEwIDkgOSA5IDggOSI+PC9wb2x5bGluZT48L0ljb25CYXNlPiwKICAgICAgICAgICAgVHlwZTogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cG9seWxpbmUgcG9pbnRzPSI0IDcgNCA0IDIwIDQgMjAgNyIvPjxsaW5lIHgxPSI5IiB5MT0iMjAiIHgyPSIxNSIgeTI9IjIwIi8+PGxpbmUgeDE9IjEyIiB5MT0iNCIgeDI9IjEyIiB5Mj0iMjAiLz48L0ljb25CYXNlPiwKICAgICAgICAgICAgSGVscENpcmNsZTogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIvPjxwYXRoIGQ9Ik05LjA5IDlhMyAzIDAgMCAxIDUuODMgMWMwIDItMyAzLTMgMyIvPjxsaW5lIHgxPSIxMiIgeTE9IjE3IiB4Mj0iMTIuMDEiIHkyPSIxNyIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBGb2xkZXI6IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHBhdGggZD0iTTIyIDE5YTIgMiAwIDAgMS0yIDJINGEyIDIgMCAwIDEtMi0yVjVhMiAyIDAgMCAxIDItMmg1bDIgM2g5YTIgMiAwIDAgMSAyIDJ6Ii8+PC9JY29uQmFzZT4sCiAgICAgICAgICAgIFNldHRpbmdzOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiPjwvY2lyY2xlPjxwYXRoIGQ9Ik0xOS40IDE1YTEuNjUgMS42NSAwIDAgMCAuMzMgMS44MmwuMDYuMDZhMiAyIDAgMCAxIDAgMi44MyAyIDIgMCAwIDEtMi44MyAwbC0uMDYtLjA2YTEuNjUgMS42NSAwIDAgMC0xLjgyLS4zMyAxLjY1IDEuNjUgMCAwIDAtMSAxLjUxVjIxYTIgMiAwIDAgMS0yIDIgMiAyIDAgMCAxLTItMnYtLjA5QTEuNjUgMS42NSAwIDAgMCA5IDE5LjRhMS42NSAxLjY1IDAgMCAwLTEuODIuMzNsLS4wNi4wNmEyIDIgMCAwIDEgMC0yLjgzIDIgMiAwIDAgMSAyLjgzIDBsLjA2LjA2YTEuNjUgMS42NSAwIDAgMCAuMzMtMS44MiAxLjY1IDEuNjUgMCAwIDAtMS41MS0xSDNhMiAyIDAgMCAxLTItMiAyIDIgMCAwIDEgMi0yaC4wOUExLjY1IDEuNjUgMCAwIDAgNC42IDlhMS42NSAxLjY1IDAgMCAwLS4zMy0xLjgybC0uMDYtLjA2YTIgMiAwIDAgMSAwLTIuODMgMiAyIDAgMCAxIDIuODMgMGwuMDYuMDZhMS42NSAxLjY1IDAgMCAwIDEuODIuMzNIOWExLjY1IDEuNjUgMCAwIDAgMS0xLjUxVjNhMiAyIDAgMCAxIDItMiAyIDIgMCAwIDEgMiAydi4wOWExLjY1IDEuNjUgMCAwIDAgMSAxLjUxIDEuNjUgMS42NSAwIDAgMCAxLjgyLS4zM2wuMDYtLjA2YTIgMiAwIDAgMSAyLjgzIDAgMiAyIDAgMCAxIDAgMi44M2wtLjA2LjA2YTEuNjUgMS42NSAwIDAgMC0uMzMgMS44MlY5YTEuNjUgMS42NSAwIDAgMCAxLjUxIDFIMjFhMiAyIDAgMCAxIDIgMiAyIDIgMCAwIDEtMiAyaC0uMDlhMS42NSAxLjY1IDAgMCAwLTEuNTEgMXoiPjwvcGF0aD48L0ljb25CYXNlPiwKICAgICAgICAgICAgTGFwdG9wOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxwYXRoIGQ9Ik0yMCAxNlY3YTIgMiAwIDAgMC0yLTJINmEyIDIgMCAwIDAtMiAydjltMTYgMEg0bTE2IDAgMS4yOCAyLjU1YTEgMSAwIDAgMS0uOSAxLjQ1SDMuNjJhMSAxIDAgMCAxLS45LTEuNDVMNCAxNiIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBTdGFtcDogKHByb3BzKSA9PiA8SWNvbkJhc2Ugey4uLnByb3BzfT48cGF0aCBkPSJNMTIgMkwxMiAyMiIvPjxwYXRoIGQ9Ik0xMiAyTDIgN0wxMiAxMkwyMiA3TDEyIDJaIi8+PHBhdGggZD0iTTIgMTdMMTIgMjJMMjIgMTciLz48cGF0aCBkPSJNMiAxMkwxMiAxN0wyMiAxMiIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBHcmlkOiAocHJvcHMpID0+IDxJY29uQmFzZSB7Li4ucHJvcHN9PjxyZWN0IHg9IjMiIHk9IjMiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgcng9IjIiIHJ5PSIyIi8+PGxpbmUgeDE9IjMiIHkxPSI5IiB4Mj0iMjEiIHkyPSI5Ii8+PGxpbmUgeDE9IjMiIHkxPSIxNSIgeDI9IjIxIiB5Mj0iMTUiLz48bGluZSB4MT0iOSIgeTE9IjMiIHgyPSI5IiB5Mj0iMjEiLz48bGluZSB4MT0iMTUiIHkxPSIzIiB4Mj0iMTUiIHkyPSIyMSIvPjwvSWNvbkJhc2U+LAogICAgICAgICAgICBMYXlvdXQ6IChwcm9wcykgPT4gPEljb25CYXNlIHsuLi5wcm9wc30+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIgcnk9IjIiLz48bGluZSB4MT0iMyIgeTE9IjkiIHgyPSIyMSIgeTI9IjkiLz48bGluZSB4MT0iOSIgeTE9IjIxIiB4Mj0iOSIgeTI9IjkiLz48L0ljb25CYXNlPgogICAgICAgIH07CgogICAgICAgIGNvbnN0IHsgU2F2ZSwgVXBsb2FkLCBUcmFzaDIsIFByaW50ZXIsIFVzZXJzLCBDbG9jaywgQWxlcnRUcmlhbmdsZSwgRmlsZVVwLCBEb3dubG9hZCwgUm90YXRlQ2N3LCBTaGllbGRBbGVydCwgRWRpdCwgQ2hlY2tDaXJjbGUsIENsaXBib2FyZExpc3QsIENhbGVuZGFyLCBDaGV2cm9uVXAsIENoZXZyb25Eb3duLCBTcGFya2xlcywgWmFwLCBDb2ZmZWUsIE1pbnVzLCBQbHVzLCBCb29rT3BlbiwgR3JhZHVhdGlvbkNhcCwgQ2hldnJvblJpZ2h0LCBBd2FyZCwgTWljLCBQaWVDaGFydCwgU2VhcmNoLCBTYXZlTG9jYWwsIEhhbmRIZWFydCwgRmlsZVRleHQsIFR5cGUsIEhlbHBDaXJjbGUsIEZvbGRlciwgU2V0dGluZ3MsIExhcHRvcCwgU3RhbXAsIEdyaWQsIExheW91dCB9ID0gSWNvbnM7CgogICAgICAgIC8qIC0tLSBDT05TVEFOVFMgLS0tICovCiAgICAgICAgY29uc3QgU1VCSkVDVF9NQVBQSU5HID0gewogICAgICAgICAgICAnQVZFTklSJzogWydNQVRIUycsICdURUNITk8nLCAnUEhZLkNISU1JRScsICdIRyBFTUMnLCdISVNUT0lSRS1Hw4lPJywgJ0hJU1RPSVJFJywgJ0dFT0dSQVBISUUnLCAnRU1DJ10sCiAgICAgICAgICAgICdDSVRPWUVOJzogWydISVNUT0lSRS1Hw4lPJywgJ0hJU1RPSVJFJywgJ0dFT0dSQVBISUUnLCAnRU1DJ10sCiAgICAgICAgICAgICdQRUFDJzogWydNVVNJUVVFJywgJ0FSVFMgUExBU1RJUVVFUycsICdBUlRTJywnQVJUUyBQTEFTVCcsICdGUkFOQ0FJUyddLAogICAgICAgICAgICAnU0FOVEUnOiBbJ1NWVCcsICdFUFMnLCAnU0NJRU5DRVMnXSwKICAgICAgICAgICAgJ0NSRU9MRSc6IFsnQ1JFT0xFJywgJ0xDUiddLAogICAgICAgICAgICAnRVNQQUdOT0wnOiBbJ0VTUEFHTk9MJ10sCiAgICAgICAgICAgICdBTkdMQUlTJzogWydBTkdMQUlTJ10sCiAgICAgICAgICAgICdFUEknIDogWydGUkFOQ0FJUyddLAogICAgICAgICAgICAnTEFUSU4nOiBbJ0xBVElOJywgJ0xDQSddCiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgRURTX0xJU1QgPSB7CiAgICAgICAgICAgICJWb2llIEfDqW7DqXJhbGUiOiBbCiAgICAgICAgICAgICAgICAiTWF0aMOpbWF0aXF1ZXMiLCAiUGh5c2lxdWUtQ2hpbWllIiwgIlNWVCIsICJOU0kgKE51bcOpcmlxdWUpIiwgCiAgICAgICAgICAgICAgICAiQmlvbG9naWUtw4ljb2xvZ2llIiwgIlNFUyIsICJIR0dTUCIsICJITFAgKEh1bWFuaXTDqXMpIiwgCiAgICAgICAgICAgICAgICAiTExDRVIgQW5nbGFpcyIsICJMTENFUiBBbmdsYWlzIE1vbmRlIENvbnRlbXAuIiwgIkxMQ0VSIEVzcGFnbm9sIiwgCiAgICAgICAgICAgICAgICAiTExDQSAoTGFuZ3VlcyBBbnRpcXVpdMOpKSIsICJBcnRzIiwgIkVQUENTIChTcG9ydCkiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJTVE1HIjogWyJEcm9pdCBldCDDiWNvbm9taWUiLCAiTWFuYWdlbWVudCwgU2MuIEdlc3Rpb24gKE1lcmNhdGlxdWUpIiwgIk1hbmFnZW1lbnQsIFNjLiBHZXN0aW9uIChSSCkiLCAiTWFuYWdlbWVudCwgU2MuIEdlc3Rpb24gKEdlc3Rpb24tRmluYW5jZSkiLCAiTWFuYWdlbWVudCwgU2MuIEdlc3Rpb24gKFNJRykiXSwKICAgICAgICAgICAgIlNUSTJEIjogWyJJbmfDqW5pZXJpZSwgSW5ub3ZhdGlvbiBldCBERCIsICJQaHlzaXF1ZS1DaGltaWUgZXQgTWF0aMOpbWF0aXF1ZXMiXSwKICAgICAgICAgICAgIlNUMlMiOiBbIkNoaW1pZSwgQmlvIGV0IFBoeXNpb3BhdGhvbG9naWUiLCAiU2MuIGV0IFRlY2huaXF1ZXMgU2FuaXRhaXJlcyJdLAogICAgICAgICAgICAiU1RMIjogWyJQaHlzaXF1ZS1DaGltaWUgZXQgTWF0aMOpbWF0aXF1ZXMiLCAiQmlvY2hpbWllLUJpb2xvZ2llIChCaW90ZWNoKSIsICJTY2llbmNlcyBQaHlzaXF1ZXMgKFNQQykiXSwKICAgICAgICAgICAgIlNURDJBIjogWyJBbmFseXNlIGV0IG3DqXRob2RlcyBlbiBkZXNpZ24iLCAiQ29uY2VwdGlvbiBldCBjcsOpYXRpb24gZGVzaWduIl0sCiAgICAgICAgICAgICJTVEhSIjogWyJTYy4gZXQgdGVjaG5vIGN1bGluYWlyZXMiLCAiw4ljb25vbWllIC0gR2VzdGlvbiBIw7R0ZWxpw6hyZSJdLAogICAgICAgICAgICAiUzJUTUQiOiBbIkN1bHR1cmUgZXQgc2NpZW5jZXMiLCAiUHJhdGlxdWUgKE11c2lxdWUvRGFuc2UvVGjDqcOidHJlKSJdLAogICAgICAgICAgICAiU1RBViI6IFsiR2VzdGlvbiBkZXMgcmVzc291cmNlcyIsICJUZXJyaXRvaXJlcyBldCBzb2Npw6l0w6lzIl0KICAgICAgICB9OwoKICAgICAgICBjb25zdCBHT19TVUJKRUNUX01BUFBJTkcgPSB7CiAgICAgICAgICAgICdNQVRIw4lNQVRJUVVFUyc6IFsnTUFUSFMnLCAnTUFUSEVNQVRJUVVFUycsICdNQVRIJ10sCiAgICAgICAgICAgICdQSFlTSVFVRS1DSElNSUUnOiBbJ1BIWVNJUVVFJywgJ0NISU1JRScsICdTUEMnLCAnU0NJRU5DRVMgUEhZU0lRVUVTJ10sCiAgICAgICAgICAgICdTVlQnOiBbJ1NWVCcsICdCSU9MT0dJRScsICdTQ0lFTkNFUyBERSBMQSBWSUUnXSwKICAgICAgICAgICAgJ05TSSc6IFsnTlNJJywgJ05VTUVSSVFVRScsICdJTkZPUk1BVElRVUUnLCAnU0lJJ10sCiAgICAgICAgICAgICdCSU9MT0dJRS3DiUNPTE9HSUUnOiBbJ0JJT0xPR0lFJywgJ0VDT0xPR0lFJywgJ1NWVCddLAogICAgICAgICAgICAnU0VTJzogWydTRVMnLCAnRUNPTk9NSUUnLCAnU09DSUFMJ10sCiAgICAgICAgICAgICdIR0dTUCc6IFsnSElTVE9JUkUnLCAnR0VPR1JBUEhJRScsICdIR0dTUCcsICdIRyddLAogICAgICAgICAgICAnSExQJzogWydMRVRUUkVTJywgJ0xJVFRFUkFUVVJFJywgJ0ZSQU5DQUlTJywgJ1BISUxPU09QSElFJywgJ1BISUxPJ10sCiAgICAgICAgICAgICdMTENFUiBBTkdMQUlTJzogWydBTkdMQUlTJ10sCiAgICAgICAgICAgICdMTENFUiBFU1BBR05PTCc6IFsnRVNQQUdOT0wnXSwKICAgICAgICAgICAgJ0xMQ0VSIEFMTEVNQU5EJzogWydBTExFTUFORCddLAogICAgICAgICAgICAnTExDQSc6IFsnTEFUSU4nLCAnR1JFQycsICdMRVRUUkVTIENMQVNTSVFVRVMnXSwKICAgICAgICAgICAgJ0FSVFMnOiBbJ0FSVFMnLCAnUExBU1RJUVVFUycsICdNVVNJUVVFJywgJ0NJTkVNQScsICdUSEVBVFJFJ10sCiAgICAgICAgICAgICdFUFBDUyc6IFsnRVBTJywgJ1NQT1JUJ10sCiAgICAgICAgICAgICdTVE1HJzogWydFQ08tR0VTVElPTicsICdNQU5BR0VNRU5UJywgJ0RST0lUJywgJ0VDT05PTUlFJywgJ01BUktFVElORycsICdSSCcsICdTSUcnLCAnR0VTVElPTiddLAogICAgICAgICAgICAnU1RJMkQnOiBbJ1NJSScsICdJTkdFTklFUklFJywgJ1RFQ0hOT0xPR0lFJywgJ1BIWVNJUVVFJ10sCiAgICAgICAgICAgICdTVDJTJzogWydTVFNTJywgJ0JJT1RFQ0gnLCAnQlBIJywgJ1NNUyddLAogICAgICAgICAgICAnU1RMJzogWydCSU9URUNIJywgJ1BIWVNJUVVFJywgJ0NISU1JRScsICdCSU9DSElNSUUnXSwKICAgICAgICAgICAgJ1NURDJBJzogWydERVNJR04nLCAnQVJUUyBBUFBMSVFVRVMnXSwKICAgICAgICAgICAgJ1NUSFInOiBbJ0hPVEVMTEVSSUUnLCAnQ1VJU0lORScsICdTRVJWSUNFJywgJ0dFU1RJT04nXSwKICAgICAgICAgICAgJ1NUQVYnOiBbJ0FHUk9OT01JRScsICdCSU9MT0dJRSddCiAgICAgICAgfTsKCiAgICAgICAgLyogLS0tIEhFTFBFUlMgLS0tICovCiAgICAgICAgY29uc3Qgbm9ybWFsaXplVGV4dCA9ICh0ZXh0KSA9PiB0ZXh0ID8gdGV4dC50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkudHJpbSgpIDogIiI7CgogICAgICAgIGNvbnN0IGNoZWNrQ29tcGF0aWJpbGl0eSA9IChzdHVkZW50LCBwcm9mcywgZXhhbVR5cGUpID0+IHsKICAgICAgICAgICAgaWYgKCFzdHVkZW50KSByZXR1cm4gdHJ1ZTsgCiAgICAgICAgICAgIAogICAgICAgICAgICBsZXQgcmVxdWlyZWRTdWJqZWN0cyA9IFtdOwoKICAgICAgICAgICAgaWYgKGV4YW1UeXBlID09PSAnRE5CJykgewogICAgICAgICAgICAgICAgY29uc3QgcGFyY291cnMgPSBub3JtYWxpemVUZXh0KHN0dWRlbnQuUEFSQ09VUlMpOwogICAgICAgICAgICAgICAgY29uc3QgbGFuZ3VlID0gbm9ybWFsaXplVGV4dChzdHVkZW50LkxBTkdVRSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIFNVQkpFQ1RfTUFQUElORykgewogICAgICAgICAgICAgICAgICAgIGlmIChwYXJjb3Vycy5pbmNsdWRlcyhrZXkpKSByZXF1aXJlZFN1YmplY3RzID0gWy4uLnJlcXVpcmVkU3ViamVjdHMsIC4uLlNVQkpFQ1RfTUFQUElOR1trZXldXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIFNVQkpFQ1RfTUFQUElORykgewogICAgICAgICAgICAgICAgICAgIGlmIChsYW5ndWUuaW5jbHVkZXMoa2V5KSkgcmVxdWlyZWRTdWJqZWN0cyA9IFsuLi5yZXF1aXJlZFN1YmplY3RzLCAuLi5TVUJKRUNUX01BUFBJTkdba2V5XV07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKFNVQkpFQ1RfTUFQUElOR1twYXJjb3Vyc10pIHJlcXVpcmVkU3ViamVjdHMgPSBbLi4ucmVxdWlyZWRTdWJqZWN0cywgLi4uU1VCSkVDVF9NQVBQSU5HW3BhcmNvdXJzXV07CiAgICAgICAgICAgICAgICBpZiAoU1VCSkVDVF9NQVBQSU5HW2xhbmd1ZV0pIHJlcXVpcmVkU3ViamVjdHMgPSBbLi4ucmVxdWlyZWRTdWJqZWN0cywgLi4uU1VCSkVDVF9NQVBQSU5HW2xhbmd1ZV1dOwogICAgICAgICAgICB9IAogICAgICAgICAgICBlbHNlIGlmIChleGFtVHlwZSA9PT0gJ0dPJykgewogICAgICAgICAgICAgICAgaWYgKCFzdHVkZW50LkVEUykgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBjb25zdCBlZHMgPSBub3JtYWxpemVUZXh0KHN0dWRlbnQuRURTKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gR09fU1VCSkVDVF9NQVBQSU5HKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVkcy5pbmNsdWRlcyhrZXkpIHx8IGtleS5pbmNsdWRlcyhlZHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkU3ViamVjdHMgPSBbLi4ucmVxdWlyZWRTdWJqZWN0cywgLi4uR09fU1VCSkVDVF9NQVBQSU5HW2tleV1dOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlcXVpcmVkU3ViamVjdHMucHVzaChlZHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXF1aXJlZFN1YmplY3RzID0gWy4uLm5ldyBTZXQocmVxdWlyZWRTdWJqZWN0cyldOwoKICAgICAgICAgICAgaWYgKHJlcXVpcmVkU3ViamVjdHMubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsgCgogICAgICAgICAgICBjb25zdCBoYXNNYXRjaCA9IHByb2ZzLnNvbWUocCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXAgfHwgIXAuTUFUSUVSRSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgY29uc3QgbWF0ID0gbm9ybWFsaXplVGV4dChwLk1BVElFUkUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlcXVpcmVkU3ViamVjdHMuc29tZShyZXEgPT4gbWF0LmluY2x1ZGVzKG5vcm1hbGl6ZVRleHQocmVxKSkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBoYXNNYXRjaDsKICAgICAgICB9OwoKICAgICAgICBjb25zdCBhZGRNaW51dGVzID0gKHRpbWVTdHIsIG1pbnV0ZXNUb0FkZCkgPT4gewogICAgICAgICAgICBpZiAoIXRpbWVTdHIpIHJldHVybiAiIjsKICAgICAgICAgICAgY29uc3QgW2gsIG1dID0gdGltZVN0ci5zcGxpdCgnOicpLm1hcChOdW1iZXIpOwogICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgZGF0ZS5zZXRIb3VycyhoKTsKICAgICAgICAgICAgZGF0ZS5zZXRNaW51dGVzKG0gKyBtaW51dGVzVG9BZGQpOwogICAgICAgICAgICByZXR1cm4gZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoJ2ZyLUZSJywgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGNhbGN1bGF0ZVN0dWRlbnRUaW1lcyA9IChzdHVkZW50cywgc3RhcnRUaW1lLCBleGFtVHlwZSkgPT4gewogICAgICAgICAgICBsZXQgY3VycmVudFRpbWUgPSBzdGFydFRpbWU7CiAgICAgICAgICAgIGxldCBsYXN0R3JvdXAgPSBudWxsOwogICAgICAgICAgICBsZXQgbGFzdEdyb3VwU3RhcnQgPSBudWxsOwogICAgICAgICAgICBsZXQgbGFzdEdyb3VwRW5kID0gbnVsbDsKCiAgICAgICAgICAgIHJldHVybiBzdHVkZW50cy5tYXAoc3R1ZGVudCA9PiB7CiAgICAgICAgICAgICAgICBpZiAoc3R1ZGVudC5pc0JyZWFrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBzdHVkZW50LmR1cmF0aW9uIHx8IDE1OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kID0gYWRkTWludXRlcyhzdGFydCwgZHVyYXRpb24pOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUaW1lID0gZW5kOyAKICAgICAgICAgICAgICAgICAgICBsYXN0R3JvdXAgPSBudWxsOyBsYXN0R3JvdXBTdGFydCA9IG51bGw7IGxhc3RHcm91cEVuZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4uc3R1ZGVudCwgdGltZVN0YXJ0OiBzdGFydCwgdGltZUVuZDogZW5kIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgcmF3R3JvdXAgPSAoZXhhbVR5cGUgPT09ICdETkInICYmIHN0dWRlbnQuR1JPVVBFKSA/IHN0dWRlbnQuR1JPVVBFLnRvU3RyaW5nKCkudHJpbSgpIDogIiI7CiAgICAgICAgICAgICAgICBjb25zdCBpc0dyb3VwID0gcmF3R3JvdXAubGVuZ3RoID4gMCAmJiByYXdHcm91cC50b1VwcGVyQ2FzZSgpICE9PSAiTk9OIjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgaXNUVCA9IChzdHVkZW50LlRUICYmIChzdHVkZW50LlRUID09PSAnT1VJJyB8fCBzdHVkZW50LlRUID09PSB0cnVlIHx8IHN0dWRlbnQuVFQudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKCdUSUVSUycpKSk7CgogICAgICAgICAgICAgICAgbGV0IHN0YXJ0LCBlbmQ7CgogICAgICAgICAgICAgICAgaWYgKGlzR3JvdXAgJiYgcmF3R3JvdXAgPT09IGxhc3RHcm91cCkgewogICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gbGFzdEdyb3VwU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgZW5kID0gbGFzdEdyb3VwRW5kOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGN1cnJlbnRUaW1lOwogICAgICAgICAgICAgICAgICAgIGxldCBkdXJhdGlvbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV4YW1UeXBlID09PSAnQ0ZHJykgewogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDIwOyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVFQpIGR1cmF0aW9uICs9IDc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChleGFtVHlwZSA9PT0gJ0dPJykgewogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDIwOyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVFQpIGR1cmF0aW9uICs9IDc7IAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gaXNHcm91cCA/IDI1IDogMTU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1RUKSBkdXJhdGlvbiArPSA1OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZW5kID0gYWRkTWludXRlcyhzdGFydCwgZHVyYXRpb24pOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUaW1lID0gYWRkTWludXRlcyhlbmQsIDUpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNHcm91cCkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXN0R3JvdXAgPSByYXdHcm91cDsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEdyb3VwU3RhcnQgPSBzdGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEdyb3VwRW5kID0gZW5kOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RHcm91cCA9IG51bGw7IGxhc3RHcm91cFN0YXJ0ID0gbnVsbDsgbGFzdEdyb3VwRW5kID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4uc3R1ZGVudCwgdGltZVN0YXJ0OiBzdGFydCwgdGltZUVuZDogZW5kIH07CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IHRpbWVUb01pbnV0ZXMgPSAodCkgPT4gewogICAgICAgICAgICBpZiAoIXQpIHJldHVybiAwOwogICAgICAgICAgICBjb25zdCBbaCwgbV0gPSB0LnNwbGl0KCc6JykubWFwKE51bWJlcik7CiAgICAgICAgICAgIHJldHVybiAoaCAqIDYwKSArIChtIHx8IDApOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IG1pbnV0ZXNUb0hITU0gPSAobWlucykgPT4gewogICAgICAgICAgICBjb25zdCBoID0gTWF0aC5mbG9vcihtaW5zIC8gNjApOwogICAgICAgICAgICBjb25zdCBtID0gbWlucyAlIDYwOwogICAgICAgICAgICBjb25zdCBoaCA9IFN0cmluZyhoKS5wYWRTdGFydCgyLCcwJyk7CiAgICAgICAgICAgIGNvbnN0IG1tID0gU3RyaW5nKG0pLnBhZFN0YXJ0KDIsJzAnKTsKICAgICAgICAgICAgcmV0dXJuIGAke2hofToke21tfWA7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZm9ybWF0TWludXRlc0hNID0gKG1pbnMpID0+IHsKICAgICAgICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IobWlucyAvIDYwKTsKICAgICAgICAgICAgY29uc3QgbSA9IG1pbnMgJSA2MDsKICAgICAgICAgICAgcmV0dXJuIGAke2h9aCR7U3RyaW5nKG0pLnBhZFN0YXJ0KDIsJzAnKX1gOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGNhbGN1bGF0ZUp1cnlMb2FkID0gKGp1cnksIHN0YXJ0VGltZSwgZXhhbVR5cGUpID0+IHsKICAgICAgICAgICAgY29uc3Qgc3R1ZGVudHNXaXRoVGltZSA9IGNhbGN1bGF0ZVN0dWRlbnRUaW1lcyhqdXJ5LnN0dWRlbnRzIHx8IFtdLCBzdGFydFRpbWUsIGV4YW1UeXBlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCB0b3RhbE1pbnV0ZXMgPSAwOwogICAgICAgICAgICBsZXQgdHRDb3VudCA9IDA7CiAgICAgICAgICAgIGNvbnN0IGdyb3VwSWRzID0gbmV3IFNldCgpOwogICAgICAgICAgICBsZXQgbGFzdEVuZCA9IHN0YXJ0VGltZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCByZWFsU3R1ZGVudENvdW50ID0gMDsKICAgICAgICAgICAgY29uc3QgdW5pcXVlU2xvdHMgPSBuZXcgU2V0KCk7CgogICAgICAgICAgICBzdHVkZW50c1dpdGhUaW1lLmZvckVhY2gocyA9PiB7CiAgICAgICAgICAgICAgICBpZiAocy5pc0JyZWFrKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlYWxTdHVkZW50Q291bnQrKzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgc2xvdEtleSA9IHMudGltZVN0YXJ0ICsgJy0nICsgcy50aW1lRW5kOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIXVuaXF1ZVNsb3RzLmhhcyhzbG90S2V5KSkgewogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVNsb3RzLmFkZChzbG90S2V5KTsKICAgICAgICAgICAgICAgICAgICB0b3RhbE1pbnV0ZXMgKz0gTWF0aC5tYXgoMCwgdGltZVRvTWludXRlcyhzLnRpbWVFbmQpIC0gdGltZVRvTWludXRlcyhzLnRpbWVTdGFydCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RFbmQgfHwgdGltZVRvTWludXRlcyhzLnRpbWVFbmQpID4gdGltZVRvTWludXRlcyhsYXN0RW5kKSkgewogICAgICAgICAgICAgICAgICAgIGxhc3RFbmQgPSBzLnRpbWVFbmQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgaXNUVCA9IChzLlRUICYmIChzLlRUID09PSAnT1VJJyB8fCBzLlRUID09PSB0cnVlIHx8IG5vcm1hbGl6ZVRleHQocy5UVCkuaW5jbHVkZXMoJ1RJRVJTJykpKTsKICAgICAgICAgICAgICAgIGlmIChpc1RUKSB0dENvdW50Kys7CiAgICAgICAgICAgICAgICBjb25zdCBnID0gKHMuR1JPVVBFICYmIHMuR1JPVVBFLnRvU3RyaW5nKCkudHJpbSgpICYmIG5vcm1hbGl6ZVRleHQocy5HUk9VUEUpICE9PSAnTk9OJykgPyBzLkdST1VQRS50b1N0cmluZygpLnRyaW0oKSA6ICcnOwogICAgICAgICAgICAgICAgaWYgKGcpIGdyb3VwSWRzLmFkZChnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAganVyeUlkOiBqdXJ5LmlkLAogICAgICAgICAgICAgICAgcm9vbToganVyeS5yb29tIHx8ICcnLAogICAgICAgICAgICAgICAgc3R1ZGVudENvdW50OiByZWFsU3R1ZGVudENvdW50LAogICAgICAgICAgICAgICAgcGFzc2FnZUNvdW50OiB1bmlxdWVTbG90cy5zaXplLCAKICAgICAgICAgICAgICAgIHRvdGFsTWludXRlcywKICAgICAgICAgICAgICAgIHR0Q291bnQsCiAgICAgICAgICAgICAgICBncm91cENvdW50OiBncm91cElkcy5zaXplLAogICAgICAgICAgICAgICAgZW5kVGltZTogbGFzdEVuZCB8fCBzdGFydFRpbWUKICAgICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICBjb25zdCBnZXRMb2FkU3RhdHVzID0gKGp1cnlNaW51dGVzLCBhdmdNaW51dGVzKSA9PiB7CiAgICAgICAgICAgIGlmICghYXZnTWludXRlcyB8fCBhdmdNaW51dGVzIDw9IDApIHJldHVybiB7IGxhYmVsOiAn4oCUJywgY2xzOiAndGV4dC1zbGF0ZS02MDAgYmctc2xhdGUtMTAwIGJvcmRlci1zbGF0ZS0yMDAnIH07CiAgICAgICAgICAgIGNvbnN0IHJhdGlvID0ganVyeU1pbnV0ZXMgLyBhdmdNaW51dGVzOwogICAgICAgICAgICBpZiAocmF0aW8gPD0gMS4xMCkgcmV0dXJuIHsgbGFiZWw6ICfDiXF1aWxpYnLDqScsIGNsczogJ3RleHQtZW1lcmFsZC03MDAgYmctZW1lcmFsZC01MCBib3JkZXItZW1lcmFsZC0yMDAnIH07CiAgICAgICAgICAgIGlmIChyYXRpbyA8PSAxLjIwKSByZXR1cm4geyBsYWJlbDogJ1NvdXMgdGVuc2lvbicsIGNsczogJ3RleHQtb3JhbmdlLTcwMCBiZy1vcmFuZ2UtNTAgYm9yZGVyLW9yYW5nZS0yMDAnIH07CiAgICAgICAgICAgIHJldHVybiB7IGxhYmVsOiAnU3VyY2hhcmfDqScsIGNsczogJ3RleHQtcmVkLTcwMCBiZy1yZWQtNTAgYm9yZGVyLXJlZC0yMDAnIH07CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZm9ybWF0RGF0ZSA9IChkYXRlU3RyKSA9PiB7CiAgICAgICAgICAgIGlmICghZGF0ZVN0cikgcmV0dXJuICJEYXRlIG5vbiBkw6lmaW5pZSI7CiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVN0ci5zcGxpdCgnLScpOwogICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGFyc2VJbnQocGFydHNbMF0pLCBwYXJzZUludChwYXJ0c1sxXSkgLSAxLCBwYXJzZUludChwYXJ0c1syXSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicsIHsgd2Vla2RheTogJ2xvbmcnLCB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyKTsKICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicsIHsgd2Vla2RheTogJ2xvbmcnLCB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnIH0pOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IGRvd25sb2FkQ1NWID0gKGRhdGEsIGZpbGVuYW1lKSA9PiB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCBkYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBPYmplY3Qua2V5cyhkYXRhWzBdKS5qb2luKCI7Iik7CiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBkYXRhLm1hcChyb3cgPT4gCiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHJvdykubWFwKHZhbHVlID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHIgPSBTdHJpbmcodmFsdWUgfHwgJycpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBgIiR7c3RyLnJlcGxhY2UoLyIvZywgJyIiJyl9ImA7CiAgICAgICAgICAgICAgICB9KS5qb2luKCI7IikKICAgICAgICAgICAgKTsKICAgICAgICAgICAgY29uc3QgY3N2Q29udGVudCA9ICJcdUZFRkYiICsgW2hlYWRlcnMsIC4uLnJvd3NdLmpvaW4oIlxuIik7CiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY3N2Q29udGVudF0sIHsgdHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7JyB9KTsKICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgaWYgKGxpbmsuZG93bmxvYWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJocmVmIiwgdXJsKTsKICAgICAgICAgICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIGZpbGVuYW1lKTsKICAgICAgICAgICAgICAgIGxpbmsuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjb25zdCBjaHVua0FycmF5ID0gKGFycmF5LCBzaXplKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSArPSBzaXplKSB7CiAgICAgICAgICAgICAgICBjaHVua3MucHVzaChhcnJheS5zbGljZShpLCBpICsgc2l6ZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjaHVua3M7CiAgICAgICAgfTsKCiAgICAgICAgLyogLS0tIENPTVBPTkVOVFMgLS0tICovCgogICAgICAgIGNvbnN0IEZpbGVVcGxvYWRlciA9ICh7IGxhYmVsLCBvbkRhdGFMb2FkZWQsIGZpZWxkcywgY29sb3IgPSAiYmx1ZSIgfSkgPT4gewogICAgICAgICAgICAgY29uc3QgaGFuZGxlRmlsZSA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07CiAgICAgICAgICAgICAgICBpZiAoIWZpbGUpIHJldHVybjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgUGFwYS5wYXJzZShmaWxlLCB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNraXBFbXB0eUxpbmVzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUhlYWRlcjogKGgpID0+IGgudHJpbSgpLAogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiAocmVzdWx0cykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBvbkRhdGFMb2FkZWQocmVzdWx0cy5kYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGNvbG9yQ2xhc3NlcyA9IHsKICAgICAgICAgICAgICAgIGJsdWU6ICJib3JkZXItYmx1ZS0yMDAgYmctYmx1ZS01MC81MCBob3ZlcjpiZy1ibHVlLTEwMC84MCB0ZXh0LWJsdWUtNzAwIiwKICAgICAgICAgICAgICAgIGdyZWVuOiAiYm9yZGVyLWVtZXJhbGQtMjAwIGJnLWVtZXJhbGQtNTAvNTAgaG92ZXI6YmctZW1lcmFsZC0xMDAvODAgdGV4dC1lbWVyYWxkLTcwMCIsCiAgICAgICAgICAgICAgICByb3NlOiAiYm9yZGVyLXJvc2UtMjAwIGJnLXJvc2UtNTAvNTAgaG92ZXI6Ymctcm9zZS0xMDAvODAgdGV4dC1yb3NlLTcwMCIsCiAgICAgICAgICAgICAgICBpbmRpZ286ICJib3JkZXItaW5kaWdvLTIwMCBiZy1pbmRpZ28tNTAvNTAgaG92ZXI6YmctaW5kaWdvLTEwMC84MCB0ZXh0LWluZGlnby03MDAiCiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2ByZWxhdGl2ZSBncm91cCBvdmVyZmxvdy1oaWRkZW4gYm9yZGVyLTIgYm9yZGVyLWRhc2hlZCByb3VuZGVkLXhsIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCBjdXJzb3ItcG9pbnRlciAke2NvbG9yQ2xhc3Nlc1tjb2xvcl0gfHwgY29sb3JDbGFzc2VzLmJsdWV9YH0+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcC00IGgtZnVsbCB3LWZ1bGwgY3Vyc29yLXBvaW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcC0yLjUgcm91bmRlZC1mdWxsIHNoYWRvdy1zbSBncm91cC1ob3ZlcjpzY2FsZS0xMTAgZ3JvdXAtaG92ZXI6c2hhZG93LW1kIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RmlsZVVwIHNpemU9ezIwfSBjbGFzc05hbWU9e2B0ZXh0LSR7Y29sb3J9LTUwMGB9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXNtIHRleHQtY2VudGVyIj57bGFiZWx9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtWzEwcHhdIG9wYWNpdHktNjAgZm9udC1tZWRpdW0iPkNTViA6IHtmaWVsZHMuc2xpY2UoMCwgMikuam9pbignLCAnKX0uLi48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJmaWxlIiBhY2NlcHQ9Ii5jc3YiIG9uQ2hhbmdlPXtoYW5kbGVGaWxlfSBjbGFzc05hbWU9ImhpZGRlbiIgLz4KICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgU3R1ZGVudENhcmQgPSAoeyBzdHVkZW50LCB0eXBlLCBkcmFnZ2FibGUsIG9uRHJhZ1N0YXJ0LCBvblVwZGF0ZUR1cmF0aW9uLCBvbkVkaXRFZHMsIG9uR2VuZXJhbEVkaXQsIGlzQ29tcGF0IH0pID0+IHsKICAgICAgICAgICAgaWYgKHN0dWRlbnQuaXNCcmVhaykgewogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICA8ZGl2IAogICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU9e2RyYWdnYWJsZX0KICAgICAgICAgICAgICAgICAgICAgICAgb25EcmFnU3RhcnQ9eyhlKSA9PiBvbkRyYWdTdGFydChlLCBzdHVkZW50KX0KICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJwLTIgbWItMiByb3VuZGVkIGJvcmRlciBib3JkZXItb3JhbmdlLTIwMCBiZy1vcmFuZ2UtNTAgc2hhZG93LXNtIGN1cnNvci1ncmFiIGFjdGl2ZTpjdXJzb3ItZ3JhYmJpbmcgdGV4dC1zbSBmbGV4IGZsZXgtY29sIGdhcC0xIgogICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgdGV4dC1vcmFuZ2UtNzAwIGZvbnQtYm9sZCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPENvZmZlZSBzaXplPXsxOH0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5QQVVTRTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAge3N0dWRlbnQudGltZVN0YXJ0ICYmIHN0dWRlbnQudGltZUVuZCAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteHMgZm9udC1tb25vIGZvbnQtYm9sZCB0ZXh0LW9yYW5nZS04MDAgYmctb3JhbmdlLTEwMCBweC0yIHB5LTAuNSByb3VuZGVkIGJvcmRlciBib3JkZXItb3JhbmdlLTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHVkZW50LnRpbWVTdGFydH0gLSB7c3R1ZGVudC50aW1lRW5kfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIG10LTEgcGwtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LVsxMHB4XSB0ZXh0LW9yYW5nZS02MDAgZm9udC1tZWRpdW0gdXBwZXJjYXNlIHRyYWNraW5nLXdpZGUgb3BhY2l0eS04MCI+RHVyw6llIHBlcnNvbm5hbGlzYWJsZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgYmctd2hpdGUgcm91bmRlZCBib3JkZXIgYm9yZGVyLW9yYW5nZS0yMDAgcHgtMSBzaGFkb3ctc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtvblVwZGF0ZUR1cmF0aW9uICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBvblVwZGF0ZUR1cmF0aW9uKHN0dWRlbnQuaWQsIE1hdGgubWF4KDUsIChzdHVkZW50LmR1cmF0aW9uIHx8IDE1KSAtIDUpKX0gY2xhc3NOYW1lPSJwLTEgdGV4dC1vcmFuZ2UtNDAwIGhvdmVyOnRleHQtb3JhbmdlLTYwMCBob3ZlcjpiZy1vcmFuZ2UtNTAgcm91bmRlZCIgdGl0bGU9Ii0gNSBtaW4iPjxNaW51cyBzaXplPXsxMn0gLz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC14cyBmb250LW1vbm8gZm9udC1ib2xkIHctMTIgdGV4dC1jZW50ZXIgdGV4dC1vcmFuZ2UtOTAwIj57c3R1ZGVudC5kdXJhdGlvbiB8fCAxNX0gbWluPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtvblVwZGF0ZUR1cmF0aW9uICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBvblVwZGF0ZUR1cmF0aW9uKHN0dWRlbnQuaWQsIChzdHVkZW50LmR1cmF0aW9uIHx8IDE1KSArIDUpfSBjbGFzc05hbWU9InAtMSB0ZXh0LW9yYW5nZS00MDAgaG92ZXI6dGV4dC1vcmFuZ2UtNjAwIGhvdmVyOmJnLW9yYW5nZS01MCByb3VuZGVkIiB0aXRsZT0iKyA1IG1pbiI+PFBsdXMgc2l6ZT17MTJ9IC8+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGlzVFQgPSBzdHVkZW50LlRUICYmIChzdHVkZW50LlRUID09PSAnT1VJJyB8fCBub3JtYWxpemVUZXh0KHN0dWRlbnQuVFQpLmluY2x1ZGVzKCdUSUVSUycpIHx8IHN0dWRlbnQuVFQgPT09IHRydWUpOwogICAgICAgICAgICBjb25zdCBpc1BDID0gc3R1ZGVudC5QQyAmJiAoc3R1ZGVudC5QQyA9PT0gJ09VSScgfHwgc3R1ZGVudC5QQyA9PT0gdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IGlzQUVTSCA9IHN0dWRlbnQuQUVTSF9OT00gJiYgc3R1ZGVudC5BRVNIX05PTS50cmltKCkgIT09ICIiOwogICAgICAgICAgICBjb25zdCBpc0dyb3VwID0gc3R1ZGVudC5HUk9VUEUgJiYgc3R1ZGVudC5HUk9VUEUubGVuZ3RoID4gMDsKICAgICAgICAgICAgY29uc3Qgc2hvd0NvbXBhdCA9ICh0eXBlID09PSAnRE5CJyB8fCB0eXBlID09PSAnR08nKSAmJiAhc3R1ZGVudC5pc0JyZWFrICYmIGlzQ29tcGF0ICE9PSB1bmRlZmluZWQ7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgPGRpdiAKICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU9e2RyYWdnYWJsZX0KICAgICAgICAgICAgICAgICAgICBvbkRyYWdTdGFydD17KGUpID0+IG9uRHJhZ1N0YXJ0KGUsIHN0dWRlbnQpfQogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YAogICAgICAgICAgICAgICAgICAgICAgICBwLTIgbWItMiByb3VuZGVkIGJvcmRlciBzaGFkb3ctc20gY3Vyc29yLWdyYWIgYWN0aXZlOmN1cnNvci1ncmFiYmluZyB0ZXh0LXNtIGZsZXggZmxleC1jb2wgZ2FwLTEgcmVsYXRpdmUgZ3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgJHtpc1RUID8gJ2JnLXJlZC01MCBib3JkZXItcmVkLTIwMCcgOiAnYmctd2hpdGUgYm9yZGVyLWdyYXktMjAwJ30KICAgICAgICAgICAgICAgICAgICAgICAgJHtkcmFnZ2FibGUgPyAnaG92ZXI6c2hhZG93LW1kJyA6ICcnfQogICAgICAgICAgICAgICAgICAgIGB9CiAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLXN0YXJ0IGZvbnQtYm9sZCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17aXNUVCA/ICd0ZXh0LXJlZC03MDAnIDogJ3RleHQtZ3JheS04MDAnfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHVkZW50Lk5PTX0ge3N0dWRlbnQuUFJFTk9NfQogICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTEgZmxleCBnYXAtMiBmbGV4LXdyYXAiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQteHMgYmctZ3JheS0yMDAgcHgtMSByb3VuZGVkIj57c3R1ZGVudC5ESVZ9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICB7aXNBRVNIICYmIDxzcGFuIGNsYXNzTmFtZT0idGV4dC14cyBiZy1wdXJwbGUtMTAwIHRleHQtcHVycGxlLTcwMCBweC0xIHJvdW5kZWQgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIiB0aXRsZT17YCR7c3R1ZGVudC5BRVNIX05PTX0gJHtzdHVkZW50LkFFU0hfUFJFTk9NIHx8ICcnfWB9PjxIYW5kSGVhcnQgc2l6ZT17MTB9IC8+IEFFU0g8L3NwYW4+fQogICAgICAgICAgICAgICAgICAgICAgICB7aXNQQyAmJiA8c3BhbiBjbGFzc05hbWU9InRleHQteHMgYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTcwMCBweC0xIHJvdW5kZWQgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIiB0aXRsZT0iVXRpbGlzZSB1biBPcmRpbmF0ZXVyIj48TGFwdG9wIHNpemU9ezEwfSAvPiBQQzwvc3Bhbj59CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAge2lzVFQgJiYgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXJlZC02MDAiPuKaoO+4jyBUSUVSUyBURU1QUzwvc3Bhbj59CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAge3R5cGUgPT09ICdETkInICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteHMgdGV4dC1ncmF5LTYwMCBwYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHVkZW50LlBBUkNPVVJTICYmIDxkaXYgY2xhc3NOYW1lPSJ0cnVuY2F0ZSIgdGl0bGU9e3N0dWRlbnQuUEFSQ09VUlN9PlBhcmNvdXJzOiB7c3R1ZGVudC5QQVJDT1VSU308L2Rpdj59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3R1ZGVudC5USEVNRSAmJiA8ZGl2IGNsYXNzTmFtZT0idHJ1bmNhdGUiIHRpdGxlPXtzdHVkZW50LlRIRU1FfT5UaMOobWU6IHtzdHVkZW50LlRIRU1FfTwvZGl2Pn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHVkZW50LkxBTkdVRSAmJiA8ZGl2Pkxhbmd1ZToge3N0dWRlbnQuTEFOR1VFfTwvZGl2Pn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpc0dyb3VwICYmIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWJsdWUtNjAwIGZvbnQtc2VtaWJvbGQiPkdyb3VwZToge3N0dWRlbnQuR1JPVVBFfTwvZGl2Pn0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAge3R5cGUgPT09ICdHTycgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyBtdC0xIGJvcmRlci10IGJvcmRlci1ncmF5LTEwMCBwdC0xIHBiLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAge3N0dWRlbnQuRURTID8gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXJvc2UtNzAwIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSBwci02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJvb2tPcGVuIHNpemU9ezEyfSAvPiB7c3R1ZGVudC5FRFN9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtvbkVkaXRFZHMgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoZSkgPT4geyBlLnN0b3BQcm9wYWdhdGlvbigpOyBvbkVkaXRFZHMoc3R1ZGVudCk7IH19IGNsYXNzTmFtZT0idGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LXJvc2UtNjAwIG1sLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxFZGl0IHNpemU9ezEyfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IG9uRWRpdEVkcyAmJiBvbkVkaXRFZHMoc3R1ZGVudCk7IH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0idy1mdWxsIHRleHQtY2VudGVyIGJnLXJvc2UtNTAgaG92ZXI6Ymctcm9zZS0xMDAgdGV4dC1yb3NlLTYwMCB0ZXh0LXhzIGZvbnQtYm9sZCBweS0xIHJvdW5kZWQgYm9yZGVyIGJvcmRlci1yb3NlLTIwMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxFZGl0IHNpemU9ezEyfSAvPiBEw6lmaW5pciBFRFMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICl9CgogICAgICAgICAgICAgICAgICAgIHtzaG93Q29tcGF0ICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpc0NvbXBhdCA9PT0gdHJ1ZSAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFic29sdXRlIGJvdHRvbS04IHJpZ2h0LTEgYmctZ3JlZW4tNTAgdGV4dC1ncmVlbi03MDAgYm9yZGVyIGJvcmRlci1ncmVlbi0yMDAgdGV4dC1bMTBweF0gZm9udC1ib2xkIHB4LTEuNSBweS0wLjUgcm91bmRlZCBzaGFkb3ctc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgei0xMCBiYWNrZHJvcC1ibHVyLXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPENoZWNrQ2lyY2xlIHNpemU9ezEyfSAvPiBDb21wYXRpYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAge2lzQ29tcGF0ID09PSBmYWxzZSAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFic29sdXRlIGJvdHRvbS04IHJpZ2h0LTEgYmctb3JhbmdlLTUwIHRleHQtb3JhbmdlLTcwMCBib3JkZXIgYm9yZGVyLW9yYW5nZS0yMDAgdGV4dC1bMTBweF0gZm9udC1ib2xkIHB4LTEuNSBweS0wLjUgcm91bmRlZCBzaGFkb3ctc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgei0xMCBiYWNrZHJvcC1ibHVyLXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEFsZXJ0VHJpYW5nbGUgc2l6ZT17MTJ9IC8+IE1hdGnDqHJlID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7aXNDb21wYXQgPT09IG51bGwgJiYgdHlwZSA9PT0gJ0dPJyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFic29sdXRlIGJvdHRvbS04IHJpZ2h0LTEgYmctb3JhbmdlLTUwIHRleHQtb3JhbmdlLTcwMCBib3JkZXIgYm9yZGVyLW9yYW5nZS0yMDAgdGV4dC1bMTBweF0gZm9udC1ib2xkIHB4LTEuNSBweS0wLjUgcm91bmRlZCBzaGFkb3ctc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgei0xMCBiYWNrZHJvcC1ibHVyLXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEFsZXJ0VHJpYW5nbGUgc2l6ZT17MTJ9IC8+IEVEUyA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICA8Lz4KICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIAogICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4geyBlLnN0b3BQcm9wYWdhdGlvbigpOyBvbkdlbmVyYWxFZGl0KHN0dWRlbnQpOyB9fQogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9ImFic29sdXRlIGJvdHRvbS0xIHJpZ2h0LTEgdGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWJsdWUtNjAwIGJnLXdoaXRlLzgwIGhvdmVyOmJnLXdoaXRlIHJvdW5kZWQtZnVsbCBwLTEuNSB0cmFuc2l0aW9uLWNvbG9ycyB6LTEwIHNoYWRvdy1zbSBib3JkZXIgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1ncmF5LTIwMCIKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9Ik1vZGlmaWVyIGxlcyBpbmZvcm1hdGlvbnMiCiAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICA8RWRpdCBzaXplPXsxNH0gLz4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IEp1cnlDb2x1bW4gPSAoeyBqdXJ5SWQsIGp1cnlEYXRhLCBwcm9mcywgb25VcGRhdGVKdXJ5LCBvbkRyb3BTdHVkZW50LCBvblJlbW92ZVN0dWRlbnQsIG9uTW92ZVN0dWRlbnQsIG9uVXBkYXRlU3R1ZGVudER1cmF0aW9uLCBleGFtVHlwZSwgc3RhcnRUaW1lLCBvbkVkaXRFZHMsIG9uR2VuZXJhbEVkaXQgfSkgPT4gewogICAgICAgICAgICBjb25zdCBbaXNFZGl0aW5nLCBzZXRJc0VkaXRpbmddID0gdXNlU3RhdGUoZmFsc2UpOwogICAgICAgICAgICBjb25zdCBzdHVkZW50c1dpdGhUaW1lID0gY2FsY3VsYXRlU3R1ZGVudFRpbWVzKGp1cnlEYXRhLnN0dWRlbnRzLCBzdGFydFRpbWUsIGV4YW1UeXBlKTsKICAgICAgICAgICAgY29uc3QgcHJvZjEgPSBwcm9mcy5maW5kKHAgPT4gcC5pZCA9PT0ganVyeURhdGEucHJvZjFJZCkgfHwge307CiAgICAgICAgICAgIGNvbnN0IHByb2YyID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnlEYXRhLnByb2YySWQpIHx8IHt9OwoKICAgICAgICAgICAgY29uc3QgaGFuZGxlRHJvcCA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgic3R1ZGVudCIpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09ICJORVdfUEFVU0UiKSB7CiAgICAgICAgICAgICAgICAgICAgb25Ecm9wU3R1ZGVudChqdXJ5SWQsIHsgaWQ6ICdORVdfUEFVU0UnIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50RGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgb25Ecm9wU3R1ZGVudChqdXJ5SWQsIHN0dWRlbnREYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8ZGl2IAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iYmctd2hpdGUgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIGZsZXggZmxleC1jb2wgdy04MCBzaHJpbmstMCBoLWZ1bGwgbWF4LWgtWzgwMHB4XSIKICAgICAgICAgICAgICAgICAgICBvbkRyYWdPdmVyPXsoZSkgPT4gZS5wcmV2ZW50RGVmYXVsdCgpfQogICAgICAgICAgICAgICAgICAgIG9uRHJvcD17aGFuZGxlRHJvcH0KICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctc2xhdGUtMTAwIHAtMyByb3VuZGVkLXQtbGcgYm9yZGVyLWIgYm9yZGVyLWdyYXktMjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWxnIHRleHQtc2xhdGUtODAwIj5KdXJ5IHtqdXJ5SWR9PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gc2V0SXNFZGl0aW5nKCFpc0VkaXRpbmcpfSBjbGFzc05hbWU9InRleHQtYmx1ZS02MDAgaG92ZXI6dGV4dC1ibHVlLTgwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEVkaXQgc2l6ZT17MTZ9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB7aXNFZGl0aW5nID8gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgZ2FwLTIgdGV4dC1zbSBtYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgdmFsdWU9e2p1cnlEYXRhLnJvb219IG9uQ2hhbmdlPXsoZSkgPT4gb25VcGRhdGVKdXJ5KGp1cnlJZCwgJ3Jvb20nLCBlLnRhcmdldC52YWx1ZSl9IGNsYXNzTmFtZT0iYm9yZGVyIHAtMSByb3VuZGVkIiBwbGFjZWhvbGRlcj0iU2FsbGUgKGV4OiBEMjEpIi8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBjbGFzc05hbWU9ImJvcmRlciBwLTEgcm91bmRlZCIgdmFsdWU9e2p1cnlEYXRhLnByb2YxSWQgfHwgJyd9IG9uQ2hhbmdlPXsoZSkgPT4gb25VcGRhdGVKdXJ5KGp1cnlJZCwgJ3Byb2YxSWQnLCBlLnRhcmdldC52YWx1ZSl9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIiPlPDqWxlY3Rpb25uZXIgUHJvZiAxPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtwcm9mcy5tYXAocCA9PiA8b3B0aW9uIGtleT17cC5pZH0gdmFsdWU9e3AuaWR9PntwLk5PTX0ge3AuUFJFTk9NfSAoe3AuTUFUSUVSRX0pPC9vcHRpb24+KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGNsYXNzTmFtZT0iYm9yZGVyIHAtMSByb3VuZGVkIiB2YWx1ZT17anVyeURhdGEucHJvZjJJZCB8fCAnJ30gb25DaGFuZ2U9eyhlKSA9PiBvblVwZGF0ZUp1cnkoanVyeUlkLCAncHJvZjJJZCcsIGUudGFyZ2V0LnZhbHVlKX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+U8OpbGVjdGlvbm5lciBQcm9mIDI8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3Byb2ZzLm1hcChwID0+IDxvcHRpb24ga2V5PXtwLmlkfSB2YWx1ZT17cC5pZH0+e3AuTk9NfSB7cC5QUkVOT019ICh7cC5NQVRJRVJFfSk8L29wdGlvbj4pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICkgOiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJmb250LXNlbWlib2xkIj5TYWxsZSA6IDxzcGFuIGNsYXNzTmFtZT0idGV4dC1ibHVlLTYwMCI+e2p1cnlEYXRhLnJvb20gfHwgJ05vbiBhc3NpZ27DqWUnfTwvc3Bhbj48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0cnVuY2F0ZSIgdGl0bGU9e3Byb2YxLk5PTSA/IGAke3Byb2YxLk5PTX0gJHtwcm9mMS5QUkVOT019YCA6ICcnfT5QMToge3Byb2YxLk5PTSB8fCAnLS0tJ30gPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LWdyYXktNTAwIHRleHQteHMiPih7cHJvZjEuTUFUSUVSRSB8fCAnPyd9KTwvc3Bhbj48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0cnVuY2F0ZSIgdGl0bGU9e3Byb2YyLk5PTSA/IGAke3Byb2YyLk5PTX0gJHtwcm9mMi5QUkVOT019YCA6ICcnfT5QMjoge3Byb2YyLk5PTSB8fCAnLS0tJ30gPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LWdyYXktNTAwIHRleHQteHMiPih7cHJvZjIuTUFUSUVSRSB8fCAnPyd9KTwvc3Bhbj48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgtMSBvdmVyZmxvdy15LWF1dG8gcC0yIHNwYWNlLXktMiBiZy1ncmF5LTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAge3N0dWRlbnRzV2l0aFRpbWUubGVuZ3RoID09PSAwICYmIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNDAwIGl0YWxpYyBweS0xMCI+R2xpc3NlciBsZXMgw6lsw6h2ZXMgaWNpPC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICB7c3R1ZGVudHNXaXRoVGltZS5tYXAoKHN0dWRlbnQsIGlkeCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDb21wYXQgPSAoZXhhbVR5cGUgPT09ICdETkInIHx8IGV4YW1UeXBlID09PSAnR08nKSA/IGNoZWNrQ29tcGF0aWJpbGl0eShzdHVkZW50LCBbcHJvZjEsIHByb2YyXSwgZXhhbVR5cGUpIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNMaW5rZWRUb1ByZXYgPSAhc3R1ZGVudC5pc0JyZWFrICYmIGlkeCA+IDAgJiYgc3R1ZGVudC50aW1lU3RhcnQgPT09IHN0dWRlbnRzV2l0aFRpbWVbaWR4LTFdLnRpbWVTdGFydDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtzdHVkZW50LmlkfSBjbGFzc05hbWU9InJlbGF0aXZlIGdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2BhYnNvbHV0ZSAtbGVmdC0yIHRvcC0yIHRleHQtWzEwcHhdIGZvbnQtbW9ubyB3LTEwIHRleHQtcmlnaHQgcHItMSAke2lzTGlua2VkVG9QcmV2ID8gJ3RleHQtYmx1ZS0zMDAnIDogJ3RleHQtZ3JheS01MDAnfWB9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2lzTGlua2VkVG9QcmV2ID8gJ+KGsycgOiBzdHVkZW50LnRpbWVTdGFydH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtbC04Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTdHVkZW50Q2FyZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHVkZW50PXtzdHVkZW50fSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPXtleGFtVHlwZX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dhYmxlPXt0cnVlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29tcGF0PXtpc0NvbXBhdH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkRyYWdTdGFydD17KGUpID0+IHsgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YSgic3R1ZGVudCIsIEpTT04uc3RyaW5naWZ5KHsuLi5zdHVkZW50LCBmcm9tSnVyeToganVyeUlkfSkpOyB9fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVXBkYXRlRHVyYXRpb249e29uVXBkYXRlU3R1ZGVudER1cmF0aW9uID8gKGlkLCBkdXJhdGlvbikgPT4gb25VcGRhdGVTdHVkZW50RHVyYXRpb24oanVyeUlkLCBpZCwgZHVyYXRpb24pIDogbnVsbH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkVkaXRFZHM9e29uRWRpdEVkc30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkdlbmVyYWxFZGl0PXtvbkdlbmVyYWxFZGl0fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImFic29sdXRlIHRvcC0xIHJpZ2h0LTEgZmxleCBnYXAtMSBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IGJnLXdoaXRlLzgwIHJvdW5kZWQtbGcgcC0wLjUgc2hhZG93LXNtIGJhY2tkcm9wLWJsdXItc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpZHggPiAwICYmIDxidXR0b24gb25DbGljaz17KCkgPT4gb25Nb3ZlU3R1ZGVudChqdXJ5SWQsIHN0dWRlbnQuaWQsIC0xKX0gY2xhc3NOYW1lPSJ0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtYmx1ZS02MDAgaG92ZXI6YmctYmx1ZS01MCByb3VuZGVkIHAtMC41Ij48Q2hldnJvblVwIHNpemU9ezE0fSAvPjwvYnV0dG9uPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7aWR4IDwgc3R1ZGVudHNXaXRoVGltZS5sZW5ndGggLSAxICYmIDxidXR0b24gb25DbGljaz17KCkgPT4gb25Nb3ZlU3R1ZGVudChqdXJ5SWQsIHN0dWRlbnQuaWQsIDEpfSBjbGFzc05hbWU9InRleHQtZ3JheS01MDAgaG92ZXI6dGV4dC1ibHVlLTYwMCBob3ZlcjpiZy1ibHVlLTUwIHJvdW5kZWQgcC0wLjUiPjxDaGV2cm9uRG93biBzaXplPXsxNH0gLz48L2J1dHRvbj59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctcHggYmctZ3JheS0yMDAgbXgtMC41Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IG9uUmVtb3ZlU3R1ZGVudChqdXJ5SWQsIHN0dWRlbnQuaWQpfSBjbGFzc05hbWU9InRleHQtcmVkLTQwMCBob3Zlcjp0ZXh0LXJlZC02MDAgaG92ZXI6YmctcmVkLTUwIHJvdW5kZWQgcC0wLjUiPjxSb3RhdGVDY3cgc2l6ZT17MTR9IC8+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICApOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IEdlbmVyYWxTdHVkZW50RWRpdE1vZGFsID0gKHsgc3R1ZGVudCwgZXhhbVR5cGUsIG9uQ2xvc2UsIG9uU2F2ZSB9KSA9PiB7CiAgICAgICAgICAgICBjb25zdCBbZm9ybURhdGEsIHNldEZvcm1EYXRhXSA9IHVzZVN0YXRlKHsgLi4uc3R1ZGVudCB9KTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUNoYW5nZSA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB7IG5hbWUsIHZhbHVlLCB0eXBlLCBjaGVja2VkIH0gPSBlLnRhcmdldDsKICAgICAgICAgICAgICAgIHNldEZvcm1EYXRhKHByZXYgPT4gKHsKICAgICAgICAgICAgICAgICAgICAuLi5wcmV2LAogICAgICAgICAgICAgICAgICAgIFtuYW1lXTogdHlwZSA9PT0gJ2NoZWNrYm94JyA/IChjaGVja2VkID8gJ09VSScgOiAnTk9OJykgOiB2YWx1ZQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmaXhlZCBpbnNldC0wIHotNTAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctYmxhY2svNTAgYmFja2Ryb3AtYmx1ci1zbSI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHJvdW5kZWQteGwgc2hhZG93LTJ4bCBwLTYgdy1bNTAwcHhdIG1heC13LWZ1bGwgbS00IGFuaW1hdGUtc2NhbGUtaW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIG1iLTQgcGItMiBib3JkZXItYiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3NOYW1lPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTgwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEVkaXQgY2xhc3NOYW1lPSJ0ZXh0LWJsdWUtNjAwIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZGlmaWVyIGxlcyBpbmZvcm1hdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e29uQ2xvc2V9IGNsYXNzTmFtZT0idGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWdyYXktNjAwIj4mdGltZXM7PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InNwYWNlLXktNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtMiBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iYmxvY2sgdGV4dC14cyBmb250LWJvbGQgdGV4dC1ncmF5LTUwMCB1cHBlcmNhc2UgbWItMSI+Tm9tPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9Ik5PTSIgdmFsdWU9e2Zvcm1EYXRhLk5PTX0gb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0gY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyIHAtMiByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWJsdWUtMjAwIG91dGxpbmUtbm9uZSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSBtYi0xIj5QcsOpbm9tPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9IlBSRU5PTSIgdmFsdWU9e2Zvcm1EYXRhLlBSRU5PTX0gb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0gY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyIHAtMiByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWJsdWUtMjAwIG91dGxpbmUtbm9uZSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJncmlkIGdyaWQtY29scy0yIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSBtYi0xIj5DbGFzc2UgKERJVik8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iRElWIiB2YWx1ZT17Zm9ybURhdGEuRElWfSBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlfSBjbGFzc05hbWU9InctZnVsbCBib3JkZXIgcC0yIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctYmx1ZS0yMDAgb3V0bGluZS1ub25lIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWVuZCBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGN1cnNvci1wb2ludGVyIGJnLXJlZC01MCBwLTIgcm91bmRlZCBib3JkZXIgYm9yZGVyLXJlZC0xMDAgdy1mdWxsIGhvdmVyOmJnLXJlZC0xMDAgdHJhbnNpdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0iY2hlY2tib3giIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9IlRUIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXtmb3JtRGF0YS5UVCA9PT0gJ09VSScgfHwgZm9ybURhdGEuVFQgPT09IHRydWUgfHwgKHR5cGVvZiBmb3JtRGF0YS5UVCA9PT0gJ3N0cmluZycgJiYgZm9ybURhdGEuVFQuaW5jbHVkZXMoJ1RJRVJTJykpfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0idy01IGgtNSB0ZXh0LXJlZC02MDAgcm91bmRlZCBmb2N1czpyaW5nLXJlZC01MDAiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtcmVkLTcwMCB0ZXh0LXNtIj5UaWVycy1UZW1wczwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgY3Vyc29yLXBvaW50ZXIgYmctYmx1ZS01MCBwLTIgcm91bmRlZCBib3JkZXIgYm9yZGVyLWJsdWUtMTAwIHctZnVsbCBob3ZlcjpiZy1ibHVlLTEwMCB0cmFuc2l0aW9uIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJjaGVja2JveCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT0iUEMiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e2Zvcm1EYXRhLlBDID09PSAnT1VJJyB8fCBmb3JtRGF0YS5QQyA9PT0gdHJ1ZX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctNSBoLTUgdGV4dC1ibHVlLTYwMCByb3VuZGVkIGZvY3VzOnJpbmctYmx1ZS01MDAiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtYmx1ZS03MDAgdGV4dC1zbSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSI+PExhcHRvcCBzaXplPXsxNH0vPiBQQzwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1wdXJwbGUtNTAgcC0zIHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1wdXJwbGUtMTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXB1cnBsZS03MDAgdXBwZXJjYXNlIG1iLTIgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEiPjxIYW5kSGVhcnQgc2l6ZT17MTJ9Lz4gQWNjb21wYWduZW1lbnQgKEFFU0gpPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtMiBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iQUVTSF9OT00iIHZhbHVlPXtmb3JtRGF0YS5BRVNIX05PTSB8fCAnJ30gb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0gY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyIGJvcmRlci1wdXJwbGUtMjAwIHAtMiByb3VuZGVkIHRleHQtc20gcGxhY2Vob2xkZXItcHVycGxlLTMwMCBmb2N1czpvdXRsaW5lLW5vbmUgZm9jdXM6Ym9yZGVyLXB1cnBsZS00MDAiIHBsYWNlaG9sZGVyPSJOb20gQUVTSCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iQUVTSF9QUkVOT00iIHZhbHVlPXtmb3JtRGF0YS5BRVNIX1BSRU5PTSB8fCAnJ30gb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0gY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyIGJvcmRlci1wdXJwbGUtMjAwIHAtMiByb3VuZGVkIHRleHQtc20gcGxhY2Vob2xkZXItcHVycGxlLTMwMCBmb2N1czpvdXRsaW5lLW5vbmUgZm9jdXM6Ym9yZGVyLXB1cnBsZS00MDAiIHBsYWNlaG9sZGVyPSJQcsOpbm9tIEFFU0giIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAge2V4YW1UeXBlID09PSAnRE5CJyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSBtYi0xIj5Hcm91cGU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJHUk9VUEUiIHZhbHVlPXtmb3JtRGF0YS5HUk9VUEUgfHwgJyd9IG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2V9IGNsYXNzTmFtZT0idy1mdWxsIGJvcmRlciBwLTIgcm91bmRlZCBwbGFjZWhvbGRlci1ncmF5LTMwMCIgcGxhY2Vob2xkZXI9ImV4OiBHMSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSBtYi0xIj5MYW5ndWU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJMQU5HVUUiIHZhbHVlPXtmb3JtRGF0YS5MQU5HVUUgfHwgJyd9IG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2V9IGNsYXNzTmFtZT0idy1mdWxsIGJvcmRlciBwLTIgcm91bmRlZCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQteHMgZm9udC1ib2xkIHRleHQtZ3JheS01MDAgdXBwZXJjYXNlIG1iLTEiPlBhcmNvdXJzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJQQVJDT1VSUyIgdmFsdWU9e2Zvcm1EYXRhLlBBUkNPVVJTIHx8ICcnfSBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlfSBjbGFzc05hbWU9InctZnVsbCBib3JkZXIgcC0yIHJvdW5kZWQiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZXhhbVR5cGUgPT09ICdHTycgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQteHMgZm9udC1ib2xkIHRleHQtZ3JheS01MDAgdXBwZXJjYXNlIG1iLTEiPkVuc2VpZ25lbWVudCBkZSBTcMOpY2lhbGl0w6kgKEVEUyk8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IG5hbWU9IkVEUyIgdmFsdWU9e2Zvcm1EYXRhLkVEUyB8fCAnJ30gb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0gY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyIHAtMiByb3VuZGVkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+LS0gU8OpbGVjdGlvbm5lciAtLTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge09iamVjdC52YWx1ZXMoRURTX0xJU1QpLmZsYXQoKS5tYXAoZWRzID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIGtleT17ZWRzfSB2YWx1ZT17ZWRzfT57ZWRzfTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWVuZCBnYXAtMyBtdC02IHB0LTQgYm9yZGVyLXQgYm9yZGVyLWdyYXktMTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17b25DbG9zZX0gY2xhc3NOYW1lPSJweC00IHB5LTIgdGV4dC1zbGF0ZS02MDAgaG92ZXI6Ymctc2xhdGUtMTAwIHJvdW5kZWQtbGcgZm9udC1tZWRpdW0iPkFubnVsZXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gb25TYXZlKGZvcm1EYXRhKX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJweC00IHB5LTIgYmctYmx1ZS02MDAgaG92ZXI6YmctYmx1ZS03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIGZvbnQtYm9sZCBzaGFkb3ctbGcgc2hhZG93LWJsdWUtMjAwIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTYXZlIHNpemU9ezE2fSAvPiBFbnJlZ2lzdHJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgU3R1ZGVudEVkaXRNb2RhbCA9ICh7IHN0dWRlbnQsIG9uQ2xvc2UsIG9uU2F2ZSB9KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IFtzZWxlY3RlZEVkcywgc2V0U2VsZWN0ZWRFZHNdID0gdXNlU3RhdGUoc3R1ZGVudC5FRFMgfHwgJycpOwoKICAgICAgICAgICAgaWYgKCFzdHVkZW50KSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJnLWJsYWNrLzUwIGJhY2tkcm9wLWJsdXItc20iPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy13aGl0ZSByb3VuZGVkLXhsIHNoYWRvdy0yeGwgcC02IHctWzUwMHB4XSBtYXgtdy1mdWxsIG0tNCBhbmltYXRlLXNjYWxlLWluIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzTmFtZT0idGV4dC14bCBmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm9va09wZW4gY2xhc3NOYW1lPSJ0ZXh0LXJvc2UtNjAwIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hvaXNpciBFRFMgLSB7c3R1ZGVudC5OT019IHtzdHVkZW50LlBSRU5PTX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9oMj4KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJvdmVyZmxvdy15LWF1dG8gbWF4LWgtWzYwdmhdIHByLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAge09iamVjdC5lbnRyaWVzKEVEU19MSVNUKS5tYXAoKFtjYXRlZ29yeSwgb3B0aW9uc10pID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGtleT17Y2F0ZWdvcnl9IGNsYXNzTmFtZT0ibWItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtc20gZm9udC1ib2xkIHRleHQtc2xhdGUtNTAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlciBtYi0yIGJvcmRlci1iIHBiLTEiPntjYXRlZ29yeX08L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtMSBnYXAtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7b3B0aW9ucy5tYXAoZWRzID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwga2V5PXtlZHN9IGNsYXNzTmFtZT17YGZsZXggaXRlbXMtY2VudGVyIGdhcC0zIHAtMiByb3VuZGVkIGN1cnNvci1wb2ludGVyIHRyYW5zaXRpb24tY29sb3JzICR7c2VsZWN0ZWRFZHMgPT09IGVkcyA/ICdiZy1yb3NlLTEwMCBib3JkZXIgYm9yZGVyLXJvc2UtMzAwJyA6ICdob3ZlcjpiZy1ncmF5LTUwIGJvcmRlciBib3JkZXItdHJhbnNwYXJlbnQnfWB9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJyYWRpbyIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSJlZHMiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2Vkc30gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXtzZWxlY3RlZEVkcyA9PT0gZWRzfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoKSA9PiBzZXRTZWxlY3RlZEVkcyhlZHMpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ3LTQgaC00IHRleHQtcm9zZS02MDAgZm9jdXM6cmluZy1yb3NlLTUwMCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtc2xhdGUtNzAwIj57ZWRzfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgganVzdGlmeS1lbmQgZ2FwLTMgbXQtNiBwdC00IGJvcmRlci10IGJvcmRlci1ncmF5LTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e29uQ2xvc2V9IGNsYXNzTmFtZT0icHgtNCBweS0yIHRleHQtc2xhdGUtNjAwIGhvdmVyOmJnLXNsYXRlLTEwMCByb3VuZGVkLWxnIGZvbnQtbWVkaXVtIj5Bbm51bGVyPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG9uU2F2ZShzdHVkZW50LmlkLCBzZWxlY3RlZEVkcyl9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0icHgtNCBweS0yIGJnLXJvc2UtNjAwIGhvdmVyOmJnLXJvc2UtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LWJvbGQgc2hhZG93LWxnIHNoYWRvdy1yb3NlLTIwMCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbnJlZ2lzdHJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgU2F2ZU1vZGFsID0gKHsgZmlsZU5hbWUsIHNldEZpbGVOYW1lLCBvbkNsb3NlLCBvbkNvbmZpcm0gfSkgPT4gKAogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZml4ZWQgaW5zZXQtMCB6LVs3MF0gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctYmxhY2svNTAgYmFja2Ryb3AtYmx1ci1zbSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcm91bmRlZC14bCBzaGFkb3ctMnhsIHAtNiB3LVs0MDBweF0gYW5pbWF0ZS1zY2FsZS1pbiI+CiAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzTmFtZT0idGV4dC14bCBmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxTYXZlIHNpemU9ezIwfSBjbGFzc05hbWU9InRleHQtYmx1ZS02MDAiLz4KICAgICAgICAgICAgICAgICAgICAgICAgU2F1dmVnYXJkZXIgbGVzIGRvbm7DqWVzCiAgICAgICAgICAgICAgICAgICAgPC9oMz4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtc20gdGV4dC1zbGF0ZS02MDAgbWItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgIE5vbW1leiB2b3RyZSBmaWNoaWVyIGRlIHNhdXZlZ2FyZGUgcG91ciBsZSByZXRyb3V2ZXIgcGx1cyBmYWNpbGVtZW50IChleDogRE5CX0p1aW5fMjAyNikuCiAgICAgICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iYmxvY2sgdGV4dC14cyBmb250LWJvbGQgdGV4dC1zbGF0ZS01MDAgdXBwZXJjYXNlIG1iLTEiPk5vbSBkdSBmaWNoaWVyPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0idGV4dCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17ZmlsZU5hbWV9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRGaWxlTmFtZShlLnRhcmdldC52YWx1ZSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBib3JkZXItMiBib3JkZXItYmx1ZS0xMDAgcC0yIHJvdW5kZWQtbGcgZm9jdXM6Ym9yZGVyLWJsdWUtNTAwIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWJsdWUtMjAwIG91dGxpbmUtbm9uZSBmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvRm9jdXMKICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteHMgdGV4dC1yaWdodCB0ZXh0LWdyYXktNDAwIG10LTEiPi5qc29uIHNlcmEgYWpvdXTDqSBhdXRvbWF0aXF1ZW1lbnQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWVuZCBnYXAtMyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17b25DbG9zZX0gY2xhc3NOYW1lPSJweC00IHB5LTIgdGV4dC1zbGF0ZS02MDAgaG92ZXI6Ymctc2xhdGUtMTAwIHJvdW5kZWQtbGcgZm9udC1tZWRpdW0iPkFubnVsZXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtvbkNvbmZpcm19IGNsYXNzTmFtZT0icHgtNCBweS0yIGJnLWJsdWUtNjAwIGhvdmVyOmJnLWJsdWUtNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LWJvbGQgc2hhZG93LWxnIHNoYWRvdy1ibHVlLTIwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RG93bmxvYWQgc2l6ZT17MTZ9IC8+IFTDqWzDqWNoYXJnZXIKICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgKTsKCiAgICAgICAgY29uc3QgVGVtcGxhdGVFZGl0b3IgPSAoeyBtb2RlLCB0ZW1wbGF0ZSwgb25DbG9zZSwgb25TYXZlIH0pID0+IHsKICAgICAgICAgICAgIGNvbnN0IFtkYXRhLCBzZXREYXRhXSA9IHVzZVN0YXRlKHsgLi4udGVtcGxhdGUgfSk7CgogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZpeGVkIGluc2V0LTAgei1bNjBdIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJnLWJsYWNrLzYwIGJhY2tkcm9wLWJsdXItc20gcC00Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcm91bmRlZC0yeGwgc2hhZG93LTJ4bCB3LWZ1bGwgbWF4LXctMnhsIG1heC1oLVs5MHZoXSBmbGV4IGZsZXgtY29sIGFuaW1hdGUtc2NhbGUtaW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icC01IGJvcmRlci1iIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBiZy1zbGF0ZS01MCByb3VuZGVkLXQtMnhsIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzc05hbWU9InRleHQteGwgZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RWRpdCBzaXplPXsyMH0gY2xhc3NOYW1lPSJ0ZXh0LWluZGlnby02MDAiLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDDiWRpdGVyIGxlIG1vZMOobGUgOiB7bW9kZSA9PT0gJ1NUVURFTlRTJyA/ICfDiWzDqHZlcycgOiBtb2RlID09PSAnUFJPRlMnID8gJ1Byb2Zlc3NldXJzJyA6ICdBRVNIJ30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e29uQ2xvc2V9IGNsYXNzTmFtZT0idGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWdyYXktNjAwIHRleHQtMnhsIj4mdGltZXM7PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgtMSBvdmVyZmxvdy15LWF1dG8gcC02IHNwYWNlLXktNiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctaW5kaWdvLTUwIGJvcmRlciBib3JkZXItaW5kaWdvLTEwMCBwLTQgcm91bmRlZC1sZyB0ZXh0LXNtIHRleHQtaW5kaWdvLTgwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5WYXJpYWJsZXMgZGlzcG9uaWJsZXMgOjwvc3Ryb25nPiB7J3tFUFJFVVZFfSd9LCB7J3tTRVNTSU9OfSd9LCB7J3tWSUxMRX0nfSwgeyd7REFURV9KT1VSfSd9LCB7J3tEQVRFX0VYQU19J30sIHsne0VUQUJMSVNTRU1FTlR9J30sIHsne05PTX0nfSwgeyd7UFJFTk9NfSd9LiA8YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttb2RlID09PSAnUFJPRlMnICYmIDxzcGFuPlNww6ljaWZpcXVlIFByb2ZzIDogeyd7Q0lWfSd9LCB7J3tIRVVSRV9ERUJVVH0nfS48L3NwYW4+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttb2RlID09PSAnU1RVREVOVFMnICYmIDxzcGFuPlNww6ljaWZpcXVlIMOJbMOodmVzIDogeyd7U0FMTEV9J30sIHsne0hFVVJFfSd9Ljwvc3Bhbj59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyLz48c3BhbiBjbGFzc05hbWU9InRleHQteHMgb3BhY2l0eS03NSBtdC0xIGJsb2NrIj5VdGlsaXNleiAqKnRleHRlKiogcG91ciBtZXR0cmUgZW4gZ3Jhcy48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQteHMgZm9udC1ib2xkIHRleHQtZ3JheS01MDAgdXBwZXJjYXNlIG1iLTEiPlRpdHJlIHByaW5jaXBhbDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJ0ZXh0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2RhdGEudGl0bGV9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17ZSA9PiBzZXREYXRhKHsuLi5kYXRhLCB0aXRsZTogZS50YXJnZXQudmFsdWV9KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyIHAtMiByb3VuZGVkIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWluZGlnby0yMDAgb3V0bGluZS1ub25lIGZvbnQtYm9sZCB0ZXh0LWxnIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImJsb2NrIHRleHQteHMgZm9udC1ib2xkIHRleHQtZ3JheS01MDAgdXBwZXJjYXNlIG1iLTEiPkludHJvZHVjdGlvbjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17ZGF0YS5pbnRyb30gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtlID0+IHNldERhdGEoey4uLmRhdGEsIGludHJvOiBlLnRhcmdldC52YWx1ZX0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBib3JkZXIgcC0yIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctaW5kaWdvLTIwMCBvdXRsaW5lLW5vbmUgaC0zMiByZXNpemUtbm9uZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSBtYi0xIj5JbnN0cnVjdGlvbnMgLyBDb25zaWduZXM8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2RhdGEuaW5zdHJ1Y3Rpb25zfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2UgPT4gc2V0RGF0YSh7Li4uZGF0YSwgaW5zdHJ1Y3Rpb25zOiBlLnRhcmdldC52YWx1ZX0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBib3JkZXIgcC0yIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctaW5kaWdvLTIwMCBvdXRsaW5lLW5vbmUgaC00MCByZXNpemUtbm9uZSBmb250LW1vbm8gdGV4dC1zbSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSBtYi0xIj5QaWVkIGRlIHBhZ2UgKFNpZ25hdHVyZSk8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2RhdGEuZm9vdGVyfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2UgPT4gc2V0RGF0YSh7Li4uZGF0YSwgZm9vdGVyOiBlLnRhcmdldC52YWx1ZX0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBib3JkZXIgcC0yIHJvdW5kZWQgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctaW5kaWdvLTIwMCBvdXRsaW5lLW5vbmUgaC0yNCByZXNpemUtbm9uZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InAtNSBib3JkZXItdCBiZy1ncmF5LTUwIHJvdW5kZWQtYi0yeGwgZmxleCBqdXN0aWZ5LWVuZCBnYXAtMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e29uQ2xvc2V9IGNsYXNzTmFtZT0icHgtNCBweS0yIHRleHQtc2xhdGUtNjAwIGhvdmVyOmJnLXNsYXRlLTIwMCByb3VuZGVkLWxnIj5Bbm51bGVyPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IG9uU2F2ZShkYXRhKX0gY2xhc3NOYW1lPSJweC02IHB5LTIgYmctaW5kaWdvLTYwMCBob3ZlcjpiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBmb250LWJvbGQgc2hhZG93LWxnIHNoYWRvdy1pbmRpZ28tMjAwIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U2F2ZSBzaXplPXsxOH0gLz4gU2F1dmVnYXJkZXIgbGUgbW9kw6hsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgUHJpbnRWaWV3ID0gKHsganVyaWVzLCBwcm9mcywgZXhhbVR5cGUsIG9uQ2xvc2UsIHNldHRpbmdzLCBzY2hvb2xOYW1lLCBzY2hvb2xDaXR5LCBzY2hvb2xMb2dvLCBzY2hvb2xTdGFtcCwgc2Vzc2lvblllYXIsIHRlbXBsYXRlcywgc2V0VGVtcGxhdGVzIH0pID0+IHsKICAgICAgICAgICAgY29uc3QgW3ZpZXdNb2RlLCBzZXRWaWV3TW9kZV0gPSB1c2VTdGF0ZSgnU1RVREVOVFMnKTsgCiAgICAgICAgICAgIGNvbnN0IFtzaG93VGVtcGxhdGVFZGl0b3IsIHNldFNob3dUZW1wbGF0ZUVkaXRvcl0gPSB1c2VTdGF0ZShmYWxzZSk7CgogICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBzZXR0aW5ncz8uc3RhcnRUaW1lIHx8ICcwODowMCc7CiAgICAgICAgICAgIGNvbnN0IGV4YW1EYXRlID0gc2V0dGluZ3M/LmRhdGUgPyBmb3JtYXREYXRlKHNldHRpbmdzLmRhdGUpIDogIkRhdGUgbm9uIGTDqWZpbmllIjsKCiAgICAgICAgICAgIGNvbnN0IGN1c3RvbVRpdGxlID0gc2V0dGluZ3M/LmV4YW1OYW1lIHx8ICIiOwogICAgICAgICAgICBjb25zdCBkZWZhdWx0TGFiZWwgPSBleGFtVHlwZSA9PT0gJ0dPJyA/ICdHUkFORCBPUkFMIEJMQU5DJyA6IGAke2V4YW1UeXBlfSBCTEFOQ2A7CiAgICAgICAgICAgIGNvbnN0IGV4YW1MYWJlbCA9IGN1c3RvbVRpdGxlLnRyaW0oKSA/IGN1c3RvbVRpdGxlIDogZGVmYXVsdExhYmVsOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZXhhbUZ1bGxOYW1lID0gY3VzdG9tVGl0bGUudHJpbSgpID8gY3VzdG9tVGl0bGUgOiAoZXhhbVR5cGUgPT09ICdETkInID8gJ0RpcGzDtG1lIE5hdGlvbmFsIGR1IEJyZXZldCBCbGFuYycgOiBleGFtVHlwZSA9PT0gJ0dPJyA/ICdHcmFuZCBPcmFsIGR1IEJhY2NhbGF1csOpYXQgQmxhbmMnIDogJ0NlcnRpZmljYXQgZGUgRm9ybWF0aW9uIEfDqW7DqXJhbGUgQmxhbmMnKTsKICAgICAgICAgICAgY29uc3QgZXhhbUxhYmVsTWl4ZWQgPSBjdXN0b21UaXRsZS50cmltKCkgPyBjdXN0b21UaXRsZSA6IChleGFtVHlwZSA9PT0gJ0dPJyA/ICdHcmFuZCBPcmFsIEJsYW5jJyA6IGAke2V4YW1UeXBlfSBCbGFuY2ApOwoKICAgICAgICAgICAgY29uc3QgcmVuZGVyVGVtcGxhdGVUZXh0ID0gKHRleHQsIGRhdGEpID0+IHsKICAgICAgICAgICAgICAgIGlmICghdGV4dCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9IHRleHQ7CiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIHN0YW5kYXJkIHZhcmlhYmxlcwogICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgeyR7a2V5fX1gLCAnZycpOwogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UocmVnZXgsIGRhdGFba2V5XSB8fCAnJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2ltcGxlIHBhcnNlciBmb3IgKipib2xkKioKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gY29udGVudC5zcGxpdCgvKFwqXCouKj9cKlwqKS9nKTsKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9IndoaXRlc3BhY2UtcHJlLWxpbmUiPgogICAgICAgICAgICAgICAgICAgICAgICB7cGFydHMubWFwKChwYXJ0LCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydC5zdGFydHNXaXRoKCcqKicpICYmIHBhcnQuZW5kc1dpdGgoJyoqJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPHN0cm9uZyBrZXk9e2l9PntwYXJ0LnNsaWNlKDIsIC0yKX08L3N0cm9uZz47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPHNwYW4ga2V5PXtpfT57cGFydH08L3NwYW4+OwogICAgICAgICAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVTYXZlVGVtcGxhdGUgPSAobmV3VGVtcGxhdGUpID0+IHsKICAgICAgICAgICAgICAgIHNldFRlbXBsYXRlcyhwcmV2ID0+ICh7CiAgICAgICAgICAgICAgICAgICAgLi4ucHJldiwKICAgICAgICAgICAgICAgICAgICBbdmlld01vZGVdOiBuZXdUZW1wbGF0ZQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgc2V0U2hvd1RlbXBsYXRlRWRpdG9yKGZhbHNlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGdldEFsbEFzc2lnbmVkU3R1ZGVudHMgPSAodHlwZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEp1cmllcyA9IGp1cmllc1t0eXBlXSB8fCB7fTsKICAgICAgICAgICAgICAgIGxldCBhbGwgPSBbXTsKICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMoY3VycmVudEp1cmllcykuZm9yRWFjaChqdXJ5ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9mMSA9IHByb2ZzLmZpbmQocCA9PiBwLmlkID09PSBqdXJ5LnByb2YxSWQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2YyID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnkucHJvZjJJZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZWRTdHVkZW50cyA9IGNhbGN1bGF0ZVN0dWRlbnRUaW1lcyhqdXJ5LnN0dWRlbnRzLCBzdGFydFRpbWUsIHR5cGUpOwogICAgICAgICAgICAgICAgICAgIHRpbWVkU3R1ZGVudHMuZm9yRWFjaChzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzLmlzQnJlYWspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp1cnlJZDoganVyeS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tOiBqdXJ5LnJvb20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogcy50aW1lU3RhcnQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2YxOiBwcm9mMSA/IGAke3Byb2YxLk5PTX0gJHtwcm9mMS5QUkVOT019YCA6ICdOb24gYXNzaWduw6knLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2YyOiBwcm9mMiA/IGAke3Byb2YyLk5PTX0gJHtwcm9mMi5QUkVOT019YCA6ICdOb24gYXNzaWduw6knCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYWxsLnNvcnQoKGEsYikgPT4gYS5OT00ubG9jYWxlQ29tcGFyZShiLk5PTSkpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgZ2V0UHJvZkFzc2lnbm1lbnRzID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYXNzaWdubWVudHMgPSBbXTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRKdXJpZXMgPSBqdXJpZXNbZXhhbVR5cGVdIHx8IHt9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGN1cnJlbnRKdXJpZXMpLmZvckVhY2goanVyeSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGp1cnkucHJvZjFJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcHJvZnMuZmluZCh4ID0+IHguaWQgPT09IGp1cnkucHJvZjFJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwKSBhc3NpZ25tZW50cy5wdXNoKHsgLi4ucCwganVyeUlkOiBqdXJ5LmlkLCByb29tOiBqdXJ5LnJvb20sIHJvbGU6ICdFeGFtaW5hdGV1ciAxJyB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGp1cnkucHJvZjJJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcHJvZnMuZmluZCh4ID0+IHguaWQgPT09IGp1cnkucHJvZjJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwKSBhc3NpZ25tZW50cy5wdXNoKHsgLi4ucCwganVyeUlkOiBqdXJ5LmlkLCByb29tOiBqdXJ5LnJvb20sIHJvbGU6ICdFeGFtaW5hdGV1ciAyJyB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBhc3NpZ25tZW50cy5zb3J0KChhLGIpID0+IGEuTk9NLmxvY2FsZUNvbXBhcmUoYi5OT00pKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGdldEFlc2hBc3NpZ25tZW50cyA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGFzc2lnbm1lbnRzID0ge307CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SnVyaWVzID0ganVyaWVzW2V4YW1UeXBlXSB8fCB7fTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZFN0dWRlbnRJZHMgPSBuZXcgU2V0KCk7IAogICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkU3R1ZGVudE5hbWVzID0gbmV3IFNldCgpOyAvLyBTYWZldHkgbmV0IGZvciBkaXN0aW5jdCBJRHMgYnV0IHNhbWUgbmFtZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGN1cnJlbnRKdXJpZXMpLmZvckVhY2goanVyeSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZWRTdHVkZW50cyA9IGNhbGN1bGF0ZVN0dWRlbnRUaW1lcyhqdXJ5LnN0dWRlbnRzLCBzdGFydFRpbWUsIGV4YW1UeXBlKTsKICAgICAgICAgICAgICAgICAgICB0aW1lZFN0dWRlbnRzLmZvckVhY2gocyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcy5pc0JyZWFrICYmIHMuQUVTSF9OT00pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIElECiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc2VkU3R1ZGVudElkcy5oYXMocy5pZCkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgTmFtZSAoU2FmZXR5IG5ldCBmb3IgZHVwbGljYXRlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVLZXkgPSBgJHtzLk5PTX0tJHtzLlBSRU5PTX1gLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc2VkU3R1ZGVudE5hbWVzLmhhcyhuYW1lS2V5KSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZFN0dWRlbnRJZHMuYWRkKHMuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkU3R1ZGVudE5hbWVzLmFkZChuYW1lS2V5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhZXNoTm9tID0gKHMuQUVTSF9OT00gfHwgJycpLnRyaW0oKS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWVzaFByZW5vbSA9IChzLkFFU0hfUFJFTk9NIHx8ICcnKS50cmltKCkudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGAke2Flc2hOb219ICR7YWVzaFByZW5vbX1gLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFrZXkpIHJldHVybjsgLy8gU2tpcCBpZiBubyBuYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhc3NpZ25tZW50c1trZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudHNba2V5XSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9tOiAocy5BRVNIX05PTSB8fCAnJykudHJpbSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVub206IChzLkFFU0hfUFJFTk9NIHx8ICcnKS50cmltKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pc3Npb25zOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50c1trZXldLm1pc3Npb25zLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnQ6IHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogcy50aW1lU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbToganVyeS5yb29tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp1cnlJZDoganVyeS5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGFzc2lnbm1lbnRzKS5mb3JFYWNoKGEgPT4gewogICAgICAgICAgICAgICAgICAgIGEubWlzc2lvbnMuc29ydCgoeCwgeSkgPT4geC50aW1lLmxvY2FsZUNvbXBhcmUoeS50aW1lKSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhhc3NpZ25tZW50cykuc29ydCgoYSxiKSA9PiBhLm5vbS5sb2NhbGVDb21wYXJlKGIubm9tKSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBzdHVkZW50c1RvUHJpbnQgPSBnZXRBbGxBc3NpZ25lZFN0dWRlbnRzKGV4YW1UeXBlKTsKICAgICAgICAgICAgY29uc3QgcHJvZkFzc2lnbm1lbnRzID0gZ2V0UHJvZkFzc2lnbm1lbnRzKCk7CiAgICAgICAgICAgIGNvbnN0IGFlc2hBc3NpZ25tZW50cyA9IGdldEFlc2hBc3NpZ25tZW50cygpOwogICAgICAgICAgICBjb25zdCBhY3RpdmVKdXJpZXMgPSBPYmplY3QudmFsdWVzKGp1cmllc1tleGFtVHlwZV0gfHwge30pLmZpbHRlcihqID0+IGoucHJvZjFJZCB8fCBqLnByb2YySWQgfHwgai5zdHVkZW50cy5sZW5ndGggPiAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICAvKiBMb2dpYyBmb3IgR2VuZXJhbCBQbGFubmluZyAoTGFuZHNjYXBlKSAqLwogICAgICAgICAgICBjb25zdCBnZXRHZW5lcmFsUGxhbm5pbmdEYXRhID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdGltZXMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBqdXJpZXNEYXRhID0gW107CgogICAgICAgICAgICAgICAgYWN0aXZlSnVyaWVzLmZvckVhY2goanVyeSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudHNXaXRoVGltZSA9IGNhbGN1bGF0ZVN0dWRlbnRUaW1lcyhqdXJ5LnN0dWRlbnRzLCBzdGFydFRpbWUsIGV4YW1UeXBlKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50c01hcCA9IHt9OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzV2l0aFRpbWUuZm9yRWFjaChzID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzLmlzQnJlYWspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzLmFkZChzLnRpbWVTdGFydCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHVkZW50c01hcFtzLnRpbWVTdGFydF0gPSBzOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIGJyZWFrIHRpbWVzIGluIHRpbWVsaW5lPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGdlbmVyYWwgcGxhbm5pbmcsIHdlIHVzdWFsbHkgbGlzdCBicmVha3Mgb3IgZW1wdHkgc2xvdHMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQncyBqdXN0IGtleSBicmVha3MgYnkgc3RhcnQgdGltZSB0b28KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzLmFkZChzLnRpbWVTdGFydCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHVkZW50c01hcFtzLnRpbWVTdGFydF0gPSBzOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGp1cmllc0RhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBqdXJ5LmlkLAogICAgICAgICAgICAgICAgICAgICAgICByb29tOiBqdXJ5LnJvb20sCiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzTWFwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBTb3J0IHRpbWVzCiAgICAgICAgICAgICAgICBjb25zdCBzb3J0ZWRUaW1lcyA9IEFycmF5LmZyb20odGltZXMpLnNvcnQoKTsKCiAgICAgICAgICAgICAgICAvLyBTcGxpdCBqdXJpZXMgaW50byBjaHVua3Mgb2YgNiBtYXggcGVyIHBhZ2UKICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rU2l6ZSA9IDY7CiAgICAgICAgICAgICAgICBjb25zdCBqdXJ5Q2h1bmtzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGp1cmllc0RhdGEubGVuZ3RoOyBpICs9IGNodW5rU2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGp1cnlDaHVua3MucHVzaChqdXJpZXNEYXRhLnNsaWNlKGksIGkgKyBjaHVua1NpemUpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4geyBzb3J0ZWRUaW1lcywganVyeUNodW5rcyB9OwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgU2lkZWJhckJ1dHRvbiA9ICh7IG1vZGUsIGljb246IEljb24sIGxhYmVsLCBvbkNsaWNrLCBpc0FjdGl2ZSB9KSA9PiAoCiAgICAgICAgICAgICAgICA8YnV0dG9uIAogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e29uQ2xpY2t9IAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YHctZnVsbCB0ZXh0LWxlZnQgcHgtNCBweS0zIHJvdW5kZWQtbGcgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMgZm9udC1ib2xkIHRyYW5zaXRpb24tYWxsICR7aXNBY3RpdmUgPyAnYmctaW5kaWdvLTYwMCB0ZXh0LXdoaXRlIHNoYWRvdy1sZyBzaGFkb3ctaW5kaWdvLTUwMC8zMCcgOiAndGV4dC1zbGF0ZS0zMDAgaG92ZXI6Ymctc2xhdGUtODAwIGhvdmVyOnRleHQtd2hpdGUnfWB9CiAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgPEljb24gc2l6ZT17MTh9IC8+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4+e2xhYmVsfTwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICApOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmaXhlZCBpbnNldC0wIGJnLXNsYXRlLTkwMCB6LTUwIGZsZXggcHJpbnQtbW9kYWwgb3ZlcmZsb3ctaGlkZGVuIj4KICAgICAgICAgICAgICAgICAgICB7LyogU0lERUJBUiAoR2F1Y2hlKSAtIE1hc3F1w6llIMOgIGwnaW1wcmVzc2lvbiAqL30KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy03MiBiZy1zbGF0ZS05MDAgdGV4dC13aGl0ZSBmbGV4IGZsZXgtY29sIGgtZnVsbCBib3JkZXItciBib3JkZXItc2xhdGUtODAwIHNoYWRvdy0yeGwgcHJpbnQtc2lkZWJhciBmbGV4LXNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgey8qIEhlYWRlciBTaWRlYmFyICovfQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icC02IGJvcmRlci1iIGJvcmRlci1zbGF0ZS04MDAgYmctc2xhdGUtOTUwLzUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyBtYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctaW5kaWdvLTUwMC8yMCBwLTIgcm91bmRlZC1sZyI+PFByaW50ZXIgc2l6ZT17MjR9IGNsYXNzTmFtZT0idGV4dC1pbmRpZ28tNDAwIiAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzc05hbWU9InRleHQteGwgZm9udC1ibGFjayB0cmFja2luZy10aWdodCI+SU1QUkVTU0lPTjwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtc2xhdGUtNDAwIGZvbnQtbWVkaXVtIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3QgcGwtMSI+e2V4YW1MYWJlbH0ge3Nlc3Npb25ZZWFyfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBNZW51IE5hdmlnYXRpb24gKi99CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4LTEgb3ZlcmZsb3cteS1hdXRvIHAtNCBzcGFjZS15LTIgY3VzdG9tLXNjcm9sbGJhciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyBmb250LWJvbGQgdGV4dC1zbGF0ZS01MDAgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVyIG1iLTIgbXQtMiBweC0yIj5Eb2N1bWVudHM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTaWRlYmFyQnV0dG9uIG1vZGU9IlNUVURFTlRTIiBpY29uPXtVc2Vyc30gbGFiZWw9IkNvbnZvY2F0aW9ucyDDiWzDqHZlcyIgaXNBY3RpdmU9e3ZpZXdNb2RlID09PSAnU1RVREVOVFMnfSBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnU1RVREVOVFMnKX0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTaWRlYmFyQnV0dG9uIG1vZGU9IlBST0ZTIiBpY29uPXtVc2Vyc30gbGFiZWw9IkNvbnZvY2F0aW9ucyBQcm9mcyIgaXNBY3RpdmU9e3ZpZXdNb2RlID09PSAnUFJPRlMnfSBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnUFJPRlMnKX0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTaWRlYmFyQnV0dG9uIG1vZGU9IkFFU0giIGljb249e0hhbmRIZWFydH0gbGFiZWw9Ik1pc3Npb25zIEFFU0giIGlzQWN0aXZlPXt2aWV3TW9kZSA9PT0gJ0FFU0gnfSBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnQUVTSCcpfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyBmb250LWJvbGQgdGV4dC1zbGF0ZS01MDAgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVyIG1iLTIgbXQtNiBweC0yIj5KdXJ5cyAmIFNhbGxlczwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPFNpZGViYXJCdXR0b24gbW9kZT0iUFYiIGljb249e0ZpbGVUZXh0fSBsYWJlbD0iUHJvY8OocyBWZXJiYXV4IiBpc0FjdGl2ZT17dmlld01vZGUgPT09ICdQVid9IG9uQ2xpY2s9eygpID0+IHNldFZpZXdNb2RlKCdQVicpfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPFNpZGViYXJCdXR0b24gbW9kZT0iUE9DSEVUVEVTIiBpY29uPXtGb2xkZXJ9IGxhYmVsPSJQb2NoZXR0ZXMgSnVyeSIgaXNBY3RpdmU9e3ZpZXdNb2RlID09PSAnUE9DSEVUVEVTJ30gb25DbGljaz17KCkgPT4gc2V0Vmlld01vZGUoJ1BPQ0hFVFRFUycpfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPFNpZGViYXJCdXR0b24gbW9kZT0iSlVSSUVTIiBpY29uPXtDYWxlbmRhcn0gbGFiZWw9IlBsYW5uaW5ncyBKdXJ5IiBpc0FjdGl2ZT17dmlld01vZGUgPT09ICdKVVJJRVMnfSBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnSlVSSUVTJyl9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U2lkZWJhckJ1dHRvbiBtb2RlPSJHRU5FUkFMIiBpY29uPXtHcmlkfSBsYWJlbD0iUGxhbm5pbmcgR8OpbsOpcmFsIiBpc0FjdGl2ZT17dmlld01vZGUgPT09ICdHRU5FUkFMJ30gb25DbGljaz17KCkgPT4gc2V0Vmlld01vZGUoJ0dFTkVSQUwnKX0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteHMgZm9udC1ib2xkIHRleHQtc2xhdGUtNTAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlciBtYi0yIG10LTYgcHgtMiI+QWRtaW5pc3RyYXRpb248L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTaWRlYmFyQnV0dG9uIG1vZGU9Ik5PVEFUSU9OIiBpY29uPXtDbGlwYm9hcmRMaXN0fSBsYWJlbD0iRmV1aWxsZXMgZGUgTm90ZXMiIGlzQWN0aXZlPXt2aWV3TW9kZSA9PT0gJ05PVEFUSU9OJ30gb25DbGljaz17KCkgPT4gc2V0Vmlld01vZGUoJ05PVEFUSU9OJyl9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U2lkZWJhckJ1dHRvbiBtb2RlPSJFTUFSR0VNRU5UIiBpY29uPXtDaGVja0NpcmNsZX0gbGFiZWw9IsOJbWFyZ2VtZW50IiBpc0FjdGl2ZT17dmlld01vZGUgPT09ICdFTUFSR0VNRU5UJ30gb25DbGljaz17KCkgPT4gc2V0Vmlld01vZGUoJ0VNQVJHRU1FTlQnKX0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICB7LyogRm9vdGVyIEFjdGlvbnMgKi99CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJwLTQgYm9yZGVyLXQgYm9yZGVyLXNsYXRlLTgwMCBiZy1zbGF0ZS05NTAgc3BhY2UteS0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtbJ1NUVURFTlRTJywgJ1BST0ZTJywgJ0FFU0gnXS5pbmNsdWRlcyh2aWV3TW9kZSkgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gc2V0U2hvd1RlbXBsYXRlRWRpdG9yKHRydWUpfSBjbGFzc05hbWU9InctZnVsbCBiZy1zbGF0ZS04MDAgaG92ZXI6Ymctc2xhdGUtNzAwIHRleHQtd2hpdGUgcHgtNCBweS0yLjUgcm91bmRlZC1sZyBmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIgYm9yZGVyIGJvcmRlci1zbGF0ZS03MDAgdHJhbnNpdGlvbi1hbGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RWRpdCBzaXplPXsxNn0gLz4gUGVyc29ubmFsaXNlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gd2luZG93LnByaW50KCl9IGNsYXNzTmFtZT0idy1mdWxsIGJnLWVtZXJhbGQtNjAwIGhvdmVyOmJnLWVtZXJhbGQtNTAwIHRleHQtd2hpdGUgcHgtNCBweS0zIHJvdW5kZWQtbGcgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIHNoYWRvdy1sZyBzaGFkb3ctZW1lcmFsZC05MDAvMjAgdHJhbnNpdGlvbi1hbGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxQcmludGVyIHNpemU9ezE4fSAvPiBJTVBSSU1FUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e29uQ2xvc2V9IGNsYXNzTmFtZT0idy1mdWxsIGJnLXJlZC02MDAvMTAgaG92ZXI6YmctcmVkLTYwMCB0ZXh0LXJlZC01MDAgaG92ZXI6dGV4dC13aGl0ZSBweC00IHB5LTIuNSByb3VuZGVkLWxnIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiBib3JkZXIgYm9yZGVyLXJlZC05MDAvMzAgaG92ZXI6Ym9yZGVyLXJlZC02MDAgdHJhbnNpdGlvbi1hbGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSb3RhdGVDY3cgc2l6ZT17MTZ9IC8+IFJldG91cgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICB7LyogWk9ORSBQUklOQ0lQQUxFIChEcm9pdGUpIC0gQ29udGllbnQgbGVzIGZldWlsbGVzIEE0ICovfQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4LTEgYmctc2xhdGUtMjAwLzUwIG92ZXJmbG93LWF1dG8gcC04IHByaW50LWNvbnRlbnQtYXJlYSBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJwcmludC13cmFwcGVyIHctZnVsbCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdHRU5FUkFMJyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctZnVsbCBtYXgtdy1bMjk3bW1dIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im5vLXByaW50IG1iLTQgcC00IGJnLWJsdWUtMTAwIHRleHQtYmx1ZS04MDAgcm91bmRlZC1sZyBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyBib3JkZXIgYm9yZGVyLWJsdWUtMjAwIHNoYWRvdy1zbSB3LWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEdyaWQgc2l6ZT17MjR9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+UGxhbm5pbmcgR8OpbsOpcmFsIChQYXlzYWdlKTwvc3Ryb25nPjxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0cmljZSBob3JhaXJlIHBvdXIgYWZmaWNoYWdlIGdsb2JhbC4gPHN0cm9uZz5QZW5zZXogw6AgcsOpZ2xlciB2b3RyZSBpbXByaW1hbnRlIHN1ciAiUGF5c2FnZSIgKExhbmRzY2FwZSkuPC9zdHJvbmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtnZXRHZW5lcmFsUGxhbm5pbmdEYXRhKCkuanVyeUNodW5rcy5tYXAoKGNodW5rLCBjaHVua0luZGV4KSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGtleT17Y2h1bmtJbmRleH0gY2xhc3NOYW1lPSJBNC1sYW5kc2NhcGUtc2hlZXQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgYm9yZGVyLWItMiBib3JkZXItYmxhY2sgcGItNCBtYi00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzY2hvb2xMb2dvICYmIDxpbWcgc3JjPXtzY2hvb2xMb2dvfSBhbHQ9IkxvZ28iIGNsYXNzTmFtZT0iaC0xNiBvYmplY3QtY29udGFpbiIgLz59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzc05hbWU9InRleHQtMnhsIGZvbnQtYmxhY2sgdXBwZXJjYXNlIHRleHQtc2xhdGUtOTAwIj5QTEFOTklORyBHw4lOw4lSQUwge2NodW5rSW5kZXggPiAwID8gYChTdWl0ZSAke2NodW5rSW5kZXgrMX0pYCA6ICcnfTwvaDE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteGwgZm9udC1ib2xkIHRleHQtYmx1ZS04MDAiPntleGFtTGFiZWx9IC0gU2Vzc2lvbiB7c2Vzc2lvblllYXJ9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtc20gZm9udC1ib2xkIHRleHQtZ3JheS01MDAiPntleGFtRGF0ZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXhsIHRleHQtc2xhdGUtNzAwIj57c2Nob29sTmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTUwMCI+e3NjaG9vbENpdHl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyLWNvbGxhcHNlIGJvcmRlciBib3JkZXItYmxhY2sgdGV4dC14cyB0YWJsZS1maXhlZCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzc05hbWU9ImJnLXNsYXRlLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTIgdy0yMCB0ZXh0LWNlbnRlciBiZy1zbGF0ZS0yMDAiPkhvcmFpcmU8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtjaHVuay5tYXAoaiA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBrZXk9e2ouaWR9IGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTIgdGV4dC1jZW50ZXIgbWluLXctWzEyMHB4XSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1sZyBmb250LWJsYWNrIj5KVVJZIHtqLmlkfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWJsdWUtNzAwIj5TYWxsZSB7ai5yb29tfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2dldEdlbmVyYWxQbGFubmluZ0RhdGEoKS5zb3J0ZWRUaW1lcy5tYXAoKHRpbWUsIHRJZHgpID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIga2V5PXt0SWR4fSBjbGFzc05hbWU9e3RJZHggJSAyID09PSAwID8gJ2JnLXdoaXRlJyA6ICdiZy1ncmF5LTUwJ30+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0yIHRleHQtY2VudGVyIGZvbnQtYm9sZCB0ZXh0LXNtIGJnLXNsYXRlLTEwMCI+e3RpbWV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2NodW5rLm1hcChqID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBqLnN0dWRlbnRzTWFwW3RpbWVdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzKSByZXR1cm4gPHRkIGtleT17ai5pZH0gY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMiI+PC90ZD47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5pc0JyZWFrKSByZXR1cm4gPHRkIGtleT17ai5pZH0gY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMiB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNDAwIGl0YWxpYyBiZy1ncmF5LTEwMCI+UEFVU0U8L3RkPjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQga2V5PXtqLmlkfSBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0yIG92ZXJmbG93LWhpZGRlbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdXBwZXJjYXNlIHRleHQtc2xhdGUtOTAwIHRydW5jYXRlIj57cy5OT019IHtzLlBSRU5PTX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtdC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1tZWRpdW0gdGV4dC1ncmF5LTYwMCI+e3MuRElWfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzLlRUICYmIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMTBweF0gZm9udC1ib2xkIHRleHQtd2hpdGUgYmctcmVkLTUwMCBweC0xIHJvdW5kZWQiPlRUPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC1hdXRvIHB0LTIgdGV4dC1jZW50ZXIgdGV4dC1bMTBweF0gdGV4dC1ncmF5LTQwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERvY3VtZW50IGfDqW7DqXLDqSBwYXIgUGVyZGlyRm9ybWFuY2UgLSBQYWdlIHtjaHVua0luZGV4ICsgMX0ve2dldEdlbmVyYWxQbGFubmluZ0RhdGEoKS5qdXJ5Q2h1bmtzLmxlbmd0aH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAge3ZpZXdNb2RlID09PSAnU1RVREVOVFMnICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy1mdWxsIG1heC13LVsyMTBtbV0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3R1ZGVudHNUb1ByaW50Lm1hcCgocywgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNUVCA9IChzLlRUICYmIChzLlRUID09PSAnT1VJJyB8fCBzLlRUID09PSB0cnVlIHx8IG5vcm1hbGl6ZVRleHQocy5UVCkuaW5jbHVkZXMoJ1RJRVJTJykpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmVwVGltZSA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4YW1UeXBlID09PSAnR08nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlcFRpbWUgPSBpc1RUID8gMjcgOiAyMDsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGFyZSB2YXJpYWJsZXMgZm9yIHRlbXBsYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZVZhcnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9NOiBzLk5PTSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUkVOT006IHMuUFJFTk9NLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVQUkVVVkU6IGV4YW1GdWxsTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTRVNTSU9OOiBzZXNzaW9uWWVhciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQVRFX0VYQU06IGV4YW1EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZJTExFOiBzY2hvb2xDaXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERBVEVfSk9VUjogbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRVRBQkxJU1NFTUVOVDogc2Nob29sTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIRVVSRTogcy50aW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNBTExFOiBzLnJvb20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlVSWTogcy5qdXJ5SWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtpfSBjbGFzc05hbWU9IkE0LXNoZWV0IHRleHQtYmxhY2sgZm9udC1zYW5zIGZsZXggZmxleC1jb2wiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBIZWFkZXIgKyBEZXN0aW5hdGFpcmUgYWxpZ27DqXMgKFJlbW9udMOpZSBkdSBOb20pICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1zdGFydCBtYi0xMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLXN0YXJ0IGdhcC00IG1heC13LVs1MCVdIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzY2hvb2xMb2dvICYmIDxpbWcgc3JjPXtzY2hvb2xMb2dvfSBhbHQ9IkxvZ28iIGNsYXNzTmFtZT0iaC0yNCB3LTI0IG9iamVjdC1jb250YWluIiAvPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJwdC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtbGcgdXBwZXJjYXNlIGxlYWRpbmctdGlnaHQiPntzY2hvb2xOYW1lfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWJhc2UgdGV4dC1ncmF5LTYwMCI+e3NjaG9vbENpdHl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1yaWdodCBtYXgtdy1bNDUlXSBwdC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIHVwcGVyY2FzZSBmb250LWJvbGQgdGV4dC1ncmF5LTQwMCBtYi0xIj5DYW5kaWRhdChlKTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXhsIHVwcGVyY2FzZSBtYi0xIj57cy5OT019IHtzLlBSRU5PTX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWxnIj5DbGFzc2UgZGUge3MuRElWfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIFRpdHJlICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciBtYi0xMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzc05hbWU9InRleHQtM3hsIGZvbnQtYmxhY2sgdXBwZXJjYXNlIG1iLTIgdW5kZXJsaW5lIHVuZGVybGluZS1vZmZzZXQtNCI+Q09OVk9DQVRJT048L2gxPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14bCBmb250LWJvbGQgdXBwZXJjYXNlIj57ZXhhbUZ1bGxOYW1lfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1sZyB1cHBlcmNhc2UiPlNlc3Npb24ge3Nlc3Npb25ZZWFyfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icHgtNCBmbGV4LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogSW50cm8gKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi04IHRleHQtanVzdGlmeSBsZWFkaW5nLXJlbGF4ZWQgdGV4dC1iYXNlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJUZW1wbGF0ZVRleHQodGVtcGxhdGVzLlNUVURFTlRTLmludHJvLCB0ZW1wbGF0ZVZhcnMpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBEZXRhaWxzICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItMTAgYm9yZGVyLTIgYm9yZGVyLWJsYWNrIHAtNiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtMSBnYXAtNCB0ZXh0LWxnIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBib3JkZXItYiBib3JkZXItZ3JheS0zMDAgcGItMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHctNDgiPkRhdGUgZGUgbCfDqXByZXV2ZSA6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImNhcGl0YWxpemUiPntleGFtRGF0ZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggYm9yZGVyLWIgYm9yZGVyLWdyYXktMzAwIHBiLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZvbnQtYm9sZCB3LTQ4Ij5KdXJ5IDo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPk7CsCB7cy5qdXJ5SWR9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJvcmRlci1iIGJvcmRlci1ncmF5LTMwMCBwYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJmb250LWJvbGQgdy00OCI+SG9yYWlyZSBkZSBwYXNzYWdlIDo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIj57cy50aW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2V4YW1UeXBlID09PSAnR08nICYmIDxzcGFuIGNsYXNzTmFtZT0ibWwtNCB0ZXh0LXNtIGl0YWxpYyI+KFByw6lwYXJhdGlvbiA6IHthZGRNaW51dGVzKHMudGltZSwgLTIwKX0pPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBib3JkZXItYiBib3JkZXItZ3JheS0zMDAgcGItMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHctNDgiPlNhbGxlIDo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPntzLnJvb219PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtleGFtVHlwZSA9PT0gJ0dPJyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJvcmRlci1iIGJvcmRlci1ncmF5LTMwMCBwYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHctNDgiPlNww6ljaWFsaXTDqSA6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+e3MuRURTfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBJbnN0cnVjdGlvbnMgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi04Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB1bmRlcmxpbmUgbWItMiI+SW5zdHJ1Y3Rpb25zIDo8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtc20gdGV4dC1qdXN0aWZ5IGxlYWRpbmctcmVsYXhlZCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3JlbmRlclRlbXBsYXRlVGV4dCh0ZW1wbGF0ZXMuU1RVREVOVFMuaW5zdHJ1Y3Rpb25zLCB0ZW1wbGF0ZVZhcnMpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogRm9vdGVyIC0gTWFyZ2UgcmVzcGVjdMOpZSAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibXQtYXV0byBmbGV4IGp1c3RpZnktZW5kIHBiLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1jZW50ZXIgdy02NCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItMiBmb250LWJvbGQiPkxlIENoZWYgZCfDiXRhYmxpc3NlbWVudDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTQgdGV4dC1zbSI+e3NjaG9vbENpdHl9LCBsZSB7bmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iaC0zMiBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByZWxhdGl2ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3NjaG9vbFN0YW1wICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGltZyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYz17c2Nob29sU3RhbXB9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0PSJDYWNoZXQiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJtYXgtaC1mdWxsIG1heC13LWZ1bGwgb2JqZWN0LWNvbnRhaW4gbWl4LWJsZW5kLW11bHRpcGx5IG9wYWNpdHktOTAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt2aWV3TW9kZSA9PT0gJ0FFU0gnICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy1mdWxsIG1heC13LVsyMTBtbV0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibm8tcHJpbnQgbWItNiBwLTQgYmctZ3JheS0xMDAgdGV4dC1ncmF5LTgwMCBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEhhbmRIZWFydCBzaXplPXsyMH0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5PcmRyZXMgZGUgTWlzc2lvbiBBRVNIPC9zdHJvbmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWVzaEFzc2lnbm1lbnRzLm1hcCgoYWVzaCwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVWYXJzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5PTTogYWVzaC5ub20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJFTk9NOiBhZXNoLnByZW5vbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFUFJFVVZFOiBleGFtTGFiZWxNaXhlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTRVNTSU9OOiBzZXNzaW9uWWVhciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEQVRFX0VYQU06IGV4YW1EYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZJTExFOiBzY2hvb2xDaXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERBVEVfSk9VUjogbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRVRBQkxJU1NFTUVOVDogc2Nob29sTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBrZXk9e2l9IGNsYXNzTmFtZT0iQTQtc2hlZXQgdGV4dC1ibGFjayBmb250LXNhbnMgZmxleCBmbGV4LWNvbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIEhlYWRlciArIERlc3RpbmF0YWlyZSBhbGlnbsOpcyAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtc3RhcnQgbWItMTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1zdGFydCBnYXAtNCBtYXgtdy1bNTAlXSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2Nob29sTG9nbyAmJiA8aW1nIHNyYz17c2Nob29sTG9nb30gYWx0PSJMb2dvIiBjbGFzc05hbWU9ImgtMjQgdy0yNCBvYmplY3QtY29udGFpbiIgLz59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icHQtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWxnIHVwcGVyY2FzZSBsZWFkaW5nLXRpZ2h0Ij57c2Nob29sTmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1iYXNlIHRleHQtZ3JheS02MDAiPntzY2hvb2xDaXR5fTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtcmlnaHQgbWF4LXctWzQ1JV0gcHQtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1zbSB1cHBlcmNhc2UgZm9udC1ib2xkIHRleHQtZ3JheS00MDAgbWItMSI+QUVTSDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXhsIHVwcGVyY2FzZSBtYi0xIj57YWVzaC5ub219IHthZXNoLnByZW5vbX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBUaXRyZSAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1jZW50ZXIgbWItMTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPSJ0ZXh0LTN4bCBmb250LWJsYWNrIHVwcGVyY2FzZSBtYi0yIHVuZGVybGluZSB1bmRlcmxpbmUtb2Zmc2V0LTQiPk9SRFJFIERFIE1JU1NJT04gQUVTSDwvaDE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhsIGZvbnQtYm9sZCB1cHBlcmNhc2UiPntleGFtRnVsbE5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWxnIHVwcGVyY2FzZSI+U2Vzc2lvbiB7c2Vzc2lvblllYXJ9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InB4LTQgZmxleC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIEludHJvICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItOCB0ZXh0LWp1c3RpZnkgbGVhZGluZy1yZWxheGVkIHRleHQtYmFzZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cmVuZGVyVGVtcGxhdGVUZXh0KHRlbXBsYXRlcy5BRVNILmludHJvLCB0ZW1wbGF0ZVZhcnMpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBMaXN0ZSBFbGV2ZXMgLyBNaXNzaW9ucyAtIFNUWUxFIEVOQ0FEUsOJIChNb2RpZmnDqSkgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0xMCBzcGFjZS15LTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2Flc2gubWlzc2lvbnMubWFwKChtLCBpZHgpID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGtleT17aWR4fSBjbGFzc05hbWU9ImJyZWFrLWluc2lkZS1hdm9pZCBib3JkZXItMiBib3JkZXItYmxhY2sgcC02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXhsIHVwcGVyY2FzZSBtYi00IGJvcmRlci1iLTIgYm9yZGVyLWdyYXktMjAwIHBiLTIgdGV4dC1zbGF0ZS04MDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge20uc3R1ZGVudC5OT019IHttLnN0dWRlbnQuUFJFTk9NfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtbGcgc3BhY2UteS0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJvcmRlci1iIGJvcmRlci1ncmF5LTEwMCBwYi0xIj48c3BhbiBjbGFzc05hbWU9InctNTYgZm9udC1ib2xkIHRleHQtZ3JheS02MDAiPkRhdGUgZGUgbCfDqXByZXV2ZSA6PC9zcGFuPiA8c3BhbiBjbGFzc05hbWU9ImZvbnQtc2VtaWJvbGQiPntleGFtRGF0ZX08L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBib3JkZXItYiBib3JkZXItZ3JheS0xMDAgcGItMSI+PHNwYW4gY2xhc3NOYW1lPSJ3LTU2IGZvbnQtYm9sZCB0ZXh0LWdyYXktNjAwIj5KdXJ5IDo8L3NwYW4+IDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIj5OwrAge20uanVyeUlkfTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJvcmRlci1iIGJvcmRlci1ncmF5LTEwMCBwYi0xIj48c3BhbiBjbGFzc05hbWU9InctNTYgZm9udC1ib2xkIHRleHQtZ3JheS02MDAiPkhvcmFpcmUgZGUgcHJpc2UgZW4gY2hhcmdlIDo8L3NwYW4+IDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIj57bS50aW1lfTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJvcmRlci1iIGJvcmRlci1ncmF5LTEwMCBwYi0xIj48c3BhbiBjbGFzc05hbWU9InctNTYgZm9udC1ib2xkIHRleHQtZ3JheS02MDAiPlNhbGxlIDo8L3NwYW4+IDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIj57bS5yb29tfTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogSW5zdHJ1Y3Rpb25zICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItOCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdW5kZXJsaW5lIG1iLTIiPkluc3RydWN0aW9ucyA6PC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIHRleHQtanVzdGlmeSBsZWFkaW5nLXJlbGF4ZWQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJUZW1wbGF0ZVRleHQodGVtcGxhdGVzLkFFU0guaW5zdHJ1Y3Rpb25zLCB0ZW1wbGF0ZVZhcnMpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogRm9vdGVyICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC1hdXRvIGZsZXgganVzdGlmeS1lbmQgcGItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciB3LTY0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0yIGZvbnQtYm9sZCI+TGUgQ2hlZiBkJ8OJdGFibGlzc2VtZW50PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItNCB0ZXh0LXNtIj57c2Nob29sQ2l0eX0sIGxlIHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInKX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJoLTMyIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJlbGF0aXZlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2Nob29sU3RhbXAgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW1nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPXtzY2hvb2xTdGFtcH0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQ9IkNhY2hldCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9Im1heC1oLWZ1bGwgbWF4LXctZnVsbCBvYmplY3QtY29udGFpbiBtaXgtYmxlbmQtbXVsdGlwbHkgb3BhY2l0eS05MCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2Flc2hBc3NpZ25tZW50cy5sZW5ndGggPT09IDAgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtY2VudGVyIHB5LTIwIHRleHQtZ3JheS00MDAgaXRhbGljIHRleHQteGwiPkF1Y3VuIMOpbMOodmUgYXZlYyBBRVNIIGFzc2lnbsOpIMOgIHVuIGp1cnkuPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt2aWV3TW9kZSA9PT0gJ1BST0ZTJyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctZnVsbCBtYXgtdy1bMjEwbW1dIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im5vLXByaW50IG1iLTYgcC00IGJnLWdyYXktMTAwIHRleHQtZ3JheS04MDAgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIGZsZXggaXRlbXMtY2VudGVyIGdhcC0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxQcmludGVyIHNpemU9ezIwfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkNvbnZvY2F0aW9ucyBQcm9mZXNzZXVycyAoT3JkcmVzIGRlIE1pc3Npb24pPC9zdHJvbmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cHJvZkFzc2lnbm1lbnRzLm1hcCgocCwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVWYXJzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5PTTogcC5OT00sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUFJFTk9NOiBwLlBSRU5PTSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDSVY6IHAuQ0lWIHx8ICdNLi9NbWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVQUkVVVkU6IGV4YW1MYWJlbE1peGVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNFU1NJT046IHNlc3Npb25ZZWFyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERBVEVfRVhBTTogZXhhbURhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVklMTEU6IHNjaG9vbENpdHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgREFURV9KT1VSOiBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFVEFCTElTU0VNRU5UOiBzY2hvb2xOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhFVVJFX0RFQlVUOiBzdGFydFRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlVSWTogcC5qdXJ5SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU0FMTEU6IHAucm9vbSB8fCAnTm9uIGTDqWZpbmllJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBST0xFOiBwLnJvbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtpfSBjbGFzc05hbWU9IkE0LXNoZWV0IHRleHQtYmxhY2sgZm9udC1zYW5zIGZsZXggZmxleC1jb2wiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBIZWFkZXIgKyBEZXN0aW5hdGFpcmUgYWxpZ27DqXMgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLXN0YXJ0IG1iLTgiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1zdGFydCBnYXAtNCBtYXgtdy1bNTAlXSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2Nob29sTG9nbyAmJiA8aW1nIHNyYz17c2Nob29sTG9nb30gYWx0PSJMb2dvIiBjbGFzc05hbWU9ImgtMjQgdy0yNCBvYmplY3QtY29udGFpbiIgLz59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icHQtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWxnIHVwcGVyY2FzZSBsZWFkaW5nLXRpZ2h0Ij57c2Nob29sTmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1iYXNlIHRleHQtZ3JheS02MDAiPntzY2hvb2xDaXR5fTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtcmlnaHQgbWF4LXctWzQ1JV0gcHQtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1zbSB1cHBlcmNhc2UgZm9udC1ib2xkIHRleHQtZ3JheS00MDAgbWItMSI+RXhhbWluYXRldXI8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC14bCB1cHBlcmNhc2UgbWItMSI+e3AuQ0lWfSB7cC5OT019IHtwLlBSRU5PTX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWxnIGl0YWxpYyI+e3AuTUFUSUVSRX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBUaXRyZSAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1jZW50ZXIgbWItOCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzc05hbWU9InRleHQtM3hsIGZvbnQtYmxhY2sgdXBwZXJjYXNlIG1iLTIgdW5kZXJsaW5lIHVuZGVybGluZS1vZmZzZXQtNCI+T1JEUkUgREUgTUlTU0lPTjwvaDE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhsIGZvbnQtYm9sZCB1cHBlcmNhc2UiPntleGFtRnVsbE5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWxnIHVwcGVyY2FzZSI+U2Vzc2lvbiB7c2Vzc2lvblllYXJ9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InB4LTQgZmxleC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIEludHJvICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItNiB0ZXh0LWp1c3RpZnkgbGVhZGluZy1yZWxheGVkIHRleHQtYmFzZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cmVuZGVyVGVtcGxhdGVUZXh0KHRlbXBsYXRlcy5QUk9GUy5pbnRybywgdGVtcGxhdGVWYXJzKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogRGV0YWlscyAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTYgYm9yZGVyLTIgYm9yZGVyLWJsYWNrIHAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtMSBnYXAtMiB0ZXh0LWxnIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBib3JkZXItYiBib3JkZXItZ3JheS0zMDAgcGItMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHctNDgiPkRhdGUgZGUgbCfDqXByZXV2ZSA6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImNhcGl0YWxpemUiPntleGFtRGF0ZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggYm9yZGVyLWIgYm9yZGVyLWdyYXktMzAwIHBiLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZvbnQtYm9sZCB3LTQ4Ij5BZmZlY3RhdGlvbiA6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZvbnQtYm9sZCI+SnVyeSBOwrB7cC5qdXJ5SWR9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJvcmRlci1iIGJvcmRlci1ncmF5LTMwMCBwYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJmb250LWJvbGQgdy00OCI+SG9yYWlyZSBkZSBkw6lidXQgOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+e3N0YXJ0VGltZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggYm9yZGVyLWIgYm9yZGVyLWdyYXktMzAwIHBiLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZvbnQtYm9sZCB3LTQ4Ij5TYWxsZSA6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57cC5yb29tIHx8ICdOb24gZMOpZmluaWUnfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBib3JkZXItYiBib3JkZXItZ3JheS0zMDAgcGItMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHctNDgiPkZvbmN0aW9uIDo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPntwLnJvbGV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIEluc3RydWN0aW9ucyBPUFRJTUlaRUQgRk9OVCBTSVpFICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdW5kZXJsaW5lIG1iLTIiPkluc3RydWN0aW9ucyA6PC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIHRleHQtanVzdGlmeSBsZWFkaW5nLXJlbGF4ZWQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJUZW1wbGF0ZVRleHQodGVtcGxhdGVzLlBST0ZTLmluc3RydWN0aW9ucywgdGVtcGxhdGVWYXJzKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIEZvb3RlciBPUFRJTUlaRUQgSEVJR0hUICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC1hdXRvIGZsZXgganVzdGlmeS1lbmQgcGItMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciB3LTY0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0yIGZvbnQtYm9sZCI+TGUgQ2hlZiBkJ8OJdGFibGlzc2VtZW50PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItMiB0ZXh0LXNtIj57c2Nob29sQ2l0eX0sIGxlIHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInKX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJoLTMyIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJlbGF0aXZlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2Nob29sU3RhbXAgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW1nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPXtzY2hvb2xTdGFtcH0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQ9IkNhY2hldCIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9Im1heC1oLWZ1bGwgbWF4LXctZnVsbCBvYmplY3QtY29udGFpbiBtaXgtYmxlbmQtbXVsdGlwbHkgb3BhY2l0eS05MCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAge3ZpZXdNb2RlID09PSAnUFYnICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy1mdWxsIG1heC13LVsyMTBtbV0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibm8tcHJpbnQgbWItNCBwLTQgYmctZ3JheS0xMDAgdGV4dC1ncmF5LTgwMCByb3VuZGVkIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDbGlwYm9hcmRMaXN0IHNpemU9ezIwfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPlByb2PDqHMgVmVyYmFsIGRlIEp1cnk8L3N0cm9uZz48YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERvY3VtZW50IGRlIHN5bnRow6hzZSBwb3VyIGxlcyBvYnNlcnZhdGlvbnMgZHUganVyeS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZUp1cmllcy5tYXAoKGp1cnkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2YxID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnkucHJvZjFJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9mMiA9IHByb2ZzLmZpbmQocCA9PiBwLmlkID09PSBqdXJ5LnByb2YySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtqdXJ5LmlkfSBjbGFzc05hbWU9IkE0LXNoZWV0IGZsZXggZmxleC1jb2wiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtc3RhcnQgYm9yZGVyLWItMiBib3JkZXItYmxhY2sgcGItNCBtYi02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LTEvMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzY2hvb2xMb2dvICYmIDxpbWcgc3JjPXtzY2hvb2xMb2dvfSBhbHQ9IkxvZ28iIGNsYXNzTmFtZT0iaC0xNiBvYmplY3QtY29udGFpbiIgLz59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC0yIHRleHQteHMgdXBwZXJjYXNlIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIj57c2Nob29sTmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctMS8zIHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPSJ0ZXh0LTJ4bCBmb250LWJsYWNrIHVwcGVyY2FzZSB0ZXh0LXNsYXRlLTkwMCI+UFJPQ8OIUyBWRVJCQUw8L2gxPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtODAwIj57ZXhhbUxhYmVsfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIGZvbnQtYm9sZCBtdC0xIj5KVVJZIHtqdXJ5LmlkfSAtIFNhbGxlIHtqdXJ5LnJvb219PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LTEvMyB0ZXh0LXJpZ2h0IHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdXBwZXJjYXNlIj5TZXNzaW9uIHtzZXNzaW9uWWVhcn08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PntleGFtRGF0ZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibXQtMiBmb250LWJvbGQiPkV4YW1pbmF0ZXVycyA6PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj57cHJvZjEgPyBgJHtwcm9mMS5OT019ICR7cHJvZjEuUFJFTk9NfWAgOiAnLi4uJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2Pntwcm9mMiA/IGAke3Byb2YyLk5PTX0gJHtwcm9mMi5QUkVOT019YCA6ICcuLi4nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTggcC00IGJnLWdyYXktNTAgYm9yZGVyIGJvcmRlci1ncmF5LTIwMCByb3VuZGVkLWxnIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXNtIHVwcGVyY2FzZSB0ZXh0LWdyYXktNTAwIG1iLTIiPkNvbXBvc2l0aW9uIGR1IEp1cnk8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LWdyYXktNDAwIGZvbnQtYm9sZCB1cHBlcmNhc2UiPkV4YW1pbmF0ZXVyIDE8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQiPntwcm9mMSA/IGAke3Byb2YxLk5PTX0gJHtwcm9mMS5QUkVOT019YCA6ICdOb24gYXNzaWduw6knfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyBpdGFsaWMiPntwcm9mMT8uTUFUSUVSRX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQteHMgdGV4dC1ncmF5LTQwMCBmb250LWJvbGQgdXBwZXJjYXNlIj5FeGFtaW5hdGV1ciAyPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZm9udC1ib2xkIj57cHJvZjIgPyBgJHtwcm9mMi5OT019ICR7cHJvZjIuUFJFTk9NfWAgOiAnTm9uIGFzc2lnbsOpJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteHMgaXRhbGljIj57cHJvZjI/Lk1BVElFUkV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleC0xIGJvcmRlci0yIGJvcmRlci1ibGFjayByb3VuZGVkLXhsIHAtNCBtYi04Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWxnIHVwcGVyY2FzZSB1bmRlcmxpbmUgbWItNCI+T0JTRVJWQVRJT05TIC8gRMOJUk9VTEVNRU5UIERFUyDDiVBSRVVWRVM8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctZnVsbCBoLWZ1bGwiIHN0eWxlPXt7bWluSGVpZ2h0OiAnMjAwcHgnfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1suLi5BcnJheSg4KV0ubWFwKChfLCBpKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtpfSBjbGFzc05hbWU9ImJvcmRlci1iIGJvcmRlci1ncmF5LTMwMCBoLTEwIHctZnVsbCI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibXQtYXV0byBwdC04IGZsZXgganVzdGlmeS1hcm91bmQgdGV4dC1jZW50ZXIgcGItOCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0xMiB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSI+U2lnbmF0dXJlIEV4YW1pbmF0ZXVyIDE8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy00OCBib3JkZXItYiBib3JkZXItYmxhY2siPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0xMiB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSI+U2lnbmF0dXJlIEV4YW1pbmF0ZXVyIDI8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy00OCBib3JkZXItYiBib3JkZXItYmxhY2siPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt2aWV3TW9kZSA9PT0gJ1BPQ0hFVFRFUycgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LWZ1bGwgbWF4LXctWzIxMG1tXSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJuby1wcmludCBtYi00IHAtNCBiZy1vcmFuZ2UtMTAwIHRleHQtb3JhbmdlLTgwMCByb3VuZGVkIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxGb2xkZXIgc2l6ZT17MjB9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+UG9jaGV0dGVzIGRlIEp1cnk8L3N0cm9uZz48YnIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZ2UgZGUgZ2FyZGUgcG91ciBsZXMgZG9zc2llcnMgcmVtaXMgYXV4IGp1cnlzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlSnVyaWVzLm1hcCgoanVyeSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvZjEgPSBwcm9mcy5maW5kKHAgPT4gcC5pZCA9PT0ganVyeS5wcm9mMUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2YyID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnkucHJvZjJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBrZXk9e2p1cnkuaWR9IGNsYXNzTmFtZT0iQTQtc2hlZXQgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIgcC0xMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsvKiBIZWFkZXIgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0xMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c2Nob29sTG9nbyAmJiA8aW1nIHNyYz17c2Nob29sTG9nb30gYWx0PSJMb2dvIiBjbGFzc05hbWU9ImgtMzIgb2JqZWN0LWNvbnRhaW4gbXgtYXV0byBtYi00IiAvPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzc05hbWU9InRleHQtMnhsIGZvbnQtYm9sZCB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXN0IHRleHQtc2xhdGUtNjAwIj57c2Nob29sTmFtZX08L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteGwgdGV4dC1zbGF0ZS00MDAgbXQtMiI+e3NjaG9vbENpdHl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey8qIE1haW4gSW5mbyAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgtMSBmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIHctZnVsbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYm9yZGVyLXQtNCBib3JkZXItYi00IGJvcmRlci1zbGF0ZS05MDAgcHktOCBtYi04Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPSJ0ZXh0LTV4bCBmb250LWJsYWNrIHVwcGVyY2FzZSB0ZXh0LXNsYXRlLTkwMCBtYi00Ij57ZXhhbUxhYmVsfTwvaDE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtODAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlciI+U2Vzc2lvbiB7c2Vzc2lvblllYXJ9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItMTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJpbmxpbmUtYmxvY2sgYmctd2hpdGUgYm9yZGVyLTQgYm9yZGVyLWJsYWNrIHRleHQtc2xhdGUtOTAwIHB4LTEwIHB5LTYgcm91bmRlZC0zeGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC0yeGwgZm9udC1tZWRpdW0gdXBwZXJjYXNlIG9wYWNpdHktODAgbWItMSI+SnVyeSBOwrA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtOHhsIGZvbnQtYmxhY2siPntqdXJ5LmlkfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTIgZ2FwLTggdGV4dC1sZWZ0IG1heC13LTJ4bCBteC1hdXRvIHctZnVsbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXNsYXRlLTUwIHAtNiByb3VuZGVkLXhsIGJvcmRlci0yIGJvcmRlci1zbGF0ZS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC14cyBmb250LWJvbGQgdGV4dC1zbGF0ZS00MDAgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVzdCBtYi0yIj5TYWxsZTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC00eGwgZm9udC1ibGFjayB0ZXh0LXNsYXRlLTgwMCI+e2p1cnkucm9vbX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctc2xhdGUtNTAgcC02IHJvdW5kZWQteGwgYm9yZGVyLTIgYm9yZGVyLXNsYXRlLTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTQwMCB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXN0IG1iLTIiPkRhdGU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTgwMCBjYXBpdGFsaXplIj57ZXhhbURhdGV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogRm9vdGVyIC8gRXhhbWluZXJzICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy1mdWxsIG10LTEyIHB0LTggYm9yZGVyLXQtMiBib3JkZXItc2xhdGUtMjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtc20gZm9udC1ib2xkIHRleHQtc2xhdGUtNDAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3QgbWItNiI+RXhhbWluYXRldXJzPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGp1c3RpZnktYXJvdW5kIHRleHQteGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS05MDAiPntwcm9mMSA/IGAke3Byb2YxLk5PTX0gJHtwcm9mMS5QUkVOT019YCA6ICdOb24gYXNzaWduw6knfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1iYXNlIGl0YWxpYyB0ZXh0LXNsYXRlLTUwMCI+e3Byb2YxPy5NQVRJRVJFfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS05MDAiPntwcm9mMiA/IGAke3Byb2YyLk5PTX0gJHtwcm9mMi5QUkVOT019YCA6ICdOb24gYXNzaWduw6knfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1iYXNlIGl0YWxpYyB0ZXh0LXNsYXRlLTUwMCI+e3Byb2YyPy5NQVRJRVJFfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdKVVJJRVMnICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy1mdWxsIG1heC13LVsyMTBtbV0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlSnVyaWVzLm1hcCgoanVyeSwgaWR4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50cyA9IGNhbGN1bGF0ZVN0dWRlbnRUaW1lcyhqdXJ5LnN0dWRlbnRzLCBzdGFydFRpbWUsIGV4YW1UeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IGNodW5rQXJyYXkoc3R1ZGVudHMsIDE4KTsgLy8gUGFnaW5hdGlvbiBmb3IgbG9uZyBsaXN0cwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjaHVua3MubWFwKChjaHVuaywgY2h1bmtJZHgpID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGtleT17YCR7anVyeS5pZH0tJHtjaHVua0lkeH1gfSBjbGFzc05hbWU9IkE0LXNoZWV0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBib3JkZXItYi0yIGJvcmRlci1ibGFjayBwYi00IG1iLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzY2hvb2xMb2dvICYmIDxkaXYgY2xhc3NOYW1lPSJ3LTIwIGgtMjAgZmxleC1zaHJpbmstMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+PGltZyBzcmM9e3NjaG9vbExvZ299IGFsdD0iTG9nbyIgY2xhc3NOYW1lPSJtYXgtaC1mdWxsIG1heC13LWZ1bGwgb2JqZWN0LWNvbnRhaW4iIC8+PC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzTmFtZT0idGV4dC0yeGwgZm9udC1ib2xkIHVwcGVyY2FzZSI+UGxhbm5pbmcgSnVyeSB7anVyeS5pZH0gLSB7ZXhhbUxhYmVsfTwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtbGcgdGV4dC1ncmF5LTYwMCBmb250LXNlbWlib2xkIj57ZXhhbURhdGV9IC0gU2FsbGUge2p1cnkucm9vbX0ge2NodW5rSWR4ID4gMCA/IGAoUGFnZSAke2NodW5rSWR4ICsgMX0pYCA6ICcnfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyLWNvbGxhcHNlIGJvcmRlciBib3JkZXItYmxhY2sgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3NOYW1lPSJiZy1ncmF5LTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMiB3LTI0Ij5Ib3JhaXJlPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0yIj5DYW5kaWRhdDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMiB3LTIwIj5DbGFzc2U8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTIiPntleGFtVHlwZSA9PT0gJ0dPJyA/ICdFRFMgLyBUaWVycy1UZW1wcycgOiAnRMOpdGFpbHMnfTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtjaHVuay5tYXAoKHMsIGkpID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBrZXk9e2l9IGNsYXNzTmFtZT17cy5pc0JyZWFrID8gImJnLWdyYXktMTAwIiA6ICIifT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMyB0ZXh0LWNlbnRlciBmb250LWJvbGQiPntzLnRpbWVTdGFydH08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzLmlzQnJlYWsgPyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjb2xTcGFuPSIzIiBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0zIHRleHQtY2VudGVyIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIGl0YWxpYyI+UEFVU0UgKHtzLmR1cmF0aW9ufSBtaW4pPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTMgZm9udC1ib2xkIHVwcGVyY2FzZSI+e3MuTk9NfSB7cy5QUkVOT019PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0zIHRleHQtY2VudGVyIj57cy5ESVZ9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0zIHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzLlRUICYmIChzLlRUID09PSAnT1VJJyB8fCBzLlRUID09PSB0cnVlIHx8IG5vcm1hbGl6ZVRleHQocy5UVCkuaW5jbHVkZXMoJ1RJRVJTJykpICYmIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtcmVkLTYwMCBibG9jayI+4pqg77iPIFRJRVJTIFRFTVBTPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cy5QQyAmJiAocy5QQyA9PT0gJ09VSScgfHwgcy5QQyA9PT0gdHJ1ZSkgJiYgPHNwYW4gY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1ibHVlLTYwMCBibG9jayBtdC0xIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIj48TGFwdG9wIHNpemU9ezEwfS8+IE9SRElOQVRFVVI8L3NwYW4+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtleGFtVHlwZSA9PT0gJ0dPJyAmJiBzLkVEUyAmJiA8c3BhbiBjbGFzc05hbWU9InRleHQtcm9zZS03MDAgZm9udC1ib2xkIGJsb2NrIj57cy5FRFN9PC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cy5BRVNIX05PTSAmJiA8c3BhbiBjbGFzc05hbWU9InRleHQtcHVycGxlLTYwMCBmb250LWJvbGQgYmxvY2sgbXQtMSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSI+PEhhbmRIZWFydCBzaXplPXsxMH0vPiBBRVNIIDoge3MuQUVTSF9OT019PC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdOT1RBVElPTicgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LWZ1bGwgbWF4LXctWzIxMG1tXSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJuby1wcmludCBtYi00IHAtNCBiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCByb3VuZGVkIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDbGlwYm9hcmRMaXN0IHNpemU9ezIwfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkZldWlsbGVzIGRlIE5vdGF0aW9uIENvbGxlY3RpdmVzPC9zdHJvbmc+PGJyLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVbmUgbGlzdGUgcsOpY2FwaXR1bGF0aXZlIHBhciBqdXJ5IHBvdXIgbGEgc2Fpc2llIGRlcyBub3Rlcy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZUp1cmllcy5tYXAoKGp1cnkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2YxID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnkucHJvZjFJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9mMiA9IHByb2ZzLmZpbmQocCA9PiBwLmlkID09PSBqdXJ5LnByb2YySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudHNXaXRoVGltZSA9IGNhbGN1bGF0ZVN0dWRlbnRUaW1lcyhqdXJ5LnN0dWRlbnRzLCBzdGFydFRpbWUsIGV4YW1UeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IGNodW5rQXJyYXkoc3R1ZGVudHNXaXRoVGltZSwgMTYpOyAvLyBPUFRJTUlaRUQ6IEluY3JlYXNlZCBmcm9tIDEyIHRvIDE2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtYXhTY29yZSA9IDIwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4YW1UeXBlID09PSAnQ0ZHJykgbWF4U2NvcmUgPSAxNjA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNodW5rcy5tYXAoKGNodW5rLCBjaHVua0lkeCkgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtgJHtqdXJ5LmlkfS0ke2NodW5rSWR4fWB9IGNsYXNzTmFtZT0iQTQtc2hlZXQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtc3RhcnQgYm9yZGVyLWItMiBib3JkZXItYmxhY2sgcGItMiBtYi0yIj4gey8qIE9QVElNSVpFRDogUmVkdWNlZCBwYWRkaW5nL21hcmdpbiAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LTEvMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzY2hvb2xMb2dvICYmIDxpbWcgc3JjPXtzY2hvb2xMb2dvfSBhbHQ9IkxvZ28iIGNsYXNzTmFtZT0iaC0xNiBvYmplY3QtY29udGFpbiIgLz59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC0yIHRleHQteHMgdXBwZXJjYXNlIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIj57c2Nob29sTmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctMS8zIHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPSJ0ZXh0LTJ4bCBmb250LWJsYWNrIHVwcGVyY2FzZSB0ZXh0LXNsYXRlLTkwMCI+UkVMRVbDiSBERSBOT1RFUzwvaDE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQteGwgZm9udC1ib2xkIHRleHQtYmx1ZS04MDAiPntleGFtTGFiZWx9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtc20gZm9udC1ib2xkIG10LTEiPkpVUlkge2p1cnkuaWR9IC0gU2FsbGUge2p1cnkucm9vbX0ge2NodW5rSWR4ID4gMCA/IGAoUGFnZSAke2NodW5rSWR4KzF9KWAgOiAnJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctMS8zIHRleHQtcmlnaHQgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZvbnQtYm9sZCB1cHBlcmNhc2UiPlNlc3Npb24ge3Nlc3Npb25ZZWFyfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+e2V4YW1EYXRlfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC0yIGZvbnQtYm9sZCI+RXhhbWluYXRldXJzIDo8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2Pntwcm9mMSA/IGAke3Byb2YxLk5PTX0gJHtwcm9mMS5QUkVOT019YCA6ICcuLi4nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+e3Byb2YyID8gYCR7cHJvZjIuTk9NfSAke3Byb2YyLlBSRU5PTX1gIDogJy4uLid9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPSJ3LWZ1bGwgYm9yZGVyLWNvbGxhcHNlIGJvcmRlciBib3JkZXItYmxhY2sgdGV4dC1zbSBtYi0yIj4gey8qIE9QVElNSVpFRCBtYXJnaW4gKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzTmFtZT0iYmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMS41IHctMTYgdGV4dC1jZW50ZXIiPkhldXJlPC90aD4gey8qIE9QVElNSVpFRCBwYWRkaW5nICovfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMS41Ij5DYW5kaWRhdDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0xLjUgdy0xNiB0ZXh0LWNlbnRlciI+Q2xhc3NlPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTEuNSI+e2V4YW1UeXBlID09PSAnR08nID8gJ1N1amV0IC8gRURTJyA6ICdUaMOobWUnfTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0xLjUgdy0zMiB0ZXh0LWNlbnRlciB0ZXh0LWxnIj5OT1RFIC8ge21heFNjb3JlfTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0xLjUgdy00OCB0ZXh0LWNlbnRlciI+T2JzZXJ2YXRpb25zPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y2h1bmsubWFwKChzLCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzLmlzQnJlYWspIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIga2V5PXtpfSBjbGFzc05hbWU9ImJnLWdyYXktNTAgaC0xMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTEuNSB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNDAwIj57cy50aW1lU3RhcnR9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY29sU3Bhbj0iNSIgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMS41IHRleHQtY2VudGVyIHRleHQtZ3JheS00MDAgaXRhbGljIj5QQVVTRTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGtleT17aX0gY2xhc3NOYW1lPSJoLTEwIj4gey8qIEZpeGVkIGhlaWdodCBmb3IgY29uc2lzdGVuY3kgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTEuNSB0ZXh0LWNlbnRlciBmb250LWJvbGQiPntzLnRpbWVTdGFydH08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0xLjUgZm9udC1ib2xkIHVwcGVyY2FzZSI+e3MuTk9NfSB7cy5QUkVOT019PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMS41IHRleHQtY2VudGVyIj57cy5ESVZ9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMS41IHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cy5UVCAmJiA8c3BhbiBjbGFzc05hbWU9InRleHQtcmVkLTYwMCBmb250LWJvbGQgYmxvY2siPlRJRVJTIFRFTVBTPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3MuUEMgJiYgKHMuUEMgPT09ICdPVUknIHx8IHMuUEMgPT09IHRydWUpICYmIDxzcGFuIGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtYmx1ZS02MDAgYmxvY2sgbXQtMSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSI+PExhcHRvcCBzaXplPXsxMH0vPiBPUkRJTkFURVVSPC9zcGFuPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2V4YW1UeXBlID09PSAnR08nID8gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LXJvc2UtNzAwIGZvbnQtYm9sZCI+e3MuRURTfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPntzLlBBUkNPVVJTfSB7cy5USEVNRSAmJiBgLSAke3MuVEhFTUV9YH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMS41IGJnLXdoaXRlIj48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0xLjUgYmctd2hpdGUiPjwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC1hdXRvIHB0LTQgZmxleCBqdXN0aWZ5LWFyb3VuZCB0ZXh0LWNlbnRlciBwYi00Ij4gey8qIE9QVElNSVpFRCBmb290ZXIgc3BhY2luZyAqL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTggdGV4dC14cyBmb250LWJvbGQgdGV4dC1ncmF5LTUwMCB1cHBlcmNhc2UiPlNpZ25hdHVyZSBFeGFtaW5hdGV1ciAxPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctNDggYm9yZGVyLWIgYm9yZGVyLWJsYWNrIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItOCB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSI+U2lnbmF0dXJlIEV4YW1pbmF0ZXVyIDI8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy00OCBib3JkZXItYiBib3JkZXItYmxhY2siPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdFTUFSR0VNRU5UJyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctZnVsbCBtYXgtdy1bMjEwbW1dIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im5vLXByaW50IG1iLTQgcC00IGJnLWdyZWVuLTEwMCB0ZXh0LWdyZWVuLTgwMCByb3VuZGVkIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDaGVja0NpcmNsZSBzaXplPXsyMH0gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5GZXVpbGxlcyBkJ8OJbWFyZ2VtZW50PC9zdHJvbmc+PGJyLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0ZSBwb3VyIGxhIHNpZ25hdHVyZSBkZXMgY2FuZGlkYXRzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlSnVyaWVzLm1hcCgoanVyeSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvZjEgPSBwcm9mcy5maW5kKHAgPT4gcC5pZCA9PT0ganVyeS5wcm9mMUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2YyID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnkucHJvZjJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50c1dpdGhUaW1lID0gY2FsY3VsYXRlU3R1ZGVudFRpbWVzKGp1cnkuc3R1ZGVudHMsIHN0YXJ0VGltZSwgZXhhbVR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2h1bmtzID0gY2h1bmtBcnJheShzdHVkZW50c1dpdGhUaW1lLCAxNCk7IC8vIFBhZ2luYXRpb24KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2h1bmtzLm1hcCgoY2h1bmssIGNodW5rSWR4KSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBrZXk9e2Ake2p1cnkuaWR9LSR7Y2h1bmtJZHh9YH0gY2xhc3NOYW1lPSJBNC1zaGVldCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1zdGFydCBib3JkZXItYi0yIGJvcmRlci1ibGFjayBwYi00IG1iLTYiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctMS8zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3NjaG9vbExvZ28gJiYgPGltZyBzcmM9e3NjaG9vbExvZ299IGFsdD0iTG9nbyIgY2xhc3NOYW1lPSJoLTE2IG9iamVjdC1jb250YWluIiAvPn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im10LTIgdGV4dC14cyB1cHBlcmNhc2UgZm9udC1ib2xkIHRleHQtZ3JheS01MDAiPntzY2hvb2xOYW1lfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy0xLzMgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzc05hbWU9InRleHQtMnhsIGZvbnQtYmxhY2sgdXBwZXJjYXNlIHRleHQtc2xhdGUtOTAwIj5GRVVJTExFIEQnw4lNQVJHRU1FTlQ8L2gxPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtODAwIj57ZXhhbUxhYmVsfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIGZvbnQtYm9sZCBtdC0xIj5KVVJZIHtqdXJ5LmlkfSAtIFNhbGxlIHtqdXJ5LnJvb219IHtjaHVua0lkeCA+IDAgPyBgKFBhZ2UgJHtjaHVua0lkeCsxfSlgIDogJyd9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LTEvMyB0ZXh0LXJpZ2h0IHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmb250LWJvbGQgdXBwZXJjYXNlIj5TZXNzaW9uIHtzZXNzaW9uWWVhcn08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PntleGFtRGF0ZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibXQtMiBmb250LWJvbGQiPkV4YW1pbmF0ZXVycyA6PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj57cHJvZjEgPyBgJHtwcm9mMS5OT019ICR7cHJvZjEuUFJFTk9NfWAgOiAnLi4uJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2Pntwcm9mMiA/IGAke3Byb2YyLk5PTX0gJHtwcm9mMi5QUkVOT019YCA6ICcuLi4nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzTmFtZT0idy1mdWxsIGJvcmRlci1jb2xsYXBzZSBib3JkZXIgYm9yZGVyLWJsYWNrIHRleHQtc20gbWItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzTmFtZT0iYmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMiB3LTIwIHRleHQtY2VudGVyIj5IZXVyZTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0yIj5DYW5kaWRhdDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0yIHctMjAgdGV4dC1jZW50ZXIiPkNsYXNzZTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0yIHctMTYgdGV4dC1jZW50ZXIiPlAvQTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0yIHctNjQgdGV4dC1jZW50ZXIiPlNpZ25hdHVyZTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGhlYWQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2NodW5rLm1hcCgocywgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5pc0JyZWFrKSByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGtleT17aX0gY2xhc3NOYW1lPSJiZy1ncmF5LTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMiB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNDAwIj57cy50aW1lU3RhcnR9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY29sU3Bhbj0iNCIgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMiB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNDAwIGl0YWxpYyI+UEFVU0U8L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBrZXk9e2l9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0zIHRleHQtY2VudGVyIGZvbnQtYm9sZCI+e3MudGltZVN0YXJ0fTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTMgZm9udC1ib2xkIHVwcGVyY2FzZSI+e3MuTk9NfSB7cy5QUkVOT019PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJib3JkZXIgYm9yZGVyLWJsYWNrIHAtMyB0ZXh0LWNlbnRlciI+e3MuRElWfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0iYm9yZGVyIGJvcmRlci1ibGFjayBwLTMgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9ImJvcmRlciBib3JkZXItYmxhY2sgcC0zIj48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibXQtYXV0byBwdC04IGZsZXgganVzdGlmeS1hcm91bmQgdGV4dC1jZW50ZXIgcGItOCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0xMiB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSI+U2lnbmF0dXJlIEV4YW1pbmF0ZXVyIDE8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy00OCBib3JkZXItYiBib3JkZXItYmxhY2siPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYi0xMiB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSI+U2lnbmF0dXJlIEV4YW1pbmF0ZXVyIDI8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy00OCBib3JkZXItYiBib3JkZXItYmxhY2siPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAge3Nob3dUZW1wbGF0ZUVkaXRvciAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgIDxUZW1wbGF0ZUVkaXRvciAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU9e3ZpZXdNb2RlfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlPXt0ZW1wbGF0ZXNbdmlld01vZGVdfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9eygpID0+IHNldFNob3dUZW1wbGF0ZUVkaXRvcihmYWxzZSl9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TYXZlPXtoYW5kbGVTYXZlVGVtcGxhdGV9IAogICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICBjb25zdCBIZWxwVmlldyA9ICgpID0+ICgKICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1heC13LTR4bCBteC1hdXRvIHNwYWNlLXktOCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcm91bmRlZC0yeGwgc2hhZG93LXNtIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIHAtOCI+CiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzTmFtZT0idGV4dC0yeGwgZm9udC1ibGFjayB0ZXh0LXNsYXRlLTgwMCBtYi02IGZsZXggaXRlbXMtY2VudGVyIGdhcC0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXRlYWwtMTAwIHAtMiByb3VuZGVkLWxnIHRleHQtdGVhbC03MDAiPjxIZWxwQ2lyY2xlIHNpemU9ezI4fSAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBHdWlkZSBkJ1V0aWxpc2F0aW9uIFJhcGlkZQogICAgICAgICAgICAgICAgICAgIDwvaDI+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC04IG1iLTgiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzTmFtZT0idGV4dC1sZyBmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJiZy1zbGF0ZS04MDAgdGV4dC13aGl0ZSB3LTYgaC02IHJvdW5kZWQtZnVsbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXhzIj4xPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZ3VyYXRpb24gJiBJbXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPSJzcGFjZS15LTMgdGV4dC1zbSB0ZXh0LXNsYXRlLTYwMCBtbC0yIGJvcmRlci1sLTIgYm9yZGVyLXNsYXRlLTEwMCBwbC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5Sw6lnbGV6IGxlcyBwYXJhbcOodHJlczwvc3Ryb25nPiAoaGV1cmUsIGRhdGUsIG5vbWJyZSBkZSBqdXJ5cykgZGFucyBsYSBiYXJyZSBkdSBoYXV0LjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+SW1wb3J0ZXogdm9zIGRvbm7DqWVzPC9zdHJvbmc+IHZpYSBsZXMgY2FzZXMgQ1NWIChQcm9mcyBldCDDiWzDqHZlcykgb3UgdXRpbGlzZXogbGUgYm91dG9uICJNb2RlIETDqW1vIiBwb3VyIHRlc3Rlci48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48ZW0+Q29uc3VsdGV6IGxhIHNlY3Rpb24gY2ktZGVzc291cyBwb3VyIGxlIGZvcm1hdCBkZXMgY29sb25uZXMgQ1NWLjwvZW0+PC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtbGcgZm9udC1ib2xkIHRleHQtc2xhdGUtNzAwIG1iLTQgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iYmctc2xhdGUtODAwIHRleHQtd2hpdGUgdy02IGgtNiByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC14cyI+Mjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDcsOpYXRpb24gZGVzIEp1cnlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT0ic3BhY2UteS0zIHRleHQtc20gdGV4dC1zbGF0ZS02MDAgbWwtMiBib3JkZXItbC0yIGJvcmRlci1zbGF0ZS0xMDAgcGwtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPkRhbnMgY2hhcXVlIGNvbG9ubmUgZGUgSnVyeSwgY2xpcXVleiBzdXIgPEVkaXQgc2l6ZT17MTJ9IGNsYXNzTmFtZT0iaW5saW5lIi8+IHBvdXIgPHN0cm9uZz5hc3NpZ25lciBsZXMgZXhhbWluYXRldXJzPC9zdHJvbmc+IGV0IGxhIHNhbGxlLjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPkxhIHLDqXBhcnRpdGlvbiBhdXRvbWF0aXF1ZSAoYm91dG9uIDxaYXAgc2l6ZT17MTJ9IGNsYXNzTmFtZT0iaW5saW5lIi8+KSB0ZW50ZSBkJ8OpcXVpbGlicmVyIGxlcyBqdXJ5cyBlbiByZXNwZWN0YW50IGxlcyBtYXRpw6hyZXMgc2kgcG9zc2libGUuPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtbGcgZm9udC1ib2xkIHRleHQtc2xhdGUtNzAwIG1iLTQgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iYmctc2xhdGUtODAwIHRleHQtd2hpdGUgdy02IGgtNiByb3VuZGVkLWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC14cyI+Mzwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZXN0aW9uIGR1IFBsYW5uaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT0ic3BhY2UteS0zIHRleHQtc20gdGV4dC1zbGF0ZS02MDAgbWwtMiBib3JkZXItbC0yIGJvcmRlci1zbGF0ZS0xMDAgcGwtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+R2xpc3Nlci1Ew6lwb3NlciA6PC9zdHJvbmc+IETDqXBsYWNleiBsZXMgw6lsw6h2ZXMgZGUgbGEgbGlzdGUgZCdhdHRlbnRlIHZlcnMgdW4ganVyeS48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPlLDqW9yZ2FuaXNlciA6PC9zdHJvbmc+IENoYW5nZXogbCdvcmRyZSBkZSBwYXNzYWdlIGF2ZWMgbGVzIGZsw6hjaGVzIGhhdXQvYmFzIHN1ciBsYSBjYXJ0ZSDDqWzDqHZlLjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+UGF1c2VzIDo8L3N0cm9uZz4gQWpvdXRleiBkZXMgcGF1c2VzIHZpYSBsYSBiYXJyZSBkJ291dGlscyAoUGF1c2UgR8OpbsOpcmFsZSkgb3UgZW4gZ2xpc3NhbnQgbGUgYmxvYyAiUEFVU0UiLjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPjxzdHJvbmc+SG9yYWlyZXMgOjwvc3Ryb25nPiBJbHMgc29udCBjYWxjdWzDqXMgYXV0b21hdGlxdWVtZW50IGVuIGZvbmN0aW9uIGRlIGxhIGR1csOpZSBkZSBjaGFxdWUgb3JhbC48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzTmFtZT0idGV4dC1sZyBmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJiZy1zbGF0ZS04MDAgdGV4dC13aGl0ZSB3LTYgaC02IHJvdW5kZWQtZnVsbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXhzIj40PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsaXNhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9InNwYWNlLXktMyB0ZXh0LXNtIHRleHQtc2xhdGUtNjAwIG1sLTIgYm9yZGVyLWwtMiBib3JkZXItc2xhdGUtMTAwIHBsLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPk9uZ2xldCBQaWxvdGFnZSA6PC9zdHJvbmc+IFbDqXJpZmlleiBsYSBjaGFyZ2UgZGUgdHJhdmFpbCBldCBsJ2hldXJlIGRlIGZpbiBkZSBjaGFxdWUganVyeS48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPkNvbnZvY2F0aW9ucyA6PC9zdHJvbmc+IENsaXF1ZXogc3VyICJDb252b2NhdGlvbnMiIHBvdXIgZ8OpbsOpcmVyIGxlcyBQREYgKMOJbMOodmVzLCBQcm9mcywgQUVTSCwgUFYsIMOJbWFyZ2VtZW50KS48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPlBlcnNvbm5hbGlzYXRpb24gOjwvc3Ryb25nPiDDiWRpdGV6IGxlIHRleHRlIGRlcyBjb252b2NhdGlvbnMgdmlhIGxlIGJvdXRvbiAiUGVyc29ubmFsaXNlciIgZGFucyBsZSBtb2RlIGltcHJlc3Npb24uPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5TYXV2ZWdhcmRlIDo8L3N0cm9uZz4gVm9zIGRvbm7DqWVzIHNvbnQgZW5yZWdpc3Ryw6llcyBhdXRvbWF0aXF1ZW1lbnQsIG1haXMgcGVuc2V6IMOgIHV0aWxpc2VyIGxlIGJvdXRvbiAiU2F1dmVnYXJkZXIiIHBvdXIgdMOpbMOpY2hhcmdlciBsZSBmaWNoaWVyIEpTT04gZGUgc8OpY3VyaXTDqS48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1zbGF0ZS01MCBwLTYgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtbGcgZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIG1iLTQgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgYm9yZGVyLWIgYm9yZGVyLXNsYXRlLTIwMCBwYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxGaWxlVGV4dCBzaXplPXsyMH0gY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTUwMCIvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RydWN0dXJlIGRlcyBmaWNoaWVycyBDU1YgKFPDqXBhcmF0ZXVyIHBvaW50LXZpcmd1bGUpCiAgICAgICAgICAgICAgICAgICAgICAgIDwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC02IHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtNCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItaW5kaWdvLTEwMCBzaGFkb3ctc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWluZGlnby03MDAgbWItMiBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+PFVzZXJzIHNpemU9ezE2fS8+IFByb2Zlc3NldXJzIChDb21tdW4pPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Y29kZSBjbGFzc05hbWU9ImJsb2NrIGJnLXNsYXRlLTEwMCBwLTIgcm91bmRlZCB0ZXh0LXNsYXRlLTcwMCBmb250LW1vbm8gdGV4dC14cyBtYi0yIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9NOyBQUkVOT007IENJVjsgTUFUSUVSRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvY29kZT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtc2xhdGUtNTAwIGxpc3QtZGlzYyBtbC00IHNwYWNlLXktMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPkNJViA6PC9zdHJvbmc+IE0uIG91IE1tZTwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPk1BVElFUkUgOjwvc3Ryb25nPiBDcnVjaWFsZSBwb3VyIGxhIGNvbXBhdGliaWxpdMOpIChleDogTUFUSFMsIEhJU1RPSVJFLCBBTkdMQUlTLi4uKTwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcC00IHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1ibHVlLTEwMCBzaGFkb3ctc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWJsdWUtNzAwIG1iLTIgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPjxCb29rT3BlbiBzaXplPXsxNn0vPiDDiWzDqHZlcyBETkI8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxjb2RlIGNsYXNzTmFtZT0iYmxvY2sgYmctc2xhdGUtMTAwIHAtMiByb3VuZGVkIHRleHQtc2xhdGUtNzAwIGZvbnQtbW9ubyB0ZXh0LXhzIG1iLTIgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT007IFBSRU5PTTsgRElWOyBUVDsgR1JPVVBFOyBQQVJDT1VSUzsgVEhFTUU7IExBTkdVRTsgQUVTSF9OT00KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2NvZGU+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT0idGV4dC14cyB0ZXh0LXNsYXRlLTUwMCBsaXN0LWRpc2MgbWwtNCBzcGFjZS15LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5UVCA6PC9zdHJvbmc+IE9VSSBvdSBOT04gKFRpZXJzLXRlbXBzKTwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPkdST1VQRSA6PC9zdHJvbmc+IElkZW50aWZpYW50IHBvdXIgbGllciBkZXMgw6lsw6h2ZXMgKGV4OiBHMSk8L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5QQVJDT1VSUyA6PC9zdHJvbmc+IEFWRU5JUiwgQ0lUT1lFTiwgUEVBQywgU0FOVEU8L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcC00IHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1lbWVyYWxkLTEwMCBzaGFkb3ctc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LWVtZXJhbGQtNzAwIG1iLTIgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPjxBd2FyZCBzaXplPXsxNn0vPiDDiWzDqHZlcyBDRkc8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxjb2RlIGNsYXNzTmFtZT0iYmxvY2sgYmctc2xhdGUtMTAwIHAtMiByb3VuZGVkIHRleHQtc2xhdGUtNzAwIGZvbnQtbW9ubyB0ZXh0LXhzIG1iLTIgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT007IFBSRU5PTTsgRElWOyBUVDsgQUVTSF9OT00KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2NvZGU+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtc2xhdGUtNTAwIGl0YWxpYyBtdC0yIj5Gb3JtYXQgc2ltcGxpZmnDqS4gUGFzIGRlIGdyb3VwZXMgcG91ciBsZSBDRkcuPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtNCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItcm9zZS0xMDAgc2hhZG93LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1yb3NlLTcwMCBtYi0yIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj48TWljIHNpemU9ezE2fS8+IMOJbMOodmVzIEdyYW5kIE9yYWw8L2g0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxjb2RlIGNsYXNzTmFtZT0iYmxvY2sgYmctc2xhdGUtMTAwIHAtMiByb3VuZGVkIHRleHQtc2xhdGUtNzAwIGZvbnQtbW9ubyB0ZXh0LXhzIG1iLTIgYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT007IFBSRU5PTTsgRElWOyBUVDsgRURTOyBBRVNIX05PTQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvY29kZT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtc2xhdGUtNTAwIGxpc3QtZGlzYyBtbC00IHNwYWNlLXktMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT48c3Ryb25nPkVEUyA6PC9zdHJvbmc+IEVuc2VpZ25lbWVudCBkZSBTcMOpY2lhbGl0w6kgKGV4OiBNQVRIw4lNQVRJUVVFUywgSEdHU1AuLi4pPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPlBldXQgw6p0cmUgZMOpZmluaSBtYW51ZWxsZW1lbnQgZGFucyBsJ2FwcGxpIHNpIGFic2VudCBkdSBDU1YuPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTMgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1ibHVlLTUwIHAtNiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItYmx1ZS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1ibHVlLTgwMCBtYi0yIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj48Qm9va09wZW4gc2l6ZT17MTh9Lz4gU3DDqWNpZmljaXTDqXMgRE5CPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LXNtIHRleHQtYmx1ZS03MDAiPkfDqHJlIGxlcyBvcmF1eCBpbmRpdmlkdWVscyBldCBjb2xsZWN0aWZzLiBJbmRpcXVlIGxhIGNvbXBhdGliaWxpdMOpIGVudHJlIGxlIHBhcmNvdXJzIGRlIGwnw6lsw6h2ZSBldCBsYSBtYXRpw6hyZSBkdSBwcm9mLjwvcD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctZW1lcmFsZC01MCBwLTYgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLWVtZXJhbGQtMTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzTmFtZT0iZm9udC1ib2xkIHRleHQtZW1lcmFsZC04MDAgbWItMiBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+PEF3YXJkIHNpemU9ezE4fS8+IFNww6ljaWZpY2l0w6lzIENGRzwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zbSB0ZXh0LWVtZXJhbGQtNzAwIj5PcmF1eCBkZSAyMCBtaW51dGVzLiBHZXN0aW9uIHNpbXBsaWZpw6llIHNhbnMgZ3JvdXBlcy4gTWFqb3JhdGlvbiBhdXRvbWF0aXF1ZSBkdSB0ZW1wcyBwb3VyIGxlcyBUaWVycy1UZW1wcy48L3A+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXJvc2UtNTAgcC02IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci1yb3NlLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzc05hbWU9ImZvbnQtYm9sZCB0ZXh0LXJvc2UtODAwIG1iLTIgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPjxNaWMgc2l6ZT17MTh9Lz4gR3JhbmQgT3JhbDwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zbSB0ZXh0LXJvc2UtNzAwIj5HZXN0aW9uIGRlcyBFbnNlaWduZW1lbnRzIGRlIFNww6ljaWFsaXTDqSAoRURTKS4gVsOpcmlmaWNhdGlvbiBkZSBsYSBjb21wYXRpYmlsaXTDqSBwcm9mL0VEUy4gQ2FsY3VsIGRlcyB0ZW1wcyBkZSBwcsOpcGFyYXRpb24uPC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICk7CgogICAgICAgIGZ1bmN0aW9uIEFwcCgpIHsKICAgICAgICAgICAgIGNvbnN0IFthY3RpdmVUYWIsIHNldEFjdGl2ZVRhYl0gPSB1c2VTdGF0ZSgnRE5CJyk7IAogICAgICAgICAgICBjb25zdCBbcGlsb3RhZ2VUeXBlLCBzZXRQaWxvdGFnZVR5cGVdID0gdXNlU3RhdGUoJ0ROQicpOwogICAgICAgICAgICBjb25zdCBbc2hvd1ByaW50LCBzZXRTaG93UHJpbnRdID0gdXNlU3RhdGUoZmFsc2UpOwogICAgICAgICAgICBjb25zdCBbc2Nob29sTmFtZSwgc2V0U2Nob29sTmFtZV0gPSB1c2VTdGF0ZSgnJyk7CiAgICAgICAgICAgIGNvbnN0IFtzY2hvb2xDaXR5LCBzZXRTY2hvb2xDaXR5XSA9IHVzZVN0YXRlKCcnKTsKICAgICAgICAgICAgY29uc3QgW3NjaG9vbExvZ28sIHNldFNjaG9vbExvZ29dID0gdXNlU3RhdGUobnVsbCk7IAogICAgICAgICAgICBjb25zdCBbc2Nob29sU3RhbXAsIHNldFNjaG9vbFN0YW1wXSA9IHVzZVN0YXRlKG51bGwpOyAvLyBBZGRlZCBzdGF0ZSBmb3IgU3RhbXAKICAgICAgICAgICAgY29uc3QgW3Nlc3Npb25ZZWFyLCBzZXRTZXNzaW9uWWVhcl0gPSB1c2VTdGF0ZSgnMjAyNicpOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IFtzaG93RWRzTW9kYWwsIHNldFNob3dFZHNNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICAgICAgICAgIGNvbnN0IFtzaG93R2VuZXJhbEVkaXRNb2RhbCwgc2V0U2hvd0dlbmVyYWxFZGl0TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpOwogICAgICAgICAgICBjb25zdCBbY3VycmVudFN0dWRlbnRGb3JFZHMsIHNldEN1cnJlbnRTdHVkZW50Rm9yRWRzXSA9IHVzZVN0YXRlKG51bGwpOwogICAgICAgICAgICBjb25zdCBbY3VycmVudFN0dWRlbnRGb3JHZW5lcmFsRWRpdCwgc2V0Q3VycmVudFN0dWRlbnRGb3JHZW5lcmFsRWRpdF0gPSB1c2VTdGF0ZShudWxsKTsKCiAgICAgICAgICAgIGNvbnN0IFtzaG93U2F2ZU1vZGFsLCBzZXRTaG93U2F2ZU1vZGFsXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAgICAgICAgICAgY29uc3QgW3NhdmVGaWxlTmFtZSwgc2V0U2F2ZUZpbGVOYW1lXSA9IHVzZVN0YXRlKCcnKTsKCiAgICAgICAgICAgIGNvbnN0IFtwcm9mcywgc2V0UHJvZnNdID0gdXNlU3RhdGUoW10pOwogICAgICAgICAgICBjb25zdCBbc3R1ZGVudHNETkIsIHNldFN0dWRlbnRzRE5CXSA9IHVzZVN0YXRlKFtdKTsKICAgICAgICAgICAgY29uc3QgW3N0dWRlbnRzQ0ZHLCBzZXRTdHVkZW50c0NGR10gPSB1c2VTdGF0ZShbXSk7CiAgICAgICAgICAgIGNvbnN0IFtzdHVkZW50c0dPLCBzZXRTdHVkZW50c0dPXSA9IHVzZVN0YXRlKFtdKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IFtwb29sRE5CLCBzZXRQb29sRE5CXSA9IHVzZVN0YXRlKFtdKTsKICAgICAgICAgICAgY29uc3QgW3Bvb2xDRkcsIHNldFBvb2xDRkddID0gdXNlU3RhdGUoW10pOwogICAgICAgICAgICBjb25zdCBbcG9vbEdPLCBzZXRQb29sR09dID0gdXNlU3RhdGUoW10pOwoKICAgICAgICAgICAgY29uc3QgW3NldHRpbmdzLCBzZXRTZXR0aW5nc10gPSB1c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBETkI6IHsgc3RhcnRUaW1lOiAnMDg6MDAnLCBqdXJ5Q291bnQ6IDUsIGRhdGU6ICcnLCBleGFtTmFtZTogJycgfSwKICAgICAgICAgICAgICAgIENGRzogeyBzdGFydFRpbWU6ICcwODozMCcsIGp1cnlDb3VudDogMiwgZGF0ZTogJycsIGV4YW1OYW1lOiAnJyB9LAogICAgICAgICAgICAgICAgR086ICB7IHN0YXJ0VGltZTogJzA4OjAwJywganVyeUNvdW50OiA1LCBkYXRlOiAnJywgZXhhbU5hbWU6ICcnIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyAuLi4gKEtlZXAgZXhpc3RpbmcgdGVtcGxhdGUgc3RhdGUpCiAgICAgICAgICAgIGNvbnN0IFt0ZW1wbGF0ZXMsIHNldFRlbXBsYXRlc10gPSB1c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBTVFVERU5UUzogewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiQ09OVk9DQVRJT04iLAogICAgICAgICAgICAgICAgICAgIGludHJvOiAiTWFkYW1lLCBNb25zaWV1ciwgY2hlcihlKSDDqWzDqHZlLFxuXG5Wb3VzIMOqdGVzIGNvbnZvcXXDqShlKSDDoCBwYXNzZXIgbCfDqXByZXV2ZSAqKntFUFJFVVZFfSoqIHF1aSBzZSBkw6lyb3VsZXJhIGxlIDoiLAogICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uczogIk11bmlzc2V6LXZvdXMgb2JsaWdhdG9pcmVtZW50IGRlIGNldHRlICoqY29udm9jYXRpb24qKiBldCBkJ3VuZSAqKnBpw6hjZSBkJ2lkZW50aXTDqSoqLiIsCiAgICAgICAgICAgICAgICAgICAgZm9vdGVyOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFBST0ZTOiB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJPUkRSRSBERSBNSVNTSU9OIiwKICAgICAgICAgICAgICAgICAgICBpbnRybzogIntDSVZ9ICoqe05PTX0qKixcblxuQ29uZm9ybcOpbWVudCDDoCBsYSByw6lnbGVtZW50YXRpb24gZGVzIGV4YW1lbnMsIHZvdXMgw6p0ZXMgY29udm9xdcOpKGUpIHBvdXIgcGFydGljaXBlciBhdXggw6lwcmV1dmVzICoqe0VQUkVVVkV9IFNlc3Npb24ge1NFU1NJT059KiogZW4gcXVhbGl0w6kgZCdleGFtaW5hdGV1ci4iLAogICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uczogIkTDqXJvdWxlbWVudCBkZSBsYSBtaXNzaW9uIDpcblxuLSAqKkggLSAxNW1pbioqIDogUsOpdW5pb24gcHLDqXBhcmF0b2lyZS4gUsOpY3Vww6lyYXRpb24gZGVzIGRvc3NpZXJzIGV0IGJvcmRlcmVhdXguXG4tICoqe0hFVVJFX0RFQlVUfSoqIDogRMOpYnV0IGRlcyBpbnRlcnJvZ2F0aW9ucyBvcmFsZXMgc2Vsb24gbGUgcGxhbm5pbmcgam9pbnQuXG4tICoqRmluKiogOiBEw6lsaWLDqXJhdGlvbiBkdSBqdXJ5IGV0IHJlbWlzZSBkZXMgZG9zc2llcnMgY29tcGxldHMgYXUgc2VjcsOpdGFyaWF0IGQnZXhhbWVuLiIsCiAgICAgICAgICAgICAgICAgICAgZm9vdGVyOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEFFU0g6IHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIk9SRFJFIERFIE1JU1NJT04gQUVTSCIsCiAgICAgICAgICAgICAgICAgICAgaW50cm86ICJNLi9NbWUgKip7Tk9NfSB7UFJFTk9NfSoqLFxuXG5Wb3VzIMOqdGVzIHByacOpKGUpIGQnYWNjb21wYWduZXIgbGVzIMOpbMOodmVzIHN1aXZhbnRzIGxvcnMgZGVzIMOpcHJldXZlcyAqKntFUFJFVVZFfSBTZXNzaW9uIHtTRVNTSU9OfSoqIHF1aSBzZSBkw6lyb3VsZXJvbnQgbGUgKip7REFURV9FWEFNfSoqIDoiLAogICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uczogIlJhcHBlbCBkZXMgY29uc2lnbmVzIDpcblxuLSBQcsOpc2VudGV6LXZvdXMgZGV2YW50IGxhIHNhbGxlIGQnZXhhbWVuIDE1IG1pbnV0ZXMgYXZhbnQgbCdob3JhaXJlIGluZGlxdcOpLlxuLSBBY2NvbXBhZ25leiBsJ8OpbMOodmUgZHVyYW50IGxlIHRlbXBzIGRlIHByw6lwYXJhdGlvbiBldCBsZSB0ZW1wcyBkZSBwYXNzYWdlIHNlbG9uIGxlcyBtb2RhbGl0w6lzIGRlIHNvbiBQUFMvUEFQLlxuLSBWZWlsbGV6IMOgIGxhIGNvbmZpZGVudGlhbGl0w6kgZGVzIMOpY2hhbmdlcy4iLAogICAgICAgICAgICAgICAgICAgIGZvb3RlcjogIiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBbYnJlYWtDb25maWcsIHNldEJyZWFrQ29uZmlnXSA9IHVzZVN0YXRlKHsgdGltZTogJzEwOjAwJywgZHVyYXRpb246IDE1IH0pOwoKICAgICAgICAgICAgY29uc3QgW3NlYXJjaFRlcm0sIHNldFNlYXJjaFRlcm1dID0gdXNlU3RhdGUoIiIpOwoKICAgICAgICAgICAgY29uc3QgW2p1cmllcywgc2V0SnVyaWVzXSA9IHVzZVN0YXRlKHsgRE5COiB7fSwgQ0ZHOiB7fSwgR086IHt9IH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLi4uIChPdGhlciBmdW5jdGlvbnMgc3RheSB0aGUgc2FtZSwgSSB3aWxsIGp1c3QgY2FsbCBBcHApIC4uLgogICAgICAgICAgICBjb25zdCBnZW5lcmF0ZURlbW9EYXRhID0gKCkgPT4gewogICAgICAgICAgICAgICAgaWYoIWNvbmZpcm0oIkNoYXJnZXIgbGVzIGRvbm7DqWVzIGRlIGTDqW1vbnN0cmF0aW9uID8gKENlbGEgZWZmYWNlcmEgbGVzIGRvbm7DqWVzIGFjdHVlbGxlcykiKSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNvbnN0IGRlbW9Qcm9mcyA9IFsKICAgICAgICAgICAgICAgICAgICB7IGlkOiAnUDEnLCBDSVY6ICdNLicsIE5PTTogJ0RVUE9OVCcsIFBSRU5PTTogJ0plYW4nLCBNQVRJRVJFOiAnTUFUSMOJTUFUSVFVRVMnIH0sIAogICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdQMicsIENJVjogJ01tZScsIE5PTTogJ0RVUkFORCcsIFBSRU5PTTogJ1NvcGhpZScsIE1BVElFUkU6ICdMRVRUUkVTIE1PREVSTkVTJyB9LCAKICAgICAgICAgICAgICAgICAgICB7IGlkOiAnUDMnLCBDSVY6ICdNLicsIE5PTTogJ01BUlRJTicsIFBSRU5PTTogJ1BhdWwnLCBNQVRJRVJFOiAnSElTVE9JUkUtR8OJTycgfSwgCiAgICAgICAgICAgICAgICAgICAgeyBpZDogJ1A0JywgQ0lWOiAnTW1lJywgTk9NOiAnQkVSTkFSRCcsIFBSRU5PTTogJ0p1bGllJywgTUFUSUVSRTogJ0FOR0xBSVMnIH0sCiAgICAgICAgICAgICAgICAgICAgeyBpZDogJ1A1JywgQ0lWOiAnTS4nLCBOT006ICdQRVRJVCcsIFBSRU5PTTogJ1Rob21hcycsIE1BVElFUkU6ICdTVlQnIH0sCiAgICAgICAgICAgICAgICAgICAgeyBpZDogJ1A2JywgQ0lWOiAnTW1lJywgTk9NOiAnUk9CRVJUJywgUFJFTk9NOiAnQ8OpbGluZScsIE1BVElFUkU6ICdQSFlTSVFVRS1DSElNSUUnIH0sIAogICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdQNycsIENJVjogJ00uJywgTk9NOiAnUklDSEFSRCcsIFBSRU5PTTogJ0x1YycsIE1BVElFUkU6ICdURUNITk9MT0dJRScgfSwKICAgICAgICAgICAgICAgICAgICB7IGlkOiAnUDgnLCBDSVY6ICdNbWUnLCBOT006ICdNT1JFQVUnLCBQUkVOT006ICdNYXJpZScsIE1BVElFUkU6ICdFU1BBR05PTCcgfSwgCiAgICAgICAgICAgICAgICAgICAgeyBpZDogJ1A5JywgQ0lWOiAnTS4nLCBOT006ICdTSU1PTicsIFBSRU5PTTogJ05pY29sYXMnLCBNQVRJRVJFOiAnRVBTJyB9LAogICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdQMTAnLCBDSVY6ICdNbWUnLCBOT006ICdMQVVSRU5UJywgUFJFTk9NOiAnSXNhYmVsbGUnLCBNQVRJRVJFOiAnUEhJTE9TT1BISUUnIH0sIAogICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdQMTEnLCBDSVY6ICdNLicsIE5PTTogJ0xFRkVCVlJFJywgUFJFTk9NOiAnUGllcnJlJywgTUFUSUVSRTogJ1NFUycgfSwgCiAgICAgICAgICAgICAgICAgICAgeyBpZDogJ1AxMicsIENJVjogJ01tZScsIE5PTTogJ01JQ0hFTCcsIFBSRU5PTTogJ0ZyYW7Dp29pc2UnLCBNQVRJRVJFOiAnTlNJJyB9LCAKICAgICAgICAgICAgICAgICAgICB7IGlkOiAnUDEzJywgQ0lWOiAnTS4nLCBOT006ICdHQVJDSUEnLCBQUkVOT006ICdBbnRvbmlvJywgTUFUSUVSRTogJ1NUTUcgRUNPLUdFU1RJT04nIH0sIAogICAgICAgICAgICAgICAgICAgIHsgaWQ6ICdQMTQnLCBDSVY6ICdNbWUnLCBOT006ICdEVUJPSVMnLCBQUkVOT006ICdDbGFpcmUnLCBNQVRJRVJFOiAnQVJUUyBQTEFTVElRVUVTJyB9IAogICAgICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICAgICBjb25zdCBkZW1vRE5CID0gWwogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnQURBTScsIFBSRU5PTTogJ05hdGhhbicsIERJVjogJzNBJywgUEFSQ09VUlM6ICdQQVJDT1VSUyBDSVRPWUVOJywgVEhFTUU6ICJMJ2VuZ2FnZW1lbnQiLCBMQU5HVUU6ICdBTkdMQUlTJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnQkFSQklFUicsIFBSRU5PTTogJ0zDqWEnLCBESVY6ICczQScsIFBBUkNPVVJTOiAnUEVBQycsIFRIRU1FOiAiQXJ0IGV0IHBvdXZvaXIiLCBMQU5HVUU6ICdFU1BBR05PTCcsIEdST1VQRTogJ0cxJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnQ0hBUkxFUycsIFBSRU5PTTogJ0h1Z28nLCBESVY6ICczQScsIFBBUkNPVVJTOiAnUEVBQycsIFRIRU1FOiAiQXJ0IGV0IHBvdXZvaXIiLCBMQU5HVUU6ICdFU1BBR05PTCcsIEdST1VQRTogJ0cxJyB9LCAKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ0RBVklEJywgUFJFTk9NOiAnRW1tYScsIERJVjogJzNCJywgUEFSQ09VUlM6ICdBVkVOSVInLCBUSEVNRTogIk1vbiBzdGFnZSIsIExBTkdVRTogJ0FOR0xBSVMnLCBUVDogJ09VSScsIEFFU0hfTk9NOiAnRFVQT05UJywgQUVTSF9QUkVOT006ICdNYXJpZScgfSwKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ0VWQU5TJywgUFJFTk9NOiAnVG9tJywgRElWOiAnM0InLCBQQVJDT1VSUzogJ1NBTlTDiScsIFRIRU1FOiAiTGUgc29tbWVpbCIsIExBTkdVRTogJ0FOR0xBSVMnIH0sCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdGQUJSRScsIFBSRU5PTTogJ0NobG/DqScsIERJVjogJzNDJywgUEFSQ09VUlM6ICdDSVRPWUVOJywgVEhFTUU6ICJMYSBsYcOvY2l0w6kiLCBMQU5HVUU6ICdBTExFTUFORCcgfSwKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ0dJUkFSRCcsIFBSRU5PTTogJ0xvdWlzJywgRElWOiAnM0MnLCBQQVJDT1VSUzogJ0FWRU5JUicsIFRIRU1FOiAiTcOpdGllcnMgZHUgYm9pcyIsIExBTkdVRTogJ0FOR0xBSVMnIH0sCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdIRU5SWScsIFBSRU5PTTogJ0phZGUnLCBESVY6ICczQScsIFBBUkNPVVJTOiAnUEVBQycsIFRIRU1FOiAiU3RyZWV0IEFydCIsIExBTkdVRTogJ0VTUEFHTk9MJywgR1JPVVBFOiAnRzInIH0sCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdJVkFOT1YnLCBQUkVOT006ICdTYWNoYScsIERJVjogJzNBJywgUEFSQ09VUlM6ICdQRUFDJywgVEhFTUU6ICJTdHJlZXQgQXJ0IiwgTEFOR1VFOiAnRVNQQUdOT0wnLCBHUk9VUEU6ICdHMicgfSwKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ0pPTFknLCBQUkVOT006ICdTYXJhaCcsIERJVjogJzNCJywgUEFSQ09VUlM6ICdDSVRPWUVOJywgVEhFTUU6ICJMZSBkZXZvaXIgZGUgbcOpbW9pcmUiLCBMQU5HVUU6ICdBTkdMQUlTJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnS0xFSU4nLCBQUkVOT006ICdOb2FoJywgRElWOiAnM0InLCBQQVJDT1VSUzogJ1NBTlTDiScsIFRIRU1FOiAiQWRkaWN0aW9ucyIsIExBTkdVRTogJ0FOR0xBSVMnLCBUVDogJ09VSScgfSwKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ0xFQ0xFUkMnLCBQUkVOT006ICdJbsOocycsIERJVjogJzNDJywgUEFSQ09VUlM6ICdBVkVOSVInLCBUSEVNRTogIkFybcOpZSBkZSB0ZXJyZSIsIExBTkdVRTogJ0VTUEFHTk9MJyB9CiAgICAgICAgICAgICAgICBdOwoKICAgICAgICAgICAgICAgIGNvbnN0IGRlbW9DRkcgPSBbCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdNQVJUSU4nLCBQUkVOT006ICdMdWNhcycsIERJVjogJzNTRUdQQScsIFRUOiAnTk9OJywgQUVTSF9OT006ICdEVVJBTkQnLCBBRVNIX1BSRU5PTTogJ1BpZXJyZScgfSwKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ05PRUwnLCBQUkVOT006ICdDYW1pbGxlJywgRElWOiAnM1NFR1BBJywgVFQ6ICdPVUknIH0sCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdPVURJTicsIFBSRU5PTTogJ0Vuem8nLCBESVY6ICczVUxJUycsIFRUOiAnT1VJJywgQUVTSF9OT006ICdEVVJBTkQnLCBBRVNIX1BSRU5PTTogJ1BpZXJyZScgfSwKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ1BFUlJJTicsIFBSRU5PTTogJ01hbm9uJywgRElWOiAnM1BSRVBBJywgVFQ6ICdOT04nIH0sCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdRVUVOVElOJywgUFJFTk9NOiAnVGjDqW8nLCBESVY6ICczU0VHUEEnLCBUVDogJ05PTicgfQogICAgICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICAgICBjb25zdCBkZW1vR08gPSBbCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdST1VTU0VBVScsIFBSRU5PTTogJ0FsaWNlJywgRElWOiAnVDEnLCBFRFM6ICdNYXRow6ltYXRpcXVlcycsIFRUOiAnTk9OJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnU0lNT04nLCBQUkVOT006ICdCb2InLCBESVY6ICdUMScsIEVEUzogJ1BoeXNpcXVlLUNoaW1pZScsIFRUOiAnTk9OJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnVEhPTUFTJywgUFJFTk9NOiAnQ2xhcmEnLCBESVY6ICdUMicsIEVEUzogJ0hHR1NQJywgVFQ6ICdOT04nIH0sCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdVUkJBSU4nLCBQUkVOT006ICdEYXZpZCcsIERJVjogJ1QyJywgRURTOiAnSExQIChIdW1hbml0w6lzKScsIFRUOiAnT1VJJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnVkFMTEVUJywgUFJFTk9NOiAnRXZhJywgRElWOiAnVDMnLCBFRFM6ICdTRVMnLCBUVDogJ05PTicgfSwKICAgICAgICAgICAgICAgICAgICB7IE5PTTogJ1dPTEZGJywgUFJFTk9NOiAnRnJlZCcsIERJVjogJ1QzJywgRURTOiAnTlNJIChOdW3DqXJpcXVlKScsIFRUOiAnTk9OJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnWEFWSUVSJywgUFJFTk9NOiAnR2luYScsIERJVjogJ1Q0JywgRURTOiAnU1ZUJywgVFQ6ICdOT04nIH0sCiAgICAgICAgICAgICAgICAgICAgeyBOT006ICdZVk9OJywgUFJFTk9NOiAnSHVnbycsIERJVjogJ1Q0JywgRURTOiAnTExDRVIgQW5nbGFpcycsIFRUOiAnTk9OJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnWk9MQScsIFBSRU5PTTogJ0lyaXMnLCBESVY6ICdUU1RNRycsIEVEUzogJ0Ryb2l0IGV0IMOJY29ub21pZScsIFRUOiAnTk9OJyB9LAogICAgICAgICAgICAgICAgICAgIHsgTk9NOiAnQVJOQVVEJywgUFJFTk9NOiAnSnVsZXMnLCBESVY6ICdUU1RNRycsIEVEUzogJ01hbmFnZW1lbnQsIFNjLiBHZXN0aW9uIChNZXJjYXRpcXVlKScsIFRUOiAnT1VJJyB9CiAgICAgICAgICAgICAgICBdOwoKICAgICAgICAgICAgICAgIHNldFByb2ZzKGRlbW9Qcm9mcyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNldFN0dWRlbnRzRE5CKHByb2Nlc3NTdHVkZW50cyhkZW1vRE5CLCAnRE5CJykpOwogICAgICAgICAgICAgICAgc2V0UG9vbEROQihwcm9jZXNzU3R1ZGVudHMoZGVtb0ROQiwgJ0ROQicpKTsKCiAgICAgICAgICAgICAgICBzZXRTdHVkZW50c0NGRyhwcm9jZXNzU3R1ZGVudHMoZGVtb0NGRywgJ0NGRycpKTsKICAgICAgICAgICAgICAgIHNldFBvb2xDRkcocHJvY2Vzc1N0dWRlbnRzKGRlbW9DRkcsICdDRkcnKSk7CgogICAgICAgICAgICAgICAgc2V0U3R1ZGVudHNHTyhwcm9jZXNzU3R1ZGVudHMoZGVtb0dPLCAnR08nKSk7CiAgICAgICAgICAgICAgICBzZXRQb29sR08ocHJvY2Vzc1N0dWRlbnRzKGRlbW9HTywgJ0dPJykpOwoKICAgICAgICAgICAgICAgIHNldFNjaG9vbE5hbWUoIkNvbGzDqGdlLUx5Y8OpZSBEw6ltb25zdHJhdGlvbiIpOwogICAgICAgICAgICAgICAgc2V0U2Nob29sQ2l0eSgiUGFyaXMiKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0SnVyaWVzKHByZXYgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc2V0SnVyaWVzID0gKHR5cGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHByZXZbdHlwZV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ogPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoY3VycmVudCkuZm9yRWFjaChrID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0pba10gPSB7IC4uLmN1cnJlbnRba10sIHN0dWRlbnRzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0o7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBETkI6IHJlc2V0SnVyaWVzKCdETkInKSwKICAgICAgICAgICAgICAgICAgICAgICAgQ0ZHOiByZXNldEp1cmllcygnQ0ZHJyksCiAgICAgICAgICAgICAgICAgICAgICAgIEdPOiByZXNldEp1cmllcygnR08nKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBhbGVydCgiRG9ubsOpZXMgZGUgZMOpbW9uc3RyYXRpb24gY2hhcmfDqWVzICEiKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIC4uLiAoS2VlcCBleGlzdGluZyBoZWxwZXIgZnVuY3Rpb25zKQogICAgICAgICAgICBjb25zdCBwcm9jZXNzU3R1ZGVudHMgPSAoZGF0YSwgdHlwZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gZGF0YS5tYXAoKHMsIGkpID0+ICh7CiAgICAgICAgICAgICAgICAgICAgLi4ucywKICAgICAgICAgICAgICAgICAgICBpZDogYCR7dHlwZX0tJHtEYXRlLm5vdygpfS0ke2l9YCwKICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgX2lzVFQ6IChzLlRUICYmIChzLlRUID09PSAnT1VJJyB8fCBub3JtYWxpemVUZXh0KHMuVFQpLmluY2x1ZGVzKCdUSUVSUycpKSksCiAgICAgICAgICAgICAgICAgICAgX2lzR3JvdXA6IChzLkdST1VQRSAmJiBzLkdST1VQRS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gWy4uLnByb2Nlc3NlZF0uc29ydCgoYSxiKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdETkInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdBID0gKGEuR1JPVVBFIHx8ICcnKS50b1N0cmluZygpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ0IgPSAoYi5HUk9VUEUgfHwgJycpLnRvU3RyaW5nKCkudHJpbSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0dBID0gZ0EgJiYgZ0EudG9VcHBlckNhc2UoKSAhPT0gJ05PTic7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzR0IgPSBnQiAmJiBnQi50b1VwcGVyQ2FzZSgpICE9PSAnTk9OJzsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0dBICYmICFpc0dCKSByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNHQSAmJiBpc0dCKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0dBICYmIGlzR0IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNtcCA9IGdBLmxvY2FsZUNvbXBhcmUoZ0IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtcCAhPT0gMCkgcmV0dXJuIGNtcDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5OT00ubG9jYWxlQ29tcGFyZShiLk5PTSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVByb2ZzTG9hZCA9IChkYXRhKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gZGF0YS5tYXAoKGQsIGkpID0+ICh7IC4uLmQsIGlkOiBgUFJPRi0ke2l9YCB9KSk7CiAgICAgICAgICAgICAgICBzZXRQcm9mcyhwKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVN0dWRlbnRzRE5CTG9hZCA9IChkYXRhKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzID0gcHJvY2Vzc1N0dWRlbnRzKGRhdGEsICdETkInKTsKICAgICAgICAgICAgICAgIHNldFN0dWRlbnRzRE5CKHMpOwogICAgICAgICAgICAgICAgc2V0UG9vbEROQihzKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVN0dWRlbnRzQ0ZHTG9hZCA9IChkYXRhKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzID0gcHJvY2Vzc1N0dWRlbnRzKGRhdGEsICdDRkcnKTsKICAgICAgICAgICAgICAgIHNldFN0dWRlbnRzQ0ZHKHMpOwogICAgICAgICAgICAgICAgc2V0UG9vbENGRyhzKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVN0dWRlbnRzR09Mb2FkID0gKGRhdGEpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBwcm9jZXNzU3R1ZGVudHMoZGF0YSwgJ0dPJyk7CiAgICAgICAgICAgICAgICBzZXRTdHVkZW50c0dPKHMpOwogICAgICAgICAgICAgICAgc2V0UG9vbEdPKHMpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3Qgb3BlbkVkc01vZGFsID0gKHN0dWRlbnQpID0+IHsKICAgICAgICAgICAgICAgIHNldEN1cnJlbnRTdHVkZW50Rm9yRWRzKHN0dWRlbnQpOwogICAgICAgICAgICAgICAgc2V0U2hvd0Vkc01vZGFsKHRydWUpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3Qgb3BlbkdlbmVyYWxFZGl0TW9kYWwgPSAoc3R1ZGVudCkgPT4gewogICAgICAgICAgICAgICAgc2V0Q3VycmVudFN0dWRlbnRGb3JHZW5lcmFsRWRpdChzdHVkZW50KTsKICAgICAgICAgICAgICAgIHNldFNob3dHZW5lcmFsRWRpdE1vZGFsKHRydWUpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3Qgc2F2ZUVkcyA9IChzdHVkZW50SWQsIGVkc1ZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVTdHVkZW50ID0gKHMpID0+IHMuaWQgPT09IHN0dWRlbnRJZCA/IHsgLi4ucywgRURTOiBlZHNWYWx1ZSB9IDogczsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0U3R1ZGVudHNHTyhwcmV2ID0+IHByZXYubWFwKHVwZGF0ZVN0dWRlbnQpKTsKICAgICAgICAgICAgICAgIHNldFBvb2xHTyhwcmV2ID0+IHByZXYubWFwKHVwZGF0ZVN0dWRlbnQpKTsKICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdHT0p1cmllcyA9IHsgLi4ucHJldi5HTyB9OwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKG5ld0dPSnVyaWVzKS5mb3JFYWNoKGppZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0dPSnVyaWVzW2ppZF0uc3R1ZGVudHMgPSBuZXdHT0p1cmllc1tqaWRdLnN0dWRlbnRzLm1hcCh1cGRhdGVTdHVkZW50KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wcmV2LCBHTzogbmV3R09KdXJpZXMgfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZXRTaG93RWRzTW9kYWwoZmFsc2UpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3Qgc2F2ZUdlbmVyYWxTdHVkZW50ID0gKHVwZGF0ZWRTdHVkZW50KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gYWN0aXZlVGFiOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkU3R1ZGVudCA9IHsKICAgICAgICAgICAgICAgICAgICAuLi51cGRhdGVkU3R1ZGVudCwKICAgICAgICAgICAgICAgICAgICBfaXNUVDogKHVwZGF0ZWRTdHVkZW50LlRUID09PSAnT1VJJyB8fCB1cGRhdGVkU3R1ZGVudC5UVCA9PT0gdHJ1ZSB8fCAodHlwZW9mIHVwZGF0ZWRTdHVkZW50LlRUID09PSAnc3RyaW5nJyAmJiB1cGRhdGVkU3R1ZGVudC5UVC5pbmNsdWRlcygnVElFUlMnKSkpLAogICAgICAgICAgICAgICAgICAgIF9pc0dyb3VwOiAodXBkYXRlZFN0dWRlbnQuR1JPVVBFICYmIHVwZGF0ZWRTdHVkZW50LkdST1VQRS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVMb2dpYyA9IChwcmV2KSA9PiBwcmV2Lm1hcChzID0+IHMuaWQgPT09IHByb2Nlc3NlZFN0dWRlbnQuaWQgPyBwcm9jZXNzZWRTdHVkZW50IDogcyk7CgogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdETkInKSBzZXRTdHVkZW50c0ROQih1cGRhdGVMb2dpYyk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnQ0ZHJykgc2V0U3R1ZGVudHNDRkcodXBkYXRlTG9naWMpOwogICAgICAgICAgICAgICAgZWxzZSBzZXRTdHVkZW50c0dPKHVwZGF0ZUxvZ2ljKTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ0ROQicpIHNldFBvb2xETkIodXBkYXRlTG9naWMpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ0NGRycpIHNldFBvb2xDRkcodXBkYXRlTG9naWMpOwogICAgICAgICAgICAgICAgZWxzZSBzZXRQb29sR08odXBkYXRlTG9naWMpOwoKICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SnVyaWVzID0geyAuLi5wcmV2W3R5cGVdIH07CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoY3VycmVudEp1cmllcykuZm9yRWFjaChqaWQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50SnVyaWVzW2ppZF0uc3R1ZGVudHMgPSBjdXJyZW50SnVyaWVzW2ppZF0uc3R1ZGVudHMubWFwKHMgPT4gcy5pZCA9PT0gcHJvY2Vzc2VkU3R1ZGVudC5pZCA/IHByb2Nlc3NlZFN0dWRlbnQgOiBzKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wcmV2LCBbdHlwZV06IGN1cnJlbnRKdXJpZXMgfTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHNldFNob3dHZW5lcmFsRWRpdE1vZGFsKGZhbHNlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUF1dG9EaXN0cmlidXRpb24gPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gYWN0aXZlVGFiOwogICAgICAgICAgICAgICAgbGV0IHBvb2wsIHNldFBvb2w7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ0ROQicpIHsgcG9vbCA9IHBvb2xETkI7IHNldFBvb2wgPSBzZXRQb29sRE5COyB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnQ0ZHJykgeyBwb29sID0gcG9vbENGRzsgc2V0UG9vbCA9IHNldFBvb2xDRkc7IH0KICAgICAgICAgICAgICAgIGVsc2UgeyBwb29sID0gcG9vbEdPOyBzZXRQb29sID0gc2V0UG9vbEdPOyB9CgogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEp1cmllcyA9IGp1cmllc1t0eXBlXTsKICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUp1cnlJZHMgPSBPYmplY3Qua2V5cyhjdXJyZW50SnVyaWVzKTsKCiAgICAgICAgICAgICAgICBpZiAocG9vbC5sZW5ndGggPT09IDApIHsgYWxlcnQoIkF1Y3VuIMOpbMOodmUgZGFucyBsYSBsaXN0ZSBkJ2F0dGVudGUuIik7IHJldHVybjsgfQogICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUp1cnlJZHMubGVuZ3RoID09PSAwKSB7IGFsZXJ0KCJBdWN1biBqdXJ5IGNvbmZpZ3Vyw6kuIik7IHJldHVybjsgfQogICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKGBSw6lwYXJ0aXIgJHtwb29sLmxlbmd0aH0gw6lsw6h2ZXMgc3VyICR7YWN0aXZlSnVyeUlkcy5sZW5ndGh9IGp1cnlzID9gKSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0p1cmllc1N0YXRlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjdXJyZW50SnVyaWVzKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCB1bml0c1RvQXNzaWduID0gW107CgogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdETkInKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBzTWFwID0ge307CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2luZ2xlcyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICBwb29sLmZvckVhY2gocyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdSYXcgPSAocy5HUk9VUEUgfHwgJycpLnRvU3RyaW5nKCkudHJpbSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBnTmFtZSA9IGdSYXcudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdOYW1lICYmIGdOYW1lICE9PSAnTk9OJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFncm91cHNNYXBbZ05hbWVdKSBncm91cHNNYXBbZ05hbWVdID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cHNNYXBbZ05hbWVdLnB1c2gocyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVzLnB1c2gocyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZ3JvdXBzTWFwKS5zb3J0KCkuZm9yRWFjaChnTmFtZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXRzVG9Bc3NpZ24ucHVzaCh7IHN0dWRlbnRzOiBncm91cHNNYXBbZ05hbWVdLCBpc0dyb3VwOiB0cnVlLCBpZDogYEdSUC0ke2dOYW1lfWAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2luZ2xlcy5mb3JFYWNoKHMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB1bml0c1RvQXNzaWduLnB1c2goeyBzdHVkZW50czogW3NdLCBpc0dyb3VwOiBmYWxzZSwgaWQ6IHMuaWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB1bml0c1RvQXNzaWduID0gcG9vbC5tYXAocyA9PiAoeyBzdHVkZW50czogW3NdLCBpc0dyb3VwOiBmYWxzZSwgaWQ6IHMuaWQgfSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHVuaXRzVG9Bc3NpZ24uc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc1RUX0EgPSBhLnN0dWRlbnRzLnNvbWUocyA9PiBzLl9pc1RUKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNUVF9CID0gYi5zdHVkZW50cy5zb21lKHMgPT4gcy5faXNUVCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1RUX0EgPT09IGhhc1RUX0IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3R1ZGVudHNbMF0uTk9NLmxvY2FsZUNvbXBhcmUoYi5zdHVkZW50c1swXS5OT00pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGFzVFRfQSA/IDEgOiAtMTsgCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB1bml0c1RvQXNzaWduLmZvckVhY2godW5pdCA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGJlc3RKdXJ5SWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGxldCBtaW5TY29yZSA9IEluZmluaXR5OwoKICAgICAgICAgICAgICAgICAgICBhY3RpdmVKdXJ5SWRzLmZvckVhY2goanVyeUlkID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QganVyeSA9IG5ld0p1cmllc1N0YXRlW2p1cnlJZF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2YxID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnkucHJvZjFJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2YyID0gcHJvZnMuZmluZChwID0+IHAuaWQgPT09IGp1cnkucHJvZjJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2NvcmUgPSAoanVyeS5zdHVkZW50cy5sZW5ndGggKyB1bml0LnN0dWRlbnRzLmxlbmd0aCkgKiAxMDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodHlwZSA9PT0gJ0ROQicgfHwgdHlwZSA9PT0gJ0dPJykgJiYgKHByb2YxIHx8IHByb2YyKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdC5zdHVkZW50cy5mb3JFYWNoKHN0dWRlbnQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBhdCA9IGNoZWNrQ29tcGF0aWJpbGl0eShzdHVkZW50LCBbcHJvZjEsIHByb2YyXSwgdHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBhdCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZSAtPSA1MDsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wYXQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlICs9IDEwMDsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29yZSA8IG1pblNjb3JlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5TY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVzdEp1cnlJZCA9IGp1cnlJZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoYmVzdEp1cnlJZCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bml0LnN0dWRlbnRzLmZvckVhY2goc3R1ZGVudCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdKdXJpZXNTdGF0ZVtiZXN0SnVyeUlkXS5zdHVkZW50cy5wdXNoKHN0dWRlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBzZXRKdXJpZXMocHJldiA9PiAoeyAuLi5wcmV2LCBbdHlwZV06IG5ld0p1cmllc1N0YXRlIH0pKTsKICAgICAgICAgICAgICAgIHNldFBvb2woW10pOwogICAgICAgICAgICAgICAgYWxlcnQoIlLDqXBhcnRpdGlvbiB0ZXJtaW7DqWUgISIpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgaGFuZGxlRW1wdHlKdXJpZXMgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWNvbmZpcm0oIlZvdWxlei12b3VzIHZyYWltZW50IHZpZGVyIHRvdXMgbGVzIGp1cnlzIGRlIGNldCBvbmdsZXQgZXQgcmVtZXR0cmUgbGVzIMOpbMOodmVzIGVuIGF0dGVudGUgPyIpKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBhY3RpdmVUYWI7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SnVyaWVzID0ganVyaWVzW3R5cGVdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgc3R1ZGVudHNSZWNvdmVyZWQgPSBbXTsKICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMoY3VycmVudEp1cmllcykuZm9yRWFjaChqdXJ5ID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IGtlZXAgbm9uLWJyZWFrIGl0ZW1zIGFuZCBub24tZ2VuZXJhdGVkIGl0ZW1zIGlmIG5lZWRlZCwgYnV0IGhlcmUgd2UganVzdCB0YWtlIHN0dWRlbnRzIGJhY2sKICAgICAgICAgICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IGJyZWFrcyBpZiB0aGV5IGFyZSBqdXN0IGJyZWFrcwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYWxTdHVkZW50cyA9IGp1cnkuc3R1ZGVudHMuZmlsdGVyKHMgPT4gIXMuaXNCcmVhayk7CiAgICAgICAgICAgICAgICAgICAgc3R1ZGVudHNSZWNvdmVyZWQgPSBbLi4uc3R1ZGVudHNSZWNvdmVyZWQsIC4uLnJlYWxTdHVkZW50c107CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ0ROQicpIHNldFBvb2xETkIocHJldiA9PiBbLi4ucHJldiwgLi4uc3R1ZGVudHNSZWNvdmVyZWRdKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdDRkcnKSBzZXRQb29sQ0ZHKHByZXYgPT4gWy4uLnByZXYsIC4uLnN0dWRlbnRzUmVjb3ZlcmVkXSk7CiAgICAgICAgICAgICAgICBlbHNlIHNldFBvb2xHTyhwcmV2ID0+IFsuLi5wcmV2LCAuLi5zdHVkZW50c1JlY292ZXJlZF0pOwoKICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdKdXJpZXNUeXBlID0ge307CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocHJldlt0eXBlXSkuZm9yRWFjaChqaWQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBuZXdKdXJpZXNUeXBlW2ppZF0gPSB7IC4uLnByZXZbdHlwZV1bamlkXSwgc3R1ZGVudHM6IFtdIH07CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4ucHJldiwgW3R5cGVdOiBuZXdKdXJpZXNUeXBlIH07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYWxlcnQoIkp1cnlzIHZpZMOpcyBldCDDqWzDqHZlcyByZXBsYWPDqXMgZW4gbGlzdGUgZCdhdHRlbnRlLiIpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgaGFuZGxlQWRkR2xvYmFsQnJlYWsgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWNvbmZpcm0oYEFqb3V0ZXIgdW5lIHBhdXNlIGRlICR7YnJlYWtDb25maWcuZHVyYXRpb259IG1pbiDDoCAke2JyZWFrQ29uZmlnLnRpbWV9IHBvdXIgVE9VUyBsZXMganVyeXMgJHthY3RpdmVUYWJ9ID9gKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGFjdGl2ZVRhYjsKICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SnVyaWVzID0geyAuLi5wcmV2W3R5cGVdIH07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZEp1cmllcyA9IHt9OwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGN1cnJlbnRKdXJpZXMpLmZvckVhY2goanVyeUlkID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QganVyeSA9IGN1cnJlbnRKdXJpZXNbanVyeUlkXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSBjYWxjdWxhdGVTdHVkZW50VGltZXMoanVyeS5zdHVkZW50cywgc2V0dGluZ3NbdHlwZV0uc3RhcnRUaW1lLCB0eXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluc2VydEluZGV4ID0gdGltZWxpbmUuZmluZEluZGV4KHMgPT4gcy50aW1lU3RhcnQgPj0gYnJlYWtDb25maWcudGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnNlcnRJbmRleCA9PT0gLTEpIGluc2VydEluZGV4ID0ganVyeS5zdHVkZW50cy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1BhdXNlID0geyBpZDogYEJSRUFLLSR7anVyeUlkfS0ke0RhdGUubm93KCl9YCwgaXNCcmVhazogdHJ1ZSwgZHVyYXRpb246IHBhcnNlSW50KGJyZWFrQ29uZmlnLmR1cmF0aW9uKSwgTk9NOiAnUEFVU0UnLCBQUkVOT006ICcnLCBESVY6ICcnIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N0dWRlbnRzID0gWy4uLmp1cnkuc3R1ZGVudHNdOwogICAgICAgICAgICAgICAgICAgICAgICBuZXdTdHVkZW50cy5zcGxpY2UoaW5zZXJ0SW5kZXgsIDAsIG5ld1BhdXNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEp1cmllc1tqdXJ5SWRdID0geyAuLi5qdXJ5LCBzdHVkZW50czogbmV3U3R1ZGVudHMgfTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wcmV2LCBbdHlwZV06IHVwZGF0ZWRKdXJpZXMgfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgICBbJ0ROQicsICdDRkcnLCAnR08nXS5mb3JFYWNoKHR5cGUgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gc2V0dGluZ3NbdHlwZV0uanVyeUNvdW50OwogICAgICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHByZXZbdHlwZV0gfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0p1cmllcyA9IHsgLi4uY3VycmVudCB9OwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5ld0p1cmllc1tpXSkgbmV3SnVyaWVzW2ldID0geyBpZDogaSwgcm9vbTogYFMke2l9YCwgcHJvZjFJZDogbnVsbCwgcHJvZjJJZDogbnVsbCwgc3R1ZGVudHM6IFtdIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobmV3SnVyaWVzKS5mb3JFYWNoKGtleSA9PiB7IGlmIChwYXJzZUludChrZXkpID4gY291bnQpIGRlbGV0ZSBuZXdKdXJpZXNba2V5XTsgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnByZXYsIFt0eXBlXTogbmV3SnVyaWVzIH07CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwgW3NldHRpbmdzLkROQi5qdXJ5Q291bnQsIHNldHRpbmdzLkNGRy5qdXJ5Q291bnQsIHNldHRpbmdzLkdPLmp1cnlDb3VudF0pOwoKICAgICAgICAgICAgY29uc3QgdXBkYXRlSnVyeSA9IChpZCwgZmllbGQsIHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICBzZXRKdXJpZXMocHJldiA9PiAoewogICAgICAgICAgICAgICAgICAgIC4uLnByZXYsCiAgICAgICAgICAgICAgICAgICAgW2FjdGl2ZVRhYl06IHsKICAgICAgICAgICAgICAgICAgICAgICAgLi4ucHJldlthY3RpdmVUYWJdLAogICAgICAgICAgICAgICAgICAgICAgICBbaWRdOiB7IC4uLnByZXZbYWN0aXZlVGFiXVtpZF0sIFtmaWVsZF06IHZhbHVlIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVEcm9wU3R1ZGVudFRvSnVyeSA9IChqdXJ5SWQsIHN0dWRlbnQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBhY3RpdmVUYWI7CiAgICAgICAgICAgICAgICBpZiAoIXN0dWRlbnQuZnJvbUp1cnkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ0ROQicpIHNldFBvb2xETkIocHJldiA9PiBwcmV2LmZpbHRlcihzID0+IHMuaWQgIT09IHN0dWRlbnQuaWQpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnQ0ZHJykgc2V0UG9vbENGRyhwcmV2ID0+IHByZXYuZmlsdGVyKHMgPT4gcy5pZCAhPT0gc3R1ZGVudC5pZCkpOwogICAgICAgICAgICAgICAgICAgIGVsc2Ugc2V0UG9vbEdPKHByZXYgPT4gcHJldi5maWx0ZXIocyA9PiBzLmlkICE9PSBzdHVkZW50LmlkKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZVN0dWRlbnRGcm9tSnVyeShzdHVkZW50LmZyb21KdXJ5LCBzdHVkZW50LmlkLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRKdXJpZXMocHJldiA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QganVyeSA9IHByZXZbdHlwZV1banVyeUlkXTsKICAgICAgICAgICAgICAgICAgICBpZiAoanVyeS5zdHVkZW50cy5maW5kKHMgPT4gcy5pZCA9PT0gc3R1ZGVudC5pZCkpIHJldHVybiBwcmV2OwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnByZXYsIFt0eXBlXTogeyAuLi5wcmV2W3R5cGVdLCBbanVyeUlkXTogeyAuLi5qdXJ5LCBzdHVkZW50czogWy4uLmp1cnkuc3R1ZGVudHMsIHsgLi4uc3R1ZGVudCwgZnJvbUp1cnk6IHVuZGVmaW5lZCB9XSB9IH0gfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgcmVtb3ZlU3R1ZGVudEZyb21KdXJ5ID0gKGp1cnlJZCwgc3R1ZGVudElkLCByZXR1cm5Ub1Bvb2wgPSB0cnVlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gYWN0aXZlVGFiOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEp1cmllcyA9IGp1cmllc1t0eXBlXTsKICAgICAgICAgICAgICAgIGlmICghY3VycmVudEp1cmllcykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QganVyeSA9IGN1cnJlbnRKdXJpZXNbanVyeUlkXTsKICAgICAgICAgICAgICAgIGlmICghanVyeSkgcmV0dXJuOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50VG9SZW1vdmUgPSBqdXJ5LnN0dWRlbnRzLmZpbmQocyA9PiBzLmlkID09PSBzdHVkZW50SWQpOwoKICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmV2SnVyeSA9IHByZXZbdHlwZV1banVyeUlkXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdTdHVkZW50cyA9IHByZXZKdXJ5LnN0dWRlbnRzLmZpbHRlcihzID0+IHMuaWQgIT09IHN0dWRlbnRJZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4ucHJldiwgW3R5cGVdOiB7IC4uLnByZXZbdHlwZV0sIFtqdXJ5SWRdOiB7IC4uLnByZXZKdXJ5LCBzdHVkZW50czogbmV3U3R1ZGVudHMgfSB9IH07CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAocmV0dXJuVG9Qb29sICYmIHN0dWRlbnRUb1JlbW92ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnRE5CJykgc2V0UG9vbEROQihwcmV2ID0+IFtzdHVkZW50VG9SZW1vdmUsIC4uLnByZXZdKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnQ0ZHJykgc2V0UG9vbENGRyhwcmV2ID0+IFtzdHVkZW50VG9SZW1vdmUsIC4uLnByZXZdKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHNldFBvb2xHTyhwcmV2ID0+IFtzdHVkZW50VG9SZW1vdmUsIC4uLnByZXZdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IG1vdmVTdHVkZW50ID0gKGp1cnlJZCwgc3R1ZGVudElkLCBkaXJlY3Rpb24pID0+IHsKICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gYWN0aXZlVGFiOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGp1cnkgPSBwcmV2W3R5cGVdW2p1cnlJZF07CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudHMgPSBbLi4uanVyeS5zdHVkZW50c107CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBzdHVkZW50cy5maW5kSW5kZXgocyA9PiBzLmlkID09PSBzdHVkZW50SWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHJldHVybiBwcmV2OwogICAgICAgICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IC0xICYmIGluZGV4ID09PSAwKSByZXR1cm4gcHJldjsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAxICYmIGluZGV4ID09PSBzdHVkZW50cy5sZW5ndGggLSAxKSByZXR1cm4gcHJldjsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gc3R1ZGVudHNbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzW2luZGV4XSA9IHN0dWRlbnRzW2luZGV4ICsgZGlyZWN0aW9uXTsKICAgICAgICAgICAgICAgICAgICBzdHVkZW50c1tpbmRleCArIGRpcmVjdGlvbl0gPSB0ZW1wOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnByZXYsIFt0eXBlXTogeyAuLi5wcmV2W3R5cGVdLCBbanVyeUlkXTogeyAuLi5qdXJ5LCBzdHVkZW50cyB9IH0gfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgaGFuZGxlVXBkYXRlU3R1ZGVudEluSnVyeSA9IChqdXJ5SWQsIHN0dWRlbnRJZCwgZHVyYXRpb24pID0+IHsKICAgICAgICAgICAgICAgIHNldEp1cmllcyhwcmV2ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gYWN0aXZlVGFiOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGp1cnkgPSBwcmV2W3R5cGVdW2p1cnlJZF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3U3R1ZGVudHMgPSBqdXJ5LnN0dWRlbnRzLm1hcChzID0+IHMuaWQgPT09IHN0dWRlbnRJZCA/IHsgLi4ucywgZHVyYXRpb246IGR1cmF0aW9uIH0gOiBzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5wcmV2LCBbdHlwZV06IHsgLi4ucHJldlt0eXBlXSwgW2p1cnlJZF06IHsgLi4uanVyeSwgc3R1ZGVudHM6IG5ld1N0dWRlbnRzIH0gfSB9OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBleHBvcnREYXRhID0gKHR5cGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRUeXBlID0gYWN0aXZlVGFiID09PSAnUElMT1RBR0UnID8gJ0ROQicgOiBhY3RpdmVUYWI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnUFJPRlMnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXNzaWdubWVudHMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAoanVyaWVzW2N1cnJlbnRUeXBlXSkgewogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGp1cmllc1tjdXJyZW50VHlwZV0pLmZvckVhY2goaiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoai5wcm9mMUlkKSBhc3NpZ25tZW50c1tqLnByb2YxSWRdID0gYEp1cnkgJHtqLmlkfWA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoai5wcm9mMklkKSBhc3NpZ25tZW50c1tqLnByb2YySWRdID0gYEp1cnkgJHtqLmlkfWA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHByb2ZzLm1hcChwID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgIENJVjogcC5DSVYgfHwgJycsIAogICAgICAgICAgICAgICAgICAgICAgICBOT006IHAuTk9NLCAKICAgICAgICAgICAgICAgICAgICAgICAgUFJFTk9NOiBwLlBSRU5PTSwgCiAgICAgICAgICAgICAgICAgICAgICAgIE1BVElFUkU6IHAuTUFUSUVSRSwKICAgICAgICAgICAgICAgICAgICAgICAgW2BBRkZFQ1RBVElPTl8ke2N1cnJlbnRUeXBlfWBdOiBhc3NpZ25tZW50c1twLmlkXSB8fCAnTk9OIEFGRkVDVMOJJwogICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICBkb3dubG9hZENTVihkYXRhLCBgZXhwb3J0X3Byb2ZzXyR7Y3VycmVudFR5cGV9XyR7c2Vzc2lvblllYXJ9LmNzdmApOwogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdTVFVERU5UUycpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcm93cyA9IFtdOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChqdXJpZXNbY3VycmVudFR5cGVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMoanVyaWVzW2N1cnJlbnRUeXBlXSkuZm9yRWFjaChqdXJ5ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVkU3R1ZGVudHMgPSBjYWxjdWxhdGVTdHVkZW50VGltZXMoanVyeS5zdHVkZW50cywgc2V0dGluZ3NbY3VycmVudFR5cGVdLnN0YXJ0VGltZSwgY3VycmVudFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZWRTdHVkZW50cy5mb3JFYWNoKHMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHMuaXNCcmVhaykgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5PTTogcy5OT00sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUkVOT006IHMuUFJFTk9NLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRElWOiBzLkRJViwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFQ6IChzLlRUICYmIChzLlRUID09PSAnT1VJJyB8fCBzLlRUID09PSB0cnVlIHx8IG5vcm1hbGl6ZVRleHQocy5UVCkuaW5jbHVkZXMoJ1RJRVJTJykpKSA/ICdPVUknIDogJ05PTicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFFU0hfTk9NOiBzLkFFU0hfTk9NIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBRVNIX1BSRU5PTTogcy5BRVNIX1BSRU5PTSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRURTOiBzLkVEUyB8fCAnJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdST1VQRTogcy5HUk9VUEUgfHwgJycsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQVJDT1VSUzogcy5QQVJDT1VSUyB8fCAnJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpVUlk6IGp1cnkuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNBTExFOiBqdXJ5LnJvb20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhFVVJFX1BBU1NBR0U6IHMudGltZVN0YXJ0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSEVVUkVfRklOOiBzLnRpbWVFbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGxldCBwb29sID0gW107CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRUeXBlID09PSAnRE5CJykgcG9vbCA9IHBvb2xETkI7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudFR5cGUgPT09ICdDRkcnKSBwb29sID0gcG9vbENGRzsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50VHlwZSA9PT0gJ0dPJykgcG9vbCA9IHBvb2xHTzsKCiAgICAgICAgICAgICAgICAgICAgcG9vbC5mb3JFYWNoKHMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9NOiBzLk5PTSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQUkVOT006IHMuUFJFTk9NLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERJVjogcy5ESVYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUVDogKHMuVFQgJiYgKHMuVFQgPT09ICdPVUknIHx8IHMuVFQgPT09IHRydWUgfHwgbm9ybWFsaXplVGV4dChzLlRUKS5pbmNsdWRlcygnVElFUlMnKSkpID8gJ09VSScgOiAnTk9OJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFFU0hfTk9NOiBzLkFFU0hfTk9NIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQUVTSF9QUkVOT006IHMuQUVTSF9QUkVOT00gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFRFM6IHMuRURTIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgR1JPVVBFOiBzLkdST1VQRSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBUkNPVVJTOiBzLlBBUkNPVVJTIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSlVSWTogJ05PTiBBRkZFQ1TDiScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTQUxMRTogJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIRVVSRV9QQVNTQUdFOiAnJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIRVVSRV9GSU46ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICByb3dzLnNvcnQoKGEsYikgPT4gYS5OT00ubG9jYWxlQ29tcGFyZShiLk5PTSkpOwogICAgICAgICAgICAgICAgICAgIGRvd25sb2FkQ1NWKHJvd3MsIGBleHBvcnRfZWxldmVzXyR7Y3VycmVudFR5cGV9XyR7c2Vzc2lvblllYXJ9LmNzdmApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgaW5pdGlhdGVTYXZlID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdE5hbWUgPSBgT1JBTF9QRVJESVJfJHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInKS5yZXBsYWNlKC9cLy9nLCAnLScpfWA7CiAgICAgICAgICAgICAgICBzZXRTYXZlRmlsZU5hbWUoZGVmYXVsdE5hbWUpOwogICAgICAgICAgICAgICAgc2V0U2hvd1NhdmVNb2RhbCh0cnVlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IHBlcmZvcm1TYXZlID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgcHJvZnMsIHN0dWRlbnRzRE5CLCBzdHVkZW50c0NGRywgc3R1ZGVudHNHTywgcG9vbEROQiwgcG9vbENGRywgcG9vbEdPLCBqdXJpZXMsIHNldHRpbmdzLCBzY2hvb2xOYW1lLCBzY2hvb2xDaXR5LCBzY2hvb2xMb2dvLCBzY2hvb2xTdGFtcCwgc2Vzc2lvblllYXIsIHRlbXBsYXRlcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbSlNPTi5zdHJpbmdpZnkoZGF0YSldLCB7dHlwZTogImFwcGxpY2F0aW9uL2pzb24ifSk7CiAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGZpbmFsTmFtZSA9IHNhdmVGaWxlTmFtZS50cmltKCkgfHwgYE9SQUxfUEVSRElSXyR7bmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJykucmVwbGFjZSgvXC8vZywgJy0nKX1gOwogICAgICAgICAgICAgICAgaWYgKCFmaW5hbE5hbWUudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLmpzb24nKSkgZmluYWxOYW1lICs9ICcuanNvbic7CgogICAgICAgICAgICAgICAgbGluay5kb3dubG9hZCA9IGZpbmFsTmFtZTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspOwogICAgICAgICAgICAgICAgc2V0U2hvd1NhdmVNb2RhbChmYWxzZSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBoYW5kbGVMb2FkID0gKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTsKICAgICAgICAgICAgICAgIGlmICghZmlsZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC50YXJnZXQucmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0UHJvZnMoZGF0YS5wcm9mcyB8fCBbXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFN0dWRlbnRzRE5CKGRhdGEuc3R1ZGVudHNETkIgfHwgW10pOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRTdHVkZW50c0NGRyhkYXRhLnN0dWRlbnRzQ0ZHIHx8IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0U3R1ZGVudHNHTyhkYXRhLnN0dWRlbnRzR08gfHwgW10pOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRQb29sRE5CKGRhdGEucG9vbEROQiB8fCBbXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFBvb2xDRkcoZGF0YS5wb29sQ0ZHIHx8IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0UG9vbEdPKGRhdGEucG9vbEdPIHx8IFtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0SnVyaWVzKGRhdGEuanVyaWVzIHx8IHsgRE5COiB7fSwgQ0ZHOiB7fSwgR086IHt9IH0pOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRTZXR0aW5ncyhkYXRhLnNldHRpbmdzIHx8IHNldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2Nob29sTmFtZShkYXRhLnNjaG9vbE5hbWUgfHwgJycpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRTY2hvb2xDaXR5KGRhdGEuc2Nob29sQ2l0eSB8fCAnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFNjaG9vbExvZ28oZGF0YS5zY2hvb2xMb2dvIHx8IG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRTY2hvb2xTdGFtcChkYXRhLnNjaG9vbFN0YW1wIHx8IG51bGwpOyAvLyBMb2FkIHN0YW1wCiAgICAgICAgICAgICAgICAgICAgICAgIHNldFNlc3Npb25ZZWFyKGRhdGEuc2Vzc2lvblllYXIgfHwgJzIwMjYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudGVtcGxhdGVzKSBzZXRUZW1wbGF0ZXMoZGF0YS50ZW1wbGF0ZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgiRG9ubsOpZXMgcmVzdGF1csOpZXMgISIpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgeyBhbGVydCgiRXJyZXVyIGZpY2hpZXIuIik7IH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUxvZ29VcGxvYWQgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgICAgICAgICAgaWYgKGZpbGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiBzZXRTY2hvb2xMb2dvKHJlYWRlci5yZXN1bHQpOwogICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgY29uc3QgaGFuZGxlU3RhbXBVcGxvYWQgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgICAgICAgICAgaWYgKGZpbGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiBzZXRTY2hvb2xTdGFtcChyZWFkZXIucmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZVJlc2V0ID0gKCkgPT4gewogICAgICAgICAgICAgICAgIGlmKGNvbmZpcm0oIkFUVEVOVElPTiA6IFRvdXQgZWZmYWNlciA/IikpIHsKICAgICAgICAgICAgICAgICAgICBzZXRQcm9mcyhbXSk7IHNldFN0dWRlbnRzRE5CKFtdKTsgc2V0U3R1ZGVudHNDRkcoW10pOyBzZXRTdHVkZW50c0dPKFtdKTsKICAgICAgICAgICAgICAgICAgICBzZXRQb29sRE5CKFtdKTsgc2V0UG9vbENGRyhbXSk7IHNldFBvb2xHTyhbXSk7CiAgICAgICAgICAgICAgICAgICAgc2V0SnVyaWVzKHsgRE5COiB7fSwgQ0ZHOiB7fSwgR086IHt9IH0pOwogICAgICAgICAgICAgICAgICAgIHNldFNjaG9vbE5hbWUoJycpOyBzZXRTY2hvb2xDaXR5KCcnKTsgc2V0U2Nob29sTG9nbyhudWxsKTsKICAgICAgICAgICAgICAgICAgICBzZXRTY2hvb2xTdGFtcChudWxsKTsKICAgICAgICAgICAgICAgICAgICBzZXRTZXNzaW9uWWVhcignMjAyNicpOyAKICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnb3JhbF9ibGFuY19kYXRhJyk7IC8vIFBMVVMgREUgTE9DQUxTVE9SQUdFCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBBREQgQVVUT1NBVkUgSEVSRQogICAgICAgICAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgc2F2ZWREYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ29yYWxfYmxhbmNfZGF0YScpOwogICAgICAgICAgICAgICAgaWYgKHNhdmVkRGF0YSkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHNhdmVkRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnByb2ZzKSBzZXRQcm9mcyhkYXRhLnByb2ZzKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3R1ZGVudHNETkIpIHNldFN0dWRlbnRzRE5CKGRhdGEuc3R1ZGVudHNETkIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdHVkZW50c0NGRykgc2V0U3R1ZGVudHNDRkcoZGF0YS5zdHVkZW50c0NGRyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0dWRlbnRzR08pIHNldFN0dWRlbnRzR08oZGF0YS5zdHVkZW50c0dPKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEucG9vbEROQikgc2V0UG9vbEROQihkYXRhLnBvb2xETkIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5wb29sQ0ZHKSBzZXRQb29sQ0ZHKGRhdGEucG9vbENGRyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnBvb2xHTykgc2V0UG9vbEdPKGRhdGEucG9vbEdPKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuanVyaWVzKSBzZXRKdXJpZXMoZGF0YS5qdXJpZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zZXR0aW5ncykgc2V0U2V0dGluZ3MoZGF0YS5zZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnNjaG9vbE5hbWUpIHNldFNjaG9vbE5hbWUoZGF0YS5zY2hvb2xOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc2Nob29sQ2l0eSkgc2V0U2Nob29sQ2l0eShkYXRhLnNjaG9vbENpdHkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zY2hvb2xMb2dvKSBzZXRTY2hvb2xMb2dvKGRhdGEuc2Nob29sTG9nbyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnNjaG9vbFN0YW1wKSBzZXRTY2hvb2xTdGFtcChkYXRhLnNjaG9vbFN0YW1wKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc2Vzc2lvblllYXIpIHNldFNlc3Npb25ZZWFyKGRhdGEuc2Vzc2lvblllYXIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS50ZW1wbGF0ZXMpIHNldFRlbXBsYXRlcyhkYXRhLnRlbXBsYXRlcyk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJldXIgY2hhcmdlbWVudCBhdXRvLXNhdmUiLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIFtdKTsKCiAgICAgICAgICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhVG9TYXZlID0gewogICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICBwcm9mcywgc3R1ZGVudHNETkIsIHN0dWRlbnRzQ0ZHLCBzdHVkZW50c0dPLAogICAgICAgICAgICAgICAgICAgIHBvb2xETkIsIHBvb2xDRkcsIHBvb2xHTywKICAgICAgICAgICAgICAgICAgICBqdXJpZXMsIHNldHRpbmdzLCBzY2hvb2xOYW1lLCBzY2hvb2xDaXR5LCBzY2hvb2xMb2dvLCBzY2hvb2xTdGFtcCwgc2Vzc2lvblllYXIsIHRlbXBsYXRlcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdvcmFsX2JsYW5jX2RhdGEnLCBKU09OLnN0cmluZ2lmeShkYXRhVG9TYXZlKSk7CiAgICAgICAgICAgIH0sIFtwcm9mcywgc3R1ZGVudHNETkIsIHN0dWRlbnRzQ0ZHLCBzdHVkZW50c0dPLCBwb29sRE5CLCBwb29sQ0ZHLCBwb29sR08sIGp1cmllcywgc2V0dGluZ3MsIHNjaG9vbE5hbWUsIHNjaG9vbENpdHksIHNjaG9vbExvZ28sIHNjaG9vbFN0YW1wLCBzZXNzaW9uWWVhciwgdGVtcGxhdGVzXSk7CgogICAgICAgICAgICBjb25zdCBQaWxvdGFnZVZpZXcgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gcGlsb3RhZ2VUeXBlOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEp1cmllcyA9IGp1cmllc1t0eXBlXSB8fCB7fTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHNldHRpbmdzW3R5cGVdPy5zdGFydFRpbWUgfHwgJzA4OjAwJzsKICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRzID0gT2JqZWN0LnZhbHVlcyhjdXJyZW50SnVyaWVzKS5tYXAoaiA9PiBjYWxjdWxhdGVKdXJ5TG9hZChqLCBzdGFydFRpbWUsIHR5cGUpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsQ2FuZGlkYXRlcyA9IGxvYWRzLnJlZHVjZSgocywgaikgPT4gcyArIGouc3R1ZGVudENvdW50LCAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IGF2Z01pbnV0ZXMgPSBsb2Fkcy5sZW5ndGggPyAobG9hZHMucmVkdWNlKChzLCBqKSA9PiBzICsgai50b3RhbE1pbnV0ZXMsIDApIC8gbG9hZHMubGVuZ3RoKSA6IDA7CiAgICAgICAgICAgICAgICBjb25zdCBlbmRNYXggPSBsb2Fkcy5sZW5ndGggPyBtaW51dGVzVG9ISE1NKE1hdGgubWF4KC4uLmxvYWRzLm1hcChqID0+IHRpbWVUb01pbnV0ZXMoai5lbmRUaW1lIHx8IHN0YXJ0VGltZSkpKSkgOiBzdGFydFRpbWU7CiAgICAgICAgICAgICAgICBjb25zdCBvdmVybG9hZGVkID0gbG9hZHMuZmlsdGVyKGogPT4gZ2V0TG9hZFN0YXR1cyhqLnRvdGFsTWludXRlcywgYXZnTWludXRlcykubGFiZWwgPT09ICdTdXJjaGFyZ8OpJykubGVuZ3RoOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy13aGl0ZSByb3VuZGVkLTJ4bCBzaGFkb3ctc20gYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAvNjAgcC02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBtYi02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzc05hbWU9InRleHQtMnhsIGZvbnQtYmxhY2sgdGV4dC1zbGF0ZS05MDAiPlBpbG90YWdlIHt0eXBlfTwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBnYXAtMiBtbC1hdXRvIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7WydETkInLCAnQ0ZHJywgJ0dPJ10ubWFwKHQgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGtleT17dH0gb25DbGljaz17KCkgPT4gc2V0UGlsb3RhZ2VUeXBlKHQpfSBjbGFzc05hbWU9e2BweC00IHB5LTIgcm91bmRlZC1sZyB0ZXh0LXNtIGZvbnQtYm9sZCB0cmFuc2l0aW9uICR7cGlsb3RhZ2VUeXBlID09PSB0ID8gJ2JnLXNsYXRlLTgwMCB0ZXh0LXdoaXRlJyA6ICd0ZXh0LXNsYXRlLTYwMCBiZy1zbGF0ZS0xMDAnfWB9Pnt0fTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JpZCBncmlkLWNvbHMtNCBnYXAtNCBtYi02Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJyb3VuZGVkLTJ4bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBwLTQgYmctc2xhdGUtNTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LVsxMXB4XSBmb250LWJvbGQgdXBwZXJjYXNlIHRleHQtc2xhdGUtNDAwIj5DYW5kaWRhdHM8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC0zeGwgZm9udC1ibGFjayI+e3RvdGFsQ2FuZGlkYXRlc308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJyb3VuZGVkLTJ4bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBwLTQgYmctc2xhdGUtNTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LVsxMXB4XSBmb250LWJvbGQgdXBwZXJjYXNlIHRleHQtc2xhdGUtNDAwIj5GaW4gRXN0aW3DqWU8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC0zeGwgZm9udC1ibGFjayI+e2VuZE1heH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJyb3VuZGVkLTJ4bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCBwLTQgYmctc2xhdGUtNTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LVsxMXB4XSBmb250LWJvbGQgdXBwZXJjYXNlIHRleHQtc2xhdGUtNDAwIj5TdXJjaGFyZ2VzPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2B0ZXh0LTN4bCBmb250LWJsYWNrICR7b3ZlcmxvYWRlZCA+IDAgPyAndGV4dC1yZWQtNjAwJyA6ICd0ZXh0LWVtZXJhbGQtNjAwJ31gfT57b3ZlcmxvYWRlZH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzTmFtZT0idy1mdWxsIHRleHQtc20gYm9yZGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZCBjbGFzc05hbWU9ImJnLXNsYXRlLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJwLTMgdGV4dC1sZWZ0Ij5KdXJ5PC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzTmFtZT0icC0zIHRleHQtY2VudGVyIj7DiWzDqHZlczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9InAtMyB0ZXh0LWNlbnRlciI+UGFzc2FnZXM8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3NOYW1lPSJwLTMgdGV4dC1jZW50ZXIiPkR1csOpZTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzc05hbWU9InAtMyB0ZXh0LWNlbnRlciI+RmluPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzTmFtZT0icC0zIHRleHQtY2VudGVyIj7DiXRhdDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGhlYWQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2xvYWRzLm1hcChqID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3QgPSBnZXRMb2FkU3RhdHVzKGoudG90YWxNaW51dGVzLCBhdmdNaW51dGVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBrZXk9e2ouanVyeUlkfSBjbGFzc05hbWU9ImJvcmRlci1iIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJwLTMgZm9udC1ib2xkIj5Ke2ouanVyeUlkfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzTmFtZT0icC0zIHRleHQtY2VudGVyIj57ai5zdHVkZW50Q291bnR9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJwLTMgdGV4dC1jZW50ZXIiPntqLnBhc3NhZ2VDb3VudH08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzc05hbWU9InAtMyB0ZXh0LWNlbnRlciI+e2Zvcm1hdE1pbnV0ZXNITShqLnRvdGFsTWludXRlcyl9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJwLTMgdGV4dC1jZW50ZXIiPntqLmVuZFRpbWV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3NOYW1lPSJwLTMgdGV4dC1jZW50ZXIiPjxzcGFuIGNsYXNzTmFtZT17YHB4LTIgcHktMSByb3VuZGVkIHRleHQteHMgZm9udC1ib2xkICR7c3QuY2xzfWB9PntzdC5sYWJlbH08L3NwYW4+PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PgogICAgICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWluLWgtc2NyZWVuIGZsZXggZmxleC1jb2wgZm9udC1zYW5zIHRleHQtc2xhdGUtODAwIGJnLXNsYXRlLTUwIj4KICAgICAgICAgICAgICAgICAgICB7LyogQkFOTklFUkUgUFJJTkNJUEFMRSBBTUVMSU9SRUUgKi99CiAgICAgICAgICAgICAgICAgICAgPGhlYWRlciBjbGFzc05hbWU9ImJnLWdyYWRpZW50LXRvLXIgZnJvbS1ibHVlLTkwMCB2aWEtaW5kaWdvLTkwMCB0by1wdXJwbGUtOTAwIHRleHQtd2hpdGUgcC00IHNoYWRvdy14bCBuby1wcmludCByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYWJzb2x1dGUgaW5zZXQtMCBiZy1bdXJsKCdodHRwczovL3d3dy50cmFuc3BhcmVudHRleHR1cmVzLmNvbS9wYXR0ZXJucy9jdWJlcy5wbmcnKV0gb3BhY2l0eS0xMCBtaXgtYmxlbmQtb3ZlcmxheSI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJjb250YWluZXIgbXgtYXV0byBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgcmVsYXRpdmUgei0xMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy13aGl0ZS8xMCBwLTIgcm91bmRlZC14bCBiYWNrZHJvcC1ibHVyLXNtIGJvcmRlciBib3JkZXItd2hpdGUvMTAgc2hhZG93LWlubmVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEdyYWR1YXRpb25DYXAgY2xhc3NOYW1lPSJ0ZXh0LWJsdWUtMjAwIHctOCBoLTgiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgxIGNsYXNzTmFtZT0idGV4dC0yeGwgZm9udC1ibGFjayB0cmFja2luZy10aWdodCB0ZXh0LXdoaXRlIGRyb3Atc2hhZG93LXNtIj5QRVJESVI8c3BhbiBjbGFzc05hbWU9InRleHQtYmx1ZS0zMDAiPkZPUk1BTkNFPC9zcGFuPjwvaDE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXhzIHRleHQtYmx1ZS0yMDAgZm9udC1tZWRpdW0gdHJhY2tpbmctd2lkZXN0IHVwcGVyY2FzZSBvcGFjaXR5LTkwIj5PcmFsIEROQi1DRkctR08ge3Nlc3Npb25ZZWFyfSAtIFYxMTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBnYXAtMyBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGJnLWJsYWNrLzIwIHJvdW5kZWQteGwgcC0xIGJhY2tkcm9wLWJsdXItc20gYm9yZGVyIGJvcmRlci13aGl0ZS81IHNoYWRvdy1pbm5lciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGN1cnNvci1wb2ludGVyIGhvdmVyOmJnLXdoaXRlLzEwIHB4LTMgcHktMiByb3VuZGVkLWxnIHRleHQtc20gdGV4dC1ibHVlLTEwMCB0cmFuc2l0aW9uLWNvbG9ycyI+PFVwbG9hZCBzaXplPXsxNn0gLz4gUmVzdGF1cmVyPGlucHV0IHR5cGU9ImZpbGUiIGFjY2VwdD0iLmpzb24iIG9uQ2hhbmdlPXtoYW5kbGVMb2FkfSBjbGFzc05hbWU9ImhpZGRlbiIgLz48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idy1weCBiZy13aGl0ZS8xMCBteS0xIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtpbml0aWF0ZVNhdmV9IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgaG92ZXI6Ymctd2hpdGUvMTAgcHgtMyBweS0yIHJvdW5kZWQtbGcgdGV4dC1zbSB0ZXh0LWJsdWUtMTAwIHRyYW5zaXRpb24tY29sb3JzIj48U2F2ZSBzaXplPXsxNn0gLz4gU2F1dmVnYXJkZXI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e2dlbmVyYXRlRGVtb0RhdGF9IGNsYXNzTmFtZT0iYmctZ3JhZGllbnQtdG8tciBmcm9tLXB1cnBsZS01MDAgdG8taW5kaWdvLTYwMCB0ZXh0LXdoaXRlIHB4LTQgcHktMiByb3VuZGVkLXhsIHNoYWRvdy1sZyBmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgaG92ZXI6ZnJvbS1wdXJwbGUtNjAwIGhvdmVyOnRvLWluZGlnby03MDAgdHJhbnNpdGlvbi1hbGwgdGV4dC1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzIwIj48U3BhcmtsZXMgc2l6ZT17MTZ9IC8+IE1vZGUgRMOpbW88L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldFNob3dQcmludCh0cnVlKX0gY2xhc3NOYW1lPSJiZy13aGl0ZSB0ZXh0LWluZGlnby05MDAgcHgtNiBweS0zIHJvdW5kZWQteGwgc2hhZG93LWxnIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBob3ZlcjpiZy1ibHVlLTUwIHRyYW5zaXRpb24tYWxsIGJvcmRlciBib3JkZXItYmx1ZS0xMDAgdHJhbnNmb3JtIGhvdmVyOi10cmFuc2xhdGUteS0wLjUiPjxQcmludGVyIHNpemU9ezIwfSBjbGFzc05hbWU9InRleHQtaW5kaWdvLTYwMCIgLz4gQ29udm9jYXRpb25zPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9oZWFkZXI+CgogICAgICAgICAgICAgICAgICAgIDxuYXYgY2xhc3NOYW1lPSJiZy13aGl0ZSBib3JkZXItYiBib3JkZXItZ3JheS0yMDAgbm8tcHJpbnQgc2hhZG93LXNtIHotMTAgc3RpY2t5IHRvcC0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImNvbnRhaW5lciBteC1hdXRvIGZsZXggcHgtNCBnYXAtOCBvdmVyZmxvdy14LWF1dG8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRBY3RpdmVUYWIoJ0ROQicpfSBjbGFzc05hbWU9e2ByZWxhdGl2ZSBweC02IHB5LTUgZm9udC1ib2xkIHRleHQtbGcgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgd2hpdGVzcGFjZS1ub3dyYXAgJHthY3RpdmVUYWIgPT09ICdETkInID8gJ3RleHQtYmx1ZS03MDAnIDogJ3RleHQtZ3JheS00MDAgaG92ZXI6dGV4dC1ncmF5LTYwMCd9YH0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJvb2tPcGVuIHNpemU9ezIwfSBjbGFzc05hbWU9e2FjdGl2ZVRhYiA9PT0gJ0ROQicgPyAndGV4dC1ibHVlLTYwMCcgOiAndGV4dC1ncmF5LTQwMCd9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRE5CIDxzcGFuIGNsYXNzTmFtZT0ibWwtMiBiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtODAwIHRleHQteHMgcHgtMiBweS0wLjUgcm91bmRlZC1mdWxsIj57cG9vbEROQi5sZW5ndGh9IC8ge3N0dWRlbnRzRE5CLmxlbmd0aH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZVRhYiA9PT0gJ0ROQicgJiYgPGRpdiBjbGFzc05hbWU9ImFic29sdXRlIGJvdHRvbS0wIGxlZnQtMCByaWdodC0wIGgtMSBiZy1ibHVlLTYwMCByb3VuZGVkLXQtZnVsbCI+PC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldEFjdGl2ZVRhYignQ0ZHJyl9IGNsYXNzTmFtZT17YHJlbGF0aXZlIHB4LTYgcHktNSBmb250LWJvbGQgdGV4dC1sZyBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiB3aGl0ZXNwYWNlLW5vd3JhcCAke2FjdGl2ZVRhYiA9PT0gJ0NGRycgPyAndGV4dC1lbWVyYWxkLTcwMCcgOiAndGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWdyYXktNjAwJ31gfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QXdhcmQgc2l6ZT17MjB9IGNsYXNzTmFtZT17YWN0aXZlVGFiID09PSAnQ0ZHJyA/ICd0ZXh0LWVtZXJhbGQtNjAwJyA6ICd0ZXh0LWdyYXktNDAwJ30gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDRkcgPHNwYW4gY2xhc3NOYW1lPSJtbC0yIGJnLWVtZXJhbGQtMTAwIHRleHQtZW1lcmFsZC04MDAgdGV4dC14cyBweC0yIHB5LTAuNSByb3VuZGVkLWZ1bGwiPntwb29sQ0ZHLmxlbmd0aH0gLyB7c3R1ZGVudHNDRkcubGVuZ3RofTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlVGFiID09PSAnQ0ZHJyAmJiA8ZGl2IGNsYXNzTmFtZT0iYWJzb2x1dGUgYm90dG9tLTAgbGVmdC0wIHJpZ2h0LTAgaC0xIGJnLWVtZXJhbGQtNjAwIHJvdW5kZWQtdC1mdWxsIj48L2Rpdj59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gc2V0QWN0aXZlVGFiKCdHTycpfSBjbGFzc05hbWU9e2ByZWxhdGl2ZSBweC02IHB5LTUgZm9udC1ib2xkIHRleHQtbGcgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgd2hpdGVzcGFjZS1ub3dyYXAgJHthY3RpdmVUYWIgPT09ICdHTycgPyAndGV4dC1yb3NlLTcwMCcgOiAndGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWdyYXktNjAwJ31gfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TWljIHNpemU9ezIwfSBjbGFzc05hbWU9e2FjdGl2ZVRhYiA9PT0gJ0dPJyA/ICd0ZXh0LXJvc2UtNjAwJyA6ICd0ZXh0LWdyYXktNDAwJ30gLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHUkFORCBPUkFMIDxzcGFuIGNsYXNzTmFtZT0ibWwtMiBiZy1yb3NlLTEwMCB0ZXh0LXJvc2UtODAwIHRleHQteHMgcHgtMiBweS0wLjUgcm91bmRlZC1mdWxsIj57cG9vbEdPLmxlbmd0aH0gLyB7c3R1ZGVudHNHTy5sZW5ndGh9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHthY3RpdmVUYWIgPT09ICdHTycgJiYgPGRpdiBjbGFzc05hbWU9ImFic29sdXRlIGJvdHRvbS0wIGxlZnQtMCByaWdodC0wIGgtMSBiZy1yb3NlLTYwMCByb3VuZGVkLXQtZnVsbCI+PC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldEFjdGl2ZVRhYignUElMT1RBR0UnKX0gY2xhc3NOYW1lPXtgcmVsYXRpdmUgcHgtNiBweS01IGZvbnQtYm9sZCB0ZXh0LWxnIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHdoaXRlc3BhY2Utbm93cmFwICR7YWN0aXZlVGFiID09PSAnUElMT1RBR0UnID8gJ3RleHQtcHVycGxlLTcwMCcgOiAndGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWdyYXktNjAwJ31gfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8UGllQ2hhcnQgc2l6ZT17MjB9IGNsYXNzTmFtZT17YWN0aXZlVGFiID09PSAnUElMT1RBR0UnID8gJ3RleHQtcHVycGxlLTYwMCcgOiAndGV4dC1ncmF5LTQwMCd9IC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUElMT1RBR0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlVGFiID09PSAnUElMT1RBR0UnICYmIDxkaXYgY2xhc3NOYW1lPSJhYnNvbHV0ZSBib3R0b20tMCBsZWZ0LTAgcmlnaHQtMCBoLTEgYmctcHVycGxlLTYwMCByb3VuZGVkLXQtZnVsbCI+PC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldEFjdGl2ZVRhYignQUlERVMnKX0gY2xhc3NOYW1lPXtgcmVsYXRpdmUgcHgtNiBweS01IGZvbnQtYm9sZCB0ZXh0LWxnIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHdoaXRlc3BhY2Utbm93cmFwICR7YWN0aXZlVGFiID09PSAnQUlERVMnID8gJ3RleHQtdGVhbC03MDAnIDogJ3RleHQtZ3JheS00MDAgaG92ZXI6dGV4dC1ncmF5LTYwMCd9YH0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEhlbHBDaXJjbGUgc2l6ZT17MjB9IGNsYXNzTmFtZT17YWN0aXZlVGFiID09PSAnQUlERVMnID8gJ3RleHQtdGVhbC02MDAnIDogJ3RleHQtZ3JheS00MDAnfSAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFJREVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZVRhYiA9PT0gJ0FJREVTJyAmJiA8ZGl2IGNsYXNzTmFtZT0iYWJzb2x1dGUgYm90dG9tLTAgbGVmdC0wIHJpZ2h0LTAgaC0xIGJnLXRlYWwtNjAwIHJvdW5kZWQtdC1mdWxsIj48L2Rpdj59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9uYXY+CgogICAgICAgICAgICAgICAgICAgIDxtYWluIGNsYXNzTmFtZT0iZmxleC0xIGNvbnRhaW5lciBteC1hdXRvIHAtNiBmbGV4IGZsZXgtY29sIGdhcC02IG5vLXByaW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZVRhYiA9PT0gJ0FJREVTJyA/ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxIZWxwVmlldyAvPgogICAgICAgICAgICAgICAgICAgICAgICApIDogYWN0aXZlVGFiID09PSAnUElMT1RBR0UnID8gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPFBpbG90YWdlVmlldyAvPgogICAgICAgICAgICAgICAgICAgICAgICApIDogKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LyogQkFSUkUgRCdPVVRJTFMgKi99CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtNSByb3VuZGVkLTJ4bCBzaGFkb3ctc20gYm9yZGVyIGJvcmRlci1zbGF0ZS0yMDAvNjAgZmxleCBmbGV4LXdyYXAgZ2FwLTYganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGdhcC00IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgZ2FwLTEuNSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0idGV4dC1bMTFweF0gZm9udC1ib2xkIHRleHQtc2xhdGUtNDAwIHVwcGVyY2FzZSBtbC0xIj7DiXRhYmxpc3NlbWVudDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLXNsYXRlLTUwIHAtMiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0iY3Vyc29yLXBvaW50ZXIgaG92ZXI6Ymctd2hpdGUgcC0xIHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci10cmFuc3BhcmVudCBob3Zlcjpib3JkZXItc2xhdGUtMjAwIiB0aXRsZT0iTG9nbyBkZSBsJ8OpdGFibGlzc2VtZW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzY2hvb2xMb2dvID8gPGltZyBzcmM9e3NjaG9vbExvZ299IGNsYXNzTmFtZT0idy04IGgtOCBvYmplY3QtY29udGFpbiIgLz4gOiA8ZGl2IGNsYXNzTmFtZT0idy04IGgtOCBiZy1zbGF0ZS0yMDAgcm91bmRlZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXNsYXRlLTQwMCI+PFVwbG9hZCBzaXplPXsxNH0gLz48L2Rpdj59CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgYWNjZXB0PSJpbWFnZS8qIiBvbkNoYW5nZT17aGFuZGxlTG9nb1VwbG9hZH0gY2xhc3NOYW1lPSJoaWRkZW4iIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9ImN1cnNvci1wb2ludGVyIGhvdmVyOmJnLXdoaXRlIHAtMSByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItdHJhbnNwYXJlbnQgaG92ZXI6Ym9yZGVyLXNsYXRlLTIwMCIgdGl0bGU9IkNhY2hldCBkZSBsJ8OpdGFibGlzc2VtZW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzY2hvb2xTdGFtcCA/IDxpbWcgc3JjPXtzY2hvb2xTdGFtcH0gY2xhc3NOYW1lPSJ3LTggaC04IG9iamVjdC1jb250YWluIiAvPiA6IDxkaXYgY2xhc3NOYW1lPSJ3LTggaC04IGJnLXNsYXRlLTIwMCByb3VuZGVkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtc2xhdGUtNDAwIj48U3RhbXAgc2l6ZT17MTR9IC8+PC9kaXY+fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImZpbGUiIGFjY2VwdD0iaW1hZ2UvKiIgb25DaGFuZ2U9e2hhbmRsZVN0YW1wVXBsb2FkfSBjbGFzc05hbWU9ImhpZGRlbiIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHZhbHVlPXtzY2hvb2xOYW1lfSBvbkNoYW5nZT17KGUpID0+IHNldFNjaG9vbE5hbWUoZS50YXJnZXQudmFsdWUpfSBjbGFzc05hbWU9ImJnLXRyYW5zcGFyZW50IG91dGxpbmUtbm9uZSB3LTMyIHRleHQtc20gZm9udC1tZWRpdW0iIHBsYWNlaG9sZGVyPSJOb20gQ29sbMOoZ2UiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT17c2Nob29sQ2l0eX0gb25DaGFuZ2U9eyhlKSA9PiBzZXRTY2hvb2xDaXR5KGUudGFyZ2V0LnZhbHVlKX0gY2xhc3NOYW1lPSJiZy10cmFuc3BhcmVudCBvdXRsaW5lLW5vbmUgdy0yNCB0ZXh0LXNtIGZvbnQtbWVkaXVtIGJvcmRlci1sIHBsLTIiIHBsYWNlaG9sZGVyPSJWaWxsZSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBnYXAtMS41Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3NOYW1lPSJ0ZXh0LVsxMXB4XSBmb250LWJvbGQgdGV4dC1zbGF0ZS00MDAgdXBwZXJjYXNlIG1sLTEiPkNvbmZpZ3VyYXRpb248L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGdhcC0yIGl0ZW1zLXN0YXJ0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBiZy1zbGF0ZS01MCBweC0zIHB5LTIgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCIgdGl0bGU9IlNlc3Npb24gKEFubsOpZSkiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDYWxlbmRhciBzaXplPXsxNn0gY2xhc3NOYW1lPSJ0ZXh0LXNsYXRlLTQwMCIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgdmFsdWU9e3Nlc3Npb25ZZWFyfSBvbkNoYW5nZT17KGUpID0+IHNldFNlc3Npb25ZZWFyKGUudGFyZ2V0LnZhbHVlKX0gY2xhc3NOYW1lPSJiZy10cmFuc3BhcmVudCBvdXRsaW5lLW5vbmUgZm9udC1ib2xkIHRleHQtc2xhdGUtNzAwIHctMTIgdGV4dC1zbSIgcGxhY2Vob2xkZXI9IjIwMjYiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMTBweF0gdGV4dC1zbGF0ZS00MDAgZm9udC1tZWRpdW0iPihTZXNzaW9uKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLXNsYXRlLTUwIHB4LTMgcHktMiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIiB0aXRsZT0iSGV1cmUgZGUgZMOpYnV0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Q2xvY2sgc2l6ZT17MTZ9IGNsYXNzTmFtZT0idGV4dC1zbGF0ZS00MDAiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRpbWUiIHZhbHVlPXtzZXR0aW5nc1thY3RpdmVUYWJdLnN0YXJ0VGltZX0gb25DaGFuZ2U9eyhlKSA9PiBzZXRTZXR0aW5ncyh7Li4uc2V0dGluZ3MsIFthY3RpdmVUYWJdOiB7Li4uc2V0dGluZ3NbYWN0aXZlVGFiXSwgc3RhcnRUaW1lOiBlLnRhcmdldC52YWx1ZX19KX0gY2xhc3NOYW1lPSJiZy10cmFuc3BhcmVudCBvdXRsaW5lLW5vbmUgZm9udC1ib2xkIHRleHQtc2xhdGUtNzAwIHctMjAgdGV4dC1zbSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LVsxMHB4XSB0ZXh0LXNsYXRlLTQwMCBmb250LW1lZGl1bSI+KETDqWJ1dCk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBiZy1zbGF0ZS01MCBweC0zIHB5LTIgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCIgdGl0bGU9Ik5vbWJyZSBkZSBqdXJ5cyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFVzZXJzIHNpemU9ezE2fSBjbGFzc05hbWU9InRleHQtc2xhdGUtNDAwIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIG1pbj0iMSIgbWF4PSIzMCIgdmFsdWU9e3NldHRpbmdzW2FjdGl2ZVRhYl0uanVyeUNvdW50fSBvbkNoYW5nZT17KGUpID0+IHNldFNldHRpbmdzKHsuLi5zZXR0aW5ncywgW2FjdGl2ZVRhYl06IHsuLi5zZXR0aW5nc1thY3RpdmVUYWJdLCBqdXJ5Q291bnQ6IHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlKX19KX0gY2xhc3NOYW1lPSJiZy10cmFuc3BhcmVudCBvdXRsaW5lLW5vbmUgZm9udC1ib2xkIHRleHQtc2xhdGUtNzAwIHctMTIgdGV4dC1zbSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0ZXh0LVsxMHB4XSB0ZXh0LXNsYXRlLTQwMCBmb250LW1lZGl1bSI+KE5CIGRlIGp1cnlzKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLXNsYXRlLTUwIHB4LTMgcHktMiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIiB0aXRsZT0iRGF0ZSBkZSBsJ2V4YW1lbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPENhbGVuZGFyIHNpemU9ezE2fSBjbGFzc05hbWU9InRleHQtc2xhdGUtNDAwIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiB2YWx1ZT17c2V0dGluZ3NbYWN0aXZlVGFiXS5kYXRlIHx8ICcnfSBvbkNoYW5nZT17KGUpID0+IHNldFNldHRpbmdzKHsuLi5zZXR0aW5ncywgW2FjdGl2ZVRhYl06IHsuLi5zZXR0aW5nc1thY3RpdmVUYWJdLCBkYXRlOiBlLnRhcmdldC52YWx1ZX19KX0gY2xhc3NOYW1lPSJiZy10cmFuc3BhcmVudCBvdXRsaW5lLW5vbmUgZm9udC1ib2xkIHRleHQtc2xhdGUtNzAwIHRleHQtc20iIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1bMTBweF0gdGV4dC1zbGF0ZS00MDAgZm9udC1tZWRpdW0iPihEYXRlIGRlIGwnZXhhbWVuKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLXNsYXRlLTUwIHB4LTMgcHktMiByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIiB0aXRsZT0iTm9tIGRlIGwnw6lwcmV1dmUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUeXBlIHNpemU9ezE2fSBjbGFzc05hbWU9InRleHQtc2xhdGUtNDAwIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT17c2V0dGluZ3NbYWN0aXZlVGFiXS5leGFtTmFtZSB8fCAnJ30gb25DaGFuZ2U9eyhlKSA9PiBzZXRTZXR0aW5ncyh7Li4uc2V0dGluZ3MsIFthY3RpdmVUYWJdOiB7Li4uc2V0dGluZ3NbYWN0aXZlVGFiXSwgZXhhbU5hbWU6IGUudGFyZ2V0LnZhbHVlfX0pfSBjbGFzc05hbWU9ImJnLXRyYW5zcGFyZW50IG91dGxpbmUtbm9uZSBmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAgdy0zMyB0ZXh0LXNtIiBwbGFjZWhvbGRlcj0iTm9tIMOpcHJldXZlIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtWzEwcHhdIHRleHQtc2xhdGUtNDAwIGZvbnQtbWVkaXVtIj4oTm9tIMOJcHJldXZlKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBnYXAtNCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtoYW5kbGVBdXRvRGlzdHJpYnV0aW9ufSBjbGFzc05hbWU9ImJnLWluZGlnby01MCBob3ZlcjpiZy1pbmRpZ28tMTAwIHRleHQtaW5kaWdvLTcwMCBib3JkZXIgYm9yZGVyLWluZGlnby0yMDAgcm91bmRlZC14bCBweC00IHB5LTIgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgdHJhbnNpdGlvbi1hbGwgZm9udC1ib2xkIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxaYXAgc2l6ZT17MTZ9IC8+IFLDqXBhcnRpdGlvbiBhdXRvIMOJbMOodmVzIHVuaXF1ZW1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtoYW5kbGVFbXB0eUp1cmllc30gY2xhc3NOYW1lPSJiZy1yZWQtNTAgaG92ZXI6YmctcmVkLTEwMCB0ZXh0LXJlZC03MDAgYm9yZGVyIGJvcmRlci1yZWQtMjAwIHJvdW5kZWQteGwgcHgtMyBweS0yIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHRyYW5zaXRpb24tYWxsIGZvbnQtYm9sZCB0ZXh0LXNtIiB0aXRsZT0iVmlkZXIgbGVzIGp1cnlzIGV0IHJlbWV0dHJlIGVuIGF0dGVudGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxSb3RhdGVDY3cgc2l6ZT17MTZ9IC8+IFZpZGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIGdhcC0xLjUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9InRleHQtWzExcHhdIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTQwMCB1cHBlcmNhc2UgbWwtMSI+SW1wb3J0cyBDU1Y8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEZpbGVVcGxvYWRlciBsYWJlbD0iUHJvZnMiIG9uRGF0YUxvYWRlZD17aGFuZGxlUHJvZnNMb2FkfSBmaWVsZHM9e1snQ0lWJywgJ05PTScsICdQUkVOT00nLCAnTUFUSUVSRSddfSBjb2xvcj0iaW5kaWdvIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RmlsZVVwbG9hZGVyIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9e2DDiWzDqHZlcyAke2FjdGl2ZVRhYn1gfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRGF0YUxvYWRlZD17YWN0aXZlVGFiID09PSAnRE5CJyA/IGhhbmRsZVN0dWRlbnRzRE5CTG9hZCA6IGFjdGl2ZVRhYiA9PT0gJ0NGRycgPyBoYW5kbGVTdHVkZW50c0NGR0xvYWQgOiBoYW5kbGVTdHVkZW50c0dPTG9hZH0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM9e1snTk9NJywgJ1BSRU5PTScsICdESVYnLCAnVFQnXX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj17YWN0aXZlVGFiID09PSAnRE5CJyA/ICdibHVlJyA6IGFjdGl2ZVRhYiA9PT0gJ0NGRycgPyAnZ3JlZW4nIDogJ3Jvc2UnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIGdhcC0xLjUgcGwtNCBib3JkZXItbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0idGV4dC1bMTFweF0gZm9udC1ib2xkIHRleHQtb3JhbmdlLTQwMCB1cHBlcmNhc2UgbWwtMSI+UGF1c2UgR8OpbsOpcmFsZTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIGJnLW9yYW5nZS01MCBweC0yIHB5LTEgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLW9yYW5nZS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGltZSIgdmFsdWU9e2JyZWFrQ29uZmlnLnRpbWV9IG9uQ2hhbmdlPXsoZSkgPT4gc2V0QnJlYWtDb25maWcoey4uLmJyZWFrQ29uZmlnLCB0aW1lOiBlLnRhcmdldC52YWx1ZX0pfSBjbGFzc05hbWU9ImJnLXRyYW5zcGFyZW50IHctMTYgdGV4dC14cyBmb250LWJvbGQgdGV4dC1vcmFuZ2UtODAwIiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBtaW49IjUiIHZhbHVlPXticmVha0NvbmZpZy5kdXJhdGlvbn0gb25DaGFuZ2U9eyhlKSA9PiBzZXRCcmVha0NvbmZpZyh7Li4uYnJlYWtDb25maWcsIGR1cmF0aW9uOiBwYXJzZUludChlLnRhcmdldC52YWx1ZSl9KX0gY2xhc3NOYW1lPSJ3LTEwIHRleHQteHMgdGV4dC1jZW50ZXIgYm9yZGVyIHJvdW5kZWQiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17aGFuZGxlQWRkR2xvYmFsQnJlYWt9IGNsYXNzTmFtZT0iYmctb3JhbmdlLTUwMCB0ZXh0LXdoaXRlIHJvdW5kZWQgcC0xIGhvdmVyOmJnLW9yYW5nZS02MDAiPjxQbHVzIHNpemU9ezEyfSAvPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgZ2FwLTEuNSBib3JkZXItbCBwbC0zIGJvcmRlci1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT0idGV4dC1bMTFweF0gZm9udC1ib2xkIHRleHQtc2xhdGUtNDAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlciBtbC0xIj5FeHBvcnQgKENTVik8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIGdhcC0yIGgtZnVsbCBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gZXhwb3J0RGF0YSgnUFJPRlMnKX0gY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBweC0zIHB5LTEuNSBiZy1pbmRpZ28tNTAgdGV4dC1pbmRpZ28tNzAwIHJvdW5kZWQtbGcgaG92ZXI6YmctaW5kaWdvLTEwMCB0cmFuc2l0aW9uIHRleHQteHMgZm9udC1ib2xkIHctZnVsbCIgdGl0bGU9IkV4cG9ydGVyIGxhIGxpc3RlIGRlcyBwcm9mZXNzZXVycyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RG93bmxvYWQgc2l6ZT17MTR9IC8+IFByb2ZzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IGV4cG9ydERhdGEoJ1NUVURFTlRTJyl9IGNsYXNzTmFtZT17YGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHB4LTMgcHktMS41IHJvdW5kZWQtbGcgdHJhbnNpdGlvbiB0ZXh0LXhzIGZvbnQtYm9sZCB3LWZ1bGwgJHthY3RpdmVUYWIgPT09ICdETkInID8gJ2JnLWJsdWUtNTAgdGV4dC1ibHVlLTcwMCBob3ZlcjpiZy1ibHVlLTEwMCcgOiBhY3RpdmVUYWIgPT09ICdDRkcnID8gJ2JnLWVtZXJhbGQtNTAgdGV4dC1lbWVyYWxkLTcwMCBob3ZlcjpiZy1lbWVyYWxkLTEwMCcgOiAnYmctcm9zZS01MCB0ZXh0LXJvc2UtNzAwIGhvdmVyOmJnLXJvc2UtMTAwJ31gfSB0aXRsZT0iRXhwb3J0ZXIgbGEgbGlzdGUgZGVzIMOpbMOodmVzIGF2ZWMgYWZmZWN0YXRpb25zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxEb3dubG9hZCBzaXplPXsxNH0gLz4gw4lsw6h2ZXMge2FjdGl2ZVRhYn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHthY3RpdmVUYWIgPT09ICdETkInICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLWJsdWUtNTAgYm9yZGVyLWwtNCBib3JkZXItYmx1ZS01MDAgcC00IHJvdW5kZWQtci14bCBzaGFkb3ctc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtMiByb3VuZGVkLWZ1bGwgdGV4dC1ibHVlLTYwMCI+PEJvb2tPcGVuIHNpemU9ezI0fSAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3NOYW1lPSJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LWJsdWUtNDAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3QgbWItMC41Ij5Nb2RlIGQnZW1wbG9pIEROQjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LWJsdWUtOTAwIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkluZGl2aWR1ZWwgOjwvc3Ryb25nPiAxNSBtaW4gKDUnIGV4cG9zw6kgKyAxMCcgZW50cmV0aWVuKS4gPHN0cm9uZz5Db2xsZWN0aWYgOjwvc3Ryb25nPiAyNSBtaW4gKDEwJyArIDE1JykuPGJyLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJvcGFjaXR5LTgwIj5QbGFjZXogZCdhYm9yZCBsZXMgbWVtYnJlcyBkZXMganVyeXMuIEdsaXNzZXogZW5zdWl0ZSBsZXMgw6lsw6h2ZXMgdmVycyBsZXMganVyeXMuIFVuZSBwYXN0aWxsZSA8c3BhbiBjbGFzc05hbWU9InRleHQtZ3JlZW4tNjAwIGZvbnQtYm9sZCI+VmVydGU8L3NwYW4+IGluZGlxdWUgdW5lIGNvbXBhdGliaWxpdMOpIG1hdGnDqHJlL3BhcmNvdXJzLjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FjdGl2ZVRhYiA9PT0gJ0NGRycgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctZW1lcmFsZC01MCBib3JkZXItbC00IGJvcmRlci1lbWVyYWxkLTUwMCBwLTQgcm91bmRlZC1yLXhsIHNoYWRvdy1zbSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYmctd2hpdGUgcC0yIHJvdW5kZWQtZnVsbCB0ZXh0LWVtZXJhbGQtNjAwIj48Qm9va09wZW4gc2l6ZT17MjR9IC8+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQteHMgZm9udC1ib2xkIHRleHQtZW1lcmFsZC00MDAgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVzdCBtYi0wLjUiPk1vZGUgZCdlbXBsb2kgQ0ZHPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtZW1lcmFsZC05MDAgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+T3JhbCA6PC9zdHJvbmc+IDIwIG1pbnV0ZXMgKEVudHJldGllbiBkb3NzaWVyKS4gPHN0cm9uZz5TdHJpY3RlbWVudCBpbmRpdmlkdWVsLjwvc3Ryb25nPjxici8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0ib3BhY2l0eS04MCI+UGxhY2V6IGQnYWJvcmQgbGVzIG1lbWJyZXMgZGVzIGp1cnlzLiBMJ8OpcHJldXZlIG5lIGNvbXBvcnRlIHBhcyBkZSBncm91cGVzLiBMZXMgdGllcnMtdGVtcHMgYsOpbsOpZmljaWVudCBkJ3VuZSBtYWpvcmF0aW9uIGF1dG9tYXRpcXVlIGR1IHRlbXBzIGRlIHBhc3NhZ2UuPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlVGFiID09PSAnR08nICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXJvc2UtNTAgYm9yZGVyLWwtNCBib3JkZXItcm9zZS01MDAgcC00IHJvdW5kZWQtci14bCBzaGFkb3ctc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXdoaXRlIHAtMiByb3VuZGVkLWZ1bGwgdGV4dC1yb3NlLTYwMCI+PEJvb2tPcGVuIHNpemU9ezI0fSAvPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3NOYW1lPSJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXJvc2UtNDAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3QgbWItMC41Ij5HcmFuZCBPcmFsIC0gR2VzdGlvbiBkZXMgRURTPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtcm9zZS05MDAgZm9udC1ib2xkIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQbGFjZXogZCdhYm9yZCBsZXMgbWVtYnJlcyBkZXMganVyeXMuIEF0dGVudGlvbiA6IFBhc3NhZ2Ugc3RyaWN0ZW1lbnQgaW5kaXZpZHVlbCAoMjAgbWluKS4gVGllcnMtdGVtcHMgOiAyNyBtaW4gKCsgcHLDqXBhIG1ham9yw6llKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyLz5BcHLDqHMgaW1wb3J0IGRlcyDDqWzDqHZlcyBkZSBUZXJtaW5hbGUsIGNsaXF1ZXogc3VyICJEw6lmaW5pciBFRFMiIHBvdXIgYXR0cmlidWVyIGxhIHNww6ljaWFsaXTDqS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZ2FwLTYgaC1bY2FsYygxMDB2aC0yODBweCldIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InctMS80IGJnLXdoaXRlIHJvdW5kZWQtbGcgc2hhZG93LXNtIGJvcmRlciBib3JkZXItZ3JheS0yMDAgZmxleCBmbGV4LWNvbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icC0zIGJnLWdyYXktMTAwIHJvdW5kZWQtdC1sZyBib3JkZXItYiBib3JkZXItZ3JheS0yMDAgZm9udC1ib2xkIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+TGlzdGUgZCdBdHRlbnRlPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC14cyBmb250LW5vcm1hbCBiZy1ncmF5LTIwMCBweC0yIHB5LTAuNSByb3VuZGVkLWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YWN0aXZlVGFiID09PSAnRE5CJyA/IHBvb2xETkIubGVuZ3RoIDogYWN0aXZlVGFiID09PSAnQ0ZHJyA/IHBvb2xDRkcubGVuZ3RoIDogcG9vbEdPLmxlbmd0aH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InAtMiBiZy13aGl0ZSBib3JkZXItYiBib3JkZXItZ3JheS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJyZWxhdGl2ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9InRleHQiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IlJlY2hlcmNoZXIgw6lsw6h2ZS4uLiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9InctZnVsbCBib3JkZXIgcm91bmRlZC1sZyBwbC04IHByLTIgcHktMS41IHRleHQtc20gZm9jdXM6b3V0bGluZS1ub25lIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWJsdWUtMTAwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3NlYXJjaFRlcm19CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17ZSA9PiBzZXRTZWFyY2hUZXJtKGUudGFyZ2V0LnZhbHVlKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFNlYXJjaCBzaXplPXsxNH0gY2xhc3NOYW1lPSJhYnNvbHV0ZSBsZWZ0LTIuNSB0b3AtMi41IHRleHQtZ3JheS00MDAiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzZWFyY2hUZXJtICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gc2V0U2VhcmNoVGVybSgiIil9IGNsYXNzTmFtZT0iYWJzb2x1dGUgcmlnaHQtMiB0b3AtMiB0ZXh0LWdyYXktNDAwIGhvdmVyOnRleHQtZ3JheS02MDAiPiZ0aW1lczs8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4LTEgb3ZlcmZsb3cteS1hdXRvIHAtMyBiZy1ncmF5LTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7KGFjdGl2ZVRhYiA9PT0gJ0ROQicgPyBwb29sRE5CIDogYWN0aXZlVGFiID09PSAnQ0ZHJyA/IHBvb2xDRkcgOiBwb29sR08pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIocyA9PiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFzZWFyY2hUZXJtIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5OT00udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy5QUkVOT00udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChzdHVkZW50ID0+ICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN0dWRlbnRDYXJkIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtzdHVkZW50LmlkfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnQ9e3N0dWRlbnR9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT17YWN0aXZlVGFifSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZT17dHJ1ZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRHJhZ1N0YXJ0PXsoZSkgPT4gZS5kYXRhVHJhbnNmZXIuc2V0RGF0YSgic3R1ZGVudCIsIEpTT04uc3RyaW5naWZ5KHN0dWRlbnQpKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRWRpdEVkcz17YWN0aXZlVGFiID09PSAnR08nID8gb3BlbkVkc01vZGFsIDogbnVsbH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uR2VuZXJhbEVkaXQ9e29wZW5HZW5lcmFsRWRpdE1vZGFsfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsoYWN0aXZlVGFiID09PSAnRE5CJyA/IHBvb2xETkIgOiBhY3RpdmVUYWIgPT09ICdDRkcnID8gcG9vbENGRyA6IHBvb2xHTykubGVuZ3RoID09PSAwICYmIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNDAwIG10LTEwIGl0YWxpYyI+QXVjdW4gw6lsw6h2ZSBlbiBhdHRlbnRlLjwvZGl2Pn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ3LTMvNCBvdmVyZmxvdy14LWF1dG8gcGItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBnYXAtNCBoLWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtPYmplY3QudmFsdWVzKGp1cmllc1thY3RpdmVUYWJdKS5tYXAoanVyeSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxKdXJ5Q29sdW1uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2p1cnkuaWR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdXJ5SWQ9e2p1cnkuaWR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdXJ5RGF0YT17anVyeX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2ZzPXtwcm9mc30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVXBkYXRlSnVyeT17dXBkYXRlSnVyeX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRHJvcFN0dWRlbnQ9e2hhbmRsZURyb3BTdHVkZW50VG9KdXJ5fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25SZW1vdmVTdHVkZW50PXtyZW1vdmVTdHVkZW50RnJvbUp1cnl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk1vdmVTdHVkZW50PXttb3ZlU3R1ZGVudH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVXBkYXRlU3R1ZGVudER1cmF0aW9uPXtoYW5kbGVVcGRhdGVTdHVkZW50SW5KdXJ5fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhhbVR5cGU9e2FjdGl2ZVRhYn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZT17c2V0dGluZ3NbYWN0aXZlVGFiXS5zdGFydFRpbWV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkVkaXRFZHM9e2FjdGl2ZVRhYiA9PT0gJ0dPJyA/IG9wZW5FZHNNb2RhbCA6IG51bGx9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkdlbmVyYWxFZGl0PXtvcGVuR2VuZXJhbEVkaXRNb2RhbH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvPgogICAgICAgICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgICAgIDwvbWFpbj4KCiAgICAgICAgICAgICAgICAgICAgPGZvb3RlciBjbGFzc05hbWU9ImJnLXNsYXRlLTUwIGJvcmRlci10IGJvcmRlci1zbGF0ZS0yMDAgcC00IHRleHQtY2VudGVyIHRleHQteHMgdGV4dC1zbGF0ZS00MDAgZmxleCBqdXN0aWZ5LWJldHdlZW4gcHgtMTAgaXRlbXMtY2VudGVyIG5vLXByaW50IG10LWF1dG8iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJmb250LWJvbGQgdGV4dC1zbGF0ZS02MDAiPk91dGlsIHByb3Bvc8OpIHBhciBZYW5uaXMgQ0hSSVNUT04gLSBWZXJzaW9uIE9SQVVYX1YxMSAyMDI2IHwgTGVzIGRvbm7DqWVzIHNvbnQgc2F1dmVnYXJkw6llcyBsb2NhbGVtZW50LiBSZXNwZWN0ZSBsYSBSR1BELjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17aGFuZGxlUmVzZXR9IGNsYXNzTmFtZT0idGV4dC1yZWQtNDAwIGhvdmVyOnRleHQtcmVkLTYwMCBob3ZlcjpiZy1yZWQtNTAgcHgtMyBweS0xLjUgcm91bmRlZC1sZyBmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPjxUcmFzaDIgc2l6ZT17MTR9IC8+IFJFU0VUPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9mb290ZXI+CgogICAgICAgICAgICAgICAgICAgIHtzaG93UHJpbnQgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICA8UHJpbnRWaWV3IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZT17KCkgPT4gc2V0U2hvd1ByaW50KGZhbHNlKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp1cmllcz17anVyaWVzfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZnM9e3Byb2ZzfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhhbVR5cGU9e2FjdGl2ZVRhYiA9PT0gJ1BJTE9UQUdFJyA/IHBpbG90YWdlVHlwZSA6IGFjdGl2ZVRhYn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzPXtzZXR0aW5nc1thY3RpdmVUYWIgPT09ICdQSUxPVEFHRScgPyBwaWxvdGFnZVR5cGUgOiBhY3RpdmVUYWJdfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nob29sTmFtZT17c2Nob29sTmFtZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaG9vbENpdHk9e3NjaG9vbENpdHl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hvb2xMb2dvPXtzY2hvb2xMb2dvfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nob29sU3RhbXA9e3NjaG9vbFN0YW1wfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblllYXI9e3Nlc3Npb25ZZWFyfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlcz17dGVtcGxhdGVzfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGVtcGxhdGVzPXtzZXRUZW1wbGF0ZXN9CiAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAge3Nob3dFZHNNb2RhbCAmJiBjdXJyZW50U3R1ZGVudEZvckVkcyAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgIDxTdHVkZW50RWRpdE1vZGFsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudD17Y3VycmVudFN0dWRlbnRGb3JFZHN9IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZT17KCkgPT4gc2V0U2hvd0Vkc01vZGFsKGZhbHNlKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2F2ZT17c2F2ZUVkc30KICAgICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICApfQoKICAgICAgICAgICAgICAgICAgICB7c2hvd0dlbmVyYWxFZGl0TW9kYWwgJiYgY3VycmVudFN0dWRlbnRGb3JHZW5lcmFsRWRpdCAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgIDxHZW5lcmFsU3R1ZGVudEVkaXRNb2RhbCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnQ9e2N1cnJlbnRTdHVkZW50Rm9yR2VuZXJhbEVkaXR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGFtVHlwZT17YWN0aXZlVGFifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZT17KCkgPT4gc2V0U2hvd0dlbmVyYWxFZGl0TW9kYWwoZmFsc2UpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TYXZlPXtzYXZlR2VuZXJhbFN0dWRlbnR9CiAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgKX0KCiAgICAgICAgICAgICAgICAgICAge3Nob3dTYXZlTW9kYWwgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICA8U2F2ZU1vZGFsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWU9e3NhdmVGaWxlTmFtZX0gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRGaWxlTmFtZT17c2V0U2F2ZUZpbGVOYW1lfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U9eygpID0+IHNldFNob3dTYXZlTW9kYWwoZmFsc2UpfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29uZmlybT17cGVyZm9ybVNhdmV9IAogICAgICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICAgICl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICBjb25zdCByb290ID0gUmVhY3RET00uY3JlYXRlUm9vdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm9vdCcpKTsKICAgICAgICByb290LnJlbmRlcig8QXBwIC8+KTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=", "aed": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImZyIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+QUVEIFBJTE9URSBCeSBTeWx2w6hyZSBNaWNoZWxldDwvdGl0bGU+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMveGxzeC8wLjE4LjUveGxzeC5mdWxsLm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2ZvbnQtYXdlc29tZS82LjAuMC9jc3MvYWxsLm1pbi5jc3MiPgogICAgCiAgICA8c3R5bGU+CiAgICAgICAgOnJvb3QgewogICAgICAgICAgICAtLXByaW1hcnk6ICMyYzNlNTA7CiAgICAgICAgICAgIC0tc2Vjb25kYXJ5OiAjMzQ5OGRiOwogICAgICAgICAgICAtLWFjY2VudDogI2U3NGMzYzsKICAgICAgICAgICAgLS1zdWNjZXNzOiAjMjdhZTYwOwogICAgICAgICAgICAtLWJnOiAjZjBmMmY1OwogICAgICAgICAgICAtLXRleHQ6ICMzMzM7CiAgICAgICAgfQoKICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6ICdBcHRvcycsICdDYWxpYnJpJywgJ1RyZWJ1Y2hldCBNUycsIEFyaWFsLCBzYW5zLXNlcmlmOyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iZyk7IGNvbG9yOiB2YXIoLS10ZXh0KTsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyBkaXNwbGF5OiBmbGV4OyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyBoZWlnaHQ6IDEwMHZoOyB9CgogICAgICAgIC8qIC0tLSBOQVZJR0FUSU9OIC0tLSAqLwogICAgICAgIG5hdiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgIzFhMmEzYSwgIzJjM2U1MCk7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMCAxNXB4OyBoZWlnaHQ6IDYwcHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAycHggNXB4IHJnYmEoMCwwLDAsMC4yKTsgei1pbmRleDogMTAwOwogICAgICAgIH0KICAgICAgICAubmF2LWxlZnQgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDE1cHg7IH0KICAgICAgICAubmF2LXRpdGxlIHsgZm9udC1zaXplOiAxLjFyZW07IGZvbnQtd2VpZ2h0OiBib2xkOyBsZXR0ZXItc3BhY2luZzogMC41cHg7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IH0KICAgICAgICAubmF2LXN1YnRpdGxlIHsgZm9udC1zaXplOiAwLjdyZW07IGNvbG9yOiAjYmRjM2M3OyBmb250LXdlaWdodDogbm9ybWFsOyB9CiAgICAgICAgLm5hdi1hY3Rpb25zIHsgZGlzcGxheTogZmxleDsgZ2FwOiAxMHB4OyBtYXJnaW4tcmlnaHQ6IDIwcHg7IGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4yKTsgcGFkZGluZy1yaWdodDogMjBweDsgfQogICAgICAgIC5idG4tbmF2LWFjdGlvbiB7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjMpOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDVweCAxMHB4OyBib3JkZXItcmFkaXVzOiA0cHg7IGN1cnNvcjogcG9pbnRlcjsgZm9udC1zaXplOiAwLjhyZW07IHRyYW5zaXRpb246IDAuMnM7IH0KICAgICAgICAuYnRuLW5hdi1hY3Rpb246aG92ZXIgeyBiYWNrZ3JvdW5kOiB2YXIoLS1zZWNvbmRhcnkpOyBib3JkZXItY29sb3I6IHZhcigtLXNlY29uZGFyeSk7IH0KICAgICAgICAuYnRuLWRhbmdlci1uYXYgeyBiYWNrZ3JvdW5kOiByZ2JhKDIzMSwgNzYsIDYwLCAwLjIpOyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1hY2NlbnQpOyBjb2xvcjogI2ZmY2NjYzsgfQogICAgICAgIC5idG4tZGFuZ2VyLW5hdjpob3ZlciB7IGJhY2tncm91bmQ6IHZhcigtLWFjY2VudCk7IGNvbG9yOiB3aGl0ZTsgfQoKICAgICAgICAubmF2LXRhYnMgeyBkaXNwbGF5OiBmbGV4OyBnYXA6IDVweDsgfQogICAgICAgIC50YWItYnRuIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7IGJvcmRlcjogbm9uZTsgY29sb3I6ICNiZGMzYzc7CiAgICAgICAgICAgIHBhZGRpbmc6IDAgMTVweDsgaGVpZ2h0OiA2MHB4OyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtd2VpZ2h0OiA2MDA7IGZvbnQtc2l6ZTogMC45NXJlbTsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGJvcmRlci1ib3R0b206IDRweCBzb2xpZCB0cmFuc3BhcmVudDsKICAgICAgICB9CiAgICAgICAgLnRhYi1idG4uYWN0aXZlIHsgY29sb3I6IHdoaXRlOyBib3JkZXItYm90dG9tLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpOyBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuMSk7IH0KCiAgICAgICAgLyogLS0tIExBWU9VVCAtLS0gKi8KICAgICAgICBtYWluIHsgZmxleDogMTsgb3ZlcmZsb3c6IGhpZGRlbjsgcG9zaXRpb246IHJlbGF0aXZlOyB9CiAgICAgICAgLnZpZXctc2VjdGlvbiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgYm90dG9tOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OyBvdmVyZmxvdy15OiBhdXRvOyBkaXNwbGF5OiBub25lOwogICAgICAgIH0KICAgICAgICAudmlldy1zZWN0aW9uLmFjdGl2ZSB7IGRpc3BsYXk6IGJsb2NrOyB9CgogICAgICAgIC8qIC0tLSBVSSBDT01QT05FTlRTIC0tLSAqLwogICAgICAgIC5jYXJkIHsgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDIwcHg7IGJvcmRlci1yYWRpdXM6IDhweDsgYm94LXNoYWRvdzogMCAycHggNXB4IHJnYmEoMCwwLDAsMC4wNSk7IG1hcmdpbi1ib3R0b206IDIwcHg7IH0KICAgICAgICBzZWxlY3QsIGlucHV0W3R5cGU9dGV4dF0sIGlucHV0W3R5cGU9bnVtYmVyXSwgaW5wdXRbdHlwZT10aW1lXSB7IHBhZGRpbmc6IDhweDsgYm9yZGVyOiAxcHggc29saWQgI2RkZDsgYm9yZGVyLXJhZGl1czogNHB4OyB9CiAgICAgICAgLmJ0biB7IGJvcmRlcjogbm9uZTsgcGFkZGluZzogOHB4IDE2cHg7IGJvcmRlci1yYWRpdXM6IDRweDsgY3Vyc29yOiBwb2ludGVyOyBmb250LXdlaWdodDogYm9sZDsgfQogICAgICAgIC5idG4tcHJpbWFyeSB7IGJhY2tncm91bmQ6IHZhcigtLXNlY29uZGFyeSk7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5idG4tZGFuZ2VyIHsgYmFja2dyb3VuZDogdmFyKC0tYWNjZW50KTsgY29sb3I6IHdoaXRlOyB9CiAgICAgICAgCiAgICAgICAgLyogLS0tIE1FTlUgMSA6IERBU0hCT0FSRCAtLS0gKi8KICAgICAgICAuaW1wb3J0LWhlYWRlciB7IGJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAyMHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IG1hcmdpbi1ib3R0b206IDIwcHg7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgYm94LXNoYWRvdzogMCAycHggNXB4IHJnYmEoMCwwLDAsMC4wNSk7IH0KICAgICAgICAuZGFzaGJvYXJkLWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpbGwsIG1pbm1heCgzNTBweCwgMWZyKSk7IGdhcDogMjBweDsgfQogICAgICAgIC5hZWQtc3VtbWFyeS1jYXJkIHsgYmFja2dyb3VuZDogd2hpdGU7IGJvcmRlci1yYWRpdXM6IDEwcHg7IG92ZXJmbG93OiBoaWRkZW47IGJveC1zaGFkb3c6IDAgM3B4IDZweCByZ2JhKDAsMCwwLDAuMSk7IGJvcmRlci10b3A6IDVweCBzb2xpZCB2YXIoLS1zZWNvbmRhcnkpOyBicmVhay1pbnNpZGU6IGF2b2lkOyB9CiAgICAgICAgLmNhcmQtaGVhZGVyIHsgcGFkZGluZzogMTVweDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgYmFja2dyb3VuZDogI2Y5ZjlmOTsgfQogICAgICAgIC5jYXJkLWJvZHkgeyBwYWRkaW5nOiAxNXB4OyBmb250LXNpemU6IDAuOXJlbTsgfQogICAgICAgIC5zdGF0LXJvdyB7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgbWFyZ2luLWJvdHRvbTogOHB4OyBwYWRkaW5nLWJvdHRvbTogOHB4OyBib3JkZXItYm90dG9tOiAxcHggZGFzaGVkICNlZWU7IH0KICAgICAgICAuY29uc3RyYWludHMtYm94IHsgbWFyZ2luLXRvcDogMTBweDsgYmFja2dyb3VuZDogI2ZmZjVmNTsgY29sb3I6ICNjMDM5MmI7IHBhZGRpbmc6IDhweDsgYm9yZGVyLXJhZGl1czogNHB4OyBmb250LXNpemU6IDAuODVyZW07IH0KCiAgICAgICAgLyogQmFkZ2UgcG91ciBxdW90aXTDqSBub24tc3RhbmRhcmQgKi8KICAgICAgICAuYmFkZ2UtY3VzdG9tIHsgYmFja2dyb3VuZDogI2U3NGMzYyAhaW1wb3J0YW50OyB9CiAgICAgICAgLmJhZGdlLXN0YW5kYXJkIHsgYmFja2dyb3VuZDogdmFyKC0tc2Vjb25kYXJ5KTsgfQoKICAgICAgICAvKiAtLS0gTUVOVSAyIDogUExBTk5JTkcgLS0tICovCiAgICAgICAgLnBsYW5uZXItdG9vbGJhciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAxMHB4IDE1cHg7IGJvcmRlci1yYWRpdXM6IDhweDsgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEwcHg7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsMCwwLDAuMSk7IGZsZXgtd3JhcDogd3JhcDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnBhbGV0dGUgeyBkaXNwbGF5OiBmbGV4OyBnYXA6IDhweDsgZmxleC13cmFwOiB3cmFwOyBhbGlnbi1pdGVtczogY2VudGVyOyB9CiAgICAgICAgLnBhbGV0dGUtYnRuIHsKICAgICAgICAgICAgcGFkZGluZzogOHB4IDEycHg7IGJvcmRlci1yYWRpdXM6IDRweDsgY3Vyc29yOiBwb2ludGVyOyBjb2xvcjogd2hpdGU7IGZvbnQtc2l6ZTogMC44NXJlbTsgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkIHdoaXRlOyBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjEpOyB0ZXh0LXNoYWRvdzogMCAxcHggMXB4IHJnYmEoMCwwLDAsMC4yKTsKICAgICAgICB9CiAgICAgICAgLnBhbGV0dGUtYnRuOmhvdmVyIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjA1KTsgfQogICAgICAgIC5wYWxldHRlLWJ0bi5zZWxlY3RlZCB7IGJvcmRlci1jb2xvcjogIzMzMzsgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOyBib3gtc2hhZG93OiAwIDRweCA4cHggcmdiYSgwLDAsMCwwLjIpOyB9CgogICAgICAgIC8qIENPVUxFVVJTICovCiAgICAgICAgLmJnLWdyaWxsZSB7IGJhY2tncm91bmQtY29sb3I6ICNmZjAwZmY7IH0gCiAgICAgICAgLmJnLWFkbWluIHsgYmFja2dyb3VuZC1jb2xvcjogIzAwYjg5NDsgfSAKICAgICAgICAuYmctZXR1ZGUgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjOGU0NGFkOyB9IAogICAgICAgIC5iZy1zZWxmIHsgYmFja2dyb3VuZC1jb2xvcjogI2U2N2UyMjsgfSAKICAgICAgICAuYmctY291bG9pcnMgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjFjNDBmOyBjb2xvcjogIzMzMzsgdGV4dC1zaGFkb3c6IG5vbmU7IH0KICAgICAgICAuYmctY291ciB7IGJhY2tncm91bmQtY29sb3I6ICNkNjMwMzE7IH0gCiAgICAgICAgLmJnLXN1aXZpIHsgYmFja2dyb3VuZC1jb2xvcjogIzI3YWU2MDsgfSAKICAgICAgICAuYmctZXJhc2VyIHsgYmFja2dyb3VuZC1jb2xvcjogI2RmZTZlOTsgY29sb3I6ICM2MzZlNzI7IHRleHQtc2hhZG93OiBub25lOyBib3JkZXI6IDFweCBzb2xpZCAjYjJiZWMzOyB9CgogICAgICAgIC8qIFNlcnZpY2VzIGR5bmFtaXF1ZXMgKi8KICAgICAgICAuYnRuLWFkZC1zZXJ2aWNlIHsgCiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSk7IAogICAgICAgICAgICBib3JkZXI6IDJweCBkYXNoZWQgd2hpdGU7IAogICAgICAgICAgICBmb250LXNpemU6IDEuMnJlbTsgCiAgICAgICAgICAgIHBhZGRpbmc6IDhweCAxNHB4OwogICAgICAgIH0KICAgICAgICAuYnRuLWFkZC1zZXJ2aWNlOmhvdmVyIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOyB9CiAgICAgICAgCiAgICAgICAgLnNlcnZpY2UtZGVsZXRlIHsgCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAtNnB4OyByaWdodDogLTZweDsgCiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlNzRjM2M7IGNvbG9yOiB3aGl0ZTsgCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsgd2lkdGg6IDE2cHg7IGhlaWdodDogMTZweDsgCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsgY3Vyc29yOiBwb2ludGVyOyAKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsgbGluZS1oZWlnaHQ6IDE7CiAgICAgICAgfQogICAgICAgIC5wYWxldHRlLWJ0bi13cmFwcGVyIHsgcG9zaXRpb246IHJlbGF0aXZlOyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IH0KICAgICAgICAucGFsZXR0ZS1idG4td3JhcHBlcjpob3ZlciAuc2VydmljZS1kZWxldGUgeyBkaXNwbGF5OiBmbGV4OyB9CiAgICAgICAgCiAgICAgICAgLyogTW9kYWwgcG91ciBham91dGVyIHVuIHNlcnZpY2UgZXQgY29uZmlnICovCiAgICAgICAgLm1vZGFsLW92ZXJsYXkgewogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7IHRvcDogMDsgbGVmdDogMDsgcmlnaHQ6IDA7IGJvdHRvbTogMDsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjUpOyBkaXNwbGF5OiBub25lOyAKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IHotaW5kZXg6IDEwMDA7CiAgICAgICAgfQogICAgICAgIC5tb2RhbC1vdmVybGF5LmFjdGl2ZSB7IGRpc3BsYXk6IGZsZXg7IH0KICAgICAgICAubW9kYWwtYm94IHsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDI1cHg7IGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMTBweCA0MHB4IHJnYmEoMCwwLDAsMC4zKTsgbWluLXdpZHRoOiAzNTBweDsKICAgICAgICAgICAgbWF4LXdpZHRoOiA1MDBweDsKICAgICAgICB9CiAgICAgICAgLm1vZGFsLWJveCBoMyB7IG1hcmdpbi10b3A6IDA7IGNvbG9yOiB2YXIoLS1wcmltYXJ5KTsgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkIHZhcigtLXNlY29uZGFyeSk7IHBhZGRpbmctYm90dG9tOiAxMHB4OyB9CiAgICAgICAgLm1vZGFsLWJveCBsYWJlbCB7IGRpc3BsYXk6IGJsb2NrOyBtYXJnaW4tYm90dG9tOiA1cHg7IGZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogIzU1NTsgfQogICAgICAgIC5tb2RhbC1ib3ggaW5wdXRbdHlwZT0idGV4dCJdLCAubW9kYWwtYm94IGlucHV0W3R5cGU9Im51bWJlciJdIHsgd2lkdGg6IDEwMCU7IHBhZGRpbmc6IDEwcHg7IG1hcmdpbi1ib3R0b206IDE1cHg7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KICAgICAgICAubW9kYWwtYm94IGlucHV0W3R5cGU9ImNvbG9yIl0geyB3aWR0aDogMTAwJTsgaGVpZ2h0OiA1MHB4OyBwYWRkaW5nOiAwOyBib3JkZXI6IG5vbmU7IGN1cnNvcjogcG9pbnRlcjsgbWFyZ2luLWJvdHRvbTogMTVweDsgfQogICAgICAgIC5tb2RhbC1hY3Rpb25zIHsgZGlzcGxheTogZmxleDsgZ2FwOiAxMHB4OyBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOyBtYXJnaW4tdG9wOiAyMHB4OyB9CiAgICAgICAgLm1vZGFsLWFjdGlvbnMgYnV0dG9uIHsgcGFkZGluZzogMTBweCAyMHB4OyBib3JkZXI6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDZweDsgY3Vyc29yOiBwb2ludGVyOyBmb250LXdlaWdodDogYm9sZDsgfQogICAgICAgIC5idG4tY2FuY2VsIHsgYmFja2dyb3VuZDogI2JkYzNjNzsgY29sb3I6ICMyYzNlNTA7IH0KICAgICAgICAuYnRuLWNvbmZpcm0geyBiYWNrZ3JvdW5kOiB2YXIoLS1zZWNvbmRhcnkpOyBjb2xvcjogd2hpdGU7IH0KICAgICAgICAuY29sb3ItcHJlc2V0cyB7IGRpc3BsYXk6IGZsZXg7IGdhcDogOHB4OyBmbGV4LXdyYXA6IHdyYXA7IG1hcmdpbi1ib3R0b206IDE1cHg7IH0KICAgICAgICAuY29sb3ItcHJlc2V0IHsgCiAgICAgICAgICAgIHdpZHRoOiAzMHB4OyBoZWlnaHQ6IDMwcHg7IGJvcmRlci1yYWRpdXM6IDZweDsgY3Vyc29yOiBwb2ludGVyOyAKICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgdHJhbnNwYXJlbnQ7IHRyYW5zaXRpb246IDAuMnM7CiAgICAgICAgfQogICAgICAgIC5jb2xvci1wcmVzZXQ6aG92ZXIgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7IGJvcmRlci1jb2xvcjogIzMzMzsgfQogICAgICAgIC5wcmV2aWV3LWJ0biB7IAogICAgICAgICAgICBwYWRkaW5nOiAxMHB4IDIwcHg7IGJvcmRlci1yYWRpdXM6IDZweDsgY29sb3I6IHdoaXRlOyBmb250LXdlaWdodDogYm9sZDsgCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAxNXB4IDA7IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgfQoKICAgICAgICAvKiBMaXN0ZSBkZSBzbG90cyBwb3VyIGxhIGNvbmZpZyAqLwogICAgICAgIC5zbG90LWxpc3QgewogICAgICAgICAgICBtYXgtaGVpZ2h0OiAzMDBweDsgb3ZlcmZsb3cteTogYXV0bzsgYm9yZGVyOiAxcHggc29saWQgI2VlZTsgYm9yZGVyLXJhZGl1czogNHB4OyBwYWRkaW5nOiAxMHB4OyBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgICAgIH0KICAgICAgICAuc2xvdC1pdGVtIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyAKICAgICAgICAgICAgcGFkZGluZzogOHB4OyBiYWNrZ3JvdW5kOiAjZjlmOWY5OyBtYXJnaW4tYm90dG9tOiA1cHg7IGJvcmRlci1yYWRpdXM6IDRweDsgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCB2YXIoLS1zZWNvbmRhcnkpOwogICAgICAgIH0KICAgICAgICAuc2xvdC1pbnB1dHMgeyBkaXNwbGF5OiBmbGV4OyBnYXA6IDEwcHg7IG1hcmdpbi1ib3R0b206IDEwcHg7IGFsaWduLWl0ZW1zOiBmbGV4LWVuZDsgfQoKICAgICAgICAuZWR0LWNvbnRhaW5lciB7IGJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAxNXB4OyBib3JkZXItcmFkaXVzOiA4cHg7IG92ZXJmbG93LXg6IGF1dG87IG1pbi1oZWlnaHQ6IDUwMHB4OyB9CiAgICAgICAgCiAgICAgICAgLyogVEFCTEVBVSBTVEFCSUxJU8OJICovCiAgICAgICAgLmVkdC10YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB0YWJsZS1sYXlvdXQ6IGZpeGVkOyB9CiAgICAgICAgLmVkdC10YWJsZSB0aCB7IGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnkpOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsgYm9yZGVyOiAxcHggc29saWQgIzM0NDk1ZTsgfQogICAgICAgIC5lZHQtdGFibGUgdGQgeyAKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsgaGVpZ2h0OiA0MHB4OyB3aWR0aDogMTglOyBwYWRkaW5nOiAwOyB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIH0KICAgICAgICAuZWR0LXRhYmxlIHRkLnRpbWUtY29sIHsgCiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmMWYyZjY7IGNvbG9yOiAjMmMzZTUwOyBmb250LXdlaWdodDogYm9sZDsgd2lkdGg6IDkwcHggIWltcG9ydGFudDsgYm9yZGVyLXJpZ2h0OiAycHggc29saWQgI2JkYzNjNzsgCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC43NXJlbTsgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgIH0KCiAgICAgICAgLmNlbGwtY29udGVudCB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07IGZvbnQtd2VpZ2h0OiA4MDA7IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IAogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOyBvdmVyZmxvdzogaGlkZGVuOyB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsgY29sb3I6IHdoaXRlOwogICAgICAgIH0KICAgICAgICAuY2VsbC1pbmFjdGl2ZSB7IGJhY2tncm91bmQ6ICNmOWY5Zjk7IGN1cnNvcjogbm90LWFsbG93ZWQ7IH0KICAgICAgICAuY2VsbC1ibG9ja2VkIHsgYmFja2dyb3VuZDogcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCg0NWRlZywgI2UwZTBlMCwgI2UwZTBlMCAxMHB4LCAjZWNmMGYxIDEwcHgsICNlY2YwZjEgMjBweCk7IGhlaWdodDogMTAwJTsgfQoKICAgICAgICAvKiAtLS0gTUVOVSAzIDogR0VTVElPTiAtLS0gKi8KICAgICAgICAuZ2VzdGlvbi1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMmZyOyBnYXA6IDIwcHg7IH0KICAgICAgICAuc3RhdHMtcm93IHsgZGlzcGxheTogZmxleDsgZ2FwOiAxNXB4OyBtYXJnaW4tYm90dG9tOiAyMHB4OyB9CiAgICAgICAgLmJhbGFuY2UtYm94IHsgCiAgICAgICAgICAgIGZsZXg6IDE7IHRleHQtYWxpZ246IGNlbnRlcjsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZDogdmFyKC0tcHJpbWFyeSk7IGNvbG9yOiB3aGl0ZTsgYm9yZGVyLXJhZGl1czogOHB4OyAKICAgICAgICAgICAgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgfQogICAgICAgIC5iYWxhbmNlLWJveC5zZWNvbmRhcnkgeyBiYWNrZ3JvdW5kOiAjOGU0NGFkOyB9CiAgICAgICAgLmJhbGFuY2UtYW1vdW50IHsgZm9udC1zaXplOiAycmVtOyBmb250LXdlaWdodDogYm9sZDsgbWFyZ2luOiAxMHB4IDA7IH0KICAgICAgICAuaGlzdG9yeS10YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB9CiAgICAgICAgLmhpc3RvcnktdGFibGUgdGggeyB0ZXh0LWFsaWduOiBsZWZ0OyBwYWRkaW5nOiAxMHB4OyBib3JkZXItYm90dG9tOiAycHggc29saWQgI2VlZTsgYmFja2dyb3VuZDogI2Y5ZjlmOTsgfQogICAgICAgIC5oaXN0b3J5LXRhYmxlIHRkIHsgcGFkZGluZzogMTBweDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7IH0KCiAgICAgICAgLyogLS0tIE1FTlUgNCA6IFJFUEFSVElUSU9OIChRVUkgRkFJVCBRVU9JKSAtLS0gKi8KICAgICAgICAucmVwYXJ0aXRpb24tdG9vbGJhciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOyBwYWRkaW5nOiAxNXB4OyBib3JkZXItcmFkaXVzOiA4cHg7IG1hcmdpbi1ib3R0b206IDE1cHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgYm94LXNoYWRvdzogMCAxcHggM3B4IHJnYmEoMCwwLDAsMC4xKTsKICAgICAgICB9CiAgICAgICAgLnJlcGFydGl0aW9uLXRhYmxlIHsgd2lkdGg6IDEwMCU7IGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7IHRhYmxlLWxheW91dDogYXV0bzsgfQogICAgICAgIC5yZXBhcnRpdGlvbi10YWJsZSB0aCB7IGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnkpOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHg7IGJvcmRlcjogMXB4IHNvbGlkICMzNDQ5NWU7IGZvbnQtc2l6ZTogMC45cmVtOyBwb3NpdGlvbjogc3RpY2t5OyB0b3A6IDA7IH0KICAgICAgICAucmVwYXJ0aXRpb24tdGFibGUgdGQgeyBib3JkZXI6IDFweCBzb2xpZCAjY2NjOyBwYWRkaW5nOiA4cHg7IHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7IGJhY2tncm91bmQ6IHdoaXRlOyBmb250LXNpemU6IDAuODVyZW07IGhlaWdodDogYXV0bzsgfQogICAgICAgIC5yZXBhcnRpdGlvbi10YWJsZSB0cjpudGgtY2hpbGQoZXZlbikgdGQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOWZhOyB9CiAgICAgICAgLmFnZW50LXRhZyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsgcGFkZGluZzogM3B4IDhweDsgbWFyZ2luOiAycHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNlY2YwZjE7IGJvcmRlci1yYWRpdXM6IDEycHg7IGJvcmRlcjogMXB4IHNvbGlkICNiZGMzYzc7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjMmMzZTUwOyBmb250LXNpemU6IDAuOHJlbTsKICAgICAgICB9CgogICAgICAgIC8qIC0tLSBNRU5VIDUgOiBFTiBESVJFQ1QgKE5PVVZFQVUpIC0tLSAqLwogICAgICAgIC5saXZlLWhlYWRlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMyYzNlNTA7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMzBweDsgYm9yZGVyLXJhZGl1czogMTBweDsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tYm90dG9tOiAzMHB4OyBib3gtc2hhZG93OiAwIDVweCAxNXB4IHJnYmEoMCwwLDAsMC4yKTsKICAgICAgICB9CiAgICAgICAgLmNsb2NrLXRpbWUgeyBmb250LXNpemU6IDNyZW07IGZvbnQtd2VpZ2h0OiA4MDA7IGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUkgTW9ubycsIG1vbm9zcGFjZTsgfQogICAgICAgIC5jbG9jay1kYXkgeyBmb250LXNpemU6IDEuNXJlbTsgY29sb3I6ICMzNDk4ZGI7IG1hcmdpbi1ib3R0b206IDVweDsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgbGV0dGVyLXNwYWNpbmc6IDJweDsgfQogICAgICAgIAogICAgICAgIC5saXZlLWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpbGwsIG1pbm1heCgyODBweCwgMWZyKSk7IGdhcDogMjBweDsgfQogICAgICAgIC5saXZlLWNhcmQgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsgYm9yZGVyLXJhZGl1czogMTBweDsgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAzcHggNnB4IHJnYmEoMCwwLDAsMC4xKTsKICAgICAgICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMnM7CiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiA1cHggc29saWQgI2NjYzsKICAgICAgICB9CiAgICAgICAgLmxpdmUtY2FyZC5hY3RpdmUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTVweCk7IGJveC1zaGFkb3c6IDAgOHB4IDE1cHggcmdiYSgwLDAsMCwwLjE1KTsgYm9yZGVyLWxlZnQtY29sb3I6IHZhcigtLXN1Y2Nlc3MpOyB9CiAgICAgICAgLmxpdmUtY2FyZC1ib2R5IHsgcGFkZGluZzogMjBweDsgfQogICAgICAgIC5saXZlLWFnZW50LW5hbWUgeyBmb250LXNpemU6IDEuMnJlbTsgZm9udC13ZWlnaHQ6IGJvbGQ7IG1hcmdpbi1ib3R0b206IDEwcHg7IGNvbG9yOiB2YXIoLS1wcmltYXJ5KTsgfQogICAgICAgIC5saXZlLXN0YXR1cyB7IAogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHBhZGRpbmc6IDVweCAxMHB4OyBib3JkZXItcmFkaXVzOiA0cHg7IAogICAgICAgICAgICBmb250LXNpemU6IDAuOXJlbTsgZm9udC13ZWlnaHQ6IGJvbGQ7IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgfQogICAgICAgIC5zZWN0aW9uLXRpdGxlIHsgbWFyZ2luOiAzMHB4IDAgMTVweCAwOyBjb2xvcjogIzdmOGM4ZDsgZm9udC1zaXplOiAxcmVtOyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2NjYzsgcGFkZGluZy1ib3R0b206IDVweDsgfQoKICAgICAgICAvKiBJTVBPUlQgSU5GTyAqLwogICAgICAgIC5pbXBvcnQtaW5mbyB7IAogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZThmNGZkOyBib3JkZXI6IDFweCBzb2xpZCAjMzQ5OGRiOyBib3JkZXItcmFkaXVzOiA4cHg7IAogICAgICAgICAgICBwYWRkaW5nOiAxNXB4OyBtYXJnaW4tYm90dG9tOiAyMHB4OyBmb250LXNpemU6IDAuOXJlbTsgCiAgICAgICAgfQogICAgICAgIC5pbXBvcnQtaW5mbyBzdHJvbmcgeyBjb2xvcjogdmFyKC0tcHJpbWFyeSk7IH0KICAgICAgICAucXVvdGl0ZS1saXN0IHsgZGlzcGxheTogZmxleDsgZ2FwOiAxNXB4OyBmbGV4LXdyYXA6IHdyYXA7IG1hcmdpbi10b3A6IDEwcHg7IH0KICAgICAgICAucXVvdGl0ZS1pdGVtIHsgYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDVweCAxMHB4OyBib3JkZXItcmFkaXVzOiA0cHg7IGZvbnQtc2l6ZTogMC44NXJlbTsgfQoKICAgICAgICAvKiBaT05FUyBEJ0lNUFJFU1NJT04gKENhY2jDqWVzIHBhciBkw6lmYXV0KSAqLwogICAgICAgICNiYXRjaC1wcmludC1hcmVhLCAjZGFzaGJvYXJkLXByaW50LWFyZWEsICNnZXN0aW9uLXByaW50LWFyZWEsICNyZXBhcnRpdGlvbi1wcmludC1hcmVhIHsgZGlzcGxheTogbm9uZTsgfQoKICAgICAgICAvKiAtLS0gUFJJTlQgQ1NTIE9QVElNSVPDiSBQQVlTQUdFIChMQU5EU0NBUEUpIC0tLSAqLwogICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgIEBwYWdlIHsKICAgICAgICAgICAgICAgIHNpemU6IEE0IGxhbmRzY2FwZTsKICAgICAgICAgICAgICAgIG1hcmdpbjogNW1tOyAvKiBNYXJnZXMgcsOpZHVpdGVzIHBvdXIgbWF4aW1pc2VyIGwnZXNwYWNlICovCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJvZHkgeyAKICAgICAgICAgICAgICAgIC13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdCAhaW1wb3J0YW50OyAKICAgICAgICAgICAgICAgIHByaW50LWNvbG9yLWFkanVzdDogZXhhY3QgIWltcG9ydGFudDsgCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyAKICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdBcHRvcycsICdDYWxpYnJpJywgJ1RyZWJ1Y2hldCBNUycsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBuYXYsIC5wbGFubmVyLXRvb2xiYXIsIC5pbXBvcnQtaGVhZGVyLCAubmF2LWFjdGlvbnMsIC50YWItYnRuLCAuaW1wb3J0LWluZm8sIC5yZXBhcnRpdGlvbi10b29sYmFyIHsgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyB9CiAgICAgICAgICAgIAogICAgICAgICAgICBib2R5Om5vdCgucHJpbnRpbmctbW9kZSkgLnZpZXctc2VjdGlvbiB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfQoKICAgICAgICAgICAgLyogSGVhZGVyIGQnaW1wcmVzc2lvbiBjb21tdW4gKi8KICAgICAgICAgICAgLnByaW50LWhlYWRlci1iYXRjaCB7IAogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOyAKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4ycmVtOyAKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNXB4OyAKICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjMzMzOyAKICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAycHg7IAogICAgICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgICAgICAgICAgIHBhZ2UtYnJlYWstYWZ0ZXI6IGF2b2lkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAucGFnZS1icmVhayB7IHBhZ2UtYnJlYWstYWZ0ZXI6IGFsd2F5czsgZGlzcGxheTogYmxvY2s7IGhlaWdodDogMXB4OyB9CgogICAgICAgICAgICAvKiBNT0RFOiBEYXNoYm9hcmQgKi8KICAgICAgICAgICAgYm9keS5wcmludGluZy1kYXNoYm9hcmQgbWFpbiB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfQogICAgICAgICAgICBib2R5LnByaW50aW5nLWRhc2hib2FyZCAjZGFzaGJvYXJkLXByaW50LWFyZWEgeyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OyB9CiAgICAgICAgICAgIGJvZHkucHJpbnRpbmctZGFzaGJvYXJkIC5kYXNoYm9hcmQtZ3JpZCB7IAogICAgICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsgCiAgICAgICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnIgMWZyOyAvKiAzIGNvbG9ubmVzIGVuIHBheXNhZ2UgKi8KICAgICAgICAgICAgICAgIGdhcDogMTBweDsgCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDAuOHJlbTsKICAgICAgICAgICAgfQogICAgICAgICAgICBib2R5LnByaW50aW5nLWRhc2hib2FyZCAuYWVkLXN1bW1hcnktY2FyZCB7IGJveC1zaGFkb3c6IG5vbmU7IGJvcmRlcjogMXB4IHNvbGlkICNjY2M7IGJyZWFrLWluc2lkZTogYXZvaWQ7IH0KCiAgICAgICAgICAgIC8qIE1PREU6IEVEVCBCYXRjaCAoQWdlbnQgU2V1bCBvdSBUb3V0KSAtIE9QVElNSVPDiSBQQVlTQUdFICovCiAgICAgICAgICAgIGJvZHkucHJpbnRpbmctYmF0Y2ggbWFpbiB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfQogICAgICAgICAgICBib2R5LnByaW50aW5nLWJhdGNoICNiYXRjaC1wcmludC1hcmVhIHsgZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsgd2lkdGg6IDEwMCU7IH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGJvZHkucHJpbnRpbmctYmF0Y2ggLmVkdC10YWJsZSB7IAogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7IAogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjdyZW07IAogICAgICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKICAgICAgICAgICAgICAgIHRhYmxlLWxheW91dDogZml4ZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYm9keS5wcmludGluZy1iYXRjaCAuZWR0LXRhYmxlIHRoIHsgCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAycHg7IAogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2NjYyAhaW1wb3J0YW50OyAKICAgICAgICAgICAgICAgIGNvbG9yOiBibGFjayAhaW1wb3J0YW50OyAKICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjhyZW07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYm9keS5wcmludGluZy1iYXRjaCAuZWR0LXRhYmxlIHRkIHsgCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDE4cHggIWltcG9ydGFudDsgLyogSGF1dGV1ciBmb3Jjw6llIHRyw6hzIHBldGl0ZSBwb3VyIHRlbmlyIHN1ciAyMWNtIGRlIGhhdXQgKi8KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDA7IAogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7IAogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBib2R5LnByaW50aW5nLWJhdGNoIC5jZWxsLWNvbnRlbnQgeyBmb250LXNpemU6IDAuNjVyZW07IGZvbnQtd2VpZ2h0OiBib2xkOyB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvKiBNT0RFOiBHZXN0aW9uIEZpY2hlIC0gT1BUSU1JU8OJIFBBWVNBR0UgKi8KICAgICAgICAgICAgYm9keS5wcmludGluZy1nZXN0aW9uIG1haW4geyBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7IH0KICAgICAgICAgICAgYm9keS5wcmludGluZy1nZXN0aW9uICNnZXN0aW9uLXByaW50LWFyZWEgeyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OyBwYWRkaW5nOiAwOyB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvKiBEaXNwb3NpdGlvbiBob3Jpem9udGFsZSBwb3VyIGxhIGdlc3Rpb24gKi8KICAgICAgICAgICAgYm9keS5wcmludGluZy1nZXN0aW9uIC5nZXN0aW9uLXN0YXRzLWNvbnRhaW5lciB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICBnYXA6IDIwcHg7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGJvZHkucHJpbnRpbmctZ2VzdGlvbiAuYmFsYW5jZS1ib3ggeyAKICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICMzMzM7IAogICAgICAgICAgICAgICAgY29sb3I6IGJsYWNrICFpbXBvcnRhbnQ7IAogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGUgIWltcG9ydGFudDsgCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA1cHggMjBweDsgCiAgICAgICAgICAgICAgICBmbGV4OiAwIDAgMzAwcHg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYm9keS5wcmludGluZy1nZXN0aW9uIC5iYWxhbmNlLWFtb3VudCB7IGZvbnQtc2l6ZTogMS40cmVtOyBjb2xvcjogYmxhY2s7IG1hcmdpbjogNXB4IDA7IH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGJvZHkucHJpbnRpbmctZ2VzdGlvbiAuaGlzdG9yeS10YWJsZSB7IGZvbnQtc2l6ZTogMC44cmVtOyB3aWR0aDogMTAwJTsgfQogICAgICAgICAgICBib2R5LnByaW50aW5nLWdlc3Rpb24gLmhpc3RvcnktdGFibGUgdGgsIGJvZHkucHJpbnRpbmctZ2VzdGlvbiAuaGlzdG9yeS10YWJsZSB0ZCB7IHBhZGRpbmc6IDRweDsgYm9yZGVyOiAxcHggc29saWQgI2NjYzsgfQoKICAgICAgICAgICAgLyogTU9ERTogUsOpcGFydGl0aW9uIC0gT1BUSU1JU8OJIFBBWVNBR0UgKi8KICAgICAgICAgICAgYm9keS5wcmludGluZy1yZXBhcnRpdGlvbiBtYWluIHsgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OyB9CiAgICAgICAgICAgIGJvZHkucHJpbnRpbmctcmVwYXJ0aXRpb24gI3JlcGFydGl0aW9uLXByaW50LWFyZWEgeyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OyB3aWR0aDogMTAwJTsgcGFkZGluZzogMDsgfQogICAgICAgICAgICBib2R5LnByaW50aW5nLXJlcGFydGl0aW9uIC5yZXBhcnRpdGlvbi10YWJsZSB7IAogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7IAogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjY1cmVtOyAvKiBQZXRpdCBwb3VyIHRvdXQgZmFpcmUgdGVuaXIgKi8KICAgICAgICAgICAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYm9keS5wcmludGluZy1yZXBhcnRpdGlvbiAucmVwYXJ0aXRpb24tdGFibGUgdGgsIAogICAgICAgICAgICBib2R5LnByaW50aW5nLXJlcGFydGl0aW9uIC5yZXBhcnRpdGlvbi10YWJsZSB0ZCB7IAogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgIzAwMDsgCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxcHggMnB4OyAKICAgICAgICAgICAgICAgIGhlaWdodDogMThweCAhaW1wb3J0YW50OyAvKiBIYXV0ZXVyIGNvbnRyYWludGUgKi8KICAgICAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYm9keS5wcmludGluZy1yZXBhcnRpdGlvbiAuYWdlbnQtdGFnIHsgCiAgICAgICAgICAgICAgICBib3JkZXI6IG5vbmU7IAogICAgICAgICAgICAgICAgcGFkZGluZzogMCAxcHg7IAogICAgICAgICAgICAgICAgbWFyZ2luOiAwIDFweDsgCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDAuNnJlbTsgCiAgICAgICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmU7CiAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogMTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLyogRm9yY2VyIGxlcyBjb3VsZXVycyBpbmxpbmUgw6AgcydpbXByaW1lciAqLwogICAgICAgICAgICAuY2VsbC1jb250ZW50IHsgCiAgICAgICAgICAgICAgICAtd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDogZXhhY3QgIWltcG9ydGFudDsgCiAgICAgICAgICAgICAgICBwcmludC1jb2xvci1hZGp1c3Q6IGV4YWN0ICFpbXBvcnRhbnQ7IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KCjxuYXY+CiAgICA8ZGl2IGNsYXNzPSJuYXYtbGVmdCI+CiAgICAgICAgPGRpdiBjbGFzcz0ibmF2LXRpdGxlIj4KICAgICAgICAgICAgQUVEIFBJTE9URQogICAgICAgICAgICA8c3BhbiBjbGFzcz0ibmF2LXN1YnRpdGxlIj5CeSBTeWx2w6hyZSBNaWNoZWxldCAtIHYyLjkgKEFkYXB0w6llIENTVik8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWFjdGlvbnMiPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4tbmF2LWFjdGlvbiIgb25jbGljaz0iZG93bmxvYWRKU09OKCkiIHRpdGxlPSJTYXV2ZWdhcmRlciI+PGkgY2xhc3M9ImZhcyBmYS1kb3dubG9hZCI+PC9pPiBTYXV2ZWdhcmRlcjwvYnV0dG9uPgogICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImJ0bi1uYXYtYWN0aW9uIiB0aXRsZT0iUmVzdGF1cmVyIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdXBsb2FkIj48L2k+IFJlc3RhdXJlcgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImZpbGUiIGlkPSJqc29uSW5wdXQiIGFjY2VwdD0iLmpzb24iIHN0eWxlPSJkaXNwbGF5Om5vbmUiIG9uY2hhbmdlPSJpbXBvcnRKU09OKHRoaXMpIj4KICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLW5hdi1hY3Rpb24gYnRuLWRhbmdlci1uYXYiIG9uY2xpY2s9InJlc2V0QWxsRGF0YSgpIiB0aXRsZT0iRWZmYWNlciB0b3V0IGV0IHJlY29tbWVuY2VyIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJhc2giPjwvaT4gVG91dCBFZmZhY2VyCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJuYXYtdGFicyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ0biBhY3RpdmUiIG9uY2xpY2s9InN3aXRjaFRhYignaW1wb3J0JykiPjEuIFZ1ZSBkJ2Vuc2VtYmxlPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ0biIgb25jbGljaz0ic3dpdGNoVGFiKCdjb25jZXB0aW9uJykiPjIuIENvbmNlcHRpb24gRURUPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ0biIgb25jbGljaz0ic3dpdGNoVGFiKCdnZXN0aW9uJykiPjMuIEdlc3Rpb24gUXVvdGlkaWVubmU8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJ0YWItYnRuIiBvbmNsaWNrPSJzd2l0Y2hUYWIoJ3JlcGFydGl0aW9uJykiPjQuIFF1aSBmYWl0IHF1b2kgPzwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9InRhYi1idG4iIG9uY2xpY2s9InN3aXRjaFRhYignbGl2ZScpIj41LiBFbiBEaXJlY3Q8L2J1dHRvbj4KICAgIDwvZGl2Pgo8L25hdj4KCjxtYWluPgogICAgPHNlY3Rpb24gaWQ9InZpZXctaW1wb3J0IiBjbGFzcz0idmlldy1zZWN0aW9uIGFjdGl2ZSI+CiAgICAgICAgPGRpdiBjbGFzcz0iaW1wb3J0LWhlYWRlciI+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICA8aDIgc3R5bGU9Im1hcmdpbjowOyBib3JkZXI6bm9uZTsgY29sb3I6dmFyKC0tcHJpbWFyeSkiPlRhYmxlYXUgZGUgQm9yZDwvaDI+CiAgICAgICAgICAgICAgICA8cCBzdHlsZT0ibWFyZ2luOjVweCAwIDAgMDsgY29sb3I6IzdmOGM4ZDsiPkfDqXJleiB2b3MgZWZmZWN0aWZzIEFFRCBzaW1wbGVtZW50LjwvcD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBzdHlsZT0iZGlzcGxheTppbmxpbmUtZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6MTBweDsiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZmlsZS1leGNlbCI+PC9pPiBJbXBvcnRlciBFeGNlbAogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJmaWxlIiBpZD0iZXhjZWxJbnB1dCIgYWNjZXB0PSIueGxzeCwgLnhscywgLmNzdiIgc3R5bGU9ImRpc3BsYXk6bm9uZSIgb25jaGFuZ2U9ImhhbmRsZUV4Y2VsKHRoaXMpIj4KICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiIG9uY2xpY2s9InByaW50RGFzaGJvYXJkKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOiMzNDQ5NWU7Ij4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXByaW50Ij48L2k+IEltcHJpbWVyIFLDqWNhcAogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIAogICAgICAgIDxkaXYgaWQ9ImltcG9ydC1pbmZvLWFyZWEiPjwvZGl2PgogICAgICAgIAogICAgICAgIDxkaXYgaWQ9ImRhc2hib2FyZC1hcmVhIiBjbGFzcz0iZGFzaGJvYXJkLWdyaWQiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjogMS8tMTsgdGV4dC1hbGlnbjpjZW50ZXI7IHBhZGRpbmc6NTBweDsgY29sb3I6I2FhYTsiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1mb2xkZXItb3BlbiIgc3R5bGU9ImZvbnQtc2l6ZTozcmVtOyBtYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyPgogICAgICAgICAgICAgICAgQXVjdW5lIGRvbm7DqWUuIFZldWlsbGV6IGltcG9ydGVyIHVuIGZpY2hpZXIgRXhjZWwgb3UgcmVzdGF1cmVyIHVuZSBzYXV2ZWdhcmRlLgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvc2VjdGlvbj4KCiAgICA8c2VjdGlvbiBpZD0idmlldy1jb25jZXB0aW9uIiBjbGFzcz0idmlldy1zZWN0aW9uIj4KICAgICAgICA8ZGl2IGNsYXNzPSJwbGFubmVyLXRvb2xiYXIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIj4KICAgICAgICAgICAgICAgIDxsYWJlbD48c3Ryb25nPkFnZW50IDo8L3N0cm9uZz48L2xhYmVsPgogICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0iYWVkLXNlbGVjdC1jb25jZXB0aW9uIiBvbmNoYW5nZT0iY2hhbmdlQUVEKCdjb25jZXB0aW9uJykiPgogICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+LS0gU8OpbGVjdGlvbm5lciAtLTwvb3B0aW9uPgogICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAKICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBvbmNsaWNrPSJvcGVuR3JpZENvbmZpZygpIiBzdHlsZT0iYmFja2dyb3VuZDojMmMzZTUwOyBmb250LXNpemU6MC44cmVtOyI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNvZyI+PC9pPiBDb25maWcgR3JpbGxlCiAgICAgICAgICAgIDwvYnV0dG9uPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbC1ncm91cCIgc3R5bGU9ImJhY2tncm91bmQ6I2Y4ZjlmYTsgcGFkZGluZzo1cHg7IGJvcmRlci1yYWRpdXM6NHB4OyBib3JkZXI6MXB4IHNvbGlkICNlZWU7Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC1zaXplOjAuOHJlbTsgZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6dmFyKC0tcHJpbWFyeSkiPvCfm4/vuI8gSW50ZXJuYXQgKEgpOjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iaW50ZXJuYXQtaG91cnMiIHN0eWxlPSJ3aWR0aDo1MHB4OyBwYWRkaW5nOjRweDsgdGV4dC1hbGlnbjpjZW50ZXIiIG1pbj0iMCIgc3RlcD0iMC41IiB2YWx1ZT0iMCIgb25jaGFuZ2U9InVwZGF0ZUludGVybmF0KCkiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2wtZ3JvdXAgcGFsZXR0ZSIgaWQ9InBhbGV0dGUtY29udGFpbmVyIj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIj4KICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJoZWFkZXItc3RhdHMiIHN0eWxlPSJmb250LXNpemU6MC45cmVtOyBmb250LXdlaWdodDpib2xkOyBjb2xvcjp2YXIoLS1wcmltYXJ5KTsgYmFja2dyb3VuZDojZWVlOyBwYWRkaW5nOjVweCAxMHB4OyBib3JkZXItcmFkaXVzOjRweDsiPjBoIC8gMGg8L3NwYW4+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiIG9uY2xpY2s9InByaW50U2luZ2xlKCkiIHN0eWxlPSJmb250LXNpemU6IDAuOHJlbTsiPjxpIGNsYXNzPSJmYXMgZmEtcHJpbnQiPjwvaT4gQWdlbnQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tcHJpbWFyeSIgb25jbGljaz0icHJpbnRBbGwoKSIgc3R5bGU9ImZvbnQtc2l6ZTogMC44cmVtOyBiYWNrZ3JvdW5kLWNvbG9yOiMyYzNlNTA7Ij48aSBjbGFzcz0iZmFzIGZhLWxheWVyLWdyb3VwIj48L2k+IFRvdXQ8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImVkdC1jb250YWluZXIiPgogICAgICAgICAgICA8dGFibGUgY2xhc3M9ImVkdC10YWJsZSIgaWQ9InRpbWV0YWJsZSI+PC90YWJsZT4KICAgICAgICA8L2Rpdj4KICAgIDwvc2VjdGlvbj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbC1vdmVybGF5IiBpZD0ibW9kYWwtc2VydmljZSI+CiAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtYm94Ij4KICAgICAgICAgICAgPGgzPjxpIGNsYXNzPSJmYXMgZmEtcGx1cy1jaXJjbGUiPjwvaT4gQWpvdXRlciB1biBTZXJ2aWNlPC9oMz4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InNlcnZpY2UtbmFtZSI+Tm9tIGR1IHNlcnZpY2UgOjwvbGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ic2VydmljZS1uYW1lIiBwbGFjZWhvbGRlcj0iRXg6IENESSwgSW5maXJtZXJpZSwgQWNjdWVpbC4uLiIgbWF4bGVuZ3RoPSIxNSI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8bGFiZWw+Q291bGV1ciAocHLDqXNldHMpIDo8L2xhYmVsPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2xvci1wcmVzZXRzIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbG9yLXByZXNldCIgc3R5bGU9ImJhY2tncm91bmQ6I2U3NGMzYyIgb25jbGljaz0ic2V0UHJlc2V0Q29sb3IoJyNlNzRjM2MnKSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2xvci1wcmVzZXQiIHN0eWxlPSJiYWNrZ3JvdW5kOiNlOTFlNjMiIG9uY2xpY2s9InNldFByZXNldENvbG9yKCcjZTkxZTYzJykiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sb3ItcHJlc2V0IiBzdHlsZT0iYmFja2dyb3VuZDojOWMyN2IwIiBvbmNsaWNrPSJzZXRQcmVzZXRDb2xvcignIzljMjdiMCcpIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbG9yLXByZXNldCIgc3R5bGU9ImJhY2tncm91bmQ6IzY3M2FiNyIgb25jbGljaz0ic2V0UHJlc2V0Q29sb3IoJyM2NzNhYjcnKSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2xvci1wcmVzZXQiIHN0eWxlPSJiYWNrZ3JvdW5kOiMzZjUxYjUiIG9uY2xpY2s9InNldFByZXNldENvbG9yKCcjM2Y1MWI1JykiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sb3ItcHJlc2V0IiBzdHlsZT0iYmFja2dyb3VuZDojMjE5NmYzIiBvbmNsaWNrPSJzZXRQcmVzZXRDb2xvcignIzIxOTZmMycpIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbG9yLXByZXNldCIgc3R5bGU9ImJhY2tncm91bmQ6IzAwYmNkNCIgb25jbGljaz0ic2V0UHJlc2V0Q29sb3IoJyMwMGJjZDQnKSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2xvci1wcmVzZXQiIHN0eWxlPSJiYWNrZ3JvdW5kOiMwMDk2ODgiIG9uY2xpY2s9InNldFByZXNldENvbG9yKCcjMDA5Njg4JykiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sb3ItcHJlc2V0IiBzdHlsZT0iYmFja2dyb3VuZDojNGNhZjUwIiBvbmNsaWNrPSJzZXRQcmVzZXRDb2xvcignIzRjYWY1MCcpIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbG9yLXByZXNldCIgc3R5bGU9ImJhY2tncm91bmQ6IzhiYzM0YSIgb25jbGljaz0ic2V0UHJlc2V0Q29sb3IoJyM4YmMzNGEnKSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2xvci1wcmVzZXQiIHN0eWxlPSJiYWNrZ3JvdW5kOiNmZjk4MDAiIG9uY2xpY2s9InNldFByZXNldENvbG9yKCcjZmY5ODAwJykiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sb3ItcHJlc2V0IiBzdHlsZT0iYmFja2dyb3VuZDojZmY1NzIyIiBvbmNsaWNrPSJzZXRQcmVzZXRDb2xvcignI2ZmNTcyMicpIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbG9yLXByZXNldCIgc3R5bGU9ImJhY2tncm91bmQ6Izc5NTU0OCIgb25jbGljaz0ic2V0UHJlc2V0Q29sb3IoJyM3OTU1NDgnKSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2xvci1wcmVzZXQiIHN0eWxlPSJiYWNrZ3JvdW5kOiM2MDdkOGIiIG9uY2xpY2s9InNldFByZXNldENvbG9yKCcjNjA3ZDhiJykiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sb3ItcHJlc2V0IiBzdHlsZT0iYmFja2dyb3VuZDojMDAwMDAwIiBvbmNsaWNrPSJzZXRQcmVzZXRDb2xvcignIzAwMDAwMCcpIj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIAogICAgICAgICAgICA8bGFiZWwgZm9yPSJzZXJ2aWNlLWNvbG9yIj5PdSBjb3VsZXVyIHBlcnNvbm5hbGlzw6llIDo8L2xhYmVsPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0iY29sb3IiIGlkPSJzZXJ2aWNlLWNvbG9yIiB2YWx1ZT0iIzM0OThkYiIgb25jaGFuZ2U9InVwZGF0ZVByZXZpZXcoKSI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8bGFiZWw+QXBlcsOndSA6PC9sYWJlbD4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJldmlldy1idG4iIGlkPSJzZXJ2aWNlLXByZXZpZXciPk5PVVZFQVUgU0VSVklDRTwvZGl2PgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtYWN0aW9ucyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4tY2FuY2VsIiBvbmNsaWNrPSJjbG9zZVNlcnZpY2VNb2RhbCgpIj5Bbm51bGVyPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4tY29uZmlybSIgb25jbGljaz0iY29uZmlybUFkZFNlcnZpY2UoKSI+PGkgY2xhc3M9ImZhcyBmYS1jaGVjayI+PC9pPiBBam91dGVyPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwtb3ZlcmxheSIgaWQ9Im1vZGFsLWdyaWQtY29uZmlnIj4KICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1ib3giPgogICAgICAgICAgICA8aDM+PGkgY2xhc3M9ImZhcyBmYS1jb2ciPjwvaT4gQ29uZmlndXJhdGlvbiBHcmlsbGUgSG9yYWlyZTwvaDM+CiAgICAgICAgICAgIDxwIHN0eWxlPSJmb250LXNpemU6MC45cmVtOyBjb2xvcjojNjY2OyI+QWpvdXRleiwgc3VwcHJpbWV6IGV0IGTDqWZpbmlzc2V6IHZvcyBjcsOpbmVhdXggcHLDqWNpcyAoZXg6IDhoMjUtOWgyMCkuPC9wPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2xvdC1pbnB1dHMiPgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDoxIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW0iPkTDqWJ1dDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRpbWUiIGlkPSJuZXctc2xvdC1zdGFydCIgc3R5bGU9IndpZHRoOjEwMCUiPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmbGV4OjEiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC1zaXplOjAuOHJlbSI+RmluPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGltZSIgaWQ9Im5ldy1zbG90LWVuZCIgc3R5bGU9IndpZHRoOjEwMCUiPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiIG9uY2xpY2s9ImFkZFNsb3QoKSI+PGkgY2xhc3M9ImZhcyBmYS1wbHVzIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2xvdC1saXN0IiBpZD0ic2xvdC1jb25maWctbGlzdCI+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWFjdGlvbnMiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNhbmNlbCIgb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWdyaWQtY29uZmlnJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykiPkZlcm1lcjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWNvbmZpcm0iIG9uY2xpY2s9InNhdmVHcmlkQ29uZmlnKCkiPjxpIGNsYXNzPSJmYXMgZmEtY2hlY2siPjwvaT4gRW5yZWdpc3RyZXIgJiBBcHBsaXF1ZXI8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8c2VjdGlvbiBpZD0idmlldy1nZXN0aW9uIiBjbGFzcz0idmlldy1zZWN0aW9uIj4KICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOiAyMHB4OyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczpjZW50ZXI7Ij4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgIDxsYWJlbD48c3Ryb25nPkFnZW50IDo8L3N0cm9uZz48L2xhYmVsPgogICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0iYWVkLXNlbGVjdC1nZXN0aW9uIiBvbmNoYW5nZT0iY2hhbmdlQUVEKCdnZXN0aW9uJykiPjwvc2VsZWN0PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBvbmNsaWNrPSJwcmludEdlc3Rpb24oKSI+PGkgY2xhc3M9ImZhcyBmYS1wcmludCI+PC9pPiBJbXByaW1lciBGaWNoZTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Imdlc3Rpb24tZ3JpZCI+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0cy1yb3ciPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJhbGFuY2UtYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5Ub3RhbCBBbm51ZWwgKE5ldCk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmFsYW5jZS1hbW91bnQiIGlkPSJhbm51YWwtdGFyZ2V0LWRpc3BsYXkiPjBoPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW07IG9wYWNpdHk6MC44OyI+T2JqZWN0aWY8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiYWxhbmNlLWJveCBzZWNvbmRhcnkiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlNvbGRlIEFqdXN0ZW1lbnRzPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJhbGFuY2UtYW1vdW50IiBpZD0iYmFsYW5jZS1kaXNwbGF5Ij4waDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC44cmVtOyBvcGFjaXR5OjAuODsiPkN1bXVsIChBYnMvU3VwKTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgICAgICAgICAgICAgICAgPGgzIHN0eWxlPSJtYXJnaW4tdG9wOjAiPlNhaXNpZSBRdW90aWRpZW5uZTwvaDM+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0iYWRqLXR5cGUiIHN0eWxlPSJ3aWR0aDoxMDAlOyBtYXJnaW4tYm90dG9tOjEwcHgiPjxvcHRpb24gdmFsdWU9InBsdXMiPkhldXJlcyBlbiBQTFVTICgrKTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9Im1pbnVzIj5IZXVyZXMgZW4gTU9JTlMgKC0pPC9vcHRpb24+PC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImFkai1hbW91bnQiIHBsYWNlaG9sZGVyPSJEdXLDqWUiIHN0ZXA9IjAuNSIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi1ib3R0b206MTBweDsiPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iYWRqLXJlYXNvbiIgcGxhY2Vob2xkZXI9Ik1vdGlmLi4uIiBzdHlsZT0id2lkdGg6MTAwJTsgbWFyZ2luLWJvdHRvbToxMHB4OyI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiBzdHlsZT0id2lkdGg6MTAwJSIgb25jbGljaz0iYWRkQWRqdXN0bWVudCgpIj5FbnJlZ2lzdHJlcjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgICAgICAgICAgIDxoMyBzdHlsZT0ibWFyZ2luLXRvcDowIj5IaXN0b3JpcXVlPC9oMz4KICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzcz0iaGlzdG9yeS10YWJsZSI+CiAgICAgICAgICAgICAgICAgICAgPHRoZWFkPjx0cj48dGg+RGF0ZTwvdGg+PHRoPlR5cGU8L3RoPjx0aD5Nb3RpZjwvdGg+PHRoPkg8L3RoPjx0aD48L3RoPjwvdHI+PC90aGVhZD4KICAgICAgICAgICAgICAgICAgICA8dGJvZHkgaWQ9Imhpc3RvcnktYm9keSI+PC90Ym9keT4KICAgICAgICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9zZWN0aW9uPgoKICAgIDxzZWN0aW9uIGlkPSJ2aWV3LXJlcGFydGl0aW9uIiBjbGFzcz0idmlldy1zZWN0aW9uIj4KICAgICAgICA8ZGl2IGNsYXNzPSJyZXBhcnRpdGlvbi10b29sYmFyIj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDoxNXB4OyI+CiAgICAgICAgICAgICAgICA8aDIgc3R5bGU9Im1hcmdpbjowOyBjb2xvcjp2YXIoLS1wcmltYXJ5KTsgZm9udC1zaXplOjEuMnJlbTsiPlF1aSBmYWl0IHF1b2kgPzwvaDI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PHN0cm9uZz5Kb3VyIDo8L3N0cm9uZz48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9InJlcGFydGl0aW9uLWRheS1zZWxlY3QiIG9uY2hhbmdlPSJyZW5kZXJSZXBhcnRpdGlvbigpIj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iTHVuZGkiPkx1bmRpPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Ik1hcmRpIj5NYXJkaTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJNZXJjcmVkaSI+TWVyY3JlZGk8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iSmV1ZGkiPkpldWRpPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlZlbmRyZWRpIj5WZW5kcmVkaTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXByaW1hcnkiIG9uY2xpY2s9InByaW50UmVwYXJ0aXRpb24oKSI+PGkgY2xhc3M9ImZhcyBmYS1wcmludCI+PC9pPiBJbXByaW1lciBsYSBqb3VybsOpZTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIAogICAgICAgIDxkaXYgY2xhc3M9ImVkdC1jb250YWluZXIiPgogICAgICAgICAgICA8ZGl2IGlkPSJyZXBhcnRpdGlvbi1jb250ZW50Ij48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvc2VjdGlvbj4KCiAgICA8c2VjdGlvbiBpZD0idmlldy1saXZlIiBjbGFzcz0idmlldy1zZWN0aW9uIj4KICAgICAgICA8ZGl2IGNsYXNzPSJsaXZlLWhlYWRlciI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNsb2NrLWRheSIgaWQ9ImxpdmUtZGF5Ij5DSEFSR0VNRU5ULi4uPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNsb2NrLXRpbWUiIGlkPSJsaXZlLWNsb2NrIj4tLTotLTotLTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIAogICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUiPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1jbG9jayI+PC9pPiBBRUQgRU4gUE9TVEUgQUNUVUVMTEVNRU5UPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1ncmlkIiBpZD0ibGl2ZS1hY3RpdmUtY29udGFpbmVyIj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUiPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1zbGFzaCI+PC9pPiBBQlNFTlRTIC8gTk9OIFBMQU5JRknDiVM8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJsaXZlLWdyaWQiIGlkPSJsaXZlLWluYWN0aXZlLWNvbnRhaW5lciIgc3R5bGU9Im9wYWNpdHk6IDAuNjsiPgogICAgICAgICAgICA8L2Rpdj4KICAgIDwvc2VjdGlvbj4KCjwvbWFpbj4KCjxkaXYgaWQ9ImJhdGNoLXByaW50LWFyZWEiPjwvZGl2Pgo8ZGl2IGlkPSJkYXNoYm9hcmQtcHJpbnQtYXJlYSI+PC9kaXY+CjxkaXYgaWQ9Imdlc3Rpb24tcHJpbnQtYXJlYSI+PC9kaXY+CjxkaXYgaWQ9InJlcGFydGl0aW9uLXByaW50LWFyZWEiPjwvZGl2PgoKPHNjcmlwdD4KICAgIC8vIC0tLSBJTklUSUFMSVNBVElPTiBET05Ow4lFUyBWSURFIC0tLQogICAgLy8gQWpvdXQgZGUgInNsb3RzIiBkYW5zIERBVEEuY29uZmlnIHBvdXIgc3RvY2tlciBsZXMgY3LDqW5lYXV4IHBlcnNvbm5hbGlzw6lzCiAgICBsZXQgREFUQSA9IHsgYWdlbnRzOiBbXSwgc2NoZWR1bGVzOiB7fSwgYWRqdXN0bWVudHM6IHt9LCBxdW90aXRlczogW10sIHNlcnZpY2VzOiBbXSwgY29uZmlnOiB7IHNsb3RzOiBbXSB9IH07CiAgICBjb25zdCBEQVlTID0gWydMdW5kaScsICdNYXJkaScsICdNZXJjcmVkaScsICdKZXVkaScsICdWZW5kcmVkaSddOwogICAgCiAgICAvLyBDcsOpbmVhdXggcGFyIGTDqWZhdXQgc2kgYXVjdW5lIGNvbmZpZyAocG91ciDDqXZpdGVyIGxlIHZpZGUgYXUgcHJlbWllciBsYW5jZW1lbnQpCiAgICBjb25zdCBERUZBVUxUX1NMT1RTID0gWwogICAgICAgIHsgc3RhcnQ6ICcwODowMCcsIGVuZDogJzA4OjU1JyB9LAogICAgICAgIHsgc3RhcnQ6ICcwODo1NScsIGVuZDogJzA5OjUwJyB9LAogICAgICAgIHsgc3RhcnQ6ICcwOTo1MCcsIGVuZDogJzEwOjA1JyB9LAogICAgICAgIHsgc3RhcnQ6ICcxMDowNScsIGVuZDogJzExOjAwJyB9LAogICAgICAgIHsgc3RhcnQ6ICcxMTowMCcsIGVuZDogJzExOjU1JyB9LAogICAgICAgIHsgc3RhcnQ6ICcxMjowMCcsIGVuZDogJzEzOjAwJyB9LAogICAgICAgIHsgc3RhcnQ6ICcxMzowMCcsIGVuZDogJzEzOjU1JyB9LAogICAgICAgIHsgc3RhcnQ6ICcxMzo1NScsIGVuZDogJzE0OjUwJyB9LAogICAgICAgIHsgc3RhcnQ6ICcxNDo1MCcsIGVuZDogJzE1OjA1JyB9LAogICAgICAgIHsgc3RhcnQ6ICcxNTowNScsIGVuZDogJzE2OjAwJyB9LAogICAgICAgIHsgc3RhcnQ6ICcxNjowMCcsIGVuZDogJzE2OjU1JyB9LAogICAgICAgIHsgc3RhcnQ6ICcxNjo1NScsIGVuZDogJzE3OjUwJyB9CiAgICBdOwoKICAgIGxldCBDVVJSRU5UX1RPT0wgPSB7IG5hbWU6ICdHcmlsbGUnLCBjb2xvcjogJyNmZjAwZmYnLCBpc0VyYXNlcjogZmFsc2UgfTsKICAgIAogICAgLy8gU2VydmljZXMgcGFyIGTDqWZhdXQKICAgIGNvbnN0IERFRkFVTFRfU0VSVklDRVMgPSBbCiAgICAgICAgeyBpZDogJ2dyaWxsZScsIG5hbWU6ICdHcmlsbGUnLCBjb2xvcjogJyNmZjAwZmYnLCBpc0RlZmF1bHQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAnYWRtaW4nLCBuYW1lOiAnQWRtaW4nLCBjb2xvcjogJyMwMGI4OTQnLCBpc0RlZmF1bHQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAnZXR1ZGUnLCBuYW1lOiAnRXR1ZGUnLCBjb2xvcjogJyM4ZTQ0YWQnLCBpc0RlZmF1bHQ6IHRydWUgfSwKICAgICAgICB7IGlkOiAnc2VsZicsIG5hbWU6ICdTZWxmJywgY29sb3I6ICcjZTY3ZTIyJywgaXNEZWZhdWx0OiB0cnVlIH0sCiAgICAgICAgeyBpZDogJ2NvdWxvaXJzJywgbmFtZTogJ0NvdWxvaXJzJywgY29sb3I6ICcjZjFjNDBmJywgaXNEZWZhdWx0OiB0cnVlIH0sCiAgICAgICAgeyBpZDogJ2NvdXInLCBuYW1lOiAnQ291cicsIGNvbG9yOiAnI2Q2MzAzMScsIGlzRGVmYXVsdDogdHJ1ZSB9LAogICAgICAgIHsgaWQ6ICdzdWl2aScsIG5hbWU6ICdTdWl2aScsIGNvbG9yOiAnIzI3YWU2MCcsIGlzRGVmYXVsdDogdHJ1ZSB9CiAgICBdOwogICAgCiAgICBjb25zdCBTVE9SQUdFX0tFWSA9ICdBRURfUElMT1RFX1YyOF9TTE9UUyc7CgogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgeyAKICAgICAgICBsb2FkTG9jYWxTdG9yYWdlKCk7IAogICAgICAgIHJlbmRlclBhbGV0dGUoKTsgCiAgICAgICAgLy8gTGFuY2VyIGwnaG9ybG9nZSBwb3VyIGxlIG1lbnUgNQogICAgICAgIHNldEludGVydmFsKHVwZGF0ZUxpdmVWaWV3LCAxMDAwKTsKICAgICAgICB1cGRhdGVMaXZlVmlldygpOwogICAgfTsKCiAgICBmdW5jdGlvbiBzd2l0Y2hUYWIodGFiSWQpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudmlldy1zZWN0aW9uJykuZm9yRWFjaChlbCA9PiBlbC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYi1idG4nKS5mb3JFYWNoKGVsID0+IGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlldy0nICsgdGFiSWQpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIAogICAgICAgIGNvbnN0IHRhYnMgPSBbJ2ltcG9ydCcsICdjb25jZXB0aW9uJywgJ2dlc3Rpb24nLCAncmVwYXJ0aXRpb24nLCAnbGl2ZSddOwogICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWItYnRuJylbdGFicy5pbmRleE9mKHRhYklkKV07CiAgICAgICAgaWYoYnRuKSBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgCiAgICAgICAgaWYodGFiSWQgPT09ICdjb25jZXB0aW9uJykgdXBkYXRlU3RhdHNIZWFkZXIoKTsKICAgICAgICBpZih0YWJJZCA9PT0gJ2dlc3Rpb24nKSB1cGRhdGVHZXN0aW9uVUkoKTsKICAgICAgICBpZih0YWJJZCA9PT0gJ3JlcGFydGl0aW9uJykgcmVuZGVyUmVwYXJ0aXRpb24oKTsKICAgICAgICBpZih0YWJJZCA9PT0gJ2xpdmUnKSB1cGRhdGVMaXZlVmlldygpOwogICAgfQogICAgCiAgICAvLyAtLS0gR0VTVElPTiBERSBMQSBDT05GSUdVUkFUSU9OIEhPUkFJUkUgQVZBTkNFRSAoTWVudSAyKSAtLS0KICAgIC8vIFZhcmlhYmxlIHRlbXBvcmFpcmUgcG91ciBsJ8OpZGl0aW9uIGRhbnMgbGUgbW9kYWwKICAgIGxldCB0ZW1wU2xvdHMgPSBbXTsKCiAgICBmdW5jdGlvbiBvcGVuR3JpZENvbmZpZygpIHsKICAgICAgICAvLyBDaGFyZ2VyIGxlcyBzbG90cyBhY3R1ZWxzIG91IGxlcyBkw6lmYXV0cwogICAgICAgIHRlbXBTbG90cyA9IChEQVRBLmNvbmZpZyAmJiBEQVRBLmNvbmZpZy5zbG90cyAmJiBEQVRBLmNvbmZpZy5zbG90cy5sZW5ndGggPiAwKSAKICAgICAgICAgICAgICAgICAgICA/IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoREFUQS5jb25maWcuc2xvdHMpKSAKICAgICAgICAgICAgICAgICAgICA6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoREVGQVVMVF9TTE9UUykpOwogICAgICAgIAogICAgICAgIHJlbmRlclNsb3RDb25maWdMaXN0KCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWdyaWQtY29uZmlnJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVuZGVyU2xvdENvbmZpZ0xpc3QoKSB7CiAgICAgICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbG90LWNvbmZpZy1saXN0Jyk7CiAgICAgICAgbGlzdC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAKICAgICAgICAvLyBUcmllciBwYXIgaGV1cmUgZGUgZMOpYnV0CiAgICAgICAgdGVtcFNsb3RzLnNvcnQoKGEsIGIpID0+IGEuc3RhcnQubG9jYWxlQ29tcGFyZShiLnN0YXJ0KSk7CgogICAgICAgIHRlbXBTbG90cy5mb3JFYWNoKChzbG90LCBpbmRleCkgPT4gewogICAgICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gJ3Nsb3QtaXRlbSc7CiAgICAgICAgICAgIGl0ZW0uaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPHNwYW4+PHN0cm9uZz4ke3Nsb3Quc3RhcnR9PC9zdHJvbmc+IMOgIDxzdHJvbmc+JHtzbG90LmVuZH08L3N0cm9uZz48L3NwYW4+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRhbmdlciIgc3R5bGU9InBhZGRpbmc6NHB4IDhweDsgZm9udC1zaXplOjAuN3JlbTsiIG9uY2xpY2s9InJlbW92ZVNsb3QoJHtpbmRleH0pIj48aSBjbGFzcz0iZmFzIGZhLXRyYXNoIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIGA7CiAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQoaXRlbSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkU2xvdCgpIHsKICAgICAgICBjb25zdCBzdGFydCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctc2xvdC1zdGFydCcpLnZhbHVlOwogICAgICAgIGNvbnN0IGVuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctc2xvdC1lbmQnKS52YWx1ZTsKCiAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSB7CiAgICAgICAgICAgIGFsZXJ0KCJWZXVpbGxleiByZW1wbGlyIGwnaGV1cmUgZGUgZMOpYnV0IGV0IGRlIGZpbi4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnQgPj0gZW5kKSB7CiAgICAgICAgICAgIGFsZXJ0KCJMJ2hldXJlIGRlIGTDqWJ1dCBkb2l0IMOqdHJlIGF2YW50IGwnaGV1cmUgZGUgZmluLiIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0ZW1wU2xvdHMucHVzaCh7IHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQgfSk7CiAgICAgICAgcmVuZGVyU2xvdENvbmZpZ0xpc3QoKTsKICAgICAgICAKICAgICAgICAvLyBSZXNldCBpbnB1dHMKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3LXNsb3Qtc3RhcnQnKS52YWx1ZSA9ICcnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctc2xvdC1lbmQnKS52YWx1ZSA9ICcnOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZVNsb3QoaW5kZXgpIHsKICAgICAgICB0ZW1wU2xvdHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICByZW5kZXJTbG90Q29uZmlnTGlzdCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhdmVHcmlkQ29uZmlnKCkgewogICAgICAgIGlmICh0ZW1wU2xvdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGlmKCFjb25maXJtKCJMYSBncmlsbGUgZXN0IHZpZGUuIFZvdWxlei12b3VzIHZyYWltZW50IGNvbnRpbnVlciA/IikpIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmKCFEQVRBLmNvbmZpZykgREFUQS5jb25maWcgPSB7fTsKICAgICAgICAKICAgICAgICAvLyBPbiB0cmllIHVuZSBkZXJuacOocmUgZm9pcyBwb3VyIMOqdHJlIHPDu3IKICAgICAgICB0ZW1wU2xvdHMuc29ydCgoYSwgYikgPT4gYS5zdGFydC5sb2NhbGVDb21wYXJlKGIuc3RhcnQpKTsKICAgICAgICBEQVRBLmNvbmZpZy5zbG90cyA9IHRlbXBTbG90czsKICAgICAgICAKICAgICAgICBzYXZlTG9jYWxTdG9yYWdlKCk7CiAgICAgICAgCiAgICAgICAgLy8gUmFmcmHDrmNoaXIgbGVzIHZ1ZXMKICAgICAgICByZW5kZXJUaW1ldGFibGUoKTsKICAgICAgICByZW5kZXJSZXBhcnRpdGlvbigpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1ncmlkLWNvbmZpZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgfQoKICAgIC8vIC0tLSBMT0dJUVVFIE1FTlUgNSA6IEVOIERJUkVDVCAoQWRhcHTDqSBhdXggY3LDqW5lYXV4IGxpYnJlcykgLS0tCiAgICBmdW5jdGlvbiB1cGRhdGVMaXZlVmlldygpIHsKICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgIGNvbnN0IGRheU5hbWVzID0gWydEaW1hbmNoZScsICdMdW5kaScsICdNYXJkaScsICdNZXJjcmVkaScsICdKZXVkaScsICdWZW5kcmVkaScsICdTYW1lZGknXTsKICAgICAgICBjb25zdCBjdXJyZW50RGF5SW5kZXggPSBub3cuZ2V0RGF5KCk7CiAgICAgICAgY29uc3QgY3VycmVudERheU5hbWUgPSBkYXlOYW1lc1tjdXJyZW50RGF5SW5kZXhdOwogICAgICAgIAogICAgICAgIC8vIEZvcm1hdGFnZSAiSEg6TU0iIHBvdXIgY29tcGFyYWlzb24KICAgICAgICBjb25zdCBob3VycyA9IFN0cmluZyhub3cuZ2V0SG91cnMoKSkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICBjb25zdCBtaW51dGVzID0gU3RyaW5nKG5vdy5nZXRNaW51dGVzKCkpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3QgY3VycmVudFRpbWVTdHIgPSBgJHtob3Vyc306JHttaW51dGVzfWA7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLWRheScpLnRleHRDb250ZW50ID0gY3VycmVudERheU5hbWUgKyAiICIgKyBub3cudG9Mb2NhbGVEYXRlU3RyaW5nKCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtY2xvY2snKS50ZXh0Q29udGVudCA9IG5vdy50b0xvY2FsZVRpbWVTdHJpbmcoKTsKCiAgICAgICAgY29uc3QgY29udGFpbmVyQWN0aXZlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtYWN0aXZlLWNvbnRhaW5lcicpOwogICAgICAgIGNvbnN0IGNvbnRhaW5lckluYWN0aXZlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtaW5hY3RpdmUtY29udGFpbmVyJyk7CiAgICAgICAgCiAgICAgICAgaWYoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWV3LWxpdmUnKS5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSByZXR1cm47CgogICAgICAgIGNvbnRhaW5lckFjdGl2ZS5pbm5lckhUTUwgPSAnJzsKICAgICAgICBjb250YWluZXJJbmFjdGl2ZS5pbm5lckhUTUwgPSAnJzsKCiAgICAgICAgLy8gVHJvdXZlciBsJ2luZGV4IGR1IHNsb3QgYWN0aWYKICAgICAgICBjb25zdCBhY3RpdmVTbG90SW5kZXggPSAoREFUQS5jb25maWcuc2xvdHMgfHwgREVGQVVMVF9TTE9UUykuZmluZEluZGV4KHNsb3QgPT4gewogICAgICAgICAgICByZXR1cm4gY3VycmVudFRpbWVTdHIgPj0gc2xvdC5zdGFydCAmJiBjdXJyZW50VGltZVN0ciA8IHNsb3QuZW5kOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGxldCBhY3RpdmVTbG90TGFiZWwgPSAiSE9SUyBDUsOJTkVBVSI7CiAgICAgICAgbGV0IGFjdGl2ZVNsb3RFbmQgPSAiIjsKCiAgICAgICAgaWYoYWN0aXZlU2xvdEluZGV4ICE9PSAtMSkgewogICAgICAgICAgICBjb25zdCBzbG90ID0gKERBVEEuY29uZmlnLnNsb3RzIHx8IERFRkFVTFRfU0xPVFMpW2FjdGl2ZVNsb3RJbmRleF07CiAgICAgICAgICAgIGFjdGl2ZVNsb3RMYWJlbCA9IGAke3Nsb3Quc3RhcnR9IC0gJHtzbG90LmVuZH1gOwogICAgICAgICAgICBhY3RpdmVTbG90RW5kID0gc2xvdC5lbmQ7CiAgICAgICAgfQoKICAgICAgICBsZXQgaGFzQWN0aXZlID0gZmFsc2U7CgogICAgICAgIERBVEEuYWdlbnRzLmZvckVhY2goYWdlbnQgPT4gewogICAgICAgICAgICAvLyBMYSBjbMOpIGVzdCBiYXPDqWUgc3VyIGwnaW5kZXggZHUgc2xvdCA6ICJMdW5kaS0wIiwgIkx1bmRpLTEiLCBldGMuCiAgICAgICAgICAgIGNvbnN0IGtleSA9IGAke2N1cnJlbnREYXlOYW1lfS0ke2FjdGl2ZVNsb3RJbmRleH1gOwogICAgICAgICAgICBjb25zdCBzY2hlZHVsZSA9IERBVEEuc2NoZWR1bGVzW2FnZW50Lm5hbWVdOwogICAgICAgICAgICAKICAgICAgICAgICAgbGV0IGlzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBzZXJ2aWNlSW5mbyA9IG51bGw7CgogICAgICAgICAgICBpZiAoYWN0aXZlU2xvdEluZGV4ICE9PSAtMSAmJiBzY2hlZHVsZSAmJiBzY2hlZHVsZVtrZXldKSB7CiAgICAgICAgICAgICAgICBpc0FjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBzZXJ2aWNlSW5mbyA9IHNjaGVkdWxlW2tleV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENyw6lhdGlvbiBkZSBsYSBjYXJ0ZQogICAgICAgICAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGNhcmQuY2xhc3NOYW1lID0gYGxpdmUtY2FyZCAke2lzQWN0aXZlID8gJ2FjdGl2ZScgOiAnJ31gOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoaXNBY3RpdmUgJiYgc2VydmljZUluZm8uY29sb3IpIHsKICAgICAgICAgICAgICAgIGNhcmQuc3R5bGUuYm9yZGVyTGVmdENvbG9yID0gc2VydmljZUluZm8uY29sb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGlzTGlnaHQgPSBpc0FjdGl2ZSA/IGlzTGlnaHRDb2xvcihzZXJ2aWNlSW5mby5jb2xvcikgOiB0cnVlOwogICAgICAgICAgICBjb25zdCB0ZXh0Q29sb3IgPSBpc0xpZ2h0ID8gJyMzMzMnIDogJ3doaXRlJzsKCiAgICAgICAgICAgIGNhcmQuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1jYXJkLWJvZHkiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxpdmUtYWdlbnQtbmFtZSI+JHthZ2VudC5uYW1lfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxpdmUtc3RhdHVzIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogJHtpc0FjdGl2ZSA/IHNlcnZpY2VJbmZvLmNvbG9yIDogJyNlZWUnfTsgY29sb3I6ICR7dGV4dENvbG9yfSI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7aXNBY3RpdmUgPyBzZXJ2aWNlSW5mby50b29sIDogKGFjdGl2ZVNsb3RJbmRleCAhPT0gLTEgPyAnTElCUkUgLyBOT04gUExBTklGScOJJyA6ICdIT1JTIEhPUkFJUkUnKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAke2lzQWN0aXZlID8gYDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6NXB4OyBmb250LXNpemU6MC44cmVtOyBjb2xvcjojNzc3OyI+QWN0dWVsbGVtZW50IDogJHthY3RpdmVTbG90TGFiZWx9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBpZihpc0FjdGl2ZSkgewogICAgICAgICAgICAgICAgY29udGFpbmVyQWN0aXZlLmFwcGVuZENoaWxkKGNhcmQpOwogICAgICAgICAgICAgICAgaGFzQWN0aXZlID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lckluYWN0aXZlLmFwcGVuZENoaWxkKGNhcmQpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmKCFoYXNBY3RpdmUpIHsKICAgICAgICAgICAgY29udGFpbmVyQWN0aXZlLmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjoxLy0xOyB0ZXh0LWFsaWduOmNlbnRlcjsgcGFkZGluZzoyMHB4OyBjb2xvcjojYWFhOyI+QXVjdW4gQUVEIGVuIHBvc3RlIHN1ciBsZSBjcsOpbmVhdSBhY3R1ZWwgKCR7YWN0aXZlU2xvdExhYmVsfSkuPC9kaXY+YDsKICAgICAgICB9CiAgICB9CgoKICAgIC8vIC0tLSBMT0dJUVVFIElOVEVSTkFUIC0tLQogICAgZnVuY3Rpb24gdXBkYXRlSW50ZXJuYXQoKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZWQtc2VsZWN0LWNvbmNlcHRpb24nKS52YWx1ZTsKICAgICAgICBpZighbmFtZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHZhbCA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludGVybmF0LWhvdXJzJykudmFsdWUpIHx8IDA7CiAgICAgICAgY29uc3QgYWdlbnQgPSBEQVRBLmFnZW50cy5maW5kKGEgPT4gYS5uYW1lID09PSBuYW1lKTsKICAgICAgICBpZihhZ2VudCkgewogICAgICAgICAgICBhZ2VudC5pbnRlcm5hdEhvdXJzID0gdmFsOwogICAgICAgICAgICBzYXZlTG9jYWxTdG9yYWdlKCk7CiAgICAgICAgICAgIHVwZGF0ZVN0YXRzSGVhZGVyKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLSBJTVBSRVNTSU9OUyAtLS0KICAgIGZ1bmN0aW9uIHByaW50RGFzaGJvYXJkKCkgewogICAgICAgIGlmKERBVEEuYWdlbnRzLmxlbmd0aCA9PT0gMCkgeyBhbGVydCgiQXVjdW5lIGRvbm7DqWUuIik7IHJldHVybjsgfQogICAgICAgIGNvbnN0IGFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaGJvYXJkLXByaW50LWFyZWEnKTsKICAgICAgICBhcmVhLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJpbnQtaGVhZGVyLWJhdGNoIj5Sw6ljYXBpdHVsYXRpZiBkZXMgQWdlbnRzIC0gQUVEIFBJTE9URTwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXNoYm9hcmQtZ3JpZCI+JHtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaGJvYXJkLWFyZWEnKS5pbm5lckhUTUx9PC9kaXY+CiAgICAgICAgYDsKICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3ByaW50aW5nLWRhc2hib2FyZCcsICdwcmludGluZy1tb2RlJyk7CiAgICAgICAgd2luZG93LnByaW50KCk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgncHJpbnRpbmctZGFzaGJvYXJkJywgJ3ByaW50aW5nLW1vZGUnKTsKICAgICAgICAgICAgYXJlYS5pbm5lckhUTUwgPSAnJzsKICAgICAgICB9LCAxMDAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcmludEdlc3Rpb24oKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZWQtc2VsZWN0LWdlc3Rpb24nKS52YWx1ZTsKICAgICAgICBpZighbmFtZSkgeyBhbGVydCgiU8OpbGVjdGlvbm5leiB1biBhZ2VudCIpOyByZXR1cm47IH0KICAgICAgICBjb25zdCBhbm51YWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5udWFsLXRhcmdldC1kaXNwbGF5JykuaW5uZXJUZXh0OwogICAgICAgIGNvbnN0IHNvbGRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhbGFuY2UtZGlzcGxheScpLmlubmVyVGV4dDsKICAgICAgICBjb25zdCBoaXN0b3J5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpc3RvcnktYm9keScpLmlubmVySFRNTDsKICAgICAgICBjb25zdCBhcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlc3Rpb24tcHJpbnQtYXJlYScpOwogICAgICAgIGFyZWEuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcmludC1oZWFkZXItYmF0Y2giPkZpY2hlIGRlIEdlc3Rpb24gOiAke25hbWV9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Imdlc3Rpb24tc3RhdHMtY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJhbGFuY2UtYm94Ij48aDM+T2JqZWN0aWYgQW5udWVsPC9oMz48ZGl2IGNsYXNzPSJiYWxhbmNlLWFtb3VudCI+JHthbm51YWx9PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiYWxhbmNlLWJveCBzZWNvbmRhcnkiPjxoMz5Tb2xkZSBBanVzdGVtZW50czwvaDM+PGRpdiBjbGFzcz0iYmFsYW5jZS1hbW91bnQiPiR7c29sZGV9PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8aDM+SGlzdG9yaXF1ZSBkZXMgbW91dmVtZW50czwvaDM+CiAgICAgICAgICAgIDx0YWJsZSBjbGFzcz0iaGlzdG9yeS10YWJsZSI+PHRoZWFkPjx0cj48dGg+RGF0ZTwvdGg+PHRoPlR5cGU8L3RoPjx0aD5Nb3RpZjwvdGg+PHRoPkg8L3RoPjx0aD48L3RoPjwvdHI+PC90aGVhZD48dGJvZHk+JHtoaXN0b3J5fTwvdGJvZHk+PC90YWJsZT4KICAgICAgICBgOwogICAgICAgIGNvbnN0IHRyYXNoZXMgPSBhcmVhLnF1ZXJ5U2VsZWN0b3JBbGwoJy5mYS10cmFzaCcpOwogICAgICAgIHRyYXNoZXMuZm9yRWFjaCh0ID0+IHQuc3R5bGUuZGlzcGxheSA9ICdub25lJyk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdwcmludGluZy1nZXN0aW9uJywgJ3ByaW50aW5nLW1vZGUnKTsKICAgICAgICB3aW5kb3cucHJpbnQoKTsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdwcmludGluZy1nZXN0aW9uJywgJ3ByaW50aW5nLW1vZGUnKTsKICAgICAgICAgICAgYXJlYS5pbm5lckhUTUwgPSAnJzsKICAgICAgICB9LCAxMDAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcmludFJlcGFydGl0aW9uKCkgewogICAgICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXBhcnRpdGlvbi1kYXktc2VsZWN0JykudmFsdWU7CiAgICAgICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXBhcnRpdGlvbi1jb250ZW50JykuaW5uZXJIVE1MOwogICAgICAgIGNvbnN0IGFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVwYXJ0aXRpb24tcHJpbnQtYXJlYScpOwogICAgICAgIAogICAgICAgIGFyZWEuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcmludC1oZWFkZXItYmF0Y2giPlF1aSBmYWl0IHF1b2kgPyAtICR7ZGF5fTwvZGl2PgogICAgICAgICAgICAke2NvbnRlbnR9CiAgICAgICAgYDsKICAgICAgICAKICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3ByaW50aW5nLXJlcGFydGl0aW9uJywgJ3ByaW50aW5nLW1vZGUnKTsKICAgICAgICB3aW5kb3cucHJpbnQoKTsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdwcmludGluZy1yZXBhcnRpdGlvbicsICdwcmludGluZy1tb2RlJyk7CiAgICAgICAgICAgIGFyZWEuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgfSwgMTAwMCk7CiAgICB9CgogICAgLy8gLS0tIElNUFJFU1NJT04gUEFSIEFHRU5UIC0tLQogICAgZnVuY3Rpb24gcHJpbnRTaW5nbGUoKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZWQtc2VsZWN0LWNvbmNlcHRpb24nKS52YWx1ZTsKICAgICAgICBpZighbmFtZSkgeyBhbGVydCgiU8OpbGVjdGlvbm5leiB1biBhZ2VudCAhIik7IHJldHVybjsgfQogICAgICAgIAogICAgICAgIGNvbnN0IGFnZW50ID0gREFUQS5hZ2VudHMuZmluZChhID0+IGEubmFtZSA9PT0gbmFtZSk7CiAgICAgICAgaWYoIWFnZW50KSByZXR1cm47CgogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYXRjaC1wcmludC1hcmVhJyk7CiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOyAKICAgICAgICAKICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3ByaW50aW5nLWJhdGNoJywgJ3ByaW50aW5nLW1vZGUnKTsKCiAgICAgICAgY29uc3QgcGFnZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHBhZ2VEaXYuY2xhc3NOYW1lID0gJ3BhZ2UtYnJlYWsnOwogICAgICAgIHBhZ2VEaXYuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9InByaW50LWhlYWRlci1iYXRjaCI+RW1wbG9pIGR1IHRlbXBzIDogJHthZ2VudC5uYW1lfSAoJHthZ2VudC5mdGVMYWJlbH0pPC9kaXY+YDsKICAgICAgICAKICAgICAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7CiAgICAgICAgdGFibGUuY2xhc3NOYW1lID0gJ2VkdC10YWJsZSc7CiAgICAgICAgdGFibGUuaW5uZXJIVE1MID0gZ2VuZXJhdGVUYWJsZUhUTUwoYWdlbnQubmFtZSk7CiAgICAgICAgCiAgICAgICAgcGFnZURpdi5hcHBlbmRDaGlsZCh0YWJsZSk7CiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHBhZ2VEaXYpOwoKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgd2luZG93LnByaW50KCk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdwcmludGluZy1iYXRjaCcsICdwcmludGluZy1tb2RlJyk7CiAgICAgICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0sIDUwMCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJpbnRBbGwoKSB7CiAgICAgICAgaWYoREFUQS5hZ2VudHMubGVuZ3RoID09PSAwKSB7IGFsZXJ0KCJBdWN1biBhZ2VudCDDoCBpbXByaW1lci4iKTsgcmV0dXJuOyB9CiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhdGNoLXByaW50LWFyZWEnKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7IAogICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgncHJpbnRpbmctYmF0Y2gnLCAncHJpbnRpbmctbW9kZScpOwogICAgICAgIERBVEEuYWdlbnRzLmZvckVhY2goKGFnZW50LCBpbmRleCkgPT4gewogICAgICAgICAgICBjb25zdCBwYWdlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHBhZ2VEaXYuY2xhc3NOYW1lID0gJ3BhZ2UtYnJlYWsnOwogICAgICAgICAgICBwYWdlRGl2LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJwcmludC1oZWFkZXItYmF0Y2giPkVtcGxvaSBkdSB0ZW1wcyA6ICR7YWdlbnQubmFtZX0gKCR7YWdlbnQuZnRlTGFiZWx9KTwvZGl2PmA7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAgICAgdGFibGUuY2xhc3NOYW1lID0gJ2VkdC10YWJsZSc7CiAgICAgICAgICAgIHRhYmxlLmlubmVySFRNTCA9IGdlbmVyYXRlVGFibGVIVE1MKGFnZW50Lm5hbWUpOwogICAgICAgICAgICBwYWdlRGl2LmFwcGVuZENoaWxkKHRhYmxlKTsKICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHBhZ2VEaXYpOwogICAgICAgIH0pOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB3aW5kb3cucHJpbnQoKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3ByaW50aW5nLWJhdGNoJywgJ3ByaW50aW5nLW1vZGUnKTsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgfSwgNTAwKTsKICAgIH0KCiAgICAvLyBHRVNUSU9OIERVIFJFTkRVIERFIExBIFRBQkxFIChBZGFwdMOpIGF1eCBzbG90cykKICAgIGZ1bmN0aW9uIGdlbmVyYXRlVGFibGVIVE1MKGFnZW50TmFtZSkgewogICAgICAgIGxldCBodG1sID0gYDx0aGVhZD48dHI+PHRoIHN0eWxlPSJ3aWR0aDo5MHB4Ij5IPC90aD5gOwogICAgICAgIERBWVMuZm9yRWFjaChkID0+IGh0bWwgKz0gYDx0aD4ke2R9PC90aD5gKTsKICAgICAgICBodG1sICs9IGA8L3RyPjwvdGhlYWQ+PHRib2R5PmA7CiAgICAgICAgY29uc3QgYWdlbnQgPSBEQVRBLmFnZW50cy5maW5kKGEgPT4gYS5uYW1lID09PSBhZ2VudE5hbWUpOwogICAgICAgIGNvbnN0IHNjaGVkID0gREFUQS5zY2hlZHVsZXNbYWdlbnROYW1lXSB8fCB7fTsKICAgICAgICAKICAgICAgICBjb25zdCBzbG90cyA9IChEQVRBLmNvbmZpZy5zbG90cyAmJiBEQVRBLmNvbmZpZy5zbG90cy5sZW5ndGggPiAwKSA/IERBVEEuY29uZmlnLnNsb3RzIDogREVGQVVMVF9TTE9UUzsKCiAgICAgICAgLy8gQm91Y2xlIHN1ciBsZXMgY3LDqW5lYXV4IGTDqWZpbmlzCiAgICAgICAgc2xvdHMuZm9yRWFjaCgoc2xvdCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgaHRtbCArPSBgPHRyPjx0ZCBjbGFzcz0idGltZS1jb2wiPiR7c2xvdC5zdGFydH08YnI+LTxicj4ke3Nsb3QuZW5kfTwvdGQ+YDsKICAgICAgICAgICAgREFZUy5mb3JFYWNoKGRheSA9PiB7CiAgICAgICAgICAgICAgICAvLyBMYSBjbMOpIHN0b2Nrw6llIGVzdCBKb3VyLUluZGV4IChleDogTHVuZGktMCkgcG91ciDDqnRyZSBpbmTDqXBlbmRhbnRlIGR1IHRleHRlCiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHtkYXl9LSR7aW5kZXh9YDsKICAgICAgICAgICAgICAgIGxldCBjb250ZW50ID0gJyc7CiAgICAgICAgICAgICAgICBsZXQgY2VsbENsYXNzID0gJyc7CiAgICAgICAgICAgICAgICBpZihhZ2VudCAmJiBhZ2VudC5jb25zdHJhaW50cy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGRheS50b0xvd2VyQ2FzZSgpKSkgewogICAgICAgICAgICAgICAgICAgIGNlbGxDbGFzcyA9ICdjZWxsLWJsb2NrZWQnOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmKHNjaGVkW2tleV0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiZ0NvbG9yID0gc2NoZWRba2V5XS5jb2xvciB8fCAnIzk5OSc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dENvbG9yID0gaXNMaWdodENvbG9yKGJnQ29sb3IpID8gJyMzMzMnIDogJ3doaXRlJzsKICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gYDxkaXYgY2xhc3M9ImNlbGwtY29udGVudCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6JHtiZ0NvbG9yfTtjb2xvcjoke3RleHRDb2xvcn0iPiR7c2NoZWRba2V5XS50b29sfTwvZGl2PmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBodG1sICs9IGA8dGQgY2xhc3M9IiR7Y2VsbENsYXNzfSI+JHtjb250ZW50fTwvdGQ+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gYDwvdHI+YDsKICAgICAgICB9KTsKICAgICAgICBodG1sICs9IGA8L3Rib2R5PmA7CiAgICAgICAgcmV0dXJuIGh0bWw7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzTGlnaHRDb2xvcihoZXgpIHsKICAgICAgICBjb25zdCBjID0gaGV4LnN1YnN0cmluZygxKTsKICAgICAgICBjb25zdCByZ2IgPSBwYXJzZUludChjLCAxNik7CiAgICAgICAgY29uc3QgciA9IChyZ2IgPj4gMTYpICYgMHhmZjsKICAgICAgICBjb25zdCBnID0gKHJnYiA+PiAgOCkgJiAweGZmOwogICAgICAgIGNvbnN0IGIgPSAocmdiID4+ICAwKSAmIDB4ZmY7CiAgICAgICAgY29uc3QgbHVtYSA9IDAuMjk5ICogciArIDAuNTg3ICogZyArIDAuMTE0ICogYjsKICAgICAgICByZXR1cm4gbHVtYSA+IDE2MDsKICAgIH0KCiAgICAvLyAtLS0gU1lTVEVNRSAtLS0KICAgIGZ1bmN0aW9uIHJlc2V0QWxsRGF0YSgpIHsKICAgICAgICBpZihjb25maXJtKCLDinRlcy12b3VzIHPDu3IgZGUgdm91bG9pciBUT1VUIGVmZmFjZXIgZXQgcmVwYXJ0aXIgw6AgesOpcm8gPyBDZXR0ZSBhY3Rpb24gZXN0IGlycsOpdmVyc2libGUuIikpIHsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oU1RPUkFHRV9LRVkpOwogICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBkb3dubG9hZEpTT04oKSB7CiAgICAgICAgY29uc3QgZGF0YVN0ciA9ICJkYXRhOnRleHQvanNvbjtjaGFyc2V0PXV0Zi04LCIgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoREFUQSkpOwogICAgICAgIGNvbnN0IGFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICBhbmNob3Iuc2V0QXR0cmlidXRlKCJocmVmIiwgZGF0YVN0cik7IGFuY2hvci5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIiwgInNhdXZlZ2FyZGVfYWVkX3BpbG90ZS5qc29uIik7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhbmNob3IpOyBhbmNob3IuY2xpY2soKTsgYW5jaG9yLnJlbW92ZSgpOwogICAgfQogICAgZnVuY3Rpb24gaW1wb3J0SlNPTihpbnB1dCkgewogICAgICAgIGNvbnN0IGZpbGUgPSBpbnB1dC5maWxlc1swXTsKICAgICAgICBpZighZmlsZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIHIub25sb2FkID0gZSA9PiB7IHRyeXsgREFUQSA9IEpTT04ucGFyc2UoZS50YXJnZXQucmVzdWx0KTsgc2F2ZUxvY2FsU3RvcmFnZSgpOyByZWZyZXNoQWxsVUkoKTsgfWNhdGNoKGUpe2FsZXJ0KCJFcnJldXIiKTt9IH07CiAgICAgICAgci5yZWFkQXNUZXh0KGZpbGUpOwogICAgfQogICAgZnVuY3Rpb24gc2F2ZUxvY2FsU3RvcmFnZSgpIHsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KERBVEEpKTsgfQogICAgCiAgICBmdW5jdGlvbiBsb2FkTG9jYWxTdG9yYWdlKCkgeyAKICAgICAgICBsZXQgaiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZKTsKICAgICAgICBpZihqKSB7IAogICAgICAgICAgICBEQVRBID0gSlNPTi5wYXJzZShqKTsgCiAgICAgICAgICAgIC8vIFLDqXRyby1jb21wYXRpYmlsaXTDqSA6IHNpIHBhcyBkZSBzbG90cywgb24gbWV0IGNldXggcGFyIGTDqWZhdXQKICAgICAgICAgICAgaWYoIURBVEEuY29uZmlnKSBEQVRBLmNvbmZpZyA9IHsgc2xvdHM6IERFRkFVTFRfU0xPVFMgfTsKICAgICAgICAgICAgaWYoIURBVEEuY29uZmlnLnNsb3RzKSBEQVRBLmNvbmZpZy5zbG90cyA9IERFRkFVTFRfU0xPVFM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gUHJlbWllciBsYW5jZW1lbnQKICAgICAgICAgICAgREFUQS5jb25maWcuc2xvdHMgPSBERUZBVUxUX1NMT1RTOwogICAgICAgIH0KICAgICAgICByZWZyZXNoQWxsVUkoKTsgCiAgICB9CiAgICBmdW5jdGlvbiByZWZyZXNoQWxsVUkoKSB7IHJlbmRlck92ZXJ2aWV3KCk7IHBvcHVsYXRlU2VsZWN0cygpOyByZW5kZXJUaW1ldGFibGUoKTsgcmVuZGVySW1wb3J0SW5mbygpOyByZW5kZXJQYWxldHRlKCk7IH0KCiAgICAvLyAtLS0gR0VTVElPTiBERVMgU0VSVklDRVMgKFBBTEVUVEUgRFlOQU1JUVVFKSAtLS0KICAgIGZ1bmN0aW9uIGdldEFsbFNlcnZpY2VzKCkgewogICAgICAgIGNvbnN0IGN1c3RvbVNlcnZpY2VzID0gREFUQS5zZXJ2aWNlcyB8fCBbXTsKICAgICAgICByZXR1cm4gWy4uLkRFRkFVTFRfU0VSVklDRVMsIC4uLmN1c3RvbVNlcnZpY2VzXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVuZGVyUGFsZXR0ZSgpIHsKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFsZXR0ZS1jb250YWluZXInKTsKICAgICAgICBpZighY29udGFpbmVyKSByZXR1cm47CiAgICAgICAgCiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgIGNvbnN0IHNlcnZpY2VzID0gZ2V0QWxsU2VydmljZXMoKTsKICAgICAgICAKICAgICAgICBzZXJ2aWNlcy5mb3JFYWNoKChzZXJ2aWNlLCBpbmRleCkgPT4gewogICAgICAgICAgICBjb25zdCBpc0xpZ2h0ID0gaXNMaWdodENvbG9yKHNlcnZpY2UuY29sb3IpOwogICAgICAgICAgICBjb25zdCB0ZXh0Q29sb3IgPSBpc0xpZ2h0ID8gJyMzMzMnIDogJ3doaXRlJzsKICAgICAgICAgICAgY29uc3QgdGV4dFNoYWRvdyA9IGlzTGlnaHQgPyAnbm9uZScgOiAnMCAxcHggMXB4IHJnYmEoMCwwLDAsMC4yKSc7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gJ3BhbGV0dGUtYnRuLXdyYXBwZXInOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGJ0bi5jbGFzc05hbWUgPSAncGFsZXR0ZS1idG4nICsgKGluZGV4ID09PSAwID8gJyBzZWxlY3RlZCcgOiAnJyk7CiAgICAgICAgICAgIGJ0bi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBzZXJ2aWNlLmNvbG9yOwogICAgICAgICAgICBidG4uc3R5bGUuY29sb3IgPSB0ZXh0Q29sb3I7CiAgICAgICAgICAgIGJ0bi5zdHlsZS50ZXh0U2hhZG93ID0gdGV4dFNoYWRvdzsKICAgICAgICAgICAgYnRuLnRleHRDb250ZW50ID0gc2VydmljZS5uYW1lOwogICAgICAgICAgICBidG4ub25jbGljayA9IGZ1bmN0aW9uKGUpIHsgc2V0VG9vbChzZXJ2aWNlLm5hbWUsIHNlcnZpY2UuY29sb3IpOyB9OwogICAgICAgICAgICAKICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChidG4pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoIXNlcnZpY2UuaXNEZWZhdWx0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZWxldGVCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICAgICAgICAgIGRlbGV0ZUJ0bi5jbGFzc05hbWUgPSAnc2VydmljZS1kZWxldGUnOwogICAgICAgICAgICAgICAgZGVsZXRlQnRuLmlubmVySFRNTCA9ICfDlyc7CiAgICAgICAgICAgICAgICBkZWxldGVCdG4udGl0bGUgPSAnU3VwcHJpbWVyIGNlIHNlcnZpY2UnOwogICAgICAgICAgICAgICAgZGVsZXRlQnRuLm9uY2xpY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICBkZWxldGVTZXJ2aWNlKHNlcnZpY2UuaWQpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZGVsZXRlQnRuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHdyYXBwZXIpOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGNvbnN0IGFkZEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGFkZEJ0bi5jbGFzc05hbWUgPSAncGFsZXR0ZS1idG4gYnRuLWFkZC1zZXJ2aWNlJzsKICAgICAgICBhZGRCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPic7CiAgICAgICAgYWRkQnRuLnRpdGxlID0gJ0Fqb3V0ZXIgdW4gc2VydmljZSc7CiAgICAgICAgYWRkQnRuLm9uY2xpY2sgPSBvcGVuU2VydmljZU1vZGFsOwogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChhZGRCdG4pOwogICAgICAgIAogICAgICAgIGNvbnN0IGVyYXNlckJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGVyYXNlckJ0bi5jbGFzc05hbWUgPSAncGFsZXR0ZS1idG4gYmctZXJhc2VyJzsKICAgICAgICBlcmFzZXJCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtZXJhc2VyIj48L2k+JzsKICAgICAgICBlcmFzZXJCdG4ub25jbGljayA9IGZ1bmN0aW9uKCkgeyBzZXRUb29sKCdnb21tZScsICcnKTsgfTsKICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZXJhc2VyQnRuKTsKICAgICAgICAKICAgICAgICBpZihzZXJ2aWNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIENVUlJFTlRfVE9PTCA9IHsgbmFtZTogc2VydmljZXNbMF0ubmFtZSwgY29sb3I6IHNlcnZpY2VzWzBdLmNvbG9yLCBpc0VyYXNlcjogZmFsc2UgfTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9wZW5TZXJ2aWNlTW9kYWwoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXNlcnZpY2UnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VydmljZS1uYW1lJykudmFsdWUgPSAnJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VydmljZS1jb2xvcicpLnZhbHVlID0gJyMzNDk4ZGInOwogICAgICAgIHVwZGF0ZVByZXZpZXcoKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VydmljZS1uYW1lJykuZm9jdXMoKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2xvc2VTZXJ2aWNlTW9kYWwoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXNlcnZpY2UnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0UHJlc2V0Q29sb3IoY29sb3IpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VydmljZS1jb2xvcicpLnZhbHVlID0gY29sb3I7CiAgICAgICAgdXBkYXRlUHJldmlldygpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGRhdGVQcmV2aWV3KCkgewogICAgICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VydmljZS1uYW1lJykudmFsdWUudHJpbSgpIHx8ICdOT1VWRUFVIFNFUlZJQ0UnOwogICAgICAgIGNvbnN0IGNvbG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcnZpY2UtY29sb3InKS52YWx1ZTsKICAgICAgICBjb25zdCBwcmV2aWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcnZpY2UtcHJldmlldycpOwogICAgICAgIHByZXZpZXcudGV4dENvbnRlbnQgPSBuYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgcHJldmlldy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjsKICAgICAgICBwcmV2aWV3LnN0eWxlLmNvbG9yID0gaXNMaWdodENvbG9yKGNvbG9yKSA/ICcjMzMzJyA6ICd3aGl0ZSc7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNvbmZpcm1BZGRTZXJ2aWNlKCkgewogICAgICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VydmljZS1uYW1lJykudmFsdWUudHJpbSgpOwogICAgICAgIGNvbnN0IGNvbG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcnZpY2UtY29sb3InKS52YWx1ZTsKICAgICAgICAKICAgICAgICBpZighbmFtZSkgeyBhbGVydCgnVmV1aWxsZXogZW50cmVyIHVuIG5vbSBwb3VyIGxlIHNlcnZpY2UnKTsgcmV0dXJuOyB9CiAgICAgICAgaWYobmFtZS5sZW5ndGggPiAxNSkgeyBhbGVydCgnTGUgbm9tIGR1IHNlcnZpY2UgbmUgZG9pdCBwYXMgZMOpcGFzc2VyIDE1IGNhcmFjdMOocmVzJyk7IHJldHVybjsgfQogICAgICAgIAogICAgICAgIGNvbnN0IGFsbFNlcnZpY2VzID0gZ2V0QWxsU2VydmljZXMoKTsKICAgICAgICBpZihhbGxTZXJ2aWNlcy5zb21lKHMgPT4gcy5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKSkpIHsgYWxlcnQoJ1VuIHNlcnZpY2UgYXZlYyBjZSBub20gZXhpc3RlIGTDqWrDoCcpOyByZXR1cm47IH0KICAgICAgICAKICAgICAgICBjb25zdCBuZXdTZXJ2aWNlID0geyBpZDogJ2N1c3RvbV8nICsgRGF0ZS5ub3coKSwgbmFtZTogbmFtZSwgY29sb3I6IGNvbG9yLCBpc0RlZmF1bHQ6IGZhbHNlIH07CiAgICAgICAgaWYoIURBVEEuc2VydmljZXMpIERBVEEuc2VydmljZXMgPSBbXTsKICAgICAgICBEQVRBLnNlcnZpY2VzLnB1c2gobmV3U2VydmljZSk7CiAgICAgICAgCiAgICAgICAgc2F2ZUxvY2FsU3RvcmFnZSgpOwogICAgICAgIHJlbmRlclBhbGV0dGUoKTsKICAgICAgICBjbG9zZVNlcnZpY2VNb2RhbCgpOwogICAgICAgIAogICAgICAgIENVUlJFTlRfVE9PTCA9IHsgbmFtZTogbmV3U2VydmljZS5uYW1lLCBjb2xvcjogbmV3U2VydmljZS5jb2xvciwgaXNFcmFzZXI6IGZhbHNlIH07CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBhbGV0dGUtYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKSk7CiAgICAgICAgY29uc3QgYnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYWxldHRlLWJ0bicpOwogICAgICAgIGlmKGJ0bnMubGVuZ3RoID4gMikgYnRuc1tidG5zLmxlbmd0aCAtIDNdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7IAogICAgfQogICAgCiAgICBmdW5jdGlvbiBkZWxldGVTZXJ2aWNlKHNlcnZpY2VJZCkgewogICAgICAgIGlmKCFjb25maXJtKCdTdXBwcmltZXIgY2Ugc2VydmljZSA/JykpIHJldHVybjsKICAgICAgICBEQVRBLnNlcnZpY2VzID0gKERBVEEuc2VydmljZXMgfHwgW10pLmZpbHRlcihzID0+IHMuaWQgIT09IHNlcnZpY2VJZCk7CiAgICAgICAgc2F2ZUxvY2FsU3RvcmFnZSgpOwogICAgICAgIHJlbmRlclBhbGV0dGUoKTsKICAgIH0KICAgIAogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtc2VydmljZScpOwogICAgICAgIGlmKGUudGFyZ2V0ID09PSBtb2RhbCkgY2xvc2VTZXJ2aWNlTW9kYWwoKTsKICAgICAgICBjb25zdCBtb2RhbEdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtZ3JpZC1jb25maWcnKTsKICAgICAgICBpZihlLnRhcmdldCA9PT0gbW9kYWxHcmlkKSBtb2RhbEdyaWQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICB9KTsKICAgIAogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXJ2aWNlLW5hbWUnKTsKICAgICAgICBpZihuYW1lSW5wdXQpIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZVByZXZpZXcpOwogICAgfSk7CgogICAgLy8gLS0tIExPR0lRVUUgTUVOVSA0IDogUVVJIEZBSVQgUVVPSSAoUkVQQVJUSVRJT04pIC0tLQogICAgZnVuY3Rpb24gcmVuZGVyUmVwYXJ0aXRpb24oKSB7CiAgICAgICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcGFydGl0aW9uLWRheS1zZWxlY3QnKS52YWx1ZTsKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVwYXJ0aXRpb24tY29udGVudCcpOwogICAgICAgIGNvbnN0IHNlcnZpY2VzID0gZ2V0QWxsU2VydmljZXMoKTsKICAgICAgICAKICAgICAgICBpZighY29udGFpbmVyKSByZXR1cm47CgogICAgICAgIGxldCBodG1sID0gYDx0YWJsZSBjbGFzcz0icmVwYXJ0aXRpb24tdGFibGUiPjx0aGVhZD48dHI+YDsKICAgICAgICBodG1sICs9IGA8dGggc3R5bGU9IndpZHRoOjkwcHg7IGJhY2tncm91bmQ6IzJjM2U1MDsgei1pbmRleDoyMDsiPkhvcmFpcmU8L3RoPmA7CiAgICAgICAgCiAgICAgICAgc2VydmljZXMuZm9yRWFjaChzID0+IHsKICAgICAgICAgICAgY29uc3QgaXNMaWdodCA9IGlzTGlnaHRDb2xvcihzLmNvbG9yKTsKICAgICAgICAgICAgY29uc3QgdGV4dENvbG9yID0gaXNMaWdodCA/ICcjMzMzJyA6ICd3aGl0ZSc7CiAgICAgICAgICAgIGh0bWwgKz0gYDx0aCBzdHlsZT0iYmFja2dyb3VuZDoke3MuY29sb3J9OyBjb2xvcjoke3RleHRDb2xvcn07IGJvcmRlci1jb2xvcjoke2lzTGlnaHQ/JyNjY2MnOnMuY29sb3J9Ij4ke3MubmFtZX08L3RoPmA7CiAgICAgICAgfSk7CiAgICAgICAgaHRtbCArPSBgPC90cj48L3RoZWFkPjx0Ym9keT5gOwoKICAgICAgICBjb25zdCBzbG90cyA9IChEQVRBLmNvbmZpZy5zbG90cyAmJiBEQVRBLmNvbmZpZy5zbG90cy5sZW5ndGggPiAwKSA/IERBVEEuY29uZmlnLnNsb3RzIDogREVGQVVMVF9TTE9UUzsKCiAgICAgICAgc2xvdHMuZm9yRWFjaCgoc2xvdCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgaHRtbCArPSBgPHRyPjx0ZCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsgYmFja2dyb3VuZDojZjBmMmY1OyB0ZXh0LWFsaWduOmNlbnRlcjsgYm9yZGVyLXJpZ2h0OjJweCBzb2xpZCAjY2NjOyBmb250LXNpemU6MC43NXJlbTsiPiR7c2xvdC5zdGFydH08YnI+LTxicj4ke3Nsb3QuZW5kfTwvdGQ+YDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlcnZpY2VzLmZvckVhY2goc2VydmljZSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgYWdlbnRzT25Qb3N0ID0gW107CiAgICAgICAgICAgICAgICBEQVRBLmFnZW50cy5mb3JFYWNoKGFnZW50ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHtkYXl9LSR7aW5kZXh9YDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzY2hlZCA9IERBVEEuc2NoZWR1bGVzW2FnZW50Lm5hbWVdOwogICAgICAgICAgICAgICAgICAgIGlmKHNjaGVkICYmIHNjaGVkW2tleV0gJiYgc2NoZWRba2V5XS50b29sID09PSBzZXJ2aWNlLm5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWdlbnRzT25Qb3N0LnB1c2goYWdlbnQubmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCBjZWxsQ29udGVudCA9IGFnZW50c09uUG9zdC5tYXAobmFtZSA9PiBgPHNwYW4gY2xhc3M9ImFnZW50LXRhZyI+JHtuYW1lfTwvc3Bhbj5gKS5qb2luKCcnKTsKICAgICAgICAgICAgICAgIGh0bWwgKz0gYDx0ZD4ke2NlbGxDb250ZW50fTwvdGQ+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gYDwvdHI+YDsKICAgICAgICB9KTsKCiAgICAgICAgaHRtbCArPSBgPC90Ym9keT48L3RhYmxlPmA7CiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7CiAgICB9CgogICAgLy8gLS0tIElNUE9SVCBFWENFTCAtLS0KICAgIGZ1bmN0aW9uIGhhbmRsZUV4Y2VsKGlucHV0KSB7CiAgICAgICAgY29uc3QgZiA9IGlucHV0LmZpbGVzWzBdOyAKICAgICAgICBpZighZikgcmV0dXJuOwogICAgICAgIAogICAgICAgIGNvbnN0IHIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIHIub25sb2FkID0gZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHdiID0gWExTWC5yZWFkKG5ldyBVaW50OEFycmF5KGUudGFyZ2V0LnJlc3VsdCksIHt0eXBlOidhcnJheSd9KTsKICAgICAgICAgICAgY29uc3Qgcm93cyA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3Yi5TaGVldHNbd2IuU2hlZXROYW1lc1swXV0sIHtoZWFkZXI6MX0pOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gcm93c1swXTsKICAgICAgICAgICAgY29uc3QgcXVvdGl0ZXMgPSBbXTsKICAgICAgICAgICAgLy8gTU9ESUZJQ0FUSU9OIElDSSA6IE9uIHNjYW5uZSBqdXNxdSfDoCBsYSBjb2xvbm5lIDggKEluZGV4IEkpIHBvdXIgbGVzIHF1b3RpdMOpcwogICAgICAgICAgICBmb3IobGV0IGNvbCA9IDE7IGNvbCA8PSA4OyBjb2wrKykgewogICAgICAgICAgICAgICAgY29uc3QgdmFsID0gcGFyc2VGbG9hdChoZWFkZXJbY29sXSk7CiAgICAgICAgICAgICAgICBpZighaXNOYU4odmFsKSAmJiB2YWwgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnRlID0gdmFsID4gMSA/IHZhbCAvIDEwMCA6IHZhbDsKICAgICAgICAgICAgICAgICAgICBxdW90aXRlcy5wdXNoKHsgY29sdW1uOiBjb2wsIGZ0ZTogZnRlLCBsYWJlbDogTWF0aC5yb3VuZChmdGUgKiAxMDApICsgJyUnIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBEQVRBLnF1b3RpdGVzID0gcXVvdGl0ZXM7CiAgICAgICAgICAgIERBVEEuYWdlbnRzID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IobGV0IGkgPSAxOyBpIDwgcm93cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IHJvd3NbaV07IAogICAgICAgICAgICAgICAgaWYoIWMgfHwgIWNbMF0pIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgZnRlID0gMDsKICAgICAgICAgICAgICAgIGxldCBmdGVMYWJlbCA9ICJJbmNvbm51IjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yKGNvbnN0IHEgb2YgcXVvdGl0ZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZihjaGVja1goY1txLmNvbHVtbl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ0ZSA9IHEuZnRlOwogICAgICAgICAgICAgICAgICAgICAgICBmdGVMYWJlbCA9IHEubGFiZWw7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYoZnRlID09PSAwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTU9ESUZJQ0FUSU9OIElDSSA6IFLDqWFsaWduZW1lbnQgZGVzIGNvbG9ubmVzIHNlbG9uIGxlIG5vdXZlYXUgZmljaGllcgogICAgICAgICAgICAgICAgLy8gQ29sIDEwIChLKSA9IFRlbXBzIGRlIHRyYXZhaWwgYW5udWVsCiAgICAgICAgICAgICAgICAvLyBDb2wgMTEgKEwpID0gQ3LDqWRpdCBmb3JtYXRpb24KICAgICAgICAgICAgICAgIC8vIENvbCA5IChKKSA9IENvbnRyYWludGVzCiAgICAgICAgICAgICAgICBjb25zdCBiYXNlID0gcGFyc2VGbG9hdChjWzEwXSkgfHwgMTYwNzsKICAgICAgICAgICAgICAgIGNvbnN0IGNyZWRpdCA9IHBhcnNlRmxvYXQoY1sxMV0pIHx8IDA7CiAgICAgICAgICAgICAgICBjb25zdCBuZXRBbm51YWwgPSAoYmFzZSAqIGZ0ZSkgLSBjcmVkaXQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIERBVEEuYWdlbnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6IGNbMF0sIGZ0ZTogZnRlLCBmdGVMYWJlbDogZnRlTGFiZWwsIGJhc2U6IGJhc2UsCiAgICAgICAgICAgICAgICAgICAgcmF3QW5udWFsOiBiYXNlICogZnRlLCBjcmVkaXQ6IGNyZWRpdCwgbmV0QW5udWFsOiBuZXRBbm51YWwsIAogICAgICAgICAgICAgICAgICAgIHdlZWtseVRhcmdldDogTWF0aC5tYXgoMCwgbmV0QW5udWFsIC8gMzkpLCBpbnRlcm5hdEhvdXJzOiAwLAogICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzOiAoY1s5XSB8fCAiIikudHJpbSgpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzYXZlTG9jYWxTdG9yYWdlKCk7IAogICAgICAgICAgICByZWZyZXNoQWxsVUkoKTsKICAgICAgICB9OwogICAgICAgIHIucmVhZEFzQXJyYXlCdWZmZXIoZik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNoZWNrWCh2KSB7IHJldHVybiB2ICYmIFN0cmluZyh2KS50b1VwcGVyQ2FzZSgpLnRyaW0oKSA9PT0gJ1gnOyB9CgogICAgLy8gLS0tIEFGRklDSEFHRSBJTkZPIElNUE9SVCAtLS0KICAgIGZ1bmN0aW9uIHJlbmRlckltcG9ydEluZm8oKSB7CiAgICAgICAgY29uc3QgYXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbXBvcnQtaW5mby1hcmVhJyk7CiAgICAgICAgaWYoIURBVEEucXVvdGl0ZXMgfHwgREFUQS5xdW90aXRlcy5sZW5ndGggPT09IDApIHsgYXJlYS5pbm5lckhUTUwgPSAnJzsgcmV0dXJuOyB9CiAgICAgICAgCiAgICAgICAgY29uc3QgcXVvdGl0ZUh0bWwgPSBEQVRBLnF1b3RpdGVzLm1hcChxID0+IGA8c3BhbiBjbGFzcz0icXVvdGl0ZS1pdGVtIj48c3Ryb25nPiR7cS5sYWJlbH08L3N0cm9uZz4gKGNvbC4ke3EuY29sdW1uICsgMX0pPC9zcGFuPmApLmpvaW4oJycpOwogICAgICAgIGFyZWEuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtaW5mbyI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWluZm8tY2lyY2xlIiBzdHlsZT0iY29sb3I6dmFyKC0tc2Vjb25kYXJ5KSI+PC9pPgogICAgICAgICAgICAgICAgPHN0cm9uZz5GaWNoaWVyIGltcG9ydMOpPC9zdHJvbmc+IC0gJHtEQVRBLmFnZW50cy5sZW5ndGh9IGFnZW50KHMpIGNoYXJnw6kocykKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InF1b3RpdGUtbGlzdCI+PHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7IG1hcmdpbi1yaWdodDoxMHB4OyI+UXVvdGl0w6lzIGTDqXRlY3TDqWVzIDo8L3NwYW4+JHtxdW90aXRlSHRtbH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJPdmVydmlldygpIHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rhc2hib2FyZC1hcmVhJyk7IAogICAgICAgIGMuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgaWYoREFUQS5hZ2VudHMubGVuZ3RoID09PSAwKSB7IAogICAgICAgICAgICBjLmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjoxLy0xO3RleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6NTBweDtjb2xvcjojYWFhOyI+PGkgY2xhc3M9ImZhcyBmYS1mb2xkZXItb3BlbiIgc3R5bGU9ImZvbnQtc2l6ZTozcmVtOyBtYXJnaW4tYm90dG9tOjEwcHg7Ij48L2k+PGJyPkF1Y3VuZSBkb25uw6llLiBWZXVpbGxleiBpbXBvcnRlciB1biBmaWNoaWVyIEV4Y2VsIG91IHJlc3RhdXJlciB1bmUgc2F1dmVnYXJkZS48L2Rpdj4nOyAKICAgICAgICAgICAgcmV0dXJuOyAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgREFUQS5hZ2VudHMuZm9yRWFjaChhID0+IHsKICAgICAgICAgICAgY29uc3Qgc3RhbmRhcmRRdW90aXRlcyA9IFsxLCAwLjgsIDAuNSwgMC4yNV07CiAgICAgICAgICAgIGNvbnN0IGlzU3RhbmRhcmQgPSBzdGFuZGFyZFF1b3RpdGVzLnNvbWUoc3EgPT4gTWF0aC5hYnMoc3EgLSBhLmZ0ZSkgPCAwLjAxKTsKICAgICAgICAgICAgY29uc3QgYmFkZ2VDbGFzcyA9IGlzU3RhbmRhcmQgPyAnYmFkZ2Utc3RhbmRhcmQnIDogJ2JhZGdlLWN1c3RvbSc7CiAgICAgICAgICAgIAogICAgICAgICAgICBjLmlubmVySFRNTCArPSBgPGRpdiBjbGFzcz0iYWVkLXN1bW1hcnktY2FyZCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWhlYWRlciI+PHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Y29sb3I6dmFyKC0tcHJpbWFyeSkiPiR7YS5uYW1lfTwvc3Bhbj48c3BhbiBjbGFzcz0iJHtiYWRnZUNsYXNzfSIgc3R5bGU9ImNvbG9yOndoaXRlO3BhZGRpbmc6MnB4IDhweDtib3JkZXItcmFkaXVzOjEwcHg7Zm9udC1zaXplOjAuOHJlbSI+JHthLmZ0ZUxhYmVsfTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtYm9keSI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3RhdC1yb3ciPjxzcGFuPlF1b3RpdMOpPC9zcGFuPjxzcGFuPiR7KGEuZnRlICogMTAwKS50b0ZpeGVkKDApfSUgKCR7YS5mdGUudG9GaXhlZCgyKX0pPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN0YXQtcm93Ij48c3Bhbj5CYXNlIGFubnVlbGxlPC9zcGFuPjxzcGFuPiR7YS5iYXNlfWg8L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3RhdC1yb3ciPjxzcGFuPlRlbXBzIHByb3JhdMOpPC9zcGFuPjxzcGFuPiR7YS5yYXdBbm51YWwudG9GaXhlZCgxKX1oPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN0YXQtcm93Ij48c3Bhbj5DcsOpZGl0IGZvcm1hdGlvbjwvc3Bhbj48c3Bhbj4tJHthLmNyZWRpdH1oPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN0YXQtcm93Ij48c3Bhbj5OZXQgQW5udWVsPC9zcGFuPjxzcGFuPjxzdHJvbmc+JHthLm5ldEFubnVhbC50b0ZpeGVkKDEpfWg8L3N0cm9uZz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3RhdC1yb3ciIHN0eWxlPSJiYWNrZ3JvdW5kOiNmMGY5ZmY7Zm9udC13ZWlnaHQ6Ym9sZDtjb2xvcjojMjk4MGI5O21hcmdpbi10b3A6NXB4O3BhZGRpbmc6NXB4OyI+PHNwYW4+Q2libGUgSGViZG8gKMO3MzkpPC9zcGFuPjxzcGFuPiR7YS53ZWVrbHlUYXJnZXQudG9GaXhlZCgyKX1oPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICR7YS5jb25zdHJhaW50cyA/IGA8ZGl2IGNsYXNzPSJjb25zdHJhaW50cy1ib3giPuKaoO+4jyAke2EuY29uc3RyYWludHN9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gLS0tIENPTkNFUFRJT04gLS0tCiAgICBmdW5jdGlvbiBwb3B1bGF0ZVNlbGVjdHMoKSB7CiAgICAgICAgY29uc3QgczEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWVkLXNlbGVjdC1jb25jZXB0aW9uJyk7CiAgICAgICAgY29uc3QgczIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWVkLXNlbGVjdC1nZXN0aW9uJyk7CiAgICAgICAgY29uc3QgdjEgPSBzMS52YWx1ZSwgdjIgPSBzMi52YWx1ZTsKICAgICAgICBzMS5pbm5lckhUTUwgPSBzMi5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj4tLSBTw6lsZWN0aW9ubmVyIC0tPC9vcHRpb24+JzsKICAgICAgICBEQVRBLmFnZW50cy5mb3JFYWNoKGEgPT4gewogICAgICAgICAgICBjb25zdCBvcHQgPSBgPG9wdGlvbiB2YWx1ZT0iJHthLm5hbWV9Ij4ke2EubmFtZX0gKCR7YS5mdGVMYWJlbH0pPC9vcHRpb24+YDsKICAgICAgICAgICAgczEuaW5uZXJIVE1MICs9IG9wdDsgczIuaW5uZXJIVE1MICs9IG9wdDsKICAgICAgICB9KTsKICAgICAgICBpZih2MSkgczEudmFsdWUgPSB2MTsgaWYodjIpIHMyLnZhbHVlID0gdjI7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlQUVEKHZpZXcpIHsgCiAgICAgICAgaWYodmlldyA9PT0gJ2NvbmNlcHRpb24nKSB7IAogICAgICAgICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FlZC1zZWxlY3QtY29uY2VwdGlvbicpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBhZ2VudCA9IERBVEEuYWdlbnRzLmZpbmQoYSA9PiBhLm5hbWUgPT09IG5hbWUpOwogICAgICAgICAgICBpZihhZ2VudCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW50ZXJuYXQtaG91cnMnKS52YWx1ZSA9IGFnZW50LmludGVybmF0SG91cnMgfHwgMDsgfQogICAgICAgICAgICByZW5kZXJUaW1ldGFibGUoKTsgdXBkYXRlU3RhdHNIZWFkZXIoKTsgCiAgICAgICAgfSBlbHNlIHsgdXBkYXRlR2VzdGlvblVJKCk7IH0gCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9vbChuYW1lLCBjb2xvcikgewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYWxldHRlLWJ0bicpLmZvckVhY2goYiA9PiBiLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJykpOwogICAgICAgIGlmKG5hbWUgIT09ICdnb21tZScpIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOwogICAgICAgIENVUlJFTlRfVE9PTCA9IG5hbWUgPT09ICdnb21tZScgPyB7aXNFcmFzZXI6IHRydWV9IDoge25hbWU6IG5hbWUsIGNvbG9yOiBjb2xvciwgaXNFcmFzZXI6IGZhbHNlfTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJUaW1ldGFibGUoKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZWQtc2VsZWN0LWNvbmNlcHRpb24nKS52YWx1ZTsKICAgICAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aW1ldGFibGUnKTsKICAgICAgICBpZighbmFtZSkgeyB0YWJsZS5pbm5lckhUTUwgPSAnJzsgcmV0dXJuOyB9CiAgICAgICAgdGFibGUuaW5uZXJIVE1MID0gZ2VuZXJhdGVUYWJsZUhUTUwobmFtZSk7CiAgICAgICAgCiAgICAgICAgdGFibGUucXVlcnlTZWxlY3RvckFsbCgndGQ6bm90KC50aW1lLWNvbCknKS5mb3JFYWNoKHRkID0+IHsKICAgICAgICAgICAgdGQub25jbGljayA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY29uc3QgdHIgPSB0aGlzLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICBjb25zdCByb3dJbmRleCA9IEFycmF5LmZyb20odHIucGFyZW50Tm9kZS5jaGlsZHJlbikuaW5kZXhPZih0cik7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xJbmRleCA9IEFycmF5LmZyb20odHIuY2hpbGRyZW4pLmluZGV4T2YodGhpcykgLSAxOyAKICAgICAgICAgICAgICAgIGlmKGNvbEluZGV4IDwgMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgLy8gcm93SW5kZXggY29ycmVzcG9uZCDDoCBsJ2luZGV4IGR1IHNsb3QKICAgICAgICAgICAgICAgIGNvbnN0IGRheSA9IERBWVNbY29sSW5kZXhdOwogICAgICAgICAgICAgICAgY2xpY2tDZWxsKGRheSwgcm93SW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xpY2tDZWxsKGRheSwgc2xvdEluZGV4KSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZWQtc2VsZWN0LWNvbmNlcHRpb24nKS52YWx1ZTsKICAgICAgICBpZighbmFtZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IGFnZW50ID0gREFUQS5hZ2VudHMuZmluZChhID0+IGEubmFtZSA9PT0gbmFtZSk7CiAgICAgICAgaWYoYWdlbnQgJiYgYWdlbnQuY29uc3RyYWludHMudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhkYXkudG9Mb3dlckNhc2UoKSkpIHJldHVybjsKCiAgICAgICAgaWYoIURBVEEuc2NoZWR1bGVzW25hbWVdKSBEQVRBLnNjaGVkdWxlc1tuYW1lXSA9IHt9OwogICAgICAgIGNvbnN0IGtleSA9IGAke2RheX0tJHtzbG90SW5kZXh9YDsgLy8gQ2zDqSBiYXPDqWUgc3VyIGwnaW5kZXggZHUgY3LDqW5lYXUKCiAgICAgICAgaWYoQ1VSUkVOVF9UT09MLmlzRXJhc2VyKSBkZWxldGUgREFUQS5zY2hlZHVsZXNbbmFtZV1ba2V5XTsKICAgICAgICBlbHNlIERBVEEuc2NoZWR1bGVzW25hbWVdW2tleV0gPSB7IHRvb2w6IENVUlJFTlRfVE9PTC5uYW1lLCBjb2xvcjogQ1VSUkVOVF9UT09MLmNvbG9yIH07CiAgICAgICAgCiAgICAgICAgc2F2ZUxvY2FsU3RvcmFnZSgpOwogICAgICAgIHJlbmRlclRpbWV0YWJsZSgpOwogICAgICAgIHVwZGF0ZVN0YXRzSGVhZGVyKCk7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlU3RhdHNIZWFkZXIoKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZWQtc2VsZWN0LWNvbmNlcHRpb24nKS52YWx1ZTsKICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXItc3RhdHMnKTsKICAgICAgICBpZighbmFtZSkgeyBlbC5pbm5lclRleHQgPSAiMGggLyAwaCI7IHJldHVybjsgfQogICAgICAgIAogICAgICAgIGNvbnN0IGFnZW50ID0gREFUQS5hZ2VudHMuZmluZChhID0+IGEubmFtZSA9PT0gbmFtZSk7CiAgICAgICAgY29uc3QgaW50ZXJuYXQgPSBhZ2VudC5pbnRlcm5hdEhvdXJzIHx8IDA7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsIGR1IHRlbXBzIHBsYW5pZmnDqSBiYXPDqSBzdXIgbGEgZHVyw6llIHLDqWVsbGUgZGVzIHNsb3RzCiAgICAgICAgbGV0IHRvdGFsTWludXRlcyA9IDA7CiAgICAgICAgY29uc3Qgc2xvdHMgPSAoREFUQS5jb25maWcuc2xvdHMgJiYgREFUQS5jb25maWcuc2xvdHMubGVuZ3RoID4gMCkgPyBEQVRBLmNvbmZpZy5zbG90cyA6IERFRkFVTFRfU0xPVFM7CiAgICAgICAgY29uc3Qgc2NoZWQgPSBEQVRBLnNjaGVkdWxlc1tuYW1lXSB8fCB7fTsKCiAgICAgICAgREFZUy5mb3JFYWNoKGRheSA9PiB7CiAgICAgICAgICAgIHNsb3RzLmZvckVhY2goKHNsb3QsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHtkYXl9LSR7aW5kZXh9YDsKICAgICAgICAgICAgICAgIGlmKHNjaGVkW2tleV0pIHsKICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWwgZHVyw6llIHNsb3QKICAgICAgICAgICAgICAgICAgICBjb25zdCBbaDEsIG0xXSA9IHNsb3Quc3RhcnQuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBbaDIsIG0yXSA9IHNsb3QuZW5kLnNwbGl0KCc6JykubWFwKE51bWJlcik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSAoaDIgKiA2MCArIG0yKSAtIChoMSAqIDYwICsgbTEpOwogICAgICAgICAgICAgICAgICAgIGlmKGR1cmF0aW9uID4gMCkgdG90YWxNaW51dGVzICs9IGR1cmF0aW9uOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgY29uc3QgZ3JpZEhvdXJzID0gdG90YWxNaW51dGVzIC8gNjA7CiAgICAgICAgY29uc3QgdG90YWxQbGFubmVkID0gZ3JpZEhvdXJzICsgaW50ZXJuYXQ7CiAgICAgICAgY29uc3QgdGFyZ2V0ID0gYWdlbnQud2Vla2x5VGFyZ2V0OwogICAgICAgIGNvbnN0IGRpZmYgPSB0b3RhbFBsYW5uZWQgLSB0YXJnZXQ7CiAgICAgICAgCiAgICAgICAgZWwuaW5uZXJIVE1MID0gYENpYmxlOiAke3RhcmdldC50b0ZpeGVkKDIpfWggfCBQbGFuaWZpw6k6ICR7dG90YWxQbGFubmVkLnRvRml4ZWQoMil9aCA8c21hbGw+KGRvbnQgJHtpbnRlcm5hdH1oIEludC4pPC9zbWFsbD4gfCA8c3BhbiBzdHlsZT0iY29sb3I6JHtNYXRoLmFicyhkaWZmKSA8IDEgPyAnZ3JlZW4nIDogJ3JlZCd9Ij5EaWZmOiAke2RpZmYgPiAwID8gJysnIDogJyd9JHtkaWZmLnRvRml4ZWQoMil9aDwvc3Bhbj5gOwogICAgfQoKICAgIC8vIC0tLSBHRVNUSU9OIC0tLQogICAgZnVuY3Rpb24gYWRkQWRqdXN0bWVudCgpIHsKICAgICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FlZC1zZWxlY3QtZ2VzdGlvbicpLnZhbHVlOwogICAgICAgIGlmKCFuYW1lKSByZXR1cm4gYWxlcnQoIlPDqWxlY3Rpb25uZXogdW4gYWdlbnQiKTsKICAgICAgICBjb25zdCB0eXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Fkai10eXBlJykudmFsdWU7CiAgICAgICAgY29uc3QgYW10ID0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRqLWFtb3VudCcpLnZhbHVlKTsKICAgICAgICBjb25zdCByID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Fkai1yZWFzb24nKS52YWx1ZTsKICAgICAgICBpZighYW10IHx8ICFyKSByZXR1cm4gYWxlcnQoIkluZm9zIG1hbnF1YW50ZXMiKTsKICAgICAgICBpZighREFUQS5hZGp1c3RtZW50c1tuYW1lXSkgREFUQS5hZGp1c3RtZW50c1tuYW1lXSA9IFtdOwogICAgICAgIERBVEEuYWRqdXN0bWVudHNbbmFtZV0ucHVzaCh7aWQ6IERhdGUubm93KCksIGRhdGU6IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCksIHR5cGUsIGFtb3VudDogYW10LCByZWFzb246IHJ9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRqLWFtb3VudCcpLnZhbHVlID0gJyc7IAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGotcmVhc29uJykudmFsdWUgPSAnJzsKICAgICAgICBzYXZlTG9jYWxTdG9yYWdlKCk7IHVwZGF0ZUdlc3Rpb25VSSgpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGRhdGVHZXN0aW9uVUkoKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZWQtc2VsZWN0LWdlc3Rpb24nKS52YWx1ZTsKICAgICAgICBjb25zdCB0YiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoaXN0b3J5LWJvZHknKTsKICAgICAgICBjb25zdCBiYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFsYW5jZS1kaXNwbGF5Jyk7CiAgICAgICAgY29uc3QgdGFyZ2V0QmFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FubnVhbC10YXJnZXQtZGlzcGxheScpOwogICAgICAgIAogICAgICAgIHRiLmlubmVySFRNTCA9ICcnOyBiYWwuaW5uZXJUZXh0ID0gJzBoJzsgdGFyZ2V0QmFsLmlubmVyVGV4dCA9ICcwaCc7CiAgICAgICAgaWYoIW5hbWUpIHJldHVybjsKICAgICAgICAKICAgICAgICBjb25zdCBhZ2VudCA9IERBVEEuYWdlbnRzLmZpbmQoYSA9PiBhLm5hbWUgPT09IG5hbWUpOwogICAgICAgIGlmKGFnZW50ICYmIGFnZW50Lm5ldEFubnVhbCkgdGFyZ2V0QmFsLmlubmVyVGV4dCA9IGFnZW50Lm5ldEFubnVhbC50b0ZpeGVkKDEpICsgJ2gnOwoKICAgICAgICBsZXQgYiA9IDA7CiAgICAgICAgKERBVEEuYWRqdXN0bWVudHNbbmFtZV0gfHwgW10pLmZvckVhY2goKGEsIGkpID0+IHsKICAgICAgICAgICAgY29uc3QgcCA9IGEudHlwZSA9PT0gJ3BsdXMnOyBiICs9IHAgPyBhLmFtb3VudCA6IC1hLmFtb3VudDsKICAgICAgICAgICAgdGIuaW5uZXJIVE1MICs9IGA8dHI+PHRkPiR7YS5kYXRlfTwvdGQ+PHRkIHN0eWxlPSJjb2xvcjoke3AgPyAnZ3JlZW4nIDogJ3JlZCd9Ij4ke3AgPyAnKycgOiAnLSd9PC90ZD48dGQ+JHthLnJlYXNvbn08L3RkPjx0ZD4ke2EuYW1vdW50fWg8L3RkPjx0ZD48aSBjbGFzcz0iZmFzIGZhLXRyYXNoIiBvbmNsaWNrPSJkZWxBZGooJyR7bmFtZX0nLCR7aX0pIiBzdHlsZT0iY3Vyc29yOnBvaW50ZXIiPjwvaT48L3RkPjwvdHI+YDsKICAgICAgICB9KTsKICAgICAgICBiYWwuaW5uZXJUZXh0ID0gKGIgPiAwID8gJysnIDogJycpICsgYiArICdoJzsgCiAgICAgICAgYmFsLnN0eWxlLmNvbG9yID0gYiA+PSAwID8gJ3doaXRlJyA6ICcjZmFiMWEwJzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZGVsQWRqKG4sIGkpIHsgREFUQS5hZGp1c3RtZW50c1tuXS5zcGxpY2UoaSwgMSk7IHNhdmVMb2NhbFN0b3JhZ2UoKTsgdXBkYXRlR2VzdGlvblVJKCk7IH0KCjwvc2NyaXB0PgoKPHNjcmlwdD4Kd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7IHR5cGU6ICdwaWxvdGUtbW9kdWxlLXJlYWR5JywgbW9kdWxlOiAnYWVkJyB9LCAnKicpOwo8L3NjcmlwdD4KCgo8c2NyaXB0Pgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgewogICAgaWYgKCFlLmN0cmxLZXkgfHwgZS5zaGlmdEtleSB8fCBlLmFsdEtleSB8fCBlLm1ldGFLZXkpIHJldHVybjsKICAgIHZhciBrZXkgPSBlLmtleS50b0xvd2VyQ2FzZSgpOwogICAgaWYgKFsncCcsJ2UnLCdvJywnYScsJ2QnXS5pbmRleE9mKGtleSkgPj0gMCkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHt0eXBlOidwaWxvdGUtc2hvcnRjdXQnLCBrZXk6a2V5fSwgJyonKTsKICAgIH0KfSk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=", "bibase": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImZyIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+QnVsbGV0aW4gZCdpbmZvcm1hdGlvbjwvdGl0bGU+CiAgICA8IS0tIFRhaWx3aW5kIENTUyAtLT4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi50YWlsd2luZGNzcy5jb20iPjwvc2NyaXB0PgogICAgPCEtLSBIVE1MMlBERiAtLT4KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9odG1sMnBkZi5qcy8wLjEwLjEvaHRtbDJwZGYuYnVuZGxlLm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8IS0tIEV4cG9ydCBXb3JkIChodG1sLWRvY3gtanMpICYgRmlsZVNhdmVyIC0tPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vdW5wa2cuY29tL2h0bWwtZG9jeC1qcy9kaXN0L2h0bWwtZG9jeC5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvRmlsZVNhdmVyLmpzLzIuMC41L0ZpbGVTYXZlci5taW4uanMiPjwvc2NyaXB0PgoKICAgIDwhLS0gUXVpbGwgRWRpdG9yIChXWVNJV1lHKSAtLT4KICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vY2RuLnF1aWxsanMuY29tLzEuMy42L3F1aWxsLnNub3cuY3NzIiByZWw9InN0eWxlc2hlZXQiPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLnF1aWxsanMuY29tLzEuMy42L3F1aWxsLm1pbi5qcyI+PC9zY3JpcHQ+CiAgICAKICAgIDwhLS0gRm9udCAtLT4KICAgIDxzdHlsZT4KICAgICAgICAvKiBBcHRvcyBmb250IChuYXRpdmUpICovCiAgICAgICAgCiAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnQXB0b3MnLCAnQ2FsaWJyaScsICdUcmVidWNoZXQgTVMnLCBBcmlhbCwgc2Fucy1zZXJpZjsgfQogICAgICAgIAogICAgICAgIC8qIEZvbnQgQ2xhc3NlcyAqLwogICAgICAgIC5mb250LWludGVyIHsgZm9udC1mYW1pbHk6ICdBcHRvcycsICdDYWxpYnJpJywgJ1RyZWJ1Y2hldCBNUycsIEFyaWFsLCBzYW5zLXNlcmlmOyB9CiAgICAgICAgLmZvbnQtc2VyaWYgeyBmb250LWZhbWlseTogJ01lcnJpd2VhdGhlcicsIHNlcmlmOyB9CiAgICAgICAgLmZvbnQtbW9ubyB7IGZvbnQtZmFtaWx5OiAnUm9ib3RvIE1vbm8nLCBtb25vc3BhY2U7IH0KCiAgICAgICAgLyogU2Nyb2xsYmFyIGN1c3RvbWlzYXRpb24gKi8KICAgICAgICA6Oi13ZWJraXQtc2Nyb2xsYmFyIHsgd2lkdGg6IDZweDsgfQogICAgICAgIDo6LXdlYmtpdC1zY3JvbGxiYXItdHJhY2sgeyBiYWNrZ3JvdW5kOiAjZjFmNWY5OyB9CiAgICAgICAgOjotd2Via2l0LXNjcm9sbGJhci10aHVtYiB7IGJhY2tncm91bmQ6ICNjYmQ1ZTE7IGJvcmRlci1yYWRpdXM6IDNweDsgfQogICAgICAgIDo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWI6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjOTRhM2I4OyB9CgogICAgICAgIC8qIEE0IFBhcGVyIFN0eWxlIGZvciBQcmV2aWV3ICovCiAgICAgICAgLmE0LXBhZ2UgewogICAgICAgICAgICB3aWR0aDogMjEwbW07CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDI4MG1tOwogICAgICAgICAgICBwYWRkaW5nOiAxNW1tOwogICAgICAgICAgICBtYXJnaW46IDAgYXV0bzsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgMCAxNXB4IHJnYmEoMCwwLDAsMC4xKTsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBmb250LXNpemU6IDExcHQ7CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjQ7CiAgICAgICAgICAgIGNvbG9yOiAjMWYyOTM3OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgIH0KCiAgICAgICAgLnBkZi1mb290ZXItZml4ZWQgewogICAgICAgICAgICBtYXJnaW4tdG9wOiBhdXRvOwogICAgICAgICAgICBwYWRkaW5nLXRvcDogMTBweDsKICAgICAgICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlMmU4ZjA7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgZm9udC1zaXplOiA5cHg7CiAgICAgICAgICAgIGNvbG9yOiAjOTRhM2I4OwogICAgICAgIH0KCiAgICAgICAgLyogU3R5bGVzIHNww6ljaWZpcXVlcyBwb3VyIGxlIGNvbnRlbnUgcmljaGUgKFF1aWxsL0hUTUwpIGRhbnMgbGUgUERGIGV0IGxhIFNpZGViYXIgKi8KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgdWwgeyBsaXN0LXN0eWxlLXR5cGU6IGRpc2M7IG1hcmdpbi1sZWZ0OiAxLjVlbTsgbWFyZ2luLWJvdHRvbTogMC41ZW07IH0KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgb2wgeyBsaXN0LXN0eWxlLXR5cGU6IGRlY2ltYWw7IG1hcmdpbi1sZWZ0OiAxLjVlbTsgbWFyZ2luLWJvdHRvbTogMC41ZW07IH0KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgcCB7IG1hcmdpbi1ib3R0b206IDAuNWVtOyB9CiAgICAgICAgLnJpY2gtdGV4dC1jb250ZW50IHN0cm9uZyB7IGZvbnQtd2VpZ2h0OiA3MDA7IH0KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgZW0geyBmb250LXN0eWxlOiBpdGFsaWM7IH0KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgdSB7IHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOyB9CiAgICAgICAgCiAgICAgICAgLyogU3R5bGVzIHBvdXIgbGVzIHRhaWxsZXMgZGUgcG9saWNlIFF1aWxsIGRhbnMgbGUgUERGL0FwZXLDp3UgKi8KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgLnFsLXNpemUtc21hbGwgeyBmb250LXNpemU6IDAuNzVlbTsgfQogICAgICAgIC5yaWNoLXRleHQtY29udGVudCAucWwtc2l6ZS1sYXJnZSB7IGZvbnQtc2l6ZTogMS41ZW07IH0KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgLnFsLXNpemUtaHVnZSB7IGZvbnQtc2l6ZTogMi41ZW07IH0KICAgICAgICAKICAgICAgICAvKiBOZXR0b3lhZ2UgZGVzIG1hcmdlcyBkdSBkZXJuaWVyIMOpbMOpbWVudCBwb3VyIMOpdml0ZXIgbGVzIGVzcGFjZXMgdmlkZXMgKi8KICAgICAgICAucmljaC10ZXh0LWNvbnRlbnQgPiAqOmxhc3QtY2hpbGQgeyBtYXJnaW4tYm90dG9tOiAwOyB9CgogICAgICAgIC8qIFByaW50IHN0eWxlcyAqLwogICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgIGJvZHkgKiB7IHZpc2liaWxpdHk6IGhpZGRlbjsgfQogICAgICAgICAgICAjcGRmLXByZXZpZXctY29udGFpbmVyLCAjcGRmLXByZXZpZXctY29udGFpbmVyICogeyB2aXNpYmlsaXR5OiB2aXNpYmxlOyB9CiAgICAgICAgICAgICNwZGYtcHJldmlldy1jb250YWluZXIgeyBwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDA7IHRvcDogMDsgbWFyZ2luOiAwOyBib3gtc2hhZG93OiBub25lOyB9CiAgICAgICAgICAgIC5uby1wcmludCB7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsgfQogICAgICAgIH0KCiAgICAgICAgLmJpLWhlYWRlciB7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjMWQ0ZWQ4OwogICAgICAgICAgICBwYWRkaW5nLWJvdHRvbTogMTBweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogUXVpbGwgQ3VzdG9tIE92ZXJyaWRlcyB0byBtYXRjaCB0aGVtZSAqLwogICAgICAgIC5xbC10b29sYmFyLnFsLXNub3cgewogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjFmNWY5OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjhmYWZjOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAwLjc1cmVtIDAuNzVyZW0gMCAwOwogICAgICAgICAgICBwYWRkaW5nOiA4cHg7CiAgICAgICAgfQogICAgICAgIC5xbC1jb250YWluZXIucWwtc25vdyB7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMCAwIDAuNzVyZW0gMC43NXJlbTsKICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdBcHRvcycsICdDYWxpYnJpJywgJ1RyZWJ1Y2hldCBNUycsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICBmb250LXNpemU6IDAuODc1cmVtOyAvKiB0ZXh0LXNtICovCiAgICAgICAgfQogICAgICAgIC5xbC1lZGl0b3IgewogICAgICAgICAgICBtaW4taGVpZ2h0OiAxMjBweDsKICAgICAgICAgICAgbWF4LWhlaWdodDogMjUwcHg7IC8qIFBhcyBkJ2FncmFuZGlzc2VtZW50IGludXRpbGUgKi8KICAgICAgICAgICAgcGFkZGluZzogMTJweCAxNnB4OwogICAgICAgIH0KICAgICAgICAucWwtZWRpdG9yLnFsLWJsYW5rOjpiZWZvcmUgewogICAgICAgICAgICBmb250LXN0eWxlOiBub3JtYWw7CiAgICAgICAgICAgIGNvbG9yOiAjOTRhM2I4OwogICAgICAgICAgICBmb250LXNpemU6IDAuODc1cmVtOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBDb250YWluZXIgd3JhcHBlciBmb3IgUXVpbGwgYm9yZGVyICovCiAgICAgICAgLnF1aWxsLXdyYXBwZXIgewogICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAwLjc1cmVtOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4yczsKICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICAgICAgfQogICAgICAgIC5xdWlsbC13cmFwcGVyOmZvY3VzLXdpdGhpbiB7CiAgICAgICAgICAgIGJvcmRlci1jb2xvcjogI2ZiOTIzYzsgLyogb3JhbmdlLTQwMCAqLwogICAgICAgIH0KCiAgICAgICAgLyogQXV0byBzYXZlIGluZGljYXRvciBhbmltYXRpb24gKi8KICAgICAgICBAa2V5ZnJhbWVzIGZhZGUtaW4tb3V0IHsKICAgICAgICAgICAgMCUgeyBvcGFjaXR5OiAwOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoNXB4KTsgfQogICAgICAgICAgICAyMCUgeyBvcGFjaXR5OiAxOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7IH0KICAgICAgICAgICAgODAlIHsgb3BhY2l0eTogMTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9CiAgICAgICAgICAgIDEwMCUgeyBvcGFjaXR5OiAwOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTVweCk7IH0KICAgICAgICB9CiAgICAgICAgLnNhdmUtaW5kaWNhdG9yIHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWRlLWluLW91dCAycyBlYXNlLWluLW91dCBmb3J3YXJkczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogTGF5b3V0IHNwZWNpZmljIHN0eWxlcyAqLwogICAgICAgIC5sYXlvdXQtY2xhc3NpYyAuaGVhZGVyLWJsb2NrIHsgYm9yZGVyLWJvdHRvbS13aWR0aDogNHB4OyBwYWRkaW5nLWJvdHRvbTogMXJlbTsgbWFyZ2luLWJvdHRvbTogMnJlbTsgfQogICAgICAgIC5sYXlvdXQtbW9kZXJuIC5oZWFkZXItYmxvY2sgeyBib3JkZXItYm90dG9tLXdpZHRoOiAxcHg7IHBhZGRpbmctYm90dG9tOiAxLjVyZW07IG1hcmdpbi1ib3R0b206IDJyZW07IHRleHQtYWxpZ246IGNlbnRlcjsgfQogICAgICAgIC5sYXlvdXQtYmFubmVyIC5oZWFkZXItYmxvY2sgeyBtYXJnaW4tYm90dG9tOiAycmVtOyBib3JkZXItcmFkaXVzOiAwLjc1cmVtOyBvdmVyZmxvdzogaGlkZGVuOyBib3gtc2hhZG93OiAwIDRweCA2cHggLTFweCByZ2JhKDAsIDAsIDAsIDAuMSk7IH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHkgY2xhc3M9ImJnLXNsYXRlLTEwMCB0ZXh0LXNsYXRlLTkwMCBoLXNjcmVlbiBvdmVyZmxvdy1oaWRkZW4gZmxleCBmbGV4LWNvbCI+CgogICAgPCEtLSBJQ09OUyAtLT4KICAgIDxzdmcgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4KICAgICAgICA8c3ltYm9sIGlkPSJpY29uLXNldHRpbmdzIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEyLjIyIDJoLS40NGEyIDIgMCAwIDAtMiAydi4xOGEyIDIgMCAwIDEtMSAxLjczbC0uNDMuMjVhMiAyIDAgMCAxLTIgMGwtLjE1LS4wOGEyIDIgMCAwIDAtMi43My43M2wtLjIyLjM4YTIgMiAwIDAgMCAuNzMgMi43M2wuMTUuMWEyIDIgMCAwIDEgMSAxLjcydi41MWEyIDIgMCAwIDEtMSAxLjc0bC0uMTUuMDlhMiAyIDAgMCAwLS43MyAyLjczbC4yMi4zOGEyIDIgMCAwIDAgMi43My43M2wuMTUtLjA4YTIgMiAwIDAgMSAyIDBsLjQzLjI1YTIgMiAwIDAgMSAxIDEuNzNWMjBhMiAyIDAgMCAwIDIgMmguNDRhMiAyIDAgMCAwIDItMnYtLjE4YTIgMiAwIDAgMSAxLTEuNzNsLjQzLS4yNWEyIDIgMCAwIDEgMiAwbC4xNS4wOGEyIDIgMCAwIDAgMi43My0uNzNsLjIyLS4zOWEyIDIgMCAwIDAtLjczLTIuNzNsLS4xNS0uMDlhMiAyIDAgMCAxLTEtMS43NHYtLjQ3YTIgMiAwIDAgMSAxLTEuNzRsLjE1LS4wOWEyIDIgMCAwIDAgLjczLTIuNzNsLS4yMi0uMzlhMiAyIDAgMCAwLTIuNzMtLjczbC0uMTUuMDhhMiAyIDAgMCAxLTIgMGwtLjQzLS4yNWEyIDIgMCAwIDEtMS0xLjczVjRhMiAyIDAgMCAwLTItMnoiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIi8+PC9zeW1ib2w+CiAgICAgICAgPHN5bWJvbCBpZD0iaWNvbi10cmFzaCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwb2x5bGluZSBwb2ludHM9IjMgNiA1IDYgMjEgNiIvPjxwYXRoIGQ9Ik0xOSA2djE0YTIgMiAwIDAgMS0yIDJIN2EyIDIgMCAwIDEtMi0yVjZtMyAwVjRhMiAyIDAgMCAxIDItMmg0YTIgMiAwIDAgMSAyIDJ2MiIvPjxsaW5lIHgxPSIxMCIgeTE9IjExIiB4Mj0iMTAiIHkyPSIxNyIvPjxsaW5lIHgxPSIxNCIgeTE9IjExIiB4Mj0iMTQiIHkyPSIxNyIvPjwvc3ltYm9sPgogICAgICAgIDxzeW1ib2wgaWQ9Imljb24tZWRpdCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSA0SDRhMiAyIDAgMCAwLTIgMnYxNGEyIDIgMCAwIDAgMiAyaDE0YTIgMiAwIDAgMCAyLTJ2LTciLz48cGF0aCBkPSJNMTguNSAyLjVhMi4xMjEgMi4xMjEgMCAwIDEgMyAzTDEyIDE1bC00IDEgMS00IDkuNS05LjV6Ii8+PC9zeW1ib2w+CiAgICAgICAgPHN5bWJvbCBpZD0iaWNvbi1kb3dubG9hZCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0yMSAxNXY0YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0ydi00Ii8+PHBvbHlsaW5lIHBvaW50cz0iNyAxMCAxMiAxNSAxNyAxMCIvPjxsaW5lIHgxPSIxMiIgeTE9IjE1IiB4Mj0iMTIiIHkyPSIzIi8+PC9zeW1ib2w+CiAgICAgICAgPHN5bWJvbCBpZD0iaWNvbi1hcnJvdy11cCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxsaW5lIHgxPSIxMiIgeTE9IjE5IiB4Mj0iMTIiIHkyPSI1Ij48L2xpbmU+PHBvbHlsaW5lIHBvaW50cz0iNSAxMiAxMiA1IDE5IDEyIj48L3BvbHlsaW5lPjwvc3ltYm9sPgogICAgICAgIDxzeW1ib2wgaWQ9Imljb24tYXJyb3ctZG93biIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxsaW5lIHgxPSIxMiIgeTE9IjUiIHgyPSIxMiIgeTI9IjE5Ij48L2xpbmU+PHBvbHlsaW5lIHBvaW50cz0iMTkgMTIgMTIgMTkgNSAxMiI+PC9wb2x5bGluZT48L3N5bWJvbD4KICAgICAgICA8c3ltYm9sIGlkPSJpY29uLWxpc3QiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48bGluZSB4MT0iOCIgeTE9IjYiIHgyPSIyMSIgeTI9IjYiPjwvbGluZT48bGluZSB4MT0iOCIgeTE9IjEyIiB4Mj0iMjEiIHkyPSIxMiI+PC9saW5lPjxsaW5lIHgxPSI4IiB5MT0iMTgiIHgyPSIyMSIgeTI9IjE4Ij48L2xpbmU+PGxpbmUgeDE9IjMiIHkxPSI2IiB4Mj0iMy4wMSIgeTI9IjYiPjwvbGluZT48bGluZSB4MT0iMyIgeTE9IjEyIiB4Mj0iMy4wMSIgeTI9IjEyIj48L2xpbmU+PGxpbmUgeDE9IjMiIHkxPSIxOCIgeDI9IjMuMDEiIHkyPSIxOCI+PC9saW5lPjwvc3ltYm9sPgogICAgICAgIDxzeW1ib2wgaWQ9Imljb24td29yZCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xNCAySDZhMiAyIDAgMCAwLTIgMnYxNmEyIDIgMCAwIDAgMiAyaDEyYTIgMiAwIDAgMCAyLTJWOHoiPjwvcGF0aD48cG9seWxpbmUgcG9pbnRzPSIxNCAyIDE0IDggMjAgOCI+PC9wb2x5bGluZT48bGluZSB4MT0iMTYiIHkxPSIxMyIgeDI9IjgiIHkyPSIxMyI+PC9saW5lPjxsaW5lIHgxPSIxNiIgeTE9IjE3IiB4Mj0iOCIgeTI9IjE3Ij48L2xpbmU+PHBvbHlsaW5lIHBvaW50cz0iMTAgOSA5IDkgOCA5Ij48L3BvbHlsaW5lPjwvc3ltYm9sPgogICAgICAgIDxzeW1ib2wgaWQ9Imljb24tc2VhcmNoIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTEiIGN5PSIxMSIgcj0iOCI+PC9jaXJjbGU+PGxpbmUgeDE9IjIxIiB5MT0iMjEiIHgyPSIxNi42NSIgeTI9IjE2LjY1Ij48L2xpbmU+PC9zeW1ib2w+CiAgICAgICAgPHN5bWJvbCBpZD0iaWNvbi1jb3B5IiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHJlY3QgeD0iOSIgeT0iOSIgd2lkdGg9IjEzIiBoZWlnaHQ9IjEzIiByeD0iMiIgcnk9IjIiPjwvcmVjdD48cGF0aCBkPSJNNSAxNUg0YTIgMiAwIDAgMS0yLTJWNGEyIDIgMCAwIDEgMi0yaDlhMiAyIDAgMCAxIDIgMnYxIj48L3BhdGg+PC9zeW1ib2w+CiAgICA8L3N2Zz4KCiAgICA8IS0tIEhFQURFUiAtLT4KICAgIAoKICAgIDwhLS0gQ09OVEVOVCAtLT4KICAgIDxtYWluIGlkPSJjb250ZW50LWFyZWEiIGNsYXNzPSJmbGV4LTEgb3ZlcmZsb3ctaGlkZGVuIHJlbGF0aXZlIHctZnVsbCBmbGV4IGZsZXgtY29sIj4KICAgICAgICAKICAgICAgICA8ZGl2IGlkPSJ2aWV3LWJ1bGxldGluIiBjbGFzcz0iZmxleC0xIGZsZXggb3ZlcmZsb3ctaGlkZGVuIj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDwhLS0gU2lkZWJhcjogQXJjaGl2ZXMgLS0+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InctNzIgZmxleCBmbGV4LWNvbCBmbGV4LXNocmluay0wIHotMTAgc2hhZG93LXNtIGhpZGRlbiBtZDpmbGV4IiBzdHlsZT0iYmFja2dyb3VuZDojMmMzZTUwO2NvbG9yOiNlY2YwZjEiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IHNwYWNlLXktMyIgc3R5bGU9ImJvcmRlci1ib3R0b206MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEpIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImNyZWF0ZU5ld0J1bGxldGluKCkiIGNsYXNzPSJ3LWZ1bGwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIgdGV4dC13aGl0ZSBweS0zIHJvdW5kZWQteGwgZm9udC1ib2xkIHRyYW5zaXRpb24tYWxsIiBzdHlsZT0iYmFja2dyb3VuZDpyZ2JhKDI1NSwyNTUsMjU1LC4xNSk7Ym9yZGVyOjFweCBkYXNoZWQgcmdiYSgyNTUsMjU1LDI1NSwuNCkiPgogICAgICAgICAgICAgICAgICAgICAgICDinKggTm91dmVhdSBCdWxsZXRpbgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwhLS0gU2VhcmNoIEJhciAoVjMpIC0tPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0iYWJzb2x1dGUgbGVmdC0zIHRvcC0yLjUgdy00IGgtNCIgc3R5bGU9ImNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjUpIj48dXNlIGhyZWY9IiNpY29uLXNlYXJjaCI+PC91c2U+PC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ic2VhcmNoLWJ1bGxldGluIiBvbmlucHV0PSJyZW5kZXJCdWxsZXRpbkxpc3QoKSIgcGxhY2Vob2xkZXI9IlJlY2hlcmNoZXIgKE7CsC4uLikiIGNsYXNzPSJ3LWZ1bGwgcGwtOSBwci0zIHB5LTIgcm91bmRlZC1sZyB0ZXh0LXNtIGZvY3VzOm91dGxpbmUtbm9uZSB0cmFuc2l0aW9uLWNvbG9ycyIgc3R5bGU9ImJhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwuMTIpO2JvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTUpO2NvbG9yOiNmZmYiPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEgb3ZlcmZsb3cteS1hdXRvIHAtMyBzcGFjZS15LTIiIGlkPSJidWxsZXRpbi1saXN0Ij4KICAgICAgICAgICAgICAgICAgICA8IS0tIExpc3QgaXRlbXMgZ2VuZXJhdGVkIGJ5IEpTIC0tPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPCEtLSBFZGl0b3IgLS0+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtMSBmbGV4IGZsZXgtY29sIGJnLXNsYXRlLTUwIG92ZXJmbG93LWhpZGRlbiByZWxhdGl2ZSI+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEgb3ZlcmZsb3cteS1hdXRvIHAtNiI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWF4LXctNnhsIG14LWF1dG8gZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNiBoLWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBMZWZ0OiBGb3JtIC0tPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTYgb3ZlcmZsb3cteS1hdXRvIHBiLTIwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUgcC02IHJvdW5kZWQtMnhsIGJvcmRlciBib3JkZXItc2xhdGUtMjAwIHNoYWRvdy1zbSBob3ZlcjpzaGFkb3ctbWQgdHJhbnNpdGlvbi1zaGFkb3cgcmVsYXRpdmUiIGlkPSJmb3JtLWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJmb3JtLXRpdGxlIj5TYWlzaXIgdW5lIGluZm88L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJibG9jayB0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTQwMCB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXIgbWItMSI+Q2F0w6lnb3JpZTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJpdGVtLWNhdGVnb3J5IiBjbGFzcz0iZmxleC0xIHB4LTQgcHktMi41IGJvcmRlci0yIGJvcmRlci1zbGF0ZS0xMDAgcm91bmRlZC14bCB0ZXh0LXNtIGZvbnQtbWVkaXVtIGJnLXNsYXRlLTUwIGZvY3VzOmJnLXdoaXRlIGZvY3VzOmJvcmRlci1vcmFuZ2UtNDAwIG91dGxpbmUtbm9uZSB0cmFuc2l0aW9uLWFsbCBjdXJzb3ItcG9pbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gRHluYW1pYyBDYXRlZ29yaWVzIC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0ib3BlbkNhdGVnb3J5TWFuYWdlcigpIiBjbGFzcz0icHgtMyBiZy1zbGF0ZS0xMDAgdGV4dC1zbGF0ZS02MDAgcm91bmRlZC14bCBob3ZlcjpiZy1zbGF0ZS0yMDAgdHJhbnNpdGlvbi1jb2xvcnMgZm9udC1ib2xkIiB0aXRsZT0iR8OpcmVyIHRvdXRlcyBsZXMgY2F0w6lnb3JpZXMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJ3LTUgaC01Ij48dXNlIGhyZWY9IiNpY29uLWxpc3QiPjwvdXNlPjwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0iYWRkQ3VzdG9tQ2F0ZWdvcnkoKSIgY2xhc3M9InB4LTQgYmctc2xhdGUtMTAwIHRleHQtc2xhdGUtNjAwIHJvdW5kZWQteGwgaG92ZXI6Ymctc2xhdGUtMjAwIHRyYW5zaXRpb24tY29sb3JzIGZvbnQtYm9sZCB0ZXh0LWxnIiB0aXRsZT0iQ3LDqWVyIHVuZSBub3V2ZWxsZSBjYXTDqWdvcmllIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBnYXAtMyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xLzMgZmxleCBmbGV4LWNvbCBnYXAtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBnYXAtMiB0ZXh0LVsxMHB4XSB1cHBlcmNhc2UgZm9udC1ib2xkIHRleHQtc2xhdGUtNDAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSBjdXJzb3ItcG9pbnRlciI+PGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJkYXRlLXR5cGUiIHZhbHVlPSJmaXhlZCIgY2hlY2tlZCBvbmNoYW5nZT0idG9nZ2xlRGF0ZUlucHV0KCkiPiBGaXhlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSBjdXJzb3ItcG9pbnRlciI+PGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJkYXRlLXR5cGUiIHZhbHVlPSJ2YXJpYWJsZSIgb25jaGFuZ2U9InRvZ2dsZURhdGVJbnB1dCgpIj4gTGlicmU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBpZD0iaXRlbS1kYXRlLWZpeGVkIiBjbGFzcz0idy1mdWxsIHB4LTQgcHktMi41IGJvcmRlci0yIGJvcmRlci15ZWxsb3ctMTAwIGJnLXllbGxvdy01MCByb3VuZGVkLXhsIHRleHQtc20gZm9udC1ib2xkIHRleHQteWVsbG93LTgwMCBmb2N1czpib3JkZXIteWVsbG93LTQwMCBvdXRsaW5lLW5vbmUgdHJhbnNpdGlvbi1jb2xvcnMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iaXRlbS1kYXRlLXZhcmlhYmxlIiBjbGFzcz0idy1mdWxsIHB4LTQgcHktMi41IGJvcmRlci0yIGJvcmRlci15ZWxsb3ctMTAwIGJnLXllbGxvdy01MCByb3VuZGVkLXhsIHRleHQtc20gZm9udC1ib2xkIHRleHQteWVsbG93LTgwMCBmb2N1czpib3JkZXIteWVsbG93LTQwMCBvdXRsaW5lLW5vbmUgdHJhbnNpdGlvbi1jb2xvcnMgaGlkZGVuIiBwbGFjZWhvbGRlcj0iRXg6IFRvdXRlIGxhIHNlbWFpbmUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctMi8zIGZsZXggZmxleC1jb2wganVzdGlmeS1lbmQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iaXRlbS10aXRsZSIgbGlzdD0idGl0bGUtc3VnZ2VzdGlvbnMiIGNsYXNzPSJ3LWZ1bGwgcHgtNCBweS0yLjUgYm9yZGVyLTIgYm9yZGVyLXNsYXRlLTEwMCByb3VuZGVkLXhsIHRleHQtc20gZm9udC1ib2xkIGZvY3VzOmJvcmRlci1vcmFuZ2UtNDAwIG91dGxpbmUtbm9uZSB0cmFuc2l0aW9uLWNvbG9ycyIgcGxhY2Vob2xkZXI9IlRpdHJlIG91IGNob2lzaXIuLi4iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkYXRhbGlzdCBpZD0idGl0bGUtc3VnZ2VzdGlvbnMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBY2N1ZWlsIMOpbGFyZ2kiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBZmZlY3RhdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFTU1IgMTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBVVRSRSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkJhc3NpbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkNBIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQ0VDIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQ0VTQ0UiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJDaG9peCBkJ29yaWVudGF0aW9uIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQ2l0w6kgw6lkdWNhdGl2ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkNvbW1pc3Npb24gw6lkdWNhdGl2ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkNvbW1pc3Npb24gcGVybWFuZW50ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkNvbnNlaWwgZGUgZGlzY2lwbGluZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkNvbnNlaWwgZCdlbnNlaWduZW1lbnQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJDb25zZWlsIHDDqWRhZ29naXF1ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkNvbnNlaWxzIGRlIGNsYXNzZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkRGIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iREdIIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRWR1Y0Ryb2l0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRWR1Y0ZpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iw4lxdWlwZSDDqWR1Y2F0aXZlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRVNTIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iw4l2YWx1YXRpb24gRVBMRSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IsOJdmFsdWF0aW9ucyBuYXRpb25hbGVzIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iRXZhbGFuZyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkV4YW1lbnMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJFeGFtZW5zIGJsYW5jcyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkxpYWlzb25zIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iTkFIIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iTnVtw6lyaXF1ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlBJWCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlBQTVMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJQUE8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJQcm9qZXQgZCfDqXRhYmxpc3NlbWVudCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlByb2pldHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJSZW50csOpZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlJJIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iU0MzQyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlNvcnRpZSBzY29sYWlyZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlN0YWdlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iVU5TUyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlZTIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2RhdGFsaXN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gV1lTSVdZRyBFRElUT1IgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InF1aWxsLXdyYXBwZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0icXVpbGwtZWRpdG9yIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGdhcC0zIHB0LTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iYnRuLWFkZC11cGRhdGUiIG9uY2xpY2s9ImFkZEJ1bGxldGluSXRlbSgpIiBjbGFzcz0iZmxleC0xIHB5LTMgYmctb3JhbmdlLTUwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCByb3VuZGVkLXhsIGhvdmVyOmJnLW9yYW5nZS02MDAgYWN0aXZlOnNjYWxlLTk1IHRyYW5zaXRpb24tYWxsIHNoYWRvdy1tZCBzaGFkb3ctb3JhbmdlLTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWpvdXRlciBsJ2luZm8g8J+agAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJidG4tY2FuY2VsLWVkaXQiIG9uY2xpY2s9ImNhbmNlbEVkaXQoKSIgY2xhc3M9ImhpZGRlbiBweC01IHB5LTMgYmctc2xhdGUtMTAwIHRleHQtc2xhdGUtNTAwIGZvbnQtYm9sZCByb3VuZGVkLXhsIGhvdmVyOmJnLXNsYXRlLTIwMCB0cmFuc2l0aW9uLWNvbG9ycyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5udWxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBHcm91cGVkIExpc3QgaW4gRWRpdG9yIC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS02IiBpZD0iZWRpdG9yLWl0ZW1zLWxpc3QiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gRHluYW1pYyBMaXN0IC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBSaWdodDogUHJldmlldyAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBvdmVyZmxvdy1oaWRkZW4gYmctc2xhdGUtMjAwIHJvdW5kZWQtMnhsIGJvcmRlci00IGJvcmRlci1zbGF0ZS0zMDAgc2hhZG93LWlubmVyIHAtNCBpdGVtcy1zdGFydCBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvcmlnaW4tdG9wIHRyYW5zZm9ybS1ncHUgc2hhZG93LTJ4bCIgaWQ9InByZXZpZXctd3JhcHBlciIgc3R5bGU9InRyYW5zZm9ybTpzY2FsZSgwLjU1KSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0icGRmLWNvbnRlbnQiIGNsYXNzPSJhNC1wYWdlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBSZW5kZXJlZCBDb250ZW50IC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPCEtLSBIRUxQIC0tPgogICAgICAgIDxkaXYgaWQ9InZpZXctaGVscCIgY2xhc3M9ImhpZGRlbiBmbGV4LTEgb3ZlcmZsb3cteS1hdXRvIHAtOCBiZy1zbGF0ZS01MCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1heC13LTR4bCBteC1hdXRvIHByb3NlIGJnLXdoaXRlIHAtMTAgcm91bmRlZC0zeGwgc2hhZG93LXhsIGJvcmRlciBib3JkZXItc2xhdGUtMTAwIj4KICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ibGFjayB0ZXh0LXNsYXRlLTgwMCBtYi02IGZsZXggaXRlbXMtY2VudGVyIGdhcC0zIj4KICAgICAgICAgICAgICAgICAgICDwn5OaIE1vZGUgZCdlbXBsb2kgJiBFbmpldXgKICAgICAgICAgICAgICAgIDwvaDI+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDwhLS0gU2VjdGlvbiBFbmpldSAtLT4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1iLTEwIj4KICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHRleHQtYmx1ZS04MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LTJ4bCI+8J+Orzwvc3Bhbj4gTCdFbmpldSBkZSBQRVJESVJGT1JNQU5DRSBCaSBCYXNlCiAgICAgICAgICAgICAgICAgICAgPC9oMz4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ibHVlLTUwIGJvcmRlci1sLTQgYm9yZGVyLWJsdWUtNTAwIHAtNSByb3VuZGVkLXIteGwgdGV4dC1zbGF0ZS03MDAgc3BhY2UteS0zIHRleHQtc20gbGVhZGluZy1yZWxheGVkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz5Db21tdW5pcXVlciBlZmZpY2FjZW1lbnQgOjwvc3Ryb25nPiBEYW5zIHVuIMOpdGFibGlzc2VtZW50IHNjb2xhaXJlLCBsJ2luZm9ybWF0aW9uIGVzdCBkZW5zZSBldCBtdWx0aXNvdXJjZS4gQ2UgYnVsbGV0aW4gcGVybWV0IGRlIGNlbnRyYWxpc2VyIGxlcyBpbmZvcm1hdGlvbnMgZXNzZW50aWVsbGVzIGRlIGxhIHNlbWFpbmUgZW4gdW4gZG9jdW1lbnQgdW5pcXVlLCBjbGFpciBldCBzdHJ1Y3R1csOpLjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz5Qcm9mZXNzaW9ubmFsaXNlciBsJ2ltYWdlIDo8L3N0cm9uZz4gVW4gZG9jdW1lbnQgc3RhbmRhcmRpc8OpLCBhdXggY291bGV1cnMgZGUgbCfDqXRhYmxpc3NlbWVudCAobG9nbywgc2lnbmF0dXJlKSwgcmVuZm9yY2UgbCdpZGVudGl0w6kgdmlzdWVsbGUgZXQgbGEgY3LDqWRpYmlsaXTDqSBkZSBsYSBkaXJlY3Rpb24uPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPkdhZ25lciBkdSB0ZW1wcyA6PC9zdHJvbmc+IEZpbmkgbGEgbWlzZSBlbiBwYWdlIGZhc3RpZGlldXNlIHN1ciB0cmFpdGVtZW50IGRlIHRleHRlLiBTYWlzaXNzZXosIGNhdMOpZ29yaXNleiwgZXQgbGUgUERGIHNlIGfDqW7DqHJlIGF1dG9tYXRpcXVlbWVudC48L3A+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8IS0tIFNlY3Rpb24gTW9kZSBkJ2VtcGxvaSAtLT4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LW9yYW5nZS03MDAgbWItNiBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LTJ4bCI+8J+agDwvc3Bhbj4gR3VpZGUgZGUgZMOpbWFycmFnZSByYXBpZGUKICAgICAgICAgICAgICAgICAgICA8L2gzPgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTYiPgogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIMOJdGFwZSAxIC0tPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1zbGF0ZS01MCBwLTUgcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci1zbGF0ZS0xMDAgc2hhZG93LXNtIGhvdmVyOnNoYWRvdy1tZCB0cmFuc2l0aW9uLXNoYWRvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb250LWJsYWNrIHRleHQtc2xhdGUtODAwIHRleHQtbGcgbWItMiI+MS4gSWRlbnRpdMOpIPCfj6I8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtc2xhdGUtNjAwIj5DbGlxdWV6IHN1ciA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIj5QYXJhbcOodHJlcyAo4pqZ77iPKTwvc3Bhbj4gZW4gaGF1dCDDoCBkcm9pdGUgcG91ciBlbnRyZXIgbGUgbm9tIGRlIHZvdHJlIMOpdGFibGlzc2VtZW50IGV0IGFqb3V0ZXIgdm90cmUgbG9nby48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSDDiXRhcGUgMiAtLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctc2xhdGUtNTAgcC01IHJvdW5kZWQtMnhsIGJvcmRlciBib3JkZXItc2xhdGUtMTAwIHNoYWRvdy1zbSBob3ZlcjpzaGFkb3ctbWQgdHJhbnNpdGlvbi1zaGFkb3ciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1ibGFjayB0ZXh0LXNsYXRlLTgwMCB0ZXh0LWxnIG1iLTIiPjIuIFBhcmFtw6l0cmV6IPCfk4U8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtc2xhdGUtNjAwIj5Ew6lmaW5pc3NleiBsZSBudW3DqXJvIGR1IGJ1bGxldGluLCBsYSBww6lyaW9kZSAoc2VtYWluZSkgZXQgY2hvaXNpc3NleiBsZSBzaWduYXRhaXJlIG9mZmljaWVsIGRhbnMgbGUgYmxvYyAiUGFyYW3DqHRyZXMiLjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICA8IS0tIMOJdGFwZSAzIC0tPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1zbGF0ZS01MCBwLTUgcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci1zbGF0ZS0xMDAgc2hhZG93LXNtIGhvdmVyOnNoYWRvdy1tZCB0cmFuc2l0aW9uLXNoYWRvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb250LWJsYWNrIHRleHQtc2xhdGUtODAwIHRleHQtbGcgbWItMiI+My4gU2Fpc2lzc2V6IOKcje+4jzwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1zbGF0ZS02MDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlbXBsaXNzZXogbGUgZm9ybXVsYWlyZS4gVXRpbGlzZXogbGVzIG91dGlscyBkZSBsJ8OpZGl0ZXVyIChHcmFzLCBMaXN0ZXMpIHBvdXIgbWV0dHJlIGVuIGZvcm1lIHZvdHJlIHRleHRlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0gw4l0YXBlIDQgLS0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXNsYXRlLTUwIHAtNSByb3VuZGVkLTJ4bCBib3JkZXIgYm9yZGVyLXNsYXRlLTEwMCBzaGFkb3ctc20gaG92ZXI6c2hhZG93LW1kIHRyYW5zaXRpb24tc2hhZG93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvbnQtYmxhY2sgdGV4dC1zbGF0ZS04MDAgdGV4dC1sZyBtYi0yIj40LiBPcmdhbmlzZXog4oaV77iPPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSB0ZXh0LXNsYXRlLTYwMCI+VXRpbGlzZXogbGVzIGZsw6hjaGVzIHN1ciBsZXMgdGl0cmVzIGRlIGNhdMOpZ29yaWVzIHBvdXIgY2hhbmdlciBsJ29yZHJlIGQnYXBwYXJpdGlvbiBkYW5zIGxlIFBERi48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPCEtLSBTZWN0aW9uIE5vdXZlYXV0w6kgVjMuMCAtLT4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTEwIHB0LTggYm9yZGVyLXQgYm9yZGVyLXNsYXRlLTEwMCI+CiAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LWluZGlnby03MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LTJ4bCI+4pyoPC9zcGFuPiBOb3V2ZWF1dMOpcyBWMy4wIDogUHJvZHVjdGl2aXTDqSBNYXhpbWFsZQogICAgICAgICAgICAgICAgICAgIDwvaDM+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTUwIGJvcmRlci1sLTQgYm9yZGVyLWluZGlnby01MDAgcC01IHJvdW5kZWQtci14bCB0ZXh0LXNsYXRlLTcwMCBzcGFjZS15LTQgdGV4dC1zbSBsZWFkaW5nLXJlbGF4ZWQiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0iZm9udC1ib2xkIHRleHQtaW5kaWdvLTkwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+4pqhIER1cGxpY2F0aW9uIGRlIEJ1bGxldGluPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD5Wb3VzIHNvdWhhaXRleiByZXByZW5kcmUgbGEgYmFzZSBkZSBsYSBzZW1haW5lIGRlcm5pw6hyZSA/IERhbnMgbGEgbGlzdGUgZGUgZ2F1Y2hlLCBjbGlxdWV6IHN1ciBsZSBib3V0b24gIkNvcGllciIgKGRvdWJsZSBjYXJyw6kpLiBVbiBub3V2ZWF1IGJ1bGxldGluIHNlcmEgY3LDqcOpIGF2ZWMgdG91dCBsZSBjb250ZW51LCBldCBsZSBudW3DqXJvIHNlcmEgYXV0b21hdGlxdWVtZW50IGluY3LDqW1lbnTDqSAhPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LWluZGlnby05MDAgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPvCflI0gUmVjaGVyY2hlIEluc3RhbnRhbsOpZTwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+UmV0cm91dmV6IGZhY2lsZW1lbnQgdW4gYW5jaWVuIG51bcOpcm8gZ3LDomNlIMOgIGxhIG5vdXZlbGxlIGJhcnJlIGRlIHJlY2hlcmNoZSBzaXR1w6llIGVuIGhhdXQgZGUgbGEgbGlzdGUgZGVzIGJ1bGxldGlucy48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0iZm9udC1ib2xkIHRleHQtaW5kaWdvLTkwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+8J+ThCBFeHBvcnQgV29yZCAoLmRvY3gpPC9oND4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD5JbnRyb2R1aXQgZW4gVjIuNywgbCdleHBvcnQgV29yZCBwZXJtZXQgZGUgcmV0b3VjaGVyIGxlIGRvY3VtZW50IGZpbmFsIHNpIG7DqWNlc3NhaXJlIGF2YW50IGwnZW52b2kuPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICA8L21haW4+CgogICAgPCEtLSBGT09URVIgLS0+CiAgICA8Zm9vdGVyIGNsYXNzPSJiZy13aGl0ZSBib3JkZXItdCBib3JkZXItc2xhdGUtMjAwIHB5LTIgdGV4dC1jZW50ZXIgdGV4dC1bMTBweF0gdGV4dC1zbGF0ZS00MDAgZmxleC1zaHJpbmstMCB6LTIwIj4KICAgICAgICBPdXRpbCBwcm9wb3PDqSBwYXIgWWFubmlzIENIUklTVE9OIHwgVXRpbGlzYXRpb24gbG9jYWxlLCBSR1BELgogICAgPC9mb290ZXI+CgogICAgPCEtLSBTRVRUSU5HUyBNT0RBTCAtLT4KICAgIAogICAgCiAgICA8IS0tIENBVEVHT1JZIE1BTkFHRVIgTU9EQUwgLS0+CiAgICA8ZGl2IGlkPSJtb2RhbC1jYXRlZ29yaWVzIiBjbGFzcz0iZml4ZWQgaW5zZXQtMCB6LTUwIGhpZGRlbiBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgPGRpdiBjbGFzcz0iYWJzb2x1dGUgaW5zZXQtMCBiZy1zbGF0ZS05MDAvNTAgYmFja2Ryb3AtYmx1ci1zbSIgb25jbGljaz0iY2xvc2VDYXRlZ29yeU1hbmFnZXIoKSI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUgcm91bmRlZC0yeGwgc2hhZG93LTJ4bCB3LWZ1bGwgbWF4LXctbWQgbXgtNCByZWxhdGl2ZSB6LTEwIHAtMCB0cmFuc2Zvcm0gdHJhbnNpdGlvbi1hbGwgc2NhbGUtMTAwIG92ZXJmbG93LWhpZGRlbiBmbGV4IGZsZXgtY29sIG1heC1oLXNjcmVlbiI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNiBib3JkZXItYiBib3JkZXItc2xhdGUtMTAwIGJnLXNsYXRlLTUwIj4KICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC14bCBmb250LWJsYWNrIHRleHQtc2xhdGUtODAwIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICDwn5OLIE9yZHJlIGRlcyBjYXTDqWdvcmllcwogICAgICAgICAgICAgICAgPC9oMz4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtc2xhdGUtNTAwIG10LTEiPk1vZGlmaWV6IGwnb3JkcmUgZCdhZmZpY2hhZ2UgZGFucyBsZSBQREYuPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im92ZXJmbG93LXktYXV0byBwLTQgc3BhY2UteS0yIGZsZXgtMSIgaWQ9ImNhdGVnb3J5LW1hbmFnZXItbGlzdCI+CiAgICAgICAgICAgICAgICA8IS0tIExpc3Qgd2lsbCBiZSBoZXJlIC0tPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNCBib3JkZXItdCBib3JkZXItc2xhdGUtMTAwIGJnLXNsYXRlLTUwIGZsZXgganVzdGlmeS1lbmQiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJjbG9zZUNhdGVnb3J5TWFuYWdlcigpIiBjbGFzcz0icHgtNiBweS0yIGJnLWJsdWUtNjAwIHRleHQtd2hpdGUgcm91bmRlZC14bCBmb250LWJvbGQgaG92ZXI6YmctYmx1ZS03MDAgdHJhbnNpdGlvbi1jb2xvcnMiPkZlcm1lcjwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDwhLS0gSkFWQVNDUklQVCAtLT4KICAgIDxzY3JpcHQ+CiAgICAgICAgLy8gLS0tIERBVEEgU1RBVEUgLS0tCiAgICAgICAgLy8gRW5oYW5jZWQgRXN0YWJsaXNobWVudCBPYmplY3Qgd2l0aCBMYXlvdXQsIEZvbnQgYW5kIEN1c3RvbSBUZXh0cwogICAgICAgIGxldCBlc3RhYmxpc2htZW50ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYmliYXNlX2VzdGFibGlzaG1lbnQnKSkgfHwgewogICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgYWRkcmVzczogIiIsCiAgICAgICAgICAgIGxvZ286ICIiLAogICAgICAgICAgICBsYXlvdXQ6ICJjbGFzc2ljIiwgLy8gY2xhc3NpYywgbW9kZXJuLCBiYW5uZXIKICAgICAgICAgICAgZm9udDogImludGVyIiwgLy8gaW50ZXIsIHNlcmlmLCBtb25vCiAgICAgICAgICAgIGRlZmF1bHRTaWduYXRvcnk6ICJMJ8OpcXVpcGUgZGUgZGlyZWN0aW9uIiwKICAgICAgICAgICAgZG9jVGl0bGU6ICJCdWxsZXRpbiBkJ2luZm9ybWF0aW9uIiwKICAgICAgICAgICAgZG9jRm9vdGVyOiAiIiAvLyBDdXN0b20gZm9vdGVyIHRleHQKICAgICAgICB9OwoKICAgICAgICBsZXQgYnVsbGV0aW5zID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYmliYXNlX2J1bGxldGlucycpKSB8fCBbXTsKICAgICAgICAKICAgICAgICAvLyBEZWZhdWx0IENhdGVnb3JpZXMKICAgICAgICBjb25zdCBERUZBVUxUX0NBVEVHT1JJRVMgPSBbCiAgICAgICAgICAgICLwn5OFIEFHRU5EQSIsIAogICAgICAgICAgICAi8J+PqyBWSUUgREUgTCfDiVRBQkxJU1NFTUVOVCIsIAogICAgICAgICAgICAi8J+knSBBTUlDQUxFIiwgCiAgICAgICAgICAgICLwn5GlIFBFUlNPTk5FTCIsIAogICAgICAgICAgICAi8J+TmiBQw4lEQUdPR0lFIiwgCiAgICAgICAgICAgICLwn46SIFZJRSBTQ09MQUlSRSIsIAogICAgICAgICAgICAi8J+nrSBPUklFTlRBVElPTiIsIAogICAgICAgICAgICAi4pm/IEVCRVAiLAogICAgICAgICAgICAi8J+OqCDDiURVQ0FUSUYiLAogICAgICAgICAgICAi8J+SuyBOVU3DiVJJUVVFIiwKICAgICAgICAgICAgIvCfkrwgSU5URU5EQU5DRSIsIAogICAgICAgICAgICAi8J+PpSBTQU5Uw4kgLyBTT0NJQUwiLCAKICAgICAgICAgICAgIvCfjpMgRVhBTUVOUyIsIAogICAgICAgICAgICAi8J+TnCBCVUxMRVRJTiBPRkZJQ0lFTCIsIAogICAgICAgICAgICAi4pqW77iPIEJPIiwKICAgICAgICAgICAgIvCfkqEgQVVUUkUiCiAgICAgICAgXTsKICAgICAgICAKICAgICAgICAvLyBNYXN0ZXIgY2F0ZWdvcnkgbGlzdAogICAgICAgIGxldCBtYXN0ZXJDYXRlZ29yaWVzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYmliYXNlX2NhdGVnb3JpZXNfbWFzdGVyJykpOwoKICAgICAgICBpZiAoIW1hc3RlckNhdGVnb3JpZXMpIHsKICAgICAgICAgICAgY29uc3Qgb2xkQ3VzdG9tID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYmliYXNlX2NhdGVnb3JpZXMnKSkgfHwgW107CiAgICAgICAgICAgIG1hc3RlckNhdGVnb3JpZXMgPSBbLi4uREVGQVVMVF9DQVRFR09SSUVTLCAuLi5vbGRDdXN0b21dOwogICAgICAgICAgICBtYXN0ZXJDYXRlZ29yaWVzID0gWy4uLm5ldyBTZXQobWFzdGVyQ2F0ZWdvcmllcyldOwogICAgICAgIH0KCiAgICAgICAgbGV0IGN1cnJlbnRCdWxsZXRpbklkID0gbnVsbDsKICAgICAgICBsZXQgY3VycmVudEl0ZW1zID0gW107CiAgICAgICAgbGV0IGF1dG9TYXZlVGltZXIgPSBudWxsOwogICAgICAgIGxldCBlZGl0aW5nSXRlbUlkID0gbnVsbDsKICAgICAgICBsZXQgcXVpbGwgPSBudWxsOwogICAgICAgIGxldCBfYmlJbml0RG9uZSA9IGZhbHNlOwoKICAgICAgICAvLyAtLS0gSU5JVCAtLS0KICAgICAgICBmdW5jdGlvbiBpbml0QXBwKCkgewogICAgICAgICAgICBpZiAoX2JpSW5pdERvbmUpIHJldHVybjsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tCaUJhc2VdIGluaXQgYXR0ZW1wdCwgcmVhZHlTdGF0ZT0nICsgZG9jdW1lbnQucmVhZHlTdGF0ZSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWlsbC1lZGl0b3InKSkgeyBjb25zb2xlLndhcm4oJ1tCaUJhc2VdIERPTSBub3QgcmVhZHknKTsgc2V0VGltZW91dChpbml0QXBwLCAzMDApOyByZXR1cm47IH0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgUXVpbGwgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdbQmlCYXNlXSBRdWlsbCBDRE4gbm90IGxvYWRlZCwgcmV0cnkuLi4nKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGluaXRBcHAsIDUwMCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFxdWlsbCkgewogICAgICAgICAgICAgICAgICAgIHF1aWxsID0gbmV3IFF1aWxsKCcjcXVpbGwtZWRpdG9yJywgewogICAgICAgICAgICAgICAgICAgICAgICB0aGVtZTogJ3Nub3cnLAogICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFyOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWydib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbeyAnY29sb3InOiBbXSB9LCB7ICdiYWNrZ3JvdW5kJzogW10gfV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW3sgJ3NpemUnOiBbJ3NtYWxsJywgZmFsc2UsICdsYXJnZScsICdodWdlJ10gfV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW3sgJ2xpc3QnOiAnb3JkZXJlZCd9LCB7ICdsaXN0JzogJ2J1bGxldCcgfV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWydjbGVhbiddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnU2Fpc2lzc2V6IGxlIGNvbnRlbnUgaWNpLi4uJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJ5IHsgcmVuZGVyQnVsbGV0aW5MaXN0KCk7IH0gY2F0Y2goZSkgeyBjb25zb2xlLndhcm4oJ1tCaUJhc2VdIHJlbmRlckJ1bGxldGluTGlzdCBlcnI6JywgZSk7IH0KICAgICAgICAgICAgICAgIHRyeSB7IHJlbmRlckNhdGVnb3J5T3B0aW9ucygpOyB9IGNhdGNoKGUpIHsgY29uc29sZS53YXJuKCdbQmlCYXNlXSByZW5kZXJDYXRlZ29yeU9wdGlvbnMgZXJyOicsIGUpOyB9CiAgICAgICAgICAgICAgICBpZihidWxsZXRpbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7IGxvYWRCdWxsZXRpbihidWxsZXRpbnMuc29ydCgoYSxiKSA9PiBiLmlkIC0gYS5pZClbMF0uaWQpOyB9IGNhdGNoKGUpIHsgY29uc29sZS53YXJuKCdbQmlCYXNlXSBsb2FkQnVsbGV0aW4gZXJyOicsIGUpOyB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRyeSB7IGNyZWF0ZU5ld0J1bGxldGluKCk7IH0gY2F0Y2goZSkgeyBjb25zb2xlLndhcm4oJ1tCaUJhc2VdIGNyZWF0ZU5ld0J1bGxldGluIGVycjonLCBlKTsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJ5IHsgdXBkYXRlUHJldmlldygpOyB9IGNhdGNoKHBlKSB7IGNvbnNvbGUud2FybignW0JpQmFzZV0gdXBkYXRlUHJldmlldyBlcnI6JywgcGUpOyB9CiAgICAgICAgICAgICAgICBfYmlJbml0RG9uZSA9IHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2goZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdCaUJhc2UgaW5pdCBlcnJvcjonLCBlcnIpOwogICAgICAgICAgICAgICAgaWYgKCFfYmlJbml0RG9uZSkgc2V0VGltZW91dChpbml0QXBwLCAxMDAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7IHNldFRpbWVvdXQoaW5pdEFwcCwgMjAwKTsgfSk7CgogICAgICAgIC8vIC0tLSBOQVZJR0FUSU9OIC0tLQogICAgICAgIGZ1bmN0aW9uIHN3aXRjaFRhYih0YWIpIHsKICAgICAgICAgICAgWydidWxsZXRpbicsICdoZWxwJ10uZm9yRWFjaCh0ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBuYXYtJHt0fWApOwogICAgICAgICAgICAgICAgY29uc3QgdmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGB2aWV3LSR7dH1gKTsKICAgICAgICAgICAgICAgIGlmICghYnRuIHx8ICF2aWV3KSByZXR1cm47CgogICAgICAgICAgICAgICAgaWYodCA9PT0gdGFiKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3RleHQtc2xhdGUtNTAwJywgJ2hvdmVyOnRleHQtc2xhdGUtNzAwJywgJ2hvdmVyOmJnLXNsYXRlLTUwJywgJ2JvcmRlci10cmFuc3BhcmVudCcpOwogICAgICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdiZy1ibHVlLTUwJywgJ3RleHQtYmx1ZS03MDAnLCAnYm9yZGVyLWJsdWUtMTAwJywgJ3NoYWRvdy1zbScpOwogICAgICAgICAgICAgICAgICAgIHZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYodCA9PT0gJ2J1bGxldGluJykgdmlldy5jbGFzc0xpc3QuYWRkKCdmbGV4Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCd0ZXh0LXNsYXRlLTUwMCcsICdob3Zlcjp0ZXh0LXNsYXRlLTcwMCcsICdob3ZlcjpiZy1zbGF0ZS01MCcsICdib3JkZXItdHJhbnNwYXJlbnQnKTsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYmctYmx1ZS01MCcsICd0ZXh0LWJsdWUtNzAwJywgJ2JvcmRlci1ibHVlLTEwMCcsICdzaGFkb3ctc20nKTsKICAgICAgICAgICAgICAgICAgICB2aWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnZmxleCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlU2lkZWJhck1vYmlsZSgpIHsKICAgICAgICAgICAgY29uc3Qgc2lkZWJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN2aWV3LWJ1bGxldGluID4gZGl2OmZpcnN0LWNoaWxkJyk7CiAgICAgICAgICAgIHNpZGViYXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIHNpZGViYXIuY2xhc3NMaXN0LnRvZ2dsZSgnYWJzb2x1dGUnKTsKICAgICAgICAgICAgc2lkZWJhci5jbGFzc0xpc3QudG9nZ2xlKCdoLWZ1bGwnKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBDQVRFR09SWSBMT0dJQyAtLS0KICAgICAgICBmdW5jdGlvbiByZW5kZXJDYXRlZ29yeU9wdGlvbnMoKSB7CiAgICAgICAgICAgIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLWNhdGVnb3J5Jyk7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRWYWwgPSBzZWxlY3QudmFsdWU7CiAgICAgICAgICAgIHNlbGVjdC5pbm5lckhUTUwgPSBtYXN0ZXJDYXRlZ29yaWVzLm1hcChjYXQgPT4gYDxvcHRpb24gdmFsdWU9IiR7Y2F0fSI+JHtjYXR9PC9vcHRpb24+YCkuam9pbignJyk7CiAgICAgICAgICAgIGlmKG1hc3RlckNhdGVnb3JpZXMuaW5jbHVkZXMoY3VycmVudFZhbCkpIHsgc2VsZWN0LnZhbHVlID0gY3VycmVudFZhbDsgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRkQ3VzdG9tQ2F0ZWdvcnkoKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld0NhdCA9IHByb21wdCgiTm9tIGRlIGxhIG5vdXZlbGxlIGNhdMOpZ29yaWUgKGF2ZWMgw6ltb2ppIHNpIHZvdXMgdm91bGV6ICEpIDoiKTsKICAgICAgICAgICAgaWYobmV3Q2F0ICYmIG5ld0NhdC50cmltKCkgIT09ICIiKSB7CiAgICAgICAgICAgICAgICBjb25zdCB1cHBlckNhdCA9IG5ld0NhdC50cmltKCkudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIGlmKCFtYXN0ZXJDYXRlZ29yaWVzLmluY2x1ZGVzKHVwcGVyQ2F0KSkgewogICAgICAgICAgICAgICAgICAgIG1hc3RlckNhdGVnb3JpZXMucHVzaCh1cHBlckNhdCk7CiAgICAgICAgICAgICAgICAgICAgc2F2ZUNhdGVnb3JpZXMoKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJDYXRlZ29yeU9wdGlvbnMoKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS1jYXRlZ29yeScpLnZhbHVlID0gdXBwZXJDYXQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgeyBhbGVydCgiQ2V0dGUgY2F0w6lnb3JpZSBleGlzdGUgZMOpasOgLiIpOyB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gc2F2ZUNhdGVnb3JpZXMoKSB7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdiaWJhc2VfY2F0ZWdvcmllc19tYXN0ZXInLCBKU09OLnN0cmluZ2lmeShtYXN0ZXJDYXRlZ29yaWVzKSk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gQ0FURUdPUlkgTUFOQUdFUiBVSSAtLS0KICAgICAgICBmdW5jdGlvbiBvcGVuQ2F0ZWdvcnlNYW5hZ2VyKCkgewogICAgICAgICAgICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhdGVnb3J5LW1hbmFnZXItbGlzdCcpOwogICAgICAgICAgICBsaXN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAKICAgICAgICAgICAgbWFzdGVyQ2F0ZWdvcmllcy5mb3JFYWNoKChjYXQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSAiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHAtMyBiZy13aGl0ZSBib3JkZXIgYm9yZGVyLXNsYXRlLTIwMCByb3VuZGVkLXhsIGhvdmVyOmJvcmRlci1ibHVlLTMwMCB0cmFuc2l0aW9uLWNvbG9ycyBncm91cCI7CiAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC1zbGF0ZS03MDAgdGV4dC1zbSI+JHtjYXR9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIG9wYWNpdHktNTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJtb3ZlQ2F0ZWdvcnkoJHtpbmRleH0sIC0xKSIgY2xhc3M9InAtMS41IGhvdmVyOmJnLXNsYXRlLTEwMCByb3VuZGVkLWxnIHRleHQtc2xhdGUtNTAwIGhvdmVyOnRleHQtYmx1ZS02MDAgZGlzYWJsZWQ6b3BhY2l0eS0zMCIgJHtpbmRleCA9PT0gMCA/ICdkaXNhYmxlZCcgOiAnJ30+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0idy00IGgtNCI+PHVzZSBocmVmPSIjaWNvbi1hcnJvdy11cCI+PC91c2U+PC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9Im1vdmVDYXRlZ29yeSgke2luZGV4fSwgMSkiIGNsYXNzPSJwLTEuNSBob3ZlcjpiZy1zbGF0ZS0xMDAgcm91bmRlZC1sZyB0ZXh0LXNsYXRlLTUwMCBob3Zlcjp0ZXh0LWJsdWUtNjAwIGRpc2FibGVkOm9wYWNpdHktMzAiICR7aW5kZXggPT09IG1hc3RlckNhdGVnb3JpZXMubGVuZ3RoIC0gMSA/ICdkaXNhYmxlZCcgOiAnJ30+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0idy00IGgtNCI+PHVzZSBocmVmPSIjaWNvbi1hcnJvdy1kb3duIj48L3VzZT48L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgbGlzdC5hcHBlbmRDaGlsZChkaXYpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jYXRlZ29yaWVzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbG9zZUNhdGVnb3J5TWFuYWdlcigpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWNhdGVnb3JpZXMnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgcmVuZGVyQ2F0ZWdvcnlPcHRpb25zKCk7CiAgICAgICAgICAgIHJlbmRlckVkaXRvckxpc3QoKTsKICAgICAgICAgICAgdXBkYXRlUHJldmlldygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0VmlzaWJsZUNhdGVnb3JpZXMoKSB7CiAgICAgICAgICAgIGNvbnN0IGdyb3VwZWQgPSB7fTsKICAgICAgICAgICAgY3VycmVudEl0ZW1zLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICAgICAgICBpZighZ3JvdXBlZFtpdGVtLmNhdGVnb3J5XSkgZ3JvdXBlZFtpdGVtLmNhdGVnb3J5XSA9IFtdOwogICAgICAgICAgICAgICAgZ3JvdXBlZFtpdGVtLmNhdGVnb3J5XS5wdXNoKGl0ZW0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG1hc3RlckNhdGVnb3JpZXMuZmlsdGVyKGNhdCA9PiBncm91cGVkW2NhdF0gJiYgZ3JvdXBlZFtjYXRdLmxlbmd0aCA+IDApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbW92ZVZpc2libGVDYXRlZ29yeShjYXROYW1lLCBkaXJlY3Rpb24pIHsKICAgICAgICAgICAgIGNvbnN0IHZpc2libGVDYXRzID0gZ2V0VmlzaWJsZUNhdGVnb3JpZXMoKTsKICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbmRleEluVmlzaWJsZSA9IHZpc2libGVDYXRzLmluZGV4T2YoY2F0TmFtZSk7CiAgICAgICAgICAgICBpZiAoY3VycmVudEluZGV4SW5WaXNpYmxlID09PSAtMSkgcmV0dXJuOyAKICAgICAgICAgICAgIGNvbnN0IHRhcmdldEluZGV4SW5WaXNpYmxlID0gY3VycmVudEluZGV4SW5WaXNpYmxlICsgZGlyZWN0aW9uOwogICAgICAgICAgICAgaWYgKHRhcmdldEluZGV4SW5WaXNpYmxlIDwgMCB8fCB0YXJnZXRJbmRleEluVmlzaWJsZSA+PSB2aXNpYmxlQ2F0cy5sZW5ndGgpIHJldHVybjsKICAgICAgICAgICAgIGNvbnN0IHRhcmdldENhdE5hbWUgPSB2aXNpYmxlQ2F0c1t0YXJnZXRJbmRleEluVmlzaWJsZV07CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGNvbnN0IGluZGV4MSA9IG1hc3RlckNhdGVnb3JpZXMuaW5kZXhPZihjYXROYW1lKTsKICAgICAgICAgICAgIGNvbnN0IGluZGV4MiA9IG1hc3RlckNhdGVnb3JpZXMuaW5kZXhPZih0YXJnZXRDYXROYW1lKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgaWYoaW5kZXgxID09PSAtMSB8fCBpbmRleDIgPT09IC0xKSByZXR1cm47CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGNvbnN0IHRlbXAgPSBtYXN0ZXJDYXRlZ29yaWVzW2luZGV4MV07CiAgICAgICAgICAgICBtYXN0ZXJDYXRlZ29yaWVzW2luZGV4MV0gPSBtYXN0ZXJDYXRlZ29yaWVzW2luZGV4Ml07CiAgICAgICAgICAgICBtYXN0ZXJDYXRlZ29yaWVzW2luZGV4Ml0gPSB0ZW1wOwogICAgICAgICAgICAgCiAgICAgICAgICAgICBzYXZlQ2F0ZWdvcmllcygpOwogICAgICAgICAgICAgcmVuZGVyRWRpdG9yTGlzdCgpOwogICAgICAgICAgICAgdXBkYXRlUHJldmlldygpOwogICAgICAgICAgICAgcmVuZGVyQ2F0ZWdvcnlPcHRpb25zKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtb3ZlQ2F0ZWdvcnkoaW5kZXgsIGRpcmVjdGlvbiwgcmVsb2FkVUkgPSAnbW9kYWwnKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld0luZGV4ID0gaW5kZXggKyBkaXJlY3Rpb247CiAgICAgICAgICAgIGlmIChuZXdJbmRleCA8IDAgfHwgbmV3SW5kZXggPj0gbWFzdGVyQ2F0ZWdvcmllcy5sZW5ndGgpIHJldHVybjsKICAgICAgICAgICAgW21hc3RlckNhdGVnb3JpZXNbaW5kZXhdLCBtYXN0ZXJDYXRlZ29yaWVzW25ld0luZGV4XV0gPSBbbWFzdGVyQ2F0ZWdvcmllc1tuZXdJbmRleF0sIG1hc3RlckNhdGVnb3JpZXNbaW5kZXhdXTsKICAgICAgICAgICAgc2F2ZUNhdGVnb3JpZXMoKTsKICAgICAgICAgICAgaWYocmVsb2FkVUkgPT09ICdtb2RhbCcpIHsgb3BlbkNhdGVnb3J5TWFuYWdlcigpOyB9IAogICAgICAgICAgICBlbHNlIHsgcmVuZGVyRWRpdG9yTGlzdCgpOyB1cGRhdGVQcmV2aWV3KCk7IHJlbmRlckNhdGVnb3J5T3B0aW9ucygpOyB9CiAgICAgICAgfQoKCiAgICAgICAgLy8gLS0tIEJVTExFVElOIExPR0lDIC0tLQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld0J1bGxldGluKCkgewogICAgICAgICAgICB0cnkgeyBjYW5jZWxFZGl0KCk7IH0gY2F0Y2goZSkge30KICAgICAgICAgICAgY3VycmVudEJ1bGxldGluSWQgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBjdXJyZW50SXRlbXMgPSBbXTsKICAgICAgICAgICAgLy8gQXV0byBpbmNyZW1lbnQgbG9naWMgYmFzZWQgb24gbWF4IG51bWJlciBmb3VuZAogICAgICAgICAgICBsZXQgbWF4TnVtID0gMDsKICAgICAgICAgICAgYnVsbGV0aW5zLmZvckVhY2goYiA9PiB7CiAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHBhcnNlSW50KGIubnVtYmVyKTsKICAgICAgICAgICAgICAgICBpZighaXNOYU4obikgJiYgbiA+IG1heE51bSkgbWF4TnVtID0gbjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1udW1iZXInKS52YWx1ZSA9IG1heE51bSArIDE7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjdXJyID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgY29uc3QgZmlyc3QgPSBjdXJyLmdldERhdGUoKSAtIGN1cnIuZ2V0RGF5KCkgKyAxOyAKICAgICAgICAgICAgY29uc3QgbGFzdCA9IGZpcnN0ICsgNDsgCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1kYXRlLXN0YXJ0JykudmFsdWUgPSBuZXcgRGF0ZShjdXJyLnNldERhdGUoZmlyc3QpKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktZGF0ZS1lbmQnKS52YWx1ZSA9IG5ldyBEYXRlKGN1cnIuc2V0RGF0ZShsYXN0KSkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVTRSBFU1RBQkxJU0hNRU5UIERFRkFVTFRTCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1wdWItZGF0ZScpLnZhbHVlQXNEYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpLXNpZ25hdG9yeScpLnZhbHVlID0gZXN0YWJsaXNobWVudC5kZWZhdWx0U2lnbmF0b3J5IHx8ICJMJ8OpcXVpcGUgZGUgZGlyZWN0aW9uIjsgCiAgICAgICAgICAgIAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktdGhlbWUnKS52YWx1ZSA9ICdibHVlJzsKCiAgICAgICAgICAgIHJlbmRlckVkaXRvckxpc3QoKTsKICAgICAgICAgICAgdXBkYXRlUHJldmlldygpOwogICAgICAgICAgICBzYXZlQ3VycmVudEJ1bGxldGluKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsb2FkQnVsbGV0aW4oaWQpIHsKICAgICAgICAgICAgY2FuY2VsRWRpdCgpOwogICAgICAgICAgICBjb25zdCBiID0gYnVsbGV0aW5zLmZpbmQoeCA9PiB4LmlkID09PSBpZCk7CiAgICAgICAgICAgIGlmKCFiKSByZXR1cm47CiAgICAgICAgICAgIGN1cnJlbnRCdWxsZXRpbklkID0gYi5pZDsKICAgICAgICAgICAgY3VycmVudEl0ZW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShiLml0ZW1zKSk7IAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktbnVtYmVyJykudmFsdWUgPSBiLm51bWJlcjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpLWRhdGUtc3RhcnQnKS52YWx1ZSA9IGIuZGF0ZVN0YXJ0OwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktZGF0ZS1lbmQnKS52YWx1ZSA9IGIuZGF0ZUVuZDsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpLXB1Yi1kYXRlJykudmFsdWUgPSBiLnB1YkRhdGUgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktc2lnbmF0b3J5JykudmFsdWUgPSBiLnNpZ25hdG9yeSB8fCAiTCfDqXF1aXBlIGRlIGRpcmVjdGlvbiI7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS10aGVtZScpLnZhbHVlID0gYi50aGVtZSB8fCAnYmx1ZSc7CgogICAgICAgICAgICByZW5kZXJFZGl0b3JMaXN0KCk7CiAgICAgICAgICAgIHVwZGF0ZVByZXZpZXcoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gVjM6IERVUExJQ0FUSU9OIEZVTkNUSU9OCiAgICAgICAgZnVuY3Rpb24gZHVwbGljYXRlQnVsbGV0aW4oZSwgaWQpIHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgY29uc3Qgc291cmNlID0gYnVsbGV0aW5zLmZpbmQoYiA9PiBiLmlkID09PSBpZCk7CiAgICAgICAgICAgIGlmKCFzb3VyY2UpIHJldHVybjsKCiAgICAgICAgICAgIGlmKGNvbmZpcm0oYENvcGllciBsZSBidWxsZXRpbiBOwrAke3NvdXJjZS5udW1iZXJ9ID9gKSkgewogICAgICAgICAgICAgICAgLy8gMS4gQ2FsY3VsYXRlIG5ldyBudW1iZXIKICAgICAgICAgICAgICAgIGxldCBtYXhOdW0gPSAwOwogICAgICAgICAgICAgICAgYnVsbGV0aW5zLmZvckVhY2goYiA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHBhcnNlSW50KGIubnVtYmVyKTsKICAgICAgICAgICAgICAgICAgICBpZighaXNOYU4obikgJiYgbiA+IG1heE51bSkgbWF4TnVtID0gbjsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3QgbmV3TnVtID0gbWF4TnVtICsgMTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMi4gQ2xvbmUKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0l0ZW0gPSB7CiAgICAgICAgICAgICAgICAgICAgLi4uSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShzb3VyY2UpKSwKICAgICAgICAgICAgICAgICAgICBpZDogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgICAgICBudW1iZXI6IG5ld051bSwKICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMy4gU2F2ZSAmIExvYWQKICAgICAgICAgICAgICAgIGJ1bGxldGlucy5wdXNoKG5ld0l0ZW0pOwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JpYmFzZV9idWxsZXRpbnMnLCBKU09OLnN0cmluZ2lmeShidWxsZXRpbnMpKTsKICAgICAgICAgICAgICAgIGxvYWRCdWxsZXRpbihuZXdJdGVtLmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZm9ybWF0RGF0ZUZvckRpc3BsYXkoZGF0ZVN0cikgewogICAgICAgICAgICBpZiAoIWRhdGVTdHIpIHJldHVybiAnJzsKICAgICAgICAgICAgaWYgKCEvXlxkezR9LVxkezJ9LVxkezJ9JC8udGVzdChkYXRlU3RyKSkgcmV0dXJuIGRhdGVTdHI7CiAgICAgICAgICAgIGNvbnN0IFt5LCBtLCBkXSA9IGRhdGVTdHIuc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTsKICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHksIG0gLSAxLCBkKTsKICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicsIHsgd2Vla2RheTogJ2xvbmcnLCBkYXk6ICdudW1lcmljJywgbW9udGg6ICdsb25nJyB9KTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBJVEVNUyBMT0dJQyAtLS0KICAgICAgICBmdW5jdGlvbiBtb3ZlSXRlbVVwKGlkKSB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY3VycmVudEl0ZW1zLmZpbmRJbmRleChpID0+IGkuaWQgPT09IGlkKTsKICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBjYXQgPSBjdXJyZW50SXRlbXNbaW5kZXhdLmNhdGVnb3J5OwogICAgICAgICAgICBsZXQgcHJldkluZGV4ID0gLTE7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBpbmRleCAtIDE7IGkgPj0gMDsgaS0tKSB7IGlmIChjdXJyZW50SXRlbXNbaV0uY2F0ZWdvcnkgPT09IGNhdCkgeyBwcmV2SW5kZXggPSBpOyBicmVhazsgfSB9CgogICAgICAgICAgICBpZiAocHJldkluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgW2N1cnJlbnRJdGVtc1twcmV2SW5kZXhdLCBjdXJyZW50SXRlbXNbaW5kZXhdXSA9IFtjdXJyZW50SXRlbXNbaW5kZXhdLCBjdXJyZW50SXRlbXNbcHJldkluZGV4XV07CiAgICAgICAgICAgICAgICByZW5kZXJFZGl0b3JMaXN0KCk7CiAgICAgICAgICAgICAgICB1cGRhdGVQcmV2aWV3KCk7CiAgICAgICAgICAgICAgICBzYXZlQ3VycmVudEJ1bGxldGluKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtb3ZlSXRlbURvd24oaWQpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjdXJyZW50SXRlbXMuZmluZEluZGV4KGkgPT4gaS5pZCA9PT0gaWQpOwogICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGNhdCA9IGN1cnJlbnRJdGVtc1tpbmRleF0uY2F0ZWdvcnk7CiAgICAgICAgICAgIGxldCBuZXh0SW5kZXggPSAtMTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IGluZGV4ICsgMTsgaSA8IGN1cnJlbnRJdGVtcy5sZW5ndGg7IGkrKykgeyBpZiAoY3VycmVudEl0ZW1zW2ldLmNhdGVnb3J5ID09PSBjYXQpIHsgbmV4dEluZGV4ID0gaTsgYnJlYWs7IH0gfQoKICAgICAgICAgICAgaWYgKG5leHRJbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIFtjdXJyZW50SXRlbXNbbmV4dEluZGV4XSwgY3VycmVudEl0ZW1zW2luZGV4XV0gPSBbY3VycmVudEl0ZW1zW2luZGV4XSwgY3VycmVudEl0ZW1zW25leHRJbmRleF1dOwogICAgICAgICAgICAgICAgcmVuZGVyRWRpdG9yTGlzdCgpOwogICAgICAgICAgICAgICAgdXBkYXRlUHJldmlldygpOwogICAgICAgICAgICAgICAgc2F2ZUN1cnJlbnRCdWxsZXRpbih0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRGF0ZUlucHV0KCkgewogICAgICAgICAgICBjb25zdCB0eXBlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0iZGF0ZS10eXBlIl06Y2hlY2tlZCcpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBmaXhlZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0ZW0tZGF0ZS1maXhlZCcpOwogICAgICAgICAgICBjb25zdCB2YXJpYWJsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0ZW0tZGF0ZS12YXJpYWJsZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYodHlwZSA9PT0gJ2ZpeGVkJykgeyBmaXhlZElucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyB2YXJpYWJsZUlucHV0LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyB9IAogICAgICAgICAgICBlbHNlIHsgZml4ZWRJbnB1dC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgdmFyaWFibGVJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3RhcnRFZGl0SXRlbShpZCkgewogICAgICAgICAgICBjb25zdCBpdGVtID0gY3VycmVudEl0ZW1zLmZpbmQoaSA9PiBpLmlkID09PSBpZCk7CiAgICAgICAgICAgIGlmKCFpdGVtKSByZXR1cm47CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS1jYXRlZ29yeScpLnZhbHVlID0gaXRlbS5jYXRlZ29yeTsKICAgICAgICAgICAgY29uc3QgaXNEYXRlID0gL15cZHs0fS1cZHsyfS1cZHsyfSQvLnRlc3QoaXRlbS5kYXRlKTsKICAgICAgICAgICAgaWYoaXNEYXRlIHx8IGl0ZW0uZGF0ZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9ImRhdGUtdHlwZSJdW3ZhbHVlPSJmaXhlZCJdJykuY2hlY2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS1kYXRlLWZpeGVkJykudmFsdWUgPSBpdGVtLmRhdGU7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS1kYXRlLXZhcmlhYmxlJykudmFsdWUgPSAnJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9ImRhdGUtdHlwZSJdW3ZhbHVlPSJ2YXJpYWJsZSJdJykuY2hlY2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS1kYXRlLWZpeGVkJykudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLWRhdGUtdmFyaWFibGUnKS52YWx1ZSA9IGl0ZW0uZGF0ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0b2dnbGVEYXRlSW5wdXQoKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLXRpdGxlJykudmFsdWUgPSBpdGVtLnRpdGxlOwogICAgICAgICAgICBxdWlsbC5yb290LmlubmVySFRNTCA9IGl0ZW0uY29udGVudDsKICAgICAgICAgICAgZWRpdGluZ0l0ZW1JZCA9IGlkOwoKICAgICAgICAgICAgY29uc3QgYnRuTWFpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tYWRkLXVwZGF0ZScpOwogICAgICAgICAgICBjb25zdCBidG5DYW5jZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLWNhbmNlbC1lZGl0Jyk7CiAgICAgICAgICAgIGNvbnN0IGZvcm1UaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtLXRpdGxlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3JtVGl0bGUuaW5uZXJUZXh0ID0gIk1vZGlmaWVyIGwnaW5mbyI7CiAgICAgICAgICAgIGJ0bk1haW4uaW5uZXJUZXh0ID0gIlZhbGlkZXIgbGVzIG1vZGlmaWNhdGlvbnMg4pyFIjsKICAgICAgICAgICAgYnRuTWFpbi5jbGFzc0xpc3QucmVtb3ZlKCdiZy1vcmFuZ2UtNTAwJywgJ2hvdmVyOmJnLW9yYW5nZS02MDAnKTsKICAgICAgICAgICAgYnRuTWFpbi5jbGFzc0xpc3QuYWRkKCdiZy1ibHVlLTYwMCcsICdob3ZlcjpiZy1ibHVlLTcwMCcpOwogICAgICAgICAgICBidG5DYW5jZWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtLWNvbnRhaW5lcicpLnNjcm9sbEludG9WaWV3KHtiZWhhdmlvcjogJ3Ntb290aCd9KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0tY29udGFpbmVyJykuY2xhc3NMaXN0LmFkZCgncmluZy0yJywgJ3JpbmctYmx1ZS00MDAnKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNhbmNlbEVkaXQoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9ImRhdGUtdHlwZSJdW3ZhbHVlPSJmaXhlZCJdJykuY2hlY2tlZCA9IHRydWU7CiAgICAgICAgICAgIHRvZ2dsZURhdGVJbnB1dCgpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS1kYXRlLWZpeGVkJykudmFsdWUgPSAnJzsgCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLWRhdGUtdmFyaWFibGUnKS52YWx1ZSA9ICcnOyAKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLXRpdGxlJykudmFsdWUgPSAnJzsKICAgICAgICAgICAgcXVpbGwuc2V0Q29udGVudHMoW10pOwogICAgICAgICAgICBlZGl0aW5nSXRlbUlkID0gbnVsbDsKCiAgICAgICAgICAgIGNvbnN0IGJ0bk1haW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLWFkZC11cGRhdGUnKTsKICAgICAgICAgICAgY29uc3QgYnRuQ2FuY2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bi1jYW5jZWwtZWRpdCcpOwogICAgICAgICAgICBjb25zdCBmb3JtVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9ybS10aXRsZScpOwogICAgICAgICAgICBmb3JtVGl0bGUuaW5uZXJUZXh0ID0gIlNhaXNpciB1bmUgaW5mbyI7CiAgICAgICAgICAgIGJ0bk1haW4uaW5uZXJUZXh0ID0gIkFqb3V0ZXIgbCdpbmZvIPCfmoAiOwogICAgICAgICAgICBidG5NYWluLmNsYXNzTGlzdC5hZGQoJ2JnLW9yYW5nZS01MDAnLCAnaG92ZXI6Ymctb3JhbmdlLTYwMCcpOwogICAgICAgICAgICBidG5NYWluLmNsYXNzTGlzdC5yZW1vdmUoJ2JnLWJsdWUtNjAwJywgJ2hvdmVyOmJnLWJsdWUtNzAwJyk7CiAgICAgICAgICAgIGJ0bkNhbmNlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm0tY29udGFpbmVyJykuY2xhc3NMaXN0LnJlbW92ZSgncmluZy0yJywgJ3JpbmctYmx1ZS00MDAnKTsKICAgICAgICAgICAgfSBjYXRjaChlcnIpIHsgY29uc29sZS53YXJuKCdjYW5jZWxFZGl0OicsIGVycik7IH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFkZEJ1bGxldGluSXRlbSgpIHsKICAgICAgICAgICAgaWYgKCFxdWlsbCkgeyBhbGVydCgnRWRpdGV1ciBub24gcHJldC4gUmVjaGFyZ2V6IGxhIHBhZ2UuJyk7IHJldHVybjsgfQogICAgICAgICAgICBjb25zdCBjYXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS1jYXRlZ29yeScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBkYXRlVHlwZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9ImRhdGUtdHlwZSJdOmNoZWNrZWQnKS52YWx1ZTsKICAgICAgICAgICAgbGV0IGRhdGUgPSBkYXRlVHlwZSA9PT0gJ2ZpeGVkJyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLWRhdGUtZml4ZWQnKS52YWx1ZSA6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLWRhdGUtdmFyaWFibGUnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXRlbS10aXRsZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBjb250ZW50ID0gcXVpbGwucm9vdC5pbm5lckhUTUw7CiAgICAgICAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gcXVpbGwuZ2V0VGV4dCgpLnRyaW0oKTsKCiAgICAgICAgICAgIGlmKHRleHRDb250ZW50Lmxlbmd0aCA9PT0gMCAmJiAhdGl0bGUpIHJldHVybjsKCiAgICAgICAgICAgIGlmIChlZGl0aW5nSXRlbUlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBjdXJyZW50SXRlbXMuZmluZEluZGV4KGkgPT4gaS5pZCA9PT0gZWRpdGluZ0l0ZW1JZCk7CiAgICAgICAgICAgICAgICBpZihpZHggIT09IC0xKSB7IGN1cnJlbnRJdGVtc1tpZHhdID0geyAuLi5jdXJyZW50SXRlbXNbaWR4XSwgY2F0ZWdvcnk6IGNhdCwgZGF0ZTogZGF0ZSwgdGl0bGU6IHRpdGxlLCBjb250ZW50OiBjb250ZW50IH07IH0KICAgICAgICAgICAgICAgIGNhbmNlbEVkaXQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtcy5wdXNoKHsgaWQ6IERhdGUubm93KCksIGNhdGVnb3J5OiBjYXQsIGRhdGU6IGRhdGUsIHRpdGxlOiB0aXRsZSwgY29udGVudDogY29udGVudCB9KTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLXRpdGxlJykudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIHF1aWxsLnNldENvbnRlbnRzKFtdKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdGVtLWRhdGUtdmFyaWFibGUnKS52YWx1ZSA9ICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbmRlckVkaXRvckxpc3QoKTsKICAgICAgICAgICAgdXBkYXRlUHJldmlldygpOwogICAgICAgICAgICBzYXZlQ3VycmVudEJ1bGxldGluKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlQnVsbGV0aW5JdGVtKGlkKSB7CiAgICAgICAgICAgIGlmKGlkID09PSBlZGl0aW5nSXRlbUlkKSBjYW5jZWxFZGl0KCk7CiAgICAgICAgICAgIGlmKGNvbmZpcm0oIvCfl5HvuI8gU3VwcHJpbWVyIGNldHRlIGluZm9ybWF0aW9uID8iKSkgewogICAgICAgICAgICAgICAgY3VycmVudEl0ZW1zID0gY3VycmVudEl0ZW1zLmZpbHRlcihpID0+IGkuaWQgIT09IGlkKTsKICAgICAgICAgICAgICAgIHJlbmRlckVkaXRvckxpc3QoKTsKICAgICAgICAgICAgICAgIHVwZGF0ZVByZXZpZXcoKTsKICAgICAgICAgICAgICAgIHNhdmVDdXJyZW50QnVsbGV0aW4odHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUJ1bGxldGluKGUsIGlkKSB7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIGlmKGNvbmZpcm0oIuKaoO+4jyBBdHRlbnRpb24gOiBWb3VsZXotdm91cyB2cmFpbWVudCBzdXBwcmltZXIgZMOpZmluaXRpdmVtZW50IGNlIGJ1bGxldGluID8iKSkgewogICAgICAgICAgICAgICAgYnVsbGV0aW5zID0gYnVsbGV0aW5zLmZpbHRlcihiID0+IGIuaWQgIT09IGlkKTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdiaWJhc2VfYnVsbGV0aW5zJywgSlNPTi5zdHJpbmdpZnkoYnVsbGV0aW5zKSk7CiAgICAgICAgICAgICAgICBpZihjdXJyZW50QnVsbGV0aW5JZCA9PT0gaWQpIHsgYnVsbGV0aW5zLmxlbmd0aCA+IDAgPyBsb2FkQnVsbGV0aW4oYnVsbGV0aW5zWzBdLmlkKSA6IGNyZWF0ZU5ld0J1bGxldGluKCk7IH0gZWxzZSB7IHJlbmRlckJ1bGxldGluTGlzdCgpOyB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlckVkaXRvckxpc3QoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0b3ItaXRlbXMtbGlzdCcpOwogICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGNvbnN0IGdyb3VwZWQgPSB7fTsKICAgICAgICAgICAgY3VycmVudEl0ZW1zLmZvckVhY2goaXRlbSA9PiB7IGlmKCFncm91cGVkW2l0ZW0uY2F0ZWdvcnldKSBncm91cGVkW2l0ZW0uY2F0ZWdvcnldID0gW107IGdyb3VwZWRbaXRlbS5jYXRlZ29yeV0ucHVzaChpdGVtKTsgfSk7CiAgICAgICAgICAgIGNvbnN0IHZpc2libGVDYXRzID0gZ2V0VmlzaWJsZUNhdGVnb3JpZXMoKTsKCiAgICAgICAgICAgIG1hc3RlckNhdGVnb3JpZXMuZm9yRWFjaCgoY2F0LCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgaWYoZ3JvdXBlZFtjYXRdICYmIGdyb3VwZWRbY2F0XS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmNsYXNzTmFtZSA9ICJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gbXQtNiBtYi0yIGdyb3VwL2hlYWRlciI7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzRmlyc3QgPSB2aXNpYmxlQ2F0c1swXSA9PT0gY2F0OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzTGFzdCA9IHZpc2libGVDYXRzW3Zpc2libGVDYXRzLmxlbmd0aCAtIDFdID09PSBjYXQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2F0U2FmZSA9IGNhdC5yZXBsYWNlKC8nL2csICJcXCciKTsKCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyBmb250LWJvbGQgdGV4dC1zbGF0ZS00MDAgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVzdCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2NhdH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiZy1zbGF0ZS0xMDAgdGV4dC1zbGF0ZS00MDAgcHgtMS41IHB5LTAuNSByb3VuZGVkLWZ1bGwiIHN0eWxlPSJmb250LXNpemU6MTBweCI+JHtncm91cGVkW2NhdF0ubGVuZ3RofTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIG9wYWNpdHktMCBncm91cC1ob3Zlci9oZWFkZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0ibW92ZVZpc2libGVDYXRlZ29yeSgnJHtjYXRTYWZlfScsIC0xKSIgY2xhc3M9InAtMSBob3ZlcjpiZy1zbGF0ZS0xMDAgdGV4dC1zbGF0ZS00MDAgaG92ZXI6dGV4dC1ibHVlLTYwMCByb3VuZGVkIGRpc2FibGVkOm9wYWNpdHktMzAiICR7aXNGaXJzdCA/ICdkaXNhYmxlZCcgOiAnJ30gdGl0bGU9Ik1vbnRlciBsYSBjYXTDqWdvcmllIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJ3LTQgaC00Ij48dXNlIGhyZWY9IiNpY29uLWFycm93LXVwIj48L3VzZT48L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJtb3ZlVmlzaWJsZUNhdGVnb3J5KCcke2NhdFNhZmV9JywgMSkiIGNsYXNzPSJwLTEgaG92ZXI6Ymctc2xhdGUtMTAwIHRleHQtc2xhdGUtNDAwIGhvdmVyOnRleHQtYmx1ZS02MDAgcm91bmRlZCBkaXNhYmxlZDpvcGFjaXR5LTMwIiAke2lzTGFzdCA/ICdkaXNhYmxlZCcgOiAnJ30gdGl0bGU9IkRlc2NlbmRyZSBsYSBjYXTDqWdvcmllIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJ3LTQgaC00Ij48dXNlIGhyZWY9IiNpY29uLWFycm93LWRvd24iPjwvdXNlPjwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGhlYWRlcik7CgogICAgICAgICAgICAgICAgICAgIGdyb3VwZWRbY2F0XS5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICJiZy13aGl0ZSBwLTQgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLXNsYXRlLTEwMCBzaGFkb3ctc20gZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtc3RhcnQgZ3JvdXAgbWItMyB0cmFuc2l0aW9uLWFsbCBob3Zlcjpib3JkZXItYmx1ZS0yMDAgaG92ZXI6c2hhZG93LW1kIjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbS5pZCA9PT0gZWRpdGluZ0l0ZW1JZCkgeyBkaXYuY2xhc3NOYW1lID0gImJnLWJsdWUtNTAgcC00IHJvdW5kZWQteGwgYm9yZGVyLTIgYm9yZGVyLWJsdWUtNDAwIHNoYWRvdy1tZCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1zdGFydCBtYi0zIjsgfQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5RGF0ZSA9IGZvcm1hdERhdGVGb3JEaXNwbGF5KGl0ZW0uZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEgcHItNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIGZsZXggZmxleC13cmFwIGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7ZGlzcGxheURhdGUgPyBgPHNwYW4gY2xhc3M9ImJnLXllbGxvdy0xMDAgdGV4dC15ZWxsb3ctODAwIHB4LTIgcHktMC41IHJvdW5kZWQtbGcgdGV4dC14cyBmb250LWJvbGQgY2FwaXRhbGl6ZSI+JHtkaXNwbGF5RGF0ZX08L3NwYW4+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2l0ZW0udGl0bGUgfHwgJzxzcGFuIGNsYXNzPSJpdGFsaWMgdGV4dC1zbGF0ZS00MDAiPlNhbnMgdGl0cmU8L3NwYW4+J30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXNtIHRleHQtc2xhdGUtNjAwIG10LTIgbGVhZGluZy1yZWxheGVkIHJpY2gtdGV4dC1jb250ZW50Ij4ke2l0ZW0uY29udGVudH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEgb3BhY2l0eS0wIGdyb3VwLWhvdmVyOm9wYWNpdHktMTAwIHRyYW5zaXRpb24tb3BhY2l0eSBmbGV4LXNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9Im1vdmVJdGVtVXAoJHtpdGVtLmlkfSkiIGNsYXNzPSJwLTIgdGV4dC1zbGF0ZS00MDAgaG92ZXI6dGV4dC1pbmRpZ28tNjAwIGhvdmVyOmJnLWluZGlnby01MCByb3VuZGVkLWxnIHRyYW5zaXRpb24tY29sb3JzIiB0aXRsZT0iTW9udGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0idy00IGgtNCI+PHVzZSBocmVmPSIjaWNvbi1hcnJvdy11cCI+PC91c2U+PC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJtb3ZlSXRlbURvd24oJHtpdGVtLmlkfSkiIGNsYXNzPSJwLTIgdGV4dC1zbGF0ZS00MDAgaG92ZXI6dGV4dC1pbmRpZ28tNjAwIGhvdmVyOmJnLWluZGlnby01MCByb3VuZGVkLWxnIHRyYW5zaXRpb24tY29sb3JzIiB0aXRsZT0iRGVzY2VuZHJlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyBjbGFzcz0idy00IGgtNCI+PHVzZSBocmVmPSIjaWNvbi1hcnJvdy1kb3duIj48L3VzZT48L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LXB4IGgtNCBiZy1zbGF0ZS0yMDAgbXgtMSI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJzdGFydEVkaXRJdGVtKCR7aXRlbS5pZH0pIiBjbGFzcz0icC0yIHRleHQtc2xhdGUtNDAwIGhvdmVyOnRleHQtYmx1ZS02MDAgaG92ZXI6YmctYmx1ZS01MCByb3VuZGVkLWxnIHRyYW5zaXRpb24tY29sb3JzIiB0aXRsZT0iTW9kaWZpZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJ3LTQgaC00Ij48dXNlIGhyZWY9IiNpY29uLWVkaXQiPjwvdXNlPjwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icmVtb3ZlQnVsbGV0aW5JdGVtKCR7aXRlbS5pZH0pIiBjbGFzcz0icC0yIHRleHQtc2xhdGUtNDAwIGhvdmVyOnRleHQtcmVkLTUwMCBob3ZlcjpiZy1yZWQtNTAgcm91bmRlZC1sZyB0cmFuc2l0aW9uLWNvbG9ycyIgdGl0bGU9IlN1cHByaW1lciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9InctNCBoLTQiPjx1c2UgaHJlZj0iI2ljb24tdHJhc2giPjwvdXNlPjwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJBdXRvU2F2ZSgpIHsKICAgICAgICAgICAgdXBkYXRlUHJldmlldygpOyAKICAgICAgICAgICAgaWYoYXV0b1NhdmVUaW1lcikgY2xlYXJUaW1lb3V0KGF1dG9TYXZlVGltZXIpOwogICAgICAgICAgICBhdXRvU2F2ZVRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7IHNhdmVDdXJyZW50QnVsbGV0aW4odHJ1ZSk7IH0sIDEwMDApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2hvd1NhdmVTdGF0dXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG8tc2F2ZS1zdGF0dXMnKTsKICAgICAgICAgICAgc3RhdHVzRWwuY2xhc3NMaXN0LnJlbW92ZSgnc2F2ZS1pbmRpY2F0b3InKTsgCiAgICAgICAgICAgIHZvaWQgc3RhdHVzRWwub2Zmc2V0V2lkdGg7IAogICAgICAgICAgICBzdGF0dXNFbC5jbGFzc0xpc3QuYWRkKCdzYXZlLWluZGljYXRvcicpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2F2ZUN1cnJlbnRCdWxsZXRpbihpc0F1dG8gPSBmYWxzZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBudW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktbnVtYmVyJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpLWRhdGUtc3RhcnQnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgZW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpLWRhdGUtZW5kJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHB1YkRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktcHViLWRhdGUnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3Qgc2lnbmF0b3J5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpLXNpZ25hdG9yeScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCB0aGVtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS10aGVtZScpLnZhbHVlOwoKICAgICAgICAgICAgY29uc3QgYnVsbGV0aW4gPSB7CiAgICAgICAgICAgICAgICBpZDogY3VycmVudEJ1bGxldGluSWQsCiAgICAgICAgICAgICAgICBudW1iZXI6IG51bSwKICAgICAgICAgICAgICAgIGRhdGVTdGFydDogc3RhcnQsCiAgICAgICAgICAgICAgICBkYXRlRW5kOiBlbmQsCiAgICAgICAgICAgICAgICBwdWJEYXRlOiBwdWJEYXRlLAogICAgICAgICAgICAgICAgc2lnbmF0b3J5OiBzaWduYXRvcnksCiAgICAgICAgICAgICAgICB0aGVtZTogdGhlbWUsCiAgICAgICAgICAgICAgICBpdGVtczogY3VycmVudEl0ZW1zLAogICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGNvbnN0IGlkeCA9IGJ1bGxldGlucy5maW5kSW5kZXgoYiA9PiBiLmlkID09PSBjdXJyZW50QnVsbGV0aW5JZCk7CiAgICAgICAgICAgIGlmKGlkeCA+PSAwKSB7IGJ1bGxldGluc1tpZHhdID0gYnVsbGV0aW47IH0gZWxzZSB7IGJ1bGxldGlucy5wdXNoKGJ1bGxldGluKTsgfQogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYmliYXNlX2J1bGxldGlucycsIEpTT04uc3RyaW5naWZ5KGJ1bGxldGlucykpOwogICAgICAgICAgICByZW5kZXJCdWxsZXRpbkxpc3QoKTsgLy8gUmUtcmVuZGVyIHRvIHVwZGF0ZSB0aGUgbGlzdCB2aWV3CiAgICAgICAgICAgIGlmKGlzQXV0bykgc2hvd1NhdmVTdGF0dXMoKTsKICAgICAgICAgICAgfSBjYXRjaChlcnIpIHsgY29uc29sZS5lcnJvcignc2F2ZUN1cnJlbnRCdWxsZXRpbiBlcnJvcjonLCBlcnIpOyB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFYzOiBVcGRhdGVkIFJlbmRlciBMaXN0IHdpdGggRmlsdGVyCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyQnVsbGV0aW5MaXN0KCkgewogICAgICAgICAgICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGxldGluLWxpc3QnKTsKICAgICAgICAgICAgbGlzdC5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdldCBTZWFyY2ggUXVlcnkKICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoLWJ1bGxldGluJyk/LnZhbHVlLnRvTG93ZXJDYXNlKCkgfHwgIiI7CgogICAgICAgICAgICBjb25zdCBzb3J0ZWQgPSBidWxsZXRpbnMuc29ydCgoYSxiKSA9PiBiLmlkIC0gYS5pZCk7CiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkID0gc29ydGVkLmZpbHRlcihiID0+IHsKICAgICAgICAgICAgICAgICByZXR1cm4gYi5udW1iZXIudG9TdHJpbmcoKS5pbmNsdWRlcyhxdWVyeSkgfHwgYi5kYXRlU3RhcnQuaW5jbHVkZXMocXVlcnkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZpbHRlcmVkLmZvckVhY2goYiA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IGIuaWQgPT09IGN1cnJlbnRCdWxsZXRpbklkOwogICAgICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gYHctZnVsbCB0ZXh0LWxlZnQgcC00IHJvdW5kZWQteGwgYm9yZGVyIHRyYW5zaXRpb24tYWxsIGdyb3VwIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLXN0YXJ0IGN1cnNvci1wb2ludGVyIG1iLTIgJHtpc0FjdGl2ZSA/ICdiZy13aGl0ZS8xNSBib3JkZXItYmx1ZS00MDAvNTAgc2hhZG93LXNtJyA6ICdiZy10cmFuc3BhcmVudCBib3JkZXItdHJhbnNwYXJlbnQgaG92ZXI6Ymctd2hpdGUvMTAnfWA7CiAgICAgICAgICAgICAgICBkaXYub25jbGljayA9ICgpID0+IGxvYWRCdWxsZXRpbihiLmlkKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHBhcnNlTG9jYWxEYXRlKGIuZGF0ZVN0YXJ0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVEaXNwbGF5ID0gc3RhcnREYXRlID8gc3RhcnREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInLCB7ZGF5OidudW1lcmljJywgbW9udGg6J251bWVyaWMnfSkgOiAnLi4uJzsKICAgICAgICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIG1iLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCAke2lzQWN0aXZlID8gJ3RleHQtd2hpdGUnIDogJ3RleHQtc2xhdGUtMjAwJ30iPkJ1bGxldGluIE5cdTAwYjAke2IubnVtYmVyfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNsYXRlLTQwMCIgc3R5bGU9ImZvbnQtc2l6ZToxMHB4Ij4ke25ldyBEYXRlKGIubGFzdE1vZGlmaWVkKS50b0xvY2FsZURhdGVTdHJpbmcoKX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXhzICR7aXNBY3RpdmUgPyAndGV4dC1ibHVlLTMwMCcgOiAndGV4dC1zbGF0ZS00MDAnfSI+U2VtYWluZSBkdSAke2RhdGVEaXNwbGF5fTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246cm93O2dhcDo0cHg7bWFyZ2luLXRvcDo2cHg7ZmxleC13cmFwOndyYXA7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7bG9hZEJ1bGxldGluKCR7Yi5pZH0pO29wZW5CaVBhcmFtcygpIiBzdHlsZT0iY29sb3I6IzkzYzVmZDtwYWRkaW5nOjNweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXIiIHRpdGxlPSJQYXJhbVx1MDBlOHRyZXMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIj48cGF0aCBkPSJNMTcgM2EyLjg1IDIuODMgMCAxMTQgNEw3LjUgMjAuNSAyIDIybDEuNS01LjVaIi8+PC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7bG9hZEJ1bGxldGluKCR7Yi5pZH0pO3NldFRpbWVvdXQoZ2VuZXJhdGVQREYsMzAwKSIgc3R5bGU9ImNvbG9yOiNmY2E1YTU7cGFkZGluZzozcHg7Ym9yZGVyLXJhZGl1czo2cHg7YmFja2dyb3VuZDpub25lO2JvcmRlcjpub25lO2N1cnNvcjpwb2ludGVyIiB0aXRsZT0iUERGIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyB3aWR0aD0iMTMiIGhlaWdodD0iMTMiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiI+PHBhdGggZD0iTTE0IDJINmEyIDIgMCAwIDAtMiAydjE2YTIgMiAwIDAgMCAyIDJoMTJhMiAyIDAgMCAwIDItMlY4eiIvPjxwb2x5bGluZSBwb2ludHM9IjE0IDIgMTQgOCAyMCA4Ii8+PGxpbmUgeDE9IjE2IiB5MT0iMTMiIHgyPSI4IiB5Mj0iMTMiLz48bGluZSB4MT0iMTYiIHkxPSIxNyIgeDI9IjgiIHkyPSIxNyIvPjwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO2xvYWRCdWxsZXRpbigke2IuaWR9KTtzZXRUaW1lb3V0KGdlbmVyYXRlRE9DWCwzMDApIiBzdHlsZT0iY29sb3I6IzkzYzVmZDtwYWRkaW5nOjNweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXIiIHRpdGxlPSJXb3JkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN2ZyB3aWR0aD0iMTMiIGhlaWdodD0iMTMiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiI+PHBhdGggZD0iTTQgMnYyMGgxNlY4bC02LTZINHoiLz48cG9seWxpbmUgcG9pbnRzPSIxNCAyIDE0IDggMjAgOCIvPjxwYXRoIGQ9Ik04IDEzbDIgNCAyLTQgMiA0IDItNCIvPjwvc3ZnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImR1cGxpY2F0ZUJ1bGxldGluKGV2ZW50LCAke2IuaWR9KSIgc3R5bGU9ImNvbG9yOnJnYmEoMjU1LDI1NSwyNTUsLjU1KTtwYWRkaW5nOjNweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXIiIHRpdGxlPSJEdXBsaXF1ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMyI+PHVzZSBocmVmPSIjaWNvbi1jb3B5Ij48L3VzZT48L3N2Zz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJkZWxldGVCdWxsZXRpbihldmVudCwgJHtiLmlkfSkiIHN0eWxlPSJjb2xvcjpyZ2JhKDI1NSwyNTUsMjU1LC40KTtwYWRkaW5nOjNweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y3Vyc29yOnBvaW50ZXIiIHRpdGxlPSJTdXBwcmltZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMyI+PHVzZSBocmVmPSIjaWNvbi10cmFzaCI+PC91c2U+PC9zdmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CmA7CiAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoZmlsdGVyZWQubGVuZ3RoID09PSAwICYmIGJ1bGxldGlucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgbGlzdC5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC00IHRleHQtc2xhdGUtNDAwIHRleHQtc20iPkF1Y3VuIGJ1bGxldGluIHRyb3V2w6kgcG91ciAiJHtxdWVyeX0iPC9kaXY+YDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBwYXJzZUxvY2FsRGF0ZShkYXRlU3RyaW5nKSB7CiAgICAgICAgICAgICBpZiAoIWRhdGVTdHJpbmcpIHJldHVybiBudWxsOwogICAgICAgICAgICAgY29uc3QgW3llYXIsIG1vbnRoLCBkYXldID0gZGF0ZVN0cmluZy5zcGxpdCgnLScpLm1hcChOdW1iZXIpOwogICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgZGF5KTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBQUkVWSUVXIC0tLQogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVByZXZpZXcoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZGYtY29udGVudCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTGF5b3V0ICYgRm9udCBDbGFzc2VzIGZyb20gU2V0dGluZ3MKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gZXN0YWJsaXNobWVudC5sYXlvdXQgfHwgJ2NsYXNzaWMnOwogICAgICAgICAgICBjb25zdCBmb250ID0gZXN0YWJsaXNobWVudC5mb250IHx8ICdpbnRlcic7CiAgICAgICAgICAgIGNvbnN0IGZvbnRDbGFzcyA9IGZvbnQgPT09ICdzZXJpZicgPyAnZm9udC1zZXJpZicgOiAoZm9udCA9PT0gJ21vbm8nID8gJ2ZvbnQtbW9ubycgOiAnZm9udC1pbnRlcicpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ3VzdG9tIHRleHRzCiAgICAgICAgICAgIGNvbnN0IGRvY1RpdGxlID0gZXN0YWJsaXNobWVudC5kb2NUaXRsZSB8fCAiQnVsbGV0aW4gZCdpbmZvcm1hdGlvbiI7CiAgICAgICAgICAgIGNvbnN0IGRvY0Zvb3RlciA9IGVzdGFibGlzaG1lbnQuZG9jRm9vdGVyIHx8ICIiOwoKICAgICAgICAgICAgLy8gQXBwbHkgZm9udCB0byBjb250YWluZXIKICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IGBhNC1wYWdlICR7Zm9udENsYXNzfSBsYXlvdXQtJHtsYXlvdXR9YDsKCiAgICAgICAgICAgIGNvbnN0IG51bSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1udW1iZXInKS52YWx1ZTsKICAgICAgICAgICAgY29uc3Qgc3RhcnRWYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktZGF0ZS1zdGFydCcpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBlbmRWYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktZGF0ZS1lbmQnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgcHViRGF0ZVZhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1wdWItZGF0ZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBzaWduYXRvcnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktc2lnbmF0b3J5JykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHRoZW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JpLXRoZW1lJykudmFsdWUgfHwgJ2JsdWUnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVEhFTUUgQ09ORklHCiAgICAgICAgICAgIGNvbnN0IHRoZW1lQ29uZmlnID0gewogICAgICAgICAgICAgICAgYmx1ZTogIHsgbWFpbjogJ3RleHQtYmx1ZS05MDAnLCBib3JkZXI6ICdib3JkZXItYmx1ZS04MDAnLCBiYWRnZTogJ2JnLWJsdWUtODAwJywgc3ViQm9yZGVyOiAnYm9yZGVyLWJsdWUtMTAwJywgYWNjZW50OiAndGV4dC1vcmFuZ2UtNjAwJywgdGl0bGU6ICd0ZXh0LWJsdWUtOTAwJyB9LAogICAgICAgICAgICAgICAgcmVkOiAgIHsgbWFpbjogJ3RleHQtcmVkLTkwMCcsICBib3JkZXI6ICdib3JkZXItcmVkLTgwMCcsICBiYWRnZTogJ2JnLXJlZC04MDAnLCAgc3ViQm9yZGVyOiAnYm9yZGVyLXJlZC0xMDAnLCAgYWNjZW50OiAndGV4dC1zbGF0ZS02MDAnLCAgdGl0bGU6ICd0ZXh0LXJlZC05MDAnIH0sCiAgICAgICAgICAgICAgICBncmVlbjogeyBtYWluOiAndGV4dC1lbWVyYWxkLTkwMCcsIGJvcmRlcjogJ2JvcmRlci1lbWVyYWxkLTgwMCcsIGJhZGdlOiAnYmctZW1lcmFsZC04MDAnLCBzdWJCb3JkZXI6ICdib3JkZXItZW1lcmFsZC0xMDAnLCBhY2NlbnQ6ICd0ZXh0LWVtZXJhbGQtNjAwJywgdGl0bGU6ICd0ZXh0LWdyZWVuLTkwMCcgfSwKICAgICAgICAgICAgICAgIGdyZXk6ICB7IG1haW46ICd0ZXh0LXNsYXRlLTkwMCcsIGJvcmRlcjogJ2JvcmRlci1zbGF0ZS04MDAnLCBiYWRnZTogJ2JnLXNsYXRlLTgwMCcsIHN1YkJvcmRlcjogJ2JvcmRlci1zbGF0ZS0yMDAnLCBhY2NlbnQ6ICd0ZXh0LXNsYXRlLTUwMCcsIHRpdGxlOiAndGV4dC1zbGF0ZS05MDAnIH0sCiAgICAgICAgICAgICAgICBwdXJwbGU6eyBtYWluOiAndGV4dC1wdXJwbGUtOTAwJywgYm9yZGVyOiAnYm9yZGVyLXB1cnBsZS04MDAnLCBiYWRnZTogJ2JnLXB1cnBsZS04MDAnLCBzdWJCb3JkZXI6ICdib3JkZXItcHVycGxlLTEwMCcsIGFjY2VudDogJ3RleHQtcGluay02MDAnLCB0aXRsZTogJ3RleHQtcHVycGxlLTkwMCcgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCB0ID0gdGhlbWVDb25maWdbdGhlbWVdIHx8IHRoZW1lQ29uZmlnLmJsdWU7CgogICAgICAgICAgICBjb25zdCBzdGFydCA9IHBhcnNlTG9jYWxEYXRlKHN0YXJ0VmFsKTsKICAgICAgICAgICAgY29uc3QgZW5kID0gcGFyc2VMb2NhbERhdGUoZW5kVmFsKTsKICAgICAgICAgICAgY29uc3QgcHViRGF0ZU9iaiA9IHBhcnNlTG9jYWxEYXRlKHB1YkRhdGVWYWwpOwogICAgICAgICAgICBjb25zdCBvcHRpb25zTW9udGggPSB7IG1vbnRoOiAnbG9uZycgfTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCBwdWJEYXRlU3RyID0gIiI7CiAgICAgICAgICAgIGlmKHB1YkRhdGVPYmopIHsKICAgICAgICAgICAgICAgICBjb25zdCBkID0gcHViRGF0ZU9iai5nZXREYXRlKCk7CiAgICAgICAgICAgICAgICAgY29uc3QgbSA9IHB1YkRhdGVPYmoudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicsIG9wdGlvbnNNb250aCk7CiAgICAgICAgICAgICAgICAgY29uc3QgeSA9IHB1YkRhdGVPYmouZ2V0RnVsbFllYXIoKTsKICAgICAgICAgICAgICAgICBwdWJEYXRlU3RyID0gYCR7ZH0mbmJzcDske219Jm5ic3A7JHt5fWA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgICAgcHViRGF0ZVN0ciA9IGAke3QuZ2V0RGF0ZSgpfSZuYnNwOyR7dC50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJywgb3B0aW9uc01vbnRoKX0mbmJzcDske3QuZ2V0RnVsbFllYXIoKX1gOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgZGF0ZVN0ciA9ICJTZW1haW5lIGR1IC4uLiI7CiAgICAgICAgICAgIGlmIChzdGFydCAmJiBlbmQgJiYgIWlzTmFOKHN0YXJ0KSkgewogICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF5ID0gc3RhcnQuZ2V0RGF0ZSgpOwogICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0TW9udGggPSBzdGFydC50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJywgb3B0aW9uc01vbnRoKTsKICAgICAgICAgICAgICAgICBjb25zdCBlbmREYXkgPSBlbmQuZ2V0RGF0ZSgpOwogICAgICAgICAgICAgICAgIGNvbnN0IGVuZE1vbnRoID0gZW5kLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInLCBvcHRpb25zTW9udGgpOwogICAgICAgICAgICAgICAgIGNvbnN0IGVuZFllYXIgPSBlbmQuZ2V0RnVsbFllYXIoKTsKICAgICAgICAgICAgICAgICBkYXRlU3RyID0gYER1Jm5ic3A7JHtzdGFydERheX0mbmJzcDske3N0YXJ0TW9udGh9Jm5ic3A7YXUmbmJzcDske2VuZERheX0mbmJzcDske2VuZE1vbnRofSZuYnNwOyR7ZW5kWWVhcn1gOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBncm91cGVkID0ge307CiAgICAgICAgICAgIGN1cnJlbnRJdGVtcy5mb3JFYWNoKGl0ZW0gPT4geyBpZighZ3JvdXBlZFtpdGVtLmNhdGVnb3J5XSkgZ3JvdXBlZFtpdGVtLmNhdGVnb3J5XSA9IFtdOyBncm91cGVkW2l0ZW0uY2F0ZWdvcnldLnB1c2goaXRlbSk7IH0pOwoKICAgICAgICAgICAgLy8gLS0tIERZTkFNSUMgSEVBREVSIEdFTkVSQVRJT04gLS0tCiAgICAgICAgICAgIGxldCBoZWFkZXJIdG1sID0gJyc7CgogICAgICAgICAgICAvLyBIYW5kbGUgbGluZSBicmVhayByZXBsYWNlbWVudCBpbiB0aXRsZSBpZiBuZWVkZWQsIGJ1dCBmbGV4IHdyYXAgaGFuZGxlcyBzdGFuZGFyZCBzcGFjZXMuCiAgICAgICAgICAgIC8vIElmIHVzZXIgdHlwZXMgPGJyPiwgaXQgd2lsbCByZW5kZXIuCiAgICAgICAgICAgIAogICAgICAgICAgICBpZihsYXlvdXQgPT09ICdtb2Rlcm4nKSB7CiAgICAgICAgICAgICAgICAvLyBDRU5UUsOJCiAgICAgICAgICAgICAgICBoZWFkZXJIdG1sID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIHRleHQtY2VudGVyIGhlYWRlci1ibG9jayAke3QuYm9yZGVyfSI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7ZXN0YWJsaXNobWVudC5sb2dvID8gYDxpbWcgc3JjPSIke2VzdGFibGlzaG1lbnQubG9nb30iIGNsYXNzPSJoLTI0IG9iamVjdC1jb250YWluIG1iLTQiIC8+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICA8aDEgY2xhc3M9InRleHQtM3hsIGZvbnQtYmxhY2sgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVzdCAke3QudGl0bGV9IG1iLTIgbGVhZGluZy10aWdodCI+JHtkb2NUaXRsZX08L2gxPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXNsYXRlLTcwMCBtYi0yIj4ke2VzdGFibGlzaG1lbnQubmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMgdGV4dC1zbSB0ZXh0LXNsYXRlLTUwMCBmb250LW1lZGl1bSBiZy1zbGF0ZS01MCBweC00IHB5LTEgcm91bmRlZC1mdWxsIGJvcmRlciBib3JkZXItc2xhdGUtMTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPk7CsCR7bnVtfTwvc3Bhbj4gPHNwYW4gY2xhc3M9InRleHQtc2xhdGUtMzAwIj7igKI8L3NwYW4+IDxzcGFuPiR7ZGF0ZVN0cn08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSBlbHNlIGlmIChsYXlvdXQgPT09ICdiYW5uZXInKSB7CiAgICAgICAgICAgICAgICAvLyBCQU5ERUFVCiAgICAgICAgICAgICAgICBoZWFkZXJIdG1sID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImhlYWRlci1ibG9jayI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9IiR7dC5iYWRnZX0gcC02IHRleHQtd2hpdGUgZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIHJvdW5kZWQtdC14bCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDEgY2xhc3M9InRleHQtMnhsIGZvbnQtYmxhY2sgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVzdCBtYi0xIj4ke2RvY1RpdGxlfTwvaDE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJvcGFjaXR5LTkwIHRleHQtc20gZm9udC1tZWRpdW0iPk7CsCR7bnVtfSDigKIgJHtkYXRlU3RyfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtlc3RhYmxpc2htZW50LmxvZ28gPyBgPGltZyBzcmM9IiR7ZXN0YWJsaXNobWVudC5sb2dvfSIgY2xhc3M9ImgtMTYgdy0xNiBvYmplY3QtY29udGFpbiBiZy13aGl0ZSByb3VuZGVkLWxnIHAtMSBzaGFkb3ctc20iIC8+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctc2xhdGUtNTAgcC0zIGJvcmRlci14IGJvcmRlci1iIGJvcmRlci1zbGF0ZS0yMDAgdGV4dC1jZW50ZXIgdGV4dC14cyBmb250LWJvbGQgdXBwZXJjYXNlIHRleHQtc2xhdGUtNTAwIHRyYWNraW5nLXdpZGUgcm91bmRlZC1iLXhsIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7ZXN0YWJsaXNobWVudC5uYW1lfSDigKIgJHtlc3RhYmxpc2htZW50LmFkZHJlc3N9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIENMQVNTSUMgKERlZmF1bHQpCiAgICAgICAgICAgICAgICBoZWFkZXJIdG1sID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWVuZCBoZWFkZXItYmxvY2sgJHt0LmJvcmRlcn0iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTEvMiBmbGV4IGZsZXgtY29sIGl0ZW1zLXN0YXJ0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7ZXN0YWJsaXNobWVudC5sb2dvID8gYDxpbWcgc3JjPSIke2VzdGFibGlzaG1lbnQubG9nb30iIGNsYXNzPSJoLTI0IG9iamVjdC1jb250YWluIG1iLTMiIC8+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXNsYXRlLTkwMCB0ZXh0LWxnIGxlYWRpbmctdGlnaHQiPiR7ZXN0YWJsaXNobWVudC5uYW1lfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtc2xhdGUtNjAwIj4ke2VzdGFibGlzaG1lbnQuYWRkcmVzc308L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTEvMiB0ZXh0LXJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3QgJHt0LnRpdGxlfSBsZWFkaW5nLXRpZ2h0IG1iLTIiPiR7ZG9jVGl0bGV9PC9oMT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtNHhsIGZvbnQtYmxhY2sgdGV4dC1zbGF0ZS04MDAiPk7CsCR7bnVtfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9Im10LTIgZm9udC1tZWRpdW0gJHt0LmFjY2VudH0iPiR7ZGF0ZVN0cn08L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGh0bWwgPSBoZWFkZXJIdG1sOwoKICAgICAgICAgICAgbGV0IGNvdW50ZXIgPSAxOwogICAgICAgICAgICBtYXN0ZXJDYXRlZ29yaWVzLmZvckVhY2goY2F0ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gZ3JvdXBlZFtjYXRdOwogICAgICAgICAgICAgICAgaWYoaXRlbXMgJiYgaXRlbXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYi02IGJyZWFrLWluc2lkZS1hdm9pZCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtbGcgZm9udC1ib2xkICR7dC5tYWlufSBib3JkZXItYiAke3Quc3ViQm9yZGVyfSBwYi0xIG1iLTMgdXBwZXJjYXNlIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iJHt0LmJhZGdlfSB0ZXh0LXdoaXRlIHctNiBoLTYgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC1mdWxsIHRleHQteHMgZm9udC1ib2xkIj4ke2NvdW50ZXJ9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7Y2F0fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9oMj4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmKGNhdC5pbmNsdWRlcygnQUdFTkRBJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgPHRhYmxlIGNsYXNzPSJ3LWZ1bGwgdGV4dC1zbSBib3JkZXItY29sbGFwc2UiPmA7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5RGF0ZSA9IGZvcm1hdERhdGVGb3JEaXNwbGF5KGl0ZW0uZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9ImJvcmRlci1iIGJvcmRlci1zbGF0ZS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgZm9udC1ib2xkICR7dC5hY2NlbnR9IHctMS80IGFsaWduLXRvcCB1cHBlcmNhc2UgdGV4dC14cyB0cmFja2luZy13aWRlIGNhcGl0YWxpemUiPiR7ZGlzcGxheURhdGUgfHwgJyd9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIGFsaWduLXRvcCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb250LWJvbGQgdGV4dC1zbGF0ZS04MDAiPiR7aXRlbS50aXRsZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtc2xhdGUtNjAwIHRleHQteHMgbXQtMSByaWNoLXRleHQtY29udGVudCI+JHtpdGVtLmNvbnRlbnR9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9IGA8L3RhYmxlPmA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlEYXRlID0gZm9ybWF0RGF0ZUZvckRpc3BsYXkoaXRlbS5kYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVIdG1sID0gZGlzcGxheURhdGUgPyBgPHNwYW4gY2xhc3M9IiR7dC5hY2NlbnR9IGZvbnQtYm9sZCBtci0xIHRleHQteHMgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGUgY2FwaXRhbGl6ZSI+WyR7ZGlzcGxheURhdGV9XTwvc3Bhbj5gIDogJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYi0zIHBsLTQgYm9yZGVyLWwtNCBib3JkZXItc2xhdGUtMTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtpdGVtLnRpdGxlID8gYDxkaXYgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXNsYXRlLTgwMCB0ZXh0LXNtIG1iLTEiPiR7ZGF0ZUh0bWx9JHtpdGVtLnRpdGxlfTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1zbSB0ZXh0LXNsYXRlLTcwMCB0ZXh0LWp1c3RpZnkgbGVhZGluZy1yZWxheGVkIHJpY2gtdGV4dC1jb250ZW50Ij4keyFpdGVtLnRpdGxlID8gZGF0ZUh0bWwgOiAnJ30ke2l0ZW0uY29udGVudH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBodG1sICs9IGA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBTaWduYXRhaXJlCiAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMTIgcHQtNCBib3JkZXItdC0yIGJvcmRlci1zbGF0ZS0xMDAgYnJlYWstaW5zaWRlLWF2b2lkIGZsZXgganVzdGlmeS1lbmQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtc2xhdGUtODAwIG1iLTEiPkZhaXQgbGUgOiAke3B1YkRhdGVTdHJ9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbGF0ZS02MDAgdGV4dC1zbSBpdGFsaWMiPnBhciAke3NpZ25hdG9yeX0sPC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGb290ZXIgRml4ZSAoQ3VzdG9tKQogICAgICAgICAgICBpZihkb2NGb290ZXIpIHsKICAgICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9InBkZi1mb290ZXItZml4ZWQiPiR7ZG9jRm9vdGVyfTwvZGl2PmA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVQREYoKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgaHRtbDJwZGYgPT09ICd1bmRlZmluZWQnKSB7IGFsZXJ0KCdMZSBtb2R1bGUgUERGIGVzdCBlbiBjb3VycyBkZSBjaGFyZ2VtZW50LiBSw6llc3NheWV6IGRhbnMgcXVlbHF1ZXMgc2Vjb25kZXMuJyk7IHJldHVybjsgfQogICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BkZi1jb250ZW50Jyk7CiAgICAgICAgICAgIGNvbnN0IG51bSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1udW1iZXInKS52YWx1ZTsKICAgICAgICAgICAgY29uc3Qgb3B0ID0gewogICAgICAgICAgICAgICAgbWFyZ2luOiAgICAgICAwLAogICAgICAgICAgICAgICAgZmlsZW5hbWU6ICAgICBgQklfTiR7bnVtfV8ke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKX0ucGRmYCwKICAgICAgICAgICAgICAgIGltYWdlOiAgICAgICAgeyB0eXBlOiAnanBlZycsIHF1YWxpdHk6IDAuOTggfSwKICAgICAgICAgICAgICAgIGh0bWwyY2FudmFzOiAgeyBzY2FsZTogMiB9LAogICAgICAgICAgICAgICAganNQREY6ICAgICAgICB7IHVuaXQ6ICdtbScsIGZvcm1hdDogJ2E0Jywgb3JpZW50YXRpb246ICdwb3J0cmFpdCcgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBodG1sMnBkZigpLnNldChvcHQpLmZyb20oZWxlbWVudCkuc2F2ZSgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVET0NYKCkgewogICAgICAgICAgICBpZiAodHlwZW9mIGh0bWxEb2N4ID09PSAndW5kZWZpbmVkJykgeyBhbGVydCgnTGUgbW9kdWxlIFdvcmQgZXN0IGVuIGNvdXJzIGRlIGNoYXJnZW1lbnQuIFLDqWVzc2F5ZXogZGFucyBxdWVscXVlcyBzZWNvbmRlcy4nKTsgcmV0dXJuOyB9CiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGRmLWNvbnRlbnQnKS5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IGNzc1dvcmQgPSBgCiAgICAgICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnQXJpYWwnLCBzYW5zLXNlcmlmOyBmb250LXNpemU6IDExcHQ7IGxpbmUtaGVpZ2h0OiAxLjU7IGNvbG9yOiAjMWUyOTNiOyB9CiAgICAgICAgICAgICAgICAgICAgaDEgeyBjb2xvcjogIzFlNDBhZjsgZm9udC1zaXplOiAyMHB0OyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBmb250LXdlaWdodDogYm9sZDsgbWFyZ2luLWJvdHRvbTogNXB4OyB9CiAgICAgICAgICAgICAgICAgICAgaDIgeyBjb2xvcjogIzFlNDBhZjsgZm9udC1zaXplOiAxNHB0OyBib3JkZXItYm90dG9tOiAycHggc29saWQgI2JmZGJmZTsgcGFkZGluZy1ib3R0b206IDVweDsgbWFyZ2luLXRvcDogMTVweDsgbWFyZ2luLWJvdHRvbTogMTBweDsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgfQogICAgICAgICAgICAgICAgICAgIC5oZWFkZXItYmxvY2sgeyBtYXJnaW4tYm90dG9tOiAyMHB4OyBib3JkZXItYm90dG9tOiAycHggc29saWQgIzFkNGVkODsgcGFkZGluZy1ib3R0b206IDEwcHg7IH0KICAgICAgICAgICAgICAgICAgICBwIHsgbWFyZ2luLWJvdHRvbTogOHB4OyB9CiAgICAgICAgICAgICAgICAgICAgdGFibGUgeyB3aWR0aDogMTAwJTsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsgbWFyZ2luLWJvdHRvbTogMTVweDsgfQogICAgICAgICAgICAgICAgICAgIHRkIHsgcGFkZGluZzogNnB4OyB2ZXJ0aWNhbC1hbGlnbjogdG9wOyBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2UyZThmMDsgfQogICAgICAgICAgICAgICAgICAgIC5mb250LWJvbGQgeyBmb250LXdlaWdodDogYm9sZDsgfQogICAgICAgICAgICAgICAgICAgIC5pdGFsaWMgeyBmb250LXN0eWxlOiBpdGFsaWM7IH0KICAgICAgICAgICAgICAgICAgICAudGV4dC1yaWdodCB7IHRleHQtYWxpZ246IHJpZ2h0OyB9CiAgICAgICAgICAgICAgICAgICAgLnRleHQtY2VudGVyIHsgdGV4dC1hbGlnbjogY2VudGVyOyB9CiAgICAgICAgICAgICAgICAgICAgLnVwcGVyY2FzZSB7IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IH0KICAgICAgICAgICAgICAgICAgICAudGV4dC1ibHVlLTkwMCB7IGNvbG9yOiAjMWUzYThhOyB9CiAgICAgICAgICAgICAgICAgICAgLnRleHQtb3JhbmdlLTYwMCB7IGNvbG9yOiAjZWE1ODBjOyB9CiAgICAgICAgICAgICAgICAgICAgLnRleHQtc2xhdGUtNTAwIHsgY29sb3I6ICM2NDc0OGI7IH0KICAgICAgICAgICAgICAgICAgICAudGV4dC14cyB7IGZvbnQtc2l6ZTogOXB0OyB9CiAgICAgICAgICAgICAgICAgICAgdWwgeyBtYXJnaW4tbGVmdDogMjBweDsgbGlzdC1zdHlsZS10eXBlOiBkaXNjOyB9CiAgICAgICAgICAgICAgICAgICAgb2wgeyBtYXJnaW4tbGVmdDogMjBweDsgbGlzdC1zdHlsZS10eXBlOiBkZWNpbWFsOyB9CiAgICAgICAgICAgICAgICA8L3N0eWxlPgogICAgICAgICAgICBgOwoKICAgICAgICAgICAgY29uc3QgaHRtbFN0cmluZyA9IGAKICAgICAgICAgICAgICAgIDwhRE9DVFlQRSBodG1sPgogICAgICAgICAgICAgICAgPGh0bWw+CiAgICAgICAgICAgICAgICA8aGVhZD4KICAgICAgICAgICAgICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgICAgICAgICAgICAgJHtjc3NXb3JkfQogICAgICAgICAgICAgICAgPC9oZWFkPgogICAgICAgICAgICAgICAgPGJvZHk+CiAgICAgICAgICAgICAgICAgICAgJHtjb250ZW50LmlubmVySFRNTH0KICAgICAgICAgICAgICAgIDwvYm9keT4KICAgICAgICAgICAgICAgIDwvaHRtbD4KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb252ZXJ0ZWQgPSBodG1sRG9jeC5hc0Jsb2IoaHRtbFN0cmluZywgewogICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uOiAncG9ydHJhaXQnLAogICAgICAgICAgICAgICAgICAgIG1hcmdpbnM6IHsgdG9wOiA3MjAsIHJpZ2h0OiA3MjAsIGJvdHRvbTogNzIwLCBsZWZ0OiA3MjAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IG51bSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1udW1iZXInKS52YWx1ZTsKICAgICAgICAgICAgICAgIHNhdmVBcyhjb252ZXJ0ZWQsIGBCSV9OJHtudW19XyR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApfS5kb2N4YCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCJFcnJldXIgbG9ycyBkZSBsYSBnw6luw6lyYXRpb24gV29yZCA6ICIgKyBlLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0RGF0YSgpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGVzdGFibGlzaG1lbnQsIGJ1bGxldGlucywgCiAgICAgICAgICAgICAgICBjYXRlZ29yaWVzOiBtYXN0ZXJDYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgZXhwb3J0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgdmVyc2lvbjogImJpYmFzZS12My4wIgogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBkYXRhU3RyID0gImRhdGE6dGV4dC9qc29uO2NoYXJzZXQ9dXRmLTgsIiArIGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICAgIGNvbnN0IGRvd25sb2FkQW5jaG9yTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgZG93bmxvYWRBbmNob3JOb2RlLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGRhdGFTdHIpOwogICAgICAgICAgICBkb3dubG9hZEFuY2hvck5vZGUuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIGBiaWJhc2Vfc2F1dmVnYXJkZV8ke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKX0uanNvbmApOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRvd25sb2FkQW5jaG9yTm9kZSk7CiAgICAgICAgICAgIGRvd25sb2FkQW5jaG9yTm9kZS5jbGljaygpOwogICAgICAgICAgICBkb3dubG9hZEFuY2hvck5vZGUucmVtb3ZlKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpbXBvcnREYXRhKGlucHV0KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBpbnB1dC5maWxlc1swXTsKICAgICAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGUudGFyZ2V0LnJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgaWYoY29uZmlybSgi4pqg77iPIEF0dGVudGlvbiA6IENlbGEgdmEgcmVtcGxhY2VyIHRvdXRlcyB2b3MgZG9ubsOpZXMgYWN0dWVsbGVzIHBhciBjZWxsZXMgZHUgZmljaGllci4gQ29udGludWVyID8iKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5lc3RhYmxpc2htZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlc3RhYmxpc2htZW50ID0gZGF0YS5lc3RhYmxpc2htZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JpYmFzZV9lc3RhYmxpc2htZW50JywgSlNPTi5zdHJpbmdpZnkoZXN0YWJsaXNobWVudCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmJ1bGxldGlucykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVsbGV0aW5zID0gZGF0YS5idWxsZXRpbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYmliYXNlX2J1bGxldGlucycsIEpTT04uc3RyaW5naWZ5KGJ1bGxldGlucykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmNhdGVnb3JpZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hc3RlckNhdGVnb3JpZXMgPSBkYXRhLmNhdGVnb3JpZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ2F0ZWdvcmllcygpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuY3VzdG9tQ2F0ZWdvcmllcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFzdGVyQ2F0ZWdvcmllcyA9IFsuLi5ERUZBVUxUX0NBVEVHT1JJRVMsIC4uLmRhdGEuY3VzdG9tQ2F0ZWdvcmllc107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ2F0ZWdvcmllcygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCLinIUgRG9ubsOpZXMgcmVzdGF1csOpZXMgYXZlYyBzdWNjw6hzICEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7IGFsZXJ0KCLinYwgRXJyZXVyIDogTGUgZmljaGllciBzZW1ibGUgaW52YWxpZGUuIik7IH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZXNldERhdGEoKSB7CiAgICAgICAgICAgIGlmKGNvbmZpcm0oIuKaoO+4jyBBVFRFTlRJT04gOiBUb3V0IGVmZmFjZXIgPyIpKSB7CiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGFsZXJ0KCLimbvvuI8gQXBwbGljYXRpb24gcsOpaW5pdGlhbGlzw6llLiIpOwogICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9wZW5TZXR0aW5ncygpIHsgLyogbW92ZWQgdG8gd3JhcHBlciBBbHQrUCAqLyB9CiAgICAgICAgZnVuY3Rpb24gY2xvc2VTZXR0aW5ncygpIHt9CiAgICAgICAgZnVuY3Rpb24gaGFuZGxlTG9nb1VwbG9hZChpbnB1dCkgeyAvKiBsb2dvIGZyb20gd3JhcHBlciAqLyB9CiAgICAgICAgZnVuY3Rpb24gc2F2ZVNldHRpbmdzKCkgeyAvKiBtb3ZlZCB0byB3cmFwcGVyICovIH0KICAgIAogICAgICAgIC8vIExpc3RlbiBmb3Igc2V0dGluZ3MgZnJvbSBDQURJUiB3cmFwcGVyCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGlmICghZS5kYXRhKSByZXR1cm47CiAgICAgICAgICAgIGlmIChlLmRhdGEudHlwZSA9PT0gJ3BpbG90ZS1zZXR0aW5ncycpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gZS5kYXRhLmRhdGE7CiAgICAgICAgICAgICAgICBpZiAoZC5zY2hvb2wpIGVzdGFibGlzaG1lbnQubmFtZSA9IGQuc2Nob29sOwogICAgICAgICAgICAgICAgaWYgKGQuY2l0eSkgZXN0YWJsaXNobWVudC5hZGRyZXNzID0gZC5jaXR5OwogICAgICAgICAgICAgICAgaWYgKGQubG9nb1NyYykgZXN0YWJsaXNobWVudC5sb2dvID0gZC5sb2dvU3JjOwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JpYmFzZV9lc3RhYmxpc2htZW50JywgSlNPTi5zdHJpbmdpZnkoZXN0YWJsaXNobWVudCkpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB1cGRhdGVQcmV2aWV3ID09PSAnZnVuY3Rpb24nKSB1cGRhdGVQcmV2aWV3KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGUuZGF0YS50eXBlID09PSAnYmliYXNlLXNldHRpbmdzJykgewogICAgICAgICAgICAgICAgdmFyIHMgPSBlLmRhdGEuZGF0YTsKICAgICAgICAgICAgICAgIGlmIChzLmxheW91dCkgZXN0YWJsaXNobWVudC5sYXlvdXQgPSBzLmxheW91dDsKICAgICAgICAgICAgICAgIGlmIChzLmZvbnQpIGVzdGFibGlzaG1lbnQuZm9udCA9IHMuZm9udDsKICAgICAgICAgICAgICAgIGlmIChzLmRlZmF1bHRTaWduYXRvcnkpIGVzdGFibGlzaG1lbnQuZGVmYXVsdFNpZ25hdG9yeSA9IHMuZGVmYXVsdFNpZ25hdG9yeTsKICAgICAgICAgICAgICAgIGlmIChzLmRvY1RpdGxlKSBlc3RhYmxpc2htZW50LmRvY1RpdGxlID0gcy5kb2NUaXRsZTsKICAgICAgICAgICAgICAgIGlmIChzLmRvY0Zvb3RlciAhPT0gdW5kZWZpbmVkKSBlc3RhYmxpc2htZW50LmRvY0Zvb3RlciA9IHMuZG9jRm9vdGVyOwogICAgICAgICAgICAgICAgaWYgKHMubmFtZSkgZXN0YWJsaXNobWVudC5uYW1lID0gcy5uYW1lOwogICAgICAgICAgICAgICAgaWYgKHMuYWRkcmVzcykgZXN0YWJsaXNobWVudC5hZGRyZXNzID0gcy5hZGRyZXNzOwogICAgICAgICAgICAgICAgaWYgKHMubG9nbykgZXN0YWJsaXNobWVudC5sb2dvID0gcy5sb2dvOwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2JpYmFzZV9lc3RhYmxpc2htZW50JywgSlNPTi5zdHJpbmdpZnkoZXN0YWJsaXNobWVudCkpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB1cGRhdGVQcmV2aWV3ID09PSAnZnVuY3Rpb24nKSB1cGRhdGVQcmV2aWV3KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIAogICAgICAgIC8vIEZhbGxiYWNrOiBpZiBET01Db250ZW50TG9hZGVkIGFscmVhZHkgZmlyZWQsIHJ1biBpbml0CiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2ludGVyYWN0aXZlJykgewogICAgICAgICAgICBzZXRUaW1lb3V0KGluaXRBcHAsIDIwMCk7CiAgICAgICAgfQogICAgCiAgICBmdW5jdGlvbiBvcGVuQmlQYXJhbXMoKSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaS1wYXJhbXMtbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyB9CiAgICBmdW5jdGlvbiBjbG9zZUJpUGFyYW1zKCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmktcGFyYW1zLW1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgc2F2ZUN1cnJlbnRCdWxsZXRpbigpOyByZW5kZXJCdWxsZXRpbkxpc3QoKTsgdXBkYXRlUHJldmlldygpOyB9CiAgICB3aW5kb3cub3BlbkJpUGFyYW1zID0gb3BlbkJpUGFyYW1zOwogICAgd2luZG93LmNsb3NlQmlQYXJhbXMgPSBjbG9zZUJpUGFyYW1zOwo8L3NjcmlwdD4KCjxkaXYgaWQ9ImJpLXBhcmFtcy1tb2RhbCIgc3R5bGU9ImRpc3BsYXk6bm9uZTtwb3NpdGlvbjpmaXhlZDtpbnNldDowO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuNDUpO3otaW5kZXg6OTk5OTthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlciIgb25jbGljaz0iaWYoZXZlbnQudGFyZ2V0PT09dGhpcyljbG9zZUJpUGFyYW1zKCkiPgo8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyLXJhZGl1czoxNnB4O3BhZGRpbmc6MjRweCAyOHB4O3dpZHRoOjUyMHB4O21heC13aWR0aDo5MnZ3O21heC1oZWlnaHQ6OTB2aDtvdmVyZmxvdy15OmF1dG87Ym94LXNoYWRvdzowIDIwcHggNjBweCByZ2JhKDAsMCwwLC4yNSkiPgo8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO21hcmdpbi1ib3R0b206MThweCI+CjxoMyBzdHlsZT0ibWFyZ2luOjA7Zm9udC1zaXplOjEuMDVyZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiMxZTI5M2IiPuKame+4jyBQYXJhbcOodHJlcyBkdSBidWxsZXRpbjwvaDM+CjxidXR0b24gb25jbGljaz0iY2xvc2VCaVBhcmFtcygpIiBzdHlsZT0iYmFja2dyb3VuZDpub25lO2JvcmRlcjpub25lO2ZvbnQtc2l6ZToxLjNyZW07Y3Vyc29yOnBvaW50ZXI7Y29sb3I6Izk0YTNiODtwYWRkaW5nOjRweCI+JnRpbWVzOzwvYnV0dG9uPgo8L2Rpdj4KPGRpdiBzdHlsZT0iZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxMDBweCAxZnI7Z2FwOjEycHg7bWFyZ2luLWJvdHRvbToxNHB4Ij4KPGRpdj4KPGxhYmVsIHN0eWxlPSJkaXNwbGF5OmJsb2NrO2ZvbnQtc2l6ZTouN3JlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6Izk0YTNiODt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7bGV0dGVyLXNwYWNpbmc6LjVweDttYXJnaW4tYm90dG9tOjRweCI+TnVtw6lybzwvbGFiZWw+CjxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJiaS1udW1iZXIiIG9uaW5wdXQ9InRyaWdnZXJBdXRvU2F2ZSgpIiBzdHlsZT0id2lkdGg6MTAwJTtwYWRkaW5nOjhweCAxMnB4O2JvcmRlcjoycHggc29saWQgI2YxZjVmOTtib3JkZXItcmFkaXVzOjEwcHg7Zm9udC1zaXplOjFyZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiMxZTNhNWY7b3V0bGluZTpub25lIiBwbGFjZWhvbGRlcj0iTsKwIj4KPC9kaXY+CjxkaXY+CjxsYWJlbCBzdHlsZT0iZGlzcGxheTpibG9jaztmb250LXNpemU6LjdyZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiM5NGEzYjg7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO2xldHRlci1zcGFjaW5nOi41cHg7bWFyZ2luLWJvdHRvbTo0cHgiPlDDqXJpb2RlIChTZW1haW5lKTwvbGFiZWw+CjxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweCI+CjxpbnB1dCB0eXBlPSJkYXRlIiBpZD0iYmktZGF0ZS1zdGFydCIgb25pbnB1dD0idHJpZ2dlckF1dG9TYXZlKCkiIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHggMTBweDtib3JkZXI6MnB4IHNvbGlkICNmMWY1Zjk7Ym9yZGVyLXJhZGl1czoxMHB4O2ZvbnQtc2l6ZTouODVyZW07b3V0bGluZTpub25lIj4KPHNwYW4gc3R5bGU9ImNvbG9yOiNjYmQ1ZTEiPuKGkjwvc3Bhbj4KPGlucHV0IHR5cGU9ImRhdGUiIGlkPSJiaS1kYXRlLWVuZCIgb25pbnB1dD0idHJpZ2dlckF1dG9TYXZlKCkiIHN0eWxlPSJmbGV4OjE7cGFkZGluZzo4cHggMTBweDtib3JkZXI6MnB4IHNvbGlkICNmMWY1Zjk7Ym9yZGVyLXJhZGl1czoxMHB4O2ZvbnQtc2l6ZTouODVyZW07b3V0bGluZTpub25lIj4KPC9kaXY+PC9kaXY+CjwvZGl2Pgo8ZGl2IHN0eWxlPSJkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmciAxZnI7Z2FwOjEycHg7bWFyZ2luLWJvdHRvbToxNHB4Ij4KPGRpdj4KPGxhYmVsIHN0eWxlPSJkaXNwbGF5OmJsb2NrO2ZvbnQtc2l6ZTouN3JlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6Izk0YTNiODt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7bGV0dGVyLXNwYWNpbmc6LjVweDttYXJnaW4tYm90dG9tOjRweCI+RGF0ZSBkZSBwdWJsaWNhdGlvbjwvbGFiZWw+CjxpbnB1dCB0eXBlPSJkYXRlIiBpZD0iYmktcHViLWRhdGUiIG9uaW5wdXQ9InRyaWdnZXJBdXRvU2F2ZSgpIiBzdHlsZT0id2lkdGg6MTAwJTtwYWRkaW5nOjhweCAxMHB4O2JvcmRlcjoycHggc29saWQgI2YxZjVmOTtib3JkZXItcmFkaXVzOjEwcHg7Zm9udC1zaXplOi44NXJlbTtvdXRsaW5lOm5vbmUiPgo8L2Rpdj4KPGRpdj4KPGxhYmVsIHN0eWxlPSJkaXNwbGF5OmJsb2NrO2ZvbnQtc2l6ZTouN3JlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6Izk0YTNiODt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7bGV0dGVyLXNwYWNpbmc6LjVweDttYXJnaW4tYm90dG9tOjRweCI+U2lnbmF0YWlyZTwvbGFiZWw+CjxzZWxlY3QgaWQ9ImJpLXNpZ25hdG9yeSIgb25jaGFuZ2U9InRyaWdnZXJBdXRvU2F2ZSgpIiBzdHlsZT0id2lkdGg6MTAwJTtwYWRkaW5nOjhweCAxMHB4O2JvcmRlcjoycHggc29saWQgI2YxZjVmOTtib3JkZXItcmFkaXVzOjEwcHg7Zm9udC1zaXplOi44NXJlbTtvdXRsaW5lOm5vbmU7YmFja2dyb3VuZDojZmZmIj4KPG9wdGlvbiB2YWx1ZT0iTCfDqXF1aXBlIGRlIGRpcmVjdGlvbiI+TCfDqXF1aXBlIGRlIGRpcmVjdGlvbjwvb3B0aW9uPgo8b3B0aW9uIHZhbHVlPSJMZSBwcm92aXNldXIiPkxlIHByb3Zpc2V1cjwvb3B0aW9uPgo8b3B0aW9uIHZhbHVlPSJMZSBwcm92aXNldXIgYWRqb2ludCI+TGUgcHJvdmlzZXVyIGFkam9pbnQ8L29wdGlvbj4KPG9wdGlvbiB2YWx1ZT0iTGEgZGlyZWN0aW9uIj5MYSBkaXJlY3Rpb248L29wdGlvbj4KPC9zZWxlY3Q+PC9kaXY+CjwvZGl2Pgo8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjE2cHgiPgo8bGFiZWwgc3R5bGU9ImRpc3BsYXk6YmxvY2s7Zm9udC1zaXplOi43cmVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjojOTRhM2I4O3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTtsZXR0ZXItc3BhY2luZzouNXB4O21hcmdpbi1ib3R0b206NHB4Ij5UaMOobWUgLyBDb3VsZXVycyBQREY8L2xhYmVsPgo8c2VsZWN0IGlkPSJiaS10aGVtZSIgb25jaGFuZ2U9InRyaWdnZXJBdXRvU2F2ZSgpIiBzdHlsZT0id2lkdGg6MTAwJTtwYWRkaW5nOjhweCAxMHB4O2JvcmRlcjoycHggc29saWQgI2YxZjVmOTtib3JkZXItcmFkaXVzOjEwcHg7Zm9udC1zaXplOi44NXJlbTtvdXRsaW5lOm5vbmU7YmFja2dyb3VuZDojZmZmIj4KPG9wdGlvbiB2YWx1ZT0iYmx1ZSI+8J+UtSBCbGV1IEluc3RpdHV0aW9ubmVsPC9vcHRpb24+CjxvcHRpb24gdmFsdWU9ImdyZWVuIj7wn5+iIFZlcnQgTmF0dXJlPC9vcHRpb24+CjxvcHRpb24gdmFsdWU9InB1cnBsZSI+8J+foyBWaW9sZXQgQ3LDqWF0aWY8L29wdGlvbj4KPG9wdGlvbiB2YWx1ZT0icmVkIj7wn5S0IFJvdWdlIMOJbmVyZ2llPC9vcHRpb24+CjxvcHRpb24gdmFsdWU9Im9yYW5nZSI+8J+foCBPcmFuZ2UgRHluYW1pcXVlPC9vcHRpb24+CjxvcHRpb24gdmFsdWU9InRlYWwiPvCfkqAgVHVycXVvaXNlIE1vZGVybmU8L29wdGlvbj4KPG9wdGlvbiB2YWx1ZT0iZ3JleSI+4pqrIFNvYnJpw6l0w6kgKE4mQik8L29wdGlvbj4KPC9zZWxlY3Q+PC9kaXY+CjxkaXYgc3R5bGU9InRleHQtYWxpZ246cmlnaHQiPgo8YnV0dG9uIG9uY2xpY2s9ImNsb3NlQmlQYXJhbXMoKSIgc3R5bGU9InBhZGRpbmc6OHB4IDIwcHg7YmFja2dyb3VuZDojM2I4MmY2O2NvbG9yOiNmZmY7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czoxMHB4O2ZvbnQtd2VpZ2h0OjYwMDtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6Ljg1cmVtIj7inJMgRmVybWVyPC9idXR0b24+CjwvZGl2Pgo8L2Rpdj48L2Rpdj4KCjwvYm9keT4KPC9odG1sPg=="};

    const STORAGE_KEY = 'pilote_suite_settings';
    let currentModule = null;
    const loadedModules = new Set();
    const blobUrls = {};
    const moduleNames = ['perdir','exam','oral','aed','bibase','dhg'];

    const MODULE_META = {
        perdir: { label:'PERDIR', sublabel:'Direction', icon:'fas fa-building-columns', color:'var(--c-info)' },
        exam:   { label:'Écrit',  sublabel:"Organisation d'épreuves écrites", icon:'fas fa-file-pen', color:'var(--c-accent)' },
        oral:   { label:'Oral',   sublabel:"Organisation d'épreuves orales", icon:'fas fa-comments', color:'var(--c-warning)' },
        aed:    { label:'AED',    sublabel:'Vie Scolaire', icon:'fas fa-user-shield', color:'var(--c-success)' },
        data:   { label:'DONNÉES', sublabel:'Import', icon:'fas fa-database', color:'var(--c-purple)' },
        bibase: { label:'BULLETIN', sublabel:'Information', icon:'fas fa-newspaper', color:'#e67e22' },
        dhg:    { label:'DHG', sublabel:'Services', icon:'fas fa-table-cells', color:'#16a085' },
    };
    const ALL_ITEMS = ['perdir','exam','oral','aed','bibase','dhg','data'];
    const DEFAULT_ORDER = ['perdir','exam','oral','aed','bibase','dhg','data'];

    // ═══ EXCEL TEMPLATES ═══
    const TEMPLATES = {
        teachers: {
            filename: 'Modele_Enseignants.xlsx',
            columns: ['Nom','Prénom','Email'],
            widths: [20,18,30]
        },
        students: {
            filename: 'Modele_Eleves.xlsx',
            columns: ['Classe','Nom','Prénom','Email','Aménagement'],
            widths: [12,18,16,28,22]
        }
    };

    function downloadTemplate(type) {
        const tpl = TEMPLATES[type];
        const wb = XLSX.utils.book_new();
        const wsData = [tpl.columns];
        // Add 2 example rows
        if (type === 'teachers') {
            wsData.push(['Dupont','Jean','j.dupont@ac-rennes.fr']);
            wsData.push(['Martin','Sophie','s.martin@ac-rennes.fr']);
        } else {
            wsData.push(['2GT1','Durand','Marie','m.durand@eleve.fr','']);
            wsData.push(['1STMG2','Leroy','Thomas','t.leroy@eleve.fr','1/3 temps']);
        }
        const ws = XLSX.utils.aoa_to_sheet(wsData);
        // Set column widths
        ws['!cols'] = tpl.widths.map(w => ({ wch: w }));
        XLSX.utils.book_append_sheet(wb, ws, type === 'teachers' ? 'Enseignants' : 'Élèves');
        XLSX.writeFile(wb, tpl.filename);
    }

    // ═══ SETTINGS ═══
    function getSettings() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch(e) { return {}; } }
    function getNavOrder() {
        const s = getSettings();
        if (s.navOrder && s.navOrder.length) {
            // Add any missing modules (not separators)
            var order = s.navOrder.slice();
            ALL_ITEMS.forEach(function(m) { if (order.indexOf(m) < 0) order.push(m); });
            // Remove deleted modules but keep separators (__sep__)
            order = order.filter(function(m) { return m === '__sep__' || ALL_ITEMS.indexOf(m) >= 0; });
            return order;
        }
        return [...DEFAULT_ORDER];
    }

    function loadSettingsUI() {
        // Restore cloud config
        var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
        if (ms.cloud) {
            if (ms.cloud.provider) { _cloudProvider = ms.cloud.provider; selectCloudProvider(ms.cloud.provider); }
            if (ms.cloud.key) document.getElementById('s-cloud-key').value = ms.cloud.key;
            if (ms.cloud.bin) document.getElementById('s-cloud-bin').value = ms.cloud.bin;
            if (ms.cloud.gistToken) document.getElementById('s-gist-token').value = ms.cloud.gistToken;
            if (ms.cloud.gistId) document.getElementById('s-gist-id').value = ms.cloud.gistId;
            if (ms.cloud.gdriveClientId) document.getElementById('s-gdrive-clientid').value = ms.cloud.gdriveClientId;
            if (ms.cloud.gdriveFileId) document.getElementById('s-gdrive-fileid').value = ms.cloud.gdriveFileId;
            if (ms.cloud.wdUrl) document.getElementById('s-webdav-url').value = ms.cloud.wdUrl;
            if (ms.cloud.wdUser) document.getElementById('s-webdav-user').value = ms.cloud.wdUser;
            if (ms.cloud.wdPass) document.getElementById('s-webdav-pass').value = ms.cloud.wdPass;
            if (ms.cloud.auto) document.getElementById('s-cloud-auto').checked = true;
            if (ms.cloud.enabled) { document.getElementById('s-cloud-enabled').checked = true; toggleCloudUI(); }
        }
        const s = getSettings();
        document.getElementById('s-school').value = s.school || '';
        document.getElementById('s-name').value = s.name || '';
        document.getElementById('s-role').value = s.role || '';
        document.getElementById('s-city').value = s.city || '';
        if(document.getElementById('s-zone')) document.getElementById('s-zone').value = s.zone || 'B';
        if(document.getElementById('s-pdf-layout')) document.getElementById('s-pdf-layout').value = s.pdfHeaderLayout || 'classique';
        if(document.getElementById('s-pdf-color'))  { document.getElementById('s-pdf-color').value = s.pdfHeaderColor || '#1b2433'; document.getElementById('s-pdf-color-hex').value = s.pdfHeaderColor || '#1b2433'; }
        if(document.getElementById('s-pdf-subtitle')) document.getElementById('s-pdf-subtitle').value = s.pdfHeaderSubtitle || '';
        updatePdfHeaderPreview();
        document.getElementById('s-gcal').checked = s.gcalEnabled || false;
        if(document.getElementById('s-gcal-clientid')) document.getElementById('s-gcal-clientid').value = s.gcalClientId || '';
        if(document.getElementById('s-gcal-key')) document.getElementById('s-gcal-key').value = s.gcalKey || '';
        toggleGcal();
        if(s.gcalCals && s.gcalCals.length) { _gcalCalsData = s.gcalCals; renderGcalList(s.gcalCals, s.gcalSel || []); renderManualList(s.gcalCals); }
        document.getElementById('s-zone').value = s.zone || 'B';
        if(document.getElementById('s-pdf-layout')) document.getElementById('s-pdf-layout').value = s.pdfHeaderLayout || 'classique';
        if(document.getElementById('s-pdf-color'))  { document.getElementById('s-pdf-color').value = s.pdfHeaderColor || '#1b2433'; document.getElementById('s-pdf-color-hex').value = s.pdfHeaderColor || '#1b2433'; }
        if(document.getElementById('s-pdf-subtitle')) document.getElementById('s-pdf-subtitle').value = s.pdfHeaderSubtitle || '';
        updatePdfHeaderPreview();
        if (s.logoSrc) {
                updateFavicon(s.logoSrc); document.getElementById('img-logo').src = s.logoSrc; document.getElementById('img-logo').style.display='block'; document.getElementById('ph-logo').style.display='none'; }
        if (s.signSrc) { document.getElementById('img-sign').src = s.signSrc; document.getElementById('img-sign').style.display='block'; document.getElementById('ph-sign').style.display='none'; }
        renderOrderList();
        updateModuleVisibility();
        updateBrandLogo();
        refreshDataUI();
    }

    
    function loadBibSettingsUI() {
        var bib = JSON.parse(localStorage.getItem('bibase_establishment') || '{}');
        if(bib.layout) document.getElementById('bib-layout').value = bib.layout;
        if(bib.font) document.getElementById('bib-font').value = bib.font;
        if(bib.defaultSignatory) {
            var sel = document.getElementById('bib-signatory');
            var found = false;
            for(var i=0;i<sel.options.length;i++) { if(sel.options[i].value===bib.defaultSignatory) { found=true; break; } }
            if(!found) { var o=document.createElement('option'); o.value=bib.defaultSignatory; o.text=bib.defaultSignatory; sel.appendChild(o); }
            sel.value = bib.defaultSignatory;
        }
        if(bib.docTitle) document.getElementById('bib-doc-title').value = bib.docTitle;
        if(bib.docFooter) document.getElementById('bib-doc-footer').value = bib.docFooter;
    }
    function saveBibSettings() {
        try {
            var bib = JSON.parse(localStorage.getItem('bibase_establishment') || '{}');
            var el;
            el = document.getElementById('bib-layout'); if (el) bib.layout = el.value;
            el = document.getElementById('bib-font'); if (el) bib.font = el.value;
            el = document.getElementById('bib-signatory'); if (el) bib.defaultSignatory = el.value;
            el = document.getElementById('bib-doc-title'); if (el) bib.docTitle = el.value;
            el = document.getElementById('bib-doc-footer'); if (el) bib.docFooter = el.value;
            var s = getSettings();
            if (s.school) bib.name = s.school;
            if (s.city) bib.address = s.city;
            if (s.logoSrc) bib.logo = s.logoSrc;
            localStorage.setItem('bibase_establishment', JSON.stringify(bib));
            var frame = document.getElementById('frame-bibase');
            if (frame && frame.contentWindow) {
                frame.contentWindow.postMessage({type: 'bibase-settings', data: bib}, '*');
                frame.contentWindow.postMessage({type: 'pilote-settings', data: {school: s.school||'', city: s.city||'', logoSrc: s.logoSrc||''}}, '*');
            }
        } catch(e) { console.warn('saveBibSettings:', e); }
    }
function saveSettings() {
        // 1. Save main settings first (critical)
        try {
            var s = getSettings();
            s.school = document.getElementById('s-school').value;
            s.name = document.getElementById('s-name').value;
            s.role = document.getElementById('s-role').value;
            s.city = document.getElementById('s-city').value;
            s.zone = document.getElementById('s-zone').value;
            if(document.getElementById('s-pdf-layout')) s.pdfHeaderLayout = document.getElementById('s-pdf-layout').value;
            if(document.getElementById('s-pdf-color'))  { var col = document.getElementById('s-pdf-color').value || document.getElementById('s-pdf-color-hex').value; s.pdfHeaderColor = col; document.getElementById('s-pdf-color-hex').value = col; }
            if(document.getElementById('s-pdf-subtitle')) s.pdfHeaderSubtitle = document.getElementById('s-pdf-subtitle').value;
            s.gcalEnabled = document.getElementById('s-gcal').checked;
            if(document.getElementById('s-gcal-clientid')) s.gcalClientId = document.getElementById('s-gcal-clientid').value;
            if(document.getElementById('s-gcal-key')) s.gcalKey = document.getElementById('s-gcal-key').value;
            s.gcalSel = getGcalSel();
            var logoImg = document.getElementById('img-logo');
            s.logoSrc = (logoImg && logoImg.style.display !== 'none') ? logoImg.src : '';
            var signImg = document.getElementById('img-sign');
            s.signSrc = (signImg && signImg.style.display !== 'none') ? signImg.src : '';
            moduleNames.forEach(function(m) { var tog = document.getElementById('tog-' + m); if(tog) s['show_' + m] = tog.checked; });
            s.navOrder = getCurrentOrderFromList();
            s._lastSync = new Date().toISOString();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
        } catch(e1) { console.error('saveSettings main:', e1); }
        // 2. Save cloud config (independent)
        try {
            var cs = getCloudConfig();
            var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
            ms.cloud = cs;
            localStorage.setItem('pilote_master_settings', JSON.stringify(ms));
            setTimeout(cloudAutoSync, 800);
        } catch(e2) { console.error('saveSettings cloud:', e2); }
        // 3. Save BiBase settings (independent)
        try { saveBibSettings(); } catch(e3) { console.error('saveSettings bib:', e3); }
        // 4. Save PERDIR submenu config
        try {
            var perdirCfg = [];
            document.querySelectorAll('#perdir-submenu-list .order-item').forEach(function(item) {
                var menuId = item.dataset.menuid;
                if (menuId === '__sep__') {
                    perdirCfg.push({id: '__sep__'});
                } else {
                    var chk = item.querySelector('input[type=checkbox]');
                    perdirCfg.push({id: menuId, visible: chk ? chk.checked : true});
                }
            });
            if (perdirCfg.length) {
                var ms2 = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
                ms2.perdirMenus = perdirCfg;
                localStorage.setItem('pilote_master_settings', JSON.stringify(ms2));
            }
        } catch(e4) { console.error('saveSettings perdir:', e4); }
        // 5. Apply changes (each independent)
        try { updateModuleVisibility(); } catch(e) {}
        try { updateBrandLogo(); } catch(e) {}
        try { applyNavOrder(); } catch(e) {}
        try { pushSettingsToAllModules(); } catch(e) {}
        try {
            var bibFrame = document.getElementById('frame-bibase');
            if (bibFrame && bibFrame.contentWindow) {
                var bibData = JSON.parse(localStorage.getItem('bibase_establishment') || '{}');
                bibFrame.contentWindow.postMessage({type: 'bibase-settings', data: bibData}, '*');
            }
        } catch(e) {}
        closeSettings();
        if (_lfDirHandle) { lfMarkDirty(); setTimeout(function(){ lfWriteToFolder(); }, 500); }
    }


    function updateBrandLogo() {
        const s = getSettings();
        const brandLetter = document.getElementById('brandLetter');
        const brandLogo = document.getElementById('brandLogo');
        const welcomeLetter = document.getElementById('welcomeLetter');
        const welcomeLogoImg = document.getElementById('welcomeLogoImg');
        const welcomeSubtitle = document.getElementById('welcomeSubtitle');
        const bottomInfo = document.getElementById('bottomBarInfo');

        const brandIconEl = document.getElementById('brandIcon');
        const welcomeLogoEl = document.getElementById('welcomeLogo');
        if (s.logoSrc) {
                updateFavicon(s.logoSrc);
            brandLetter.style.display = 'none';
            brandLogo.src = s.logoSrc;
            brandLogo.style.display = 'block';
            brandIconEl.style.background = 'none';
            brandIconEl.style.boxShadow = 'none';
            welcomeLetter.style.display = 'none';
            welcomeLogoImg.src = s.logoSrc;
            welcomeLogoImg.style.display = 'block';
            welcomeLogoEl.style.background = 'none';
            welcomeLogoEl.style.boxShadow = 'none';
            welcomeLogoEl.style.borderRadius = '0';
            welcomeLogoEl.style.width = 'auto';
            welcomeLogoEl.style.height = 'auto';
        } else {
            brandLetter.style.display = '';
            brandLogo.style.display = 'none';
            brandIconEl.style.background = '';
            brandIconEl.style.boxShadow = '';
            welcomeLetter.style.display = '';
            welcomeLogoImg.style.display = 'none';
            welcomeLogoEl.style.background = '';
            welcomeLogoEl.style.boxShadow = '';
        }
        // Update school name in subtitle & bottom bar
        if (s.school) {
            welcomeSubtitle.textContent = s.school + ' — Suite de direction';
            bottomInfo.textContent = 'Pilote Suite — ' + s.school;
        } else {
            welcomeSubtitle.textContent = 'Suite d\'outils pour la direction d\'établissement';
            bottomInfo.textContent = 'CADIR Suite — Direction';
        }
    }

    function handleSettingsImage(input, type) {
        const file = input.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('img-' + type).src = e.target.result;
            document.getElementById('img-' + type).style.display = 'block';
            document.getElementById('ph-' + type).style.display = 'none';
        };
        reader.readAsDataURL(file);
    }

    function clearImage(type) {
        document.getElementById('img-' + type).style.display = 'none';
        document.getElementById('img-' + type).src = '';
        document.getElementById('ph-' + type).style.display = '';
    }

    function openSettings() {
        renderPerdirSubmenus(); loadSettingsUI(); loadBibSettingsUI();
        if (typeof lfInitMode === 'function') lfInitMode();
            updateHomeGrid();
            if(!window.__homeGridResize){ window.__homeGridResize=true; window.addEventListener('resize', updateHomeGrid); }
        document.getElementById('settingsOverlay').classList.add('open'); }
    
    var _gcalAccessToken = null;
    var _gcalCalsData = [];

    function toggleGcal() {
        var checked = document.getElementById('s-gcal').checked;
        document.getElementById('gcal-opts').style.display = checked ? 'block' : 'none';
        var s = getSettings();
        s.gcalEnabled = checked;
        localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
        pushSettingsToAllModules();
    }

    function gcalAuth() {
        if (window.location.protocol === 'file:') {
            var iframe = document.querySelector('.module-frame.active');
            if (iframe && iframe.contentWindow && (function(){try{return iframe.contentWindow.location.protocol==='file:';}catch(e){return false;}})()) {}
            alert('\u26a0 Google Agenda nécessite un serveur web local.\n\nPour lancer :\n1. Ouvrez un terminal dans le dossier contenant PILOTE_Suite.html\n2. Tapez : python3 -m http.server 8080\n3. Ouvrez http://localhost:8080/PILOTE_Suite.html\n\nL\'authentification OAuth2 ne fonctionne pas depuis file://.');
            document.getElementById('gcal-auth-status').innerHTML = '<span style=\"color:#e74c3c\"><i class=\"fas fa-exclamation-triangle\"></i> Nécessite http://localhost</span>';
            return;
        }
        var clientId = document.getElementById('s-gcal-clientid').value.trim();
        if (!clientId) { alert('Veuillez saisir un Client ID OAuth2.'); return; }
        document.getElementById('gcal-auth-status').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Chargement...';
        function _doGcalAuth() {
            document.getElementById('gcal-auth-status').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connexion...';
        var tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: clientId,
            scope: 'https://www.googleapis.com/auth/calendar.readonly',
            callback: function(resp) {
                if (resp.error) {
                    document.getElementById('gcal-auth-status').innerHTML = '<span style="color:#e74c3c;"><i class="fas fa-times"></i> ' + (resp.error_description || resp.error) + '</span>';
                    return;
                }
                _gcalAccessToken = resp.access_token;
                document.getElementById('gcal-auth-status').innerHTML = '<span style="color:#34a853;"><i class="fas fa-check"></i> Connect\u00e9</span>';
                document.getElementById('btn-gcal-auth').innerHTML = '<i class="fas fa-check-circle"></i> Connect\u00e9';
                document.getElementById('btn-gcal-auth').style.background = '#34a853';
                fetchGcalList();
            }
        });
        tokenClient.requestAccessToken();
        }
        if (typeof google !== 'undefined' && google.accounts && google.accounts.oauth2) {
            _doGcalAuth();
        } else {
            var s = document.createElement('script');
            s.src = 'https://accounts.google.com/gsi/client';
            s.async = true;
            s.onload = function() { _doGcalAuth(); };
            s.onerror = function() {
                document.getElementById('gcal-auth-status').innerHTML = '<span style="color:#e74c3c;"><i class="fas fa-exclamation-triangle"></i> Impossible de charger la bibliothèque Google (vérifiez votre connexion)</span>';
            };
            document.head.appendChild(s);
        }
    }

    function fetchGcalList() {
        if (!_gcalAccessToken) return;
        var div = document.getElementById('gcal-list');
        div.innerHTML = '<span style="color:#888;font-size:.78rem;"><i class="fas fa-spinner fa-spin"></i> Chargement...</span>';
        fetch('https://www.googleapis.com/calendar/v3/users/me/calendarList', {
            headers: { 'Authorization': 'Bearer ' + _gcalAccessToken }
        })
        .then(function(r) { if (!r.ok) throw new Error('Erreur ' + r.status); return r.json(); })
        .then(function(data) {
            if (!data.items || !data.items.length) { div.innerHTML = '<span style="color:#e74c3c;">Aucun agenda.</span>'; return; }
            var s = getSettings();
            _gcalCalsData = data.items.map(function(c) { return {id: c.id, name: c.summary, bg: c.backgroundColor || '#4285f4', primary: c.primary || false}; });
            s.gcalCals = _gcalCalsData;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
            renderGcalList(_gcalCalsData, s.gcalSel || []);
            document.getElementById('gcal-list-wrap').style.display = 'block';
        })
        .catch(function(err) {
            div.innerHTML = '<span style="color:#e74c3c;font-size:.78rem;"><i class="fas fa-exclamation-triangle"></i> ' + err.message + '</span>';
        });
    }

    function renderGcalList(cals, sel) {
        var div = document.getElementById('gcal-list');
        if (!cals || !cals.length) { div.innerHTML = ''; return; }
        var h = '';
        cals.forEach(function(c) {
            var checked = sel.indexOf(c.id) >= 0 || (sel.length === 0 && c.primary);
            h += '<label style="display:flex;align-items:center;gap:8px;padding:5px 8px;font-size:.78rem;cursor:pointer;border-radius:6px;">';
            h += '<input type="checkbox" class="gcal-chk" value="' + c.id + '" ' + (checked ? 'checked' : '') + ' style="accent-color:' + c.bg + ';">';
            h += '<span style="width:12px;height:12px;border-radius:3px;background:' + c.bg + ';flex-shrink:0;"></span>';
            h += '<span>' + c.name + (c.primary ? ' <small style="color:#888;">(principal)</small>' : '') + '</span>';
            h += '</label>';
        });
        div.innerHTML = h;
        document.getElementById('gcal-list-wrap').style.display = 'block';
    }

    function getGcalSel() { return Array.from(document.querySelectorAll('.gcal-chk:checked')).map(function(c) { return c.value; }); }

    function gcalFetchEvents() {
        var sel = getGcalSel();
        if (!sel.length) { alert('S\u00e9lectionnez au moins un agenda.'); return; }
        var useOAuth = !!_gcalAccessToken;
        var apiKey = document.getElementById('s-gcal-key') ? document.getElementById('s-gcal-key').value.trim() : '';
        if (!useOAuth && !apiKey) { alert('Connectez-vous via OAuth2 ou saisissez une cl\u00e9 API.'); return; }

        var statusEl = document.getElementById('gcal-events-status');
        statusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> R\u00e9cup\u00e9ration...';

        var now = new Date();
        var start = new Date(now.getFullYear(), now.getMonth() - 2, 1).toISOString();
        var end = new Date(now.getFullYear(), now.getMonth() + 4, 0).toISOString();

        var calMap = {};
        (_gcalCalsData.length ? _gcalCalsData : (getSettings().gcalCals || [])).forEach(function(c) { calMap[c.id] = c; });

        var promises = sel.map(function(calId) {
            var url = 'https://www.googleapis.com/calendar/v3/calendars/' + encodeURIComponent(calId) + '/events?timeMin=' + encodeURIComponent(start) + '&timeMax=' + encodeURIComponent(end) + '&singleEvents=true&orderBy=startTime&maxResults=500';
            var opts = {};
            if (useOAuth) { opts.headers = { 'Authorization': 'Bearer ' + _gcalAccessToken }; }
            else { url += '&key=' + apiKey; }
            return fetch(url, opts).then(function(r) { return r.ok ? r.json() : {items:[]}; }).catch(function() { return {items:[]}; });
        });

        Promise.all(promises).then(function(results) {
            var events = [];
            results.forEach(function(data, i) {
                var calId = sel[i];
                var calInfo = calMap[calId] || {name: calId, bg: '#4285f4'};
                (data.items || []).forEach(function(ev) {
                    if (!ev.start) return;
                    var startDate = ev.start.date || (ev.start.dateTime ? ev.start.dateTime.split('T')[0] : null);
                    if (!startDate) return;
                    var startTime = ev.start.dateTime ? ev.start.dateTime.split('T')[1].substring(0, 5) : '';
                    var endTime = ev.end && ev.end.dateTime ? ev.end.dateTime.split('T')[1].substring(0, 5) : '';
                    events.push({ id: ev.id, title: ev.summary || '(sans titre)', date: startDate, time: startTime, endTime: endTime, calName: calInfo.name, color: calInfo.bg, calId: calId });
                });
            });
            events.sort(function(a, b) { return (a.date + ' ' + (a.time || '00:00')).localeCompare(b.date + ' ' + (b.time || '00:00')); });

            var s = getSettings();
            s.gcalEvents = events;
            s.gcalSel = sel;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(s));

            statusEl.innerHTML = '<span style="color:#34a853;"><i class="fas fa-check"></i> ' + events.length + ' \u00e9v\u00e9nement(s) synchronis\u00e9(s)</span>';
            pushGcalToModules();
            try{ renderHomeTodayEvents(); }catch(e){} try{ renderHomeUpcoming2Weeks(); }catch(e){}
        });
    }

    
    
    // ═══ OUTLOOK / OFFICE 365 CALENDAR ═══
    var _outlookToken = null;
    var _outlookCals = [];

    function outlookAuth() {
        var clientId = (document.getElementById('s-outlook-clientid').value || '').trim();
        if (!clientId) return alert('Saisissez l\'Application (client) ID');
        var redir = location.origin + location.pathname;
        var scope = 'Calendars.ReadWrite';
        var url = 'https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id='+encodeURIComponent(clientId)+'&response_type=token&redirect_uri='+encodeURIComponent(redir)+'&scope='+encodeURIComponent(scope);
        var w = window.open(url, '_blank', 'width=500,height=600');
        var check = setInterval(function() {
            try {
                if (w.closed) { clearInterval(check); return; }
                if (w.location.hash) {
                    var params = new URLSearchParams(w.location.hash.substring(1));
                    var tk = params.get('access_token');
                    if (tk) {
                        _outlookToken = tk;
                        w.close(); clearInterval(check);
                        document.getElementById('outlook-auth-status').innerHTML = '<span style="color:#0078d4"><i class="fas fa-check-circle"></i> Connecté</span>';
                        document.getElementById('btn-outlook-auth').innerHTML = '<i class="fas fa-check-circle"></i> Connecté';
                        document.getElementById('btn-outlook-auth').style.background = '#0078d4';
                        outlookFetchCalendars();
                    }
                }
            } catch(e) {}
        }, 500);
    }

    function outlookFetchCalendars() {
        if (!_outlookToken) return;
        fetch('https://graph.microsoft.com/v1.0/me/calendars', {
            headers: { 'Authorization': 'Bearer ' + _outlookToken }
        }).then(function(r) { return r.json(); }).then(function(data) {
            _outlookCals = (data.value || []).map(function(c) { return {id:c.id, name:c.name, color:c.hexColor||'#0078d4'}; });
            var div = document.getElementById('outlook-cal-list');
            var s = getSettings();
            var sel = s.outlookSel || [];
            div.innerHTML = _outlookCals.map(function(c) {
                var chk = sel.indexOf(c.id) >= 0 || sel.length === 0 ? 'checked' : '';
                return '<label style="display:flex;align-items:center;gap:6px;margin:4px 0;font-size:.78rem;cursor:pointer;"><input type="checkbox" class="outlook-cal-chk" value="'+c.id+'" '+chk+'><span style="width:10px;height:10px;border-radius:50%;background:'+(c.color||'#0078d4')+'"></span>'+c.name+'</label>';
            }).join('');
            document.getElementById('outlook-cal-list-wrap').style.display = 'block';
        }).catch(function(err) {
            document.getElementById('outlook-auth-status').innerHTML = '<span style="color:#e74c3c">'+err.message+'</span>';
        });
    }

    function getOutlookSel() {
        var chks = document.querySelectorAll('.outlook-cal-chk:checked');
        return Array.from(chks).map(function(c) { return c.value; });
    }

    function outlookFetchEvents() {
        var sel = getOutlookSel();
        if (!sel.length) { alert('Sélectionnez au moins un agenda Outlook.'); return; }
        if (!_outlookToken) { alert('Connectez Outlook d\'abord.'); return; }

        var statusEl = document.getElementById('outlook-events-status');
        statusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Récupération...';

        var now = new Date();
        var start = new Date(now.getFullYear(), now.getMonth() - 2, 1).toISOString();
        var end = new Date(now.getFullYear(), now.getMonth() + 4, 0).toISOString();

        var calMap = {};
        _outlookCals.forEach(function(c) { calMap[c.id] = c; });

        var promises = sel.map(function(calId) {
            var url = 'https://graph.microsoft.com/v1.0/me/calendars/' + encodeURIComponent(calId) + '/events?$select=subject,start,end,id&$filter=start/dateTime ge \''+start+'\' and start/dateTime le \''+end+'\'&$top=500&$orderby=start/dateTime';
            return fetch(url, {
                headers: { 'Authorization': 'Bearer ' + _outlookToken, 'Prefer': 'outlook.timezone="Europe/Paris"' }
            }).then(function(r) { return r.ok ? r.json() : {value:[]}; }).catch(function() { return {value:[]}; });
        });

        Promise.all(promises).then(function(results) {
            var events = [];
            results.forEach(function(data, i) {
                var calId = sel[i];
                var calInfo = calMap[calId] || {name:'Outlook', color:'#0078d4'};
                (data.value || []).forEach(function(ev) {
                    if (!ev.start) return;
                    var startDT = ev.start.dateTime || '';
                    var startDate = startDT.split('T')[0];
                    var startTime = startDT.indexOf('T') >= 0 ? startDT.split('T')[1].substring(0,5) : '';
                    var endDT = ev.end ? (ev.end.dateTime||'') : '';
                    var endTime = endDT.indexOf('T') >= 0 ? endDT.split('T')[1].substring(0,5) : '';
                    if (startTime === '00:00' && endTime === '00:00') { startTime = ''; endTime = ''; }
                    events.push({id:ev.id, title:ev.subject||'(sans titre)', date:startDate, time:startTime, endTime:endTime, calName:calInfo.name, color:calInfo.color, calId:calId});
                });
            });

            var s = getSettings();
            s.outlookEvents = events;
            s.outlookSel = sel;
            s.outlookEnabled = true;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(s));

            statusEl.innerHTML = '<span style="color:#0078d4"><i class="fas fa-check"></i> '+events.length+' événement(s)</span>';
            pushOutlookToModules();
            try{ renderHomeTodayEvents(); }catch(e){} try{ renderHomeUpcoming2Weeks(); }catch(e){}
        });
    }

    function pushOutlookToModules() {
        var s = getSettings();
        var frame = document.getElementById('frame-perdir');
        if (frame && frame.contentWindow) {
            frame.contentWindow.postMessage({ type: 'pilote-outlook', data: {
                outlookEvents: s.outlookEvents || [],
                outlookCals: _outlookCals || [],
                outlookSel: s.outlookSel || [],
                outlookEnabled: s.outlookEnabled || false
            }}, '*');
        }
    }

    function pushCalendarsFromStorage(){
        try{ pushGcalToModules(); }catch(e){}
        try{ pushOutlookToModules(); }catch(e){}
        try{ renderHomeTodayEvents(); }catch(e){} try{ renderHomeUpcoming2Weeks(); }catch(e){}
    }

    // Outlook CRUD
    function outlookAddEvent(data) {
        if (!_outlookToken) { alert('Outlook non connecté'); return; }
        var body = { subject: data.title };
        if (data.time) {
            body.start = { dateTime: data.date + 'T' + data.time + ':00', timeZone: 'Europe/Paris' };
            body.end = { dateTime: data.date + 'T' + (data.endTime || data.time) + ':00', timeZone: 'Europe/Paris' };
        } else {
            body.isAllDay = true;
            body.start = { dateTime: data.date + 'T00:00:00', timeZone: 'Europe/Paris' };
            body.end = { dateTime: data.date + 'T23:59:00', timeZone: 'Europe/Paris' };
        }
        fetch('https://graph.microsoft.com/v1.0/me/calendars/' + encodeURIComponent(data.calId) + '/events', {
            method: 'POST', headers: { 'Authorization': 'Bearer ' + _outlookToken, 'Content-Type': 'application/json' }, body: JSON.stringify(body)
        }).then(function(r) { if (!r.ok) throw new Error(r.status); notifyPerdirCrudOk(); outlookFetchEvents(); })
        .catch(function(err) { alert('Erreur Outlook: ' + err.message); });
    }
    function outlookUpdateEvent(data) {
        if (!_outlookToken) { alert('Outlook non connecté'); return; }
        var body = { subject: data.title };
        if (data.time) {
            body.start = { dateTime: data.date + 'T' + data.time + ':00', timeZone: 'Europe/Paris' };
            body.end = { dateTime: data.date + 'T' + (data.endTime || data.time) + ':00', timeZone: 'Europe/Paris' };
        } else {
            body.isAllDay = true;
            body.start = { dateTime: data.date + 'T00:00:00', timeZone: 'Europe/Paris' };
            body.end = { dateTime: data.date + 'T23:59:00', timeZone: 'Europe/Paris' };
        }
        fetch('https://graph.microsoft.com/v1.0/me/events/' + encodeURIComponent(data.eventId), {
            method: 'PATCH', headers: { 'Authorization': 'Bearer ' + _outlookToken, 'Content-Type': 'application/json' }, body: JSON.stringify(body)
        }).then(function(r) { if (!r.ok) throw new Error(r.status); notifyPerdirCrudOk(); outlookFetchEvents(); })
        .catch(function(err) { alert('Erreur Outlook: ' + err.message); });
    }
    function outlookDeleteEvent(data) {
        if (!_outlookToken) { alert('Outlook non connecté'); return; }
        fetch('https://graph.microsoft.com/v1.0/me/events/' + encodeURIComponent(data.eventId), {
            method: 'DELETE', headers: { 'Authorization': 'Bearer ' + _outlookToken }
        }).then(function(r) { if (r.status !== 204 && !r.ok) throw new Error(r.status); notifyPerdirCrudOk(); outlookFetchEvents(); })
        .catch(function(err) { alert('Erreur Outlook: ' + err.message); });
    }

    // ═══ GOOGLE CALENDAR CRUD ═══
    function gcalAddEvent(data) {
        if (!_gcalAccessToken) { alert('Google Agenda non connecté'); return; }
        var body = { summary: data.title };
        if (data.time) {
            body.start = { dateTime: data.date + 'T' + data.time + ':00', timeZone: 'Europe/Paris' };
            body.end = { dateTime: data.date + 'T' + (data.endTime || data.time) + ':00', timeZone: 'Europe/Paris' };
        } else {
            body.start = { date: data.date };
            body.end = { date: data.date };
        }
        fetch('https://www.googleapis.com/calendar/v3/calendars/' + encodeURIComponent(data.calId) + '/events', {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + _gcalAccessToken, 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        }).then(function(r) {
            if (!r.ok) throw new Error('Erreur ' + r.status);
            return r.json();
        }).then(function() {
            notifyPerdirCrudOk();
            gcalFetchEvents();
        }).catch(function(err) { alert('Erreur ajout Google: ' + err.message); });
    }

    function gcalUpdateEvent(data) {
        if (!_gcalAccessToken) { alert('Google Agenda non connecté'); return; }
        var calId = data.calId;
        // If no calId, try to find from selected calendars
        if (!calId) {
            var sel = getGcalSel();
            calId = sel.length ? sel[0] : 'primary';
        }
        var body = { summary: data.title };
        if (data.time) {
            body.start = { dateTime: data.date + 'T' + data.time + ':00', timeZone: 'Europe/Paris' };
            body.end = { dateTime: data.date + 'T' + (data.endTime || data.time) + ':00', timeZone: 'Europe/Paris' };
        } else {
            body.start = { date: data.date };
            body.end = { date: data.date };
        }
        fetch('https://www.googleapis.com/calendar/v3/calendars/' + encodeURIComponent(calId) + '/events/' + encodeURIComponent(data.eventId), {
            method: 'PATCH',
            headers: { 'Authorization': 'Bearer ' + _gcalAccessToken, 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        }).then(function(r) {
            if (!r.ok) throw new Error('Erreur ' + r.status);
            notifyPerdirCrudOk();
            gcalFetchEvents();
        }).catch(function(err) { alert('Erreur modification Google: ' + err.message); });
    }

    function gcalDeleteEvent(data) {
        if (!_gcalAccessToken) { alert('Google Agenda non connecté'); return; }
        var calId = data.calId;
        if (!calId) {
            var sel = getGcalSel();
            calId = sel.length ? sel[0] : 'primary';
        }
        fetch('https://www.googleapis.com/calendar/v3/calendars/' + encodeURIComponent(calId) + '/events/' + encodeURIComponent(data.eventId), {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + _gcalAccessToken }
        }).then(function(r) {
            if (r.status !== 204 && !r.ok) throw new Error('Erreur ' + r.status);
            notifyPerdirCrudOk();
            gcalFetchEvents();
        }).catch(function(err) { alert('Erreur suppression Google: ' + err.message); });
    }

    function notifyPerdirCrudOk() {
        var fr = document.getElementById('frame-perdir');
        if (fr && fr.contentWindow) {
            fr.contentWindow.postMessage({type:'pilote-gcal-crud-ok'}, '*');
        }
    }

    function pushGcalToModules() {
        var s = getSettings();
        var frame = document.getElementById('frame-perdir');
        if (frame && frame.contentWindow) {
            frame.contentWindow.postMessage({ type: 'pilote-settings', data: {
                school: s.school || '', name: s.name || '', role: s.role || '', city: s.city || '',
                zone: s.zone || 'B', logoSrc: s.logoSrc || '', signSrc: s.signSrc || '',
                teachers: s.teachers || [], students: s.students || [],
                gcalEnabled: s.gcalEnabled || false,
                gcalEvents: s.gcalEvents || [],
                gcalCalendars: s.gcalCals || [],
                gcalSel: s.gcalSel || []
            }}, '*');
        }
    }

    function addManualCal() {
        var id = document.getElementById('gcal-manual-id').value.trim();
        var name = document.getElementById('gcal-manual-name').value.trim() || id;
        if (!id) { alert('Saisissez l\'ID du calendrier.'); return; }
        var s = getSettings();
        if (!s.gcalCals) s.gcalCals = [];
        if (s.gcalCals.find(function(c) { return c.id === id; })) { alert('D\u00e9j\u00e0 ajout\u00e9.'); return; }
        var colors = ['#4285f4', '#0b8043', '#d50000', '#f09300', '#7986cb', '#8e24aa', '#039be5', '#616161'];
        var bg = colors[s.gcalCals.length % colors.length];
        s.gcalCals.push({ id: id, name: name, bg: bg, manual: true });
        if (!s.gcalSel) s.gcalSel = [];
        s.gcalSel.push(id);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
        _gcalCalsData = s.gcalCals;
        renderGcalList(s.gcalCals, s.gcalSel);
        renderManualList(s.gcalCals);
        document.getElementById('gcal-manual-id').value = '';
        document.getElementById('gcal-manual-name').value = '';
    }

    function renderManualList(cals) {
        var div = document.getElementById('gcal-manual-list');
        if (!div) return;
        var manuals = (cals || []).filter(function(c) { return c.manual; });
        if (!manuals.length) { div.innerHTML = ''; return; }
        var h = '';
        manuals.forEach(function(c) {
            h += '<div style="display:flex;align-items:center;gap:6px;font-size:.72rem;padding:2px 0;">';
            h += '<span style="width:8px;height:8px;border-radius:50%;background:' + c.bg + ';"></span>' + c.name;
            h += ' <button onclick="removeManualCal(this.dataset.cid)" data-cid="' + c.id + '" style="background:none;border:none;color:#e74c3c;cursor:pointer;font-size:.72rem;">&times;</button></div>';
        });
        div.innerHTML = h;
    }

    function removeManualCal(id) {
        var s = getSettings();
        s.gcalCals = (s.gcalCals || []).filter(function(c) { return c.id !== id; });
        s.gcalSel = (s.gcalSel || []).filter(function(x) { return x !== id; });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
        _gcalCalsData = s.gcalCals;
        renderGcalList(s.gcalCals, s.gcalSel);
        renderManualList(s.gcalCals);
    }

    function closeSettings() { document.getElementById('settingsOverlay').classList.remove('open'); }

    // ═══ EXPORT / IMPORT SETTINGS ═══
    function exportSettings() {
        const s = getSettings();
        const json = JSON.stringify(s, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const date = new Date().toISOString().split('T')[0];
        a.download = 'pilote_parametres_' + date + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function importSettings(input) {
        const file = input.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const imported = JSON.parse(e.target.result);
                // Validate it's an object
                if (typeof imported !== 'object' || Array.isArray(imported)) throw new Error('Format invalide');
                // Merge: imported settings overwrite current
                localStorage.setItem(STORAGE_KEY, JSON.stringify(imported));
                loadSettingsUI();
                applyNavOrder();
                updateBrandLogo();
                pushSettingsToAllModules();
                alert('✅ Paramètres importés avec succès !');
            } catch(err) {
                alert('❌ Erreur lors de l\'import : ' + err.message);
            }
        };
        reader.readAsText(file);
        input.value = ''; // reset for re-import
    }

    // ═══ DRAG & DROP ORDER ═══
    function _makeOrderItem(list, id, checked) {
        const li = document.createElement('li');
        if (id === '__sep__') {
            li.className = 'order-item sep-item';
            li.setAttribute('draggable', 'true');
            li.dataset.module = '__sep__';
            li.innerHTML = `
                <span class="order-grip"><i class="fas fa-grip-vertical"></i></span>
                <span class="sep-label">— séparateur —</span>
                <span class="sep-line"></span>
                <button class="sep-del" title="Supprimer" onclick="this.closest('li').remove()"><i class="fas fa-times"></i></button>
            `;
        } else {
            const meta = MODULE_META[id];
            if (!meta) return null;
            const isChecked = checked !== false;
            li.className = 'order-item';
            li.setAttribute('draggable', 'true');
            li.dataset.module = id;
            li.innerHTML = `
                <span class="order-grip"><i class="fas fa-grip-vertical"></i></span>
                <span class="order-icon" style="background:${meta.color}"><i class="${meta.icon}"></i></span>
                <span class="order-label">${meta.label} <span style="color:#999;font-weight:400;font-size:0.72rem;">— ${meta.sublabel}</span></span>
                <label class="toggle-switch" onclick="event.stopPropagation()">
                    <input type="checkbox" id="tog-${id}" ${isChecked ? 'checked' : ''} onchange="updateModuleVisibility()">
                    <span class="toggle-slider"></span>
                </label>
            `;
        }
        li.addEventListener('dragstart', () => { li.classList.add('dragging'); });
        li.addEventListener('dragend', () => { li.classList.remove('dragging'); document.querySelectorAll('.order-item').forEach(el => el.classList.remove('drag-over')); });
        li.addEventListener('dragover', (e) => { e.preventDefault(); li.classList.add('drag-over'); });
        li.addEventListener('dragleave', () => { li.classList.remove('drag-over'); });
        li.addEventListener('drop', (e) => {
            e.preventDefault();
            li.classList.remove('drag-over');
            const dragging = list.querySelector('.dragging');
            if (dragging && dragging !== li) {
                const items = [...list.children];
                const fromIdx = items.indexOf(dragging);
                const toIdx = items.indexOf(li);
                if (fromIdx < toIdx) li.after(dragging); else li.before(dragging);
            }
        });
        return li;
    }

    function renderOrderList() {
        const order = getNavOrder();
        const s = getSettings();
        const list = document.getElementById('orderList');
        list.innerHTML = '';
        order.forEach((id) => {
            const checked = id === '__sep__' ? null : s['show_' + id] !== false;
            const li = _makeOrderItem(list, id, checked);
            if (li) list.appendChild(li);
        });
    }

    function addSeparatorToOrderList() {
        const list = document.getElementById('orderList');
        const li = _makeOrderItem(list, '__sep__', null);
        if (li) list.appendChild(li);
    }

    function getCurrentOrderFromList() {
        return [...document.querySelectorAll('#orderList .order-item')].map(el => el.dataset.module);
    }

    function applyNavOrder() {
        const order = getNavOrder();
        const container = document.getElementById('navItems');
        const items = {};
        container.querySelectorAll('.nav-item').forEach(el => { items[el.dataset.module] = el; });
        while (container.firstChild) container.removeChild(container.firstChild);
        order.forEach((id) => {
            if (id === '__sep__') {
                const sep = document.createElement('div');
                sep.className = 'nav-sep';
                container.appendChild(sep);
            } else if (items[id]) {
                container.appendChild(items[id]);
            }
        });

        // Also reorder welcome cards
        const grid = document.getElementById('moduleGrid');
        const cards = {};
        grid.querySelectorAll('.module-card').forEach(c => { cards[c.dataset.m] = c; });
        while (grid.firstChild) grid.removeChild(grid.firstChild);
        order.forEach(id => { if (cards[id]) grid.appendChild(cards[id]); });
    }

    // ═══ EXCEL IMPORT (Data Panel) ═══
    function handleExcelImport(input, type) {
        const files = Array.from(input.files);
        if (!files.length) return;

        // Ask whether to merge or replace if data already exists
        const s = getSettings();
        const existing = s[type] || [];
        let mergeMode = false;
        if (existing.length > 0 && files.length >= 1) {
            mergeMode = confirm('Des données existent déjà (' + existing.length + ' entrées).\n\nOK = Ajouter aux données existantes\nAnnuler = Remplacer les données');
        }

        const label = document.getElementById('lbl-' + type);
        if (label) label.textContent = 'Lecture de ' + files.length + ' fichier(s)...';

        let allData = mergeMode ? existing.slice() : [];
        let processed = 0;
        let errors = [];

        files.forEach(function(file, idx) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const wb = XLSX.read(e.target.result, { type: 'array' });
                    const sheet = wb.Sheets[wb.SheetNames[0]];
                    const rows = XLSX.utils.sheet_to_json(sheet, { defval: '' });
                    allData = allData.concat(rows);
                } catch(err) {
                    errors.push(file.name + ': ' + err.message);
                }
                processed++;
                if (processed === files.length) {
                    // All files read — save
                    const s2 = getSettings();
                    s2[type] = allData;
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(s2));
                    refreshDataUI();
                    pushSettingsToAllModules();
                    if (errors.length) alert('Erreurs sur certains fichiers :\n' + errors.join('\n'));
                    if (label) label.textContent = files.length + ' fichier(s) chargé(s) ✓';
                }
            };
            reader.readAsArrayBuffer(file);
        });
    }

    function clearExcelData(type) {
        if (!confirm('Supprimer les données importées ?')) return;
        const s = getSettings();
        delete s[type];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
        refreshDataUI();
        pushSettingsToAllModules();
    }

    function refreshDataUI() {
        const s = getSettings();
        ['teachers', 'students'].forEach(type => {
            const data = s[type];
            const hasData = data && data.length > 0;
            const label = type === 'teachers' ? 'enseignant' : 'élève';
            document.getElementById('drop-' + type).classList.toggle('loaded', hasData);
            document.getElementById('lbl-' + type).textContent = hasData ? (data.length + ' entrées chargées ✓') : 'Cliquez ou glissez un ou plusieurs fichiers Excel';
            document.getElementById('actions-' + type).style.display = hasData ? 'flex' : 'none';
            document.getElementById('badge-' + type).textContent = hasData ? (data.length + ' ' + label + 's') : 'Non chargé';
            document.getElementById('badge-' + type).classList.toggle('has-data', hasData);
            document.getElementById('count-' + type).innerHTML = hasData ? ('<i class="fas fa-check-circle"></i> <strong>' + data.length + '</strong> ' + label + '(s) importé(s)') : '';
            if (!hasData) { document.getElementById('preview-' + type).style.display = 'none'; document.getElementById('preview-' + type).innerHTML = ''; }
        });
    }

    function togglePreview(type) {
        const el = document.getElementById('preview-' + type);
        if (el.style.display === 'none') {
            const s = getSettings();
            const data = s[type];
            if (!data || !data.length) return;
            const cols = Object.keys(data[0]);
            let html = '<table><thead><tr>' + cols.map(c => '<th>' + c + '</th>').join('') + '</tr></thead><tbody>';
            data.slice(0, 50).forEach(row => {
                html += '<tr>' + cols.map(c => '<td>' + (row[c] || '') + '</td>').join('') + '</tr>';
            });
            if (data.length > 50) html += '<tr><td colspan="' + cols.length + '" style="text-align:center;color:#999;font-style:italic">… et ' + (data.length - 50) + ' autres lignes</td></tr>';
            html += '</tbody></table>';
            el.innerHTML = html;
            el.style.display = 'block';
        } else {
            el.style.display = 'none';
        }
    }

    // ═══ DATA PANEL ═══
    function openDataPanel() {
        closeDataPanel();
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const navItem = document.querySelector('.nav-item[data-module="data"]');
        if (navItem) navItem.classList.add('active');
        document.getElementById('welcome').classList.add('hidden');
        document.querySelectorAll('.module-frame').forEach(f => f.classList.remove('active'));
        document.getElementById('dataPanel').classList.add('active');
        currentModule = 'data';
        document.title = 'PILOTE — Données';
        refreshDataUI();
    }

    function closeDataPanel() { document.getElementById('dataPanel').classList.remove('active'); }

    // ═══ PUSH TO MODULES ═══
    function pushSettingsToModule(name) {
        const frame = document.getElementById('frame-' + name);
        if (!frame || !frame.contentWindow) return;
        const s = getSettings();
        frame.contentWindow.postMessage({
            type: 'pilote-settings',
            data: { school: s.school||'', name: s.name||'', role: s.role||'', city: s.city||'', zone: s.zone||'B', logoSrc: s.logoSrc||'', signSrc: s.signSrc||'', teachers: s.teachers||[], students: s.students||[], gcalEnabled: s.gcalEnabled||false, gcalEvents: s.gcalEvents||[], pdfHeaderLayout: s.pdfHeaderLayout||'classique', pdfHeaderColor: s.pdfHeaderColor||'#1b2433', pdfHeaderSubtitle: s.pdfHeaderSubtitle||'' }
        }, '*');
    }

    function pushSettingsToAllModules() { loadedModules.forEach(name => pushSettingsToModule(name)); }

    window.addEventListener('message', function(e) {
        if (e.data && e.data.type === 'pilote-gcal-refresh') { gcalFetchEvents(); return; }
        if (e.data && e.data.type === 'pilote-gcal-add') { gcalAddEvent(e.data); return; }
        if (e.data && e.data.type === 'pilote-gcal-update') { gcalUpdateEvent(e.data); return; }
        if (e.data && e.data.type === 'pilote-gcal-delete') { gcalDeleteEvent(e.data); return; }
        if (e.data && e.data.type === 'pilote-outlook-add') { outlookAddEvent(e.data); return; }
        if (e.data && e.data.type === 'pilote-outlook-update') { outlookUpdateEvent(e.data); return; }
        if (e.data && e.data.type === 'pilote-outlook-delete') { outlookDeleteEvent(e.data); return; }
        if (e.data && e.data.type === 'pilote-outlook-refresh') { outlookFetchEvents(); return; }
        if (e.data && e.data.type === 'pilote-module-ready' && e.data.module) {
            setTimeout(() => { pushSettingsToModule(e.data.module); if(typeof pushOutlookToModules==='function') pushOutlookToModules(); }, 200);
        }
    });

    // ═══ MODULE VISIBILITY ═══
    

    // ═══ HOME GRID LAYOUT (2 lignes symétriques) ═══
    function updateHomeGrid(){
        const grid = document.querySelector('.module-grid');
        if(!grid) return;
        const cards = Array.from(grid.querySelectorAll('.module-card')).filter(c => !c.classList.contains('card-hidden'));
        const n = cards.length;
        if(n === 0) return;
        const cols = Math.ceil(n / 2);
        grid.style.setProperty('--home-cols', cols);
    }

function updateModuleVisibility() {
        moduleNames.forEach(m => {
            const tog = document.getElementById('tog-' + m);
            const visible = tog ? tog.checked : true;
            const navItem = document.querySelector('.nav-item[data-module="' + m + '"]');
            if (navItem) navItem.classList.toggle('hidden-module', !visible);
            const card = document.querySelector('.module-card[data-m="' + m + '"]');
            if (card) card.classList.toggle('card-hidden', !visible);
            if (!visible && currentModule === m) goHome();
    try{ renderHomeTodayEvents(); }catch(e){} try{ renderHomeUpcoming2Weeks(); }catch(e){}
        });
        updateHomeGrid();
    }

    // ═══ MODULE LOADING ═══
    function b64toBlob(b64) {
        const bin = atob(b64);
        const bytes = new Uint8Array(bin.length);
        for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
        return URL.createObjectURL(new Blob([bytes], { type: 'text/html; charset=utf-8' }));
    }

    
    // ═══ KEYBOARD SHORTCUTS ═══
    document.addEventListener('keydown', function(e) {
        // Only trigger with Ctrl (not inside iframes)
        if (!e.ctrlKey || e.shiftKey || e.altKey || e.metaKey) return;
        var key = e.key.toLowerCase();
        var map = {
            'p': 'perdir',
            'e': 'exam',
            'o': 'oral',
            'a': 'aed',
            'b': 'bibase',
            'h': 'dhg',
            'd': 'data'
        };
        if (map[key]) {
            e.preventDefault();
            e.stopPropagation();
            loadModule(map[key]);
        }
    });

    // Also listen for shortcuts from within iframes
    window.addEventListener('message', function(e) {
        if (e.data && e.data.type === 'pilote-shortcut') {
            var map = {'p':'perdir','e':'exam','o':'oral','a':'aed','d':'data'};
            if (map[e.data.key]) loadModule(map[e.data.key]);
        }
    });

    function loadModule(name) {
        if (name === 'data') { openDataPanel(); return; }
        const s = getSettings();
        if (s['show_' + name] === false) return;
        closeDataPanel();
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const navItem = document.querySelector('.nav-item[data-module="' + name + '"]');
        if (navItem) navItem.classList.add('active');
        document.querySelectorAll('.module-card').forEach(el => el.classList.remove('active'));
        const card = document.querySelector('.module-card[data-m="' + name + '"]');
        if (card) card.classList.add('active');
        document.getElementById('welcome').classList.add('hidden');
        document.querySelectorAll('.module-frame').forEach(f => f.classList.remove('active'));
        const frame = document.getElementById('frame-' + name);
        if (name === 'dhg') {
            // DHG est intégré dans ce fichier : on le charge via srcdoc
            if (!loadedModules.has(name)) {
                document.getElementById('loader').classList.add('show');
                const tpl = document.getElementById('tpl-dhg');
                frame.removeAttribute('src');
                frame.srcdoc = tpl ? tpl.innerHTML : '<!doctype html><meta charset="utf-8"><title>DHG</title><p>Template DHG introuvable.</p>';
                frame.onload = () => {
                    loadedModules.add(name);
                    document.getElementById('loader').classList.remove('show');
                    frame.classList.add('active');
                };
            } else {
                frame.classList.add('active');
            }
            currentModule = name;
            document.title = 'PILOTE — DHG';
            return;
        }
        if (!loadedModules.has(name)) {
            document.getElementById('loader').classList.add('show');
            if (!blobUrls[name]) blobUrls[name] = b64toBlob(MODULE_DATA[name]);
            frame.src = blobUrls[name];
            frame.onload = () => {
                loadedModules.add(name);
                document.getElementById('loader').classList.remove('show');
                frame.classList.add('active');
                setTimeout(() => pushSettingsToModule(name), 300);
                if(name === 'perdir') setTimeout(() => installCadirCalendarOverride(), 700);
            };
        } else { frame.classList.add('active'); }
        currentModule = name;
        document.title = 'PILOTE — ' + (name === 'exam' ? 'ÉCRIT' : name.toUpperCase());
    }

    function goHome() {
        currentModule = null;
        closeDataPanel();
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.module-card').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.module-frame').forEach(f => f.classList.remove('active'));
        document.getElementById('welcome').classList.remove('hidden');
        try{ renderHomeTodayEvents(); }catch(e){} try{ renderHomeUpcoming2Weeks(); }catch(e){}
        document.title = 'PILOTE — Suite de Direction';
    }

    function updateClock() {
        document.getElementById('clock').textContent = new Date().toLocaleDateString('fr-FR', { weekday:'short', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit' });
    }
    updateClock(); setInterval(updateClock, 30000);


    function _todayIso(){ return new Date().toISOString().split('T')[0]; }
    function _fmtFRDate(iso){ try{ var d=new Date(iso+'T00:00:00'); return d.toLocaleDateString('fr-FR',{weekday:'short',day:'2-digit',month:'short'}); }catch(e){ return iso; } }
    function _safeTime(t){ return (t||'').substring(0,5); }

    function getMasterAllCalendarEvents(){
        var s = getSettings();
        var all = [];
        (s.gcalEvents || []).forEach(function(e){ all.push({src:'gcal', color:e.color||'#4285f4', calName:e.calName||'Google', title:e.title, date:e.date, time:_safeTime(e.time), endTime:_safeTime(e.endTime)}); });
        (s.outlookEvents || []).forEach(function(e){ all.push({src:'outlook', color:e.color||'#0078d4', calName:e.calName||'Outlook', title:e.title, date:e.date, time:_safeTime(e.time), endTime:_safeTime(e.endTime)}); });
        return all;
    }

    function renderHomeTodayEvents(){
    var box = document.getElementById('homeEventsBody');
    if(!box) return;

    var today = _todayIso();
    var evs = getMasterAllCalendarEvents().filter(function(e){ return e.date === today; });
    evs.sort(function(a,b){ return (a.time||'99:99').localeCompare(b.time||'99:99'); });

    if(!evs.length){
        box.innerHTML = '<div class="home-ev-empty">Aucun événement aujourd\'hui. <span style="font-weight:800;color:#94a3b8">Si besoin, synchronise tes agendas (bouton Sync).</span></div>';
        return;
    }

    box.innerHTML = evs.map(function(e){
        var time = e.time ? (e.time + (e.endTime ? '–'+e.endTime : '')) : 'Journée';
        return '<div class="home-ev">'
            + '<span class="home-ev-dot" style="background:'+ (e.color||'#999') +'"></span>'
            + '<div class="home-ev-when"><div class="home-ev-time">'+ escHtml(time) +'</div><div class="home-ev-date">'+ escHtml(_fmtFRDate(e.date)) +'</div></div>'
            + '<div style="flex:1;min-width:0"><div class="home-ev-title">'+ escHtml(e.title||'(sans titre)') +'</div><div class="home-ev-cal">'+ escHtml(e.calName||'Agenda') +'</div></div>'
            + '</div>';
    }).join('');
}

function renderHomeUpcoming2Weeks(){
    var grid = document.getElementById('homeUpcomingGrid');
    var empty = document.getElementById('homeUpcomingEmpty');
    if(!grid || !empty) return;

    var all = getMasterAllCalendarEvents();
    var start = _todayIso();
    var startDate = new Date(start+'T00:00:00');
    var endDate = new Date(startDate.getTime() + 13*24*3600*1000); // 14 jours (J0..J13)

    var windowEvs = all.filter(function(e){
        if(!e.date) return false;
        var d = new Date(e.date+'T00:00:00');
        return d >= startDate && d <= endDate;
    });

    var groups = {};
    windowEvs.forEach(function(e){
        var k = (e.calName||'Agenda').trim();
        if(!groups[k]) groups[k] = {name:k, color:e.color||'#94a3b8', events:[]};
        groups[k].events.push(e);
        if(groups[k].color === '#94a3b8' && e.color) groups[k].color = e.color;
    });

    var cals = Object.keys(groups).sort(function(a,b){ return a.localeCompare(b); }).map(function(k){
        groups[k].events.sort(function(a,b){
            return (a.date+' '+(a.time||'99:99')).localeCompare(b.date+' '+(b.time||'99:99'));
        });
        return groups[k];
    });

    if(!cals.length){
        grid.innerHTML = '';
        empty.style.display = 'block';
        empty.innerHTML = 'Aucun événement dans les 14 prochains jours. (Pense à synchroniser Google/Outlook si besoin.)';
        return;
    }

    empty.style.display = 'none';
    grid.innerHTML = cals.map(function(cal){
        var rows = cal.events.slice(0, 60).map(function(e){
            var when = (e.time ? (e.time + (e.endTime ? '–'+e.endTime : '')) : 'Journée')
                     + '<div style="font-weight:700;color:#64748b;font-size:.70rem;margin-top:1px">'+ escHtml(_fmtFRDate(e.date)) +'</div>';
            return '<div class="home-calev">'
                + '<div class="when">'+ when +'</div>'
                + '<div class="meta"><div class="t">'+ escHtml(e.title||'(sans titre)') +'</div><div class="s">'+ escHtml(cal.name) +'</div></div>'
                + '</div>';
        }).join('');
        return '<div class="home-calcard">'
            + '<h4><span class="dot" style="background:'+ (cal.color||'#94a3b8') +'"></span>'+ escHtml(cal.name) +'</h4>'
            + rows
            + '</div>';
    }).join('');
}

    function trySyncCalendars(){
        var s = getSettings();
        // Sync Google if enabled & connected via OAuth or API key present
        if (s.gcalEnabled) { try { gcalFetchEvents(); } catch(e) {} }
        if (s.outlookEnabled) { try { outlookFetchEvents(); } catch(e) {} }
        // Refresh view shortly after (even if sync fails, no harm)
        setTimeout(function(){ renderHomeTodayEvents(); renderHomeUpcoming2Weeks(); }, 1200);
    }


    // --- CADIR (module perdir) : remplacer la page "Calendrier" par une vue "2 semaines par agenda" ---
function installCadirCalendarOverride(){
    try{
        var frame = document.getElementById('frame-perdir');
        if(!frame || !frame.contentWindow || !frame.contentDocument) return;

        // Évite double installation
        if(frame.contentWindow.__CAL_OVERRIDE_INSTALLED__) return;
        frame.contentWindow.__CAL_OVERRIDE_INSTALLED__ = true;

        var doc = frame.contentDocument;

        // Injecte un style minimal dans l'iframe
        var style = doc.createElement('style');
        style.textContent = `
            .cadir-cal-override{padding:18px 18px 26px 18px;}
            .cadir-cal-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:4px 0 14px 0;}
            .cadir-cal-title{font-weight:800;font-size:1.05rem;color:#0f172a;display:flex;align-items:center;gap:10px;}
            .cadir-cal-title .pill{font-size:.72rem;font-weight:800;color:#334155;background:#e2e8f0;border:1px solid #cbd5e1;border-radius:999px;padding:4px 10px}
            .cadir-cal-actions{display:flex;gap:8px;flex-wrap:wrap}
            .cadir-cal-btn{border:none;border-radius:10px;padding:9px 12px;font-weight:700;cursor:pointer;font-size:.82rem}
            .cadir-cal-btn.primary{background:#0ea5e9;color:#fff}
            .cadir-cal-btn.ghost{background:#fff;border:1px solid #e2e8f0;color:#0f172a}
            .cadir-cal-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;}
            @media(max-width: 980px){.cadir-cal-grid{grid-template-columns:1fr;}}
            .cadir-cal-card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;overflow:hidden;box-shadow:0 8px 22px rgba(15,23,42,.05)}
            .cadir-cal-card h4{margin:0;padding:12px 14px;border-bottom:1px solid #eef2f7;display:flex;align-items:center;gap:10px;font-size:.95rem;font-weight:800;color:#0f172a;}
            .cadir-cal-dot{width:10px;height:10px;border-radius:999px;display:inline-block}
            .cadir-cal-list{padding:10px 14px 12px 14px;}
            .cadir-cal-row{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid #f1f5f9}
            .cadir-cal-row:last-child{border-bottom:none}
            .cadir-cal-when{min-width:92px;font-weight:800;color:#0f172a;font-size:.84rem}
            .cadir-cal-when small{display:block;color:#64748b;font-weight:800;font-size:.72rem;margin-top:2px}
            .cadir-cal-meta{min-width:0}
            .cadir-cal-meta .t{font-weight:800;color:#0f172a;font-size:.88rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
            .cadir-cal-meta .s{color:#64748b;font-weight:700;font-size:.74rem;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
            .cadir-cal-empty{padding:14px;border:1px dashed #cbd5e1;border-radius:14px;background:#f8fafc;color:#475569;font-weight:700}
            .cadir-cal-sep{height:1px;background:#e2e8f0;margin:14px 0}
        `;
        doc.head.appendChild(style);

        function escHtml(str){
            return String(str||'').replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]); });
        }
        function isoToday(){ return new Date().toISOString().split('T')[0]; }
        function fmtFR(iso){
            try{ return new Date(iso+'T00:00:00').toLocaleDateString('fr-FR',{weekday:'short',day:'2-digit',month:'short'}); }
            catch(e){ return iso; }
        }
        function safeTime(t){ return (t||'').substring(0,5); }

        function getAllEvents(){
            // Lit directement la sauvegarde CADIR (mêmes clés que l’onglet "Agendas externes")
            var s = {};
            try{ s = JSON.parse(localStorage.getItem('pilote_suite_settings') || '{}'); }catch(e){}
            // fallback : si la sauvegarde est stockée dans un autre objet "settings"
            if(!s || typeof s !== 'object') s = {};
            var all = [];
            (s.gcalEvents || []).forEach(function(e){ all.push({src:'gcal', color:e.color||'#4285f4', calName:e.calName||'Google', title:e.title, date:e.date, time:safeTime(e.time), endTime:safeTime(e.endTime)}); });
            (s.outlookEvents || []).forEach(function(e){ all.push({src:'outlook', color:e.color||'#0078d4', calName:e.calName||'Outlook', title:e.title, date:e.date, time:safeTime(e.time), endTime:safeTime(e.endTime)}); });
            return all;
        }

        function render2WeeksInto(container){
            var all = getAllEvents();
            var start = isoToday();
            var startDate = new Date(start+'T00:00:00');
            var endDate = new Date(startDate.getTime() + 13*24*3600*1000);

            var windowEvs = all.filter(function(e){
                if(!e.date) return false;
                var d = new Date(e.date+'T00:00:00');
                return d >= startDate && d <= endDate;
            });

            // group by calendar
            var groups = {};
            windowEvs.forEach(function(e){
                var k = (e.calName||'Agenda').trim();
                if(!groups[k]) groups[k] = {name:k, color:e.color||'#94a3b8', events:[]};
                groups[k].events.push(e);
                if(groups[k].color === '#94a3b8' && e.color) groups[k].color = e.color;
            });

            var cals = Object.keys(groups).sort(function(a,b){ return a.localeCompare(b); }).map(function(k){
                groups[k].events.sort(function(a,b){
                    return (a.date+' '+(a.time||'99:99')).localeCompare(b.date+' '+(b.time||'99:99'));
                });
                return groups[k];
            });

            // Header
            var total = all.length;
            var inWindow = windowEvs.length;

            var html = '<div class="cadir-cal-override">'
                + '<div class="cadir-cal-head">'
                +   '<div class="cadir-cal-title">Calendrier — vue agendas <span class="pill">14 jours</span> <span class="pill">Google/Outlook: '+ total +'</span></div>'
                +   '<div class="cadir-cal-actions">'
                +     '<button class="cadir-cal-btn ghost" type="button" id="btnCalRefresh">Rafraîchir</button>'
                +     '<button class="cadir-cal-btn primary" type="button" id="btnCalSync">Synchroniser</button>'
                +   '</div>'
                + '</div>';

            if(!cals.length){
                html += '<div class="cadir-cal-empty">Aucun événement dans les 14 prochains jours. '
                     + '👉 Clique sur “Synchroniser” si nécessaire, ou vérifie que tes agendas sélectionnés contiennent des événements à venir.</div>';
                html += '</div>';
                container.innerHTML = html;
            } else {
                html += '<div class="cadir-cal-grid">'
                    + cals.map(function(cal){
                        var rows = cal.events.slice(0, 80).map(function(e){
                            var time = e.time ? (e.time + (e.endTime ? '–'+e.endTime : '')) : 'Journée';
                            return '<div class="cadir-cal-row">'
                                + '<div class="cadir-cal-when">'+ escHtml(time) +'<small>'+ escHtml(fmtFR(e.date)) +'</small></div>'
                                + '<div class="cadir-cal-meta"><div class="t">'+ escHtml(e.title||'(sans titre)') +'</div><div class="s">'+ escHtml(cal.name) +'</div></div>'
                                + '</div>';
                        }).join('');
                        return '<div class="cadir-cal-card">'
                            + '<h4><span class="cadir-cal-dot" style="background:'+ (cal.color||'#94a3b8') +'"></span>'+ escHtml(cal.name) +'</h4>'
                            + '<div class="cadir-cal-list">'+ rows +'</div>'
                            + '</div>';
                    }).join('')
                    + '</div>'
                    + '</div>';
                container.innerHTML = html;
            }

            // Actions
            var btnR = container.querySelector('#btnCalRefresh');
            if(btnR) btnR.onclick = function(){ render2WeeksInto(container); };
            var btnS = container.querySelector('#btnCalSync');
            if(btnS) btnS.onclick = function(){
                // On déclenche les fonctions existantes dans l’iframe si elles existent
                try{ if(typeof frame.contentWindow.gcalFetchEvents === 'function') frame.contentWindow.gcalFetchEvents(); }catch(e){}
                try{ if(typeof frame.contentWindow.outlookFetchEvents === 'function') frame.contentWindow.outlookFetchEvents(); }catch(e){}
                setTimeout(function(){ render2WeeksInto(container); }, 1300);
            };
        }

        function findCalendarHost(){
            // On détecte l’écran "Calendrier" via le titre affiché
            var candidates = Array.from(doc.querySelectorAll('h1,h2,h3,div')).filter(function(el){
                var t = (el.textContent||'').trim();
                return t === 'Calendrier';
            });
            if(!candidates.length) return null;

            // On remonte jusqu’à un conteneur stable
            var titleEl = candidates[0];
            var host = titleEl.closest('.content, .page, .main, .container, .content-area, .app, body') || doc.body;

            // zone d’injection : on tente de viser la zone principale à droite (dans CADIR)
            var main = titleEl.closest('div') || host;
            // si on trouve une grande zone blanche (comme sur ta capture), on l’utilise
            var big = doc.querySelector('.calendar, #calendar, .calendar-container, .content-right, .page-content');
            return big || main;
        }

        function mountIfCalendarPage(){
            var titleOk = Array.from(doc.querySelectorAll('*')).some(function(el){ return (el.textContent||'').trim() === 'Calendrier'; });
            if(!titleOk) return;

            // Empêche remount en boucle
            if(doc.getElementById('cadirCalOverrideRoot')) return;

            var host = findCalendarHost() || doc.body;
            var root = doc.createElement('div');
            root.id = 'cadirCalOverrideRoot';

            // On masque l’ancienne vue (si elle existe)
            try{
                var old = doc.querySelector('.calendar-grid, .calendar-view, #calendarView, .fc, .fc-view-harness');
                if(old) old.style.display = 'none';
            }catch(e){}

            host.prepend(root);
            render2WeeksInto(root);
        }

        // Observe changements (navigation interne CADIR)
        var obs = new frame.contentWindow.MutationObserver(function(){
            try{ mountIfCalendarPage(); }catch(e){}
        });
        obs.observe(doc.body, {childList:true, subtree:true});

        // Tentative immédiate
        mountIfCalendarPage();

    }catch(e){}
}

    function toggleFullscreen() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else document.exitFullscreen();
    }
    // Apply PERDIR submenus when frames load
    document.getElementById('frame-perdir').addEventListener('load', function(){ setTimeout(applyPerdirSubmenus, 500); setTimeout(pushCalendarsFromStorage, 650); });

    document.addEventListener('fullscreenchange', () => {
        var fsIcon = document.getElementById('fs-icon');
        if (document.fullscreenElement) {
            fsIcon.innerHTML = '<path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>';
        } else {
            fsIcon.innerHTML = '<path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>';
        }
    });

    document.addEventListener('keydown', (e) => {
        if (e.altKey) {
            const order = getNavOrder();
            switch(e.key) {
                case '1': case '2': case '3': case '4': case '5': case '6': {
                    const idx = parseInt(e.key) - 1;
                    if (order[idx]) { e.preventDefault(); loadModule(order[idx]); }
                    break;
                }
                case '0': e.preventDefault(); goHome(); break;
                case 'p': e.preventDefault(); openSettings(); break;
                case 'd': e.preventDefault(); openDataPanel(); break;
            }
        }
        if (e.key === 'Escape') {
            if (document.getElementById('settingsOverlay').classList.contains('open')) closeSettings();
            else if (currentModule) goHome();
        }
    });

    // ═══ INIT ═══
    loadSettingsUI();
    applyNavOrder();
    goHome();
    
    // ═══ ACCORDION TOGGLE ═══
    
    
    // ═══ PERDIR SUBMENUS MANAGEMENT ═══
    var PERDIR_MENUS = [
        {id:'menu2', icon:'fa-check-square', label:'To Do List', color:'#3498db'},
        {id:'menu3', icon:'fa-calendar-alt', label:'Calendrier', color:'#e67e22'},
        {id:'menu4', icon:'fa-clipboard-list', label:'Conseil de Direction', color:'#2c3e50'},
        {id:'menu5', icon:'fa-user-graduate', label:'Suivi Élève / Point CPE', color:'#27ae60'},
        {id:'menu6', icon:'fa-comments', label:'Entretiens', color:'#9b59b6'},
        {id:'menu7', icon:'fa-users', label:'Réunions', color:'#e74c3c'},
        {id:'menu8', icon:'fa-history', label:'Historique', color:'#95a5a6'},
        {id:'menu9', icon:'fa-chart-line', label:'Tableau de Bord', color:'#f39c12'},
        {id:'menu10', icon:'fa-calendar-check', label:'Activités pédagogiques', color:'#1abc9c'},
        {id:'menu11', icon:'fa-stream', label:'Échéances', color:'#8e44ad'},
        {id:'menu12', icon:'fa-book', label:'Procédures', color:'#16a085'}
    ];

    function renderPerdirSubmenus() {
        var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
        var cfg = ms.perdirMenus || PERDIR_MENUS.map(function(m){ return {id:m.id, visible:true}; });
        // Add missing real menus (not separators)
        var cfgIds2 = cfg.filter(function(c){return c.id!=='__sep__';}).map(function(c){return c.id;});
        PERDIR_MENUS.forEach(function(m){if(cfgIds2.indexOf(m.id)<0)cfg.push({id:m.id,visible:true});});
        var list = document.getElementById('perdir-submenu-list');
        if (!list) return;
        list.innerHTML = '';
        cfg.forEach(function(item, i) {
            var el = document.createElement('div');
            el.dataset.idx = i;
            el.dataset.menuid = item.id;
            el.setAttribute('draggable', 'true');
            el.addEventListener('dragstart', function(e){ dragSubM(e, i); });
            el.addEventListener('dragover', function(e){ overSubM(e, el); });
            el.addEventListener('drop', function(e){ dropSubM(e, i); });
            if (item.id === '__sep__') {
                el.className = 'order-item sep-item';
                el.innerHTML = '<span class="order-grip"><i class="fas fa-grip-vertical"></i></span>'
                    + '<span class="sep-label">— séparateur —</span>'
                    + '<span class="sep-line"></span>'
                    + '<button class="sep-del" title="Supprimer" onclick="event.stopPropagation();deleteSubMenuSep('+i+')"><i class="fas fa-times"></i></button>';
            } else {
                var def = PERDIR_MENUS.find(function(m){ return m.id === item.id; });
                if (!def) return;
                el.className = 'order-item';
                el.innerHTML = '<span class="order-grip" style="color:#bbb;font-size:.9rem;"><i class="fas fa-grip-vertical"></i></span>'
                    + '<div class="order-icon" style="background:'+def.color+';width:26px;height:26px;border-radius:6px;display:flex;align-items:center;justify-content:center;color:white;font-size:.7rem;flex-shrink:0;"><i class="fas '+def.icon+'"></i></div>'
                    + '<span class="order-label">'+def.label+'</span>'
                    + '<label class="toggle-switch" onclick="event.stopPropagation()">'
                    + '<input type="checkbox" '+(item.visible!==false?'checked':'')+' onchange="toggleSubM(\''+item.id+'\',this.checked)">'
                    + '<span class="toggle-slider"></span></label>';
            }
            list.appendChild(el);
        });
    }

    function addSubMenuSeparator() {
        var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
        var cfg = ms.perdirMenus || PERDIR_MENUS.map(function(m){ return {id:m.id, visible:true}; });
        cfg.push({id: '__sep__'});
        ms.perdirMenus = cfg;
        localStorage.setItem('pilote_master_settings', JSON.stringify(ms));
        renderPerdirSubmenus();
        applyPerdirSubmenus();
    }

    function deleteSubMenuSep(idx) {
        var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
        var cfg = ms.perdirMenus || PERDIR_MENUS.map(function(m){ return {id:m.id, visible:true}; });
        cfg.splice(idx, 1);
        ms.perdirMenus = cfg;
        localStorage.setItem('pilote_master_settings', JSON.stringify(ms));
        renderPerdirSubmenus();
        applyPerdirSubmenus();
    }

    var _dragSubIdx = null;
    function dragSubM(e, idx) { _dragSubIdx = idx; e.dataTransfer.effectAllowed = 'move'; }
    function overSubM(e, el) { e.preventDefault(); }
    function dropSubM(e, toIdx) {
        e.preventDefault();
        if (_dragSubIdx === null || _dragSubIdx === toIdx) return;
        var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
        var cfg = ms.perdirMenus || PERDIR_MENUS.map(function(m){ return {id:m.id, visible:true}; });
        var item = cfg.splice(_dragSubIdx, 1)[0];
        cfg.splice(toIdx, 0, item);
        ms.perdirMenus = cfg;
        localStorage.setItem('pilote_master_settings', JSON.stringify(ms));
        renderPerdirSubmenus();
        applyPerdirSubmenus();
        _dragSubIdx = null;
    }

    function toggleSubM(menuId, visible) {
        var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
        var cfg = ms.perdirMenus || PERDIR_MENUS.map(function(m){ return {id:m.id, visible:true}; });
        var item = cfg.find(function(c){ return c.id === menuId; });
        if (item) item.visible = visible;
        ms.perdirMenus = cfg;
        localStorage.setItem('pilote_master_settings', JSON.stringify(ms));
        applyPerdirSubmenus();
    }

    function applyPerdirSubmenus() {
        var fr = document.getElementById('frame-perdir');
        try { if (!fr || !fr.contentWindow || !fr.contentWindow.document) return; } catch(e) { return; }
        var ms = JSON.parse(localStorage.getItem('pilote_master_settings') || '{}');
        var cfg = ms.perdirMenus || PERDIR_MENUS.map(function(m){ return {id:m.id, visible:true}; });
        var cfgIds = cfg.filter(function(c){return c.id!=='__sep__';}).map(function(c){return c.id;});
        PERDIR_MENUS.forEach(function(m){if(cfgIds.indexOf(m.id)<0)cfg.push({id:m.id,visible:true});});
        var menuDiv; try { menuDiv = fr.contentWindow.document.querySelector('.menu'); } catch(e) { return; }
        if (!menuDiv) return;

        // Remove previously injected separators
        menuDiv.querySelectorAll('.__cadir_sep__').forEach(function(s){ s.remove(); });

        // First pass: order & visibility of real items
        var visNum = 1;
        cfg.filter(function(c){return c.id!=='__sep__';}).forEach(function(item, i) {
            var link = menuDiv.querySelector('[data-menu="'+item.id+'"]');
            if (link) {
                var isVisible = item.visible !== false;
                link.style.display = isVisible ? '' : 'none';
                // order = position in cfg (skipping seps for offset)
                link.style.order = cfg.indexOf(item) * 2; // *2 to leave room for seps
                if (isVisible) {
                    var numSpan = link.querySelector('.menu-num');
                    if (numSpan) numSpan.textContent = visNum + '.';
                    visNum++;
                }
            }
        });

        // Second pass: insert separator elements at correct flex order
        cfg.forEach(function(item, i) {
            if (item.id !== '__sep__') return;
            var hr = fr.contentWindow.document.createElement('hr');
            hr.className = '__cadir_sep__';
            hr.style.cssText = 'border:none;border-top:1.5px solid #ffffff;margin:6px 10px;order:'+(i*2-1)+';flex-shrink:0;border-radius:2px;';
            menuDiv.appendChild(hr);
        });

        menuDiv.style.display = 'flex';
        menuDiv.style.flexDirection = 'column';
    }

    function triggerVacancesUpdate() {
        var fr = document.getElementById('frame-perdir');
        if (fr && fr.contentWindow && typeof fr.contentWindow.majVacances === 'function') {
            fr.contentWindow.majVacances();
        } else {
            alert('Module PERDIR non chargé. Ouvrez d\'abord le module PERDIR.');
        }
    }

    
    function updateFavicon(logoSrc){
        if(!logoSrc)return;
        var link=document.querySelector('link[rel="icon"]');
        if(!link){link=document.createElement('link');link.rel='icon';document.head.appendChild(link);}
        link.href=logoSrc;
    }

    function toggleAcc(header) {
        var section = header.parentElement;
        var wasOpen = section.classList.contains('open');
        // Fermer tous les autres
        document.querySelectorAll('.acc-section.open').forEach(function(s) { s.classList.remove('open'); });
        // Ouvrir celui-ci sauf s'il était déjà ouvert
        if (!wasOpen) section.classList.add('open');
    }

    // ═══ CLOUD SYNC (multi-fournisseur) ═══
    var _cloudProvider = 'jsonbin';

    function selectCloudProvider(prov) {
        _cloudProvider = prov;
        ['jsonbin','gist','webdav','gdrive','localfolder'].forEach(function(p) {
            var el = document.getElementById('cloud-cfg-' + p);
            if (el) el.style.display = p === prov ? 'block' : 'none';
            var btn = document.querySelector('.cloud-prov-btn[data-prov="'+p+'"]');
            if (btn) btn.classList.toggle('active', p === prov);
        });
        if (prov === 'localfolder' && typeof lfInitMode === 'function') lfInitMode();
            updateHomeGrid();
            if(!window.__homeGridResize){ window.__homeGridResize=true; window.addEventListener('resize', updateHomeGrid); }
    }

    function toggleCloudUI() {
        var on = document.getElementById('s-cloud-enabled').checked;
        document.getElementById('cloud-opts').style.display = on ? 'block' : 'none';
    }

    function getCloudConfig() {
        return {
            provider: _cloudProvider,
            // jsonbin
            key: (document.getElementById('s-cloud-key').value || '').trim(),
            bin: (document.getElementById('s-cloud-bin').value || '').trim(),
            // github gist
            gistToken: (document.getElementById('s-gist-token').value || '').trim(),
            gistId: (document.getElementById('s-gist-id').value || '').trim(),
            // gdrive
            gdriveClientId: (document.getElementById('s-gdrive-clientid').value || '').trim(),
            gdriveFileId: (document.getElementById('s-gdrive-fileid').value || '').trim(),
            // webdav
            wdUrl: (document.getElementById('s-webdav-url').value || '').trim(),
            wdUser: (document.getElementById('s-webdav-user').value || '').trim(),
            wdPass: (document.getElementById('s-webdav-pass').value || '').trim(),
            // common
            auto: document.getElementById('s-cloud-auto').checked,
            enabled: document.getElementById('s-cloud-enabled').checked
        };
    }

    function cloudSetStatus(msg, color) {
        var el = document.getElementById('cloud-status');
        if (el) { el.innerHTML = msg; el.style.color = color || '#888'; }
    }

    // ── jsonbin.io ──
    async function jsonbinPush(data, cfg) {
        var headers = { 'Content-Type': 'application/json', 'X-Master-Key': cfg.key };
        if (cfg.bin) {
            var r = await fetch('https://api.jsonbin.io/v3/b/' + cfg.bin, { method: 'PUT', headers: headers, body: JSON.stringify(data) });
            if (!r.ok) throw new Error('jsonbin PUT: ' + r.status);
            return cfg.bin;
        } else {
            headers['X-Bin-Name'] = 'PILOTE_Data';
            headers['X-Bin-Private'] = 'true';
            var r = await fetch('https://api.jsonbin.io/v3/b', { method: 'POST', headers: headers, body: JSON.stringify(data) });
            if (!r.ok) throw new Error('jsonbin POST: ' + r.status);
            var j = await r.json();
            document.getElementById('s-cloud-bin').value = j.metadata.id;
            return j.metadata.id;
        }
    }
    async function jsonbinPull(cfg) {
        var r = await fetch('https://api.jsonbin.io/v3/b/' + cfg.bin + '/latest', { headers: { 'X-Master-Key': cfg.key } });
        if (!r.ok) throw new Error('jsonbin GET: ' + r.status);
        var j = await r.json();
        return j.record;
    }

    // ── GitHub Gist ──
    async function gistPush(data, cfg) {
        var content = JSON.stringify(data);
        var headers = { 'Content-Type': 'application/json', 'Authorization': 'token ' + cfg.gistToken };
        if (cfg.gistId) {
            var r = await fetch('https://api.github.com/gists/' + cfg.gistId, { method: 'PATCH', headers: headers,
                body: JSON.stringify({ files: { 'pilote_data.json': { content: content } } })
            });
            if (!r.ok) throw new Error('Gist PATCH: ' + r.status);
            return cfg.gistId;
        } else {
            var r = await fetch('https://api.github.com/gists', { method: 'POST', headers: headers,
                body: JSON.stringify({ description: 'PILOTE Suite Data', public: false, files: { 'pilote_data.json': { content: content } } })
            });
            if (!r.ok) throw new Error('Gist POST: ' + r.status);
            var j = await r.json();
            document.getElementById('s-gist-id').value = j.id;
            return j.id;
        }
    }
    async function gistPull(cfg) {
        var r = await fetch('https://api.github.com/gists/' + cfg.gistId, { headers: { 'Authorization': 'token ' + cfg.gistToken } });
        if (!r.ok) throw new Error('Gist GET: ' + r.status);
        var j = await r.json();
        return JSON.parse(j.files['pilote_data.json'].content);
    }

    // ── WebDAV ──
    async function webdavPush(data, cfg) {
        var url = cfg.wdUrl.replace(/\/$/, '') + '/pilote_data.json';
        var headers = { 'Content-Type': 'application/json', 'Authorization': 'Basic ' + btoa(cfg.wdUser + ':' + cfg.wdPass) };
        var r = await fetch(url, { method: 'PUT', headers: headers, body: JSON.stringify(data) });
        if (!r.ok && r.status !== 201 && r.status !== 204) throw new Error('WebDAV PUT: ' + r.status);
        return url;
    }
    async function webdavPull(cfg) {
        var url = cfg.wdUrl.replace(/\/$/, '') + '/pilote_data.json';
        var headers = { 'Authorization': 'Basic ' + btoa(cfg.wdUser + ':' + cfg.wdPass) };
        var r = await fetch(url, { method: 'GET', headers: headers });
        if (!r.ok) throw new Error('WebDAV GET: ' + r.status);
        return await r.json();
    }

    
    // ── Google Drive ──
    var _gdriveToken = null;
    function gdriveAuth() {
        var clientId = (document.getElementById('s-gdrive-clientid').value || '').trim();
        if (!clientId) return alert('Saisissez le Client ID OAuth2');
        var scope = 'https://www.googleapis.com/auth/drive.file';
        var redir = location.origin + location.pathname;
        var url = 'https://accounts.google.com/o/oauth2/v2/auth?client_id='+encodeURIComponent(clientId)+'&response_type=token&redirect_uri='+encodeURIComponent(redir)+'&scope='+encodeURIComponent(scope);
        var w = window.open(url, '_blank', 'width=500,height=600');
        // Listen for redirect
        var check = setInterval(function() {
            try {
                if (w.closed) { clearInterval(check); return; }
                if (w.location.hash) {
                    var hash = w.location.hash.substring(1);
                    var params = new URLSearchParams(hash);
                    var tk = params.get('access_token');
                    if (tk) {
                        _gdriveToken = tk;
                        w.close();
                        clearInterval(check);
                        document.getElementById('gdrive-auth-status').innerHTML = '<span style="color:#27ae60"><i class="fas fa-check-circle"></i> Connecté</span>';
                    }
                }
            } catch(e) {}
        }, 500);
    }

    async function gdrivePush(data, cfg) {
        if (!_gdriveToken) throw new Error('Connectez-vous à Google Drive d\'abord');
        var content = JSON.stringify(data);
        var headers = { 'Authorization': 'Bearer ' + _gdriveToken };
        if (cfg.gdriveFileId) {
            var r = await fetch('https://www.googleapis.com/upload/drive/v3/files/' + cfg.gdriveFileId + '?uploadType=media', {
                method: 'PATCH', headers: Object.assign(headers, {'Content-Type':'application/json'}), body: content
            });
            if (!r.ok) throw new Error('GDrive PATCH: ' + r.status);
            return cfg.gdriveFileId;
        } else {
            var meta = { name: 'pilote_data.json', mimeType: 'application/json' };
            var form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(meta)], {type:'application/json'}));
            form.append('file', new Blob([content], {type:'application/json'}));
            var r = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST', headers: headers, body: form
            });
            if (!r.ok) throw new Error('GDrive POST: ' + r.status);
            var j = await r.json();
            document.getElementById('s-gdrive-fileid').value = j.id;
            return j.id;
        }
    }

    async function gdrivePull(cfg) {
        if (!_gdriveToken) throw new Error('Connectez-vous à Google Drive d\'abord');
        var r = await fetch('https://www.googleapis.com/drive/v3/files/' + cfg.gdriveFileId + '?alt=media', {
            headers: { 'Authorization': 'Bearer ' + _gdriveToken }
        });
        if (!r.ok) throw new Error('GDrive GET: ' + r.status);
        return await r.json();
    }

    // ── Dispatcher ──
    async // ── Dossier Local (auto-sync via File System Access + fallback manuel) ──
    var _lfDirHandle = null;
    var _lfAutoSaveTimer = null;
    var _lfDirty = false;
    var _lfSaving = false;
    var _lfHasAPI = (typeof window.showDirectoryPicker === 'function');

    // ── Détection du mode et initialisation ──
    function lfInitMode() {
        var autoDiv = document.getElementById('lf-mode-auto');
        var manDiv = document.getElementById('lf-mode-manual');
        // Re-check API availability (may not be set at parse time)
        _lfHasAPI = !!(window.showDirectoryPicker);
        console.log('[PILOTE] lfInitMode: File System Access API =', _lfHasAPI, 'protocol =', location.protocol);
        if (_lfHasAPI) {
            if (autoDiv) autoDiv.style.display = 'block';
            if (manDiv) manDiv.style.display = 'none';
            lfRestoreHandle();
        } else {
            if (autoDiv) autoDiv.style.display = 'none';
            if (manDiv) manDiv.style.display = 'block';
        }
    }

    // ── File System Access API (auto mode) ──
    async function lfPickFolder() {
        try {
            _lfDirHandle = await window.showDirectoryPicker({ mode: 'readwrite' });
            await lfSaveHandleToIDB(_lfDirHandle);
            lfSetAutoStatus('<i class="fas fa-check-circle"></i> ' + _lfDirHandle.name, '#27ae60');
            document.getElementById('lf-auto-actions').style.display = 'block';
            // Check if file already exists in folder (restore if newer)
            await lfAutoLoadOnStartup();
            lfStartAutoSync();
            // Initial save
            await lfWriteToFolder();
        } catch(e) {
            if (e.name !== 'AbortError') lfSetAutoStatus('<i class="fas fa-times"></i> ' + e.message, '#e74c3c');
        }
    }

    async function lfSaveHandleToIDB(handle) {
        return new Promise(function(res, rej) {
            var req = indexedDB.open('pilote_lf', 1);
            req.onupgradeneeded = function(e) { e.target.result.createObjectStore('h'); };
            req.onsuccess = function(e) {
                var tx = e.target.result.transaction('h', 'readwrite');
                tx.objectStore('h').put(handle, 'dir');
                tx.oncomplete = res; tx.onerror = function() { rej(tx.error); };
            };
            req.onerror = function() { rej(req.error); };
        });
    }

    async function lfLoadHandleFromIDB() {
        return new Promise(function(res) {
            var req = indexedDB.open('pilote_lf', 1);
            req.onupgradeneeded = function(e) { e.target.result.createObjectStore('h'); };
            req.onsuccess = function(e) {
                var tx = e.target.result.transaction('h', 'readonly');
                var g = tx.objectStore('h').get('dir');
                g.onsuccess = function() { res(g.result || null); };
                g.onerror = function() { res(null); };
            };
            req.onerror = function() { res(null); };
        });
    }

    async function lfRestoreHandle() {
        try {
            var h = await lfLoadHandleFromIDB();
            if (!h) return;
            var perm = await h.queryPermission({ mode: 'readwrite' });
            if (perm === 'granted') {
                _lfDirHandle = h;
                lfSetAutoStatus('<i class="fas fa-spinner fa-spin"></i> Chargement des données...', '#3498db');
                document.getElementById('lf-auto-actions').style.display = 'block';
                lfShowSyncIndicator();
                // AUTO-LOAD: restore data from file on startup
                await lfAutoLoadOnStartup();
                lfSetAutoStatus('<i class="fas fa-link"></i> ' + h.name + ' (synchronisé)', '#27ae60');
                lfStartAutoSync();
            } else {
                lfSetAutoStatus('<i class="fas fa-lock"></i> ' + h.name + ' — cliquez pour réautoriser', '#e67e22');
                var btn = document.getElementById('lf-pick-btn');
                if (btn) btn.innerHTML = '<i class="fas fa-lock-open"></i> Réautoriser ' + h.name;
            }
        } catch(e) { console.warn('lfRestoreHandle:', e); }
    }

    async function lfAutoLoadOnStartup() {
        try {
            var data = await lfReadFromFolder();
            if (!data) { console.log('[PILOTE] No pilote_data.json found, starting fresh'); return; }
            var fileMeta = data._cloudMeta || {};
            var fileTime = fileMeta.lastPush || '2000-01-01';
            // Compare with local settings timestamp
            var localSettings = JSON.parse(localStorage.getItem('pilote_suite_settings') || '{}');
            var localTime = localSettings._lastSync || '2000-01-01';
            console.log('[PILOTE] File time:', fileTime, '| Local time:', localTime);
            if (fileTime > localTime) {
                console.log('[PILOTE] File is newer → restoring all data');
                distributeToModules(data);
                lfUpdateSyncIndicator('Données restaurées', '#27ae60');
            } else {
                console.log('[PILOTE] Local is current, no restore needed');
            }
        } catch(e) { console.warn('lfAutoLoadOnStartup:', e); }
    }

    async function lfEnsurePermission() {
        if (!_lfDirHandle) return false;
        var perm = await _lfDirHandle.queryPermission({ mode: 'readwrite' });
        if (perm === 'granted') return true;
        perm = await _lfDirHandle.requestPermission({ mode: 'readwrite' });
        return perm === 'granted';
    }

    async function lfWriteToFolder() {
        if (!_lfDirHandle || _lfSaving) return;
        _lfSaving = true;
        try {
            if (!await lfEnsurePermission()) throw new Error('Permission refusée');
            var allData = collectAllModulesData();
            var now = new Date().toISOString();
            allData._cloudMeta = { lastPush: now, provider: 'localfolder' };
            // Update local timestamp so we know we're in sync
            try {
                var ls = JSON.parse(localStorage.getItem('pilote_suite_settings') || '{}');
                ls._lastSync = now;
                localStorage.setItem('pilote_suite_settings', JSON.stringify(ls));
            } catch(e) {}
            var json = JSON.stringify(allData, null, 2);
            var fh = await _lfDirHandle.getFileHandle('pilote_data.json', { create: true });
            var w = await fh.createWritable();
            await w.write(json);
            await w.close();
            _lfDirty = false;
            lfUpdateSyncIndicator('Synchronisé ' + new Date().toLocaleTimeString('fr-FR', {hour:'2-digit',minute:'2-digit'}), '#27ae60');
        } catch(err) {
            console.error('lfWriteToFolder:', err);
            lfUpdateSyncIndicator('Erreur sync', '#e74c3c');
        }
        _lfSaving = false;
    }

    async function lfReadFromFolder() {
        if (!_lfDirHandle) return null;
        try {
            if (!await lfEnsurePermission()) return null;
            var fh = await _lfDirHandle.getFileHandle('pilote_data.json');
            var file = await fh.getFile();
            var text = await file.text();
            return JSON.parse(text);
        } catch(e) {
            if (e.name === 'NotFoundError') return null;
            console.error('lfReadFromFolder:', e);
            return null;
        }
    }

    function lfStartAutoSync() {
        if (_lfAutoSaveTimer) clearInterval(_lfAutoSaveTimer);
        // Take initial snapshot
        _lfLastSnapshot = lfComputeSnapshot();
        // Poll every 3 seconds for changes + save if dirty
        _lfAutoSaveTimer = setInterval(function() {
            lfPollForChanges();
            if (_lfDirty && _lfDirHandle && !_lfSaving) {
                lfWriteToFolder();
            }
        }, 3000);
        lfShowSyncIndicator();
    }

    function lfMarkDirty() {
        _lfDirty = true;
        lfUpdateSyncIndicator('Modifications non sauvegardées…', '#f39c12');
    }

    async function lfForceSave() {
        if (_lfDirHandle) {
            lfUpdateSyncIndicator('<i class="fas fa-spinner fa-spin"></i> Sauvegarde...', '#3498db');
            lfSetAutoStatus('<i class="fas fa-spinner fa-spin"></i> Sauvegarde en cours...', '#3498db');
            await lfWriteToFolder();
            lfSetAutoStatus('<i class="fas fa-check-circle"></i> Sauvegardé ' + new Date().toLocaleTimeString('fr-FR'), '#27ae60');
        } else {
            localFolderExport();
        }
    }

    async function lfForceLoad() {
        if (!_lfDirHandle) { document.getElementById('localfolder-import').click(); return; }
        lfSetAutoStatus('<i class="fas fa-spinner fa-spin"></i> Chargement...', '#3498db');
        var data = await lfReadFromFolder();
        if (data) {
            distributeToModules(data);
            var meta = data._cloudMeta || {};
            lfSetAutoStatus('<i class="fas fa-check-circle"></i> Restauré (' + (meta.lastPush ? new Date(meta.lastPush).toLocaleString('fr-FR') : '?') + ')', '#27ae60');
            alert('✅ Données importées ! Rechargez la page pour appliquer.');
        } else {
            lfSetAutoStatus('<i class="fas fa-exclamation-triangle"></i> Aucun fichier trouvé', '#e67e22');
        }
    }

    // ── UI helpers ──
    function lfSetAutoStatus(html, color) {
        var el = document.getElementById('lf-auto-status');
        if (el) el.innerHTML = '<span style="color:' + (color||'#888') + ';">' + html + '</span>';
    }

    function lfShowSyncIndicator() {
        var el = document.getElementById('lf-sync-indicator');
        if (el) el.style.display = 'block';
    }

    function lfUpdateSyncIndicator(text, color) {
        var dot = document.querySelector('#lf-sync-indicator i');
        var span = document.getElementById('lf-sync-text');
        if (dot) dot.style.color = color || '#888';
        if (span) span.textContent = text;
        lfShowSyncIndicator();
    }

    // ── Manual mode (fallback file://) ──
    function localFolderExport() {
        try {
            localFolderSetStatus('<i class="fas fa-spinner fa-spin"></i> Préparation...', '#f39c12');
            var allData = collectAllModulesData();
            allData._cloudMeta = { lastPush: new Date().toISOString(), provider: 'localfolder' };
            var json = JSON.stringify(allData, null, 2);
            var blob = new Blob([json], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url; a.download = 'pilote_data.json';
            document.body.appendChild(a); a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            localFolderSetStatus('✅ Fichier téléchargé', '#27ae60');
        } catch(err) { localFolderSetStatus('❌ ' + err.message, '#e74c3c'); }
    }

    function localFolderImport(input) {
        var file = input.files[0]; if (!file) return;
        localFolderSetStatus('<i class="fas fa-spinner fa-spin"></i> Lecture...', '#3498db');
        var reader = new FileReader();
        reader.onload = function(e) {
            try {
                var data = JSON.parse(e.target.result);
                if (!data || typeof data !== 'object') throw new Error('Format invalide');
                distributeToModules(data);
                var meta = data._cloudMeta || {};
                localFolderSetStatus('✅ Importé (' + (meta.lastPush ? new Date(meta.lastPush).toLocaleString('fr-FR') : '?') + ')', '#27ae60');
                alert('✅ Données importées ! Rechargez la page pour appliquer.');
            } catch(err) { localFolderSetStatus('❌ ' + err.message, '#e74c3c'); }
        };
        reader.readAsText(file);
        input.value = '';
    }

    function localFolderSetStatus(html, color) {
        var el = document.getElementById('localfolder-status');
        if (el) el.innerHTML = '<span style="color:' + (color||'#888') + ';">' + html + '</span>';
    }

    // ── Sync Engine: poll ALL modules data for changes ──
    var _lfLastSnapshot = '';

    function _lfHash(str) {
        // DJB2 hash — fast, reliable for change detection
        var hash = 5381;
        for (var i = 0; i < str.length; i++) {
            hash = ((hash << 5) + hash) + str.charCodeAt(i);
            hash = hash & hash; // Convert to 32-bit integer
        }
        return hash.toString(36);
    }

    function lfComputeSnapshot() {
        // Build a fingerprint of ALL data using content hashes
        var parts = [];
        // 1. Wrapper localStorage (pilote_suite_settings, pilote_master_settings, bibase_*)
        try {
            for (var i = 0; i < localStorage.length; i++) {
                var k = localStorage.key(i);
                var v = localStorage.getItem(k) || '';
                parts.push(k + '=' + v.length + ':' + _lfHash(v));
            }
        } catch(e) {}
        // 2. All iframe modules localStorage
        var frames = ['frame-perdir', 'frame-exam', 'frame-oral', 'frame-aed', 'frame-bibase'];
        frames.forEach(function(fid) {
            var fr = document.getElementById(fid);
            if (fr && fr.contentWindow) {
                try {
                    var ls = fr.contentWindow.localStorage;
                    for (var j = 0; j < ls.length; j++) {
                        var k2 = ls.key(j);
                        var v2 = ls.getItem(k2) || '';
                        parts.push(fid + ':' + k2 + '=' + v2.length + ':' + _lfHash(v2));
                    }
                } catch(e2) {}
            }
        });
        return parts.sort().join('|');
    }

    function lfPollForChanges() {
        if (!_lfDirHandle || _lfSaving) return;
        var snap = lfComputeSnapshot();
        if (snap !== _lfLastSnapshot) {
            _lfLastSnapshot = snap;
            _lfDirty = true;
            lfUpdateSyncIndicator('Modifications détectées…', '#f39c12');
        }
    }

    // ── Init on page load ──
    // Fallback if DOMContentLoaded already fired
    if (document.readyState !== 'loading') { setTimeout(function() { lfInitMode();
            updateHomeGrid();
            if(!window.__homeGridResize){ window.__homeGridResize=true; window.addEventListener('resize', updateHomeGrid); } }, 200); }
    window.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            lfInitMode();
            updateHomeGrid();
            if(!window.__homeGridResize){ window.__homeGridResize=true; window.addEventListener('resize', updateHomeGrid); }
        }, 500);
    });

    // ── Save before leaving ──
    window.addEventListener('beforeunload', function() {
        if (_lfDirHandle && _lfDirty) {
            // Synchronous attempt — may not complete but worth trying
            try { lfWriteToFolder(); } catch(e) {}
        }
    });

    // ── Save when tab becomes hidden (user switches tab/app) ──
    document.addEventListener('visibilitychange', function() {
        if (document.hidden && _lfDirHandle && _lfDirty) {
            lfWriteToFolder();
        }
    });

    async function cloudPush() {
        var cfg = getCloudConfig();
        if (cfg.provider === 'jsonbin' && !cfg.key) return alert('Saisissez votre clé API jsonbin.io');
        if (cfg.provider === 'gist' && !cfg.gistToken) return alert('Saisissez votre GitHub Personal Access Token');
        if (cfg.provider === 'webdav' && !cfg.wdUrl) return alert('Saisissez l\'URL de votre serveur WebDAV');
        if (cfg.provider === 'gdrive' && !_gdriveToken) return alert('Connectez-vous à Google Drive');
        if (cfg.provider === 'localfolder') { lfForceSave(); return; }

        cloudSetStatus('<i class="fas fa-spinner fa-spin"></i> Envoi en cours...', '#f39c12');
        try {
            var allData = collectAllModulesData();
            allData._cloudMeta = { lastPush: new Date().toISOString(), provider: cfg.provider };

            if (cfg.provider === 'jsonbin') await jsonbinPush(allData, cfg);
            else if (cfg.provider === 'gist') await gistPush(allData, cfg);
            else if (cfg.provider === 'webdav') await webdavPush(allData, cfg);
            else if (cfg.provider === 'gdrive') await gdrivePush(allData, cfg);
            

            cloudSetStatus('✅ Envoyé le ' + new Date().toLocaleString('fr-FR') + ' via ' + cfg.provider, '#27ae60');
        } catch (err) {
            cloudSetStatus('❌ ' + err.message, '#e74c3c');
        }
    }

    async function cloudPull() {
        var cfg = getCloudConfig();
        if (cfg.provider === 'jsonbin' && (!cfg.key || !cfg.bin)) return alert('Clé API et ID du Bin requis');
        if (cfg.provider === 'gist' && (!cfg.gistToken || !cfg.gistId)) return alert('Token et Gist ID requis');
        if (cfg.provider === 'webdav' && !cfg.wdUrl) return alert('URL WebDAV requise');
        if (cfg.provider === 'gdrive' && (!_gdriveToken || !cfg.gdriveFileId)) return alert('Connectez Google Drive et renseignez le File ID');
        if (cfg.provider === 'localfolder') { lfForceLoad(); return; }

        cloudSetStatus('<i class="fas fa-spinner fa-spin"></i> Récupération...', '#3498db');
        try {
            var record;
            if (cfg.provider === 'jsonbin') record = await jsonbinPull(cfg);
            else if (cfg.provider === 'gist') record = await gistPull(cfg);
            else if (cfg.provider === 'webdav') record = await webdavPull(cfg);
            else if (cfg.provider === 'gdrive') record = await gdrivePull(cfg);
            

            if (!record) throw new Error('Données vides');
            distributeToModules(record);

            var meta = record._cloudMeta || {};
            cloudSetStatus('✅ Récupéré (' + (meta.lastPush ? new Date(meta.lastPush).toLocaleString('fr-FR') : '?') + ')', '#27ae60');
            alert('✅ Données importées ! Rechargez la page pour appliquer.');
        } catch (err) {
            cloudSetStatus('❌ ' + err.message, '#e74c3c');
        }
    }

    function collectAllModulesData() {
        var allData = {};
        var frames = ['frame-perdir', 'frame-exam', 'frame-oral', 'frame-aed', 'frame-bibase'];
        frames.forEach(function(fid) {
            var fr = document.getElementById(fid);
            if (fr && fr.contentWindow) {
                try {
                    var keys = Object.keys(fr.contentWindow.localStorage);
                    keys.forEach(function(k) {
                        allData['__' + fid + '__' + k] = fr.contentWindow.localStorage.getItem(k);
                    });
                } catch(e) {}
            }
        });
        // Wrapper localStorage (settings, bibase_establishment, etc.)
        try {
            for (var wi = 0; wi < localStorage.length; wi++) {
                var wk = localStorage.key(wi);
                allData['__wrapper__' + wk] = localStorage.getItem(wk);
            }
        } catch(e) {}
        return allData;
    }

    function distributeToModules(record) {
        var frames = ['frame-perdir', 'frame-exam', 'frame-oral', 'frame-aed', 'frame-bibase'];
        frames.forEach(function(fid) {
            var fr = document.getElementById(fid);
            if (fr && fr.contentWindow) {
                try {
                    var prefix = '__' + fid + '__';
                    Object.keys(record).forEach(function(k) {
                        if (k.indexOf(prefix) === 0) {
                            try { fr.contentWindow.localStorage.setItem(k.substring(prefix.length), record[k]); } catch(e2) {}
                        }
                    });
                } catch(e) {}
            }
        });
        // Restore wrapper localStorage
        Object.keys(record).forEach(function(k) {
            if (k.indexOf('__wrapper__') === 0) {
                try { localStorage.setItem(k.substring(11), record[k]); } catch(e3) {}
            }
        });
    }

    // Auto-sync hook
    function cloudAutoSync() {
        var el = document.getElementById('s-cloud-auto');
        var ek = document.getElementById('s-cloud-enabled');
        if (el && el.checked && ek && ek.checked) { setTimeout(cloudPush, 500); }
    }

    
    

    
    function loadBibSettings() {
        var s = JSON.parse(localStorage.getItem('bibase_establishment') || '{}');
        var el;
        el = document.getElementById('bib-layout'); if (el && s.layout) el.value = s.layout;
        el = document.getElementById('bib-font'); if (el && s.font) el.value = s.font;
        el = document.getElementById('bib-signatory'); if (el && s.defaultSignatory) {
            var found = false;
            for (var i = 0; i < el.options.length; i++) { if (el.options[i].value === s.defaultSignatory) { found = true; break; } }
            if (!found) { var o = document.createElement('option'); o.value = s.defaultSignatory; o.text = s.defaultSignatory; el.appendChild(o); }
            el.value = s.defaultSignatory;
        }
        el = document.getElementById('bib-doc-title'); if (el && s.docTitle) el.value = s.docTitle;
        el = document.getElementById('bib-doc-footer'); if (el && s.docFooter) el.value = s.docFooter;
    }

    
    // === PDF HEADER PREVIEW ===
    function updatePdfHeaderPreview() {
        var layout   = (document.getElementById('s-pdf-layout')  || {}).value || 'classique';
        var color    = (document.getElementById('s-pdf-color-hex') || {}).value || '#1b2433';
        var subtitle = (document.getElementById('s-pdf-subtitle') || {}).value || 'Direction';
        var s = getSettings();
        var school = s.school || "Nom de l'\u00e9tablissement";
        var city   = s.city   || '';
        var logo   = s.logoSrc ? '<img src="'+s.logoSrc+'" style="max-height:48px;max-width:96px;object-fit:contain;display:block;">' : '';
        var sub    = subtitle || 'Direction';
        var inn    = document.getElementById('pdf-header-preview-inner');
        if (!inn) return;
        var html = '';
        if (layout === 'moderne') {
            html = '<div style="text-align:center;padding-bottom:8px;border-bottom:2px solid '+color+';">'+(s.logoSrc ? '<img src="'+s.logoSrc+'" style="max-height:40px;object-fit:contain;display:block;margin:0 auto 6px;">' : '')+'<div style="font-size:.95rem;font-weight:900;text-transform:uppercase;letter-spacing:2px;color:'+color+';">'+school+'</div><div style="font-size:.7rem;color:#666;margin-top:2px;">'+sub+(city ? ' — '+city : '')+'</div></div>';
        } else if (layout === 'bandeau') {
            html = '<div style="background:'+color+';color:white;padding:8px 14px;display:flex;justify-content:space-between;align-items:center;"><div><div style="font-size:.88rem;font-weight:900;text-transform:uppercase;letter-spacing:1px;">'+school+'</div><div style="font-size:.65rem;opacity:.85;margin-top:1px;">'+sub+(city ? ' — '+city : '')+'</div></div>'+(s.logoSrc ? '<img src="'+s.logoSrc+'" style="max-height:36px;max-width:70px;object-fit:contain;background:white;padding:2px;border-radius:3px;">' : '')+'</div>';
        } else {
            html = '<div style="display:flex;justify-content:space-between;align-items:flex-start;border-bottom:1.5px solid #000;padding-bottom:8px;"><div><div style="font-weight:bold;text-transform:uppercase;font-size:.9rem;">'+school+'</div><div style="font-size:.7rem;color:#555;margin-top:1px;">'+sub+(city ? ' — '+city : '')+'</div></div><div>'+(s.logoSrc ? '<img src="'+s.logoSrc+'" style="max-height:48px;max-width:96px;object-fit:contain;">' : '')+'</div></div>';
        }
        inn.innerHTML = html;
    }
    // Sync color input ↔ hex text
    document.addEventListener('change', function(e) {
        if (e.target && e.target.id === 's-pdf-color') {
            var hex = document.getElementById('s-pdf-color-hex');
            if (hex) hex.value = e.target.value;
            updatePdfHeaderPreview();
        }
        if (e.target && e.target.id === 's-pdf-layout') updatePdfHeaderPreview();
    });

    </script>




    <template id="tpl-dhg">
<!DOCTYPE html>
<html lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de la DHG</title>
    	    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAYAAAAUg66AAAAABHNCSVQICAgIfAhkiAAAAF96VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAAImeNKT81LLcpMVigoyk/LzEnlUgADYxMuE0sTS6NEAwMDCwMIMDQwMDYEkkZAtjlUKNEABZgamFmaGZsZmgMxiM8FAEi2FMk61EMyAAAgAElEQVR4nO3dd3wURf8H8M9suculF1IIvRN6EwsKioggPhYEwQI2RFREBVF/KvrIg2LFgkoTUFBAsBdUUESUoigdlN57SL+6ZX5/BCTEkMbdzezevF8vlCSb22+O3OdmZ6cAgiAIgiAIgiAIgiAIgiAIgiAIgiAIgiAIgiAIgiAIgiAIVkNYFxAKd9w55fGZM9LrqInUBAAtD9o9w4x+uq67dN2klAIejwZCAH/AhGGYoBTwenQQQhAImAgEzH+enbTUKMgyASGAYVAYBkVMjAq324+/tydjz2EJsszyJ7YmrYjgqitzENB0FBToiHbJiItTkZTklCh17ps9S/4ZCnH0vXb/voE3PjDjxgE4zrpmIbhsFUD9+s9qsWu3snnNmmio8fSMr2l5p/5W6keWTv4BALnE50oeFgBglvh2AkAHoAKSi0KWIFST5ibFz6eC4udYA2AAAIWaePKYAIGkUNw1cP8906aOmMqqViH4bBNA9913WZPlq0ZsW7+RQI2hFX+DYCmGCSTGGOh/zb7Lp0wZuYR1PUJwKKwLCJbFS+5auH2PCB+7kiUgJ0fBxs21foSN3jgjnS0uHl5+eVJLk0Y3JqoIHztTXBSr1qvofdXEjqxrEYLDFgGUm5vWcudWAkV0BNsaAWAWSujUMfZG1rUIwWGLAFLVgrasaxDCRAX27c/WWJchBIctAsjt9huiWyBCyEBRkZ91FUKQ2CKA/H7NJj+JUCEJcLsDrKsQgsQWL1t/QBcNoEhhAEmJTtZVCEFiiwAK+HWb/CRChXSKpOSmrKsQgsQWL1ufuASLGGoc8M7bthm+FvFs8bI1TSouwSLIqSkagvXZIoB0zWBdgiAI1WCLAKKAaAEJggXZIoAMw6z4IEEQuGOLABJ9QIJgTfYJIEEQLMcWAaTrpmgBCYIF2SKAIBpAgmBJtgggTbSABMGSbBFAUVHK6TWbBUGwDFsEEBGtH0GwJFsEUNs2dQEP6yoEQagqWwRQWloiRE+0IFiPLQLo+HGxQqcgWJEtAuj556PEDGlBsCBbBJAIH0GwJlsEkCAI1iQCSLAcTWyKYRsigARL0Q3gvLZi4JddiAASLIV6CTq03cG6DCFIRAAJ1iIDubl+sQm3TYgAEqxFp6hVK/0v1mUIwSECSLAMLQC0b69hwoQhc1nXIgSHCCDBEigFECBo27poDCEQQ99tQuzwFiG0IgD6yQ8UcvpfXsKZaymVnlJnlvE1WuJPWd9nnvyYlPF4ZczZO9tAUi0PQBQBTCClhomMennT3pt557iyjxasSAQQI5qPADIASqE6AM0NQCWAhuI/oCBxgBKE7lbNDVx+mYlamSqiogzs2uWBx+sBpYCmmdD14lCgFJBlAlkmoJSCgEBVCUCKv6YopDiryMnjpNPJpShSib8TEImAmhSKIkGSCCSJQFYIZEmCJAGyLEFVJbjd0ObOkX5UE8/8XdTygJGjJKxdu0tKTq6x79ixA1N/WfZ/K8/92RB4YosBFWriZ2MBjGFdR2VpfqD7RUXHdcP3Rc2aCT9/NNd5+Pnnj5Ddu+9B7do3ISOjIWrWbKhec81d37KuVRBCSQRQmGk60LpxIGfjugEprGsRBNZEJ3SYyTJwIlf7jHUdgsADEUBhZrgJLu2So7KuQxB4IAIo3HSKevVqOFiXIQg8EAEUZnICMHte9Aes6xAEHogACjOJAAeOUrGJkCBABBATqsMedx8F4VyJABIEgRkRQIIgMCOmYghCGOWcqOfseMHTgzu2i787Lz+3YW6uZsbFKkhMciA9LRr7D0Rh4bcm1LjT36N5gUu7FE9/KSoy0aA+BSHFU2kIAYqKNBw95oOiEJgmYJoUhkFBAJj0zJ2DVbX4mFOfoiieOgMKSBKc8fHJkxZ+M+DxcD0ftuiLsNJI6JP6aHnXL2RdhBBeI0e+P2T7juhpX32pAgotviOhoHjybgDFaaEAauy/v1fznTxOBuAFznjpygCcOD0BuNSXz1DW/p30zA/qZQbMG/tm3/Lyy/fPq/xPVz2iBSQIYTBg4MRpb82MHxLIBdTEkssKnBRV/verJb/uLPW9Qbb3sFP6/Ov0uSNHvr59woSH/gzZiSD6gAQh5EaMmD7kqx9qD9ENa+xhpzootu9UsGJVzNuhPpcIIEEIsc++jnnV4wdkK73aHBSF7hrtQn0aKz0lgmA5dw997fz8Ime8YrVXWgBIq2E4Fy16sU4oT2O1p0UQLMXlirmh4Bg5406UFUhRwPadWnbPno/tD+l5QvngghDp/vgzJgaxoeswDhUzQJDV1NgW6vOIABKEECoopP2sOtolLs4X8hU5RQAJQoi8N/OVGrLsSive0sM6KAXUKIqs5rmLQn0uEUCCECK//a71XL9Ohmqx5ef0AuDqywN47rnRv4f6XCKABCFEtm6rkwWXtVo/AIAYYOdO/cdwnEoEkCCEyPET8hXEoq+w1FQj5JdfgAggwUYmTnzz8ddff52b5W69PuV8S3Y/uwkuv+yv78JxKhFAgk2Ml3bvzk546KGHAqwrAYCxY2/J2rFbhRyEjSXDSfMDF1zoxxNPjN8QjvOJABJs4aab0z8uLGr2Ous6Ttm46ZrekCzY/+MlaNrYH/LO51NEAAmWN3r0k828XiN92tRbjrKu5RSXy3Me/Ba8AIsG9u4LfByu04kAEixv46YWv9SooT3Muo6SPB7H9bDY1gOUAonxJrKytC/DdU6xHpBgaddf/8J1+w74jO++vS9slw0VOXQQjoatXU4lwVqXYLpG0LCpNzB50r1bw3VO0QISLM3rr/9Zs6YSV6thDrnn44t9AetNQIVJUSNZCmuQiwASLOvWQW9MOHbcac758I53WddSkqEf7gXTaukDAARJSe7vw3lGEUCCJX27EI5NW+o+3LB+QchX7asqZ1RSV+isq6gGSpGWuntGOE8pAkiwpHdnzPja4yH479OJz7GupbTtOxwN4bBW/49WRHBldzcmThx3KJznFQEkWM7w4WPPW/574hWNGrh/adX6Wm5uvQPAs89OSjJMOdVy/T8qoAX8P4T7tCKABMvZsKnxB0f2yWjf7q9HWddS2voN9JZtO2QoFhsBDZMiLT1OBJAglOfa694YtGxpdNOLu3qyn39+3CrW9ZQWFxd7ldX6fygFEhIM1Ml8f0q4zy0CSLAMSiGv35T6NgjQvNkJrm69n7J+oxqDaGv1/+gGUK8WzX75lW/ywn1uEUCCZZx/4fTxe/ZHxzXLCtB3pw2fzLqeshgG7Wq5JVhNgsQE9zIWpxYBJFjCU0+9kL5zX8JoGEDb1vnc3XoHgOEPPNl14+ZoqIq1WkDwUHS5yBXW8T+niAASLOGrhbVnnMhTkJhiolnTQ+NY11OWgoImvUCsFT6GAdRvYoBgXVgWICtNBJDAvUcfndln937nVTCBjm1yf/jf/57h6tb7KVu3ObNgsfWfTQNITdHdzz8/fg+L84sAErj33WLn1AKPCviA/jcUcNn6AQCXS7sWusX6fyRAIkbYZr+XcXpB4NeQu2eM3rzLlQkd6H550d5hwx7+mXVNZXn7LaRt3hpDZKe1LsFAgYx0jcnlFyACSODcsuXRLxkGAD9w8cUBblY8LG3tupmXHc+WIFntFeUmuOfu6Uw6oAERQALHzjt/7tRtu6OgyEBsDS0w9tk7uQ2g/QccLWCx0c9aEdC7T0C/qs8vh1nVIAJI4NJjj8bWys5R7pZUCr0AuOFqYy7rmsqjKL5B0KzW/0PgisoJ+fbL5ZbA8uSCcDZ/rn136e49xbeUUjMpunX9+1nGJZVr9974dFit/4cAiqJ+xrIEEUACd7pc8m63n1c7GisxFKYH6NI5sPHOO/+7m3VdZzNhwqxmf++VoxULLXBsmEC92ga6XuL/nGUdIoAEDsUt0XwEoEB8MuB07uzPuqLyzHyfXgIQS03AoBRwRfn/Hj78vlyWdYgAErgy8KaZ45f/4pTUKED3Ahe09xZ9NO/JsC2SXh1163h6mwErxQ9AvUC7NsYW1nWIABK48ddmONdtiHscsSf7UiQCQtx3s62qYsezk1tAtlj/DwjS07zMbr+fIgJI4MaQexd88vcOGaoCaDrQurkP33179wLWdVXk8FHSXLLQLXhKgcQaJmrV+ov5nUURQAIXhg17pv3mrUofJerkJyhBfKznJUJgMC2sAvcPn9pr/yEHZAu9knQ/QYeW3kOPPvpaIetaLPS0CXaWndNqVt5xgBDApEByvIk7b3/pTdZ1VWT7dv08y23vKQGK4v+OdRmACCAmtDzC9bt6uA25e8qNW/5WW8FV/LFhEDSqm7/4riF/H2RbWcVUNb03dKv1/wCJiYXzWdcAiAAKO60QuH+41pF1HTw5dDj+oy0bKNRTS1l4gR7dD3M7672k/Qf87ay0BIdhApmpGuZ/9CDzDmhABFD4GQSyVNSCdRm86Hrp++MWfu2Cmlj8saYRdOpUdHD8+CeYLBFaFRMnTmri9Ue5rLQFj+kjaNPSv5N1HaeIAAo3B3D4SJ64BAOwYMGYBl6f60m4SlzC+IG2rTxj2VVVeStWmlnbd0nW2oKHUMRES8yW3yhNBFCYSVEUq9fUt9jGLaExfUaz2atXOaA6iz/WDaB5My+mTx86lW1llXM8u0Yvy43/oQQ1M46LAIpUpkZQr07RpazrYG3UqOlX/LbW2UVOOP0CphrQpJFjIsOyqiQj3X8ZPNa5/jJNoHamgYkTH2Q6/6skEUBhpjgoVm+Ibfj4/00fxLoWlhb/6JiVW6BCOvn6NSkQG6fjyp4//pdpYZVEKaRdu53NEWWdFpChEzSo517HU5+V1UYwWB4hgDcAzPwgeVZSxudv1Uo/YdapBZKU5ERCglNZ9bvy+dpNKFSjyp7bqOUB/xtHsWH9HvgDBnJyfJAkAkUpPlxVZRBS/H8AUBQCQggkiUBVZVBKocgSJJmAUsDpUACCk3+XiwukFA6nAkoBiRCoDhmUAooiQ5YlgFIoqgxZkkAkqMtXyF98+w0pAIgTUH8B+njKew7uHjp51LSZcRlqzOkXr1EA9Blg7h4+/J2coD3ZIfT00+PrrFir4p+Bk1ZAAFlyL2RdRkkigBhQZCA7HyCExm/amYJNm4Hi7XwpEItb1HJ+qdVEYMxTBHA0LG6/nvoXpKX+b5bx+dLHlDyu9N/PUMG7fCzuRAzQPsuHtX9cV+77K6WQGzaNf4WU+BkpAERTREfnDyj/RPzYtr1+L5jWmgEPULRvn7Ji6U+s6zhNBBAjp9YOVhUKxFbte4tvWfPV9NeKCBo3pDet/aP84/r1/+jD3bucUONO1697gCsu0wIzZwxdHeIygyYvr6AvqAu8/TucjWECaUkaXptw4zesaylJ9AEJ50zzEXS9uHD3gvk3zSvvuOH3I2XpCmmAHFvqRRsgiHb5HwhljcFmmgmdYFojfADALAD69CS/sa6jNBFAwjmhFIiN1XBeR3e/io7ds2/e6hPHTnc8A8Ujw/v8R8PUyYM/CGWdwbZ2E0mWXayrqIIogtzcAi5GP5ckAkg4J7qHoHM774JXXx22przjHnvs9Yu+XuhsoJZu/agEPp9vanoGyu245snNN794aU6R84wg5Z4PqFd3qwggwT40HWiZ5cc9d8v3V3Tsb7/XXFK6x9E0gYxUH55+YtCIUNUYCh5f+g1mgHUVlad5ga6XBvDGGy+tYF1LaSKAhOozCOrU8j46YMAtx8s7rON5M4YsXe50qqUuWYwAQVZTfXW3y+APZZnBlp0d1QKSdfp/QAni47zLWZdRFhFAQrUYJlCnZuDYd9/e/nJ5x33zFaJy8+OnSaW2rCnuO9IRF7vlrpAWGgJHjuqdJNlC118S4HIVMd3/62xEAAlVRgGYJkG7VkcqHM095d2Zc3btUiCXmrCpBwjaZgXyvvzi+Y0hKjMknnrq0TomjYq3yu13AIBC0bChi7v+H0AEkFANehHQr7dvxVdfjih3UuN99z3Z8uufEq9XSnc8AyAKhdebPTRkRYZIdnaTK8sKVF6ZJlAnLZD/4gt3VjBCiw0RQEKVUArAQRHt+qXC1s+y5W1nmyb+NVpY04BWjQL4c/UIbiZFVtavK+NbEJd1Wj+GAdStZfzMuo6zEQEkVImeT3DP4MKfZ816e1d5x/X5z5Tr/9qjti9zt1ANaNwI/yMEWojKDJmsZvRK6mZdRRW4CTq0K/ybdRlnIwJIqDTdAOo30TBl8m2XVnRsYWHSp4bv360f0wQSk0w8N7bAEmv+lEQpyPFstLDKBCbTBNJqU7Ru7ZnOupazEQEkVBotJLj+P0VvVHRcz17v/3fZMgdK33YHAMND0PUCz5oWLe8+EIoaQ2nixNc6LV0SBTWadSWVY2gEDet6MXTow9tY13I2IoCEStH8BF0u9uS9NuGOh8o7bsKESbULCmKfgfPf/SQUAHFR1KunPh6qOkPpuZfrtlASrNP/Az9F08b4hHUZ5REBJFSIAoBB0a3rntsqOvaLr2Kmrlol/7PMakm6j6BrJ3fOxDcHLg5+laFXN7PwBt2w0PgfAHXq6Nwsv1oWEUBChfQCgu6XuNc///wTX5Z33JAhsy/++df43mr8WVoJAaBmTfXFUNQYDunp0n/gZV1FFRCC5OT1XA5APEUEkFAuLQC070Bx7z3rb6zo2I2bseBse2RpGtCuvQ/z5gx4Kdg1hoPPd3/M10viUNaYJh5pfuDiLj7/qFGv7mddS3lEAAnl8xPUTC96t/+NL5fbkfn4/80Y/dvKuAzVcZYXqJugcUO/ZXcDee759m3irLT8hgy43WQW6zIqIgJIOCstALRr58PjjxoPV3Tsl1/HvIhyWgdSPMWylbEKpRZbxfSk776P7VvoLV4y2xLcBJd0ObCVdRkVEQEklIkCkBSgQb3APV273V5U3rH33vv+gi0bnUStYHyMy0nw6oTJrYJYZtikJPt7QbNG+hgmULehgYDm5H6RNxFAQplMA6ifoe3+7NPB5Q4YvOYaJM35JKafXMHtaVkC9h4mWPBxfO+gFhom23dF1ydnu7zkjOkDsppoRZMnDT/KupaKiAAS/qV4Aw2Cy7oeuaWiY9PSP1iVf0yp3OqAJkFKsmG5AHr44UGZlNJYa7R/ADiAnFxtNusyKkMEkPAvuo+g+wU5P05/d8TK8o574okXr3t3WmxTNbFyLQOiUmzbqTYJSpFhdORoh+679josMwMeABo24Hv8zykigIQzmBRISTZx4fnrKpztvmJVvdlV2RmUmkCMC7Umvon4cyoyzPLza/S2ygqIFMX7zt088I4lrGupDBFAwhmMQoJelxW+M27cm4fLO+7CLpMHL10ZFVveJoqlqSqwfmMUNm95/sJzrTOclv0e01xxsK6icnQ/wYXt3NnXXocC1rVUhggg4R+aDrRpq+HDD28rd5H5775FlN+f+D5INVoFCsWhww0s1Q/Uuqm7gx6wSA+QTpFZU+F69HNJIoCE0/wE8XE5fSo67Mmnp49fszEKanVaBRQwDNUyt+LHjLmn9cpVcVDLmFzLJZMgM3OzCCDBWjQPwRWXeY/9uuyeheUd9/DI8Y3j42s8VLw0YjVQAq/PfXn1vjn8Nm3u1qusmf08MgygQcMAXpvwv7msa6ksEUACKAVccQZqpCy8uKJjly7LeO+nn2i118RRoymW/JCAr7+6rWb1HiG8jhyVe7KuobJMA8jMkPaxrqMqRAAJ0IsIenXTls+dO3t7ecf1ump6r7Wbk7qcdbZ7JSkJFPeO6G2Jy7CaGb4e8Fij/4fIBD5f4QzWdVSFCKAIZ5hAek0/Pvt0YIWtH48n+sNgbEdjmkBSAr35nB8oxHJz4PxmSTyssggZ9VNc3YdyP/+rJBFAEc4sIBjQ1zehouNu6Ddr3LKfXcllLTRW5XMGCNLTfL3O/ZFC66GRM7tphjUmoJomkJ6uo3/fO7leAbE0EUARTNMJmrcsdL/55m2jKjp2zXrnk1JccFoCkpNi89b49KA8WAjt2Kn2NA3WVVSO4QUu6GhuadXGWjuNiACKUJQC8dEmLuvqGVLRsVf1mbVo9x4n5CD+tqgKyOOPP9cseI8YfGlpxiD4LND8AQBCIMs+Lnc/LY8IoAilBwiyGhVumjTpnnnlHTdmzLSLFi+PuUKJDl4/iCwBe/fIOJFTm9sBiZRC2bEzLqkqU01YoRRQoikuunDnF6xrqSoRQIxQAJqnuBNY8xFoAQLNT6B5CLRCAi2fQMs79Qen/xSe+7lNCtRI8uE/fbSbKjp26bLoDzWfHPx+EBXYt49w2w/Ur98zicdPGKpsgT3ATAqkJ/rxyCNjud0B9Wws8PTaj2kCRgFFz14+z87dMdPatfrbkZevw+VS4IpSERvrgMOhwBmlwOFQ4XQqUFUFBJDz8uVNr02Q16qJqPbcbCMfGDhYVZ96asim8o4b8/QHg/43NqZ+ZWe7V4lEkV8Q3TT4DxwcySkNBh05rEK1wBrQpgY0bSSvP7iHdSVVJwIozEwKSBLBsOEFc95+67ZbAGBnNW6cannnVsdbEys+5vMvHe+Vt8zqOSEEXl+gwexZiBo0GL7QnKT6fv/DaZ094GXAXZRnuZ1mAXEJFnaGB+jfp+jDU+HDq9Gj57+0cZ0qVbTManWpKsX69dFYu27cBaE5w7lxqI4rqMm6iopRCsBP0L9fEbf7v5dHBFCYqTHAnA9j32NdR3nGj78lYc06ZfTZttgJGpViz97GXHZEuz3+elYYAKQXAVf11PDIIw//xLqW6hABxICaSLleXeavv3v8/ONiCWpMaM+jOIEfflHahPYsVffaa//XY8vGaKiKBS7BXMCBQ/QnQoIwRJ0BEUDCGQYNfrHVrE+S2oZj+oHuI+jQsoC7O2E//NiiOWIs8nrWCFo0z7fkVteACCChFI8ncyXc4Zl+oLooli5LxtKljWqE/myV5/Y4eluhPWFSID3NgCQdnc+6luoSAST8o2evqbd+sjAuNpyTL5VYiruGjuNqZrzX670KFtg/kVIgJkoPzPnwqZ2sa6kuEUACAIDSscqJnLjZxRvyhI9hAvFxZGAYT1mu+fOvqrXvYDwkC/T/mDpQuxaWsq7jXIgAEgAA/W+sPePP313VW2b1HFA/QUa6j5s7YR/Nv6bRsXwEdd5byGgEWc3yLTf/qyQrPM1CiM2ataDOpi0xg0I26LAcxEmxc08cN6sjHjrs6m0YFnlZaEDnzktFAAnW9tY7hR/9vd2JUA06LA8hQCBA1dGjn2wY/rP/W0yMegs0/i+/NC/Q7TIv7rprzmbWtZwLEUARbtSoST02bEu8UGE07UCWgD37FezYmXElkwJKoBTk4CFHasgHYAYBcQC5edJHrOs4VyKAItyiH2Jn+wIS20G/BPB4E5gHUM+eQ2Nz8s0oK2zBTAMEbVoe+4F1HedKBFAEu+LKD+/buDUug/mIX0KRXxB3CdsigMzMjoOPHnNA4vwOvGkCdTIDkMjcD1jXcq5EAEWwXXvUtyWVg/4OicDjcSdnH2X7+7h6TVyWZIU9wAgQ0JVDs2av4G4VgaoSARShBgyc/c3O7Q7wcLmhqhQbNsbi5QljmM6MV1X1StMCM+ANHWhUT7Pk5NPSRABFoIceGpzx1eKYq5QgLTIfFArFnr2tmI4Hiok2GkNnWUHFKAUUBbigc+53rGsJBhFAEWjLXz2XeQoZdzyXIjuB73+Smc2Mf//9sZes+DUKahSrCirHMIG66SYu7vKTaAEJ1nNlr9cv+nFlTJNgLjIfDIaHoHP7wmtYnf+LLxtlgbPnpCxUI6iV4dP63vDRQda1BIMIoAhz+Git5YbB31RLJZrih+VJ+ObrcS1ZnJ9I0b14v/wCAKJSFBbJU1jXESwigCLILbdOGbdhkwqVw4F2hACSTNHn2gbxLM6/5S/vNXDwFsv/RnWCFlk7FrKuI1hEAEWImTP6xi7/LfVJieN9rnQ3MPjW8M+MnzXrwZaUOuVg7HsfSqZZvJ3SG6/XWcG6lmARARQhpk6/8f09+wkXt93PSiXYsVMP+wqJ3y9qGbP/KIHC83MDwPADbVtKeampt+WzriVYRABFAEpBDMPXl6vbXmWRKAoKY5tmZ98e4tWoz7R9h9LH7ePrrmCZHEB+gTmDdRnBJAIoAhACuudAwjrZwfclhkQAj9fACy8kJobzvNEux01W6ICGl+CyrgcXsS4jmEQARYhWzd2LDI3vt3hZBnbtVbFvX8OwTUwtKoTqD6hNeO//0XSgRVYAHTuMWsa6lmASARQhLrog57tol1G8kR3PCFDkSQxbP9CixQvquj0q/68EgyA5KXBg4E3wsi4lmHh/2oUg6Xv9iN9qpVEYvM91IhS5ebHdwnW6OXMPXbphoxT2pWirTKbw+6VprMsINhFAEaJDR3jq1vLvppxfhoESEHjTwnW6QCClJ2S+m4WUArFRJhrW3/I561qCTQRQBMkvJFPAeu2fCqhRFCt+jcGECS9cH47z6braG0Y4zlR9uh9o05xi3rwdW1nXEmwigCJIn15bVzhU8N8P5KT4489GWeE41d/bpTjiCseZzoEJxMVquwiZ52ddSrCJAIogzz777C8NM93QDb4vw2Qn8MtKdAj1eZ568rGeu3aq3A9AJE4gN59OZV1HKIgAijB167j+5n3XB8MgSK/huyHU5zlyrFVnSHw/FwBAPQTX9vnTsvu/l0cEUMRxT+N8yAtkmWLX/ljMnz+yaSjPc/SoqwXvrwAtQNCxgwdPPvXqGta1hALnT78QbH2vy/6+aePigW28IgTQDYolSxrHhfI8hiFdx3sHNAigqvoq1mWEii0CSPOwrsA6hg0buTkx3m+C4/FAhAAFRRK2bZdDNjP+9dd6Ntq2Q3dx3wFNgfg4LGBdRqjYIoAu70a4fkfnTUK8vhom3x3RAKDp0SGbkrFn7+AWO3Y6uO6ANimQEBfAlT1zLb39cnlsEUAG781oznh9mMr9v7xEkVoNnbwAABRySURBVJsX3ZpSOEPx8D//4m0tcd76MYqAS85XA6NGPWjp7ZfLw/uvYaUsXUKZ7GtuVZd0+W1pvUyd7+CmgCRRTJv2Wo1QPHx0dNRNJs8/PwDIAKVuW3Y+n2KLAHrxRQlaHusqrGP8+Im7MlIDmsnxeCBVBTasVbBxozog2I9NKYhpKq24H5HpAPLyYLv5XyXZIoCOHLXVBOGwSEpyrITB+QvQSbFnX2K7YD/sG29Mrb1mixMKxxNQKQXioyluuP4zW2y/cza2CKDkZNYVWI+iFE3j+U4YAEACcnNdlwf7YZf8lHup38/3Coi6RtC0vhsjR36ym3UtoWSLADp0SLbJTxI+D9z3/uL2bQm0AOtKyiEBbreeGeyH1Y2aPbkPX0qRkix/wrqMULPFyzY2tgjc/0Jx5spePx1NreEOgOPlOVQVWPunEy+88OhVwXxcQ3f0hsn55ScIAPcXrKsINVsEUGoq5/dTuWV8B47HwQAAoig2bOzUIpgP+f0SZ4oaHcxHDC7DBOrW9OPJ/9Ntsf97eWwRQDknCsHfXp/8o6bxLu9Pm+QAlq1Ax2A93ogH7rzUEcP3CtCmDmTWlPK6drv3OOtaQs0WAVSzZgr4/pXi04397ljUpL6P61Hkpg9o0czsH6zHO5F70XkBL+E7d00gJcn3C+sywsEWAbRv31GIFlDV3T0U/jYtlWPgeC6dFAWs2eCQZ878T/1gPN6SZUktZCfnb1YSgaYZtlz/pzRbBJCuix7o6tI08xdwPIqcACCE4ETOjY2D8XiyTK/nubFsGEDD2hquv/b2X1nXEg62CCAKKhpA1aSqnmlQWVdxdpIEHM8mWLLE3fNcH+ubr0fXqpmGBIPnS06DIK2G98S99yEixvbbIoBMQwRQdT02+vaVddI5365HBorc0Zed68P8trpFr9W/KXxvwWNQpKXGLGVdRrjYIoACmi4CqJo6n4+CurXcB0yd4yeQUOTlR7en9NwGDaz6jSQihuPrLwBQAEqP2Hr+V0m2CCC/X7PJT8JGYoLxPc/9IrIMHD8Beeg9ryWdy+MUFpKbQPkNWk0HWjYK4MsvZtp6/ldJtnjZ6ropWkDnwOn0vctzAEkScPiQAlUxbjqXx/EHnB1BOP5BdSC1hnmAkD94niATVLYIINMUfUDn4tNPhq1q3cwNjefLMIXiwKGMNtX99smTJ3dcszoKKscd7gBBbIzftqsflsUWAZSf5wX3Uwo4l5Do3MH78hyFBa5q3wlb/ENOI8QEs5rQcDh8EdP/A9gkgHheVqE0TQe0PMJdXLZppS2Gj3UVZyc5gO27aN3qfn9BQUZPni8zNR1o3dyLTz8Z9hvrWsLJFgHkdlujE1rTgRYNTLw1cTF3v2Q1M7zTIPGb5LIEHDigYOzY26q1PpBhRnE+A55Akf0bWFcRbhZ42VYsKkqxxlSwAEFcrOep4Q+8fYx1KaU99dSd69q0CVCe54VBpdi4qXeVZ8ZT+t/oFWtcmUpIlrcPEo2iYYO4FazLCDdbBJBmgbtgmh84v5OO31YOeo51LWUhBDQu1reW6+16TEA30Kmq3/b221GtY6Mot+9RFIAjmkJV90fE/K+SbBFAlPPFxSkFXNFA00Y7zuk2cqjVzDC+B9ctIGDrNrlfVb9ty5akG7IPSdxeYeoBoF0zjc6d89A61rWEm00CiHUF5dM1oHkDbevs2Y/PY11LeVKS/XNq1DC57SqRJKDII0XPndO9VlW+b8++lBbgeQa8SRATo60lhNtGWsjYIoAkjn8K0wQyUw107jivO+taKjJlyrBNtTM8MDgdDyQR4ES+hF+W39WoKt+3biPOk3nu/yFAQoJ/EesyWOD4pVsVfL5gAMDwEzRrbHw1Zcqnh1jXUhmJic5VvDaBCAHcboK9e/MqPR7okVE3pbqizDSuW8kGkJpy4l3WZbBgkwDik2EA9esG8NOPA65hXUtl1antXQTOdwz1eOMvreyxsnpxr53bHJC5G3lVTPMQXHaxG9OmPbqTdS0s2CKAJIlweRveDACXXFj0Eus6qqJhg/1TeZ6wCYkiLy/qvMoevn9/UhLX/T8SoKjaStZlsGKLAOLxLpimE2Q18efOnnXnY6xrqYpnn33y4IWdvQHNz2cIKSqwcafiaNXui7jKHL9rd2AAZD5/FgCASZGSEruYdRms2CKAJM7mYhRvq2ugaRP39axrqQ5J8i3htVuNANB9BJ07rL25MscbhvMiXm+TUgq44iiaNdkcceN/TrFFAPFG9xPUq+n99YvP7vqZdS3VkZkRWMh3PxDFiZxGbSs6asb0V1ut/s3F7QqIuh/o1Mpf+OyzzxxkXQsrtgggnhpAmg5kNdYwbOihh1jXUl316vk/qlfb4HaZVsUJLF0ZnVXRcbM+iG2BOD5bP8UIoqO15ayrYMkWAcTV5YJBkJyUP+3++x/9k3Up1fXKKyOOZWZ483hdptWkQGKseWlFx9Wurd4ID58/AwCAAkmJvogc/3OKPQKIkzc5TQdqZ/i07xc6Ldv6OSU6Wl3G63ggWQL27lUxbtzVl5R3XHZ2dHvIfP4MlAKJiSZSknM/YF0LS7YIIMLBbXiTAokxBOd3PP5IbNwgjrf6q5xmTQsXcdWyLM1BsfqPgeXOjP/+V2dDhdM94HU/Qevmbv/bbz9m++2Xy2OLAKIUzC/DjEKCizt7jn7y8QNvsq0kOEYMf+uDlETw2ggCdMDpVM86HujGG8d2TIimzN+YzsoEkpONiFp+tSy2CCBCwPQXzTCBjFoUCfEHuJ7tXhXNs9blZzVxZxsBTptBBDiRY/Y925drpNbom3dc4uoGxZkokhJjInb8zym2CCCJ8ToLZiFB5w7H//jww0dttZ2KJPm/5fU3RHICf21Tk96aiNSyvn7oUFoMHHw2fygFpCiKmTP6T2FdC2uc/npVjcnwOkHTgSbNTfToPqtaS4XyrGaG+wtexwPJEnDooIw9++Z0K+vrO3Z6+0Phs/mjFwLX99SOEQKNdS2s2SKAmLaAigh6XJY9b8SDvxawKyI0Ppo34pP6tTUYnIYQFIK9e/P+NR5o3LhrEzXDmUl43QNMITBNz3esy+CBPQKIECY/hxYA2nfSMOmdobbp+ymteZPAHpPTeWGQgCNHoi8t/emCgu5XbN3igMLpDHgASEnxRHz/D2CTAIqNjc8L95YylBb/p3am77bwnjm8KMiPvI6lAaEodEdfWPrTupGWxevtL8ME6tQ20O2S++eyroUHtgigefNGvdKpUwBaGENIzwdu7mvu++rLQbPCd9bwa5lVwO36QIoKrNuiuN55Z17jkp/fsDHQE04+W22mTlA3071r0GBen9XwskUAAUD/G8y+MbEUehj+WU0K1KhlIiHBb8nZ7lXx6qvDPm3RzACP2/UQADAkbNmyrUvJz5umqwu3A5i8FE2bypacpBwKtgmgxx4b+Nk9gwvHxrk0aDqBVkSgeQm0AIGWR6oUTIZZvJbzWb/uJ2iT5V886Z1b1px75XwjBHpKsncLDD5bFNCBIne9q099uH4dopb85IDK4Qho0wTSawMx0WbELr9Rmm0CCAAmTLjtmfyjhdFtGhe81qeXp/CSC46jXfMjuKFfAepnoFIhZJhARhKQEl92CBkmkJGqYckPN1d7n3KriY3x83vHxkGxZ2/MP1MyHh41qTeJ5rP1Uzxgn2LixEG/s66FFwrrAoKNkLu8AEZuWIeRpz63rkQ7pTIDLw7mfxnVv//BJR9/XvNCKfb0LzOlgCIBPS4tev2D2UEsmnOJiXkLolwpI3nc/7F4z3jznwBq1EgauGQJARL4CyHTQ3B+d89mQsDpQifhZ6sWULDcNvgaZcny1AvlmDN/iXUDaFgrcOKD2Xc8zKg0JubOeWRVZg2dy/FAkgQczFYxbty4TgCwcVNCIjhtAUECoqLc/LYmGRABVIYTuZOezclVzthJkwKADvS8vPBRVnWx1Kalfy318db+OdkiCxBs3ZZ2FQDk5pGebEaFVYIJ1K3jjuj1f0rj7zeKAy3bzNM373LKaokLVE0n6JiVv/rP1bd1ZlcZO9ddP+uFz7+Ne0yNYl3JvxkGUDddQ2qKdPCvXXItX4CvVTKB4tZzs3oG/t7Uj7PK2OL1vYKZ+4fP/b/NG6LOCB8AQAC46IIiWw86LI9D3TaVu1f1SbIM7DuqYvUmPsMHAKhJEBdT9AvrOngjAqiUTZvN+1HqXV7LJ7i0y7H3J068/y82VbE3f/64XW2bewMap8u0yjKgqnyGDwDATXFxl6iI3f/rbEQAlTDqkXmdf/45ppYadboTU/MC3S+n5lNPHrufYWlcSErSVoj7N1VHKZCYYWL//q0Rv/xGaSKASti0yf9flN7CRSdQlX2P9ejxlJtJURyJdhV9z+kUK64ZJpCWDM/HC57ZxboW3ogAOmnme5+mrdsc31t2lGz9EHTr6i36/rsHX2FYGjfi44s+TE02uJ3lwCsaABo38IrBh2UQAXTSzPdyHjyaTSCdfEYoBRISTSQlHOjDtjJ+zJv76P7WWZrXCPPKA9ZH4HSK8T9lEQF0UmbNhCfgPf3WrhcRdD3fu/nzz0cvY1gWd2Jj/L+A8trTyx/TBNJSTbRv5xHjf8ogAghAl0sm9ps3V4WaWPyxYQK165qoV/fBLuV/Z+SJizMWQRLXYJVlaARNGnj9Tz/98FrWtfBIBBCAenUTppf82Cwg6HHpkc/eeis7n1VNvKpT+87pYLwJgKXIgGkEPmNdBq8iPoD69n2w0Zz5cfFKYvG7umYAjZtreG/mfWfd8iWSvfAC8i5oV1Sg8bpdD28CFE2axFp2m+5Qi/gAMsxOcwFyek5KIdD3muyxLGviXc0MY7nYz6FilAKS00SP7v0ns66FVxEdQBNehXPVH87zZNfJ1o+XoEdPz/6XXrr3Gcalca1OHe1bsaBoxfRC4Nqe5vHBt6GIdS28iugAWrHqvXeOHnVAkk7OdpdNXHTB9oGs6+JdYvyQKXXqaTDEqOjySYDT4bfVZpXBFtEBtHGzOoCcnPelewmu7Ja3dOzY/65gWxX/xv4PgaaNAwe53a6HFwZBw4Y54vZ7OSI2gO68a8b9W7fFxCgyBaUAUTXcPGDd7azrsooaKcZPYl7Y2ZkUqFHTwLatm8X2O+WI2ADauIk8BGfx3/V8gpHDit6+7fY397KtyjrS0rzinb0cRoCgZVPvgY8/nuJhXQvPIjKAnhozpcvqtUmNVZUWLzJfx5f76it3DGddl5V0aH/PgqQUs3iDRuHfJMCk2sesy+BdRAbQ4h/jHoda/MoxCwieGK09zrgky7njDvg6tPbt1MW8sH+hAKKcFLUyA1+yroV3ERdA06dPTNt/KOpqSS7e271Fa/+GESMGiX2aqqFB/cLvwOkCZSxRCrgcJubOuUdsQFiBiAug+QuSRx86QkAp0KAWcM3V+bezrsmqAoGiz+23sdO5MzwEXc7z7hDb71Qs4gLo4GF1JBSAagRNG534+IXxQ8UkwWqa9f6oH5o11sKyHba1UCQkGGL5jUqIqAAaM+bjnps2qpIsA6kpFPcN2xmxi8wHi8vpX8y6Bu5oBC1b7BB3CSshogLojzW+mZAJDDfBBR2Pjrz2uvHiFuk5SkzUFok7YafpBtCkuY4nnvjfV6xrsYKICaAePa6puXZjTCYIcOH5bvrVl8NeY12THWQ1OyDmhZVANYJ6dX1rKj5SACIogFzRfT84cpAgKZmift38S1jXYxeTJo3Z3K6FpmtidnyxANCyRWAe6zKsIiIC6JNPhiQUFsV1hwnUzvD+MHfufctZ12Qn9evS1QiwroI9CsCVaODQocKFrGuxiogIoMlTOo9ZukRGaqaJq678+VbW9dhNjZRDi8Q60cVbRNdJh7Fg/oObWddiFRERQIVFCaMAoF0r76QXX5xylHU9dnM8W50ZmySmZVAKxMZ6xfSLKrB9AN066O1bV61wol5jDYu/v+U+1vXY0RefD9/buqnP1CN9mVYPwYXna1tZl2Eltg+gQ4cSXgeA3j1yRfiEUGbNwNxIvhtGAZAYiubNRkyv8GDhH7YOoEceebXtkl9jUzp19h6ZPHnoJNb12FnHjo5FCETuNZjuJ7igjQcPPFC4j3UtVmLrANq2I/VtaBQZ6fu6sq7F7jp1XPMdlAi+BPNStGtDvmFdhtXYNoCmv3tdzM8rYrpcfXXhqq+/emw763rsrmfPV461b+ffoemsK2EkiuBEzq6PWJdhNbYNoDXrbnrDME2MfnDwxaxriRTNmrgXIwI7ok0KpKYY6N2r1vesa7Ea2wbQD0vIXX37GO92uzySu0bDq26dE4sicQEKagIJcf7td9xxxzHWtViNLQPottvnDPQHdMx6f+DdrGuJJC++OPqLevWNiNuux/QTnNfe9wPrOqzIlgG0dj199YruBQNY1xFpCAF1OQNfs64j7EwgIcEU6/9Ug+0CaPTo51rFx2nytKnD5rOuJRK1apHzvRlB/UCaDjRtauCGG/74lXUtVmS7AFq5Kvm1K6+I78O6jkjVts2xH5KTTJiRchmmEdSv4153xRWTc1iXYkW2CqDHHns1oXZth3fMmL5/sq4lUo0Z8+zfl5xv5Btu1pWEiR+48IITM1mXYVW2CqC8vB0PNm64VOztzphEjoyBQWD3cdFaHkGvqzx7nn324TdZ12JVtgqgevXqHB333GyxzCpjn332wMQ77sz+VM+DbS/FtDyCi7sWee8YfHMb1rVYWeT0Fgphd+ug96Z8vSh6aN4JB9RYCi2PACoAufjrkoNCZvgWqAVI8SvAwOm3Yoriz51qvpU1iiwAXHOdb/95HQa2HvM08sNQqm2JABJC6sknL0/ftfuO8XPnxEbfcqt3wNFjXng8BhSZYs+BFBw4LjEJIS1A0LnNcQQCBuLiFLjdOiSJQJYJKKUghECSgCin/M/HFBSy7NDr1sEzM2cMfj78VQuCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIPDn/wHZpR9NX3BLkQAAAABJRU5ErkJggg==">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pptxgenjs/3.12.0/pptxgen.bundle.js"></script>

    <style>
        :root { 
            --primary: #2c3e50; --secondary: #3498db; --accent: #e67e22; 
            --success: #27ae60; --danger: #c0392b; --light: #ecf0f1; --dark: #34495e;
            --hp-color: #3498db; --hsa-color: #e67e22; --weight: #8e44ad;
            --supp-bg: #e8f8f5; --supp-border: #1abc9c;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background-color: #f4f6f9; height: 100vh; display: flex; overflow: hidden; color: #333; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background-color: var(--primary); color: white; display: flex; flex-direction: column; padding-top: 20px; flex-shrink: 0; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .sidebar h2 { text-align: center; margin: 0 0 5px 0; font-size: 1.5rem; font-weight: 700; letter-spacing: 0.5px; }
        .sidebar-subtitle { text-align: center; font-size: 0.85rem; color: #bdc3c7; margin-bottom: 30px; font-style: italic; opacity: 0.8; }
        .menu-item { background: none; border: none; width: 100%; text-align: left; padding: 15px 25px; color: #bdc3c7; cursor: pointer; transition: 0.2s; border-left: 4px solid transparent; font-size: 0.95rem; font-weight: 500; }
        .menu-item:hover { color: white; background: rgba(255,255,255,0.05); }
        .menu-item.active { background-color: var(--secondary); color: white; border-left: 4px solid white; }
        
        /* CONTENT */
        .content { flex-grow: 1; padding: 30px; overflow-y: auto; background-color: #f8f9fa; position: relative; }
        .content.fullscreen-mode { padding: 0; }
        .content.fullscreen-mode .section.active { padding: 20px; box-sizing: border-box; }
        .section { display: none; animation: fadeIn 0.3s ease-out; }
        .section.active { display: block; }
        
        /* SETUP MODAL */
        #setup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        .setup-box {
            background: white; padding: 40px; border-radius: 10px; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-width: 650px; width: 90%;
        }
        .setup-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 30px; }
        .setup-btn {
            padding: 20px 10px; border: 2px solid #eee; border-radius: 8px; background: #f8f9fa;
            cursor: pointer; transition: 0.2s; font-weight: bold; color: var(--primary); display:flex; flex-direction:column; align-items:center;
        }
        .setup-btn:hover { border-color: var(--secondary); background: #ebf5fb; transform: translateY(-3px); }
        .setup-icon { font-size: 2.5rem; display: block; margin-bottom: 10px; }

        /* CARDS */
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.04); padding: 25px; margin-bottom: 25px; border: 1px solid #e9ecef; }
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f1f2f6; padding-bottom: 15px; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .card h3 { margin: 0; color: var(--primary); font-size: 1.2rem; font-weight: 600; }
        
        /* BUTTONS */
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 6px; color: white; transition: 0.2s; }
        .btn-primary { background-color: var(--secondary); }
        .btn-success { background-color: var(--success); }
        .btn-danger { background-color: var(--danger); }
        .btn-warning { background-color: var(--accent); }
        .btn-purple { background-color: var(--weight); }
        .btn-dark { background-color: var(--dark); }
        .btn-sm { padding: 4px 10px; font-size: 0.8rem; }
        .export-group { display: flex; gap: 5px; }
        .btn-exp { background: #95a5a6; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .btn-exp:hover { background: #7f8c8d; }
        .btn-outline { background:transparent; border:1px solid #bdc3c7; color:#7f8c8d; }
        .btn-outline:hover, .btn-outline.active { background:#bdc3c7; color:white; }

        /* TABLES */
        table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 0.9rem; margin-top: 10px; }
        th, td { padding: 8px; border-bottom: 1px solid #eee; text-align: center; vertical-align: middle; }
        th { background: #f8f9fa; font-weight: 600; color: #636e72; position: sticky; top: 0; z-index: 5; border-top: 1px solid #eee; }
        td { border-left: 1px solid #eee; }
        td:last-child { border-right: 1px solid #eee; }
        tr:hover td { background-color: #fafafa; }
        .structure-total-row td { background-color: var(--primary) !important; color: white; font-weight: bold; font-size: 1rem; border-top: 2px solid var(--secondary); }
        
        /* LIGNE MOYENS SUPPLEMENTAIRES */
        .row-supp { background-color: var(--supp-bg); border-top: 2px solid var(--supp-border); border-bottom: 2px solid var(--supp-border); }
        .row-supp td { color: #16a085; font-weight: 600; vertical-align: middle; border-color: #d1f2eb; }
        .input-supp { width: 80px !important; text-align: center; font-weight: bold; border: 2px solid #1abc9c; color: #16a085; background: white; padding: 6px; border-radius: 4px; font-size: 1rem; }
        .supp-label-group { display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.85rem; }

        /* GRILLE TABLEUR VERTICAL */
        .grid-wrapper { overflow-x: auto; background: white; border: 1px solid #dfe6e9; padding: 0; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 30px; }
        .th-class { width: 60px; min-width: 60px; text-align: center; font-weight: bold; }
        .th-vertical { height: 190px; vertical-align: bottom; padding: 0; width: 45px; position: relative; }
        
        .th-text-wrapper { 
            writing-mode: vertical-rl; 
            transform: rotate(180deg); 
            white-space: nowrap; 
            text-align: center;
            margin: 0 auto; 
            padding-top: 10px; 
            height: 140px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            width: 100%;
            font-weight: 700; 
            color: #2c3e50; 
        }
        .th-code { font-size:0.7rem; color:#7f8c8d; display:block; height:20px; margin-top:5px; font-weight:normal; }
        .class-name-btn { background:none; border:none; border-bottom:1px dashed #3498db; color:#2c3e50; font-weight:bold; cursor:pointer; font-size:0.95rem; }
        .class-name-btn:hover { color:var(--secondary); border-bottom-style:solid; }
        
        /* RH HIERARCHIE */
        .row-master { background-color: #ecf0f1; font-weight: bold; }
        .row-master td { border-top: 2px solid #bdc3c7; color: #2c3e50; }
        .row-sub-master { background-color: #f4f6f7; font-weight: 600; }
        .row-detail { background-color: white; }
        .input-inline { width: 60px !important; padding: 4px !important; text-align: center; border: 1px solid #dfe6e9; background: white; font-weight: bold; }
        .btn-add-subject-teacher { background: var(--success); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; font-weight: bold; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; margin-left: 10px; transition: 0.2s; }
        .sub-info { font-size: 0.8rem; color: #7f8c8d; font-weight: normal; margin-left: 10px; font-style: italic; }
        .col-code { background-color: #f8f9fa; font-family: monospace; font-size: 0.85rem; color: #555; }

        /* KPI */
        .kpi-container { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 25px; }
        .kpi-box { background: white; padding: 20px 10px; border-radius: 8px; border-left: 5px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position:relative; overflow: hidden; }
        .kpi-title { font-size: 0.9rem; color: #7f8c8d; font-weight: bold; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .kpi-value { font-size: 1.6rem; font-weight: 700; color: #2c3e50; margin-top: 8px; }
        .dotation-display { font-size: 1.8rem; font-weight: bold; color: var(--primary); margin-bottom: 15px; padding: 5px 0; border-bottom: 2px solid #eee; display: block; }

        /* TOGGLE */
        .toggle-container { display: flex; background-color: #e0e0e0; border-radius: 30px; padding: 4px; width: fit-content; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        .toggle-btn { border: none; background: transparent; padding: 8px 24px; border-radius: 25px; cursor: pointer; font-weight: 600; color: #7f8c8d; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .toggle-btn.active { background-color: var(--secondary); color: white; box-shadow: 0 4px 6px rgba(52, 152, 219, 0.3); }

        /* TABS */
        .tab-container { display: flex; gap: 5px; border-bottom: 2px solid #dfe6e9; }
        .tab { padding: 10px 20px; background: #e9ecef; border-radius: 6px 6px 0 0; cursor: pointer; font-weight: bold; color: #636e72; border: 1px solid #dfe6e9; border-bottom: none; }
        .tab.active { background: white; color: var(--secondary); border-top: 3px solid var(--secondary); margin-bottom: -2px; padding-bottom: 12px; z-index: 10; }
        .tab.global-tab { color: #8e44ad; } 
        .tab.global-tab.active { border-top-color: #8e44ad; color: #8e44ad; }

        /* INPUTS */
        input[type="number"], input[type="text"], select { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .inp-hours, .inp-marge, .inp-coef { width: 52px !important; text-align: center; font-weight: bold; padding: 3px; height: 22px; border-radius: 2px; font-size: 0.82rem; }
        .inp-hours { border: 1px solid #bdc3c7; }
        .inp-hours.has-demi { border-color: #8e44ad; background: #fdf2ff; color: #6c3483; }
        .inp-demi-label { font-size: 0.6rem; color: #8e44ad; font-weight: 700; text-align: center; line-height: 1; margin-top: 1px; }
        .inp-marge { border: 1px solid #f1c40f; background-color: #fffcf5; color: #d35400; }
        .inp-coef { border: 1px solid #9b59b6; background-color: #fbf6ff; color: #8e44ad; }
        .vertical-stack { display: flex; flex-direction: column; gap: 3px; align-items: center; }

        .text-success { color: var(--success); font-weight: bold; }
        .text-danger { color: var(--danger); font-weight: bold; }
        .percent-display { color: #c0392b; font-weight: bold; font-size: 1.1rem; margin-top: 5px; display: block; text-align: center; border: 2px solid #c0392b; padding: 5px; border-radius: 8px; background: #fff5f5; width: fit-content; margin-left: auto; margin-right: auto; }
        
        .lvl-check-container { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
        .lvl-check-item { display:flex; align-items:center; gap:3px; background:#f8f9fa; border:1px solid #eee; padding:2px 6px; border-radius:4px; font-size:0.8rem; }
        .lvl-input-item { display:flex; align-items:center; gap:5px; margin-bottom:2px; }
        .lvl-input-item span { font-size:0.8rem; font-weight:bold; }
		/* FENÊTRE VENTILATION (SPLIT MODAL) */
#split-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.5); z-index: 10000;
    display: none; justify-content: center; align-items: center;
    backdrop-filter: blur(2px);
}
.split-box {
    background: white; padding: 25px; border-radius: 8px; 
    width: 400px; max-width: 90%;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}
.split-header { 
    border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; 
    display: flex; justify-content: space-between; align-items: center; 
}
.split-header h3 { margin: 0; color: var(--primary); }
.split-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 12px; padding: 8px; background: #f8f9fa; border-radius: 6px; border: 1px solid #eee;
}
.split-row label { font-weight: bold; color: #555; }
.split-row input { width: 80px !important; text-align: center; font-weight: bold; color: var(--secondary); }
.split-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
.info-dispo { background: #e8f8f5; color: #16a085; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-weight: bold; text-align: center; font-size: 0.9rem; }
		
		/* --- AJOUT POUR ÉQUIPES PÉDAGOGIQUES --- */
        .team-table { font-size: 0.8rem; width: 100%; border-collapse: collapse; }
        .team-table th { background: #2c3e50; color: white; font-weight: bold; border: 1px solid #34495e; padding: 10px 5px; position: sticky; top: 0; z-index: 10; }
        .team-table td { border: 1px solid #bdc3c7; padding: 0; height: 35px; min-width: 40px; text-align: center; vertical-align: middle; }
        
        .team-subject-row { background-color: #ecf0f1; font-weight: bold; text-align: left; padding-left: 10px !important; color: #2c3e50; border-top: 2px solid #7f8c8d !important; }
        .team-teacher-label { text-align: left; padding-left: 10px !important; font-size: 0.85rem; color: #333; background: #fff; width: 220px; max-width: 220px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 500; }
        
        .cell-assign { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.1s; font-size: 1.2rem; user-select: none; }
        .cell-assign:hover { background-color: #f0f0f0; }
        
/* --- SÉLECTEUR D'ENTITÉS MULTI (V9) --- */
.entity-selector {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 12px 15px 18px 15px;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    margin-bottom: 10px;
}
.entity-label {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
    margin-bottom: 4px;
}
.entity-btn {
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    color: #bdc3c7;
    padding: 9px 12px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    text-align: left;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
}
.entity-btn:hover {
    background: rgba(255,255,255,0.14);
    color: white;
    transform: translateX(2px);
}
.entity-btn.active {
    color: white;
    box-shadow: 0 3px 10px rgba(0,0,0,0.35);
    border-color: transparent;
    transform: translateX(0);
}
/* Couleurs par entité */
#entity-btn-college.active    { background: #1565C0; box-shadow: 0 3px 10px rgba(21,101,192,0.55); }
#entity-btn-lycee.active      { background: #2E7D32; box-shadow: 0 3px 10px rgba(46,125,50,0.55); }
#entity-btn-lycee_pro.active  { background: #E65100; box-shadow: 0 3px 10px rgba(230,81,0,0.55); }
#entity-btn-pole.active       { background: #6A1B9A; box-shadow: 0 3px 10px rgba(106,27,154,0.55); }
#entity-btn-college:not(.active):hover    { border-color: #1565C0; color: #90CAF9; }
#entity-btn-lycee:not(.active):hover      { border-color: #2E7D32; color: #A5D6A7; }
#entity-btn-lycee_pro:not(.active):hover  { border-color: #E65100; color: #FFCC80; }
#entity-btn-pole:not(.active):hover       { border-color: #6A1B9A; color: #CE93D8; }
.entity-btn .entity-badge {
    font-size: 0.68rem;
    background: rgba(255,255,255,0.18);
    padding: 1px 6px;
    border-radius: 10px;
    margin-left: auto;
    white-space: nowrap;
    font-weight: 700;
}
.entity-btn.active .entity-badge {
    background: rgba(255,255,255,0.28);
}
/* Badge de dotation totale dans le header */
.multi-summary {
    background: rgba(255,255,255,0.05);
    border-radius: 5px;
    padding: 8px 12px;
    margin: 0 15px 10px 15px;
    font-size: 0.75rem;
    color: rgba(255,255,255,0.7);
    border: 1px solid rgba(255,255,255,0.1);
}
.multi-summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2px 0;
}
.multi-summary-val {
    font-weight: 700;
    color: white;
}

        /* Couleurs des états */
        .mode-class { background-color: #27ae60 !important; color: white; } /* Vert : Classe Entière */
        .mode-group { background-color: #3498db !important; color: white; } /* Bleu : Groupe */
        .missing-teacher { background-color: #fadbd8 !important; box-shadow: inset 0 0 0 2px #c0392b; } /* Rouge : Alerte */
        
        /* Indicateur Prof Principal (Couronne) */
        .is-pp { position: relative; border: 3px solid #f1c40f !important; z-index: 5; }
        .is-pp::after { 
            content: '👑'; position: absolute; top: -14px; right: -8px; 
            background: white; border-radius: 50%; padding: 1px; 
            font-size: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.3); border:1px solid #f1c40f;
        }
		/* Case désactivée (0h dans la matière) */
        .cell-disabled {
            background-color: #e0e0e0 !important; /* Gris */
            cursor: not-allowed !important;
            opacity: 0.6;
            pointer-events: none; /* Bloque le clic */
            box-shadow: none !important;
            border-color: #d0d3d4 !important;
        }

/* --- MODAL EXPORT MODERNE (V2) --- */
.export-section-title {
    font-size: 0.9rem;
    font-weight: 700;
    color: #7f8c8d;
    margin-bottom: 10px;
    margin-top: 20px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.export-tiles-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
}

.export-tile {
    background: white;
    border: 2px solid #ecf0f1;
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #2c3e50;
    position: relative;
    height: 100px; /* Hauteur fixe pour uniformité */
}

.export-tile:hover {
    border-color: #3498db;
    background: #ebf5fb;
    transform: translateY(-2px);
}

.export-tile.selected {
    border-color: #27ae60;
    background: #e8f8f5;
    color: #27ae60;
    box-shadow: 0 4px 10px rgba(39, 174, 96, 0.2);
}

.export-tile.selected::after {
    content: '✔';
    position: absolute;
    top: 5px; right: 5px;
    font-size: 1rem;
    color: #27ae60;
}

.tile-label { font-weight: bold; font-size: 0.95rem; margin-top: 8px; }

/* --- ICONES CSS PURE (Pour être sûr du visuel) --- */
.icon-paper {
    border: 2px solid currentColor;
    border-radius: 2px;
    position: relative;
    background: rgba(0,0,0,0.05);
}
/* Lignes de texte simulées à l'intérieur */
.icon-paper::before {
    content: ''; position: absolute;
    background: currentColor; opacity: 0.3;
}

/* Portrait : Haut et étroit */
.icon-portrait { width: 24px; height: 34px; }
.icon-portrait::before { top: 6px; left: 4px; right: 4px; height: 2px; box-shadow: 0 4px 0 currentColor, 0 8px 0 currentColor; }

/* Paysage : Large et bas */
.icon-landscape { width: 34px; height: 24px; }
.icon-landscape::before { top: 6px; left: 4px; right: 4px; height: 2px; box-shadow: 0 4px 0 currentColor, 0 8px 0 currentColor; }

/* Formats (Juste du texte stylisé) */
.icon-format { font-size: 1.5rem; font-weight: 900; font-family: sans-serif; }

.export-options-row {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-top: 25px;
    border: 1px solid #eee;
}
.switch-label { display: flex; align-items: center; gap: 10px; cursor: pointer; color: #34495e; }

/* WIDGET KPI DOUBLE */
.kpi-widget {
    background: white;
    border: 1px solid #bdc3c7;
    border-radius: 6px;
    padding: 4px 10px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-right: auto; margin-left: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
    min-width: 200px;
}

.kpi-row {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    line-height: 1.2;
}

.level-row {
    border-top: 1px solid #f1f2f6;
    padding-top: 4px;
}

.kpi-icon { font-size: 0.9rem; }
.kpi-label { font-weight: bold; color: #7f8c8d; font-size: 0.75rem; width: 40px; }
.kpi-val { font-weight: 800; color: #2c3e50; flex-grow: 1; text-align: right; margin-right: 8px; }

.kpi-tag {
    font-size: 0.75rem;
    font-weight: bold;
    padding: 1px 6px;
    border-radius: 4px;
    color: white;
    min-width: 35px;
    text-align: center;
}

/* Couleurs des deltas */
.bg-pos { background-color: #27ae60; } /* Vert (Reste) */
.bg-neg { background-color: #c0392b; } /* Rouge (Dépassement) */
.bg-nul { background-color: #95a5a6; } /* Gris (Pile poil) */

/* --- NOUVEAU STYLE DES EN-TÊTES (Pôles & Matières Solos) --- */
/* --- NOUVEAU STYLE DES EN-TÊTES (Gris Anthracite) --- */
.row-header {
    background-color: #455a64 !important; /* Gris foncé neutre */
    color: white !important;
    font-weight: bold;
    border-top: 2px solid #607d8b;
}

/* On force la couleur à rester la même au survol */
.row-header:hover td {
    background-color: #455a64 !important; 
    color: white !important;
}

.row-header button {
    border: 1px solid white !important;
    box-shadow: none !important;
}

.menu-item.disabled {
    opacity: 0.35;
    cursor: not-allowed;
    filter: grayscale(1);
    pointer-events: none;
}
.menu-item.disabled:hover {
    background: transparent;
    color: #bdc3c7;
    transform: none;
}

/* Style du Pop-up EDS */
#eds-selector-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(44, 62, 80, 0.8); z-index: 20000;
    display: none; justify-content: center; align-items: center;
    backdrop-filter: blur(4px);
}
.eds-selector-box {
    background: white; padding: 30px; border-radius: 12px;
    width: 800px; max-width: 95%; max-height: 90vh;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    display: flex; flex-direction: column;
}
.eds-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 12px; overflow-y: auto; padding: 10px; margin: 20px 0;
}
.eds-tile {
    border: 2px solid #eee; border-radius: 8px; padding: 15px 10px;
    text-align: center; cursor: pointer; transition: all 0.2s;
    font-size: 0.85rem; font-weight: 600; color: var(--primary);
    background: #f8f9fa; position: relative;
    display: flex; align-items: center; justify-content: center; min-height: 60px;
}
.eds-tile:hover { border-color: var(--secondary); background: #ebf5fb; transform: translateY(-2px); }
.eds-tile.selected {
    border-color: var(--success); background: #e8f8f5; color: var(--success);
    box-shadow: 0 4px 8px rgba(39, 174, 96, 0.2);
}
.eds-tile.selected::after {
    content: '✓'; position: absolute; top: 5px; right: 5px;
    background: var(--success); color: white; width: 18px; height: 18px;
    border-radius: 50%; font-size: 12px; display: flex; align-items: center; justify-content: center;
}

/* --- STYLE TABLEAU EDS V4 --- */
.table-eds { 
    width: 100%; border-collapse: collapse; margin-bottom: 20px; 
    background: white; border-radius: 8px; overflow: hidden;
}
.table-eds th { 
    background: #f8f9fa; color: #7f8c8d; font-size: 0.75rem; 
    text-transform: uppercase; padding: 12px 10px; border-bottom: 2px solid #eee; 
    text-align: center;
}
.table-eds td { padding: 10px; border-bottom: 1px solid #f1f1f1; text-align: center; vertical-align: middle; }
.cost-badge { 
    font-size: 0.8rem; font-weight: 800; background: #ebf5fb; 
    color: #2980b9; padding: 4px 8px; border-radius: 6px; border: 1px solid #aed6f1; 
}
.eds-cat-header {
    background: #455a64 !important; color: white !important; 
    text-align: left !important; padding-left: 15px !important;
    font-size: 0.85rem; font-weight: bold; letter-spacing: 1px;
}
.input-inline-eds { 
    width: 60px !important; 
    padding: 6px 4px !important; 
    text-align: center; 
    border: 1px solid #dfe6e9; 
    border-radius: 4px;
    font-weight: bold;
    background: white;
}
/* Style pour les petits badges de catégorie */
.badge-cat {
    font-size: 0.65rem;
    padding: 2px 5px;
    border-radius: 3px;
    background: #eee;
    margin-right: 8px;
    vertical-align: middle;
}

    </style>
</head>
<body>

<div id="setup-overlay" style="display: none;">
    <div class="setup-box" style="max-width:780px;">
        <h1>👋 Bienvenue sur DHG Manager V9</h1>
        <p style="color:#555;">Sélectionnez les entités de votre établissement, configurez-les, puis cliquez sur <strong>Démarrer</strong>.</p>

        <!-- SÉLECTEUR D'ENTITÉS -->
        <div style="display:flex; gap:10px; justify-content:center; margin:18px 0 20px 0; flex-wrap:wrap;">
            <label id="toggle-college" onclick="toggleEntityCard('college')" style="cursor:pointer; display:flex; align-items:center; gap:7px; padding:8px 16px; border-radius:20px; border:2px solid #3498db; background:#ebf5fb; color:#2980b9; font-weight:700; font-size:0.9rem; user-select:none;">
                <input type="checkbox" id="chk-college" checked style="width:16px;height:16px;accent-color:#2980b9;"> 🏫 Collège
            </label>
            <label id="toggle-lycee" onclick="toggleEntityCard('lycee')" style="cursor:pointer; display:flex; align-items:center; gap:7px; padding:8px 16px; border-radius:20px; border:2px solid #27ae60; background:#e8f8f5; color:#1e8449; font-weight:700; font-size:0.9rem; user-select:none;">
                <input type="checkbox" id="chk-lycee" checked style="width:16px;height:16px;accent-color:#1e8449;"> 🏛️ Lycée GT
            </label>
            <label id="toggle-lycee_pro" onclick="toggleEntityCard('lycee_pro')" style="cursor:pointer; display:flex; align-items:center; gap:7px; padding:8px 16px; border-radius:20px; border:2px solid #d35400; background:#fef5ec; color:#d35400; font-weight:700; font-size:0.9rem; user-select:none;">
                <input type="checkbox" id="chk-lycee_pro" style="width:16px;height:16px;accent-color:#d35400;"> 🏭 Lycée Pro
            </label>
            <label id="toggle-pole" onclick="toggleEntityCard('pole')" style="cursor:pointer; display:flex; align-items:center; gap:7px; padding:8px 16px; border-radius:20px; border:2px solid #8e44ad; background:#f5eef8; color:#7d3c98; font-weight:700; font-size:0.9rem; user-select:none;">
                <input type="checkbox" id="chk-pole" style="width:16px;height:16px;accent-color:#8e44ad;"> 🎓 Pôle Sup.
            </label>
        </div>

        <!-- CARTES DE CONFIGURATION -->
        <div id="setup-cards-container" style="display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-top:10px;">
            <!-- COLLÈGE -->
            <div id="card-college" style="border:2px solid #3498db; border-radius:10px; padding:15px; background:#ebf5fb; transition:opacity 0.2s;">
                <div style="text-align:center; font-size:2rem; margin-bottom:5px;">🏫</div>
                <h3 style="margin:0 0 10px 0; color:#2980b9; text-align:center;">Collège</h3>
                <label style="font-size:0.85rem; color:#555;">Structure :</label>
                <select id="setup-college-type" style="width:100%; margin-bottom:8px; font-size:0.85rem;">
                    <option value="college">Collège (6ème → 3ème)</option>
                </select>
                <label style="font-size:0.85rem; color:#555;">Nom (optionnel) :</label>
                <input type="text" id="setup-college-name" placeholder="Ex: Collège Victor Hugo" style="width:100%; font-size:0.85rem; box-sizing:border-box;">
            </div>
            <!-- LYCÉE GT -->
            <div id="card-lycee" style="border:2px solid #27ae60; border-radius:10px; padding:15px; background:#e8f8f5; transition:opacity 0.2s;">
                <div style="text-align:center; font-size:2rem; margin-bottom:5px;">🏛️</div>
                <h3 style="margin:0 0 10px 0; color:#1e8449; text-align:center;">Lycée</h3>
                <label style="font-size:0.85rem; color:#555;">Structure :</label>
                <select id="setup-lycee-type" style="width:100%; margin-bottom:8px; font-size:0.85rem;">
                    <option value="lgt">Lycée GT (2nde → Terminale)</option>
                    <option value="lp">Lycée Pro (structure libre)</option>
                </select>
                <label style="font-size:0.85rem; color:#555;">Nom (optionnel) :</label>
                <input type="text" id="setup-lycee-name" placeholder="Ex: Lycée Marie Curie" style="width:100%; font-size:0.85rem; box-sizing:border-box;">
            </div>
            <!-- LYCÉE PRO -->
            <div id="card-lycee_pro" style="border:2px solid #d35400; border-radius:10px; padding:15px; background:#fef5ec; transition:opacity 0.2s; opacity:0.4; pointer-events:none;">
                <div style="text-align:center; font-size:2rem; margin-bottom:5px;">🏭</div>
                <h3 style="margin:0 0 10px 0; color:#d35400; text-align:center;">Lycée Pro</h3>
                <label style="font-size:0.85rem; color:#555;">Structure :</label>
                <select id="setup-lycee-pro-type" style="width:100%; margin-bottom:8px; font-size:0.85rem;">
                    <option value="lp">Lycée Pro (structure libre)</option>
                    <option value="college">Structure Collège</option>
                </select>
                <label style="font-size:0.85rem; color:#555;">Nom (optionnel) :</label>
                <input type="text" id="setup-lycee-pro-name" placeholder="Ex: Lycée Pro Diderot" style="width:100%; font-size:0.85rem; box-sizing:border-box;">
            </div>
            <!-- PÔLE SUPÉRIEUR -->
            <div id="card-pole" style="border:2px solid #8e44ad; border-radius:10px; padding:15px; background:#f5eef8; transition:opacity 0.2s; opacity:0.4; pointer-events:none;">
                <div style="text-align:center; font-size:2rem; margin-bottom:5px;">🎓</div>
                <h3 style="margin:0 0 10px 0; color:#7d3c98; text-align:center;">Pôle Supérieur</h3>
                <label style="font-size:0.85rem; color:#555;">Structure :</label>
                <select id="setup-pole-type" style="width:100%; margin-bottom:8px; font-size:0.85rem;">
                    <option value="lp">Structure libre (BTS, CPGE…)</option>
                </select>
                <label style="font-size:0.85rem; color:#555;">Nom (optionnel) :</label>
                <input type="text" id="setup-pole-name" placeholder="Ex: Pôle Supérieur CPGE" style="width:100%; font-size:0.85rem; box-sizing:border-box;">
            </div>
        </div>
        
        <div style="margin-top:22px;">
            <button class="btn btn-success" style="width:100%; padding:14px; font-size:1rem;" onclick="initMultiData()">🚀 Démarrer</button>
        </div>
        
        <p style="margin-top:20px; font-size:0.9rem; color:#777; border-top:1px solid #eee; padding-top:15px; text-align:center;">
            Vous avez déjà un fichier ?<br>
            <button class="btn btn-dark btn-sm" style="margin-top:10px;" onclick="document.getElementById('load-file-input-overlay').click()">📂 Charger une sauvegarde</button>
            <input type="file" id="load-file-input-overlay" style="display:none;" onchange="loadSaveFile(this)" accept=".data,.json">
        </p>
    </div>
</div>

<div class="sidebar">
    <h2>DHG Manager V9</h2>
    <div class="sidebar-subtitle">Multi-Entités · By Fred Vedrenne</div>
    
    <!-- SÉLECTEUR D'ENTITÉS -->
    <div class="entity-selector">
        <div class="entity-label">📍 Entité active</div>
        <button class="entity-btn active" id="entity-btn-college" onclick="switchEntity('college')">
            🏫 Collège
            <span class="entity-badge" id="entity-badge-college">– h</span>
        </button>
        <button class="entity-btn" id="entity-btn-lycee" onclick="switchEntity('lycee')">
            🏛️ Lycée
            <span class="entity-badge" id="entity-badge-lycee">– h</span>
        </button>
        <button class="entity-btn" id="entity-btn-lycee_pro" onclick="switchEntity('lycee_pro')">
            🏭 Lycée Pro
            <span class="entity-badge" id="entity-badge-lycee_pro">– h</span>
        </button>
        <button class="entity-btn" id="entity-btn-pole" onclick="switchEntity('pole')">
            🎓 Pôle Supérieur
            <span class="entity-badge" id="entity-badge-pole">– h</span>
        </button>
    </div>

    <button id="menu-dashboard" class="menu-item" onclick="nav('dashboard', this)">📊 Tableau de Bord</button>
    <button id="menu-structure" class="menu-item" onclick="nav('structure', this)">🏗️ Structure (Niveaux)</button>
    <button id="menu-matieres" class="menu-item" onclick="nav('matieres', this)">🔗 Matières &amp; Modalités</button>
	<button id="menu-eds" class="menu-item" onclick="nav('eds', this)">🎓 Spécialités &amp; EDS</button>
    <button id="menu-ventilation" class="menu-item" onclick="nav('ventilation', this)">⏱️ Grille Horaire</button>
	<button id="menu-professeurs" class="menu-item" onclick="nav('professeurs', this)">👥 Professeurs</button>
	<button id="menu-pilotage" class="menu-item" onclick="nav('pilotage', this)">⚖️ Ventilation</button>
	<button id="menu-equipes" class="menu-item" onclick="nav('equipes', this)">🎓 Équipes Pédagogiques</button>
	<button id="menu-repartition" class="menu-item active" onclick="nav('repartition', this)">📋 Répartition de Services</button>
    <button id="menu-recap" class="menu-item" onclick="nav('recap', this)">📑 Bilan &amp; Export</button>
    
    <div style="border-top:1px solid rgba(255,255,255,0.15); margin:8px 15px; padding-top:8px;">
        <div style="font-size:0.7rem; color:rgba(255,255,255,0.45); text-transform:uppercase; letter-spacing:1px; padding:0 10px 5px 10px; font-weight:700;">Multi-Entités</div>
        <button class="menu-item" onclick="nav('bilan-global', this)" style="color:#f1c40f;">🌐 Bilan Consolidé</button>
        <button class="menu-item" onclick="nav('enseignants-mutualises', this)" style="color:#f1c40f;">👥 Enseignants</button>
    </div>
    
    <div style="margin-top:auto; padding:20px;">
        <button class="btn btn-primary" style="width:100%; margin-bottom:10px;" onclick="downloadSaveFile()">💾 Sauvegarder (.data)</button>
        <input type="file" id="load-file-input" style="display:none;" onchange="loadSaveFile(this)" accept=".data,.json">
        <button class="btn btn-dark" style="width:100%; font-size:0.85rem;" onclick="document.getElementById('load-file-input').click()">📂 Charger une sauvegarde</button>
        
        <hr style="border:0; border-top:1px solid rgba(255,255,255,0.2); margin:15px 0;">
        
        <button class="btn btn-warning" style="width:100%; font-size:0.85rem;" onclick="resetAllEntities()">⚙️ Réinitialiser tout</button>
    </div>
</div>

<div class="content">
    <!-- Bandeau entité active -->
    <div id="entity-header-banner" style="display:flex; align-items:center; gap:12px; background:white; border-left:5px solid #1565C0; border-top:1px solid #e0e0e0; border-right:1px solid #e0e0e0; border-bottom:1px solid #e0e0e0; border-radius:8px; padding:10px 20px; margin-bottom:18px; box-shadow:0 1px 4px rgba(0,0,0,0.06); transition: border-color 0.3s, background 0.3s;">
        <span id="entity-title-header" style="font-size:1.05rem; font-weight:800; color:#1565C0; letter-spacing:0.3px;">🏫 Collège</span>
        <span style="color:#bdc3c7; font-size:0.8rem;">— entité active</span>
    </div>

    <div id="dashboard" class="section">
        <div class="card">
            <div class="card-header">
                <h3>Pilotage Global</h3>
                <div class="export-group">
                    <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
                    <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
                </div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <label style="margin:0; font-weight:normal;">Rentrée :</label>
                    <select id="dash-year" style="width:100px; font-weight:bold;" onchange="updateYear(this.value)"><option value="2025">2025</option><option value="2026" selected="selected">2026</option><option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option><option value="2031">2031</option></select>
                </div>
            </div>
            
            <div class="kpi-container">
                <div class="kpi-box" style="border-color: var(--primary);">
                    <div class="kpi-title">Dotation Rectorat</div>
                    <div class="kpi-value"><span id="dash-total-dhg">57</span> h</div>
                    <small style="color:#777; font-size:0.7rem; font-style:italic;">(Via Structure)</small>
                </div>
                
                <div class="kpi-box" style="border-color: var(--success);">
                    <div class="kpi-title">Consommation</div>
                    <div class="kpi-value"><span id="dash-conso">54.0</span> h</div>
                </div>

                <div class="kpi-box" style="border-color: var(--hp-color);">
                    <div class="kpi-title">HP Utilisées</div>
                    <div class="kpi-value"><span id="dash-hp-used">54.0</span> h</div>
                </div>

                <div class="kpi-box" style="border-color: var(--hsa-color);">
                    <div class="kpi-title">HSA Utilisées</div>
                    <div class="kpi-value"><span id="dash-hsa">0.0</span> h</div>
                </div>
                
                <div class="kpi-box" style="border-color: #95a5a6;">
                    <div class="kpi-title">Marge</div>
                    <div class="kpi-value" id="dash-solde">3.0</div>
                </div>
            </div>

            <div style="display:flex; gap:25px; flex-wrap:wrap;">
                <div style="flex:1; min-width:300px; background:#f8f9fa; padding:20px; border-radius:8px; border:1px solid #eee;">
                    <h4 style="margin-top:0;">Répartition</h4>
                    <div style="height:250px; position:relative; width:100%;">
                        <canvas id="dhgChart" style="box-sizing: border-box; display: block; height: 250px; width: 719.5px;" width="719" height="250"></canvas>
                    </div>
                </div>
                <div style="flex:1; min-width:300px; background:#f8f9fa; padding:20px; border-radius:8px; border:1px solid #eee;">
                    <h4 style="margin-top:0;">Paramètres Dotation</h4>
                    
                    <label>Dotation Globale (Donnée issue du menu Structure)</label>
                    <span id="global-dhg-display" class="dotation-display">57</span>
                    
                    <div style="display:flex; gap:15px; margin-bottom:15px;">
                        <div style="flex:1"><label>Dont HP</label><input type="number" id="global-hp" value="0" onchange="updateGlobalDHG()"></div>
                        <div style="flex:1"><label>Dont HSA</label><input type="number" id="global-hsa" value="0" onchange="updateGlobalDHG()"></div>
                    </div>
                    
                    <div class="percent-display">
                        <span id="global-hsa-percent-display">0.0%</span> HSA
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="structure" class="section">
        <div class="card">
            <div class="card-header">
                <h3>Structure Pédagogique (Niveaux)</h3>
                <div class="export-group">
                    <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
                    <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
                </div>
                <div>
                    <button class="btn btn-success btn-sm" onclick="addNewLevel()">➕ Ajouter Niveau</button>
                    <button class="btn btn-primary btn-sm" onclick="generateClasses(true)">🔄 Régénérer</button>
                </div>
            </div>
            <table id="structure-table">
                <thead>
                    <tr>
                        <th>Niveau</th><th>Effectif</th><th>Divisions</th><th>Moy./Div</th>
                        <th style="background:#fff3cd; color:#d35400;">Moyens Horaires par Division</th><th>Total Moyens</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="structure-body"><tr>
            <td><b>2nde</b></td>
            <td><input type="number" value="29" onchange="updStruct(0,'students',this.value)"></td>
            <td><input type="number" value="1" onchange="updStruct(0,'div',this.value)"></td>
            <td>29.0</td>
            <td><input type="number" value="29" step="0.5" style="background:#fffbe6; font-weight:bold; text-align:center;" onchange="updStruct(0,'target',this.value)"></td>
            <td style="font-weight:bold; color:var(--primary)">29.0 h</td>
            <td>
                <div style="display:flex; gap:5px; justify-content:center;">
                    <button class="btn-sm btn-warning" onclick="renameLevel(0)">✏️</button>
                    <button class="btn-sm btn-danger" onclick="deleteLevel(0)">🗑️</button>
                </div>
            </td>
        </tr><tr>
            <td><b>1ère</b></td>
            <td><input type="number" value="135" onchange="updStruct(1,'students',this.value)"></td>
            <td><input type="number" value="1" onchange="updStruct(1,'div',this.value)"></td>
            <td>135.0</td>
            <td><input type="number" value="28" step="0.5" style="background:#fffbe6; font-weight:bold; text-align:center;" onchange="updStruct(1,'target',this.value)"></td>
            <td style="font-weight:bold; color:var(--primary)">28.0 h</td>
            <td>
                <div style="display:flex; gap:5px; justify-content:center;">
                    <button class="btn-sm btn-warning" onclick="renameLevel(1)">✏️</button>
                    <button class="btn-sm btn-danger" onclick="deleteLevel(1)">🗑️</button>
                </div>
            </td>
        </tr><tr>
            <td><b>Terminale</b></td>
            <td><input type="number" value="0" onchange="updStruct(2,'students',this.value)"></td>
            <td><input type="number" value="0" onchange="updStruct(2,'div',this.value)"></td>
            <td>0</td>
            <td><input type="number" value="28" step="0.5" style="background:#fffbe6; font-weight:bold; text-align:center;" onchange="updStruct(2,'target',this.value)"></td>
            <td style="font-weight:bold; color:var(--primary)">0.0 h</td>
            <td>
                <div style="display:flex; gap:5px; justify-content:center;">
                    <button class="btn-sm btn-warning" onclick="renameLevel(2)">✏️</button>
                    <button class="btn-sm btn-danger" onclick="deleteLevel(2)">🗑️</button>
                </div>
            </td>
        </tr>
    <tr class="row-supp">
        <td colspan="4" style="text-align:right; font-weight:bold; font-style:italic;">
            Moyens supplémentaires :
        </td>
        <td>
            <div class="supp-label-group">
                <input type="number" class="input-supp" value="0" onchange="updSupp(this.value)">
            </div>
        </td>
        <td style="font-weight:bold;">0.0 h</td>
        <td></td>
    </tr>
    <tr class="structure-total-row"><td>TOTAL GÉNÉRAL</td><td>164</td><td>2</td><td>82.0</td><td style="text-align:right;">Total Moyens :</td><td style="color:#f1c40f;">57.0 h</td><td></td></tr></tbody>
            </table>
        </div>
        <div class="card">
            <div class="card-header">
                <h3>✏️ Noms des Classes</h3>
                <small style="color:#7f8c8d; font-weight:normal;">Cliquez sur un nom pour le modifier librement. Les noms sont conservés même après régénération.</small>
            </div>
            <div id="class-list-container" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"><span style="background:var(--secondary); color:white; padding:4px 8px; border-radius:4px; font-size:0.8rem;">2A</span><span style="background:var(--secondary); color:white; padding:4px 8px; border-radius:4px; font-size:0.8rem;">1A</span></div>
        </div>
    </div>

   <div id="ventilation" class="section">
        <div class="card">
            <div class="card-header">
                <h3>Grille Horaire</h3>
                
                <div id="grid-kpi" class="kpi-widget">
                    <div class="kpi-row">
                        <span class="kpi-icon">🌍</span>
                        <span class="kpi-label">ÉTAB :</span>
                        <span id="kpi-etab-val" class="kpi-val">44.0 / 57.0 h</span>
                        <span id="kpi-etab-diff" class="kpi-tag bg-pos">+13.0</span>
                    </div>
                    <div id="kpi-level-row" class="kpi-row level-row" style="display: flex;">
                        <span class="kpi-icon">🏗️</span>
                        <span class="kpi-label">NIV :</span>
                        <span id="kpi-lvl-val" class="kpi-val">25.0 / 29.0 h</span>
                        <span id="kpi-lvl-diff" class="kpi-tag bg-pos">+4.0</span>
                    </div>
                </div>
                <div class="export-group">
                    <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
                    <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
                </div>
                <div>
                    <button class="btn btn-purple btn-sm" onclick="openWeightingMenu()">⚖️ Pondération</button>
                    <button class="btn btn-warning btn-sm" onclick="resetToOfficial()">⚠️ Reset Officiel</button>
                </div>
            </div>
            <div class="tab-container" id="grid-tabs"><div class="tab active" onclick="changeTab(this, 0)">2nde</div><div class="tab " onclick="changeTab(this, 1)">1ère</div><div class="tab " onclick="changeTab(this, 2)">Terminale</div><div class="tab global-tab" onclick="changeTab(this, -1)">🌍 Vue Globale</div></div>
            <div id="grid-container"><div class="grid-wrapper"><table class="grid-table">
    <thead>
        <tr>
            <th class="th-class" style="vertical-align:bottom; padding-bottom:10px;"><span style="font-size:1.1rem; color:#2c3e50;">2nde</span></th>
            <th class="th-vertical"><span class="del-badge" onclick="delSubject('Français')">×</span><div class="th-text-wrapper">Français</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('Hist-Géo')">×</span><div class="th-text-wrapper">Hist-Géo</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('LVA')">×</span><div class="th-text-wrapper">LVA</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('LVB')">×</span><div class="th-text-wrapper">LVB</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('SES')">×</span><div class="th-text-wrapper">SES</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('Maths (TC)')">×</span><div class="th-text-wrapper">Maths (TC)</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('Phys-Chi (TC)')">×</span><div class="th-text-wrapper">Phys-Chi (TC)</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('SVT (TC)')">×</span><div class="th-text-wrapper">SVT (TC)</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('EPS')">×</span><div class="th-text-wrapper">EPS</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('Ens. Scientifique')">×</span><div class="th-text-wrapper">Ens. Scientifique</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('EMC')">×</span><div class="th-text-wrapper">EMC</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('Autonomie EPLE')">×</span><div class="th-text-wrapper">Autonomie EPLE</div></th><th class="th-vertical"><span class="del-badge" onclick="delSubject('MAths')">×</span><div class="th-text-wrapper">MAths</div></th>
            <th class="th-vertical" style="vertical-align:bottom;"><div style="writing-mode:vertical-rl; transform:rotate(180deg); color:#2c3e50; font-weight:bold; height:auto; margin:0 auto;">TOTAL</div></th>
        </tr>
    </thead>
    <tbody>
    
    <tr style="background:#fcf3ff;"><td style="text-align:center; font-weight:bold; color:#8e44ad; font-size:0.75rem;">Coeff.</td>
    <td><input class="inp-coef" value="1" onchange="updLvl('2nde','Français','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','Hist-Géo','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','LVA','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','LVB','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','SES','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','Maths (TC)','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','Phys-Chi (TC)','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','SVT (TC)','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','EPS','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','Ens. Scientifique','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','EMC','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','Autonomie EPLE','coef',this.value)"></td><td><input class="inp-coef" value="1" onchange="updLvl('2nde','MAths','coef',this.value)"></td>
    <td style="background:#f4f6f9;"></td></tr>
    
    <tr style="background:#fff;"><td style="text-align:center; font-weight:bold; color:#7f8c8d; font-size:0.75rem;">Off.</td>
    <td><input class="inp-hours" type="text" value="4" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','Français','base',this.value)"></td><td><input class="inp-hours" type="text" value="3" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','Hist-Géo','base',this.value)"></td><td><input class="inp-hours" type="text" value="3" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','LVA','base',this.value)"></td><td><input class="inp-hours" type="text" value="2.5" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','LVB','base',this.value)"></td><td><input class="inp-hours" type="text" value="1.5" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','SES','base',this.value)"></td><td><input class="inp-hours" value="4" onchange="updLvl('2nde','Maths (TC)','base',this.value)"></td><td><input class="inp-hours" value="3" onchange="updLvl('2nde','Phys-Chi (TC)','base',this.value)"></td><td><input class="inp-hours" value="1.5" onchange="updLvl('2nde','SVT (TC)','base',this.value)"></td><td><input class="inp-hours" type="text" value="2" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','EPS','base',this.value)"></td><td><input class="inp-hours" type="text" value="0" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','Ens. Scientifique','base',this.value)"></td><td><input class="inp-hours" type="text" value="0.5" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','EMC','base',this.value)"></td><td><input class="inp-hours" type="text" value="0" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','Autonomie EPLE','base',this.value)"></td><td><input class="inp-hours" type="text" value="0" oninput="updateInpHoursStyle(this)" onchange="updLvl('2nde','MAths','base',this.value)"></td>
    <td rowspan="2" id="tot-lvl" style="font-weight:bold; font-size:1.1rem; vertical-align:middle;">25.0</td></tr>
    
    <tr style="background:#fffcf5;"><td style="text-align:center; font-weight:bold; color:#d35400; font-size:0.65rem;">Autonomie</td>
    <td><input class="inp-marge" value="0" onchange="updLvl('2nde','Français','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','Hist-Géo','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','LVA','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','LVB','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','SES','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','Maths (TC)','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','Phys-Chi (TC)','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','SVT (TC)','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','EPS','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','Ens. Scientifique','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','EMC','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','Autonomie EPLE','marge',this.value)"></td><td><input class="inp-marge" value="0" onchange="updLvl('2nde','MAths','marge',this.value)"></td>
    </tr>
    
    <tr style="height:15px; background:#f4f6f9;"><td colspan="15"></td></tr><tr style="background:white">
            <td class="td-class">
                <button class="class-name-btn" onclick="renameClass('2A')">2A</button>
                <label style="display:block; font-size:0.6rem;"><input type="checkbox" onchange="toggleOv('2A')"> Perso.</label>
            </td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="4" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','Français','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','Français','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="3" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','Hist-Géo','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','Hist-Géo','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="3" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','LVA','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','LVA','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="2.5" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','LVB','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','LVB','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="1.5" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','SES','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','SES','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" value="4" onchange="updOv('2A','Maths (TC)','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','Maths (TC)','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" value="3" onchange="updOv('2A','Phys-Chi (TC)','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','Phys-Chi (TC)','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" value="1.5" onchange="updOv('2A','SVT (TC)','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','SVT (TC)','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="2" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','EPS','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','EPS','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="0" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','Ens. Scientifique','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','Ens. Scientifique','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="0.5" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','EMC','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','EMC','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="0" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','Autonomie EPLE','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','Autonomie EPLE','marge',this.value)"></div></td><td style="opacity:0.6; pointer-events:none;"><div class="vertical-stack"><input class="inp-hours" type="text" value="0" oninput="updateInpHoursStyle(this)" onchange="updOv('2A','MAths','base',this.value)"><input class="inp-marge" value="0" onchange="updOv('2A','MAths','marge',this.value)"></div></td><td style="font-weight:bold;">25.0</td></tr><tr style="background:#34495e; color:white; font-weight:bold;">
            <td style="text-align:right; padding-right:10px;">TOTAL NIV.</td><td>4.0</td><td>3.0</td><td>3.0</td><td>2.5</td><td>1.5</td><td>4.0</td><td>3.0</td><td>1.5</td><td>2.0</td><td>0.0</td><td>0.5</td><td>0.0</td><td>0.0</td><td id="total-final-grille" style="font-size:1.1rem; color:#f1c40f;">25.0</td></tr></tbody></table></div></div>
        </div>
    </div>

<div id="equipes" class="section">
        <div class="card">
            <div class="card-header">
                <h3>Répartition &amp; Équipes Pédagogiques</h3>
                <div class="export-group">
                    <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel (Grille)</button>
                    <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF (Grille)</button>
                    <button class="btn-exp" style="background:#8e44ad;" onclick="exportTeamsListsPDF()">📄 PDF (Listes/Classe)</button>
                </div>
                <div style="font-size:0.8rem; color:#666; font-style:italic; display:flex; align-items:center; gap:10px;">
            <span style="display:flex; align-items:center;"><span style="width:12px; height:12px; background:#27ae60; margin-right:4px;"></span>Classe</span>
            <span style="display:flex; align-items:center; margin-left:10px;"><span style="width:12px; height:12px; background:#3498db; margin-right:4px;"></span>Partage de classe</span>
            <span style="margin-left:10px;">👑 Clic Droit = Prof Principal</span>
            <span style="color:#c0392b; font-weight:bold; margin-left:10px;">Rouge = Prof manquant</span>
        </div>
            </div>
            <div class="grid-wrapper" style="max-height: 75vh; overflow:auto;">
                <table class="team-table" id="teams-table"><thead><tr><th style="min-width:220px; text-align:left; padding-left:10px;">Matière / Enseignant</th><th style="width:45px; font-size:0.8rem;">2A</th><th style="width:45px; font-size:0.8rem;">1A</th></tr></thead><tbody><tr class="team-subject-row"><td colspan="100%">EMC</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign missing-teacher"></div></td></tr><tr class="team-subject-row"><td colspan="100%">EPS</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign missing-teacher"></div></td></tr><tr class="team-subject-row"><td colspan="100%">Ens. Scientifique</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign cell-disabled"></div></td><td><div class="cell-assign missing-teacher"></div></td></tr><tr class="team-subject-row"><td colspan="100%">Français</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign missing-teacher"></div></td></tr><tr class="team-subject-row"><td colspan="100%">Hist-Géo</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign missing-teacher"></div></td></tr><tr class="team-subject-row"><td colspan="100%">LVA</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign missing-teacher"></div></td></tr><tr class="team-subject-row"><td colspan="100%">LVB</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign missing-teacher"></div></td></tr><tr class="team-subject-row"><td colspan="100%">Maths (TC)</td></tr><tr><td class="team-teacher-label" title="Nouveau">Nouveau</td><td><div class="cell-assign missing-teacher" onclick="toggleTeamAssign('2A', 1)" oncontextmenu="toggleTeamPP(event, '2A', 1)"></div></td><td><div class="cell-assign cell-disabled"></div></td></tr><tr><td class="team-teacher-label" title="Nouveau">Nouveau</td><td><div class="cell-assign missing-teacher" onclick="toggleTeamAssign('2A', 2)" oncontextmenu="toggleTeamPP(event, '2A', 2)"></div></td><td><div class="cell-assign cell-disabled"></div></td></tr><tr><td class="team-teacher-label" title="SAUTON">SAUTON</td><td><div class="cell-assign mode-class is-pp" onclick="toggleTeamAssign('2A', 0)" oncontextmenu="toggleTeamPP(event, '2A', 0)">✅</div></td><td><div class="cell-assign cell-disabled"></div></td></tr><tr class="team-subject-row"><td colspan="100%">Phys-Chi (TC)</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign cell-disabled"></div></td></tr><tr class="team-subject-row"><td colspan="100%">SES</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign cell-disabled"></div></td></tr><tr class="team-subject-row"><td colspan="100%">SVT (TC)</td></tr><tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td><td><div class="cell-assign missing-teacher"></div></td><td><div class="cell-assign cell-disabled"></div></td></tr></tbody></table>
            </div>
        </div>
    </div>

<div id="repartition" class="section active">
    <div class="card">
        <div class="card-header">
            <h3>Répartition &amp; Ventilation des Services</h3>
            <div class="toggle-container">
    <button class="toggle-btn" id="btn-view-repart-prof" onclick="switchRepartitionView('profs')">👤 Par Enseignant</button>
    <button class="toggle-btn active" id="btn-view-repart-mat" onclick="switchRepartitionView('matieres')">📚 Par Matière</button>
</div>
            <div class="export-group">
                <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
                <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
            </div>
        </div>
        <div id="repartition-content"><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle AUTONOMIE EPLE</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                Autonomie EPLE <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle EMC</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                EMC <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.5</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.5</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">0.5</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">0.5</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle EPS</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                EPS <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">2.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">2.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">2.0</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">2.0</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                UNSS <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Forfait)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">Forfait Global</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">3.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">3.0</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle ENS. SCIENTIFIQUE</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                Ens. Scientifique <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">2.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">2.0</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle FRANÇAIS</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                Français <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">4.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">4.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">4.0</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">4.0</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle HIST-GÉO</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                Hist-Géo <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">3.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">3.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">3.0</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">3.0</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle LVA</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                LVA <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">3.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">2.5</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">3.0</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">2.5</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle LVB</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                LVB <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">2.5</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">2.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">2.5</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">2.0</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle MATHS</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                MAths <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle MATHS (TC)</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                Maths (TC) <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">4.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr>
                    <td style="text-align:left; font-weight:bold; border:1px solid #ddd; padding:8px; background:#fafafa;">Nouveau</td><td style="border:1px solid #ddd; padding:4px; background:white;">
                                <input type="number" step="0.5" placeholder="0" style="width:50px; text-align:center; border:1px solid #eee; font-weight:normal;" onchange="updateCoTeaching('2A', 1, this.value, this)" oninput="updateCoTeaching('2A', 1, this.value, this)">
                            </td><td style="border:1px solid #ddd; padding:4px; background:white;">
                                <input type="number" step="0.5" placeholder="0" style="width:50px; text-align:center; border:1px solid #eee; font-weight:normal;" onchange="updateCoTeaching('1A', 1, this.value, this)" oninput="updateCoTeaching('1A', 1, this.value, this)">
                            </td><td style="border:1px solid #ddd; padding:8px; font-weight:bold; background:#e8f0fe; color:var(--primary); text-align:center;">0.0</td>
                              <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#c0392b; text-align:center;">0.0</td>
                              <td style="border:1px solid #ddd; padding:8px; font-weight:bold; background:#f4ecf7; color:#8e44ad; text-align:center;">18.0</td>
                </tr><tr>
                    <td style="text-align:left; font-weight:bold; border:1px solid #ddd; padding:8px; background:#fafafa;">Nouveau</td><td style="border:1px solid #ddd; padding:4px; background:white;">
                                <input type="number" step="0.5" placeholder="0" style="width:50px; text-align:center; border:1px solid #eee; font-weight:normal;" onchange="updateCoTeaching('2A', 2, this.value, this)" oninput="updateCoTeaching('2A', 2, this.value, this)">
                            </td><td style="border:1px solid #ddd; padding:4px; background:white;">
                                <input type="number" step="0.5" placeholder="0" style="width:50px; text-align:center; border:1px solid #eee; font-weight:normal;" onchange="updateCoTeaching('1A', 2, this.value, this)" oninput="updateCoTeaching('1A', 2, this.value, this)">
                            </td><td style="border:1px solid #ddd; padding:8px; font-weight:bold; background:#e8f0fe; color:var(--primary); text-align:center;">0.0</td>
                              <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#c0392b; text-align:center;">0.0</td>
                              <td style="border:1px solid #ddd; padding:8px; font-weight:bold; background:#f4ecf7; color:#8e44ad; text-align:center;">18.0</td>
                </tr><tr>
                    <td style="text-align:left; font-weight:bold; border:1px solid #ddd; padding:8px; background:#fafafa;">SAUTON</td><td style="border:1px solid #ddd; padding:4px; background:#e3f2fd;">
                                <input type="number" step="0.5" value="4" placeholder="0" style="width:50px; text-align:center; border:1px solid #90caf9; font-weight:bold;" onchange="updateCoTeaching('2A', 0, this.value, this)" oninput="updateCoTeaching('2A', 0, this.value, this)">
                            </td><td style="border:1px solid #ddd; padding:4px; background:white;">
                                <input type="number" step="0.5" placeholder="0" style="width:50px; text-align:center; border:1px solid #eee; font-weight:normal;" onchange="updateCoTeaching('1A', 0, this.value, this)" oninput="updateCoTeaching('1A', 0, this.value, this)">
                            </td><td style="border:1px solid #ddd; padding:8px; font-weight:bold; background:#e8f0fe; color:var(--primary); text-align:center;">4.0</td>
                              <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#c0392b; text-align:center;">4.0</td>
                              <td style="border:1px solid #ddd; padding:8px; font-weight:bold; background:#f4ecf7; color:#8e44ad; text-align:center;">18.0</td>
                </tr><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle PHILOSOPHIE</h3></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle PHYS-CHI (TC)</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                Phys-Chi (TC) <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">3.0</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">3.0</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle SES</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                SES <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">1.5</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">1.5</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div><div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle SVT (TC)</h3><h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                SVT (TC) <small style="color:#999; font-weight:normal; font-size:0.7rem;">(Par Classe)</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    <th style="border:1px solid #ddd; padding:8px;">2A</th><th style="border:1px solid #ddd; padding:8px;">1A</th>
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr><tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    <td style="border:1px solid #ddd; padding:6px; font-weight:bold;">1.5</td><td style="border:1px solid #ddd; padding:6px; font-weight:bold;">0.0</td>
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr></thead><tbody><tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    <td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#c0392b; text-align:center;">1.5</td><td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:#27ae60; text-align:center;">OK</td>
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr></tbody></table></div></div>
    </div>
</div>

    <div id="pilotage" class="section">
    <div class="card">
        <div class="card-header">
            <h3>Ventilation &amp; Besoins</h3>
            <div class="export-group">
                <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
                <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
				            </div>
            </div>
        <div class="table-container">
            <table class="table" id="rh-table-disc">
                <thead>
                    <tr>
                        <th style="width:20%;">Discipline / Enseignant</th>
                        <th style="width:10%;">Besoin</th>
                        <th style="width:10%;">Apport</th>
                        <th style="width:10%;">Solde</th>
                    </tr>
                </thead>
                <tbody id="rh-disc-body"><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">EMC <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('EMC')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">1.0</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-1.0</td>
        </tr><tr class="row-header">
                <td style="text-align:left; padding-left:10px;">📦 PÔLE EPS</td>
                <td style="color:#f1c40f;">7.0</td>
                <td style="color:#81d4fa;">0.0</td>
                <td>0.0</td>
                <td>0.0</td>
                <td style="background:#c0392b; color:white;">-7.0</td>
            </tr><tr class="row-sub-master">
            <td style="text-align:left; display:flex; align-items:center; padding-left:20px;">↳ EPS <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('EPS')" style="">+</button></td>
            <td style="background:#fcf3cf; color:#d35400;">4.0</td>
            <td style="background:#d6eaf8; color:#2980b9;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:red">-4.0</td>
        </tr><tr class="row-sub-master">
            <td style="text-align:left; display:flex; align-items:center; padding-left:20px;">↳ UNSS <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('UNSS')" style="">+</button></td>
            <td style="background:#fcf3cf; color:#d35400;">3.0</td>
            <td style="background:#d6eaf8; color:#2980b9;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:red">-3.0</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">Ens. Scientifique <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('Ens. Scientifique')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">2.0</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-2.0</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">Français <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('Français')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">8.0</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-8.0</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">Hist-Géo <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('Hist-Géo')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">6.0</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-6.0</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">LVA <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('LVA')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">5.5</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-5.5</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">LVB <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('LVB')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">4.5</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-4.5</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">Maths (TC) <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('Maths (TC)')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">4.0</td>
            <td style="color:#81d4fa;">54.0</td>
            <td><small>54.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#2ecc71">50.0</td>
        </tr><tr class="row-detail">
                <td style="padding-left:30px; text-align:left; display:flex; align-items:center;">
                    <span style="color:#bdc3c7; margin-right:5px;">↳</span>
                    <input type="text" value="SAUTON" onchange="updT(0,'name',this.value)" style="border:none; border-bottom:1px dashed #bdc3c7; background:transparent; width:140px; color:#2c3e50; font-weight:500;" placeholder="Nom">
                    <button onclick="setBMP(0)" style="cursor:pointer; background:#34495e; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir BMP">BMP ?</button> <button onclick="setCSD(0)" style="cursor:pointer; background:#17a2b8; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir CSD">CSD ?</button>
                    <span style="font-size:0.75rem; color:#999; margin-left:5px;">(Certifié)</span>
                </td>
                <td colspan="2"></td>
                <td>
                    <input type="number" class="input-inline" value="18" step="0.5" onchange="updT(0,'ors',this.value)">
                    <div style="display:flex; flex-direction:column; align-items:center;"></div>
                </td>
                <td><input type="number" class="input-inline" value="0" step="0.5" onchange="updT(0,'hsa',this.value)"></td>
                <td style="font-weight:bold; color:#7f8c8d;">18.0</td>
            </tr><tr class="row-detail">
                <td style="padding-left:30px; text-align:left; display:flex; align-items:center;">
                    <span style="color:#bdc3c7; margin-right:5px;">↳</span>
                    <input type="text" value="Nouveau" onchange="updT(1,'name',this.value)" style="border:none; border-bottom:1px dashed #bdc3c7; background:transparent; width:140px; color:#2c3e50; font-weight:500;" placeholder="Nom">
                    <button onclick="setBMP(1)" style="cursor:pointer; background:#34495e; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir BMP">BMP ?</button> <button onclick="setCSD(1)" style="cursor:pointer; background:#17a2b8; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir CSD">CSD ?</button>
                    <span style="font-size:0.75rem; color:#999; margin-left:5px;">(Certifié)</span>
                </td>
                <td colspan="2"></td>
                <td>
                    <input type="number" class="input-inline" value="18" step="0.5" onchange="updT(1,'ors',this.value)">
                    <div style="display:flex; flex-direction:column; align-items:center;"></div>
                </td>
                <td><input type="number" class="input-inline" value="0" step="0.5" onchange="updT(1,'hsa',this.value)"></td>
                <td style="font-weight:bold; color:#7f8c8d;">18.0</td>
            </tr><tr class="row-detail">
                <td style="padding-left:30px; text-align:left; display:flex; align-items:center;">
                    <span style="color:#bdc3c7; margin-right:5px;">↳</span>
                    <input type="text" value="Nouveau" onchange="updT(2,'name',this.value)" style="border:none; border-bottom:1px dashed #bdc3c7; background:transparent; width:140px; color:#2c3e50; font-weight:500;" placeholder="Nom">
                    <button onclick="setBMP(2)" style="cursor:pointer; background:#34495e; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir BMP">BMP ?</button> <button onclick="setCSD(2)" style="cursor:pointer; background:#17a2b8; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir CSD">CSD ?</button>
                    <span style="font-size:0.75rem; color:#999; margin-left:5px;">(Certifié)</span>
                </td>
                <td colspan="2"></td>
                <td>
                    <input type="number" class="input-inline" value="18" step="0.5" onchange="updT(2,'ors',this.value)">
                    <div style="display:flex; flex-direction:column; align-items:center;"></div>
                </td>
                <td><input type="number" class="input-inline" value="0" step="0.5" onchange="updT(2,'hsa',this.value)"></td>
                <td style="font-weight:bold; color:#7f8c8d;">18.0</td>
            </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">Phys-Chi (TC) <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('Phys-Chi (TC)')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">3.0</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-3.0</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">SES <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('SES')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">1.5</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-1.5</td>
        </tr><tr class="row-header">
            <td style="text-align:left; display:flex; align-items:center; ">SVT (TC) <button class="btn-add-subject-teacher" onclick="addTeacherToSubject('SVT (TC)')" style="border:1px solid white;">+</button></td>
            <td style="color:#f1c40f;">1.5</td>
            <td style="color:#81d4fa;">0.0</td>
            <td><small>0.0</small></td>
            <td><small>0.0</small></td>
            <td style="color:#e74c3c">-1.5</td>
        </tr></tbody>
                <tfoot id="rh-disc-total" style="font-weight:bold; background:#ecf0f1;"><tr><td>TOTAUX GÉNÉRAUX</td>
        <td>44.0</td>
        <td>54.0</td>
        <td>HP:54.0</td>
        <td>HSA:0.0</td>
        <td style="background:var(--success); color:white;">10.0</td></tr></tfoot>
            </table>
        </div>
    </div>
</div>

<div id="professeurs" class="section">
    <div class="card">
        <div class="card-header">
    <h3>Liste des Professeurs</h3>
    
    <div class="export-group">
        <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
        <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
    </div>

    <div style="display:flex; gap:8px; align-items:center;">
        <button class="btn btn-sm btn-outline" id="btn-toggle-codes" onclick="toggleRhCodes()" title="Afficher/Masquer les codes matières">👁️ Codes</button>
        
        <div style="width:1px; height:20px; background:#ddd; margin:0 2px;"></div>
        
        <input type="file" id="import-rh-input-v4" accept=".csv, .xlsx, .xls" style="display:none;" onchange="importRH(this)">
        <button class="btn btn-dark btn-sm" onclick="document.getElementById('import-rh-input-v4').click()" title="Importer depuis Excel">📂 Import</button>
        
        <button class="btn btn-danger btn-sm" onclick="clearTeachers()" title="Supprimer tous les professeurs">🗑️ Vider</button>
        
        <button class="btn btn-success btn-sm" onclick="openAssignTeacherModal()" title="Assigner un enseignant depuis la liste globale">📋 Assigner</button>
    </div>
</div>
        <div class="table-container">
            <table class="table" id="rh-table-list">
                <thead>
                    <tr>
                        <th style="width:22%;">Nom</th>
                        <th class="col-code-header" style="width:5%; display:none;">Code</th>
                        <th style="width:20%;">Discipline</th>
                        <th style="width:28%;">🔀 Entités (h affectées)</th>
                        <th style="width:30%;">Actions</th>
                    </tr>
                </thead>
                <tbody id="rh-body"><tr style="">
            <td style="vertical-align:middle;"><input type="text" value="Nouveau" onchange="updT(1,'name',this.value)"></td>
            
            <td style="vertical-align:middle;"><select onchange="updT(1,'subject',this.value)"><option>Français</option><option>Philosophie</option><option>Hist-Géo</option><option>LVA</option><option>LVB</option><option>SES</option><option selected="selected">Maths (TC)</option><option>Phys-Chi (TC)</option><option>SVT (TC)</option><option>EPS</option><option>Ens. Scientifique</option><option>EMC</option><option>Autonomie EPLE</option><option>UNSS</option><option>MAths</option><option>STMG - Mercatique (Marketing)</option><option>STMG - Gestion et Finance</option><option>STMG - Ressources Humaines et Comm.</option><option>STMG - Systèmes d'Information de Gestion</option></select></td>
            <td style="vertical-align:middle;">
                <select onchange="updT(1,'status',this.value)">
                    <option selected="selected">Certifié</option>
                    <option>Agrégé</option>
                    <option>BMP/CSR</option>
                    <option>Contractuel</option>
                </select>
            </td>
            
            <td style="vertical-align:middle;">
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <input type="number" value="18" step="0.5" style="width:60px; text-align:center;" onchange="updT(1,'ors',this.value)">
                    
                </div>
            </td>
            
            <td style="vertical-align:middle;"><input type="number" value="0" step="0.5" style="width:60px" onchange="updT(1,'hsa',this.value)"></td>
            
            <td style="font-weight:bold; color:#7f8c8d; vertical-align:middle;">18.0</td>
            
            <td style="vertical-align:middle; width:220px;">
                <div style="display:flex; justify-content:center; align-items:center; gap:4px; flex-wrap:wrap;">
                     <button class="btn btn-sm" style="background:#34495e; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="setBMP(1)" title="Définir comme BMP">BMP</button> <button class="btn btn-sm" style="background:#9b59b6; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="openDechargeMenu(1)" title="Décharge">Déch.</button> <button class="btn btn-sm" style="background:#17a2b8; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="setCSD(1)" title="CSD">CSD</button>
                    <button class="btn btn-danger btn-sm" style="padding:2px 5px; margin:0; font-size:0.7rem;" onclick="delT(1)">X</button>
                </div>
            </td>
        </tr><tr style="">
            <td style="vertical-align:middle;"><input type="text" value="Nouveau" onchange="updT(2,'name',this.value)"></td>
            
            <td style="vertical-align:middle;"><select onchange="updT(2,'subject',this.value)"><option>Français</option><option>Philosophie</option><option>Hist-Géo</option><option>LVA</option><option>LVB</option><option>SES</option><option selected="selected">Maths (TC)</option><option>Phys-Chi (TC)</option><option>SVT (TC)</option><option>EPS</option><option>Ens. Scientifique</option><option>EMC</option><option>Autonomie EPLE</option><option>UNSS</option><option>MAths</option><option>STMG - Mercatique (Marketing)</option><option>STMG - Gestion et Finance</option><option>STMG - Ressources Humaines et Comm.</option><option>STMG - Systèmes d'Information de Gestion</option></select></td>
            <td style="vertical-align:middle;">
                <select onchange="updT(2,'status',this.value)">
                    <option selected="selected">Certifié</option>
                    <option>Agrégé</option>
                    <option>BMP/CSR</option>
                    <option>Contractuel</option>
                </select>
            </td>
            
            <td style="vertical-align:middle;">
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <input type="number" value="18" step="0.5" style="width:60px; text-align:center;" onchange="updT(2,'ors',this.value)">
                    
                </div>
            </td>
            
            <td style="vertical-align:middle;"><input type="number" value="0" step="0.5" style="width:60px" onchange="updT(2,'hsa',this.value)"></td>
            
            <td style="font-weight:bold; color:#7f8c8d; vertical-align:middle;">18.0</td>
            
            <td style="vertical-align:middle; width:220px;">
                <div style="display:flex; justify-content:center; align-items:center; gap:4px; flex-wrap:wrap;">
                     <button class="btn btn-sm" style="background:#34495e; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="setBMP(2)" title="Définir comme BMP">BMP</button> <button class="btn btn-sm" style="background:#9b59b6; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="openDechargeMenu(2)" title="Décharge">Déch.</button> <button class="btn btn-sm" style="background:#17a2b8; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="setCSD(2)" title="CSD">CSD</button>
                    <button class="btn btn-danger btn-sm" style="padding:2px 5px; margin:0; font-size:0.7rem;" onclick="delT(2)">X</button>
                </div>
            </td>
        </tr><tr style="">
            <td style="vertical-align:middle;"><input type="text" value="SAUTON" onchange="updT(0,'name',this.value)"></td>
            
            <td style="vertical-align:middle;"><select onchange="updT(0,'subject',this.value)"><option>Français</option><option>Philosophie</option><option>Hist-Géo</option><option>LVA</option><option>LVB</option><option>SES</option><option selected="selected">Maths (TC)</option><option>Phys-Chi (TC)</option><option>SVT (TC)</option><option>EPS</option><option>Ens. Scientifique</option><option>EMC</option><option>Autonomie EPLE</option><option>UNSS</option><option>MAths</option><option>STMG - Mercatique (Marketing)</option><option>STMG - Gestion et Finance</option><option>STMG - Ressources Humaines et Comm.</option><option>STMG - Systèmes d'Information de Gestion</option></select></td>
            <td style="vertical-align:middle;">
                <select onchange="updT(0,'status',this.value)">
                    <option selected="selected">Certifié</option>
                    <option>Agrégé</option>
                    <option>BMP/CSR</option>
                    <option>Contractuel</option>
                </select>
            </td>
            
            <td style="vertical-align:middle;">
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <input type="number" value="18" step="0.5" style="width:60px; text-align:center;" onchange="updT(0,'ors',this.value)">
                    
                </div>
            </td>
            
            <td style="vertical-align:middle;"><input type="number" value="0" step="0.5" style="width:60px" onchange="updT(0,'hsa',this.value)"></td>
            
            <td style="font-weight:bold; color:#7f8c8d; vertical-align:middle;">18.0</td>
            
            <td style="vertical-align:middle; width:220px;">
                <div style="display:flex; justify-content:center; align-items:center; gap:4px; flex-wrap:wrap;">
                     <button class="btn btn-sm" style="background:#34495e; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="setBMP(0)" title="Définir comme BMP">BMP</button> <button class="btn btn-sm" style="background:#9b59b6; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="openDechargeMenu(0)" title="Décharge">Déch.</button> <button class="btn btn-sm" style="background:#17a2b8; color:white; padding:2px 5px; margin:0; font-size:0.7rem;" onclick="setCSD(0)" title="CSD">CSD</button>
                    <button class="btn btn-danger btn-sm" style="padding:2px 5px; margin:0; font-size:0.7rem;" onclick="delT(0)">X</button>
                </div>
            </td>
        </tr></tbody>
            </table>
        </div>
    </div>
</div>

<div id="eds" class="section">
    <div class="card">
        <div class="card-header">
            <h3>Pilotage des Spécialités (EDS)</h3>
            <div class="export-group">
                <button class="btn btn-purple btn-sm" onclick="transferEDS('premiere', 'terminale')">🚀 Basculer 1ère ➔ Term</button>
                <button class="btn btn-dark btn-sm" onclick="transferEDS('terminale', 'premiere')">↩️ Basculer Term ➔ 1ère</button>
            </div>
        </div>
        
        <div class="card" style="border-top: 5px solid var(--secondary); background: #fdfefe; margin-bottom: 30px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4 style="margin:0; color:var(--secondary);">Niveau PREMIÈRE</h4>
                <div style="background:var(--secondary); color:white; padding:5px 15px; border-radius:20px; font-weight:bold;">
                    Total Niveau : <span id="total-eds-1ere">0.0</span> h
                </div>
            </div>
            
            <table class="table-eds">
                <thead>
                    <tr>
                    <tr>
                        <th style="text-align:left; width:22%;">Spécialité</th>
                        <th style="width:8%;">Effectif</th>
                        <th style="width:8%;">Groupes</th>
                        <th style="width:8%;">H / Gr.</th>
                        <th title="Coefficient de pondération appliqué aux heures EDS dans le calcul du besoin DHG" style="width:7%; color:#8e44ad; cursor:help;">Pond. ✱</th>
                        <th style="width:8%;">Él. / Gr.</th>
                        <th style="width:9%;">Coût H/Él.</th>
                        <th style="width:22%; color:#8e44ad;">👤 Enseignant(s)</th>
                        <th style="width:5%;"></th>
                    </tr>
                </thead>
                <tbody id="eds-full-1ere"><tr><td colspan="7" class="eds-cat-header">EDS TECHNOLOGIQUES</td></tr>
                    <tr>
                        <td style="text-align:left; font-weight:bold; font-size:0.9rem;">
                            <span class="badge-cat">TECH</span>STMG - Gestion et Finance
                        </td>
                        <td><input type="number" value="0" class="input-inline-eds" onchange="updEDS('premiere', 1, 'students', this.value)"></td>
                        <td><input type="number" value="0" class="input-inline-eds" style="border-color:var(--secondary)" onchange="updEDS('premiere', 1, 'groups', this.value)"></td>
                        <td><input type="number" value="4" class="input-inline-eds" style="border-color:var(--accent)" onchange="updEDS('premiere', 1, 'hPerGroup', this.value)"></td>
                        <td class="text-warning" style="font-weight:bold; font-size:1.1rem;">0</td>
                        <td><span class="cost-badge">0 h/él.</span></td>
                        <td><button onclick="delEDS('premiere', 1)" style="border:none; background:none; color:#c0392b; cursor:pointer; font-size:1.2rem;">×</button></td>
                    </tr>
                
                    <tr>
                        <td style="text-align:left; font-weight:bold; font-size:0.9rem;">
                            <span class="badge-cat">TECH</span>STMG - Mercatique (Marketing)
                        </td>
                        <td><input type="number" value="0" class="input-inline-eds" onchange="updEDS('premiere', 0, 'students', this.value)"></td>
                        <td><input type="number" value="0" class="input-inline-eds" style="border-color:var(--secondary)" onchange="updEDS('premiere', 0, 'groups', this.value)"></td>
                        <td><input type="number" value="4" class="input-inline-eds" style="border-color:var(--accent)" onchange="updEDS('premiere', 0, 'hPerGroup', this.value)"></td>
                        <td class="text-warning" style="font-weight:bold; font-size:1.1rem;">0</td>
                        <td><span class="cost-badge">0 h/él.</span></td>
                        <td><button onclick="delEDS('premiere', 0)" style="border:none; background:none; color:#c0392b; cursor:pointer; font-size:1.2rem;">×</button></td>
                    </tr>
                
                    <tr>
                        <td style="text-align:left; font-weight:bold; font-size:0.9rem;">
                            <span class="badge-cat">TECH</span>STMG - Ressources Humaines et Comm.
                        </td>
                        <td><input type="number" value="0" class="input-inline-eds" onchange="updEDS('premiere', 2, 'students', this.value)"></td>
                        <td><input type="number" value="0" class="input-inline-eds" style="border-color:var(--secondary)" onchange="updEDS('premiere', 2, 'groups', this.value)"></td>
                        <td><input type="number" value="4" class="input-inline-eds" style="border-color:var(--accent)" onchange="updEDS('premiere', 2, 'hPerGroup', this.value)"></td>
                        <td class="text-warning" style="font-weight:bold; font-size:1.1rem;">0</td>
                        <td><span class="cost-badge">0 h/él.</span></td>
                        <td><button onclick="delEDS('premiere', 2)" style="border:none; background:none; color:#c0392b; cursor:pointer; font-size:1.2rem;">×</button></td>
                    </tr>
                
                    <tr>
                        <td style="text-align:left; font-weight:bold; font-size:0.9rem;">
                            <span class="badge-cat">TECH</span>STMG - Systèmes d'Information de Gestion
                        </td>
                        <td><input type="number" value="0" class="input-inline-eds" onchange="updEDS('premiere', 3, 'students', this.value)"></td>
                        <td><input type="number" value="0" class="input-inline-eds" style="border-color:var(--secondary)" onchange="updEDS('premiere', 3, 'groups', this.value)"></td>
                        <td><input type="number" value="4" class="input-inline-eds" style="border-color:var(--accent)" onchange="updEDS('premiere', 3, 'hPerGroup', this.value)"></td>
                        <td class="text-warning" style="font-weight:bold; font-size:1.1rem;">0</td>
                        <td><span class="cost-badge">0 h/él.</span></td>
                        <td><button onclick="delEDS('premiere', 3)" style="border:none; background:none; color:#c0392b; cursor:pointer; font-size:1.2rem;">×</button></td>
                    </tr>
                </tbody>
            </table>
            <button class="btn btn-primary" style="width:100%;" onclick="addEDS('premiere')">➕ Configurer les EDS de Première</button>
        </div>

        <div class="card" style="border-top: 5px solid var(--accent); background: #fdfefe;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4 style="margin:0; color:var(--accent);">Niveau TERMINALE</h4>
                <div style="background:var(--accent); color:white; padding:5px 15px; border-radius:20px; font-weight:bold;">
                    Total Niveau : <span id="total-eds-term">0.0</span> h
                </div>
            </div>
            
            <table class="table-eds">
                <thead>
                    <tr>
                    <tr>
                        <th style="text-align:left; width:22%;">Spécialité</th>
                        <th style="width:8%;">Effectif</th>
                        <th style="width:8%;">Groupes</th>
                        <th style="width:8%;">H / Gr.</th>
                        <th title="Coefficient de pondération appliqué aux heures EDS dans le calcul du besoin DHG" style="width:7%; color:#8e44ad; cursor:help;">Pond. ✱</th>
                        <th style="width:8%;">Él. / Gr.</th>
                        <th style="width:9%;">Coût H/Él.</th>
                        <th style="width:22%; color:#8e44ad;">👤 Enseignant(s)</th>
                        <th style="width:5%;"></th>
                    </tr>
                </thead>
                <tbody id="eds-full-term"></tbody>
            </table>
            <button class="btn btn-warning" style="width:100%;" onclick="addEDS('terminale')">➕ Configurer les EDS de Terminale</button>
        </div>

        <!-- RÉCAPITULATIF ENSEIGNANTS EDS -->
        <div class="card" style="border-top:5px solid #8e44ad; background:#fdfefe; margin-top:10px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4 style="margin:0; color:#8e44ad;">👤 Récapitulatif – Enseignants EDS</h4>
                <button class="btn btn-sm" style="background:#8e44ad;color:white;" onclick="renderEDSTeacherSummary()">🔄 Actualiser</button>
            </div>
            <div id="eds-teacher-summary" style="font-size:0.88rem;">
                <em style="color:#aaa;">Cliquez sur "Actualiser" pour voir la liste des enseignants assignés.</em>
            </div>
        </div>
    </div>
</div>

    <div id="matieres" class="section">
        <div class="card">
            <div class="card-header">
                <h3>Matières &amp; Modalités</h3>
                <div class="export-group">
                    <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
                    <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
                </div>
                <button class="btn btn-primary btn-sm" onclick="addSubject()">➕ Nouvelle Matière</button>
                <button class="btn btn-sm" onclick="addGroupSubject()" style="background:#8e44ad; color:white; margin-left:6px;">📂 Nouvelle Sur-Matière</button>
                <button class="btn btn-sm" style="background:#8e44ad; color:white;" onclick="openSubjectCatalog()">📚 Catalogue PNE</button>
                <button class="btn btn-sm" style="background:#1abc9c; color:white;" onclick="openCopySubjectsModal()">🔀 Copier vers...</button>
            </div>
            <table id="subjects-table">
                <thead><tr>
    <th style="width:80px;">Code</th>
    <th style="text-align:left;">Matière (Éditable)</th>
    <th style="width:100px; background:#f0e6ff; color:#6c3483;" title="Code discipline académique PNE Aix-Marseille">Code PNE<br><small>Bureau</small></th>
    <th style="width:180px;">Rattaché à (Parent)</th>
<th style="width:200px;">Disciplines Associées<br><small>(Co-intervention)</small></th>
	<th style="width:160px;">Modalités</th>
    <th style="text-align:left;">Paramètres (Niveaux / Volumes)</th>
    <th>Actions</th>
</tr></thead>
                <tbody id="subjects-body"><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('Autonomie EPLE','code',this.value)"></td>
            <td><input type="text" value="Autonomie EPLE" style="font-weight:bold;" onchange="renameSubject('Autonomie EPLE',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('Autonomie EPLE','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('Autonomie EPLE')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('Autonomie EPLE','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Autonomie EPLE','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Autonomie EPLE','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Autonomie EPLE','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('Autonomie EPLE')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('EMC','code',this.value)"></td>
            <td><input type="text" value="EMC" style="font-weight:bold;" onchange="renameSubject('EMC',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('EMC','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('EMC')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('EMC','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('EMC','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('EMC','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('EMC','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('EMC')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('EPS','code',this.value)"></td>
            <td><input type="text" value="EPS" style="font-weight:bold;" onchange="renameSubject('EPS',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('EPS','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('EPS')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('EPS','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('EPS','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('EPS','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('EPS','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('EPS')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('Ens. Scientifique','code',this.value)"></td>
            <td><input type="text" value="Ens. Scientifique" style="font-weight:bold;" onchange="renameSubject('Ens. Scientifique',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('Ens. Scientifique','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('Ens. Scientifique')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('Ens. Scientifique','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Ens. Scientifique','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Ens. Scientifique','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Ens. Scientifique','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('Ens. Scientifique')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('Français','code',this.value)"></td>
            <td><input type="text" value="Français" style="font-weight:bold;" onchange="renameSubject('Français',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('Français','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('Français')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('Français','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Français','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Français','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Français','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('Français')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('Hist-Géo','code',this.value)"></td>
            <td><input type="text" value="Hist-Géo" style="font-weight:bold;" onchange="renameSubject('Hist-Géo',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('Hist-Géo','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('Hist-Géo')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('Hist-Géo','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Hist-Géo','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Hist-Géo','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Hist-Géo','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('Hist-Géo')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('LVA','code',this.value)"></td>
            <td><input type="text" value="LVA" style="font-weight:bold;" onchange="renameSubject('LVA',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('LVA','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('LVA')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('LVA','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('LVA','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('LVA','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('LVA','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('LVA')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('LVB','code',this.value)"></td>
            <td><input type="text" value="LVB" style="font-weight:bold;" onchange="renameSubject('LVB',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('LVB','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('LVB')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('LVB','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('LVB','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('LVB','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('LVB','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('LVB')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('MAths','code',this.value)"></td>
            <td><input type="text" value="MAths" style="font-weight:bold;" onchange="renameSubject('MAths',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('MAths','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('MAths')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('MAths','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('MAths','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('MAths','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('MAths','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('MAths')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('Maths (TC)','code',this.value)"></td>
            <td><input type="text" value="Maths (TC)" style="font-weight:bold;" onchange="renameSubject('Maths (TC)',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('Maths (TC)','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('Maths (TC)')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('Maths (TC)','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Maths (TC)','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Maths (TC)','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Maths (TC)','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('Maths (TC)')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('Philosophie','code',this.value)"></td>
            <td><input type="text" value="Philosophie" style="font-weight:bold;" onchange="renameSubject('Philosophie',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('Philosophie','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('Philosophie')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('Philosophie','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" onchange="toggleSubLevel('Philosophie','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" onchange="toggleSubLevel('Philosophie','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Philosophie','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('Philosophie')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('Phys-Chi (TC)','code',this.value)"></td>
            <td><input type="text" value="Phys-Chi (TC)" style="font-weight:bold;" onchange="renameSubject('Phys-Chi (TC)',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('Phys-Chi (TC)','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('Phys-Chi (TC)')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('Phys-Chi (TC)','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Phys-Chi (TC)','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Phys-Chi (TC)','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('Phys-Chi (TC)','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('Phys-Chi (TC)')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('SES','code',this.value)"></td>
            <td><input type="text" value="SES" style="font-weight:bold;" onchange="renameSubject('SES',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('SES','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('SES')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('SES','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('SES','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('SES','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('SES','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('SES')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" value="EDS" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('STMG - Gestion et Finance','code',this.value)"></td>
            <td><input type="text" value="STMG - Gestion et Finance" style="font-weight:bold;" onchange="renameSubject('STMG - Gestion et Finance',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('STMG - Gestion et Finance','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('STMG - Gestion et Finance')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('STMG - Gestion et Finance','mode',this.value)">
                    <option value="div">Division</option>
                    <option value="level" selected="selected">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div style="display:flex; flex-wrap:wrap; gap:8px;"><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">2nde:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Gestion et Finance','2nde',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">1ère:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Gestion et Finance','1ère',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">Terminale:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Gestion et Finance','Terminale',this.value)"></div></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('STMG - Gestion et Finance')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" value="EDS" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('STMG - Mercatique (Marketing)','code',this.value)"></td>
            <td><input type="text" value="STMG - Mercatique (Marketing)" style="font-weight:bold;" onchange="renameSubject('STMG - Mercatique (Marketing)',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('STMG - Mercatique (Marketing)','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('STMG - Mercatique (Marketing)')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('STMG - Mercatique (Marketing)','mode',this.value)">
                    <option value="div">Division</option>
                    <option value="level" selected="selected">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div style="display:flex; flex-wrap:wrap; gap:8px;"><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">2nde:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Mercatique (Marketing)','2nde',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">1ère:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Mercatique (Marketing)','1ère',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">Terminale:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Mercatique (Marketing)','Terminale',this.value)"></div></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('STMG - Mercatique (Marketing)')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" value="EDS" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('STMG - Ressources Humaines et Comm.','code',this.value)"></td>
            <td><input type="text" value="STMG - Ressources Humaines et Comm." style="font-weight:bold;" onchange="renameSubject('STMG - Ressources Humaines et Comm.',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('STMG - Ressources Humaines et Comm.','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('STMG - Ressources Humaines et Comm.')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('STMG - Ressources Humaines et Comm.','mode',this.value)">
                    <option value="div">Division</option>
                    <option value="level" selected="selected">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div style="display:flex; flex-wrap:wrap; gap:8px;"><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">2nde:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Ressources Humaines et Comm.','2nde',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">1ère:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Ressources Humaines et Comm.','1ère',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">Terminale:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Ressources Humaines et Comm.','Terminale',this.value)"></div></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('STMG - Ressources Humaines et Comm.')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" value="EDS" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('STMG - Systèmes d\'Information de Gestion','code',this.value)"></td>
            <td><input type="text" value="STMG - Systèmes d'Information de Gestion" style="font-weight:bold;" onchange="renameSubject('STMG - Systèmes d\'Information de Gestion',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('STMG - Systèmes d\'Information de Gestion','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="SVT (TC)">SVT (TC)</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('STMG - Systèmes d\'Information de Gestion')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('STMG - Systèmes d\'Information de Gestion','mode',this.value)">
                    <option value="div">Division</option>
                    <option value="level" selected="selected">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div style="display:flex; flex-wrap:wrap; gap:8px;"><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">2nde:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Systèmes d\'Information de Gestion','2nde',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">1ère:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Systèmes d\'Information de Gestion','1ère',this.value)"></div><div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">Terminale:</span><input type="number" step="0.5" value="0" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('STMG - Systèmes d\'Information de Gestion','Terminale',this.value)"></div></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('STMG - Systèmes d\'Information de Gestion')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('SVT (TC)','code',this.value)"></td>
            <td><input type="text" value="SVT (TC)" style="font-weight:bold;" onchange="renameSubject('SVT (TC)',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('SVT (TC)','parent',this.value)"><option value="" selected="selected">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="UNSS">UNSS</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('SVT (TC)')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('SVT (TC)','mode',this.value)">
                    <option value="div" selected="selected">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-check-container"><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('SVT (TC)','2nde')">2nde</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('SVT (TC)','1ère')">1ère</label><label class="lvl-check-item"><input type="checkbox" checked="checked" onchange="toggleSubLevel('SVT (TC)','Terminale')">Terminale</label></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('SVT (TC)')">×</button></td>
        </tr><tr>
            <td style="width:80px;"><input type="text" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('UNSS','code',this.value)"></td>
            <td><input type="text" value="UNSS" style="font-weight:bold;" onchange="renameSubject('UNSS',this.value)"></td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('UNSS','parent',this.value)"><option value="">(Aucun - Racine)</option><option value="Autonomie EPLE">Autonomie EPLE</option><option value="EMC">EMC</option><option value="EPS" selected="selected">EPS</option><option value="Ens. Scientifique">Ens. Scientifique</option><option value="Français">Français</option><option value="Hist-Géo">Hist-Géo</option><option value="LVA">LVA</option><option value="LVB">LVB</option><option value="MAths">MAths</option><option value="Maths (TC)">Maths (TC)</option><option value="Philosophie">Philosophie</option><option value="Phys-Chi (TC)">Phys-Chi (TC)</option><option value="SES">SES</option><option value="STMG - Gestion et Finance">STMG - Gestion et Finance</option><option value="STMG - Mercatique (Marketing)">STMG - Mercatique (Marketing)</option><option value="STMG - Ressources Humaines et Comm.">STMG - Ressources Humaines et Comm.</option><option value="STMG - Systèmes d'Information de Gestion">STMG - Systèmes d'Information de Gestion</option><option value="SVT (TC)">SVT (TC)</option></select></td>
            
            <td style="width:140px; text-align:center;">
            <button class="btn btn-sm" style="background:white; color:#7f8c8d; border:1px solid #bdc3c7; width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('UNSS')">
                <span>🔗 Gérer</span>
                <span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">0</span>
            </button>
        </td>

            <td style="width:160px;">
                <select onchange="updateSubjectMeta('UNSS','mode',this.value)">
                    <option value="div">Division</option>
                    <option value="level">Niveau</option>
                    <option value="etab" selected="selected">Établissement</option>
                </select>
            </td>
            <td style="text-align:left;"><div class="lvl-input-item"><span style="font-weight:bold; color:#16a085;">Forfait :</span><input type="number" step="0.5" value="3" style="width:80px !important; text-align:center; font-weight:bold; color:#16a085; border:2px solid #1abc9c; margin-left: 10px;" onchange="updSubEtab('UNSS',this.value)"></div></td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('UNSS')">×</button></td>
        </tr></tbody>
            </table>
        </div>
    </div>

    <div id="recap" class="section">
        <div class="card">
            <div class="card-header">
                <h3>Bilan &amp; Export</h3>
                <div class="export-group">
                    <button class="btn-exp" onclick="exportCurrentPage('excel')">📊 Excel</button>
                    <button class="btn-exp" onclick="exportCurrentPage('pdf')">📄 PDF</button>
					<button class="btn-exp" style="background:#e67e22;" onclick="generateCAPres()">📽️ Diaporama CA (.pptx)</button>
                </div>
            </div>
          <table id="recap-table" style="width:100%; table-layout: fixed;">
    <thead>
        <tr>
            <th style="text-align:left; width: 250px;">Discipline</th>
            
            <th style="background:#fdedec; color:#c0392b; width:70px;">Besoin</th>
            <th style="background:#e8f6f3; color:#16a085; width:70px;">Apport</th>
            <th style="width:70px;">Écart</th>
            
            <th>Commentaires</th>
        </tr>
    </thead>
    <tbody id="recap-body"><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">EMC </td>
                <td style="font-weight:bold; color:#f1c40f;">1.0</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-1.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('EMC',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header">
                    <td style="text-align:left; font-weight:bold;">📦 PÔLE EPS</td>
                    <td style="font-weight:bold; color:#f1c40f;">7.0</td>
                    <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                    <td>0.0</td>
                    <td>0.0</td>
                    <td style="font-weight:bold; background:#c0392b; color:white;">-7.0</td>
                    <td></td>
                </tr><tr class="" style="background:#f9f9f9;">
                <td style="text-align:left; font-weight:bold; padding-left:20px;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">↳ EPS </td>
                <td style="font-weight:bold; color:#c0392b;">4.0</td>
                <td style="font-weight:bold; color:#16a085;">0.0</td>
                                <td style="font-weight:bold; color:red;">-4.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('EPS',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #ccc; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="" style="background:#f9f9f9;">
                <td style="text-align:left; font-weight:bold; padding-left:20px;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">↳ UNSS </td>
                <td style="font-weight:bold; color:#c0392b;">3.0</td>
                <td style="font-weight:bold; color:#16a085;">0.0</td>
                                <td style="font-weight:bold; color:red;">-3.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('UNSS',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #ccc; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">Ens. Scientifique </td>
                <td style="font-weight:bold; color:#f1c40f;">2.0</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-2.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('Ens. Scientifique',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">Français </td>
                <td style="font-weight:bold; color:#f1c40f;">8.0</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-8.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('Français',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">Hist-Géo </td>
                <td style="font-weight:bold; color:#f1c40f;">6.0</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-6.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('Hist-Géo',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">LVA </td>
                <td style="font-weight:bold; color:#f1c40f;">5.5</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-5.5</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('LVA',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">LVB </td>
                <td style="font-weight:bold; color:#f1c40f;">4.5</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-4.5</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('LVB',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">Maths (TC) </td>
                <td style="font-weight:bold; color:#f1c40f;">4.0</td>
                <td style="font-weight:bold; color:#81d4fa;">54.0</td>
                <td>54.0</td> 
                <td>0.0</td>
                <td style="font-weight:bold; color:#2ecc71;">50.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('Maths (TC)',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">Phys-Chi (TC) </td>
                <td style="font-weight:bold; color:#f1c40f;">3.0</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-3.0</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('Phys-Chi (TC)',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">SES </td>
                <td style="font-weight:bold; color:#f1c40f;">1.5</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-1.5</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('SES',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr><tr class="row-header" style="">
                <td style="text-align:left; font-weight:bold;; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">SVT (TC) </td>
                <td style="font-weight:bold; color:#f1c40f;">1.5</td>
                <td style="font-weight:bold; color:#81d4fa;">0.0</td>
                                <td style="font-weight:bold; color:#e74c3c;">-1.5</td>
                <td style="padding:4px; vertical-align:middle;">
                    <input class="input-comment" onchange="updComment('SVT (TC)',this.value)" style="width:100%; box-sizing:border-box; border:1px solid #78909c; padding:4px; color:black;" placeholder="Autre commentaire...">
                </td>
            </tr></tbody>
    <tfoot id="recap-total" style="background:#ecf0f1; font-weight:bold;">
            <tr><td style="text-align:right;">TOTAL GÉNÉRAL</td>
            <td style="color:#c0392b; font-size:1.1rem;">44.0</td>
            <td style="color:#16a085; font-size:1.1rem;">54.0</td>
            <td>54.0</td>
            <td>0.0</td>
            <td style="color:green; font-size:1.1rem;">10.0</td>
            <td></td></tr></tfoot>
</table>
        </div>
    </div>

</div>
<!-- ====================================================== -->
<!-- SECTION BILAN CONSOLIDÉ (MULTI-ENTITÉS)               -->
<!-- ====================================================== -->
<div id="bilan-global" class="section" style="overflow-y:auto; max-height:calc(100vh - 60px); padding-right:4px;">
    <div class="card">
        <div class="card-header">
            <h3>🌐 Bilan Consolidé</h3>
            <div class="export-group">
                <button class="btn-exp" onclick="exportBilanGlobal('excel')">📊 Excel</button>
                <button class="btn-exp" onclick="exportBilanGlobal('pdf')">📄 PDF</button>
            </div>
        </div>

        <!-- KPI GLOBAUX -->
        <div id="bilan-kpi" style="display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:20px;"></div>

        <!-- TABLEAU PAR ENTITÉ -->
        <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:25px;" id="bilan-cards"></div>

        <!-- TABLEAU CONSOLIDÉ PAR BUREAU PNE -->
        <div class="card" style="margin-bottom:0; border:1px solid #e0e0e0;">
            <div class="card-header"><h3>📋 Consolidé par Bureau de Discipline (PNE)</h3></div>
            <div style="overflow-x:auto; max-height:400px; overflow-y:auto;">
                <table id="bilan-bureau-table" style="width:100%; border-collapse:collapse; font-size:0.88rem;">
                    <thead>
                        <tr style="background:#2c3e50; color:white;">
                            <th style="padding:10px; text-align:left; width:260px; position:sticky; top:0; z-index:2; background:#2c3e50;">Bureau / Discipline</th>
                            <th style="padding:10px; background:#1a252f; width:110px;">🏫 Collège</th>
                            <th style="padding:10px; background:#1a252f; width:110px;">🏛️ Lycée</th>
                            <th style="padding:10px; background:#1a252f; width:110px;">🏭 Lycée Pro</th>
                            <th style="padding:10px; background:#1a252f; width:110px;">🎓 Pôle Sup.</th>
                            <th style="padding:10px; background:#c0392b; width:90px;">Total Besoin</th>
                            <th style="padding:10px; background:#16a085; width:90px;">Total Apport</th>
                            <th style="padding:10px; background:#7f8c8d; width:80px;">Écart</th>
                        </tr>
                    </thead>
                    <tbody id="bilan-bureau-body"></tbody>
                </table>
            </div>
        </div>

        <!-- TABLEAU ENSEIGNANTS × ENTITÉS -->
        <div class="card" style="margin-top:20px; border:1px solid #e0e0e0;">
            <div class="card-header">
                <h3>👥 Tableau de Service – Enseignants × Entités</h3>
                <small style="color:#7f8c8d;">Tous les enseignants des 3 entités</small>
            </div>
            <div style="display:flex; gap:10px; align-items:center; margin-bottom:12px; flex-wrap:wrap;">
                <input type="text" id="bilan-teacher-filter" placeholder="🔍 Filtrer par nom..." oninput="renderBilanTeachers()" style="width:220px;">
                <select id="bilan-teacher-entity-filter" onchange="renderBilanTeachers()" style="width:180px;">
                    <option value="">Toutes les entités</option>
                    <option value="college">🏫 Collège</option>
                    <option value="lycee">🏛️ Lycée</option>
                    <option value="lycee_pro">🏭 Lycée Pro</option>
                    <option value="pole">🎓 Pôle</option>
                    <option value="shared">🔀 Multi-entités</option>
                </select>
            </div>
            <div style="overflow-x:auto; max-height:400px; overflow-y:auto;">
                <table style="width:100%; border-collapse:collapse; font-size:0.85rem;">
                    <thead>
                        <tr style="background:#2c3e50; color:white; position:sticky; top:0; z-index:2;">
                            <th style="padding:8px 10px; text-align:left; min-width:160px; background:#2c3e50;">Enseignant</th>
                            <th style="padding:8px; min-width:140px;">Discipline</th>
                            <th style="padding:8px; width:70px;">ORS</th>
                            <th style="padding:8px; width:100px; background:#2980b9;">🏫 Collège</th>
                            <th style="padding:8px; width:100px; background:#1e8449;">🏛️ Lycée</th>
                            <th style="padding:8px; width:100px; background:#d35400;">🏭 Lycée Pro</th>
                            <th style="padding:8px; width:100px; background:#6c3483;">🎓 Pôle</th>
                            <th style="padding:8px; width:90px; background:#c0392b;">Total h</th>
                            <th style="padding:8px; width:90px; background:#7f8c8d;">Solde ORS</th>
                            <th style="padding:8px; width:70px;">Type</th>
                        </tr>
                    </thead>
                    <tbody id="bilan-teachers-body"></tbody>
                </table>
            </div>
        </div>

        <!-- RÉCAP MATIÈRES CROSS-ENTITÉS -->
        <div class="card" style="margin-top:20px; border:1px solid #e0e0e0;">
            <div class="card-header">
                <h3>📚 Récapitulatif Matières – 3 Entités</h3>
                <small style="color:#7f8c8d;">Besoin en heures par matière et par entité</small>
            </div>
            <div style="overflow-x:auto;">
                <table style="width:100%; border-collapse:collapse; font-size:0.85rem;">
                    <thead>
                        <tr style="background:#2c3e50; color:white;">
                            <th style="padding:8px 10px; text-align:left; min-width:200px;">Matière</th>
                            <th style="padding:8px; width:100px; background:#2980b9;">🏫 Besoin Col.</th>
                            <th style="padding:8px; width:100px; background:#2980b9;">🏫 Apport Col.</th>
                            <th style="padding:8px; width:100px; background:#1e8449;">🏛️ Besoin Lyc.</th>
                            <th style="padding:8px; width:100px; background:#1e8449;">🏛️ Apport Lyc.</th>
                            <th style="padding:8px; width:100px; background:#d35400;">🏭 Besoin LP</th>
                            <th style="padding:8px; width:100px; background:#d35400;">🏭 Apport LP</th>
                            <th style="padding:8px; width:100px; background:#6c3483;">🎓 Besoin Pôle</th>
                            <th style="padding:8px; width:100px; background:#6c3483;">🎓 Apport Pôle</th>
                            <th style="padding:8px; width:90px; background:#c0392b;">Total Besoin</th>
                            <th style="padding:8px; width:90px; background:#16a085;">Total Apport</th>
                            <th style="padding:8px; width:80px; background:#7f8c8d;">Écart</th>
                        </tr>
                    </thead>
                    <tbody id="bilan-subjects-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ====================================================== -->
<!-- SECTION ENSEIGNANTS                                    -->
<!-- ====================================================== -->
<div id="enseignants-mutualises" class="section">
    <div class="card">
        <div class="card-header">
            <h3>👥 Enseignants</h3>
            <div style="font-size:0.85rem; color:#7f8c8d;">Enseignants intervenant sur plusieurs entités</div>
            <button class="btn btn-success btn-sm" onclick="openAddSharedTeacher()">➕ Ajouter un enseignant</button>
        </div>

        <!-- FILTRES -->
        <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px; flex-wrap:wrap;">
            <label style="font-weight:600; color:#555;">Filtrer :</label>
            <select id="filter-grade" onchange="renderSharedTeachers()" style="width:220px;">
                <option value="">Tous les grades</option>
                <option value="Agrégé">Agrégé</option>
                <option value="Certifié">Certifié</option>
                <option value="PLP">PLP</option>
                <option value="CAPEPS">CAPEPS</option>
                <option value="Agrégé EPS">Agrégé EPS</option>
                <option value="PEGC">PEGC</option>
                <option value="PCS">PCS</option>
                <option value="CPE">CPE</option>
                <option value="Contractuel">Contractuel</option>
                <option value="Vacataire">Vacataire</option>
                <option value="PRAG">PRAG</option>
                <option value="Maître de conférences">MCF</option>
                <option value="BMP/CSR">BMP/CSR</option>
            </select>
            <select id="filter-entity" onchange="renderSharedTeachers()" style="width:180px;">
                <option value="">Toutes les entités</option>
                <option value="college">🏫 Collège</option>
                <option value="lycee">🏛️ Lycée</option>
                <option value="lycee_pro">🏭 Lycée Pro</option>
                <option value="pole">🎓 Pôle Supérieur</option>
            </select>
            <input type="text" id="filter-teacher-name" placeholder="🔍 Recherche nom..." oninput="renderSharedTeachers()" style="width:200px;">
        </div>

        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; font-size:0.88rem;">
                <thead>
                    <tr style="background:#2c3e50; color:white;">
                        <th style="padding:9px 8px; text-align:left;">Enseignant</th>
                        <th style="padding:9px 8px; text-align:left; width:130px;">Grade</th>
                        <th style="padding:9px 8px; text-align:left; width:180px;">Discipline</th>
                        <th style="padding:9px 8px; width:110px;">Code PNE</th>
                        <th style="padding:9px 8px; width:80px; background:#2980b9;">ORS</th>
                        <th style="padding:9px 8px; width:90px; background:#1a6985;">🏫 Collège</th>
                        <th style="padding:9px 8px; width:90px; background:#1a6985;">🏛️ Lycée</th>
                        <th style="padding:9px 8px; width:90px; background:#c25a00;">🏭 Lycée Pro</th>
                        <th style="padding:9px 8px; width:90px; background:#1a6985;">🎓 Pôle</th>
                        <th style="padding:9px 8px; width:80px; background:#c0392b;">Total h</th>
                        <th style="padding:9px 8px; width:80px; background:#7f8c8d;">Reste</th>
                        <th style="padding:9px 8px; width:70px;">Actions</th>
                    </tr>
                </thead>
                <tbody id="shared-teachers-body"></tbody>
            </table>
        </div>
        <div id="shared-teachers-empty" style="display:none; text-align:center; color:#aaa; padding:30px; font-style:italic;">
            Aucun enseignant pour l'instant. Cliquez sur "Ajouter" pour en créer un.
        </div>
    </div>
</div>

<!-- MODAL CATALOGUE MATIÈRES PNE -->
<div id="subject-catalog-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:20000; justify-content:center; align-items:center;">
    <div style="background:white; padding:24px; border-radius:10px; width:700px; max-width:96%; max-height:88vh; display:flex; flex-direction:column; box-shadow:0 10px 30px rgba(0,0,0,0.3);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:2px solid #eee; padding-bottom:12px;">
            <h3 style="margin:0; color:#8e44ad;">📚 Catalogue des Disciplines PNE</h3>
            <button onclick="document.getElementById('subject-catalog-overlay').style.display='none'" style="background:none;border:none;font-size:1.4rem;cursor:pointer;color:#999;">×</button>
        </div>
        <div style="margin-bottom:12px; display:flex; gap:10px; align-items:center;">
            <input type="text" id="catalog-search" placeholder="🔍 Rechercher une discipline..." oninput="filterCatalog()" style="flex:1;">
            <select id="catalog-bureau-filter" onchange="filterCatalog()" style="width:200px; font-size:0.85rem;">
                <option value="">Tous les bureaux</option>
                <option value="013DIPE1">Bureau 1 – Littéraires</option>
                <option value="013DIPE2">Bureau 2 – Scientifiques</option>
                <option value="013DIPE3">Bureau 3 – Langues/Arts</option>
                <option value="013DIPE4">Bureau 4 – Techniques/LP</option>
            </select>
        </div>
        <div id="catalog-list" style="overflow-y:auto; flex-grow:1; border:1px solid #eee; padding:10px; border-radius:6px;"></div>
        <div style="margin-top:12px; font-size:0.8rem; color:#888; border-top:1px solid #eee; padding-top:10px;">
            Cliquez sur une discipline pour l'ajouter à l'entité courante. Les disciplines déjà présentes sont grisées.
        </div>
    </div>
</div>

<!-- MODAL COPIER MATIÈRES VERS ENTITÉ -->
<div id="copy-subjects-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:20000; justify-content:center; align-items:center;">
    <div style="background:white; padding:24px; border-radius:10px; width:500px; max-width:96%; box-shadow:0 10px 30px rgba(0,0,0,0.3);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:2px solid #eee; padding-bottom:12px;">
            <h3 style="margin:0; color:#1abc9c;">🔀 Copier les Matières</h3>
            <button onclick="document.getElementById('copy-subjects-overlay').style.display='none'" style="background:none;border:none;font-size:1.4rem;cursor:pointer;color:#999;">×</button>
        </div>
        <p style="color:#555; margin-bottom:15px;">Copier les matières de <strong id="copy-from-label">l'entité courante</strong> vers :</p>
        <div style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
            <label style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:10px; border:2px solid #eee; border-radius:8px;" id="copy-to-college-opt">
                <input type="checkbox" id="copy-to-college" style="width:16px; height:16px;"> 🏫 <span id="copy-college-lbl">Collège</span>
            </label>
            <label style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:10px; border:2px solid #eee; border-radius:8px;" id="copy-to-lycee-opt">
                <input type="checkbox" id="copy-to-lycee" style="width:16px; height:16px;"> 🏛️ <span id="copy-lycee-lbl">Lycée</span>
            </label>
            <label style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:10px; border:2px solid #eee; border-radius:8px;" id="copy-to-pole-opt">
                <input type="checkbox" id="copy-to-pole" style="width:16px; height:16px;"> 🎓 <span id="copy-pole-lbl">Pôle Supérieur</span>
            </label>
        </div>
        <div style="background:#fff3cd; border:1px solid #ffc107; border-radius:6px; padding:10px; margin-bottom:15px; font-size:0.85rem; color:#856404;">
            ⚠️ Les matières existantes dans la cible seront conservées. Seules les nouvelles matières seront ajoutées.
        </div>
        <div style="display:flex; gap:10px; justify-content:flex-end;">
            <button onclick="document.getElementById('copy-subjects-overlay').style.display='none'" class="btn" style="background:#eee; color:#333;">Annuler</button>
            <button onclick="executeCopySubjects()" class="btn btn-success">✅ Copier</button>
        </div>
    </div>
</div>

<!-- MODAL AJOUT ENSEIGNANT -->
<div id="shared-teacher-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:20000; justify-content:center; align-items:center;">
    <div style="background:white; padding:28px; border-radius:10px; width:500px; max-width:95%; box-shadow:0 10px 30px rgba(0,0,0,0.3);">
        <h3 style="margin:0 0 20px 0; color:#2c3e50; border-bottom:2px solid #eee; padding-bottom:12px;">
            👤 Enseignant
        </h3>
        <input type="hidden" id="st-id">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:15px;">
            <div style="grid-column:1/-1;">
                <label style="font-weight:600; font-size:0.85rem;">Nom & Prénom *</label>
                <input type="text" id="st-name" placeholder="Ex: DUPONT Marie" style="width:100%; box-sizing:border-box; margin-top:4px;">
            </div>
            <div>
                <label style="font-weight:600; font-size:0.85rem;">Grade *</label>
                <select id="st-grade" style="width:100%; box-sizing:border-box; margin-top:4px;">
                    <option value="">-- Sélectionner --</option>
                    <optgroup label="── Corps enseignants titulaires ──">
                        <option value="Agrégé">Agrégé (AGG)</option>
                        <option value="Certifié">Certifié (CERT)</option>
                        <option value="PLP">PLP – Prof. de Lycée Professionnel</option>
                        <option value="CAPEPS">CAPEPS – EPS Certifié</option>
                        <option value="Agrégé EPS">Agrégé EPS</option>
                        <option value="PEGC">PEGC – Prof. d'Ens. Gén. de Collège</option>
                        <option value="PCS">Prof. de Chaire Supérieure (PCS)</option>
                        <option value="CPE">CPE – Conseiller Principal d'Éducation</option>
                        <option value="Documentaliste">Documentaliste (PsyEN-DO)</option>
                        <option value="Bi-admissible">Bi-admissible</option>
                    </optgroup>
                    <optgroup label="── Personnel non titulaire ──">
                        <option value="Contractuel">Contractuel</option>
                        <option value="Vacataire">Vacataire</option>
                        <option value="AED">AED – Assistant d'Éducation</option>
                        <option value="AESH">AESH – Accompagnant Élèves Handicapés</option>
                        <option value="Intervenant Extérieur">Intervenant Extérieur</option>
                    </optgroup>
                    <optgroup label="── Enseignement Supérieur ──">
                        <option value="PRAG">PRAG – Prof. Agrégé dans le Sup.</option>
                        <option value="PRCE">PRCE – Prof. Certifié dans le Sup.</option>
                        <option value="Maître de conférences">Maître de conférences (MCF)</option>
                        <option value="Professeur associé">Professeur associé</option>
                    </optgroup>
                    <optgroup label="── Administratif ──">
                        <option value="BMP/CSR">BMP / CSR</option>
                        <option value="Autre">Autre</option>
                    </optgroup>
                </select>
            </div>
            <div>
                <label style="font-weight:600; font-size:0.85rem;">Email</label>
                <input type="email" id="st-email" placeholder="prenom.nom@ac-xxxxx.fr" style="width:100%; box-sizing:border-box; margin-top:4px;">
            </div>
            <div>
                <label style="font-weight:600; font-size:0.85rem;">Discipline principale *</label>
                <input type="text" id="st-subject" placeholder="Ex: Mathématiques" style="width:100%; box-sizing:border-box; margin-top:4px;"
                    title="Discipline principale (utilisée si aucune discipline par entité n'est définie)">
                <div id="st-subjects-per-entity" style="margin-top:8px; display:flex; flex-direction:column; gap:5px;"></div>
                <div style="font-size:0.72rem; color:#999; margin-top:3px;">💡 Si ce prof enseigne une discipline différente selon l'entité, précisez-la ci-dessous.</div>
            </div>
            <div>
                <label style="font-weight:600; font-size:0.85rem;">Code PNE</label>
                <select id="st-pne-code" onchange="updateStBureauDisplay()" style="width:100%; box-sizing:border-box; margin-top:4px;">
                    <option value="">-- Sélectionner --</option>
                </select>
            </div>
            <div>
                <label style="font-weight:600; font-size:0.85rem;">ORS (Obligation Régl.)</label>
                <input type="number" id="st-ors" value="18" min="0" max="30" step="0.5" style="width:100%; box-sizing:border-box; margin-top:4px;" oninput="updateStReste()">
            </div>
        </div>
        <!-- Champs cachés pour compatibilité -->
        <input type="hidden" id="st-h-college" value="0">
        <input type="hidden" id="st-h-lycee" value="0">
        <input type="hidden" id="st-h-lycee-pro" value="0">
        <input type="hidden" id="st-h-pole" value="0">

        <!-- CASES À COCHER ENTITÉS -->
        <div style="background:#f8f9fa; border:1px solid #e8ecf0; border-radius:8px; padding:14px; margin-bottom:15px;">
            <div style="font-weight:700; color:#2c3e50; margin-bottom:10px; font-size:0.9rem;">🏫 Entités actives <span style="font-size:0.75rem; color:#7f8c8d; font-weight:400;">— cet enseignant apparaîtra dans la liste Professeurs de chaque entité cochée</span></div>
            <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:8px;">
                <label id="st-entity-lbl-college" style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:9px 12px; border:2px solid #aed6f1; border-radius:7px; background:#eaf4fc; transition:all .15s;">
                    <input type="checkbox" id="st-entity-college" value="college" onchange="stEntityCheckChange()" style="width:17px; height:17px; accent-color:#2980b9; cursor:pointer;">
                    <span style="font-weight:700; color:#2980b9; font-size:0.9rem;">🏫 Collège</span>
                    <span id="st-disp-college" style="margin-left:auto; font-size:0.82rem; color:#2980b9; font-weight:600;"></span>
                </label>
                <label id="st-entity-lbl-lycee" style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:9px 12px; border:2px solid #a9dfbf; border-radius:7px; background:#eafaf1; transition:all .15s;">
                    <input type="checkbox" id="st-entity-lycee" value="lycee" onchange="stEntityCheckChange()" style="width:17px; height:17px; accent-color:#1e8449; cursor:pointer;">
                    <span style="font-weight:700; color:#1e8449; font-size:0.9rem;">🏛️ Lycée</span>
                    <span id="st-disp-lycee" style="margin-left:auto; font-size:0.82rem; color:#1e8449; font-weight:600;"></span>
                </label>
                <label id="st-entity-lbl-lycee_pro" style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:9px 12px; border:2px solid #f0b27a; border-radius:7px; background:#fef5e7; transition:all .15s;">
                    <input type="checkbox" id="st-entity-lycee_pro" value="lycee_pro" onchange="stEntityCheckChange()" style="width:17px; height:17px; accent-color:#d35400; cursor:pointer;">
                    <span style="font-weight:700; color:#d35400; font-size:0.9rem;">🏭 Lycée Pro</span>
                    <span id="st-disp-lycee-pro" style="margin-left:auto; font-size:0.82rem; color:#d35400; font-weight:600;"></span>
                </label>
                <label id="st-entity-lbl-pole" style="display:flex; align-items:center; gap:10px; cursor:pointer; padding:9px 12px; border:2px solid #c39bd3; border-radius:7px; background:#f5eef8; transition:all .15s;">
                    <input type="checkbox" id="st-entity-pole" value="pole" onchange="stEntityCheckChange()" style="width:17px; height:17px; accent-color:#7d3c98; cursor:pointer;">
                    <span style="font-weight:700; color:#7d3c98; font-size:0.9rem;">🎓 Pôle Sup.</span>
                    <span id="st-disp-pole" style="margin-left:auto; font-size:0.82rem; color:#7d3c98; font-weight:600;"></span>
                </label>
            </div>
            <div id="st-reste-display" style="margin-top:8px; font-size:0.85rem; font-weight:700; text-align:right;"></div>
        </div>
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="btn btn-dark" onclick="closeSharedTeacherModal()">Annuler</button>
            <button class="btn btn-success" onclick="saveSharedTeacher()">💾 Enregistrer</button>
        </div>
    </div>
</div>

<div id="split-overlay">
    <div class="split-box">
        <div class="split-header">
            <h3>✂️ Ventilation de service</h3>
            <button onclick="closeSplitModal()" style="background:none; border:none; font-size:1.2rem; cursor:pointer;">×</button>
        </div>
        
        <div id="split-info" class="info-dispo"></div>
        
        <div id="split-container">
            </div>

        <div class="split-actions">
            <button class="btn btn-dark" onclick="closeSplitModal()">Annuler</button>
            <button class="btn btn-success" onclick="confirmVentilation()">Valider la ventilation</button>
        </div>
    </div>
</div>
<div id="export-overlay" style="display: none; position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 10000; justify-content: center; align-items: center; backdrop-filter: blur(3px);">
    <div style="background:white; padding:30px; border-radius:15px; width:450px; max-width:90%; box-shadow:0 15px 35px rgba(0,0,0,0.2);">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0; color:#2c3e50;">🖨️ Configuration PDF</h2>
            <button onclick="document.getElementById('export-overlay').style.display='none'" style="border:none; background:none; font-size:1.5rem; cursor:pointer; color:#95a5a6;">×</button>
        </div>

        <div class="export-section-title">1. Orientation</div>
        <div class="export-tiles-row">
            <div class="export-tile" id="tile-orient-portrait" onclick="setExportParam('orientation', 'portrait')">
                <div class="icon-paper icon-portrait"></div>
                <div class="tile-label">Portrait</div>
            </div>
            <div class="export-tile selected" id="tile-orient-landscape" onclick="setExportParam('orientation', 'landscape')">
                <div class="icon-paper icon-landscape"></div>
                <div class="tile-label">Paysage</div>
            </div>
        </div>

        <div class="export-section-title">2. Format Papier</div>
        <div class="export-tiles-row">
            <div class="export-tile" id="tile-format-a4" onclick="setExportParam('format', 'a4')">
                <span class="icon-format">A4</span>
                <div class="tile-label">Standard</div>
            </div>
            <div class="export-tile selected" id="tile-format-a3" onclick="setExportParam('format', 'a3')">
                <span class="icon-format">A3</span>
                <div class="tile-label">Grand Format</div>
            </div>
        </div>

        <div class="export-options-row">
            <label class="switch-label">
                <input type="checkbox" id="chk-force-one-page" checked="checked" style="width:20px; height:20px; accent-color:#27ae60;">
                <div>
                    <div style="font-weight:bold;">Forcer sur une seule page</div>
                    <small style="color:#7f8c8d;">Réduit automatiquement la police</small>
                </div>
            </label>
        </div>

        <button class="btn btn-success" style="width:100%; padding:15px; margin-top:20px; font-size:1.1rem; justify-content:center;" onclick="confirmGlobalExport()">
    Télécharger le PDF
</button>
    </div>
</div>
<div id="dech-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10000; justify-content:center; align-items:center; backdrop-filter:blur(2px);">
    <div style="background:white; padding:25px; border-radius:10px; width:400px; max-width:90%; box-shadow:0 10px 25px rgba(0,0,0,0.2);">
        <h3 style="margin-top:0; color:#2c3e50; border-bottom:1px solid #eee; padding-bottom:10px;">Gestion des Décharges</h3>
        <p id="dech-teacher-name" style="font-weight:bold; color:#3498db; margin-bottom:20px;"></p>

        <div style="background:#f9f9f9; padding:15px; border-radius:8px; border:1px solid #eee; margin-bottom:15px;">
            <label style="display:block; font-weight:bold; color:#e67e22; margin-bottom:5px;">1. Décharge DGH (Interne)</label>
            <small style="color:#777; display:block; margin-bottom:8px;">Heure de Labo, Cabinet, Vaisselle...<br>👉 <strong>Coûte</strong> à l'établissement.</small>
            <div style="display:flex; align-items:center; gap:10px;">
                <input type="number" id="input-dech-int" step="0.5" min="0" style="width:80px; text-align:center; font-weight:bold; color:#e67e22;" placeholder="0">
                <span>heure(s)</span>
            </div>
        </div>

        <div style="background:#f9f9f9; padding:15px; border-radius:8px; border:1px solid #eee; margin-bottom:20px;">
            <label style="display:block; font-weight:bold; color:#27ae60; margin-bottom:5px;">2. Décharge Rectorat (Externe)</label>
            <small style="color:#777; display:block; margin-bottom:8px;">Syndicale, Allègement médical, IMP Rectorat...<br>👉 <strong>Ne coûte pas</strong> (réduit l'ORS payé).</small>
            <div style="display:flex; align-items:center; gap:10px;">
                <input type="number" id="input-dech-ext" step="0.5" min="0" style="width:80px; text-align:center; font-weight:bold; color:#27ae60;" placeholder="0">
                <span>heure(s)</span>
            </div>
        </div>

        <div style="text-align:right; display:flex; gap:10px; justify-content:flex-end;">
            <button class="btn btn-dark" onclick="currentDechIdx = -1; document.getElementById('dech-overlay').style.display='none'">Annuler</button>
            <button class="btn btn-success" onclick="saveDechargeDetails()">Valider</button>
        </div>
    </div>
</div>

<div id="eds-selector-overlay" style="display: none;">
    <div class="eds-selector-box">
        <div class="split-header">
            <h3 id="eds-selector-title">Choisir les EDS : Première</h3>
            <button onclick="closeEdsSelector()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">×</button>
        </div>
        <p style="color: #7f8c8d; font-size: 0.9rem;">Cliquez sur les tuiles pour sélectionner les enseignements ouverts dans votre établissement.</p>
        
        <div class="eds-grid" id="eds-tiles-container"><div class="eds-tile">Mathématiques</div><div class="eds-tile">Physique-Chimie</div><div class="eds-tile">SVT</div><div class="eds-tile">HGGSP</div><div class="eds-tile">SES</div><div class="eds-tile">HLP</div><div class="eds-tile">LLCE Anglais</div><div class="eds-tile">LLCE Espagnol</div><div class="eds-tile">LLCE Allemand</div><div class="eds-tile">LLCE Italien</div><div class="eds-tile">NSI</div><div class="eds-tile">SI (Sciences de l'Ingénieur)</div><div class="eds-tile">AMC (Anglais Monde Contemp.)</div><div class="eds-tile">EPPCS (Sport)</div><div class="eds-tile">Spé Arts Plastiques (Arts)</div><div class="eds-tile">Spé Musique (Arts)</div><div class="eds-tile">Spé Théâtre (Arts)</div><div class="eds-tile">Spé Cinéma-Audiovisuel (Arts)</div><div class="eds-tile">Spé Danse (Arts)</div><div class="eds-tile">Spé Histoire des Arts (Arts)</div><div class="eds-tile">Spé Arts du Cirque (Arts)</div><div class="eds-tile">STI2D - Innovation Technologique (IT)</div><div class="eds-tile">STI2D - Ingénierie et dév. durable (I2D)</div><div class="eds-tile">STI2D - Phys.-Chimie et Maths (PCM)</div><div class="eds-tile">ST2S - Sciences et tech. sanitaires et sociales</div><div class="eds-tile">ST2S - Biologie et physiopathologie humaines</div><div class="eds-tile">STL - Biotechnologies</div><div class="eds-tile">STL - Sciences phys. et chim. en labo</div><div class="eds-tile">STD2A - Analyse et méthodes en design</div><div class="eds-tile">STD2A - Conception et création en design</div><div class="eds-tile">STHR - Hôtellerie et Restauration</div><div class="eds-tile">STAV - Aménagement / Production / Transformation</div><div class="eds-tile">S2TMD - Musique / Danse / Théâtre</div></div>

        <div class="split-actions">
            <button class="btn btn-dark" onclick="closeEdsSelector()">Annuler</button>
            <button class="btn btn-success" id="btn-validate-eds" style="padding: 10px 30px;">Valider la sélection</button>
        </div>
    </div>
</div>
<div id="linked-subjects-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10000; justify-content:center; align-items:center; backdrop-filter:blur(2px);">
    <div style="background:white; padding:25px; border-radius:10px; width:500px; max-width:90%; box-shadow:0 10px 25px rgba(0,0,0,0.2); display:flex; flex-direction:column; max-height:85vh;">
        <div style="border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; color:#2c3e50;">🔗 Disciplines Associées</h3>
            <button onclick="closeLinkedSubjectsModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#7f8c8d;">×</button>
        </div>
        
        <p style="color:#7f8c8d; font-size:0.9rem; margin-top:0;">
            Sélectionnez les matières dont les professeurs pourront intervenir sur <strong id="linked-modal-target-name" style="color:#2c3e50;"></strong>.
        </p>

        <div id="linked-subjects-list" style="overflow-y:auto; flex-grow:1; border:1px solid #eee; padding:10px; border-radius:6px; background:#f9f9f9; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            </div>

        <div style="margin-top:20px; text-align:right; border-top:1px solid #eee; padding-top:15px;">
            <button class="btn btn-success" onclick="closeLinkedSubjectsModal()">Valider &amp; Fermer</button>
        </div>
    </div>
</div>

<script>
/**
 * DHG MANAGER V2 - Version Finale
 */

const PRESETS = {
    'college': {
        levels: [
            { level: "6ème", students: 0, div: 0, target: 28.0 },
            { level: "5ème", students: 0, div: 0, target: 29.0 },
            { level: "4ème", students: 0, div: 0, target: 29.0 },
            { level: "3ème", students: 0, div: 0, target: 29.0 }
        ],
        subjects: {
            "Français": {"6ème":4.5,"5ème":4.5,"4ème":4.5,"3ème":4}, "Maths": {"6ème":4.5,"5ème":3.5,"4ème":3.5,"3ème":3.5},
            "Hist-Géo": {"6ème":3,"5ème":3,"4ème":3,"3ème":3.5}, "LV1 Anglais": {"6ème":4,"5ème":3,"4ème":3,"3ème":3},
            "LV2 Espagnol": {"6ème":0,"5ème":2.5,"4ème":2.5,"3ème":2.5}, "SVT": {"6ème":2,"5ème":1.5,"4ème":1.5,"3ème":1.5},
            "Phys-Chi": {"6ème":2,"5ème":1.5,"4ème":1.5,"3ème":1.5}, "Techno": {"6ème":0,"5ème":1.5,"4ème":1.5,"3ème":1.5},
            "EPS": {"6ème":4,"5ème":3,"4ème":3,"3ème":3}, "Arts Plast.": {"6ème":1,"5ème":1,"4ème":1,"3ème":1},
            "Education Musicale": {"6ème":1,"5ème":1,"4ème":1,"3ème":1}, 
            "Autonomie EPLE": { "6ème": 0, "5ème": 0, "4ème": 0, "3ème": 0 },
            "UNSS": { "6ème": 0, "5ème": 0, "4ème": 0, "3ème": 0 }
        }
    },
    'lgt': {
        levels: [
            { level: "2nde", students: 0, div: 0, target: 29.0 },
            { level: "1ère", students: 0, div: 0, target: 28.0 },
            { level: "Terminale", students: 0, div: 0, target: 28.0 }
        ],
        subjects: {
            "Français": {"2nde":4, "1ère":4, "Terminale":0}, "Philosophie": {"2nde":0, "1ère":0, "Terminale":4},
            "Hist-Géo": {"2nde":3, "1ère":3, "Terminale":3}, "LVA": {"2nde":3, "1ère":2.5, "Terminale":2},
            "LVB": {"2nde":2.5, "1ère":2, "Terminale":2}, "SES": {"2nde":1.5, "1ère":0, "Terminale":0},
            "Maths (TC)": {"2nde":4, "1ère":0, "Terminale":0}, "Phys-Chi (TC)": {"2nde":3, "1ère":0, "Terminale":0},
            "SVT (TC)": {"2nde":1.5, "1ère":0, "Terminale":0}, "EPS": {"2nde":2, "1ère":2, "Terminale":2},
            "Ens. Scientifique": {"2nde":0, "1ère":2, "Terminale":2}, "EMC": {"2nde":0.5, "1ère":0.5, "Terminale":0.5},
            "Autonomie EPLE": { "2nde": 0, "1ère": 0, "Terminale": 0 },
            "UNSS": { "2nde": 0, "1ère": 0, "Terminale": 0 }
        }
    },
    'lp': {
        levels: [{ level: "2nde BacPro", students: 0, div: 0, target: 30.0 }],
        subjects: { 
            "Lettres-Hist": {"2nde BacPro": 4}, "Maths-Sciences": {"2nde BacPro": 4}, "EPS": {"2nde BacPro": 2}, 
            "Autonomie EPLE": { "2nde BacPro": 0 }, "UNSS": { "2nde BacPro": 0 }
        }
    }
};

// ============================================================
// RÉFÉRENTIEL PNE – ACADÉMIE AIX-MARSEILLE
// Source : pne-correspondance-bureau-discipline
// ============================================================
const PNE_BUREAUX = {
    "013DIPE1": {
        label: "Bureau 1 – Littéraires, EPS, SES, Documentation, Philosophie",
        color: "#2ecc71",
        disciplines: {
            "L0080": "Documentation",
            "L0100": "Philosophie",
            "L0201": "Lettres Classiques",
            "L0202": "Lettres Modernes",
            "L1100": "Sciences Éco. et Sociales",
            "L1900": "EPS"
        }
    },
    "013DIPE2": {
        label: "Bureau 2 – Scientifiques, Histoire-Géo, SVT",
        color: "#3498db",
        disciplines: {
            "L1000": "Histoire-Géographie",
            "L1300": "Mathématiques",
            "L1500": "Sciences Physiques et Chimiques",
            "L1510": "Physique et Électricité Appliquée",
            "L1600": "Sciences de la Vie et de la Terre"
        }
    },
    "013DIPE3": {
        label: "Bureau 3 – Langues, Arts, Musique, CPE, PSYEN",
        color: "#9b59b6",
        disciplines: {
            "E0030": "CPE",
            "L0421": "Allemand",
            "L0422": "Anglais",
            "L0423": "Arabe",
            "L0424": "Chinois",
            "L0426": "Espagnol",
            "L0429": "Italien",
            "L0430": "Japonais",
            "L0433": "Portugais",
            "L0434": "Russe",
            "L0444": "Occitan",
            "L1700": "Éducation Musicale",
            "L1800": "Arts Plastiques",
            "Y0011": "PSYEN EDA",
            "Y0012": "PSYEN EDO"
        }
    },
    "013DIPE4": {
        label: "Bureau 4 – Techniques/Techno Lycée & Lycée Pro",
        color: "#e67e22",
        disciplines: {
            "L1400": "Technologie",
            "L1411": "SII Ingénierie Constructions",
            "L1412": "SII Ingénierie Électrique",
            "L1413": "SII Ingénierie Informatique",
            "L1414": "SII Ingénierie Mécanique",
            "L6500": "Ens. Artistiques & Arts Appliqués",
            "L7100": "Biochimie-Génie Biologique",
            "L7200": "Biotechnologies Santé-Environnement",
            "L7300": "Sciences et Techniques Médico-Sociales",
            "L8011": "Éco-Gest. Comm., Org., GRH",
            "L8012": "Éco-Gest. Comptabilité & Finance",
            "L8013": "Éco-Gest. Marketing",
            "L8015": "Management UC",
            "L8017": "Négociation & Relation Client",
            "L8031": "Éco-Gest. Concept & Gest. SI",
            "L8520": "Hôtel-Rest. Serv. & Accueil",
            "L8530": "Hôtellerie Tourisme",
            // LP
            "P0210": "LP Lettres-Hist-Géo",
            "P0222": "LP Lettres-Anglais",
            "P0226": "LP Lettres-Espagnol",
            "P1315": "LP Maths-Sciences Phys.",
            "P2100": "LP Génie Industriel Bois",
            "P2200": "LP Génie Industriel Textiles",
            "P2400": "LP Génie Industriel Structures Métalliques",
            "P2450": "LP Construction & Réparation Carrosserie",
            "P2600": "LP Génie Chimique",
            "P3010": "LP Génie Civil Éco.",
            "P3013": "LP Dessin-Topo.",
            "P3020": "LP Génie Civil Réalisation",
            "P3028": "LP Peinture-Revêtement",
            "P3100": "LP Génie Thermique",
            "P4100": "LP Génie Méca. Construction",
            "P4200": "LP Génie Méca. Productique",
            "P4500": "LP Génie Méca. Maint. Véhicules",
            "P4550": "LP G.Méca Maint. Syst. Auto.",
            "P5100": "LP Génie Élec. Électronique",
            "P5200": "LP Génie Élec. Électrotechnique",
            "P6100": "LP Industries Graphiques",
            "P6310": "LP Conducteurs Routiers",
            "P6500": "LP Ens. Artistiques",
            "P6621": "LP Ébénisterie d'Art",
            "P7200": "LP Biotechnologies Santé-Env.",
            "P7300": "LP Sciences & Techniques Médico-Soc.",
            "P7410": "LP Esthétique-Cosmétique",
            "P7420": "LP Coiffure",
            "P8013": "LP Éco-Gest. Commerce & Vente",
            "P8038": "LP Éco-Gest. Transport Logistique",
            "P8039": "LP Éco-Gest. Gestion-Administration",
            "P8510": "LP Hôtellerie Techniques Culinaires",
            "P8520": "LP Hôtellerie Service & Commercialisation"
        }
    }
};

/** Retourne le bureau PNE d'un code discipline */
function getBureauForCode(code) {
    for (const [bureauId, bureau] of Object.entries(PNE_BUREAUX)) {
        if (bureau.disciplines[code]) return bureauId;
    }
    return null;
}

/** Retourne le bureau PNE à partir du nom de discipline dans DATA */
function getBureauForSubject(subjectName) {
    if (!DATA || !DATA.subjectMeta || !DATA.subjectMeta[subjectName]) return null;
    const code = DATA.subjectMeta[subjectName].pneCode || DATA.subjectMeta[subjectName].code || '';
    if (!code) return null;
    return getBureauForCode(code);
}

const SUBJECT_MAPPING = {
    // Lettres & Langues
    "LET MODERN": "Français", "LET CLASS": "Français", "FRANCAIS": "Français", "LETTRES MODERNES": "Français",
    "LITT.  MODERNES": "Français", "LITT. CLASSIQUES": "Français",
    "ANGLAIS": "LV1 Anglais", "ESPAGNOL": "LV2 Espagnol", 
    "ALLEMAND": "LV2 Allemand", "ITALIEN": "LV2 Italien",
    "ANGLAIS LCE": "LV1 Anglais", "LANGUE ET LITTERATURE ANGLAISE": "LV1 Anglais",
    "LATIN": "LCA Latin", "GREC": "LCA Grec",
    
    // Sciences
    "MATHEMATIQ": "Maths", "MATHEMATIQUES": "Maths", "MATHS": "Maths",
    "S. V. T.": "SVT", "SC. VIE TERRE": "SVT", "SVT": "SVT",
    "PHY.CHIMIE": "Phys-Chi", "PHYSIQUE-CHIMIE": "Phys-Chi", "SC. PHYSIQUES": "Phys-Chi",
    "TECHNOLOGI": "Techno", "TECHNOLOGIE": "Techno", "TECHNO": "Techno",
    "MATHS-SCIENCES": "Maths-Sciences",
    
    // Humanités & Arts
    "HIST. GEO.": "Hist-Géo", "HISTOIRE-GEOGRAPHIE": "Hist-Géo", "HISTOIRE-GEO": "Hist-Géo",
    "ARTS PLAST": "Arts Plast.", "ARTS PLASTIQUES": "Arts Plast.",
    "EDU MUSICA": "Education Musicale", "EDUCATION MUSICALE": "Education Musicale", "MUSIQUE": "Education Musicale",
    
    // Sport & Autres
    "E. P. S": "EPS", "EPS": "EPS", "ED. PHYS. SPORT.": "EPS",
    "DOCUMENTA": "Documentation", "DOCUMENTATION": "Documentation"
};

// --- FONCTION CORRECTIVE POUR LES NOMS DE CLASSES ---
// --- NOUVELLE FONCTION DE PRÉFIXE (ANTI-CONFLIT TST2S) ---
function getLevelPrefix(name) {
    if (!name) return "";
    
    // 1. Si le nom COMMENCE par un chiffre (ex: "2nde", "6ème")
    // On prend juste ce chiffre.
    if (/^[0-9]/.test(name)) {
        return name.match(/^[0-9]+/)[0];
    }
    
    // 2. Sinon (ex: "TST2S", "BTS", "UPE2A")
    // On prend les 3 premiers caractères en majuscules.
    // TST2S deviendra "TST" (et non plus "2")
    return name.substring(0, 3).toUpperCase();
}

// --- FONCTION MAÎTRESSE : GÉNÈRE TOUS LES PRÉFIXES UNIQUES ---
function getAllUniquePrefixes() {
    const uniquePrefixes = [];
    const usedRegistry = {};

    DATA.structure.forEach(lvl => {
        // 1. On calcule le préfixe de base (ex: "1")
        let p = getLevelPrefix(lvl.level);
        
        // 2. S'il est déjà pris, on cherche une variante (ex: "12", "13", "14")
        if (usedRegistry[p]) {
            let suffix = 2;
            let candidate = p + suffix;
            while (usedRegistry[candidate]) {
                suffix++;
                candidate = p + suffix;
            }
            p = candidate;
        }
        
        // 3. On valide ce préfixe
        usedRegistry[p] = true;
        uniquePrefixes.push(p);
    });
    
    // Retourne la liste des préfixes dans l'ordre des niveaux
    // Ex: ["6", "5", "4", "3", "2", "1", "12", "T"]
    return uniquePrefixes;
}

let DATA = null;
let chartInstance = null;
let showRhCodes = false;

// === MULTI-ENTITÉS V9 ===
// MULTI_DATA contient les données des 3 entités indépendantes
let MULTI_DATA = {
    college: null,
    lycee: null,
    lycee_pro: null,
    pole: null
};
let currentEntity = 'college'; // entité affichée

// BASE PARTAGÉE : enseignants pouvant intervenir sur plusieurs entités
// Structure : { id, name, subject, pneCode, bureau, ors, entities: ['college','lycee',...], services: {college: h, lycee: h, pole: h} }
let SHARED_TEACHERS = [];

// Noms personnalisés des entités (configurés au setup)
let ENTITY_NAMES = {
    college: 'Collège',
    lycee: 'Lycée',
    lycee_pro: 'Lycée Pro',
    pole: 'Pôle Supérieur'
};

// Icônes des entités
const ENTITY_ICONS = { college: '🏫', lycee: '🏛️', lycee_pro: '🏭', pole: '🎓' };
const ENTITY_COLORS = {
    college:   { bg: '#1565C0', hover: '#1976D2', active: '#0D47A1', text: '#fff', shadow: 'rgba(21,101,192,0.5)',  bannerBg: '#EBF2FB', bannerBorder: '#1565C0', bannerText: '#1565C0' },
    lycee:     { bg: '#2E7D32', hover: '#388E3C', active: '#1B5E20', text: '#fff', shadow: 'rgba(46,125,50,0.5)',   bannerBg: '#EBF5EC', bannerBorder: '#2E7D32', bannerText: '#2E7D32' },
    lycee_pro: { bg: '#E65100', hover: '#F57C00', active: '#BF360C', text: '#fff', shadow: 'rgba(230,81,0,0.5)',   bannerBg: '#FEF3EB', bannerBorder: '#E65100', bannerText: '#E65100' },
    pole:      { bg: '#6A1B9A', hover: '#7B1FA2', active: '#4A148C', text: '#fff', shadow: 'rgba(106,27,154,0.5)', bannerBg: '#F5EEF8', bannerBorder: '#6A1B9A', bannerText: '#6A1B9A' }
};

/** Obtient tous les enseignants consolidés (partagés + propres à chaque entité) */
function getAllSharedTeachers() {
    return SHARED_TEACHERS;
}

/** Ajoute ou met à jour un enseignant dans la base partagée */
function upsertSharedTeacher(teacher) {
    const idx = SHARED_TEACHERS.findIndex(t => t.id === teacher.id);
    if (idx >= 0) {
        SHARED_TEACHERS[idx] = { ...SHARED_TEACHERS[idx], ...teacher };
    } else {
        if (!teacher.id) teacher.id = 'T_' + Date.now() + '_' + Math.random().toString(36).slice(2,6);
        SHARED_TEACHERS.push(teacher);
    }
    saveAllData();
}

/** Retourne les heures d'un enseignant partagé sur une entité */
function getTeacherEntityHours(teacherId, entityKey) {
    const t = SHARED_TEACHERS.find(t => t.id === teacherId);
    if (!t || !t.services) return 0;
    return t.services[entityKey] || 0;
}

/** Retourne le total des heures d'un enseignant partagé sur toutes entités */
function getTeacherTotalHours(teacherId) {
    const t = SHARED_TEACHERS.find(t => t.id === teacherId);
    if (!t || !t.services) return 0;
    return Object.values(t.services).reduce((a, b) => a + (parseFloat(b)||0), 0);
}

/** Bascule vers une entité, sauvegarde la précédente */
function switchEntity(entityKey) {
    // Détecter la section actuellement active AVANT de changer
    const activeSection = document.querySelector('.section.active');
    const activeSectionId = activeSection ? activeSection.id : null;
    const activeMenuBtn = document.querySelector('.menu-item.active');

    // Sauvegarder l'état de l'entité courante dans MULTI_DATA
    if (DATA && currentEntity) {
        MULTI_DATA[currentEntity] = DATA;
    }
    // Changer d'entité
    currentEntity = entityKey;
    DATA = MULTI_DATA[entityKey];
    
    // Mettre à jour les boutons (seulement ceux visibles)
    ['college', 'lycee', 'lycee_pro', 'pole'].forEach(k => {
        const btn = document.getElementById('entity-btn-' + k);
        if (btn) btn.classList.toggle('active', k === entityKey);
    });
    
    // Mettre à jour le titre de section visible
    updateEntityTitle();
    
    // Re-rendre l'interface avec les données de la nouvelle entité
    initUI();

    // Sections qui doivent se rafraîchir automatiquement lors du changement d'entité
    const autoRefreshSections = ['repartition', 'recap'];

    if (activeSectionId && autoRefreshSections.includes(activeSectionId)) {
        // Rester sur la même section et la rafraîchir
        nav(activeSectionId, activeMenuBtn);
    } else {
        // Revenir au dashboard par défaut
        nav('dashboard', null);
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
        document.querySelector('.menu-item').classList.add('active');
    }
    
    // Mettre à jour les badges de dotation
    updateEntityBadges();
    
    // Masquer/Afficher le menu EDS selon l'entité
    updateMenuVisibility(entityKey);
    
    saveAllData();
}

/** Met à jour l'état du menu EDS selon l'entité */
function updateMenuVisibility(entityKey) {
    // --- 1. VÉRIFICATION DE LA STRUCTURE ---
    // La structure est "vide" si aucun niveau n'a de divisions > 0
    const hasStructure = DATA && DATA.structure && DATA.structure.some(l => (l.div || 0) > 0);

    // Menus qui nécessitent une structure non vide (tout ce qui est "en dessous" de Structure)
    const dependentMenus = ['menu-matieres', 'menu-eds', 'menu-professeurs', 'menu-ventilation',
                            'menu-pilotage', 'menu-equipes', 'menu-repartition', 'menu-recap'];

    dependentMenus.forEach(id => {
        const btn = document.getElementById(id);
        if (!btn) return;
        if (!hasStructure) {
            btn.classList.add('disabled');
            btn.style.pointerEvents = 'none';
            btn.title = 'Définissez d\'abord la structure (niveaux & classes) dans l\'onglet Structure';
        } else {
            btn.classList.remove('disabled');
            btn.style.pointerEvents = '';
            btn.title = '';
        }
    });

    // --- 2. GESTION SPÉCIFIQUE EDS (Lycée uniquement) ---
    const menuEds = document.getElementById('menu-eds');
    if (menuEds && hasStructure) {
        const isLycee = (entityKey === 'lycee');
        menuEds.classList.toggle('disabled', !isLycee);
        menuEds.style.pointerEvents = isLycee ? '' : 'none';
        menuEds.style.opacity = isLycee ? '' : '0.35';
        menuEds.title = isLycee ? '' : 'Disponible uniquement pour le Lycée';
    }
}

/** Met à jour les badges de dotation (h) dans le sélecteur */
function updateEntityBadges() {
    ['college', 'lycee', 'lycee_pro', 'pole'].forEach(k => {
        const badge = document.getElementById('entity-badge-' + k);
        if (!badge) return;
        const d = MULTI_DATA[k];
        if (!d) { badge.textContent = '– h'; return; }
        // Calcul rapide de la dotation
        let total = 0;
        if (d.config && d.config.total) {
            total = d.config.total;
        }
        badge.textContent = total > 0 ? total + ' h' : '– h';
    });
}

/** Affiche le nom de l'entité dans le header du contenu */
function updateEntityTitle() {
    const el = document.getElementById('entity-title-header');
    const banner = document.getElementById('entity-header-banner');
    if (el) {
        const icon = ENTITY_ICONS[currentEntity] || '';
        const name = ENTITY_NAMES[currentEntity] || currentEntity;
        const c = ENTITY_COLORS[currentEntity] || {};
        el.textContent = icon + ' ' + name;
        el.style.color = c.bannerText || '#2c3e50';
        if (banner) {
            banner.style.borderLeftColor = c.bannerBorder || '#ccc';
            banner.style.background = c.bannerBg || 'white';
        }
    }
}

window.onload = function() {
    // Tentative de récupération de la sauvegarde multi-entités
    if(localStorage.getItem('DHG_MultiData_V9')) {
        try { 
            const saved = JSON.parse(localStorage.getItem('DHG_MultiData_V9'));
            MULTI_DATA = saved.entities || MULTI_DATA;
            ENTITY_NAMES = saved.names || ENTITY_NAMES;
            currentEntity = saved.currentEntity || 'college';
            SHARED_TEACHERS = saved.sharedTeachers || [];
        } catch(e) { MULTI_DATA = { college: null, lycee: null, lycee_pro: null, pole: null }; }
    } else if(localStorage.getItem('DHG_Data_V9')) {
        // Migration depuis une ancienne sauvegarde mono-entité
        try { 
            const oldData = JSON.parse(localStorage.getItem('DHG_Data_V9'));
            // Déterminer quelle entité correspond à l'ancienne donnée
            if (oldData.type === 'college') {
                MULTI_DATA.college = oldData;
            } else if (oldData.type === 'lgt' || oldData.type === 'lp') {
                MULTI_DATA.lycee = oldData;
            }
        } catch(e) {}
    }
    
    // Vérifier si au moins une entité est initialisée
    const hasAny = MULTI_DATA.college || MULTI_DATA.lycee || MULTI_DATA.lycee_pro || MULTI_DATA.pole;
    
    if(hasAny) {
        // Charger l'entité courante
        DATA = MULTI_DATA[currentEntity];
        
        // Si l'entité courante est vide, prendre la première disponible
        if (!DATA) {
            for (const k of ['college', 'lycee', 'lycee_pro', 'pole']) {
                if (MULTI_DATA[k]) { currentEntity = k; DATA = MULTI_DATA[k]; break; }
            }
        }
        
        // Vérifications de compatibilité
        if(!DATA.subjectMeta) DATA.subjectMeta = {};
        if(!DATA.assignments) DATA.assignments = {};
        DATA.subjects.forEach(s => {
            if(!DATA.subjectMeta[s]) DATA.subjectMeta[s] = {};
            if(!DATA.subjectMeta[s].mode) {
                DATA.subjectMeta[s].mode = 'div';
                DATA.subjectMeta[s].levels = getDefaultActiveLevels(s);
                DATA.subjectMeta[s].etab = 0;
                DATA.subjectMeta[s].volLevel = {};
            }
        });
        checkAndFixData();
        
        document.getElementById('setup-overlay').style.display = 'none';
        initYearSelector();
        initUI();
        
        // Mettre à jour les badges et boutons d'entité
        ['college', 'lycee', 'lycee_pro', 'pole'].forEach(k => {
            const btn = document.getElementById('entity-btn-' + k);
            if (btn) {
                btn.classList.toggle('active', k === currentEntity);
                // Masquer les boutons des entités non initialisées
                btn.style.display = MULTI_DATA[k] ? '' : 'none';
            }
        });
        updateEntityBadges();
        updateEntityTitle();
        // Masquer EDS pour Collège et Pôle au démarrage
        updateMenuVisibility(currentEntity);
        // Migration des enseignants vers la base partagée
        migrateTeachersToShared();
    } else {
        document.getElementById('setup-overlay').style.display = 'flex';
    }

    try{ pushCalendarsFromStorage(); }catch(e){}
};

function getDefaultActiveLevels(s) {
    if(!DATA || !DATA.structure) return [];
    let all = DATA.structure.map(l => l.level);
    if(s.includes("Techno") || s.includes("Espagnol") || s.includes("LV2")) {
        return all.filter(l => !l.includes("6"));
    }
    if(s.includes("Philosophie")) {
        return all.filter(l => l.toLowerCase().includes("term"));
    }
    return all;
}

/** Active/désactive une carte entité dans le setup */
function toggleEntityCard(key) {
    setTimeout(() => {
        const chk  = document.getElementById('chk-' + key);
        const card = document.getElementById('card-' + key);
        const lbl  = document.getElementById('toggle-' + key);
        if (!chk || !card) return;
        const active = chk.checked;
        card.style.opacity       = active ? '1'   : '0.35';
        card.style.pointerEvents = active ? ''    : 'none';
        if (lbl) lbl.style.opacity = active ? '1' : '0.6';
        // Recalculer le nombre de colonnes
        const n = ['college','lycee','lycee_pro','pole'].filter(k => {
            const c = document.getElementById('chk-' + k);
            return c && c.checked;
        }).length;
        document.getElementById('setup-cards-container').style.gridTemplateColumns = `repeat(${Math.max(1,n)},1fr)`;
    }, 10);
}

/** Initialise les entités sélectionnées depuis l'écran de setup */
function initMultiData() {
    const allKeys = ['college', 'lycee', 'lycee_pro', 'pole'];
    const activeKeys = allKeys.filter(k => {
        const chk = document.getElementById('chk-' + k);
        return chk && chk.checked;
    });

    if (activeKeys.length === 0) {
        alert('⚠️ Sélectionnez au moins une entité pour démarrer.');
        return;
    }

    const typeEl = {
        college:   'setup-college-type',
        lycee:     'setup-lycee-type',
        lycee_pro: 'setup-lycee-pro-type',
        pole:      'setup-pole-type'
    };
    const nameEl = {
        college:   ['setup-college-name',   'Collège'],
        lycee:     ['setup-lycee-name',     'Lycée'],
        lycee_pro: ['setup-lycee-pro-name', 'Lycée Pro'],
        pole:      ['setup-pole-name',      'Pôle Supérieur']
    };
    const iconMap = { college:'🏫', lycee:'🏛️', lycee_pro:'🏭', pole:'🎓' };

    allKeys.forEach(k => {
        if (activeKeys.includes(k)) {
            ENTITY_NAMES[k] = document.getElementById(nameEl[k][0]).value.trim() || nameEl[k][1];
            MULTI_DATA[k]   = createEntityData(document.getElementById(typeEl[k]).value);
        } else {
            MULTI_DATA[k]   = null;
        }
        // Mettre à jour libellé bouton + visibilité sidebar
        const btn = document.getElementById('entity-btn-' + k);
        if (btn) {
            btn.innerHTML     = `${iconMap[k]} ${ENTITY_NAMES[k]}<span class="entity-badge" id="entity-badge-${k}">– h</span>`;
            btn.style.display = activeKeys.includes(k) ? '' : 'none';
        }
    });

    currentEntity = activeKeys[0];
    DATA = MULTI_DATA[currentEntity];

    saveAllData();
    document.getElementById('setup-overlay').style.display = 'none';

    allKeys.forEach(k => {
        const btn = document.getElementById('entity-btn-' + k);
        if (btn) btn.classList.toggle('active', k === currentEntity);
    });

    updateEntityBadges();
    updateEntityTitle();
    updateMenuVisibility(currentEntity);
    initYearSelector();
    initUI();
}

/** Crée un objet DATA pour une entité à partir d'un type de preset */
function createEntityData(type) {
    const preset = PRESETS[type];
    const currentYear = new Date().getFullYear();
    const entityData = {
        type: type,
        config: { year: currentYear, total: 0, hp: 0, hsa: 0 },
        structure: JSON.parse(JSON.stringify(preset.levels)),
        additionalMeans: { total: 0 },
        subjects: Object.keys(preset.subjects),
        subjectMeta: {},
        levelConfig: {},
        classOverrides: {},
        classNames: {}, 
        teachers: [],
        recapComments: {},
        assignments: {},
        eds: { premiere: [], terminale: [] }
    };
    
    entityData.subjects.forEach(s => {
        entityData.subjectMeta[s] = {
            mode: 'div',
            levels: entityData.structure.map(l => l.level),
            etab: 0,
            volLevel: {},
            parent: "",
            code: ""
        };
        if(s.includes("Latin") || s.includes("LCA")) entityData.subjectMeta[s].parent = "Français";
        if(s === "UNSS") {
            entityData.subjectMeta[s].mode = 'etab';
            entityData.subjectMeta[s].etab = 3;
            entityData.subjectMeta[s].parent = "EPS";
        }
    });

    entityData.structure.forEach(lvl => {
        entityData.levelConfig[lvl.level] = {};
        entityData.subjects.forEach(s => {
            const hrs = preset.subjects[s]?.[lvl.level] || 0;
            entityData.levelConfig[lvl.level][s] = {base: hrs, marge: 0, coef: 1.0};
        });
    });
    
    return entityData;
}

function initData(type) {
    DATA = createEntityData(type);
    MULTI_DATA[currentEntity] = DATA;
    saveAllData();
    document.getElementById('setup-overlay').style.display = 'none';
    initYearSelector();
    initUI();
}

function changeEpleType() {
    if(confirm("⚠️ Attention : Cela va réinitialiser l'entité \"" + (ENTITY_NAMES[currentEntity]||currentEntity) + "\".\n\nAvez-vous pensé à sauvegarder ?\n\nConfirmer la réinitialisation ?")) {
        MULTI_DATA[currentEntity] = null;
        DATA = null;
        saveAllData();
        location.reload();
    }
}

function resetAllEntities() {
    if(confirm("⚠️ Attention : Cela va réinitialiser TOUTES les entités (Collège, Lycée, Lycée Pro, Pôle Supérieur).\n\nToutes vos données seront perdues !\n\nConfirmer la réinitialisation totale ?")) {
        localStorage.removeItem('DHG_MultiData_V9');
        localStorage.removeItem('DHG_Data_V9');
        location.reload();
    }
}

function initYearSelector() {
    const select = document.getElementById('dash-year');
    const yNow = new Date().getFullYear();
    const saved = DATA.config.year || yNow;
    select.innerHTML = '';
    for(let y = saved - 1; y <= saved + 5; y++) { let opt = new Option(y, y); if(y == saved) opt.selected = true; select.appendChild(opt); }
}

function initUI() {
    updateEntityTitle();
    document.getElementById('global-dhg-display').innerText = DATA.config.total;
    document.getElementById('global-hp').value = DATA.config.hp;
    document.getElementById('global-hsa').value = DATA.config.hsa;
    if(!DATA.classNames) DATA.classNames = {}; 
    renderStructure(); renderGridSystem(); renderRH(); calculateRecap();
    renderSubjectsConfig();
}

function nav(id, btn) {
    // Synchroniser l'état courant avant de re-rendre (important pour repartition/recap multi-entités)
    if (DATA && currentEntity) MULTI_DATA[currentEntity] = DATA;

    // Blocage si structure vide (0 classes) pour les menus dépendants
    const hasStructure = DATA && DATA.structure && DATA.structure.some(l => (l.div || 0) > 0);
    const structureDependentSections = ['matieres','eds','professeurs','ventilation','pilotage','equipes','repartition','recap'];
    if (!hasStructure && structureDependentSections.includes(id)) {
        alert('⚠️ Veuillez d\'abord définir la structure (niveaux & classes) dans l\'onglet "Structure".');
        return;
    }

    // Blocage si EDS cliqué hors entité Lycée
    if(id === 'eds' && currentEntity !== 'lycee') {
        alert("Ce module est disponible uniquement pour l'entité Lycée.");
        return;
    }

    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    
    document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
    if(btn) btn.classList.add('active');

    // Sections plein écran (hors sidebar) : masquer bandeau entité + supprimer padding .content
    const fullscreenSections = ['bilan-global', 'enseignants-mutualises'];
    const isFullscreen = fullscreenSections.includes(id);
    const banner = document.getElementById('entity-header-banner');
    if (banner) banner.style.display = isFullscreen ? 'none' : '';
    const contentEl = document.querySelector('.content');
    if (contentEl) contentEl.classList.toggle('fullscreen-mode', isFullscreen);
    
    if(id === 'dashboard') { calculateRecap(); drawDashboardChart(); }
    else if(id === 'ventilation') renderGridSystem();
    else if(id === 'pilotage') renderRHDisc();
    else if(id === 'professeurs') renderRH();
    else if(id === 'equipes') renderTeams();
	else if(id === 'repartition') renderRepartition(); 
    else if(id === 'recap') calculateRecap();
    else if(id === 'matieres') renderSubjectsConfig();
    else if(id === 'eds') renderEDS();
    else if(id === 'bilan-global') renderBilanGlobal();
    else if(id === 'enseignants-mutualises') renderSharedTeachers();
}

function drawDashboardChart() {
    const canvas = document.getElementById('dhgChart');
    if(!canvas || canvas.offsetParent === null) return; 

    const totN = parseFloat(document.getElementById('dash-conso').innerText) || 0;
    const glo = parseFloat(document.getElementById('dash-total-dhg').innerText) || 0;
    const solde = glo - totN;

    const ctx = canvas.getContext('2d');
    if(chartInstance) chartInstance.destroy();
    
    chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Consommé', 'Dispo', 'Déficit'],
            datasets: [{
                data: [
                    Math.min(totN, glo), 
                    Math.max(0, solde), 
                    solde < 0 ? Math.abs(solde) : 0
                ],
                backgroundColor: ['#3498db', '#2ecc71', '#e74c3c']
            }]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false,
            animation: { duration: 500 }
        }
    });
}

function addNewLevel() {
    const name = prompt("Nom du niveau (ex: BTS 1) ?");
    if(!name) return;
    if(DATA.structure.some(l => l.level === name)) { alert("Existe déjà !"); return; }
    DATA.structure.push({ level: name, students: 0, div: 0, target: 29.0 });
    DATA.levelConfig[name] = {};
    DATA.subjects.forEach(s => DATA.levelConfig[name][s] = {base:0, demi:0, marge:0, coef:1.0});
    saveData(); renderStructure(); renderGridSystem();
}
function renameLevelInline(idx, newName) {
    newName = (newName || '').trim();
    const lvl = DATA.structure[idx];
    if (!lvl || !newName || newName === lvl.level) return;
    const oldName = lvl.level;

    // Geler les noms de classes existants
    if (!DATA.classNames) DATA.classNames = {};
    const oldPrefix = getLevelPrefix(oldName);
    for (let i = 0; i < lvl.div; i++) {
        const oldId = `${oldPrefix}${String.fromCharCode(65 + i)}`;
        if (!DATA.classNames[oldId]) DATA.classNames[oldId] = oldId;
    }

    // Renommer dans la structure
    lvl.level = newName;

    // Migrer levelConfig
    if (DATA.levelConfig[oldName]) {
        DATA.levelConfig[newName] = JSON.parse(JSON.stringify(DATA.levelConfig[oldName]));
        delete DATA.levelConfig[oldName];
    }

    // Migrer les méta-données matières
    DATA.subjects.forEach(s => {
        const meta = DATA.subjectMeta[s];
        if (meta.levels && meta.levels.includes(oldName)) {
            meta.levels[meta.levels.indexOf(oldName)] = newName;
        }
        if (meta.volLevel && meta.volLevel[oldName] !== undefined) {
            meta.volLevel[newName] = meta.volLevel[oldName];
            delete meta.volLevel[oldName];
        }
    });

    saveData();
    // Recalculer le pondType après renommage (le type peut changer)
    window.lastActiveGridTab = idx;
    renderGridSystem();
}

function renameLevel(idx) {
    const lvl = DATA.structure[idx];
    const oldName = lvl.level;
    
    const newName = prompt("Renommer " + oldName + " en :", oldName);
    if (!newName || newName === oldName) return;

    // 1. On calcule les préfixes AVANT et APRÈS le changement
    // (Nécessite la fonction getLevelPrefix ajoutée précédemment)
    const oldPrefix = getLevelPrefix(oldName); 
    const newPrefix = getLevelPrefix(newName);

    // 2. "Geler" les noms actuels des classes
    // Si une classe s'appelle "6A" par défaut, on enregistre "6A" comme nom fixe.
    // Ainsi, même si le code interne devient "N6A", l'affichage restera "6A".
    if (!DATA.classNames) DATA.classNames = {};
    for (let i = 0; i < lvl.div; i++) {
        const oldId = `${oldPrefix}${String.fromCharCode(65 + i)}`;
        // Si aucun nom personnalisé n'existe, on force le nom actuel
        if (!DATA.classNames[oldId]) {
            DATA.classNames[oldId] = oldId;
        }
    }

    // 3. Appliquer le nouveau nom au niveau
    lvl.level = newName;

    // 4. Migrer la configuration du niveau (Matières)
    if (DATA.levelConfig[oldName]) {
        DATA.levelConfig[newName] = JSON.parse(JSON.stringify(DATA.levelConfig[oldName]));
        delete DATA.levelConfig[oldName];
    }
    
    // Mettre à jour les références dans les Méta-données des matières (si utilisé en mode "niveau")
    DATA.subjects.forEach(s => {
        if (DATA.subjectMeta[s].levels && DATA.subjectMeta[s].levels.includes(oldName)) {
            const i = DATA.subjectMeta[s].levels.indexOf(oldName);
            DATA.subjectMeta[s].levels[i] = newName;
        }
        if (DATA.subjectMeta[s].volLevel && DATA.subjectMeta[s].volLevel[oldName]) {
            DATA.subjectMeta[s].volLevel[newName] = DATA.subjectMeta[s].volLevel[oldName];
            delete DATA.subjectMeta[s].volLevel[oldName];
        }
    });

    // 5. MIGRATION DES CLASSES (Noms & Heures personnalisées)
    // On doit déplacer les données de l'ancien ID (ex: "6A") vers le nouvel ID (ex: "N6A")
    // tout en gardant le nom d'affichage "6A".
    
    if (oldPrefix !== newPrefix) {
        // Migration des noms de classes
        const newClassNames = { ...DATA.classNames };
        Object.keys(DATA.classNames).forEach(key => {
            if (key.startsWith(oldPrefix)) {
                // On crée la nouvelle clé (ex: remplace '6' par 'N6' au début)
                // Attention : on utilise une regex pour ne remplacer que le début
                const newKey = key.replace(new RegExp('^' + oldPrefix), newPrefix);
                newClassNames[newKey] = DATA.classNames[key]; // On garde la valeur (le nom affiché)
                delete newClassNames[key]; // On supprime l'ancienne clé
            }
        });
        DATA.classNames = newClassNames;

        // Migration des surcharges horaires (Overrides)
        if (DATA.classOverrides) {
            const newOverrides = { ...DATA.classOverrides };
            Object.keys(DATA.classOverrides).forEach(key => {
                if (key.startsWith(oldPrefix)) {
                    const newKey = key.replace(new RegExp('^' + oldPrefix), newPrefix);
                    newOverrides[newKey] = DATA.classOverrides[key];
                    delete newOverrides[key];
                }
            });
            DATA.classOverrides = newOverrides;
        }
        
        // Migration des affectations Professeurs (Équipes Pédagogiques)
        if (DATA.assignments) {
            const newAssignments = { ...DATA.assignments };
            Object.keys(DATA.assignments).forEach(key => {
                // key est sous forme "CLASSE_PROFINDEX" (ex: "6A_12")
                const parts = key.split('_');
                const cId = parts[0];
                if (cId.startsWith(oldPrefix)) {
                    const newCId = cId.replace(new RegExp('^' + oldPrefix), newPrefix);
                    const newKey = `${newCId}_${parts[1]}`;
                    newAssignments[newKey] = DATA.assignments[key];
                    delete newAssignments[key];
                }
            });
            DATA.assignments = newAssignments;
        }
    }

    saveData();
    renderStructure();
    renderGridSystem();
    renderSubjectsConfig();
    // Rafraîchir les onglets si nécessaire
    if (document.getElementById('equipes').classList.contains('active')) renderTeams();
}
function deleteLevel(idx) {
    const lvlName = DATA.structure[idx].level;
    if(confirm(`Supprimer le niveau "${lvlName}" ?`)) {
        DATA.structure.splice(idx, 1);
        delete DATA.levelConfig[lvlName];
        saveData(); renderStructure(); renderGridSystem();
    }
}

function renderStructure() {
    const tbody = document.getElementById('structure-body');
    tbody.innerHTML = '';
    let totEleves = 0, totDiv = 0, totHeures = 0;
    
    // ON RÉCUPÈRE LES PRÉFIXES UNIQUES ICI
    const allPrefixes = getAllUniquePrefixes();

    DATA.structure.forEach((lvl, idx) => {
        const besoin = lvl.div * lvl.target;
        totEleves += lvl.students; totDiv += lvl.div; totHeures += besoin;
        
        tbody.innerHTML += `<tr>
            <td><b>${lvl.level}</b></td>
            <td><input type="number" value="${lvl.students}" onchange="updStruct(${idx},'students',this.value)"></td>
            <td><input type="number" value="${lvl.div}" onchange="updStruct(${idx},'div',this.value)"></td>
            <td>${lvl.div>0 ? (lvl.students/lvl.div).toFixed(1) : 0}</td>
            <td><input type="number" value="${lvl.target}" step="0.5" style="background:#fffbe6; font-weight:bold; text-align:center;" onchange="updStruct(${idx},'target',this.value)"></td>
            <td style="font-weight:bold; color:var(--primary)">${besoin.toFixed(1)} h</td>
            <td>
                <div style="display:flex; gap:5px; justify-content:center;">
                    <button class="btn-sm btn-warning" onclick="renameLevel(${idx})">✏️</button>
                    <button class="btn-sm btn-danger" onclick="deleteLevel(${idx})">🗑️</button>
                </div>
            </td>
        </tr>`;
    });

    if(!DATA.additionalMeans) DATA.additionalMeans = { total: 0 };
    const suppTotal = parseFloat(DATA.additionalMeans.total || 0);
    totHeures += suppTotal;

    tbody.innerHTML += `
    <tr class="row-supp">
        <td colspan="4" style="text-align:right; font-weight:bold; font-style:italic;">
            Moyens supplémentaires :
        </td>
        <td>
            <div class="supp-label-group">
                <input type="number" class="input-supp" value="${suppTotal}" onchange="updSupp(this.value)">
            </div>
        </td>
        <td style="font-weight:bold;">${suppTotal.toFixed(1)} h</td>
        <td></td>
    </tr>
    `;

    const moyGen = totDiv > 0 ? (totEleves / totDiv).toFixed(1) : 0;
    tbody.innerHTML += `<tr class="structure-total-row"><td>TOTAL GÉNÉRAL</td><td>${totEleves}</td><td>${totDiv}</td><td>${moyGen}</td><td style="text-align:right;">Total Moyens :</td><td style="color:#f1c40f;">${totHeures.toFixed(1)} h</td><td></td></tr>`;
    
    // Génération des inputs de renommage classes (groupés par niveau)
    const c = document.getElementById('class-list-container'); c.innerHTML = '';
    
    DATA.structure.forEach((lvl, idx) => {
        if (lvl.div === 0) return;
        const prefix = allPrefixes[idx];
        let groupHtml = `<div style="margin-bottom:12px; width:100%;">
            <div style="font-size:0.75rem; font-weight:700; color:#7f8c8d; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; border-bottom:1px solid #eee; padding-bottom:4px;">${lvl.level}</div>
            <div style="display:flex; flex-wrap:wrap; gap:8px;">`;
        
        for(let i=0; i<lvl.div; i++) {
            const defId = `${prefix}${String.fromCharCode(65+i)}`;
            const displayName = DATA.classNames && DATA.classNames[defId] ? DATA.classNames[defId] : defId;
            groupHtml += `<div style="display:flex; flex-direction:column; align-items:center; gap:3px;">
                <span style="font-size:0.6rem; color:#aaa; font-family:monospace;">${defId}</span>
                <input type="text" value="${displayName.replace(/"/g, '&quot;')}" 
                    style="width:80px; text-align:center; font-weight:700; color:#2c3e50; border:2px solid var(--secondary); border-radius:5px; padding:4px 6px; font-size:0.85rem; background:white;"
                    onchange="renameClassDirect('${defId}', this.value)"
                    onfocus="this.select()"
                    title="Renommer la classe ${defId}">
            </div>`;
        }
        groupHtml += `</div></div>`;
        c.innerHTML += groupHtml;
    });

    DATA.config.total = totHeures;
    const dbTotal = document.getElementById('dash-total-dhg');
    if(dbTotal) dbTotal.innerText = totHeures;
    const dbDisplay = document.getElementById('global-dhg-display');
    if(dbDisplay) dbDisplay.innerText = totHeures;
    
    saveData();
}
function updStruct(i,f,v) { DATA.structure[i][f] = parseFloat(v); if(f==='div') generateClasses(false); saveData(); renderStructure(); updateMenuVisibility(currentEntity); }
function renameClassDirect(originalId, newName) {
    if (!newName || !newName.trim()) return;
    if (!DATA.classNames) DATA.classNames = {};
    DATA.classNames[originalId] = newName.trim();
    saveData();
}
function updSupp(val) { if(!DATA.additionalMeans) DATA.additionalMeans = { total: 0 }; DATA.additionalMeans.total = parseFloat(val) || 0; saveData(); renderStructure(); }
function generateClasses(conf) {
    // Si on clique sur le bouton "Régénérer", on force le reset (avec confirmation)
    if(conf) {
        if(!confirm("⚠️ Attention : Cela va réinitialiser les noms des classes.\nContinuer ?")) return;
        DATA.classNames = {};
    }

    // Sécurité si l'objet n'existe pas
    if(!DATA.classNames) DATA.classNames = {};
    
    // 1. On récupère les préfixes
    const allPrefixes = getAllUniquePrefixes();
    
    // 2. On parcourt la structure pour AJOUTER ou GARDER les classes
    DATA.structure.forEach((lvl, idx) => {
        const prefix = allPrefixes[idx];
        
        for(let i=0; i<lvl.div; i++) {
            const id = `${prefix}${String.fromCharCode(65+i)}`; // Ex: 12A
            
            // LA CORRECTION EST ICI : 
            // Si le nom n'existe pas, on le crée. 
            // S'il existe déjà (ex: "6ème SEGPA"), on ne le touche pas !
            if (!DATA.classNames[id]) {
                DATA.classNames[id] = id;
            }
        }
    });
    
    // (Optionnel) Nettoyage : On peut supprimer les classes qui seraient "hors limite" 
    // si tu réduis le nombre de divisions (ex: passage de 6 à 5 classes), 
    // mais le plus important est de ne pas écraser les existantes.
    
    saveData();
    renderStructure();
    renderGridSystem();
}

function calculateNeeds() {
    let n = {}; 
    DATA.subjects.forEach(s => n[s] = 0);
    
    DATA.subjects.forEach(s => {
        const meta = DATA.subjectMeta[s] || { mode: 'div', levels: [] };
        
        // EDS : le besoin vient de DATA.eds (groupes × h/groupe × coef), pas de la structure
        if (meta.isEds) {
            if (DATA.eds) {
                ['premiere', 'terminale'].forEach(lvl => {
                    (DATA.eds[lvl] || []).forEach(e => {
                        if (e.name === s) {
                            const coef = parseFloat(e.coef) || 1.0;
                            n[s] += (e.groups || 0) * (e.hPerGroup || (lvl === 'premiere' ? 4 : 6)) * coef;
                        }
                    });
                });
            }
            return;
        }

        // 1. MODE DIVISION
        if(meta.mode === 'div') {
            DATA.structure.forEach(lvl => {
                if(meta.levels && meta.levels.includes(lvl.level)) {
                    const prefix = getLevelPrefix(lvl.level);
                    const cfg = DATA.levelConfig[lvl.level][s] || {base:0, demi:0, marge:0, coef:1.0};
                    const coef = cfg.coef || 1.0;
                    const hours = getEffectiveBase(cfg) + (cfg.marge||0);
                    
                    for(let i=0; i<lvl.div; i++) {
                        const c = `${prefix}${String.fromCharCode(65+i)}`;
                        if (DATA.classOverrides[c] && DATA.classOverrides[c][s]) {
                            const ov = DATA.classOverrides[c][s];
                            n[s] += (getEffectiveBase(ov) + (ov.marge||0)) * coef;
                        } else { 
                            n[s] += hours * coef; 
                        }
                    }
                }
            });
        }
        // 2. MODE NIVEAU
        else if (meta.mode === 'level') {
            DATA.structure.forEach(lvl => {
                const val = meta.volLevel ? parseFloat(meta.volLevel[lvl.level] || 0) : 0;
                n[s] += val;
            });
        }
        // 3. MODE ÉTABLISSEMENT
        else if (meta.mode === 'etab') {
            n[s] += (parseFloat(meta.etab) || 0);
        }
    });
    return n;
}

function renderGridSystem() {
    const tabs = document.getElementById('grid-tabs');
    tabs.innerHTML = DATA.structure.map((l,i) => {
        const pt = getLevelPondType(l.level);
        const badge = pt === 'sup'   ? ' <span style="font-size:0.6rem;color:#8e44ad;vertical-align:super;">×1.25</span>'
                    : pt === 'lycee' ? ' <span style="font-size:0.6rem;color:#8e44ad;vertical-align:super;">×1.1</span>'
                    : '';
        return `<div class="tab ${i===0?'active':''}" onclick="changeTab(this, ${i})">${l.level}${badge}</div>`;
    }).join('');
    
    tabs.innerHTML += `<div class="tab global-tab" onclick="changeTab(this, -1)">🌍 Vue Globale</div>`;
    
    const activeIdx = window.lastActiveGridTab !== undefined ? window.lastActiveGridTab : 0;
    if(activeIdx === -1) {
        const t = tabs.querySelector('.global-tab');
        if(t) { t.classList.add('active'); renderGlobalGrid(); }
    } else {
        const t = tabs.children[activeIdx];
        if(t) { t.classList.add('active'); renderLevelGrid(activeIdx); }
    }
	updateGridCounter();
}

function changeTab(el, idx) {
    document.querySelectorAll('#grid-tabs .tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    window.lastActiveGridTab = idx;
    if(idx === -1) renderGlobalGrid();
    else renderLevelGrid(idx);
}

function renameClass(originalId, btnEl) {
    if(!DATA.classNames) DATA.classNames = {};
    const currentName = DATA.classNames[originalId] || originalId;
    
    // Inline edit – remplace le bouton par un input temporaire
    if(btnEl) {
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.value = currentName;
        inp.style.cssText = 'width:70px; font-weight:700; color:#2c3e50; border:2px solid #3498db; border-radius:4px; padding:2px 4px; font-size:0.85rem; text-align:center;';
        btnEl.replaceWith(inp);
        inp.select();
        const commit = () => {
            const v = inp.value.trim() || currentName;
            DATA.classNames[originalId] = v;
            saveData();
            const activeTab = document.querySelector('#grid-tabs .tab.active');
            if(activeTab && activeTab.innerText.includes('Vue Globale')) renderGlobalGrid();
            else renderGridSystem();
        };
        inp.addEventListener('blur', commit);
        inp.addEventListener('keydown', e => { if(e.key === 'Enter') { e.preventDefault(); inp.blur(); } if(e.key === 'Escape') { inp.value = currentName; inp.blur(); } });
        return;
    }
    // Fallback prompt
    const newName = prompt('Renommer la classe :', currentName);
    if(newName && newName.trim()) {
        DATA.classNames[originalId] = newName.trim();
        saveData();
        const activeTab = document.querySelector('#grid-tabs .tab.active');
        if(activeTab && activeTab.innerText.includes('Vue Globale')) renderGlobalGrid();
        else renderGridSystem(); 
    }
}

function getLevelPondType(levelName) {
    // 'none'  = pas de pondération (collège, lycée pro — TOUS les niveaux)
    // 'lycee' = pondération 1ère/Terminale lycée GT (défaut 1.1)
    // 'sup'   = pondération Pôle Supérieur — TOUS les niveaux (défaut 1.25)
    if (currentEntity === 'college')   return 'none';
    if (currentEntity === 'lycee_pro') return 'none';
    if (currentEntity === 'pole')      return 'sup';  // Tous les niveaux du pôle → sup
    // Lycée GT uniquement : distinguer 2nde (none) de 1ère/Terminale (lycee)
    const n = levelName.toLowerCase().trim();
    if (n.includes('terminale') || n.startsWith('term')) return 'lycee';
    if (n.includes('1ère') || n.includes('1ere') || n.includes('première') || n.match(/^1[eè]/)) return 'lycee';
    return 'none'; // 2nde et autres
}

function getDefaultCoef(levelName) {
    const t = getLevelPondType(levelName);
    if (t === 'lycee') return 1.1;
    if (t === 'sup')   return 1.25;
    return 1.0;
}

function renderLevelGrid(idx) {
    const lvl = DATA.structure[idx]; if(!lvl) return;
    const name = lvl.level; 
    const safeName = name.replace(/'/g, "\\'");

    // 1. RÉCUPÉRATION DES PRÉFIXES UNIQUES (Ex: 12A, 12B...)
    const allPrefixes = getAllUniquePrefixes();
    const prefix = allPrefixes[idx];
    const cont = document.getElementById('grid-container');
    
    // 2. INITIALISATION
    const pondType    = getLevelPondType(name);
    const defaultCoef = getDefaultCoef(name);
    const showCoef    = (pondType !== 'none');
    if(!DATA.levelConfig[name]) DATA.levelConfig[name] = {};
    DATA.subjects.forEach(s => { 
        if(!DATA.levelConfig[name][s]) {
            DATA.levelConfig[name][s] = {base:0, demi:0, marge:0, coef: defaultCoef};
        } else {
            if (pondType === 'none') {
                // Pas de pondération sur ce niveau : forcer coef à 1.0 (nettoie les anciennes valeurs)
                DATA.levelConfig[name][s].coef = 1.0;
            } else if (DATA.levelConfig[name][s].coef === undefined || DATA.levelConfig[name][s].coef === 1.0) {
                // Niveau pondéré, coef pas encore personnalisé → appliquer le défaut
                DATA.levelConfig[name][s].coef = defaultCoef;
            }
            // Si coef déjà personnalisé (≠ 1.0) sur un niveau pondéré → ne pas toucher
        }
    });

    // 3. FILTRAGE MATIÈRES : On masque les spécialités individuelles (isEds) pour la lisibilité
    const visibleSubjects = DATA.subjects.filter(s => {
        const m = DATA.subjectMeta[s];
        if (m.isEds) return false; // Masque les EDS individuels dans cette vue
        if (m.mode === 'etab') return false;
        if (m.mode === 'level') {
            const vol = m.volLevel ? parseFloat(m.volLevel[name] || 0) : 0;
            return vol > 0;
        }
        return (!m.levels || m.levels.includes(name));
    });

    let h = `<div class="grid-wrapper"><table class="grid-table">
    <thead>
        <tr>
            <th class="th-class" style="vertical-align:bottom; padding-bottom:10px;">
                <div style="display:flex;flex-direction:column;align-items:flex-start;gap:3px;">
                    <input type="text" value="${name}"
                        style="font-size:1.05rem;font-weight:700;color:#2c3e50;border:1.5px solid #d5d8dc;border-radius:5px;padding:3px 7px;background:#f8f9fa;width:120px;cursor:pointer;"
                        title="Cliquer pour renommer ce niveau"
                        onchange="renameLevelInline(${idx}, this.value)"
                        onfocus="this.style.borderColor='#3498db';this.style.background='#fff';"
                        onblur="this.style.borderColor='#d5d8dc';this.style.background='#f8f9fa';">
                    <span style="font-size:0.62rem;color:#aaa;font-style:italic;padding-left:4px;">✏️ Cliquer pour renommer</span>
                </div>
            </th>
            ${visibleSubjects.map(s => {
                const safeS = s.replace(/'/g, "\\'");
                return `<th class="th-vertical"><span class="del-badge" onclick="delSubject('${safeS}')">×</span><div class="th-text-wrapper">${s}</div></th>`;
            }).join('')}
            <th class="th-vertical" style="vertical-align:bottom;"><div style="writing-mode:vertical-rl; transform:rotate(180deg); color:#2c3e50; font-weight:bold; height:auto; margin:0 auto;">TOTAL</div></th>
        </tr>
    </thead>
    <tbody>
    
    ${showCoef ? `<tr style="background:#fcf3ff;">
    <td style="text-align:center; font-weight:bold; color:#8e44ad; font-size:0.75rem;" title="Pondération appliquée aux heures de ce niveau">
        Pond.✱<br><span style="font-size:0.62rem;color:#b07fc7;">${pondType==='sup'?'BTS/Sup ×1.25':'1ère/Term ×1.1'}</span>
    </td>
    ${visibleSubjects.map(s => `<td><input class="inp-coef" value="${DATA.levelConfig[name][s].coef || defaultCoef}" onchange="updLvl('${safeName}','${s.replace(/'/g, "\\'")}','coef',this.value)" style="color:#8e44ad;font-weight:700;"></td>`).join('')}
    <td style="background:#f4f6f9;"></td></tr>` : ''}
    
    <tr style="background:#fff;"><td style="text-align:center; font-weight:bold; color:#7f8c8d; font-size:0.75rem;">Off.</td>
    ${visibleSubjects.map(s => {
        const m = DATA.subjectMeta[s];
        if (m.mode === 'level') return `<td style="background:#fdf2e9; color:#d35400; font-weight:bold; text-align:center;">${m.volLevel[name] || 0}</td>`;
        const cfg = DATA.levelConfig[name][s];
        const exprLabel = cfgToExprLabel(cfg);
        const hasDemi = (cfg.demi || 0) > 0;
        const totalEff = getEffectiveBase(cfg);
        return `<td style="padding:2px;"><div style="display:flex;flex-direction:column;align-items:center;gap:1px;">
            <input class="inp-hours${hasDemi?' has-demi':''}" type="text" value="${exprLabel}" title="Entrez un nombre (ex: 3) ou classe entière + demi-classe (ex: 2+(1))" placeholder="ex: 2+(1)" onchange="updLvl('${safeName}','${s.replace(/'/g, "\\'")}','base',this.value)" oninput="updateInpHoursStyle(this)">
            ${hasDemi ? `<span class="inp-demi-label">=&thinsp;${totalEff}h prof</span>` : ''}
        </div></td>`;
    }).join('')}
    <td rowspan="2" id="tot-lvl" style="font-weight:bold; font-size:1.1rem; vertical-align:middle;">-</td></tr>
    
    <tr style="background:#fffcf5;"><td style="text-align:center; font-weight:bold; color:#d35400; font-size:0.65rem;">Autonomie</td>
    ${visibleSubjects.map(s => {
        if (DATA.subjectMeta[s].mode === 'level') return `<td style="background:#fdf2e9;"></td>`; 
        return `<td><input class="inp-marge" value="${DATA.levelConfig[name][s].marge}" onchange="updLvl('${safeName}','${s.replace(/'/g, "\\'")}','marge',this.value)"></td>`;
    }).join('')}
    </tr>
    
    <tr style="height:15px; background:#f4f6f9;"><td colspan="${visibleSubjects.length+2}"></td></tr>`;
    
    // 4. CALCUL DES CLASSES
    let grandTotalLevel = 0;
    let colTotals = {}; 
    visibleSubjects.forEach(s => colTotals[s] = 0);

    for(let i=0; i<lvl.div; i++) {
        const c = `${prefix}${String.fromCharCode(65+i)}`;
        const safeC = c.replace(/'/g, "\\'");
        const isOv = !!DATA.classOverrides[c]; 
        let rowT = 0; 
        const displayName = (DATA.classNames && DATA.classNames[c]) ? DATA.classNames[c] : c;

        h += `<tr style="background:${isOv ? '#eaf2f8' : 'white'}">
            <td class="td-class">
                <button class="class-name-btn" onclick="renameClass('${safeC}',this)" title="Cliquer pour renommer">${displayName}</button>
                <label style="display:block; font-size:0.6rem;"><input type="checkbox" ${isOv?'checked':''} onchange="toggleOv('${safeC}')"> Perso.</label>
            </td>`;
            
        visibleSubjects.forEach(s => {
            if (DATA.subjectMeta[s].mode === 'level') {
                h += `<td style="background:#fdf2e9; color:#ccc; text-align:center;">-</td>`;
            } else {
                let v = isOv && DATA.classOverrides[c][s] ? DATA.classOverrides[c][s] : DATA.levelConfig[name][s];
                const effBase = getEffectiveBase(v);
                const cellTotal = (effBase + (v.marge||0)) * (DATA.levelConfig[name][s].coef || 1.0);
                rowT += cellTotal; colTotals[s] += cellTotal; 
                const exprLabel = cfgToExprLabel(v);
                const hasDemi = (v.demi || 0) > 0;
                h += `<td style="${isOv?'':'opacity:0.6; pointer-events:none;'}"><div class="vertical-stack">
                    <div style="display:flex;flex-direction:column;align-items:center;gap:1px;">
                        <input class="inp-hours${hasDemi?' has-demi':''}" type="text" value="${exprLabel}" placeholder="ex: 2+(1)" title="Entrez un nombre ou ex: 2+(1) pour classe entière+demi" onchange="updOv('${safeC}','${s.replace(/'/g, "\\'")}','base',this.value)" oninput="updateInpHoursStyle(this)">
                        ${hasDemi ? `<span class="inp-demi-label">=&thinsp;${effBase}h prof</span>` : ''}
                    </div>
                    <input class="inp-marge" value="${v.marge}" onchange="updOv('${safeC}','${s.replace(/'/g, "\\'")}','marge',this.value)">
                </div></td>`;
            }
        });
        grandTotalLevel += rowT;
        h += `<td style="font-weight:bold;">${rowT.toFixed(1)}</td></tr>`;
    }

    // 5. LOGIQUE EDS : On affiche uniquement la ligne de résumé global du niveau
    let totalEdsNiveau = 0;
    const lowerName = name.toLowerCase();
    let levelKey = "";
    
    if (lowerName.includes("1") || lowerName.includes("prem")) levelKey = "premiere";
    else if (lowerName.includes("term") || lowerName.includes("tle")) levelKey = "terminale";

    if (levelKey && DATA.eds && DATA.eds[levelKey]) {
        DATA.eds[levelKey].forEach(e => {
            const vol = parseFloat(e.hPerGroup) || (levelKey === 'premiere' ? 4 : 6);
            const coef = parseFloat(e.coef) || 1.0;
            totalEdsNiveau += (parseFloat(e.groups) || 0) * vol * coef;
        });
    }

    if (totalEdsNiveau > 0) {
        h += `<tr style="background:#ebf5fb; font-style:italic; font-weight:bold; color:#2980b9;">
            <td style="text-align:right; padding-right:10px;">🎓 Spécialités (EDS)</td>
            <td colspan="${visibleSubjects.length}" style="text-align:left; padding-left:20px; color:#7f8c8d; font-weight:normal;">
                Volume global calculé dans l'onglet Spécialités
            </td>
            <td>${totalEdsNiveau.toFixed(1)}</td>
        </tr>`;
        grandTotalLevel += totalEdsNiveau;
    }

    // 6. PIED DE TABLEAU
    h += `<tr style="background:#34495e; color:white; font-weight:bold;">
            <td style="text-align:right; padding-right:10px;">TOTAL NIV.</td>`;
    visibleSubjects.forEach(s => {
        const m = DATA.subjectMeta[s];
        if (m.mode === 'level') {
            const vol = parseFloat(m.volLevel[name] || 0);
            h += `<td>${vol.toFixed(1)}</td>`;
            grandTotalLevel += vol;
        } else {
            h += `<td>${colTotals[s].toFixed(1)}</td>`;
        }
    });
    h += `<td id="total-final-grille" style="font-size:1.1rem; color:#f1c40f;">${grandTotalLevel.toFixed(1)}</td></tr>`;

    cont.innerHTML = h + '</tbody></table></div>';

    // Mise à jour des compteurs et KPI
    let totConf = 0; 
    visibleSubjects.forEach(s => {
        const m = DATA.subjectMeta[s];
        if (m.mode === 'level') totConf += parseFloat(m.volLevel[name] || 0);
        else totConf += (DATA.levelConfig[name][s].base + DATA.levelConfig[name][s].marge) * (DATA.levelConfig[name][s].coef || 1);
    });
    const el = document.getElementById('tot-lvl');
    if(el) el.innerText = totConf.toFixed(1);

    updateGridCounter();
}

function renderGlobalGrid() {
    const cont = document.getElementById('grid-container');
    
    // Séparation des matières par mode pour l'organisation des colonnes
    const subjectsDiv = DATA.subjects.filter(s => DATA.subjectMeta[s].mode === 'div');
    const subjectsLevel = DATA.subjects.filter(s => DATA.subjectMeta[s].mode === 'level');
    const subjectsEtab = DATA.subjects.filter(s => DATA.subjectMeta[s].mode === 'etab');
    
    let totalDecharges = 0;
    getEntityTeachers().forEach(t => totalDecharges += (t.decharge || 0));

    let grandTotalTotalEtab = 0; 
    let colTotals = {}; 
    DATA.subjects.forEach(s => colTotals[s] = 0);

    // Construction de l'en-tête de la table
    let h = `<div class="grid-wrapper"><table class="grid-table" style="font-size:0.8rem;">
    <thead><tr><th class="th-class" style="width:100px;">Classe / Niveau</th>
    ${subjectsDiv.map(s => `<th class="th-vertical" style="height:120px;"><div class="th-text-wrapper" style="height:80px;">${s}</div></th>`).join('')}
    ${subjectsLevel.map(s => `<th class="th-vertical" style="height:120px; background:#fdf2e9; border-bottom:2px solid #e67e22;"><div class="th-text-wrapper" style="height:80px; color:#d35400;">${s}<br>(Niv)</div></th>`).join('')}
    ${subjectsEtab.map(s => `<th class="th-vertical" style="height:120px; background:#e8f8f5; border-bottom:2px solid #1abc9c;"><div class="th-text-wrapper" style="height:80px; color:#16a085;">${s}<br>(Etab)</div></th>`).join('')}
    <th class="th-vertical" style="height:120px; background:#fffcf5; border-bottom:2px solid #f39c12;"><div class="th-text-wrapper" style="height:80px; color:#d35400;">Dégagements<br>(Interne)</div></th>
    <th class="th-vertical" style="height:120px;"><div style="writing-mode:vertical-rl; transform:rotate(180deg); margin:0 auto;">Total</div></th>
    </tr></thead><tbody>`;

    const allPrefixes = getAllUniquePrefixes();

    DATA.structure.forEach((lvl, idx) => {
        const name = lvl.level;
        const prefix = allPrefixes[idx];
        
        let levelColTotals = {};
        DATA.subjects.forEach(s => levelColTotals[s] = 0);
        let levelRowTotalTC = 0;

        // --- 1. AFFICHAGE DES CLASSES ---
        for(let i=0; i<lvl.div; i++) {
             const c = `${prefix}${String.fromCharCode(65+i)}`;
             const displayName = (DATA.classNames && DATA.classNames[c]) ? DATA.classNames[c] : c;
             let rowTotal = 0;
             
             h += `<tr><td style="font-weight:bold; padding-left:15px;">${displayName}</td>`;
             
             subjectsDiv.forEach(s => {
                 let val = 0;
                 if(DATA.subjectMeta[s].levels && DATA.subjectMeta[s].levels.includes(name)) {
                     const isOv = DATA.classOverrides[c] && DATA.classOverrides[c][s];
                     const cfg = isOv ? DATA.classOverrides[c][s] : DATA.levelConfig[name][s];
                     val = (getEffectiveBase(cfg) + (cfg.marge||0)) * (cfg.coef || 1.0);
                 }
                 if(val > 0) {
                     levelColTotals[s] += val; 
                     colTotals[s] += val;      
                     rowTotal += val;
                 }
                 h += `<td>${val > 0 ? parseFloat(val.toFixed(2)) : '-'}</td>`;
             });
             
             // Colonnes vides pour les modes Hors-Division au niveau de la classe
             subjectsLevel.forEach(s => h += `<td style="background:#fdf2e9; opacity:0.5;">-</td>`);
             subjectsEtab.forEach(s => h += `<td style="background:#e8f8f5; opacity:0.5;">-</td>`);
             h += `<td style="background:#fffcf5; opacity:0.5;">-</td>`;
             h += `<td style="font-weight:bold;">${parseFloat(rowTotal.toFixed(2))}</td></tr>`;
             levelRowTotalTC += rowTotal;
        }

        // --- 2. GESTION DES EDS (Spécialités Lycée) ---
        let totalEdsNiveau = 0;
        let levelKey = "";
        const lowerName = name.toLowerCase();
        
        if (lowerName.match(/1ère|1er|1g|premi/)) {
            levelKey = "premiere";
        } else if (lowerName.match(/term|tle|tg/)) {
            levelKey = "terminale";
        }
        
        if (levelKey && DATA.eds && DATA.eds[levelKey]) {
            DATA.eds[levelKey].forEach(e => {
                const vol = parseFloat(e.hPerGroup) || (levelKey === 'premiere' ? 4 : 6);
                const coef = parseFloat(e.coef) || 1.0;
                totalEdsNiveau += (parseFloat(e.groups) || 0) * vol * coef;
            });
        }

        // Affichage de la ligne EDS si applicable
        if (totalEdsNiveau > 0) {
            h += `<tr style="background:#ebf5fb; font-style:italic;">
                <td style="text-align:left; padding-left:25px; color:#2980b9;">↳ Spécialités (EDS)</td>
                <td colspan="${subjectsDiv.length}" style="color:#7f8c8d; font-size:0.75rem; text-align:center;">Volume global du niveau</td>`;
            
            subjectsLevel.forEach(s => h += `<td style="background:#fdf2e9; opacity:0.5;">-</td>`);
            subjectsEtab.forEach(s => h += `<td style="background:#e8f8f5; opacity:0.5;">-</td>`);
            h += `<td style="background:#fffcf5; opacity:0.5;">-</td>`;
            h += `<td style="font-weight:bold; color:#2980b9;">${totalEdsNiveau.toFixed(1)}</td></tr>`;
        }

        // --- 3. SOUS-TOTAL DU NIVEAU ---
        h += `<tr style="background:#ecf0f1; border-top:1px solid #bdc3c7; font-weight:bold;">
            <td style="text-align:right; color:#2c3e50; font-style:italic;">SOUS-TOTAL ${name.toUpperCase()}</td>`;
        
        let subRowSum = totalEdsNiveau; 
        subjectsDiv.forEach(s => {
            const val = levelColTotals[s];
            subRowSum += val;
            h += `<td style="font-size:0.85rem;">${val > 0 ? parseFloat(val.toFixed(2)) : '-'}</td>`;
        });

        subjectsLevel.forEach(s => {
            const val = DATA.subjectMeta[s].volLevel ? parseFloat(DATA.subjectMeta[s].volLevel[name] || 0) : 0;
            colTotals[s] += val;
            subRowSum += val;
            h += `<td style="background:#fae5d3; color:#d35400;">${val > 0 ? val.toFixed(1) : '-'}</td>`;
        });

        subjectsEtab.forEach(s => h += `<td style="background:#e8f8f5;">-</td>`);
        h += `<td style="background:#fffcf5;">-</td>`;

        grandTotalTotalEtab += subRowSum; 
        h += `<td style="background:#bdc3c7; color:#2c3e50;">${subRowSum.toFixed(1)}</td></tr>`;
    });

    // --- 4. PIED DE TABLEAU (TOTAL GÉNÉRAL ÉTABLISSEMENT) ---
    h += `<tr style="background:#2c3e50; color:white; font-weight:bold; border-top:3px solid #34495e;">
          <td style="text-align:right; padding-right:10px;">TOTAL GÉNÉRAL</td>`;
    
    subjectsDiv.forEach(s => h += `<td>${colTotals[s] > 0 ? colTotals[s].toFixed(1) : '-'}</td>`);
    subjectsLevel.forEach(s => h += `<td style="color:#e67e22;">${colTotals[s] > 0 ? colTotals[s].toFixed(1) : '-'}</td>`);
    
    // Affichage forcé des matières au forfait Établissement
    subjectsEtab.forEach(s => {
        let val = parseFloat(DATA.subjectMeta[s].etab || 0);
        grandTotalTotalEtab += val;
        h += `<td style="color:#1abc9c; font-size:1rem;">${val > 0 ? val.toFixed(1) : '0.0'}</td>`;
    });
    
    h += `<td style="background:#f39c12; color:white; font-size:1rem;">${totalDecharges > 0 ? totalDecharges.toFixed(1) : '-'}</td>`;
    grandTotalTotalEtab += totalDecharges;

    h += `<td style="background:#16a085; color:white; font-size:1.2rem;">${grandTotalTotalEtab.toFixed(1)}</td></tr>`;

    cont.innerHTML = h + '</tbody></table></div>';
}

function openWeightingMenu() {
    const choice = prompt("Gestion des Coefficients (Pondération)\n\nEntrez une valeur pour l'appliquer à TOUTES les matières.\n\n(Laissez vide pour annuler)");
    if(choice) {
        const val = parseFloat(choice);
        if(!isNaN(val)) {
            if(confirm(`Appliquer le coefficient ${val} à TOUTES les matières de TOUS les niveaux ?`)) {
                DATA.structure.forEach(l => {
                    DATA.subjects.forEach(s => {
                        if(DATA.levelConfig[l.level][s]) DATA.levelConfig[l.level][s].coef = val;
                    });
                });
                saveData();
                renderGridSystem();
                alert("✅ Coefficients mis à jour !");
            }
        }
    }
}

function addSubject(){ openAddSubjectModal(); }

/** Crée une sur-matière de type "Regroupement" */
function addGroupSubject() {
    let overlay = document.getElementById('add-group-subject-modal');
    if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'add-group-subject-modal';
        overlay.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:30000; justify-content:center; align-items:center;';
        document.body.appendChild(overlay);
    }

    // Liste des matières existantes pour rattachement immédiat
    const sortedSubs = [...DATA.subjects].sort();
    const checkboxes = sortedSubs
        .filter(s => DATA.subjectMeta[s]?.mode !== 'group')
        .map(s => `<label style="display:flex;align-items:center;gap:6px;padding:4px 0;cursor:pointer;">
            <input type="checkbox" value="${s.replace(/"/g,'&quot;')}" style="width:16px;height:16px;">
            <span>${s}</span>
        </label>`).join('');

    overlay.innerHTML = `
        <div style="background:white; border-radius:12px; padding:28px; width:480px; max-width:95vw; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h3 style="margin:0; color:#6c3483;">📂 Nouvelle Sur-Matière</h3>
                <button onclick="document.getElementById('add-group-subject-modal').style.display='none'" style="background:none;border:none;font-size:1.4rem;cursor:pointer;color:#999;">×</button>
            </div>
            <p style="font-size:0.85rem; color:#666; margin-bottom:16px; background:#f5eef8; padding:10px; border-radius:6px; border-left:4px solid #8e44ad;">
                Une <b>sur-matière</b> regroupe plusieurs disciplines pour le comptage des heures d'un enseignant. Elle n'apparaît pas dans la grille horaire.
            </p>
            <div style="margin-bottom:16px;">
                <label style="font-weight:600; display:block; margin-bottom:6px;">Nom du regroupement :</label>
                <input id="new-group-name" placeholder="Ex: Sciences LP, Lettres-Histoire..." 
                    style="width:100%; padding:10px; border:2px solid #8e44ad; border-radius:6px; font-size:1rem; box-sizing:border-box;">
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-weight:600; display:block; margin-bottom:8px;">Rattacher des matières existantes :</label>
                <div style="max-height:200px; overflow-y:auto; border:1px solid #ddd; border-radius:6px; padding:8px 12px; background:#fafafa;">
                    ${checkboxes || '<em style="color:#aaa; font-size:0.85rem;">Aucune matière disponible</em>'}
                </div>
                <small style="color:#888; margin-top:4px; display:block;">Vous pourrez aussi rattacher des matières plus tard via la colonne "Parent"</small>
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button onclick="document.getElementById('add-group-subject-modal').style.display='none'" 
                    style="padding:8px 20px; border:1px solid #ddd; border-radius:6px; background:#f5f5f5; cursor:pointer;">Annuler</button>
                <button onclick="confirmAddGroupSubject()" 
                    style="padding:8px 20px; border:none; border-radius:6px; background:#8e44ad; color:white; font-weight:600; cursor:pointer;">📂 Créer</button>
            </div>
        </div>`;

    overlay.style.display = 'flex';
    setTimeout(() => { const inp = document.getElementById('new-group-name'); if(inp) inp.focus(); }, 100);
}

function confirmAddGroupSubject() {
    const nameEl = document.getElementById('new-group-name');
    const s = (nameEl?.value || '').trim();
    if (!s) { alert('Veuillez saisir un nom.'); return; }
    if (DATA.subjects.includes(s)) { alert('Ce nom existe déjà !'); return; }

    // Créer la sur-matière
    DATA.subjects.push(s);
    DATA.subjectMeta[s] = { mode: 'group', levels: [], etab: 0, volLevel: {}, parent: '', code: '', pneCode: '' };
    // Pas de colonne dans la grille horaire pour les sur-matières

    // Rattacher les matières cochées
    const checkboxes = document.querySelectorAll('#add-group-subject-modal input[type=checkbox]:checked');
    checkboxes.forEach(cb => {
        const childName = cb.value;
        if (DATA.subjectMeta[childName]) {
            DATA.subjectMeta[childName].parent = s;
        }
    });

    saveData();
    renderSubjectsConfig();
    renderRH();
    document.getElementById('add-group-subject-modal').style.display = 'none';
}

/** Modal: ajoute une matière via liste déroulante prédictive avec code automatique */
function openAddSubjectModal() {
    // Construire la liste de toutes les disciplines PNE
    let allDisciplines = [];
    Object.entries(PNE_BUREAUX).forEach(([bureauId, bureau]) => {
        Object.entries(bureau.disciplines).forEach(([code, label]) => {
            allDisciplines.push({code, label, bureau: bureau.label, bureauId});
        });
    });
    allDisciplines.sort((a,b) => a.label.localeCompare(b.label, 'fr'));

    // Créer/réinitialiser l'overlay
    let overlay = document.getElementById('add-subject-modal');
    if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'add-subject-modal';
        overlay.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:30000; justify-content:center; align-items:center;';
        document.body.appendChild(overlay);
    }

    const datalistOptions = allDisciplines.map(d => `<option value="${d.label}" data-code="${d.code}">${d.label} (${d.code})</option>`).join('');

    overlay.innerHTML = `
        <div style="background:white; border-radius:12px; padding:30px; width:500px; max-width:95vw; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0; color:#2c3e50;">➕ Nouvelle Matière</h3>
                <button onclick="document.getElementById('add-subject-modal').style.display='none'" style="background:none;border:none;font-size:1.4rem;cursor:pointer;color:#999;">×</button>
            </div>
            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Nom de la matière :</label>
                <input id="new-subject-name" list="pne-discipline-list" 
                    placeholder="Tapez pour chercher une discipline..." 
                    style="width:100%; padding:10px; border:2px solid #3498db; border-radius:6px; font-size:1rem; box-sizing:border-box;"
                    oninput="onSubjectNameInput(this.value)">
                <datalist id="pne-discipline-list">${datalistOptions}</datalist>
                <small style="color:#888; margin-top:4px; display:block;">Vous pouvez aussi saisir un nom libre</small>
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Code PNE (auto-rempli) :</label>
                <div style="display:flex; gap:8px; align-items:center;">
                    <input id="new-subject-code" placeholder="Ex: L1300" 
                        style="width:120px; padding:8px; border:1px solid #ddd; border-radius:6px; font-family:monospace; font-size:0.9rem; text-align:center;">
                    <div id="new-subject-bureau" style="font-size:0.82rem; color:#666; flex:1;"></div>
                </div>
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button onclick="document.getElementById('add-subject-modal').style.display='none'" 
                    style="padding:8px 20px; border:1px solid #ddd; border-radius:6px; background:#f5f5f5; cursor:pointer;">Annuler</button>
                <button onclick="confirmAddSubject()" 
                    style="padding:8px 20px; border:none; border-radius:6px; background:#3498db; color:white; font-weight:600; cursor:pointer;">✓ Ajouter</button>
            </div>
        </div>`;
    
    overlay.style.display = 'flex';
    
    // Stocker les disciplines pour la recherche
    window._allPneDisciplines = allDisciplines;
    
    setTimeout(() => {
        const inp = document.getElementById('new-subject-name');
        if (inp) inp.focus();
    }, 100);
}

/** Appelé quand l'utilisateur tape dans le champ nom de matière */
function onSubjectNameInput(value) {
    const disciplines = window._allPneDisciplines || [];
    // Chercher une correspondance exacte (label)
    const match = disciplines.find(d => d.label.toLowerCase() === value.toLowerCase());
    if (match) {
        document.getElementById('new-subject-code').value = match.code;
        // Afficher le bureau PNE
        const bureauId = getBureauForCode(match.code);
        if (bureauId) {
            const b = PNE_BUREAUX[bureauId];
            document.getElementById('new-subject-bureau').innerHTML = 
                `<span style="background:${b.color}20; color:${b.color}; font-weight:700; padding:2px 8px; border-radius:4px;">${bureauId}</span> ${b.label}`;
        }
    } else {
        // Essayer une correspondance partielle (contient)
        const partial = disciplines.find(d => d.label.toLowerCase().startsWith(value.toLowerCase()));
        if (!partial) {
            // Vérifier si la valeur tape exactement une option du datalist
            const opt = disciplines.find(d => `${d.label} (${d.code})` === value || d.label === value);
            if (!opt) {
                document.getElementById('new-subject-bureau').textContent = '';
            }
        }
    }
}

/** Valide l'ajout de la nouvelle matière */
function confirmAddSubject() {
    const nameEl = document.getElementById('new-subject-name');
    const codeEl = document.getElementById('new-subject-code');
    
    // Nettoyer le nom si l'utilisateur a sélectionné depuis le datalist (format "label (code)")
    let s = (nameEl.value || '').trim();
    const matchDatalist = s.match(/^(.+?)\s+\(([A-Z0-9]+)\)$/);
    if (matchDatalist) {
        s = matchDatalist[1];
        if (!codeEl.value) codeEl.value = matchDatalist[2];
    }
    
    const code = (codeEl.value || '').trim();
    
    if (!s) { alert('Veuillez saisir un nom de matière.'); return; }
    if (DATA.subjects.includes(s)) { alert('Cette matière existe déjà !'); document.getElementById('add-subject-modal').style.display='none'; return; }
    
    DATA.subjects.push(s);
    DATA.subjectMeta[s] = {
        mode: 'div', 
        levels: getDefaultActiveLevels(s), 
        etab: 0, 
        volLevel: {}, 
        parent: "", 
        code: code,
        pneCode: code
    };
    DATA.structure.forEach(l => {
        if (!DATA.levelConfig[l.level]) DATA.levelConfig[l.level] = {};
        DATA.levelConfig[l.level][s] = {base:0, demi:0, marge:0, coef:1.0};
    });
    
    saveData(); 
    renderGridSystem(); 
    renderRH(); 
    renderSubjectsConfig();
    
    document.getElementById('add-subject-modal').style.display = 'none';
}

function delSubject(s) { if(confirm("Supprimer ?")) { DATA.subjects=DATA.subjects.filter(sub=>sub!==s); delete DATA.subjectMeta[s]; Object.keys(DATA.levelConfig).forEach(l=>delete DATA.levelConfig[l][s]); saveData(); renderSubjectsConfig(); renderGridSystem(); renderRH(); } }

/**
 * Parse une expression horaire.
 * Formats acceptés :
 *   "3"        → { base: 3, demi: 0, total: 3,  label: "3"      }
 *   "2+(1)"    → { base: 2, demi: 1, total: 4,  label: "2+(1)"  }
 *   "1.5+(0.5)"→ { base:1.5,demi:0.5,total:2.5, label:"1.5+(0.5)"}
 *   "0"        → { base: 0, demi: 0, total: 0,  label: "0"      }
 * total = base + 2 × demi  (la demi-classe compte double en heures prof)
 */
function parseHoursExpr(str) {
    if (str === null || str === undefined) return { base: 0, demi: 0, total: 0, label: '0' };
    var s = String(str).trim();
    // Format "X+(Y)" avec parenthèses
    var m = s.match(/^([0-9]*\.?[0-9]+)\s*\+\s*\(([0-9]*\.?[0-9]+)\)$/);
    if (m) {
        var base = parseFloat(m[1]) || 0;
        var demi = parseFloat(m[2]) || 0;
        return { base: base, demi: demi, total: Math.round((base + 2 * demi) * 100) / 100, label: base + '+('+demi+')' };
    }
    // Format numérique simple
    var n = parseFloat(s);
    if (!isNaN(n)) return { base: n, demi: 0, total: n, label: s };
    return { base: 0, demi: 0, total: 0, label: '0' };
}

/** Retourne le total effectif (heures prof) depuis un cfg levelConfig */
function getEffectiveBase(cfg) {
    if (!cfg) return 0;
    var base = parseFloat(cfg.base) || 0;
    var demi = parseFloat(cfg.demi) || 0;
    return Math.round((base + 2 * demi) * 100) / 100;
}

/** Construit le label visuel d'un cfg pour affichage dans l'input */
function cfgToExprLabel(cfg) {
    if (!cfg) return '0';
    var base = parseFloat(cfg.base) || 0;
    var demi = parseFloat(cfg.demi) || 0;
    if (demi > 0) return base + '+(' + demi + ')';
    return String(base);
}

/** Feedback visuel immédiat sur l'input quand l'utilisateur tape */
function updateInpHoursStyle(input) {
    var parsed = parseHoursExpr(input.value);
    var hasDemi = parsed.demi > 0;
    input.classList.toggle('has-demi', hasDemi);
    var label = input.parentNode.querySelector('.inp-demi-label');
    if (hasDemi) {
        if (!label) {
            label = document.createElement('span');
            label.className = 'inp-demi-label';
            input.parentNode.appendChild(label);
        }
        label.innerHTML = '=\u2009' + parsed.total + 'h prof';
    } else {
        if (label) label.remove();
    }
}

function updLvl(l, s, k, v) {
    if (k === 'base') {
        // v peut être "2+(1)" ou "3"
        var parsed = parseHoursExpr(v);
        DATA.levelConfig[l][s].base = parsed.base;
        DATA.levelConfig[l][s].demi = parsed.demi;
    } else {
        DATA.levelConfig[l][s][k] = parseFloat(v) || 0;
    }
    saveData();
	updateGridCounter();
    if (k === 'marge' || k === 'base') {
        const prefix = l.replace(/[^0-9]/g, '') || l.charAt(0);
        let ignoredClasses = [];
        Object.keys(DATA.classOverrides).forEach(c => {
            if (c.startsWith(prefix)) { 
                if (DATA.classOverrides[c][s]) {
                    const displayName = (DATA.classNames && DATA.classNames[c]) ? DATA.classNames[c] : c;
                    ignoredClasses.push(displayName);
                }
            }
        });
        if (ignoredClasses.length > 0) {
            alert(`⚠️ ATTENTION :\n\nVous avez modifié la ${k === 'marge' ? 'marge' : 'base'} pour tout le niveau ${l}.\n\nCependant, les classes suivantes sont en mode "Personnalisé" et n'ont PAS été modifiées :\n\n👉 ${ignoredClasses.join(', ')}\n\nPensez à vérifier leurs horaires manuellement.`);
        }
    }
    renderLevelGrid(DATA.structure.findIndex(x => x.level === l));
}
function toggleOv(c){ 
    if(DATA.classOverrides[c]) delete DATA.classOverrides[c]; 
    else { 
        let foundLvl = null;
        for(let l of DATA.structure) {
            let p = l.level.replace(/[^0-9]/g, '') || l.level.charAt(0);
            if(c.startsWith(p)) { foundLvl=l.level; break; }
        }
        if(foundLvl) DATA.classOverrides[c]=JSON.parse(JSON.stringify(DATA.levelConfig[foundLvl])); 
    } 
    saveData(); 
    const activeTab = document.querySelector('.tab.active');
    if(activeTab) changeTab(activeTab, window.lastActiveGridTab);
}
function updOv(c,s,k,v){ 
    if (k === 'base') {
        var parsed = parseHoursExpr(v);
        DATA.classOverrides[c][s].base = parsed.base;
        DATA.classOverrides[c][s].demi = parsed.demi;
    } else {
        DATA.classOverrides[c][s][k] = parseFloat(v)||0;
    }
    saveData(); 
	updateGridCounter();
    const activeTab = document.querySelector('.tab.active');
    if(activeTab) changeTab(activeTab, window.lastActiveGridTab);
}

function renderSubjectsConfig() { 
    const t = document.getElementById('subjects-body'); 
    t.innerHTML = ''; 
    
    const sortedSubjects = [...DATA.subjects].sort();

    function renderSubjectRow(s, isChild) {
        const m = DATA.subjectMeta[s];
        if (!m) return;
        const safeS = s.replace(/'/g, "\\'"); 

        let parentOptions = `<option value="">(Aucun - Racine)</option>`;
        sortedSubjects.forEach(parentName => {
            if (parentName !== s) {
                const isSelected = m.parent === parentName ? 'selected' : '';
                parentOptions += `<option value="${parentName}" ${isSelected}>${parentName}</option>`;
            }
        });

        const linkCount = (m.linkedSubjects && m.linkedSubjects.length > 0) ? m.linkedSubjects.length : 0;
        const btnStyle = linkCount > 0 
            ? "background:#3498db; color:white; border:1px solid #2980b9;" 
            : "background:white; color:#7f8c8d; border:1px solid #bdc3c7;";
        const linkedBtn = `<button class="btn btn-sm" style="${btnStyle} width:100%; display:flex; justify-content:center; align-items:center; gap:5px;" onclick="openLinkedSubjectsModal('${safeS}')"><span>🔗</span><span style="background:rgba(0,0,0,0.2); padding:1px 6px; border-radius:10px; font-size:0.75rem;">${linkCount}</span></button>`;

        let paramHtml = "";
        const isGroup = m.mode === 'group';
        if (isGroup) {
            const childCount = DATA.subjects.filter(cs => DATA.subjectMeta[cs]?.parent === s).length;
            paramHtml = `<span style="font-size:0.8rem; color:#8e44ad; font-style:italic;">📂 ${childCount} discipline(s) rattachée(s)</span>`;
        } else if (m.mode === 'div') {
            paramHtml = `<div class="lvl-check-container">`;
            DATA.structure.forEach(lvl => {
                const isChecked = m.levels && m.levels.includes(lvl.level);
                const safeLvl = lvl.level.replace(/'/g, "\\'");
                paramHtml += `<label class="lvl-check-item"><input type="checkbox" ${isChecked?'checked':''} onchange="toggleSubLevel('${safeS}','${safeLvl}')">${lvl.level}</label>`;
            });
            paramHtml += `</div>`;
        } else if (m.mode === 'level') {
            paramHtml = `<div style="display:flex; flex-wrap:wrap; gap:8px;">`;
            DATA.structure.forEach(lvl => {
                const val = m.volLevel ? (m.volLevel[lvl.level] || 0) : 0;
                const safeLvl = lvl.level.replace(/'/g, "\\'");
                paramHtml += `<div class="lvl-input-item" style="background:#fff; border:1px solid #ddd; padding:2px 6px; border-radius:4px;"><span style="font-size:0.8rem; font-weight:bold;">${lvl.level}:</span><input type="number" step="0.5" value="${val}" style="width:50px !important; text-align:center; height:24px;" onchange="updSubVolLevel('${safeS}','${safeLvl}',this.value)"></div>`;
            });
            paramHtml += `</div>`;
        } else if (m.mode === 'etab') {
             paramHtml = `<div class="lvl-input-item"><span style="font-weight:bold; color:#16a085;">Forfait :</span><input type="number" step="0.5" value="${m.etab||0}" style="width:80px !important; text-align:center; font-weight:bold; color:#16a085; border:2px solid #1abc9c; margin-left: 10px;" onchange="updSubEtab('${safeS}',this.value)"></div>`;
        }

        const rowBg = isGroup ? 'background:#f0ebf8; border-left:4px solid #8e44ad;' 
                    : isChild ? 'background:#fafafa; border-left:4px solid #d5c8ea;' 
                    : '';
        const nameInputStyle = isGroup ? 'font-weight:bold; color:#6c3483; font-size:1rem;' : 'font-weight:bold;';
        const prefix = isGroup ? '📂 ' : (isChild ? '<span style="color:#8e44ad;margin-right:4px;padding-left:16px;">↳</span>' : '');

        // Calculer le HTML du champ PNE en dehors du template literal pour éviter les imbrications
        const _parentMeta = m.parent ? DATA.subjectMeta[m.parent] : null;
        const _isChildOfGroup = _parentMeta && _parentMeta.mode === 'group';
        let pneCellHtml;
        if (_isChildOfGroup) {
            const _inheritedCode = m.pneCode || '';
            const _bureauName = _inheritedCode ? (getBureauForCode(_inheritedCode) || '') : '';
            const _bureauColor = _inheritedCode && PNE_BUREAUX[getBureauForCode(_inheritedCode)] ? PNE_BUREAUX[getBureauForCode(_inheritedCode)].color : '#aaa';
            const _bureauSpan = _bureauName ? '<span style="font-size:0.65rem; color:' + _bureauColor + '; font-weight:700; display:block;">' + _bureauName + '</span>' : '';
            pneCellHtml = '<div title="Code PNE hérité du groupe ' + (m.parent||'') + '" style="font-family:monospace; font-size:0.75rem; color:#6c3483; background:#f0ebf8; border:1px solid #d5c8ea; border-radius:4px; padding:3px 5px; text-align:center; cursor:default;">🔒 ' + (_inheritedCode || '–') + _bureauSpan + '</div>';
        } else {
            const _pneOptions = Object.entries(PNE_BUREAUX).map(([bid, b]) =>
                '<optgroup label="' + bid + '">' + Object.entries(b.disciplines).map(([code, lbl]) =>
                    '<option value="' + code + '" ' + (m.pneCode === code ? 'selected' : '') + '>' + code + ' – ' + lbl + '</option>'
                ).join('') + '</optgroup>'
            ).join('');
            const _bureauBadge = m.pneCode && PNE_BUREAUX[getBureauForCode(m.pneCode)]
                ? '<span style="font-size:0.65rem; color:' + (PNE_BUREAUX[getBureauForCode(m.pneCode)].color||'#aaa') + '; font-weight:700; display:block; margin-top:2px;">' + (getBureauForCode(m.pneCode)||'') + '</span>'
                : '';
            pneCellHtml = '<select style="font-size:0.75rem; width:100%; padding:3px;" onchange="updateSubjectMeta(\'' + safeS + '\',\'pneCode\',this.value)" title="Code PNE"><option value="">– PNE –</option>' + _pneOptions + '</select>' + _bureauBadge;
        }

        t.innerHTML += `<tr style="${rowBg}">
            <td style="width:80px;"><input type="text" value="${m.code||''}" placeholder="Code" style="font-family:monospace; text-align:center;" onchange="updateSubjectMeta('${safeS}','code',this.value)"></td>
            <td>${prefix}<input type="text" value="${s}" style="${nameInputStyle}" onchange="renameSubject('${safeS}',this.value)"></td>
            <td style="width:100px; text-align:center;">${pneCellHtml}</td>
            <td style="width:180px;"><select style="font-size:0.9rem;" onchange="updateSubjectMeta('${safeS}','parent',this.value)">${parentOptions}</select></td>
            <td style="width:140px; text-align:center;">${isGroup ? '<span style="color:#ccc;font-size:0.8rem;">–</span>' : linkedBtn}</td>
            <td style="width:160px;">
                <select onchange="updateSubjectMeta('${safeS}','mode',this.value)">
                    <option value="div" ${m.mode==='div'?'selected':''}>Division</option>
                    <option value="level" ${m.mode==='level'?'selected':''}>Niveau</option>
                    <option value="etab" ${m.mode==='etab'?'selected':''}>Établissement</option>
                    <option value="group" ${m.mode==='group'?'selected':''}>Regroupement</option>
                </select>
            </td>
            <td style="text-align:left;">${paramHtml}</td>
            <td style="width:50px;"><button class="btn btn-danger btn-sm" onclick="delSubject('${safeS}')">×</button></td>
        </tr>`;

        // Enfants sous le groupe
        if (isGroup) {
            sortedSubjects
                .filter(cs => DATA.subjectMeta[cs]?.parent === s)
                .forEach(cs => renderSubjectRow(cs, true));
        }
    }

    // 1. Sur-matières (mode=group) avec leurs enfants
    const groupRoots = roots => roots.filter(s => DATA.subjectMeta[s]?.mode === 'group');
    const normalRoots = roots => roots.filter(s => DATA.subjectMeta[s]?.mode !== 'group');
    const topLevel = sortedSubjects.filter(s => !DATA.subjectMeta[s]?.parent);
    const childrenOfGroups = new Set(
        sortedSubjects.filter(s => {
            const p = DATA.subjectMeta[s]?.parent;
            return p && DATA.subjectMeta[p]?.mode === 'group';
        })
    );

    // Afficher groupes avec enfants, puis matières normales de racine
    groupRoots(topLevel).forEach(s => renderSubjectRow(s, false));
    normalRoots(topLevel).forEach(s => renderSubjectRow(s, false));
    // Orphelins (parent défini mais non-group ou manquant)
    sortedSubjects
        .filter(s => DATA.subjectMeta[s]?.parent && !childrenOfGroups.has(s))
        .forEach(s => renderSubjectRow(s, true));
}


/**
 * Active ou désactive le lien entre deux matières
 * @param {string} targetSubject - La matière principale (ex: "Ens. Scientifique")
 * @param {string} linkedSubject - La matière à autoriser (ex: "Maths")
 */
function toggleLinkedSubject(targetSubject, linkedSubject) {
    if (!DATA.subjectMeta[targetSubject]) return;
    
    // Initialisation du tableau si inexistant
    if (!DATA.subjectMeta[targetSubject].linkedSubjects) {
        DATA.subjectMeta[targetSubject].linkedSubjects = [];
    }
    
    const arr = DATA.subjectMeta[targetSubject].linkedSubjects;
    const idx = arr.indexOf(linkedSubject);
    
    if (idx > -1) {
        // Si existe déjà, on retire
        arr.splice(idx, 1);
    } else {
        // Sinon, on ajoute
        arr.push(linkedSubject);
    }
    
    saveData();
    // On ne recharge pas toute la vue pour ne pas perdre le scroll ou le focus,
    // La sauvegarde suffit car l'état visuel (checked) a déjà changé via le clic.
}

function updateSubjectMeta(s,f,v){ 
    if(!DATA.subjectMeta[s]) DATA.subjectMeta[s]={}; 
    DATA.subjectMeta[s][f]=v; 
    
    // Si on met à jour le code PNE, on met aussi à jour le bureau automatiquement
    if(f === 'pneCode' || f === 'code') {
        const code = v;
        const bureau = getBureauForCode(code);
        DATA.subjectMeta[s].bureau = bureau || '';
        
        // Si c'est un groupe (sur-matière), propager le code PNE à toutes ses sous-matières
        if(DATA.subjectMeta[s]?.mode === 'group') {
            DATA.subjects.forEach(child => {
                if(DATA.subjectMeta[child]?.parent === s) {
                    DATA.subjectMeta[child].pneCode = v;
                    DATA.subjectMeta[child].bureau = bureau || '';
                }
            });
        }
    }
    
    // Si on assigne un parent à cette matière, hériter du code PNE si le parent est un groupe
    if(f === 'parent') {
        const parentMeta = DATA.subjectMeta[v];
        if(parentMeta && parentMeta.mode === 'group' && parentMeta.pneCode) {
            DATA.subjectMeta[s].pneCode = parentMeta.pneCode;
            DATA.subjectMeta[s].bureau = getBureauForCode(parentMeta.pneCode) || '';
        }
    }
    
    if(f === 'mode') {
         if(v === 'div' && !DATA.subjectMeta[s].levels) DATA.subjectMeta[s].levels = getDefaultActiveLevels(s);
         if(v === 'level' && !DATA.subjectMeta[s].volLevel) DATA.subjectMeta[s].volLevel = {};
    }
    
    saveData(); 
    renderSubjectsConfig();
}
function toggleSubLevel(s, lvl) {
    if(!DATA.subjectMeta[s].levels) DATA.subjectMeta[s].levels = [];
    const arr = DATA.subjectMeta[s].levels;
    if(arr.includes(lvl)) DATA.subjectMeta[s].levels = arr.filter(x => x !== lvl);
    else arr.push(lvl);
    saveData();
}
function updSubVolLevel(s, lvl, val) {
    if(!DATA.subjectMeta[s].volLevel) DATA.subjectMeta[s].volLevel = {};
    DATA.subjectMeta[s].volLevel[lvl] = parseFloat(val) || 0;
    saveData();
}
function updSubEtab(s, val) {
    DATA.subjectMeta[s].etab = parseFloat(val) || 0;
    saveData();
}

function renameSubject(oldName, newName) { 
    if(!newName || newName===oldName) { renderSubjectsConfig(); return; }
    if(DATA.subjects.includes(newName)) { alert("Ce nom existe déjà !"); renderSubjectsConfig(); return; }

    DATA.subjects[DATA.subjects.indexOf(oldName)] = newName; 
    
    if(DATA.subjectMeta[oldName]){
        DATA.subjectMeta[newName] = DATA.subjectMeta[oldName];
        delete DATA.subjectMeta[oldName];
    }
    
    Object.keys(DATA.subjectMeta).forEach(s => { 
        if(DATA.subjectMeta[s].parent === oldName) {
            DATA.subjectMeta[s].parent = newName;
        }
    }); 
    
    Object.keys(DATA.levelConfig).forEach(l => {
        if(DATA.levelConfig[l][oldName]){
            DATA.levelConfig[l][newName] = DATA.levelConfig[l][oldName];
            delete DATA.levelConfig[l][oldName];
        }
    }); 
    
    Object.keys(DATA.classOverrides).forEach(c => {
        if(DATA.classOverrides[c][oldName]) {
            DATA.classOverrides[c][newName] = DATA.classOverrides[c][oldName];
            delete DATA.classOverrides[c][oldName];
        }
    });

    DATA.teachers.forEach(t => {
        if(t.subject === oldName) t.subject = newName;
    }); 
    
    saveData(); 
    renderSubjectsConfig();
    
    if(document.getElementById('ventilation').classList.contains('active')) renderGridSystem();
}

// ------------------------------------------------------------------------------------------------
// VUE PILOTAGE (DISCIPLINE) - Mise à jour V2.9 (Prise en compte CSD + Décharges)
// ------------------------------------------------------------------------------------------------
function renderRHDisc() {
    const needs = calculateNeeds();
    const tBody = document.getElementById('rh-disc-body');
    const tFoot = document.getElementById('rh-disc-total');
    tBody.innerHTML = '';
    
    const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();

    const getStats = (sub) => {
        const profs = getEntityTeachers().filter(t => t.subject === sub);
        const dechInt = profs.reduce((a,t)=>a+(t.decharge||0), 0);
        const dechExt = profs.reduce((a,t)=>a+(t.dech_ext||0), 0);
        const hp = profs.reduce((a,t)=> a + (t.ors - (t.csd||0) - (t.dech_ext||0)), 0);
        const hsa = profs.reduce((a,t)=>a+t.hsa, 0);
        const bes = (needs[sub] || 0) + dechInt;
        const app = hp + hsa;
        return { bes, app, hp, hsa, profs };
    };

    roots.forEach(r => {
        const rStats = getStats(r);
        const safeR = r.replace(/'/g, "\\'");
        const kids = DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === r);
        
        if (kids.length > 0) {
            let poleBes = rStats.bes;
            let poleApp = rStats.app;
            let poleHP = rStats.hp;
            let poleHSA = rStats.hsa;
            
            const kidsData = kids.map(k => {
                const kStats = getStats(k);
                poleBes += kStats.bes;
                poleApp += kStats.app;
                poleHP += kStats.hp;
                poleHSA += kStats.hsa;
                return { name: k, stats: kStats };
            });

            const soldePole = poleApp - poleBes;
            
            // EN-TÊTE PÔLE (Gris Anthracite)
            tBody.innerHTML += `<tr class="row-header">
                <td style="text-align:left; padding-left:10px;">📦 PÔLE ${r.toUpperCase()}</td>
                <td style="color:#f1c40f;">${poleBes.toFixed(1)}</td>
                <td style="color:#81d4fa;">${poleApp.toFixed(1)}</td>
                <td style="background:${soldePole>=0?'#27ae60':'#c0392b'}; color:white;">${soldePole.toFixed(1)}</td>
            </tr>`;

            renderSubjectRow(r, rStats, true, `↳ ${r}`, safeR);

            kidsData.forEach(kd => {
                renderSubjectRow(kd.name, kd.stats, true, `↳ ${kd.name}`, kd.name.replace(/'/g, "\\'"));
            });

        } else {
            // MATIÈRE SOLO (Style En-tête Gris aussi)
            renderSubjectRow(r, rStats, false, r, safeR, true);
        }
    });

    function renderSubjectRow(name, stats, isChild, displayName, safeName, isHeader = false) {
        if(stats.bes === 0 && stats.app === 0) return;

        let rowClass = isChild ? 'row-sub-master' : 'row-master';
        let styleBes = isChild ? 'background:#fcf3cf; color:#d35400;' : 'background:#fdf2e9; color:#d35400;';
        let styleApp = isChild ? 'background:#d6eaf8; color:#2980b9;' : 'background:#ebf5fb; color:#2980b9;';
        
        if (isHeader) {
            rowClass = 'row-header';
            styleBes = 'color:#f1c40f;'; 
            styleApp = 'color:#81d4fa;'; 
        }

        const addBtn = `<button class="btn-add-subject-teacher" onclick="addTeacherToSubject('${safeName}')" style="${isHeader ? 'border:1px solid white;' : ''}">+</button>`;
        const solde = stats.app - stats.bes;
        const paddingName = isChild ? 'padding-left:20px;' : '';

        tBody.innerHTML += `<tr class="${rowClass}">
            <td style="text-align:left; display:flex; align-items:center; ${paddingName}">${displayName} ${addBtn}</td>
            <td style="${styleBes}">${stats.bes.toFixed(1)}</td>
            <td style="${styleApp}">${stats.app.toFixed(1)}</td>
            <td style="color:${solde>=0 ? (isHeader?'#2ecc71':'green') : (isHeader?'#e74c3c':'red')}">${solde.toFixed(1)}</td>
        </tr>`;

        stats.profs.forEach(p => {
            let detailsTxt = "";
            
            // --- RESTAURATION : BADGES CLIQUABLES AVEC CRAYON ---
            
            // 1. BMP (Si > 0)
            if(p.bmp > 0) {
                detailsTxt += `<div onclick="setBMP(${p.idx})" title="Modifier le volume du BMP" style="cursor:pointer; background:#ebf5fb; border:1px solid #aed6f1; color:#2c3e50; font-size:0.75rem; font-weight:bold; margin-top:2px; padding:2px 5px; border-radius:4px; display:inline-flex; align-items:center; gap:5px;">
                   <span>★ BMP : ${p.bmp}h</span> <span>✏️</span>
                </div><br>`;
            }
            
            // 2. CSD (Si > 0)
            if(p.csd > 0) {
                detailsTxt += `<div onclick="setCSD(${p.idx})" title="Modifier le volume CSD" style="cursor:pointer; background:#fdf2e9; border:1px solid #fad7a0; color:#e67e22; font-size:0.75rem; font-weight:bold; margin-top:2px; padding:2px 5px; border-radius:4px; display:inline-flex; align-items:center; gap:5px;">
                   <span>(Dont ${p.csd}h CSD)</span> <span>✏️</span>
                </div><br>`;
            }

            // (Autres décharges : informatif seulement pour l'instant)
            if(p.decharge > 0) detailsTxt += `<span style="color:#8e44ad; font-size:0.7rem; display:block; margin-top:2px;">(Dont ${p.decharge}h DGH)</span>`;
            if(p.dech_ext > 0) detailsTxt += `<span style="color:#27ae60; font-size:0.7rem; display:block; margin-top:2px;">(Dont ${p.dech_ext}h Rect.)</span>`;

            const realContribution = (p.ors - (p.csd||0) - (p.dech_ext||0)) + p.hsa;
            const paddingProf = isChild ? 'padding-left:50px;' : 'padding-left:30px;';

            // Boutons d'ajout (colonne 1) : Masqués si valeur déjà saisie
            const btnBmp = (p.bmp > 0) 
                ? '' 
                : `<button onclick="setBMP(${p.idx})" style="cursor:pointer; background:#34495e; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir BMP">BMP ?</button>`;

            const btnCsd = (p.csd > 0) 
                ? '' 
                : `<button onclick="setCSD(${p.idx})" style="cursor:pointer; background:#17a2b8; color:white; border:none; border-radius:3px; padding:1px 5px; font-size:0.65rem; margin-left:5px;" title="Définir CSD">CSD ?</button>`;

            tBody.innerHTML += `<tr class="row-detail">
                <td style="${paddingProf} text-align:left; display:flex; align-items:center;">
                    <span style="color:#bdc3c7; margin-right:5px;">↳</span>
                    <input type="text" value="${p.name}" onchange="updT(${p.idx},'name',this.value)" style="border:none; border-bottom:1px dashed #bdc3c7; background:transparent; width:140px; color:#2c3e50; font-weight:500;" placeholder="Nom">
                    ${btnBmp} ${btnCsd}
                    <span style="font-size:0.75rem; color:#999; margin-left:5px;">(${p.grade || p.status || ''})</span>
                </td>
                <td colspan="2"></td>
                <td>
                    <input type="number" class="input-inline" value="${p.ors}" step="0.5" onchange="updT(${p.idx},'ors',this.value)">
                    <div style="display:flex; flex-direction:column; align-items:center;">${detailsTxt}</div>
                </td>
                <td style="font-weight:bold; color:#7f8c8d;">${realContribution.toFixed(1)}</td>
            </tr>`;
        });
    }
    
    // Totaux
    let realHP=0, realHSA=0, realBesoin = 0; 
    getEntityTeachers().forEach(t=>{ 
        realHP += (t.ors - (t.csd||0) - (t.dech_ext||0)); 
        realHSA += t.hsa; 
        realBesoin += (t.decharge || 0);
    });
    Object.values(needs).forEach(v=>realBesoin+=v);
    const realApport = realHP + realHSA;

    tFoot.innerHTML = `<td>TOTAUX GÉNÉRAUX</td>
        <td>${realBesoin.toFixed(1)}</td>
        <td>${realApport.toFixed(1)}</td>
        <td style="background:${(realApport-realBesoin)>=0?'var(--success)':'var(--danger)'}; color:white;">${(realApport-realBesoin).toFixed(1)}</td>`;
}

function updateYear(v){ DATA.config.year=parseInt(v); saveData(); }
function updateGlobalDHG(){ DATA.config.hp=parseFloat(document.getElementById('global-hp').value); DATA.config.hsa=parseFloat(document.getElementById('global-hsa').value); saveData(); calculateRecap(); }
function saveData(a){ 
    // Sauvegarder l'entité courante dans MULTI_DATA avant de sauvegarder tout
    if (DATA && currentEntity) MULTI_DATA[currentEntity] = DATA;
    saveAllData();
    if(a) alert("✅ Sauvegardé");
}

function saveAllData() {
    // Sauvegarder l'entité courante dans MULTI_DATA
    if (DATA && currentEntity) MULTI_DATA[currentEntity] = DATA;
    const toSave = {
        entities: MULTI_DATA,
        names: ENTITY_NAMES,
        currentEntity: currentEntity,
        sharedTeachers: SHARED_TEACHERS
    };
    localStorage.setItem('DHG_MultiData_V9', JSON.stringify(toSave));
}

/**
 * MUTUALISATION: Migre les enseignants spécifiques à chaque entité
 * vers la base SHARED_TEACHERS partagée entre toutes les entités.
 * Cette migration est idempotente (peut être appelée plusieurs fois sans doublon).
 */
function migrateTeachersToShared() {
    let migrated = 0;
    ['college', 'lycee', 'lycee_pro', 'pole'].forEach(entityKey => {
        const d = MULTI_DATA[entityKey];
        if (!d || !d.teachers || d.teachers.length === 0 || d.teachersMigrated) return;
        d.teachers.forEach(t => {
            // Chercher si cet enseignant existe déjà dans SHARED_TEACHERS (même nom+discipline)
            const existing = SHARED_TEACHERS.find(st => 
                st.name && t.name && 
                st.name.trim().toLowerCase() === t.name.trim().toLowerCase() && 
                st.subject === t.subject
            );
            if (existing) {
                // Ajouter les heures de cette entité à l'enseignant existant
                if (!existing.services) existing.services = {college:0, lycee:0, lycee_pro:0, pole:0};
                existing.services[entityKey] = (parseFloat(existing.services[entityKey])||0) + (parseFloat(t.ors)||0);
                if (!existing.entities) existing.entities = [];
                if (!existing.entities.includes(entityKey)) existing.entities.push(entityKey);
            } else {
                const newT = {
                    id: 'T_' + Date.now() + '_' + Math.random().toString(36).slice(2,6),
                    name: t.name || 'Nouveau',
                    subject: t.subject || '',
                    status: t.status || 'Certifié',
                    ors: parseFloat(t.ors) || 0,
                    hsa: parseFloat(t.hsa) || 0,
                    csd: parseFloat(t.csd) || 0,
                    decharge: parseFloat(t.decharge) || 0,
                    dech_ext: parseFloat(t.dech_ext) || 0,
                    bmp: parseFloat(t.bmp) || 0,
                    services: {college:0, lycee:0, lycee_pro:0, pole:0},
                    entities: [entityKey]
                };
                newT.services[entityKey] = parseFloat(t.ors) || 0;
                SHARED_TEACHERS.push(newT);
            }
            migrated++;
        });
        // Vider la liste locale après migration
        d.teachers = [];
        d.teachersMigrated = true;
    });
    if (migrated > 0) {
        saveAllData();
        console.log('[DHG] Migration: ' + migrated + ' enseignant(s) migrés vers la base mutualisée.');
    }
}

/** Ouvre la fenêtre pour gérer les heures par entité d'un enseignant mutualisé */
function editTeacherServices(sharedIdx) {
    const t = SHARED_TEACHERS[sharedIdx];
    if (!t) return;
    if (!t.services) t.services = {college:0, lycee:0, lycee_pro:0, pole:0};
    
    const hC = prompt(
        '⚡ Affecter les heures de ' + t.name + ' par entité:\n\n' +
        'Entrez les heures pour ' + (ENTITY_NAMES.college || 'Collège') + ' :',
        t.services.college || 0
    );
    if (hC === null) return;
    
    const hL = prompt(
        '⚡ Affecter les heures de ' + t.name + ' par entité:\n\n' +
        'Entrez les heures pour ' + (ENTITY_NAMES.lycee || 'Lycée') + ' :',
        t.services.lycee || 0
    );
    if (hL === null) return;
    
    const hLP = prompt(
        '⚡ Affecter les heures de ' + t.name + ' par entité:\n\n' +
        'Entrez les heures pour ' + (ENTITY_NAMES.lycee_pro || 'Lycée Pro') + ' :',
        t.services.lycee_pro || 0
    );
    if (hLP === null) return;
    
    const hP = prompt(
        '⚡ Affecter les heures de ' + t.name + ' par entité:\n\n' +
        'Entrez les heures pour ' + (ENTITY_NAMES.pole || 'Pôle Supérieur') + ' :',
        t.services.pole || 0
    );
    if (hP === null) return;
    
    t.services.college   = parseFloat(hC)  || 0;
    t.services.lycee     = parseFloat(hL)  || 0;
    t.services.lycee_pro = parseFloat(hLP) || 0;
    t.services.pole      = parseFloat(hP)  || 0;
    
    // Mettre à jour l'ORS total si la somme dépasse l'ORS actuel
    const totalH = t.services.college + t.services.lycee + (t.services.lycee_pro||0) + t.services.pole;
    if (totalH > t.ors) {
        if (confirm('Le total des heures (' + totalH + 'h) dépasse l\'ORS (' + t.ors + 'h).\nVoulez-vous mettre à jour l\'ORS à ' + totalH + 'h ?')) {
            t.ors = totalH;
        }
    }
    
    // Mettre à jour les entités associées
    t.entities = ['college','lycee','lycee_pro','pole'].filter(k => (t.services[k]||0) > 0);
    
    saveAllData();
    renderRH();
    calculateRecap();
}

// ================================================================
// BILAN CONSOLIDÉ – calcul pour les 3 entités
// ================================================================

/** Calcule la consommation d'heures d'une entité (besoin/apport) */
function calcEntityStats(entityData, entityKey) {
    if (!entityData) return { besoin: 0, apport: 0, hp: 0, hsa: 0, solde: 0, total: 0 };
    let besoin = 0, apport = 0, hp = 0, hsa = 0;
    
    // Besoin depuis la structure (matières hors EDS)
    if (entityData.structure && entityData.levelConfig) {
        entityData.structure.forEach(lvl => {
            const lc = entityData.levelConfig[lvl.level] || {};
            const nDiv = lvl.div || 0;
            entityData.subjects && entityData.subjects.forEach(s => {
                const meta = entityData.subjectMeta?.[s] || {};
                if (meta.isEds) return; // EDS comptées séparément ci-dessous
                const cfg = lc[s] || { base: 0, demi: 0, marge: 0, coef: 1 };
                if (meta.mode !== 'etab') {
                    besoin += getEffectiveBase(cfg) * nDiv;
                }
            });
        });
    }
    
    // Besoin EDS : groupes × h/groupe × coef
    if (entityData.eds) {
        ['premiere', 'terminale'].forEach(lvl => {
            (entityData.eds[lvl] || []).forEach(e => {
                const coef = parseFloat(e.coef) || 1.0;
                besoin += (e.groups || 0) * (e.hPerGroup || (lvl === 'premiere' ? 4 : 6)) * coef;
            });
        });
    }
    
    // Apport depuis les profs locaux (compatibilité données anciennes)
    if (entityData.teachers) {
        entityData.teachers.forEach(t => {
            const ors = parseFloat(t.ors) || 0;
            const hpVal = parseFloat(t.hp) || ors;
            const hsaVal = parseFloat(t.hsa) || 0;
            apport += ors;
            hp += hpVal;
            hsa += hsaVal;
        });
    }
    
    // MUTUALISATION: Apport depuis SHARED_TEACHERS pour cette entité
    if (entityKey) {
        SHARED_TEACHERS.forEach(t => {
            if (!t.entities || !t.entities.includes(entityKey)) return;
            const h = parseFloat(t.services?.[entityKey]) || parseFloat(t.ors) || 0;
            if (h > 0) {
                apport += h;
                hp += h;
                hsa += parseFloat(t.hsa) || 0;
            }
        });

        // Apport EDS : heures des enseignants assignés dans Spécialités & EDS
        if (entityData.eds) {
            ['premiere', 'terminale'].forEach(lvl => {
                (entityData.eds[lvl] || []).forEach(eds => {
                    if (!eds.teachers) return;
                    const hPG = (parseFloat(eds.hPerGroup) || (lvl === 'premiere' ? 4 : 6)) * (parseFloat(eds.coef) || 1.0);
                    eds.teachers.forEach(tid => {
                        if (!tid) return;
                        apport += hPG;
                        hp += hPG;
                    });
                });
            });
        }
    }
    
    const total = entityData.config?.total || 0;
    return { besoin, apport, hp, hsa, solde: apport - besoin, total };
}

/** Calcule le besoin par discipline pour une entité */
function calcEntitySubjectNeeds(entityData, entityKey) {
    const result = {};
    if (!entityData || !entityData.structure) return result;
    
    entityData.subjects?.forEach(s => {
        let need = 0, app = 0;
        const meta = entityData.subjectMeta?.[s] || {};
        
        if (meta.isEds) {
            // Les EDS : le besoin vient directement des données DATA.eds (groupes × h/groupe × coef)
            if (entityData.eds) {
                ['premiere', 'terminale'].forEach(lvl => {
                    (entityData.eds[lvl] || []).forEach(e => {
                        if (e.name === s) {
                            const coef = parseFloat(e.coef) || 1.0;
                            need += (e.groups || 0) * (e.hPerGroup || (lvl === 'premiere' ? 4 : 6)) * coef;
                        }
                    });
                });
            }
        } else if (meta.mode === 'etab') {
            need = parseFloat(meta.etab) || 0;
        } else if (meta.mode === 'level') {
            // Forfait par niveau : somme des volumes configurés
            entityData.structure.forEach(lvl => {
                const val = meta.volLevel ? parseFloat(meta.volLevel[lvl.level] || 0) : 0;
                need += val;
            });
        } else {
            // Mode division (par défaut) : (base + marge) × coef × nb_divisions
            entityData.structure.forEach(lvl => {
                if (meta.levels && !meta.levels.includes(lvl.level)) return;
                const lc = entityData.levelConfig?.[lvl.level]?.[s] || { base: 0, demi: 0, marge: 0, coef: 1.0 };
                const coef = parseFloat(lc.coef) || 1.0;
                const hours = getEffectiveBase(lc) + (parseFloat(lc.marge) || 0);
                // Vérifier les overrides de classe
                const prefix = (lvl.level || '').replace(/[^0-9]/g, '') || (lvl.level || '').charAt(0);
                for (let i = 0; i < (lvl.div || 0); i++) {
                    const cId = `${prefix}${String.fromCharCode(65 + i)}`;
                    if (entityData.classOverrides?.[cId]?.[s]) {
                        const ov = entityData.classOverrides[cId][s];
                        need += (getEffectiveBase(ov) + (parseFloat(ov.marge) || 0)) * coef;
                    } else {
                        need += hours * coef;
                    }
                }
            });
        }
        
        // Apport enseignants locaux (ancienne structure)
        entityData.teachers?.forEach(t => {
            if (t.subject === s) app += parseFloat(t.ors) || 0;
        });

        // Apport depuis SHARED_TEACHERS pour cette entité et cette matière
        if (entityKey && !meta.isEds) {
            SHARED_TEACHERS.forEach(t => {
                if (t.subject !== s) return;
                if (!t.entities || !t.entities.includes(entityKey)) return;
                // Calculer les heures de ce prof pour cette matière dans cette entité
                const d = entityData; // même référence
                const assignments = d.assignments || {};
                const structure = d.structure || [];
                const subjectMeta = d.subjectMeta || {};
                const levelConfig = d.levelConfig || {};
                const classOverrides = d.classOverrides || {};
                const sharedIdx = SHARED_TEACHERS.indexOf(t);
                
                function getLvlPrefix(name) { return name.replace(/[^0-9]/g, '') || name.charAt(0); }
                function getHoursLocal(cId, levelName, subject) {
                    const m = subjectMeta[subject];
                    if (!m || m.mode === 'etab') return 0;
                    if (m.mode === 'level') return (m.volLevel && m.volLevel[levelName]) || 0;
                    const cfg = (classOverrides[cId] && classOverrides[cId][subject])
                        ? classOverrides[cId][subject]
                        : (levelConfig[levelName] ? levelConfig[levelName][subject] : null);
                    return cfg ? (getEffectiveBase(cfg) + (cfg.marge || 0)) * (cfg.coef || 1) : 0;
                }

                let teacherHours = 0;
                let levelsPaid = new Set();
                const relevantKeys = Object.keys(assignments)
                    .filter(key => parseInt(key.split('_')[1]) === sharedIdx)
                    .sort((a, b) => {
                        const idA = a.split('_')[0], idB = b.split('_')[0];
                        const isLvlA = structure.some(l => l.level === idA) || idA === 'ETAB';
                        const isLvlB = structure.some(l => l.level === idB) || idB === 'ETAB';
                        return isLvlB - isLvlA;
                    });

                relevantKeys.forEach(key => {
                    const assign = assignments[key];
                    const parts = key.split('_');
                    const entityId = parts.slice(0, parts.length - 1).join('_');
                    const structLvlExact = structure.find(l => l.level === entityId);
                    let parentLevelName = null;
                    if (structLvlExact) {
                        parentLevelName = structLvlExact.level;
                    } else {
                        const found = structure.find(l => entityId.startsWith(getLvlPrefix(l.level)));
                        if (found) parentLevelName = found.level;
                    }
                    let h = (assign.quota !== undefined && assign.quota !== null) ? parseFloat(assign.quota) : 0;
                    if (h === 0 && parentLevelName) h = getHoursLocal(entityId, parentLevelName, s);
                    if (h > 0) {
                        const smeta = subjectMeta[s];
                        let effective = h;
                        if (smeta && smeta.mode === 'level' && parentLevelName) {
                            if (levelsPaid.has(parentLevelName)) { effective = 0; }
                            else { levelsPaid.add(parentLevelName); }
                        }
                        teacherHours += effective;
                    }
                });

                // Fallback si pas d'assignments : utiliser t.services
                if (teacherHours === 0) {
                    teacherHours = parseFloat(t.services?.[entityKey]) || 0;
                }
                app += teacherHours;
            });
        }

        // Apport EDS : heures assignées aux enseignants pour cette spécialité
        if (meta.isEds && entityData.eds) {
            ['premiere', 'terminale'].forEach(lvl => {
                (entityData.eds[lvl] || []).forEach(e => {
                    if (e.name === s && e.teachers) {
                        const hPG = (e.hPerGroup || (lvl === 'premiere' ? 4 : 6)) * (parseFloat(e.coef) || 1.0);
                        e.teachers.forEach(tid => { if (tid) app += hPG; });
                    }
                });
            });
        }
        
        result[s] = { need, app, pneCode: meta.pneCode || meta.code || '', label: s };
    });
    return result;
}

// ================================================================
// CATALOGUE DE MATIÈRES PNE
// ================================================================

function openSubjectCatalog() {
    var overlay = document.getElementById('subject-catalog-overlay');
    overlay.style.display = 'flex';
    document.getElementById('catalog-search').value = '';
    document.getElementById('catalog-bureau-filter').value = '';
    renderCatalog();
}

function filterCatalog() { renderCatalog(); }

function renderCatalog() {
    var search = (document.getElementById('catalog-search').value || '').toLowerCase();
    var bureauFilter = document.getElementById('catalog-bureau-filter').value;
    var existing = new Set(DATA.subjects.map(function(s) { return s.toLowerCase(); }));
    var html = '';
    
    Object.entries(PNE_BUREAUX).forEach(function(entry) {
        var bureauId = entry[0], bureau = entry[1];
        if (bureauFilter && bureauFilter !== bureauId) return;
        var itemsHtml = '';
        Object.entries(bureau.disciplines).forEach(function(de) {
            var code = de[0], label = de[1];
            if (search && !label.toLowerCase().includes(search) && !code.toLowerCase().includes(search)) return;
            var alreadyIn = existing.has(label.toLowerCase());
            var safeLabel = label.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
            itemsHtml += '<div style="display:inline-flex;align-items:center;gap:5px;margin:3px;padding:6px 10px;border-radius:20px;cursor:' + (alreadyIn?'default':'pointer') + ';background:' + (alreadyIn?'#f0f0f0':bureau.color+'20') + ';border:1px solid ' + (alreadyIn?'#ddd':bureau.color) + ';color:' + (alreadyIn?'#aaa':'#333') + ';font-size:0.82rem;" ' +
                (alreadyIn ? '' : 'onclick="addSubjectFromCatalog(\''+safeLabel+'\',\''+code+'\')"') +
                '><span style="font-family:monospace;font-size:0.72rem;background:' + (alreadyIn?'#e0e0e0':bureau.color+'40') + ';padding:1px 4px;border-radius:3px;">' + code + '</span> ' + label + (alreadyIn ? ' ✓' : ' ➕') + '</div>';
        });
        if (itemsHtml) {
            html += '<div style="margin-bottom:12px;"><div style="font-size:0.75rem;font-weight:700;color:' + bureau.color + ';text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px;padding-bottom:4px;border-bottom:2px solid ' + bureau.color + ';">' + bureau.label + '</div>' + itemsHtml + '</div>';
        }
    });
    document.getElementById('catalog-list').innerHTML = html || '<p style="color:#aaa;text-align:center;padding:20px;">Aucune discipline trouvée.</p>';
}

function addSubjectFromCatalog(label, pneCode) {
    if (!DATA.subjects.includes(label)) {
        DATA.subjects.push(label);
        DATA.subjectMeta[label] = { mode: 'div', levels: getDefaultActiveLevels(label), etab: 0, volLevel: {}, parent: '', code: '', pneCode: pneCode };
        DATA.structure.forEach(function(l) { DATA.levelConfig[l.level][label] = { base: 0, demi: 0, marge: 0, coef: 1.0 }; });
        saveData();
        renderGridSystem();
        renderRH();
        renderSubjectsConfig();
    }
    renderCatalog();
}

// ================================================================
// COPIE DE MATIÈRES ENTRE ENTITÉS
// ================================================================

function openCopySubjectsModal() {
    var overlay = document.getElementById('copy-subjects-overlay');
    overlay.style.display = 'flex';
    document.getElementById('copy-from-label').textContent = ENTITY_NAMES[currentEntity] || currentEntity;
    document.getElementById('copy-college-lbl').textContent = ENTITY_NAMES.college;
    document.getElementById('copy-lycee-lbl').textContent = ENTITY_NAMES.lycee;
    document.getElementById('copy-pole-lbl').textContent = ENTITY_NAMES.pole;
    ['college','lycee','lycee_pro','pole'].forEach(function(k) {
        var el = document.getElementById('copy-to-' + k);
        var opt = document.getElementById('copy-to-' + k + '-opt');
        el.checked = false;
        if (k === currentEntity) {
            el.disabled = true;
            opt.style.opacity = '0.4';
            opt.style.cursor = 'not-allowed';
        } else {
            el.disabled = false;
            opt.style.opacity = '1';
            opt.style.cursor = 'pointer';
        }
    });
}

function executeCopySubjects() {
    var targets = ['college','lycee','lycee_pro','pole'].filter(function(k) {
        return document.getElementById('copy-to-' + k).checked && !document.getElementById('copy-to-' + k).disabled;
    });
    if (!targets.length) { alert('Sélectionnez au moins une entité cible.'); return; }
    MULTI_DATA[currentEntity] = DATA;
    var added = 0;
    targets.forEach(function(targetKey) {
        var target = MULTI_DATA[targetKey];
        if (!target) return;
        DATA.subjects.forEach(function(s) {
            if (!target.subjects.includes(s)) {
                target.subjects.push(s);
                target.subjectMeta[s] = JSON.parse(JSON.stringify(DATA.subjectMeta[s] || { mode: 'div', levels: [], etab: 0, volLevel: {}, parent: '', code: '' }));
                target.structure.forEach(function(l) {
                    if (!target.levelConfig[l.level]) target.levelConfig[l.level] = {};
                    target.levelConfig[l.level][s] = { base: 0, demi: 0, marge: 0, coef: 1.0 };
                });
                added++;
            }
        });
    });
    saveAllData();
    document.getElementById('copy-subjects-overlay').style.display = 'none';
    alert('✅ ' + added + ' matière(s) copiée(s) vers ' + targets.map(function(k) { return ENTITY_NAMES[k]; }).join(', ') + '.');
}

// ================================================================
// BILAN ENRICHI – TABLEAU ENSEIGNANTS × ENTITÉS
// ================================================================

/**
 * Calcule les heures réelles affectées à un enseignant dans la ventilation d'une entité.
 * Utilise MULTI_DATA[entityKey].assignments (la vraie grille de ventilation).
 * Correspond au même calcul que renderRepartitionProfs / renderRepartitionMatieres.
 * @param {number} sharedIdx  – index de l'enseignant dans SHARED_TEACHERS
 * @param {string} entityKey  – 'college' | 'lycee' | 'pole'
 * @returns {number} heures effectives (avec décharges, sans doublons de mode 'level')
 */
/** Retourne les heures brutes (devant élèves, sans pondération) d'un enseignant dans une entité */
/**
 * Retourne {raw, pond, weighted} pour un enseignant dans une entité.
 * raw     = heures devant élèves (base sans pondération)
 * pond    = heures de pondération (coef appliqué - base)
 * weighted= raw + pond (total comptabilisé)
 * Les décharges sont comptées dans raw (pas de pondération sur décharges).
 */
function calcTeacherHoursBreakdown(sharedIdx, entityKey) {
    const d = MULTI_DATA[entityKey];
    if (!d || !d.assignments) return {raw:0, pond:0, weighted:0};
    const t = SHARED_TEACHERS[sharedIdx];
    if (!t) return {raw:0, pond:0, weighted:0};

    // Si la discipline du prof est une "sur-matière" (mode=group),
    // on cumule le breakdown de toutes les disciplines enfants
    const _smeta = d.subjectMeta || {};
    const _entitySubject = (t.subjects && t.subjects[entityKey]) ? t.subjects[entityKey] : (t.subject || '');
    if (_entitySubject && _smeta[_entitySubject]?.mode === 'group') {
        // Chercher les clés d'affectation par sous-matière (format: cId_tIdx~childSub)
        const children = (d.subjects || []).filter(s => _smeta[s]?.parent === _entitySubject);
        let rawSum = 0, pondSum = 0;
        let pondCapped = false, pondExceedsORS = false;
        children.forEach(childSubject => {
            // Extraire UNIQUEMENT les clés ~childSub de ce prof, converties en clés standard
            const childAssignments = {};
            Object.entries(d.assignments || {}).forEach(([k, v]) => {
                if (k.endsWith('~' + childSubject)) {
                    childAssignments[k.split('~')[0]] = v;
                }
            });
            if (Object.keys(childAssignments).length === 0) return; // pas d'affectation pour cette sous-mat

            const tClone = {...t, subject: childSubject, subjects: {...(t.subjects||{}), [entityKey]: childSubject}};
            const backup = SHARED_TEACHERS[sharedIdx];
            SHARED_TEACHERS[sharedIdx] = tClone;
            const backupAssign = d.assignments;
            // IMPORTANT : utiliser UNIQUEMENT childAssignments, pas fusionné avec d.assignments
            // Sinon le prof cumule les heures de toutes les sous-matières
            d.assignments = childAssignments;
            const bd = calcTeacherHoursBreakdown(sharedIdx, entityKey);
            d.assignments = backupAssign;
            SHARED_TEACHERS[sharedIdx] = backup;
            rawSum  += bd.raw;
            pondSum += bd.pond;
            if (bd.pondCapped)     pondCapped     = true;
            if (bd.pondExceedsORS) pondExceedsORS = true;
        });
        if (entityKey === 'lycee' && pondSum > 1.0) { pondSum = 1.0; pondCapped = true; }
        const weighted = Math.round((rawSum + pondSum) * 10) / 10;
        return { raw: Math.round(rawSum*10)/10, pond: Math.round(pondSum*10)/10, weighted, pondCapped, pondExceedsORS };
    }

    const assignments    = d.assignments;
    const structure      = d.structure      || [];
    const subjectMeta    = d.subjectMeta    || {};
    const levelConfig    = d.levelConfig    || {};
    const classOverrides = d.classOverrides || {};

    function getLvlPrefix(name) { return name.replace(/[^0-9]/g,'') || name.charAt(0); }

    // Retourne le coef de pondération pour un niveau donné (indépendant de la matière)
    // Le coef est configuré par niveau dans la grille — on prend le coef médian des matières du niveau
    // pour éviter toute dépendance à t.subject (qui peut ne pas correspondre à ce que le prof enseigne ici)
    function getCoefForLevel(levelName) {
        const lc = levelConfig[levelName];
        if (!lc) return 1;
        // Prendre le premier coef non-null de ce niveau (tous les coefs sont identiques par niveau)
        const coefs = Object.values(lc).map(c => parseFloat(c.coef) || 1).filter(c => c > 0);
        if (!coefs.length) return 1;
        // Retourner le coef le plus fréquent (ou le max si tous différents)
        return coefs.sort((a,b) => b-a)[0];
    }

    // Retourne {base, coef} pour une classe/matière
    // Cherche dans TOUTES les matières configurées pour trouver celle qui correspond au quota
    function getBaseAndCoefForAssign(cId, levelName, quota) {
        const lc = levelConfig[levelName];
        if (!lc) return {base: quota || 0, coef: getCoefForLevel(levelName)};

        // D'abord essayer avec la discipline spécifique à l'entité, puis t.subject global
        const entitySubject = getTeacherSubjectForEntity(t, entityKey);
        const trySubjects = entitySubject
            ? [entitySubject, ...(t.subject && t.subject !== entitySubject ? [t.subject] : []), ...Object.keys(lc).filter(s => s !== entitySubject && s !== t.subject)]
            : Object.keys(lc);

        for (const s of trySubjects) {
            const meta = subjectMeta[s];
            if (!meta || meta.mode === 'etab') continue;

            let base = 0, coef = 1;
            if (meta.mode === 'level') {
                base = (meta.volLevel && meta.volLevel[levelName]) || 0;
                coef = 1;
            } else {
                const cfg = (classOverrides[cId] && classOverrides[cId][s])
                    ? classOverrides[cId][s]
                    : (lc[s] || null);
                if (!cfg) continue;
                base = getEffectiveBase(cfg) + (cfg.marge || 0);
                coef = parseFloat(cfg.coef) || 1;
            }

            if (base <= 0) continue;

            // Si quota correspond à base*coef (pondéré) ou à base (brut) → bonne matière trouvée
            if (quota !== null && quota !== undefined) {
                const qv = parseFloat(quota);
                if (Math.abs(qv - base * coef) < 0.05 || Math.abs(qv - base) < 0.05) {
                    return {base, coef};
                }
            } else {
                return {base, coef};
            }
        }

        // Fallback : on ne sait pas quelle matière, mais on connaît le coef du niveau
        return {base: quota ? parseFloat(quota) : 0, coef: getCoefForLevel(levelName)};
    }

    let raw = 0, pond = 0;
    let levelsPaid = new Set();

    const relevantKeys = Object.keys(assignments).filter(key => parseInt(key.split('_')[1]) === sharedIdx);
    const sortedKeys = relevantKeys.sort((a,b) => {
        const isLvlA = structure.some(l=>l.level===a.split('_')[0]) || a.split('_')[0]==='ETAB';
        const isLvlB = structure.some(l=>l.level===b.split('_')[0]) || b.split('_')[0]==='ETAB';
        return isLvlB - isLvlA;
    });

    sortedKeys.forEach(key => {
        const assign   = assignments[key];
        const entityId = key.split('_').slice(0,-1).join('_');

        let parentLevelName = null;
        const lvlExact = structure.find(l => l.level === entityId);
        if (lvlExact) { parentLevelName = lvlExact.level; }
        else {
            const lvlPrefix = structure.find(l => entityId.startsWith(getLvlPrefix(l.level)));
            if (lvlPrefix) parentLevelName = lvlPrefix.level;
        }

        if (!parentLevelName) return;

        const quota = (assign.quota !== undefined && assign.quota !== null) ? parseFloat(assign.quota) : null;
        const {base, coef} = getBaseAndCoefForAssign(entityId, parentLevelName, quota);

        let hWeighted, hBase;
        if (quota !== null && quota > 0) {
            // Le quota peut être saisi en heures brutes OU pondérées selon le contexte
            // On considère que le quota = heures pondérées affichées dans la grille
            hWeighted = quota;
            hBase = coef > 1 ? Math.round((quota / coef) * 10) / 10 : quota;
        } else if (base > 0) {
            hBase     = base;
            hWeighted = Math.round(base * coef * 10) / 10;
        } else {
            return;
        }

        // Dédoublonnage mode 'level'
        const meta = subjectMeta[t.subject];
        if (meta && meta.mode === 'level' && parentLevelName) {
            if (levelsPaid.has(parentLevelName)) return;
            levelsPaid.add(parentLevelName);
        }

        raw  += hBase;
        pond += hWeighted - hBase;
    });

    // Décharges : raw uniquement
    raw += (parseFloat(t.decharge||0) + parseFloat(t.dech_ext||0));

    // EDS
    if (d.eds) {
        ['premiere','terminale'].forEach(lvl => {
            (d.eds[lvl]||[]).forEach(eds => {
                if (!eds.teachers) return;
                const coefEds = parseFloat(eds.coef) || 1.0;
                const hPG     = parseFloat(eds.hPerGroup) || (lvl==='premiere' ? 4 : 6);
                eds.teachers.forEach(tid => {
                    if (tid === t.id) {
                        raw  += hPG;
                        pond += hPG * (coefEds - 1);
                    }
                });
            });
        });
    }

    // ── RÈGLES MÉTIER DE PLAFONNEMENT ────────────────────────────────
    // Lycée GT : pondération totale plafonnée à 1h réglementaire
    let pondCapped = false;
    if (entityKey === 'lycee') {
        if (pond > 1.0) {
            pond      = 1.0;
            pondCapped = true;  // signal pour l'affichage
        }
    }

    // Pôle/BTS : pondération limitée aux heures ≤ ORS du prof
    // Les heures au-delà de l'ORS (HSA) ne sont pas pondérées
    let pondExceedsORS = false;
    if (entityKey === 'pole') {
        const ors      = parseFloat(t.ors) || 18;
        const rawTotal = raw;   // heures devant élèves avant plafond
        if (rawTotal > ors) {
            pondExceedsORS = true;  // signal : prof dépasse l'ORS → pondération virtuelle en gras
            // Seules les heures ≤ ORS donnent droit à pondération
            // pond est déjà calculé sur raw — on le plafonne proportionnellement
            const ratioORS = Math.max(0, Math.min(1, ors / rawTotal));
            pond = Math.round(pond * ratioORS * 10) / 10;
        }
    }

    const weighted = Math.round((raw + pond) * 10) / 10;
    return {
        raw:       Math.round(raw  * 10) / 10,
        pond:      Math.round(pond * 10) / 10,
        weighted,
        pondCapped,       // true si pondération plafonnée à 1h (lycée GT)
        pondExceedsORS    // true si prof BTS/pôle dépasse son ORS
    };
}

/** Compatibilité : retourne uniquement le total pondéré */
function calcTeacherRawHoursFromEntityVentilation(sharedIdx, entityKey) {
    return calcTeacherHoursBreakdown(sharedIdx, entityKey).raw;
}

function calcTeacherHoursFromEntityVentilation(sharedIdx, entityKey) {
    return calcTeacherHoursBreakdown(sharedIdx, entityKey).weighted;
}


function renderBilanTeachers() {
    var tbody = document.getElementById('bilan-teachers-body');
    if (!tbody) return;
    var nameFilter = (document.getElementById('bilan-teacher-filter') ? document.getElementById('bilan-teacher-filter').value : '').toLowerCase();
    var entityFilter = document.getElementById('bilan-teacher-entity-filter') ? document.getElementById('bilan-teacher-entity-filter').value : '';
    var allTeachers = [];
    SHARED_TEACHERS.forEach(function(t, sharedIdx) {
        var entities = t.entities || [];
        if (entityFilter) {
            if (entityFilter === 'shared' && entities.length <= 1) return;
            if (entityFilter !== 'shared' && !entities.includes(entityFilter)) return;
        }

        // Calcul détaillé (devant élèves + pondération) depuis la ventilation de chaque entité
        var bdC  = calcTeacherHoursBreakdown(sharedIdx, 'college');
        var bdL  = calcTeacherHoursBreakdown(sharedIdx, 'lycee');
        var bdLP = calcTeacherHoursBreakdown(sharedIdx, 'lycee_pro');
        var bdP  = calcTeacherHoursBreakdown(sharedIdx, 'pole');

        var hC  = bdC.weighted,  hL  = bdL.weighted,  hLP = bdLP.weighted, hP  = bdP.weighted;
        var rawC = bdC.raw,      rawL = bdL.raw,       rawLP = bdLP.raw,    rawP = bdP.raw;
        var pondC = bdC.pond,    pondL = bdL.pond,     pondLP = bdLP.pond,  pondP = bdP.pond;

        // Si aucune heure dans la ventilation, fallback sur t.services (saisie manuelle, pas de pondération connue)
        var hasVentilation = (hC + hL + hLP + hP) > 0;
        if (!hasVentilation) {
            hC  = parseFloat(t.services && t.services.college)    || 0;
            hL  = parseFloat(t.services && t.services.lycee)      || 0;
            hLP = parseFloat(t.services && t.services.lycee_pro)  || 0;
            hP  = parseFloat(t.services && t.services.pole)       || 0;
            rawC = hC; rawL = hL; rawLP = hLP; rawP = hP;
            pondC = 0; pondL = 0; pondLP = 0; pondP = 0;
        }
        var rawTotal  = rawC  + rawL  + rawLP  + rawP;
        var pondTotal = pondC + pondL + pondLP + pondP;

        var entLabel = entities.length > 0
            ? entities.map(function(e){ return {college:'🏫',lycee:'🏛️',lycee_pro:'🏭',pole:'🎓'}[e]||e; }).join(' ')
            : '–';
        allTeachers.push({
            name: t.name || '–', subject: t.subject || '–',
            ors: parseFloat(t.ors) || 0,
            entity: entities.length > 1 ? 'shared' : (entities[0] || 'shared'),
            entLabel: entLabel,
            hCollege: hC,    hLycee: hL,    hLyceePro: hLP,    hPole: hP,
            rawCollege: rawC, rawLycee: rawL, rawLyceePro: rawLP, rawPole: rawP,
            pondCollege: pondC, pondLycee: pondL, pondLyceePro: pondLP, pondPole: pondP,
            rawTotal: rawTotal, pondTotal: pondTotal,
            cappedL: bdL.pondCapped || false,   // Pondération lycée plafonnée à 1h
            cappedP: bdP.pondCapped || false,   // (réservé)
            exceedsORS_P: bdP.pondExceedsORS || false,  // Prof BTS/pôle dépasse son ORS
            isShared: entities.length > 1,
            fromVentilation: hasVentilation
        });
    });
    var filtered = allTeachers.filter(function(t) { return !nameFilter || t.name.toLowerCase().includes(nameFilter); });
    if (!filtered.length) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align:center;padding:20px;color:#aaa;">Aucun enseignant trouvé</td></tr>';
        return;
    }
    filtered.sort(function(a,b) { return a.name.localeCompare(b.name); });
    var entityColors = { college: '#2980b9', lycee: '#1e8449', lycee_pro: '#d35400', pole: '#6c3483', shared: '#e67e22' };

    // Totaux par entité
    var totORS = 0, totCollege = 0, totLycee = 0, totLyceePro = 0, totPole = 0, totTotal = 0, totSolde = 0;
    filtered.forEach(function(t) {
        var totalH = t.hCollege + t.hLycee + (t.hLyceePro||0) + t.hPole;
        totORS      += t.ors;
        totCollege  += t.hCollege;
        totLycee    += t.hLycee;
        totLyceePro += (t.hLyceePro||0);
        totPole     += t.hPole;
        totTotal    += totalH;
        totSolde    += (t.ors - totalH);
    });

    var rows = filtered.map(function(t, i) {
        var totalH = t.hCollege + t.hLycee + t.hPole;
        var solde = t.ors - totalH;
        var soldeColor = Math.abs(solde) < 0.1 ? '#27ae60' : (solde > 0 ? '#e67e22' : '#c0392b');
        var bg = i % 2 === 0 ? 'white' : '#f8f9fa';
        var srcBadge = t.fromVentilation
            ? '<span title="Heures calculées depuis la ventilation" style="font-size:0.65rem;color:#27ae60;margin-left:3px;">⚡Vent.</span>'
            : '<span title="Heures saisies manuellement (pas de ventilation)" style="font-size:0.65rem;color:#e67e22;margin-left:3px;">✎Manuel</span>';
        var hLP   = t.hLyceePro   || 0;
        var rawLP = t.rawLyceePro || 0;
        var pondLP = t.pondLyceePro || 0;
        var totalH = t.hCollege + t.hLycee + hLP + t.hPole;
        var rawH   = t.rawTotal  || 0;
        var pondH  = t.pondTotal || 0;

        // Helper : affiche Xh+Yh=Zh si pondération, sinon juste Xh (couleur entité)
        // capped=true → pondération lycée plafonnée à 1h : le +1h est affiché en gras
        // boldPond=true → pondération BTS/pôle dépassant l'ORS : le +Xh est affiché en gras
        function entityCell(raw, pond, color, fw, capped, boldPond) {
            var weighted = raw + pond;
            if (weighted <= 0) return '–';
            if (pond > 0.01) {
                var pondStyle = (capped || boldPond)
                    ? 'font-weight:900;color:#8e44ad;'
                    : 'color:#8e44ad;';
                return '<span style="font-size:0.74rem;color:#8e44ad;">'+raw.toFixed(1)+'h<span style="color:#bbb;">+</span><span style="'+pondStyle+'">'+pond.toFixed(1)+'h</span>=</span>'
                     + '<span style="color:'+color+';font-weight:'+fw+';">'+weighted.toFixed(1)+'h</span>';
            }
            return '<span style="color:'+color+';font-weight:'+fw+';">'+raw.toFixed(1)+'h</span>';
        }

        var totalCell = (pondH > 0.01)
            ? '<span style="font-size:0.78rem;color:#8e44ad;">'+rawH.toFixed(1)+'h<span style="color:#aaa;">+</span>'+pondH.toFixed(1)+'h=</span><b>'+totalH.toFixed(1)+'h</b>'
            : totalH.toFixed(1)+'h';
        return '<tr style="background:'+bg+';border-bottom:1px solid #f0f0f0;">'+
            '<td style="padding:7px 10px;font-weight:600;color:#2c3e50;">'+t.name+srcBadge+'</td>'+
            '<td style="padding:7px 8px;color:#555;font-size:0.83rem;">'+t.subject+'</td>'+
            '<td style="padding:7px;text-align:center;font-weight:700;">'+t.ors+'</td>'+
            '<td style="padding:7px;text-align:center;">'+entityCell(t.rawCollege||0, t.pondCollege||0, '#2980b9', '700', false, false)+'</td>'+
            '<td style="padding:7px;text-align:center;">'+entityCell(t.rawLycee||0, t.pondLycee||0, '#1e8449', '700', t.cappedL, false)+'</td>'+
            '<td style="padding:7px;text-align:center;">'+entityCell(rawLP, pondLP, '#d35400', '700', false, false)+'</td>'+
            '<td style="padding:7px;text-align:center;">'+entityCell(t.rawPole||0, t.pondPole||0, '#6c3483', '700', t.cappedP, t.exceedsORS_P)+'</td>'+
            '<td style="padding:7px;text-align:center;font-weight:800;color:#c0392b;">'+totalCell+'</td>'+
            '<td style="padding:7px;text-align:center;font-weight:800;color:'+soldeColor+';">'+(solde>=0?'+':'')+solde.toFixed(1)+'</td>'+
            '<td style="padding:7px;text-align:center;"><span style="background:'+entityColors[t.entity]+'22;color:'+entityColors[t.entity]+';border-radius:10px;padding:2px 8px;font-size:0.75rem;font-weight:700;">'+t.entLabel+'</span></td>'+
            '</tr>';
    }).join('');

    // Ligne de totaux
    var totSoldeColor = Math.abs(totSolde) < 0.1 ? '#27ae60' : (totSolde > 0 ? '#e67e22' : '#c0392b');
    rows += '<tr style="background:#1a252f;color:white;font-weight:800;font-size:0.88rem;border-top:2px solid #555;">'+
        '<td style="padding:9px 10px;">TOTAL ('+filtered.length+' ens.)</td>'+
        '<td style="padding:9px 8px;color:#aaa;font-size:0.8rem;">–</td>'+
        '<td style="padding:9px;text-align:center;color:#f1c40f;">'+totORS.toFixed(1)+' h</td>'+
        '<td style="padding:9px;text-align:center;color:#7ec8e3;background:#1c3a52;">'+totCollege.toFixed(1)+' h<br><small style="color:#aad4e8;font-weight:500;">🏫 Collège</small></td>'+
        '<td style="padding:9px;text-align:center;color:#81e8a5;background:#1c3a2c;">'+totLycee.toFixed(1)+' h<br><small style="color:#aae8c0;font-weight:500;">🏛️ Lycée</small></td>'+
        '<td style="padding:9px;text-align:center;color:#ffb347;background:#3a2010;">'+totLyceePro.toFixed(1)+' h<br><small style="color:#ffd08a;font-weight:500;">🏭 Lycée Pro</small></td>'+
        '<td style="padding:9px;text-align:center;color:#d7a8ff;background:#2e1a3a;">'+totPole.toFixed(1)+' h<br><small style="color:#c4a0e8;font-weight:500;">🎓 Pôle</small></td>'+
        '<td style="padding:9px;text-align:center;color:#ff9999;font-size:1rem;">'+totTotal.toFixed(1)+' h</td>'+
        '<td style="padding:9px;text-align:center;font-weight:800;color:'+totSoldeColor+';">'+(totSolde>=0?'+':'')+totSolde.toFixed(1)+' h</td>'+
        '<td style="padding:9px;text-align:center;font-size:0.72rem;color:#ccc;">'+
            '<div style="color:#7ec8e3;">🏫 '+totCollege.toFixed(1)+'h</div>'+
            '<div style="color:#81e8a5;">🏛️ '+totLycee.toFixed(1)+'h</div>'+
            '<div style="color:#ffb347;">🏭 '+totLyceePro.toFixed(1)+'h</div>'+
            '<div style="color:#d7a8ff;">🎓 '+totPole.toFixed(1)+'h</div>'+
        '</td>'+
        '</tr>';

    tbody.innerHTML = rows;
}

function renderBilanSubjects() {
    var tbody = document.getElementById('bilan-subjects-body');
    if (!tbody) return;
    var allSubjects = new Set();
    ['college','lycee','lycee_pro','pole'].forEach(function(k) {
        var d = MULTI_DATA[k];
        if (d && d.subjects) d.subjects.forEach(function(s) { allSubjects.add(s); });
    });
    var rows = [];
    allSubjects.forEach(function(s) {
        var colBesoin=0,colApport=0,lycBesoin=0,lycApport=0,lpBesoin=0,lpApport=0,poleBesoin=0,poleApport=0;
        ['college','lycee','lycee_pro','pole'].forEach(function(k) {
            var d = MULTI_DATA[k];
            if (!d || !d.subjects.includes(s)) return;
            var needs = calcEntitySubjectNeeds(d, k);
            var n = needs[s] || {need:0,app:0};
            if (k==='college')    { colBesoin+=n.need; colApport+=n.app; }
            else if (k==='lycee') { lycBesoin+=n.need; lycApport+=n.app; }
            else if (k==='lycee_pro') { lpBesoin+=n.need; lpApport+=n.app; }
            else if (k==='pole')  { poleBesoin+=n.need; poleApport+=n.app; }
        });
        var totalBesoin = colBesoin+lycBesoin+lpBesoin+poleBesoin;
        var totalApport = colApport+lycApport+lpApport+poleApport;
        if (totalBesoin===0 && totalApport===0) return;
        rows.push({s,colBesoin,colApport,lycBesoin,lycApport,lpBesoin,lpApport,poleBesoin,poleApport,totalBesoin,totalApport});
    });
    rows.sort(function(a,b) { return b.totalBesoin - a.totalBesoin; });
    var fmt = function(v) { return v > 0 ? v.toFixed(1) : '–'; };

    if (!rows.length) {
        tbody.innerHTML = '<tr><td colspan="12" style="text-align:center;padding:20px;color:#aaa;">Aucune matière avec données</td></tr>';
        return;
    }

    // Calcul des totaux
    var totColBesoin=0, totColApport=0, totLycBesoin=0, totLycApport=0, totLpBesoin=0, totLpApport=0, totPolBesoin=0, totPolApport=0, totBesoin=0, totApport=0;
    rows.forEach(function(r) {
        totColBesoin  += r.colBesoin;  totColApport  += r.colApport;
        totLycBesoin  += r.lycBesoin;  totLycApport  += r.lycApport;
        totLpBesoin   += r.lpBesoin;   totLpApport   += r.lpApport;
        totPolBesoin  += r.poleBesoin; totPolApport  += r.poleApport;
        totBesoin     += r.totalBesoin;
        totApport     += r.totalApport;
    });
    var totEcart = totApport - totBesoin;
    var totEcartColor = totEcart >= 0 ? '#27ae60' : '#c0392b';

    var html = rows.map(function(r, i) {
        var ecart = r.totalApport - r.totalBesoin;
        var ec = ecart >= 0 ? '#27ae60' : '#c0392b';
        var bg = i%2===0?'white':'#f8f9fa';
        return '<tr style="background:'+bg+';border-bottom:1px solid #f0f0f0;">'+
            '<td style="padding:7px 10px;font-weight:600;color:#2c3e50;">'+r.s+'</td>'+
            '<td style="padding:7px;text-align:center;color:#2980b9;">'+fmt(r.colBesoin)+'</td>'+
            '<td style="padding:7px;text-align:center;color:#2980b9;font-weight:'+(r.colApport>0?700:400)+';">'+fmt(r.colApport)+'</td>'+
            '<td style="padding:7px;text-align:center;color:#1e8449;">'+fmt(r.lycBesoin)+'</td>'+
            '<td style="padding:7px;text-align:center;color:#1e8449;font-weight:'+(r.lycApport>0?700:400)+';">'+fmt(r.lycApport)+'</td>'+
            '<td style="padding:7px;text-align:center;color:#d35400;">'+fmt(r.lpBesoin)+'</td>'+
            '<td style="padding:7px;text-align:center;color:#d35400;font-weight:'+(r.lpApport>0?700:400)+';">'+fmt(r.lpApport)+'</td>'+
            '<td style="padding:7px;text-align:center;color:#6c3483;">'+fmt(r.poleBesoin)+'</td>'+
            '<td style="padding:7px;text-align:center;color:#6c3483;font-weight:'+(r.poleApport>0?700:400)+';">'+fmt(r.poleApport)+'</td>'+
            '<td style="padding:7px;text-align:center;font-weight:800;color:#c0392b;background:#fff5f5;">'+r.totalBesoin.toFixed(1)+'</td>'+
            '<td style="padding:7px;text-align:center;font-weight:800;color:#16a085;background:#f0fff4;">'+r.totalApport.toFixed(1)+'</td>'+
            '<td style="padding:7px;text-align:center;font-weight:800;color:'+ec+';">'+(ecart>=0?'+':'')+ecart.toFixed(1)+'</td>'+
            '</tr>';
    }).join('');

    // Ligne de totaux
    html += '<tr style="background:#1a252f;color:white;font-weight:800;font-size:0.88rem;border-top:2px solid #555;">'+
        '<td style="padding:9px 10px;">TOTAL ('+rows.length+' matières)</td>'+
        '<td style="padding:9px;text-align:center;color:#7ec8e3;background:#1c3a52;">'+totColBesoin.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#7ec8e3;background:#1c3a52;font-weight:700;">'+totColApport.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#81e8a5;background:#1c3a2c;">'+totLycBesoin.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#81e8a5;background:#1c3a2c;font-weight:700;">'+totLycApport.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#ffb347;background:#3a2010;">'+totLpBesoin.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#ffb347;background:#3a2010;font-weight:700;">'+totLpApport.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#d7a8ff;background:#2e1a3a;">'+totPolBesoin.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#d7a8ff;background:#2e1a3a;font-weight:700;">'+totPolApport.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#ff9999;background:#3a1c1c;font-size:1rem;">'+totBesoin.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:#81e8a5;background:#1c3a2c;font-size:1rem;">'+totApport.toFixed(1)+'</td>'+
        '<td style="padding:9px;text-align:center;color:'+totEcartColor+';">'+(totEcart>=0?'+':'')+totEcart.toFixed(1)+'</td>'+
        '</tr>';

    tbody.innerHTML = html;
}

/** Rend le bilan consolidé */
function renderBilanGlobal() {
    // 1. KPI GLOBAUX
    const kpiDiv = document.getElementById('bilan-kpi');
    if (!kpiDiv) return;
    
    const stats = {
        college: calcEntityStats(MULTI_DATA.college, 'college'),
        lycee: calcEntityStats(MULTI_DATA.lycee, 'lycee'),
        lycee_pro: calcEntityStats(MULTI_DATA.lycee_pro, 'lycee_pro'),
        pole: calcEntityStats(MULTI_DATA.pole, 'pole')
    };
    
    const totalDot = (MULTI_DATA.college?.config?.total||0) + (MULTI_DATA.lycee?.config?.total||0) + (MULTI_DATA.lycee_pro?.config?.total||0) + (MULTI_DATA.pole?.config?.total||0);
    const totalApp = stats.college.apport + stats.lycee.apport + stats.lycee_pro.apport + stats.pole.apport;
    const totalHSA = stats.college.hsa + stats.lycee.hsa + stats.lycee_pro.hsa + stats.pole.hsa;
    const totalProfs = SHARED_TEACHERS.length;
    
    kpiDiv.innerHTML = `
        <div class="kpi-box" style="border-color:#2c3e50;">
            <div class="kpi-title">Dotation Totale</div>
            <div class="kpi-value">${totalDot} h</div>
            <small style="color:#999; font-size:0.7rem;">4 entités cumulées</small>
        </div>
        <div class="kpi-box" style="border-color:#27ae60;">
            <div class="kpi-title">Heures Attribuées</div>
            <div class="kpi-value">${totalApp.toFixed(1)} h</div>
        </div>
        <div class="kpi-box" style="border-color:#e67e22;">
            <div class="kpi-title">Dont HSA</div>
            <div class="kpi-value">${totalHSA.toFixed(1)} h</div>
        </div>
        <div class="kpi-box" style="border-color:#3498db;">
            <div class="kpi-title">Enseignants (total)</div>
            <div class="kpi-value">${totalProfs}</div>
            <small style="color:#999; font-size:0.7rem;">dans la liste globale</small>
        </div>
    `;
    
    // 2. CARDS PAR ENTITÉ
    const cardsDiv = document.getElementById('bilan-cards');
    const entityColors = { college: '#3498db', lycee: '#27ae60', lycee_pro: '#d35400', pole: '#8e44ad' };
    const entityIcons = { college: '🏫', lycee: '🏛️', lycee_pro: '🏭', pole: '🎓' };
    
    cardsDiv.innerHTML = ['college','lycee','lycee_pro','pole'].map(k => {
        const s = stats[k];
        const d = MULTI_DATA[k];
        const color = entityColors[k];
        const name = ENTITY_NAMES[k];
        const icon = entityIcons[k];
        const profs = SHARED_TEACHERS.filter(t => t.entities && t.entities.includes(k)).length;
        const classes = d ? Object.keys(d.classNames || {}).length : 0;
        const dotation = d?.config?.total || 0;
        const soldeColor = s.solde >= 0 ? '#27ae60' : '#c0392b';
        
        return `<div class="card" style="border-top:4px solid ${color}; margin-bottom:0;">
            <div style="font-size:1.5rem; margin-bottom:5px;">${icon}</div>
            <h4 style="margin:0 0 15px 0; color:${color};">${name}</h4>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:0.85rem;">
                <div style="background:#f8f9fa; padding:8px; border-radius:5px;">
                    <div style="color:#888; font-size:0.75rem; font-weight:700;">DOTATION</div>
                    <div style="font-weight:800; font-size:1.1rem; color:#2c3e50;">${dotation} h</div>
                </div>
                <div style="background:#fdf2e9; padding:8px; border-radius:5px;">
                    <div style="color:#888; font-size:0.75rem; font-weight:700;">SOLDE</div>
                    <div style="font-weight:800; font-size:1.1rem; color:${soldeColor};">${s.solde >= 0 ? '+' : ''}${s.solde.toFixed(1)} h</div>
                </div>
                <div style="background:#e8f8f5; padding:8px; border-radius:5px;">
                    <div style="color:#888; font-size:0.75rem; font-weight:700;">PROFS</div>
                    <div style="font-weight:800; color:#2c3e50;">${profs}</div>
                </div>
                <div style="background:#ebf5fb; padding:8px; border-radius:5px;">
                    <div style="color:#888; font-size:0.75rem; font-weight:700;">CLASSES</div>
                    <div style="font-weight:800; color:#2c3e50;">${classes}</div>
                </div>
            </div>
        </div>`;
    }).join('');
    
    // 3. TABLEAU CONSOLIDÉ PAR BUREAU PNE
    renderBilanBureau();
    // 4. TABLEAU ENSEIGNANTS × ENTITÉS
    renderBilanTeachers();
    // 5. RÉCAP MATIÈRES CROSS-ENTITÉS
    renderBilanSubjects();
}

/** Rend le tableau consolidé par bureau PNE */
function renderBilanBureau() {
    const tbody = document.getElementById('bilan-bureau-body');
    if (!tbody) return;
    
    // Collecter les besoins de chaque entité par code PNE
    const needsByCode = {}; // { code: { college: h, lycee: h, pole: h, label: '' } }
    
    ['college','lycee','lycee_pro','pole'].forEach(k => {
        const d = MULTI_DATA[k];
        if (!d) return;
        const needs = calcEntitySubjectNeeds(d, k);
        Object.entries(needs).forEach(([subject, data]) => {
            const code = data.pneCode || '';
            const key = code || subject;
            if (!needsByCode[key]) needsByCode[key] = { code, label: subject, college: 0, lycee: 0, lycee_pro: 0, pole: 0, appCollege: 0, appLycee: 0, appLycee_pro: 0, appPole: 0 };
            needsByCode[key][k] += data.need;
            needsByCode[key]['app'+k.charAt(0).toUpperCase()+k.slice(1)] += data.app;
        });
    });
    
    // Grouper par bureau
    let html = '';
    
    Object.entries(PNE_BUREAUX).forEach(([bureauId, bureau]) => {
        const bureauColor = bureau.color;
        let bureauBesoinTotal = 0, bureauApportTotal = 0;
        let rowsHtml = '';
        
        // Chercher les matières qui correspondent à ce bureau
        Object.entries(needsByCode).forEach(([key, data]) => {
            const codeBureau = getBureauForCode(data.code);
            if (codeBureau !== bureauId && data.code) return;
            if (!data.code && codeBureau !== bureauId) return;
            
            const besoinTotal = (data.college||0) + (data.lycee||0) + (data.lycee_pro||0) + (data.pole||0);
            const apportTotal = (data.appCollege||0) + (data.appLycee||0) + (data.appLycee_pro||0) + (data.appPole||0);
            if (besoinTotal === 0 && apportTotal === 0) return;
            
            bureauBesoinTotal += besoinTotal;
            bureauApportTotal += apportTotal;
            const ecart = apportTotal - besoinTotal;
            const ecartColor = ecart >= 0 ? '#27ae60' : '#c0392b';
            
            rowsHtml += `<tr style="border-bottom:1px solid #f0f0f0;">
                <td style="padding:7px 8px 7px 25px; font-size:0.83rem;">${data.code ? `<span style="font-family:monospace;font-size:0.75rem;background:#f0f0f0;padding:1px 4px;border-radius:2px;margin-right:6px;">${data.code}</span>` : ''}${data.label}</td>
                <td style="text-align:center; padding:7px; color:#2980b9; font-weight:600;">${data.college > 0 ? data.college.toFixed(1) : '–'}</td>
                <td style="text-align:center; padding:7px; color:#1e8449; font-weight:600;">${data.lycee > 0 ? data.lycee.toFixed(1) : '–'}</td>
                <td style="text-align:center; padding:7px; color:#d35400; font-weight:600;">${data.lycee_pro > 0 ? data.lycee_pro.toFixed(1) : '–'}</td>
                <td style="text-align:center; padding:7px; color:#7d3c98; font-weight:600;">${data.pole > 0 ? data.pole.toFixed(1) : '–'}</td>
                <td style="text-align:center; padding:7px; background:#fff5f5; font-weight:700; color:#c0392b;">${besoinTotal.toFixed(1)}</td>
                <td style="text-align:center; padding:7px; background:#f0fff4; font-weight:700; color:#16a085;">${apportTotal.toFixed(1)}</td>
                <td style="text-align:center; padding:7px; font-weight:800; color:${ecartColor};">${ecart >= 0 ? '+' : ''}${ecart.toFixed(1)}</td>
            </tr>`;
        });
        
        if (!rowsHtml) return; // Ne pas afficher les bureaux sans données
        
        const ecartBureau = bureauApportTotal - bureauBesoinTotal;
        html += `<tr style="background:${bureauColor}20; border-top:2px solid ${bureauColor};">
            <td colspan="8" style="padding:9px 12px; font-weight:700; color:${bureauColor}; font-size:0.88rem;">
                ${bureauId} – ${bureau.label}
                <span style="float:right; font-size:0.8rem; color:#555;">
                    Besoin : <strong>${bureauBesoinTotal.toFixed(1)}h</strong> &nbsp;|&nbsp; 
                    Apport : <strong>${bureauApportTotal.toFixed(1)}h</strong> &nbsp;|&nbsp;
                    Écart : <strong style="color:${ecartBureau>=0?'#27ae60':'#c0392b'}">${ecartBureau>=0?'+':''}${ecartBureau.toFixed(1)}h</strong>
                </span>
            </td>
        </tr>${rowsHtml}`;
    });
    
    // Matières sans code PNE
    let unknownHtml = '';
    Object.entries(needsByCode).forEach(([key, data]) => {
        if (data.code && getBureauForCode(data.code)) return;
        const besoinTotal = (data.college||0) + (data.lycee||0) + (data.lycee_pro||0) + (data.pole||0);
        const apportTotal = (data.appCollege||0) + (data.appLycee||0) + (data.appLycee_pro||0) + (data.appPole||0);
        if (besoinTotal === 0 && apportTotal === 0) return;
        const ecart = apportTotal - besoinTotal;
        unknownHtml += `<tr style="border-bottom:1px solid #f0f0f0;">
            <td style="padding:7px 8px 7px 25px; font-size:0.83rem; color:#aaa;">${data.label} <em style="font-size:0.7rem;">(code non renseigné)</em></td>
            <td style="text-align:center; padding:7px; color:#2980b9;">${data.college > 0 ? data.college.toFixed(1) : '–'}</td>
            <td style="text-align:center; padding:7px; color:#1e8449;">${data.lycee > 0 ? data.lycee.toFixed(1) : '–'}</td>
            <td style="text-align:center; padding:7px; color:#d35400;">${data.lycee_pro > 0 ? data.lycee_pro.toFixed(1) : '–'}</td>
            <td style="text-align:center; padding:7px; color:#7d3c98;">${data.pole > 0 ? data.pole.toFixed(1) : '–'}</td>
            <td style="text-align:center; padding:7px; background:#fff5f5; font-weight:700; color:#c0392b;">${besoinTotal.toFixed(1)}</td>
            <td style="text-align:center; padding:7px; background:#f0fff4; font-weight:700; color:#16a085;">${apportTotal.toFixed(1)}</td>
            <td style="text-align:center; padding:7px; font-weight:800; color:${ecart>=0?'#27ae60':'#c0392b'};">${ecart>=0?'+':''}${ecart.toFixed(1)}</td>
        </tr>`;
    });
    if (unknownHtml) {
        html += `<tr style="background:#f8f9fa; border-top:2px solid #bdc3c7;">
            <td colspan="8" style="padding:9px 12px; font-weight:700; color:#7f8c8d;">❓ Matières sans code PNE</td>
        </tr>${unknownHtml}`;
    }
    
    tbody.innerHTML = html || '<tr><td colspan="8" style="text-align:center; padding:20px; color:#aaa;">Aucune donnée disponible – renseignez les codes PNE dans les matières</td></tr>';
}

// ================================================================
// ENSEIGNANTS MUTUALISÉS – gestion UI
// ================================================================

/** Peuple le select des codes PNE dans le modal */
function populatePneSelect() {
    const sel = document.getElementById('st-pne-code');
    if (!sel) return;
    let html = '<option value="">-- Sélectionner --</option>';
    Object.entries(PNE_BUREAUX).forEach(([bureauId, bureau]) => {
        html += `<optgroup label="${bureau.label}">`;
        Object.entries(bureau.disciplines).forEach(([code, label]) => {
            html += `<option value="${code}">${code} – ${label}</option>`;
        });
        html += '</optgroup>';
    });
    sel.innerHTML = html;
}

function updateStBureauDisplay() {
    const code = document.getElementById('st-pne-code').value;
    const div = document.getElementById('st-bureau-display');
    if (!div) return; // Champ bureau supprimé du modal
    if (!code) { div.textContent = '–'; return; }
    const bureauId = getBureauForCode(code);
    if (bureauId) {
        const b = PNE_BUREAUX[bureauId];
        div.innerHTML = `<span style="background:${b.color}30; color:${b.color}; font-weight:700; padding:2px 8px; border-radius:4px; font-size:0.82rem;">${bureauId}</span> ${b.label}`;
    } else {
        div.textContent = 'Code non reconnu';
    }
}

function updateStReste() {
    const ors = parseFloat(document.getElementById('st-ors').value) || 0;
    const hC  = parseFloat(document.getElementById('st-h-college').value) || 0;
    const hL  = parseFloat(document.getElementById('st-h-lycee').value) || 0;
    const hLP = parseFloat(document.getElementById('st-h-lycee-pro')?.value) || 0;
    const hP  = parseFloat(document.getElementById('st-h-pole').value) || 0;
    const total = hC + hL + hLP + hP;
    const reste = ors - total;
    // Mettre à jour les affichages par entité (lecture seule)
    const fmt = v => v > 0 ? v + 'h' : '–';
    const dispC = document.getElementById('st-disp-college');
    const dispL = document.getElementById('st-disp-lycee');
    const dispLP = document.getElementById('st-disp-lycee-pro');
    const dispP = document.getElementById('st-disp-pole');
    if (dispC) dispC.textContent = fmt(hC);
    if (dispL) dispL.textContent = fmt(hL);
    if (dispLP) dispLP.textContent = fmt(hLP);
    if (dispP) dispP.textContent = fmt(hP);
    const div = document.getElementById('st-reste-display');
    if (div) {
        const col = reste > 0 ? '#e67e22' : (reste === 0 ? '#27ae60' : '#c0392b');
        div.innerHTML = `Total affecté : <strong>${total}h</strong> / ORS : <strong>${ors}h</strong> &nbsp;→ Reste : <strong style="color:${col}">${reste >= 0 ? '+' : ''}${reste}h</strong>`;
    }
}

function stEntityCheckChange() {
    // Met à jour l'apparence des cases (bordure active si cochée)
    ['college','lycee','lycee_pro','pole'].forEach(k => {
        const chk = document.getElementById('st-entity-' + k);
        const lbl = document.getElementById('st-entity-lbl-' + k);
        if (chk && lbl) {
            const colors = {college:'#2980b9', lycee:'#1e8449', lycee_pro:'#d35400', pole:'#7d3c98'};
            lbl.style.borderWidth = chk.checked ? '2.5px' : '2px';
            lbl.style.borderColor = chk.checked ? colors[k] : {college:'#aed6f1', lycee:'#a9dfbf', lycee_pro:'#f0b27a', pole:'#c39bd3'}[k];
            lbl.style.boxShadow = chk.checked ? '0 0 0 2px ' + colors[k] + '33' : 'none';
        }
    });
    stUpdateSubjectsPerEntity();
}

// Affiche/masque les champs discipline par entité selon les cases cochées
function stUpdateSubjectsPerEntity() {
    const container = document.getElementById('st-subjects-per-entity');
    if (!container) return;
    const entityNames = {college:'🏫 Collège', lycee:'🏛️ Lycée', lycee_pro:'🏭 Lycée Pro', pole:'🎓 Pôle Sup.'};
    const entityColors = {college:'#2980b9', lycee:'#1e8449', lycee_pro:'#d35400', pole:'#7d3c98'};
    const checkedEntities = stGetEntityCheckboxes();
    // Sauvegarder les valeurs actuelles avant de re-rendre
    const currentVals = {};
    ['college','lycee','lycee_pro','pole'].forEach(k => {
        const el = document.getElementById('st-subj-' + k);
        if (el) currentVals[k] = el.value;
    });
    if (checkedEntities.length <= 1) {
        container.innerHTML = '';
        return;
    }
    container.innerHTML = checkedEntities.map(k => `
        <div style="display:flex; align-items:center; gap:8px;">
            <span style="font-size:0.78rem; font-weight:700; color:${entityColors[k]}; min-width:80px;">${entityNames[k]}</span>
            <input type="text" id="st-subj-${k}" placeholder="Discipline pour ${entityNames[k]}"
                value="${currentVals[k] || ''}"
                style="flex:1; padding:4px 8px; border:1.5px solid ${entityColors[k]}55; border-radius:5px; font-size:0.82rem;">
        </div>`).join('');
}

// Retourne le dict subjects{entityKey: discipline} depuis le modal
function stGetSubjectsPerEntity() {
    const checkedEntities = stGetEntityCheckboxes();
    const mainSubject = document.getElementById('st-subject').value.trim();
    const subjects = {};
    checkedEntities.forEach(k => {
        const el = document.getElementById('st-subj-' + k);
        subjects[k] = (el && el.value.trim()) ? el.value.trim() : mainSubject;
    });
    return subjects;
}

// Charge les disciplines par entité dans le modal (édition)
function stLoadSubjectsPerEntity(t) {
    // D'abord déclencher le rendu des champs
    stUpdateSubjectsPerEntity();
    // Puis remplir les valeurs
    const subjects = t.subjects || {};
    ['college','lycee','lycee_pro','pole'].forEach(k => {
        const el = document.getElementById('st-subj-' + k);
        if (el) el.value = subjects[k] || t.subject || '';
    });
}

function stSetEntityCheckboxes(entities) {
    ['college','lycee','lycee_pro','pole'].forEach(k => {
        const chk = document.getElementById('st-entity-' + k);
        if (chk) chk.checked = entities ? entities.includes(k) : false;
    });
    stEntityCheckChange();
}

function stGetEntityCheckboxes() {
    return ['college','lycee','lycee_pro','pole'].filter(k => {
        const chk = document.getElementById('st-entity-' + k);
        return chk && chk.checked;
    });
}

function stShowHoursInLabels(t) {
    // Affiche les heures déjà assignées à côté de chaque entité
    const keys = {college:'st-disp-college', lycee:'st-disp-lycee', lycee_pro:'st-disp-lycee-pro', pole:'st-disp-pole'};
    ['college','lycee','lycee_pro','pole'].forEach(k => {
        const el = document.getElementById(keys[k]);
        if (!el) return;
        const h = t && t.services && t.services[k] > 0 ? t.services[k] + 'h' : '';
        el.textContent = h;
    });
}

function openAddSharedTeacher() {
    populatePneSelect();
    document.getElementById('st-id').value = '';
    document.getElementById('st-name').value = '';
    document.getElementById('st-grade').value = '';
    document.getElementById('st-email').value = '';
    document.getElementById('st-subject').value = '';
    document.getElementById('st-pne-code').value = '';
    document.getElementById('st-ors').value = 18;
    document.getElementById('st-h-college').value = 0;
    document.getElementById('st-h-lycee').value = 0;
    if(document.getElementById('st-h-lycee-pro')) document.getElementById('st-h-lycee-pro').value = 0;
    document.getElementById('st-h-pole').value = 0;
    // Cocher l'entité courante par défaut
    stSetEntityCheckboxes([currentEntity]);
    stShowHoursInLabels(null);
    stUpdateSubjectsPerEntity(); // Afficher les champs discipline par entité
    updateStBureauDisplay();
    updateStReste();
    const overlay = document.getElementById('shared-teacher-overlay');
    overlay.style.display = 'flex';
}

function editSharedTeacher(id) {
    populatePneSelect();
    const t = SHARED_TEACHERS.find(t => t.id === id);
    if (!t) return;
    document.getElementById('st-id').value = t.id;
    document.getElementById('st-name').value = t.name || '';
    document.getElementById('st-grade').value = t.grade || '';
    document.getElementById('st-email').value = t.email || '';
    document.getElementById('st-subject').value = t.subject || '';
    document.getElementById('st-pne-code').value = t.pneCode || '';
    document.getElementById('st-ors').value = t.ors || 18;
    document.getElementById('st-h-college').value = t.services?.college || 0;
    document.getElementById('st-h-lycee').value = t.services?.lycee || 0;
    if(document.getElementById('st-h-lycee-pro')) document.getElementById('st-h-lycee-pro').value = t.services?.lycee_pro || 0;
    document.getElementById('st-h-pole').value = t.services?.pole || 0;
    // Cocher les entités auxquelles l'enseignant appartient
    stSetEntityCheckboxes(t.entities || []);
    stShowHoursInLabels(t);
    stLoadSubjectsPerEntity(t); // Charger les disciplines par entité
    updateStBureauDisplay();
    updateStReste();
    document.getElementById('shared-teacher-overlay').style.display = 'flex';
}


// ================================================================
// ASSIGNATION D'UN ENSEIGNANT À UNE ENTITÉ
// ================================================================
function openAssignTeacherModal() {
    // Profs globaux PAS encore assignés à l'entité courante
    const available = SHARED_TEACHERS
        .map((t, idx) => ({...t, _sharedIdx: idx}))
        .filter(t => !t.entities || !t.entities.includes(currentEntity))
        .sort((a, b) => (a.name||'').localeCompare(b.name||'', 'fr', {sensitivity:'base'}));

    let overlay = document.getElementById('assign-teacher-modal');
    if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'assign-teacher-modal';
        overlay.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:30000; justify-content:center; align-items:center;';
        document.body.appendChild(overlay);
    }

    const entityLabel = ENTITY_NAMES[currentEntity] || currentEntity;
    const entityIcon = {college:'🏫', lycee:'🏛️', lycee_pro:'🏭', pole:'🎓'}[currentEntity] || '🏫';

    if (available.length === 0) {
        overlay.innerHTML = `
            <div style="background:white; border-radius:12px; padding:30px; width:500px; max-width:95vw; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 style="margin:0; color:#2c3e50;">${entityIcon} Assigner à ${entityLabel}</h3>
                    <button onclick="document.getElementById('assign-teacher-modal').style.display='none'" style="background:none;border:none;font-size:1.4rem;cursor:pointer;color:#999;">×</button>
                </div>
                <p style="color:#888; text-align:center; padding:20px 0;">
                    Tous les enseignants de la liste globale sont déjà assignés à cette entité.<br>
                    <small>Créez d'abord des enseignants dans l'onglet <b>Enseignants</b>.</small>
                </p>
                <div style="text-align:right;">
                    <button onclick="document.getElementById('assign-teacher-modal').style.display='none'" style="padding:8px 20px; border:1px solid #ddd; border-radius:6px; background:#f5f5f5; cursor:pointer;">Fermer</button>
                </div>
            </div>`;
    } else {
        const rows = available.map(t => `
            <tr id="assign-row-${t._sharedIdx}" style="border-bottom:1px solid #f0f0f0;">
                <td style="padding:8px 6px; font-weight:600;">${t.name || '–'}</td>
                <td style="padding:8px 6px; color:#666; font-size:0.85rem;">${t.subject || '–'}</td>
                <td style="padding:8px 6px; color:#888; font-size:0.8rem;">${t.grade || t.status || '–'}</td>
                <td style="padding:8px 6px; color:#888; font-size:0.8rem;">${t.ors || 18}h</td>
                <td style="padding:8px 6px; text-align:right;">
                    <button onclick="assignTeacherToEntity(${t._sharedIdx})" 
                        style="padding:4px 12px; border:none; border-radius:5px; background:#27ae60; color:white; font-weight:600; cursor:pointer; font-size:0.85rem;">
                        ➕ Ajouter
                    </button>
                </td>
            </tr>`).join('');

        overlay.innerHTML = `
            <div style="background:white; border-radius:12px; padding:30px; width:620px; max-width:95vw; box-shadow:0 10px 40px rgba(0,0,0,0.3); max-height:85vh; display:flex; flex-direction:column;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; flex-shrink:0;">
                    <h3 style="margin:0; color:#2c3e50;">${entityIcon} Assigner à ${entityLabel}</h3>
                    <button onclick="document.getElementById('assign-teacher-modal').style.display='none'" style="background:none;border:none;font-size:1.4rem;cursor:pointer;color:#999;">×</button>
                </div>
                <p style="margin:0 0 12px 0; color:#888; font-size:0.85rem; flex-shrink:0;">
                    Sélectionnez les enseignants à faire apparaître dans cette entité :
                </p>
                <div style="overflow-y:auto; flex:1;">
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f8f9fa; font-size:0.8rem; color:#777; text-transform:uppercase;">
                                <th style="padding:6px; text-align:left;">Nom</th>
                                <th style="padding:6px; text-align:left;">Discipline</th>
                                <th style="padding:6px; text-align:left;">Grade</th>
                                <th style="padding:6px; text-align:left;">ORS</th>
                                <th style="padding:6px;"></th>
                            </tr>
                        </thead>
                        <tbody id="assign-teacher-tbody">${rows}</tbody>
                    </table>
                </div>
                <div style="margin-top:16px; text-align:right; flex-shrink:0;">
                    <button onclick="document.getElementById('assign-teacher-modal').style.display='none'" style="padding:8px 20px; border:1px solid #ddd; border-radius:6px; background:#f5f5f5; cursor:pointer;">Fermer</button>
                </div>
            </div>`;
    }

    overlay.style.display = 'flex';
}

function assignTeacherToEntity(sharedIdx) {
    const t = SHARED_TEACHERS[sharedIdx];
    if (!t) return;
    if (!t.entities) t.entities = [];
    if (!t.entities.includes(currentEntity)) {
        t.entities.push(currentEntity);
    }
    saveAllData();
    renderRH();
    // Supprimer la ligne de la liste (sans fermer le modal)
    const row = document.getElementById('assign-row-' + sharedIdx);
    if (row) {
        row.style.transition = 'opacity 0.3s';
        row.style.opacity = '0';
        setTimeout(() => row.remove(), 300);
    }
}

function removeTeacherFromEntity(sharedIdx) {
    const t = SHARED_TEACHERS[sharedIdx];
    if (!t) return;
    if (!confirm('Retirer ' + (t.name || 'cet enseignant') + ' de cette entité ?')) return;
    t.entities = (t.entities || []).filter(e => e !== currentEntity);
    // Remettre les heures de cette entité à 0
    if (t.services) t.services[currentEntity] = 0;
    saveAllData();
    renderRH();
}


// ================================================================
// HELPER : enseignants de l'entité courante (remplace DATA.teachers)
// ================================================================
/**
 * Retourne la discipline d'un enseignant pour une entité donnée.
 * Priorité : t.subjects[entityKey] > t.subject (global)
 */
function getTeacherSubjectForEntity(t, entityKey) {
    if (t.subjects && t.subjects[entityKey]) return t.subjects[entityKey];
    return t.subject || '';
}

function getEntityTeachers() {
    return SHARED_TEACHERS
        .map((t, idx) => {
            // Injecter la discipline spécifique à l'entité courante dans le champ 'subject'
            const subjectForEntity = getTeacherSubjectForEntity(t, currentEntity);
            return {...t, idx, subject: subjectForEntity};
        })
        .filter(t => t.entities && t.entities.includes(currentEntity));
}

function closeSharedTeacherModal() {
    document.getElementById('shared-teacher-overlay').style.display = 'none';
}

function saveSharedTeacher() {
    const name = document.getElementById('st-name').value.trim();
    if (!name) { alert('Veuillez saisir un nom.'); return; }
    const id = document.getElementById('st-id').value || '';
    const existing = id ? SHARED_TEACHERS.find(t => t.id === id) : null;
    // Récupérer les entités cochées
    const checkedEntities = stGetEntityCheckboxes();
    if (checkedEntities.length === 0) {
        alert('Veuillez sélectionner au moins une entité.');
        return;
    }
    // Conserver les entités existantes non décochées (avec leurs heures), supprimer celles décochées
    const prevEntities = existing?.entities || [];
    // Nettoyer les services des entités décochées
    const services = existing?.services ? {...existing.services} : { college: 0, lycee: 0, lycee_pro: 0, pole: 0 };
    prevEntities.forEach(k => {
        if (!checkedEntities.includes(k)) services[k] = 0;
    });
    const teacher = {
        id: id || 'T_' + Date.now(),
        name,
        grade: document.getElementById('st-grade').value,
        email: document.getElementById('st-email').value.trim(),
        subject: document.getElementById('st-subject').value.trim(),
        subjects: stGetSubjectsPerEntity(), // disciplines par entité
        pneCode: document.getElementById('st-pne-code').value,
        bureau: getBureauForCode(document.getElementById('st-pne-code').value) || '',
        ors: parseFloat(document.getElementById('st-ors').value) || 18,
        services,
        entities: checkedEntities
    };
    upsertSharedTeacher(teacher);
    closeSharedTeacherModal();
    renderSharedTeachers();
    renderRH();
}

function deleteSharedTeacher(id) {
    if (!confirm('Supprimer cet enseignant ?')) return;
    SHARED_TEACHERS = SHARED_TEACHERS.filter(t => t.id !== id);
    saveAllData();
    renderSharedTeachers();
}

function renderSharedTeachers() {
    const tbody = document.getElementById('shared-teachers-body');
    const emptyDiv = document.getElementById('shared-teachers-empty');
    if (!tbody) return;
    
    const filterGrade = document.getElementById('filter-grade')?.value || '';
    const filterEntity = document.getElementById('filter-entity')?.value || '';
    const filterName = (document.getElementById('filter-teacher-name')?.value || '').toLowerCase();
    
    let teachers = SHARED_TEACHERS.filter(t => {
        if (filterGrade && t.grade !== filterGrade) return false;
        if (filterEntity && !(t.services?.[filterEntity] > 0)) return false;
        if (filterName && !t.name.toLowerCase().includes(filterName)) return false;
        return true;
    });
    
    // Tri alphabétique
    teachers.sort((a, b) => a.name.localeCompare(b.name, 'fr'));
    
    if (teachers.length === 0) {
        tbody.innerHTML = '';
        if (emptyDiv) emptyDiv.style.display = 'block';
        return;
    }
    if (emptyDiv) emptyDiv.style.display = 'none';
    
    // Helper d'affichage identique au bilan consolidé : Xh+Yh=Zh si pondération
    function sharedEntityCell(raw, pond, color, capped, boldPond) {
        const weighted = raw + pond;
        if (weighted <= 0) return '<span style="color:#ccc;">–</span>';
        if (pond > 0.01) {
            const pondStyle = (capped || boldPond) ? 'font-weight:900;color:#8e44ad;' : 'color:#8e44ad;';
            return `<span style="font-size:0.74rem;color:#8e44ad;">${raw.toFixed(1)}h<span style="color:#bbb;">+</span><span style="${pondStyle}">${pond.toFixed(1)}h</span>=</span>`
                 + `<span style="color:${color};font-weight:700;">${weighted.toFixed(1)}h</span>`;
        }
        return `<span style="color:${color};font-weight:700;">${raw.toFixed(1)}h</span>`;
    }

    tbody.innerHTML = teachers.map((t, i) => {
        // === MÊME MÉTHODOLOGIE QUE LE BILAN CONSOLIDÉ ===
        const sharedIdx = SHARED_TEACHERS.indexOf(t);
        const bdC  = calcTeacherHoursBreakdown(sharedIdx, 'college');
        const bdL  = calcTeacherHoursBreakdown(sharedIdx, 'lycee');
        const bdLP = calcTeacherHoursBreakdown(sharedIdx, 'lycee_pro');
        const bdP  = calcTeacherHoursBreakdown(sharedIdx, 'pole');

        let hC = bdC.weighted, hL = bdL.weighted, hLP = bdLP.weighted, hP = bdP.weighted;
        let rawC = bdC.raw, rawL = bdL.raw, rawLP = bdLP.raw, rawP = bdP.raw;
        let pondC = bdC.pond, pondL = bdL.pond, pondLP = bdLP.pond, pondP = bdP.pond;

        // Fallback manuel si pas de ventilation calculée
        const hasVentilation = (hC + hL + hLP + hP) > 0;
        if (!hasVentilation) {
            hC  = parseFloat(t.services?.college)    || 0;
            hL  = parseFloat(t.services?.lycee)      || 0;
            hLP = parseFloat(t.services?.lycee_pro)  || 0;
            hP  = parseFloat(t.services?.pole)       || 0;
            rawC = hC; rawL = hL; rawLP = hLP; rawP = hP;
            pondC = 0; pondL = 0; pondLP = 0; pondP = 0;
        }

        const totalH   = hC + hL + hLP + hP;
        const rawTotal = rawC + rawL + rawLP + rawP;
        const pondTotal= pondC + pondL + pondLP + pondP;
        const ors      = parseFloat(t.ors) || 18;
        const solde    = ors - totalH;
        const soldeColor = Math.abs(solde) < 0.1 ? '#27ae60' : (solde > 0 ? '#e67e22' : '#c0392b');
        const rowBg    = totalH > ors ? '#fff5f5' : (i % 2 === 0 ? 'white' : '#f8f9fa');

        // Cellule Total (avec pondération si applicable)
        const totalCell = pondTotal > 0.01
            ? `<span style="font-size:0.74rem;color:#8e44ad;">${rawTotal.toFixed(1)}h<span style="color:#bbb;">+</span>${pondTotal.toFixed(1)}h=</span><b style="color:#c0392b;">${totalH.toFixed(1)}h</b>`
            : `<b style="color:#c0392b;">${totalH.toFixed(1)}h</b>`;

        const srcBadge = hasVentilation
            ? `<span title="Heures calculées depuis la ventilation" style="font-size:0.62rem;color:#27ae60;margin-left:3px;">⚡</span>`
            : `<span title="Heures saisies manuellement" style="font-size:0.62rem;color:#e67e22;margin-left:3px;">✎</span>`;

        return `<tr style="border-bottom:1px solid #eee; background:${rowBg};">
            <td style="padding:8px; font-weight:600;">${t.name}${srcBadge}${t.email ? `<br><span style="font-size:0.72rem; color:#7f8c8d; font-weight:400;">✉️ ${t.email}</span>` : ''}</td>
            <td style="padding:8px; font-size:0.82rem;">${t.grade ? `<span style="background:#eaf0ff; color:#2c3e50; border-radius:3px; padding:2px 6px; font-weight:600;">${t.grade}</span>` : '<span style="color:#aaa;">–</span>'}</td>
            <td style="padding:8px; font-size:0.85rem; color:#555;">${t.subject || '–'}</td>
            <td style="padding:8px; text-align:center; font-family:monospace; font-size:0.8rem; color:#555;">${t.pneCode || '–'}</td>
            <td style="padding:8px; text-align:center; font-weight:700; color:#2980b9;">${ors}h</td>
            <td style="padding:8px; text-align:center;">${sharedEntityCell(rawC, pondC, '#2980b9', false, false)}</td>
            <td style="padding:8px; text-align:center;">${sharedEntityCell(rawL, pondL, '#1e8449', bdL.pondCapped||false, false)}</td>
            <td style="padding:8px; text-align:center;">${sharedEntityCell(rawLP, pondLP, '#d35400', false, false)}</td>
            <td style="padding:8px; text-align:center;">${sharedEntityCell(rawP, pondP, '#7d3c98', bdP.pondCapped||false, bdP.pondExceedsORS||false)}</td>
            <td style="padding:8px; text-align:center; font-weight:800; background:#fff8f8;">${totalCell}</td>
            <td style="padding:8px; text-align:center; font-weight:800; color:${soldeColor};">${solde >= 0 ? '+' : ''}${solde.toFixed(1)}h</td>
            <td style="padding:8px; text-align:center;">
                <button class="btn btn-sm btn-primary" onclick="editSharedTeacher('${t.id}')" style="margin-right:3px;">✏️</button>
                <button class="btn btn-sm btn-danger" onclick="deleteSharedTeacher('${t.id}')">×</button>
            </td>
        </tr>`;
    }).join('');
}

function exportBilanGlobal(format) {
    alert('Export ' + format.toUpperCase() + ' du bilan global – fonctionnalité disponible dans la prochaine version.');
}

function loadSaveFile(input) {
    const f = input.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = e => {
        try {
            let loadedData = JSON.parse(e.target.result);
            
            // === DÉTECTION FORMAT MULTI-ENTITÉS V9 ===
            if (loadedData.version === 'multi-v9' && loadedData.entities) {
                // Format multi-entités natif
                MULTI_DATA = loadedData.entities || { college: null, lycee: null, lycee_pro: null, pole: null };
                ENTITY_NAMES = loadedData.names || { college: 'Collège', lycee: 'Lycée', lycee_pro: 'Lycée Pro', pole: 'Pôle Supérieur' };
                currentEntity = loadedData.currentEntity || 'college';
                SHARED_TEACHERS = loadedData.sharedTeachers || [];
                DATA = MULTI_DATA[currentEntity];
                
                if (!DATA) {
                    for (const k of ['college', 'lycee', 'lycee_pro', 'pole']) {
                        if (MULTI_DATA[k]) { currentEntity = k; DATA = MULTI_DATA[k]; break; }
                    }
                }
                
                saveAllData();
                alert("✅ Sauvegarde multi-entités chargée avec succès !");
                location.reload();
                return;
            }
            
            // === FORMAT MONO-ENTITÉ ANCIEN (migration) ===
            // --- MIGRATIONS & INITIALISATIONS ---
            if (typeof migrateV18toV19 === 'function') {
                loadedData = migrateV18toV19(loadedData);
            }
            
            if (!loadedData.assignments) loadedData.assignments = {}; 
            if (!loadedData.config) loadedData.config = { year: new Date().getFullYear(), total: 0, hp: 0, hsa: 0 };
            if (loadedData.teachers) {
                loadedData.teachers.forEach(p => {
                    if (p.csd === undefined) p.csd = 0;
                    if (p.decharge === undefined) p.decharge = 0;
                    if (p.dech_ext === undefined) p.dech_ext = 0; 
                });
            }

            // Déterminer dans quelle entité placer les données chargées
            let targetEntity = 'college';
            if (loadedData.structure && Array.isArray(loadedData.structure)) {
                const isLGT = loadedData.structure.some(lvl => {
                    const nom = lvl.level || lvl.name || ""; 
                    return nom.includes("1ère") || nom.includes("Terminale");
                });
                if (isLGT) targetEntity = 'lycee';
                else if (loadedData.type === 'lp') targetEntity = 'lycee';
            }

            MULTI_DATA[targetEntity] = loadedData;
            currentEntity = targetEntity;
            DATA = loadedData;

            // --- DÉTECTION LGT pour le module EDS ---
            let isLGT = false;
            if (DATA.structure && Array.isArray(DATA.structure)) {
                isLGT = DATA.structure.some(lvl => {
                    const nom = lvl.level || lvl.name || ""; 
                    return nom.includes("1ère") || nom.includes("Terminale");
                });
            }

            if (isLGT) {
                saveAllData(); 
                alert("✅ Fichier chargé dans l'entité \"Lycée\" ! Une étape de vérification des Spécialités va s'ouvrir.");
                if (typeof showEdsIdentificationModal === 'function') {
                    showEdsIdentificationModal(); 
                } else {
                    location.reload();
                }
                return;
            }
            
            saveAllData();
            alert("✅ Fichier chargé avec succès dans l'entité \"" + (ENTITY_NAMES[targetEntity] || targetEntity) + "\" !");
            location.reload();
            
        } catch (err) {
            console.error("Erreur import:", err);
            alert("❌ Erreur : Le fichier semble corrompu ou illisible.\n(Détails dans la console F12)");
        }
    };
    r.readAsText(f);
    input.value = '';
}


function showEdsIdentificationModal() {
    // 1. Création de l'interface (Overlay + Fenêtre)
    const overlay = document.createElement('div');
    overlay.id = 'eds-check-overlay';
    overlay.style = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 10000;
        display: flex; justify-content: center; align-items: center;
    `;

    const modal = document.createElement('div');
    modal.style = `
        background: white; padding: 25px; border-radius: 12px;
        width: 600px; max-height: 90vh; display: flex; flex-direction: column;
        box-shadow: 0 10px 40px rgba(0,0,0,0.5); font-family: 'Segoe UI', sans-serif;
    `;

    // 2. Contenu HTML de la fenêtre
    modal.innerHTML = `
        <h2 style="margin-top:0; color:#2c3e50;">🧹 Nettoyage de la Grille (LGT)</h2>
        <p style="color:#666; font-size:0.9rem; margin-bottom:20px;">
            Cochez les matières qui sont des <strong>Spécialités (EDS)</strong>.<br>
            <em>Elles seront masquées de la grille horaire principale pour éviter les doublons et alléger l'affichage.</em>
        </p>
        <div style="flex:1; overflow-y:auto; border:1px solid #eee; border-radius:8px; padding:10px; margin-bottom:20px;" id="eds-check-list">
            </div>
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button id="btn-skip-eds" style="padding:10px 20px; background:#bdc3c7; border:none; border-radius:6px; cursor:pointer; font-weight:bold; color:white;">Passer (Tout garder)</button>
            <button id="btn-save-eds" style="padding:10px 20px; background:#27ae60; border:none; border-radius:6px; cursor:pointer; font-weight:bold; color:white;">Valider & Masquer</button>
        </div>
    `;

    // 3. Génération de la liste des matières
    const listContainer = modal.querySelector('#eds-check-list');
    const sortedSubjects = DATA.subjects.slice().sort(); // Tri alphabétique

    let htmlTable = `<table style="width:100%; border-collapse:collapse;">
        <tr style="background:#f8f9fa; text-align:left; color:#7f8c8d;">
            <th style="padding:8px;">Matière</th>
            <th style="padding:8px; text-align:center;">Masquer en 1ère ?</th>
            <th style="padding:8px; text-align:center;">Masquer en Term ?</th>
        </tr>`;

    sortedSubjects.forEach(sub => {
        const meta = DATA.subjectMeta[sub] || {};
        
        // On essaye de deviner si c'est déjà un EDS pour pré-cocher
        const isLikelyEds = meta.isEds || meta.parent === "Spécialités";
        const hasPrem = meta.levels && meta.levels.some(l => l.includes('1ère'));
        const hasTerm = meta.levels && meta.levels.some(l => l.includes('Term'));

        htmlTable += `
            <tr style="border-bottom:1px solid #eee;">
                <td style="padding:8px; font-weight:500;">${sub}</td>
                <td style="padding:8px; text-align:center;">
                    <input type="checkbox" class="chk-prem" data-sub="${sub}" 
                           ${(isLikelyEds && hasPrem) ? 'checked' : ''} 
                           style="transform:scale(1.3); cursor:pointer;">
                </td>
                <td style="padding:8px; text-align:center;">
                    <input type="checkbox" class="chk-term" data-sub="${sub}" 
                           ${(isLikelyEds && hasTerm) ? 'checked' : ''} 
                           style="transform:scale(1.3); cursor:pointer;">
                </td>
            </tr>
        `;
    });
    htmlTable += `</table>`;
    listContainer.innerHTML = htmlTable;

    overlay.appendChild(modal);
    document.body.appendChild(overlay);

    // --- 4. GESTION DES CLICS ---

    // Bouton "Passer"
    document.getElementById('btn-skip-eds').onclick = () => {
        if(confirm("Aucune matière ne sera masquée. Continuer ?")) {
            document.body.removeChild(overlay);
            location.reload();
        }
    };

    // Bouton "Valider" (Logique de Nettoyage Uniquement)
    document.getElementById('btn-save-eds').onclick = () => {
        const rows = listContainer.querySelectorAll('tr');
        
        // On parcourt chaque ligne du tableau (sauf l'en-tête)
        for (let i = 1; i < rows.length; i++) {
            const row = rows[i];
            const chkPrem = row.querySelector('.chk-prem');
            const chkTerm = row.querySelector('.chk-term');
            const subjectName = chkPrem.getAttribute('data-sub');
            
            // Si au moins une case est cochée pour cette matière
            if (chkPrem.checked || chkTerm.checked) {
                if (!DATA.subjectMeta[subjectName]) DATA.subjectMeta[subjectName] = {};
                
                // A. On active le masquage (isEds)
                DATA.subjectMeta[subjectName].isEds = true;
                DATA.subjectMeta[subjectName].mode = 'level';
                DATA.subjectMeta[subjectName].parent = "Spécialités";
                
                // B. On supprime les heures manuelles de la grille (Nettoyage)
                DATA.subjectMeta[subjectName].volLevel = {}; 

                // C. On met à jour les niveaux concernés
                let levels = [];
                if (chkPrem.checked) levels.push("1ère");
                if (chkTerm.checked) levels.push("Terminale");
                DATA.subjectMeta[subjectName].levels = levels;
                
                // NOTE : On n'ajoute PAS la matière dans le tableau EDS du bas (DATA.eds).
                // Elle est juste masquée de la grille principale.
            }
        }

        saveData();
        alert("✅ Grille nettoyée ! Les matières sélectionnées ont été masquées.");
        document.body.removeChild(overlay);
        location.reload(); // Rechargement final pour afficher le résultat
    };
}

// Fonction utilitaire pour créer l'entrée dans le tableau EDS du bas si elle n'existe pas
function ensureEdsExistsInManager(levelCode, subjectName) {
    if (!DATA.eds) DATA.eds = { premiere: [], terminale: [] };
    if (!DATA.eds[levelCode]) DATA.eds[levelCode] = [];

    const exists = DATA.eds[levelCode].some(e => e.name === subjectName);
    if (!exists) {
        const edsDefaultCoef = (currentEntity === 'pole') ? 1.25 : 1.1;
        DATA.eds[levelCode].push({
            name: subjectName,
            students: 0,
            groups: 0,
            hPerGroup: (levelCode === 'premiere' ? 4 : 6), // Forfait par défaut (4h ou 6h)
            coef: edsDefaultCoef
        });
    }
}
function migrateV18toV19(data) {
    if (!data.subjects || !data.structure) return data;
    const allLevels = data.structure.map(l => l.level);
    if (!data.subjectMeta) data.subjectMeta = {};

    data.subjects.forEach(s => {
        if (!data.subjectMeta[s]) data.subjectMeta[s] = {};
        const meta = data.subjectMeta[s];

        if (!meta.mode) {
            if (meta.type === 'div' || !meta.type) meta.mode = 'div';
            else if (meta.type === 'etab') meta.mode = 'etab';
            else if (meta.type === 'level') meta.mode = 'level';
        }

        if (!meta.levels || !Array.isArray(meta.levels)) {
            if (s.includes("Techno") || s.includes("Espagnol") || s.includes("LV2")) {
                meta.levels = allLevels.filter(l => !l.includes("6"));
            } else if (s.includes("Philosophie")) {
                meta.levels = allLevels.filter(l => l.toLowerCase().includes("term"));
            } else {
                meta.levels = [...allLevels]; 
            }
        }

        if (meta.etab === undefined) meta.etab = 0;
        if (!meta.volLevel) meta.volLevel = {};
        if (!meta.code) meta.code = "";
    });

    return data;
}

// --- FONCTION DE SAUVEGARDE SUR DISQUE (Multi-Entités V9) ---
function downloadSaveFile() {
    const dateStr = new Date().toISOString().slice(0, 10);
    const filename = `DHG_Manager_Multi_${dateStr}.data`;
    
    // Sauvegarder l'entité courante
    if (DATA && currentEntity) MULTI_DATA[currentEntity] = DATA;
    
    // On exporte toutes les entités + les noms + les enseignants mutualisés
    const exportData = {
        version: 'multi-v9',
        entities: MULTI_DATA,
        names: ENTITY_NAMES,
        currentEntity: currentEntity,
        sharedTeachers: SHARED_TEACHERS
    };
    
    const blob = new Blob([JSON.stringify(exportData)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function switchRHView(mode) { 
    document.getElementById('rh-view-list').style.display=mode==='list'?'block':'none'; 
    document.getElementById('rh-view-disc').style.display=mode==='disc'?'block':'none'; 
    document.getElementById('btn-view-list').classList.toggle('active',mode==='list'); 
    document.getElementById('btn-view-disc').classList.toggle('active',mode==='disc'); 
    if(mode==='disc') renderRHDisc(); 
}

function toggleRhCodes() { showRhCodes = !showRhCodes; document.getElementById('btn-toggle-codes').classList.toggle('active', showRhCodes); renderRH(); }

// ------------------------------------------------------------------------------------------------
// GESTION RH (CORRECTIF V2.9.2) - Correction alignement hauteur des boutons
// ------------------------------------------------------------------------------------------------
function renderRH() { 
    const tbody = document.getElementById('rh-body'); 
    tbody.innerHTML = ''; 
    const headers = document.querySelectorAll('#rh-table-list th');
    headers.forEach(h => { if(h.classList.contains('col-code-header')) h.style.display = showRhCodes ? 'table-cell' : 'none'; });

    // MUTUALISATION: Trier les SHARED_TEACHERS par ordre alphabétique
    // On filtre par entité courante : un enseignant n'apparaît que s'il a été ajouté à cette entité
    const sorted = SHARED_TEACHERS
        .map((t, idx) => {
            // Injecter la discipline spécifique à l'entité courante
            const subjectForEntity = getTeacherSubjectForEntity(t, currentEntity);
            return {...t, _sharedIdx: idx, subject: subjectForEntity};
        })
        .filter(t => t.entities && t.entities.includes(currentEntity))
        .sort((a, b) => (a.name||'').localeCompare(b.name||'', 'fr', {sensitivity: 'base'}));

    // Collecter les matières de l'entité courante uniquement (cohérence avec Matières & Modalités)
    const subjectList = (DATA.subjects || []).slice().sort((a,b) => a.localeCompare(b, 'fr'));

    sorted.forEach((p) => { 
        const i = p._sharedIdx; // Index réel dans SHARED_TEACHERS

        if (p.csd === undefined) p.csd = 0;
        if (p.decharge === undefined) p.decharge = 0;
        if (p.dech_ext === undefined) p.dech_ext = 0;
        if (p.bmp === undefined) p.bmp = 0;
        if (!p.services) p.services = {college:0, lycee:0, pole:0};

        // Code PNE : chercher dans toutes les entités
        let metaCode = '';
        ['college','lycee','lycee_pro','pole'].forEach(k => { 
            const c = MULTI_DATA[k]?.subjectMeta?.[p.subject]?.code || MULTI_DATA[k]?.subjectMeta?.[p.subject]?.pneCode || '';
            if (c) metaCode = c;
        });
        let codeHtml = showRhCodes ? `<td class="col-code">${metaCode}</td>` : '';
        
        let infoDisplay = '';
        let rowStyle = '';
        if (p.bmp > 0) { infoDisplay += `<div style="font-size:0.7rem; color:#2c3e50; font-weight:bold;">★ BMP: ${p.bmp}h</div>`; rowStyle = `background: linear-gradient(90deg, #fff 0%, #ebf5fb 100%);`; }
        if (p.csd > 0) { infoDisplay += `<div style="font-size:0.7rem; color:#17a2b8; font-weight:bold;">- ${p.csd}h CSD</div>`; if(!rowStyle) rowStyle = `background: linear-gradient(90deg, #fff 0%, #eefbfd 100%);`; }
        if (p.decharge > 0) { infoDisplay += `<div style="font-size:0.7rem; color:#e67e22; font-weight:bold;">- ${p.decharge}h DGH</div>`; if(!rowStyle) rowStyle = `background: linear-gradient(90deg, #fff 0%, #fffcf5 100%);`; }
        if (p.dech_ext > 0) { infoDisplay += `<div style="font-size:0.7rem; color:#27ae60; font-weight:bold;">- ${p.dech_ext}h Rect.</div>`; if(!rowStyle) rowStyle = `background: linear-gradient(90deg, #fff 0%, #eafaf1 100%);`; }

        const btnStyle = "padding:2px 5px; margin:0; font-size:0.7rem;";
        const bmpBtn = `<button class="btn btn-sm" style="background:#34495e; color:white; ${btnStyle}" onclick="setBMP(${i})" title="BMP">BMP</button>`;
        const csdBtn = `<button class="btn btn-sm" style="background:#17a2b8; color:white; ${btnStyle}" onclick="setCSD(${i})" title="CSD">CSD</button>`;
        const dechBtn = `<button class="btn btn-sm" style="background:#9b59b6; color:white; ${btnStyle}" onclick="openDechargeMenu(${i})" title="Décharge">Déch.</button>`;

        // Badges par entité (heures affectées)
        const entColors = {college:'#2980b9', lycee:'#1e8449', lycee_pro:'#d35400', pole:'#8e44ad'};
        const entIcons = {college:'🏫', lycee:'🏛️', lycee_pro:'🏭', pole:'🎓'};
        let entityBadges = '';
        ['college','lycee','lycee_pro','pole'].forEach(k => {
            const h = parseFloat(p.services?.[k]) || 0;
            if (h > 0) entityBadges += `<span style="background:${entColors[k]}22;color:${entColors[k]};border:1px solid ${entColors[k]}44;border-radius:10px;padding:1px 5px;font-size:0.7rem;font-weight:700;white-space:nowrap;">${entIcons[k]} ${h}h</span> `;
        });
        // Calcul pondération pour cet enseignant sur l'entité courante (avec plafonnement)
        const _bd = calcTeacherHoursBreakdown(i, currentEntity);
        const totalEntityH = _bd.weighted;
        const solde = (parseFloat(p.ors)||0) - totalEntityH;
        const soldeColor = Math.abs(solde) < 0.1 ? '#27ae60' : (solde > 0 ? '#e67e22' : '#c0392b');

        const _capBadge = _bd.pondCapped
            ? `<span title="Pondération plafonnée à 1h (réglementaire)" style="font-size:0.8rem;color:#e67e22;font-weight:900;text-decoration:underline;text-underline-offset:2px;margin-left:2px;">⚠️1h</span>`
            : (_bd.pondExceedsORS
                ? `<span title="Pondération BTS/pôle: prof dépasse l'ORS" style="font-size:0.8rem;color:#8e44ad;font-weight:900;margin-left:2px;">⚠️ORS</span>`
                : '');
        const pondDisplay = _bd.pond > 0.01
            ? `<div style="font-size:0.68rem; color:#8e44ad; font-weight:700; margin-top:2px;" title="Devant élèves + pondération = total">${_bd.raw.toFixed(1)}h<span style="color:#bbb;">+</span>${_bd.pond.toFixed(1)}h<span style="color:#bbb;">=</span>${_bd.weighted.toFixed(1)}h${_capBadge}</div>`
            : '';

        const subjectOptions = subjectList.map(s => `<option ${s === p.subject ? 'selected' : ''}>${s}</option>`).join('');

        tbody.innerHTML += `<tr style="${rowStyle}">
            <td style="vertical-align:middle;"><input type="text" value="${p.name||''}" onchange="updT(${i},'name',this.value)"></td>
            ${codeHtml}
            <td style="vertical-align:middle;"><select onchange="updT(${i},'subject',this.value)">${subjectOptions}</select></td>
            <td style="vertical-align:middle; min-width:180px;">
                <div style="display:flex; flex-wrap:wrap; gap:2px; margin-bottom:3px;">${entityBadges || '<em style="color:#aaa;font-size:0.7rem;">Non affecté</em>'}</div>
                ${pondDisplay}
                <div style="font-size:0.7rem; color:${soldeColor}; font-weight:700;">Solde: ${solde>=0?'+':''}${solde.toFixed(1)}h</div>
            </td>
            <td style="vertical-align:middle; width:200px;">
                <div style="display:flex; justify-content:center; align-items:center; gap:3px; flex-wrap:wrap;">
                    <button class="btn btn-success btn-sm" style="background:#16a085; color:white; ${btnStyle}" onclick="editTeacherServices(${i})" title="Affecter heures par entité">⚡</button>
                    ${bmpBtn} ${dechBtn} ${csdBtn}
                    <button class="btn btn-danger btn-sm" style="${btnStyle}" onclick="removeTeacherFromEntity(${i})" title="Retirer de cette entité" style="${btnStyle}; background:#e67e22; color:white;">↩ Retirer</button>
                </div>
            </td>
        </tr>`; 
    });
    
    if (sorted.length === 0) {
        const hasGlobal = SHARED_TEACHERS.length > 0;
        tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:20px;color:#aaa;font-style:italic;">' + 
            (hasGlobal 
                ? 'Aucun enseignant assigné à cette entité — Cliquez sur <b>📋 Assigner</b> pour en ajouter depuis la liste globale'
                : 'Aucun enseignant dans la liste globale — Créez des enseignants dans l\'onglet <b>Enseignants</b>'
            ) + '</td></tr>';
    }
    
    if (document.getElementById('pilotage').classList.contains('active')) renderRHDisc(); 
}

function setCSD(idx) {
    const teacher = SHARED_TEACHERS[idx] || DATA.teachers[idx];
    const current = teacher.csd || 0;
    
    const val = prompt(`Gérer le CSD (Complément de Service Donné) pour ${teacher.name}.\n\nCe professeur fera une partie de son service ailleurs.\nCombien d'heures fait-il À L'EXTÉRIEUR ?`, current);
    
    if (val !== null) {
        const hours = parseFloat(val);
        if (isNaN(hours) || hours < 0) return alert("Valeur invalide");
        if (hours >= teacher.ors) return alert("Le CSD ne peut pas être supérieur ou égal à l'ORS total !");
        
        teacher.csd = hours;
        saveData();
        renderRH();
        // On rafraîchit les tableaux de bord car l'apport change
        if (document.getElementById('rh-view-disc').style.display !== 'none') renderRHDisc();
        calculateRecap();
    }
}

function setDecharge(idx) {
    const teacher = SHARED_TEACHERS[idx] || DATA.teachers[idx];
    const current = teacher.decharge || 0;
    
    const val = prompt(`Gérer les Décharges / Heures de Labo pour ${teacher.name}.\n\nCes heures sont PAYÉES mais ne sont PAS des heures de cours (face élèves).\nEx: Heure de Vaisselle, Cabinet, Syndical...\n\nVolume à déduire du temps de cours :`, current);
    
    if (val !== null) {
        const hours = parseFloat(val);
        if (isNaN(hours) || hours < 0) return alert("Valeur invalide");
        if (hours >= teacher.ors) return alert("La décharge ne peut pas dépasser l'ORS !");
        
        teacher.decharge = hours;
        saveData();
        renderRH();
        if (document.getElementById('rh-view-disc').style.display !== 'none') renderRHDisc();
        calculateRecap();
    }
}

// ------------------------------------------------------------------------------------------------
// VENTILATION VISUELLE (V2.5) - Pop-up avec cases multiples
// ------------------------------------------------------------------------------------------------

let currentSplitIdx = -1; // Pour mémoriser quel prof on modifie

function splitTeacher(idx) {
    const teacher = DATA.teachers[idx];
    
    // 1. Trouver les sous-matières
    const children = DATA.subjects.filter(s => DATA.subjectMeta[s].parent === teacher.subject);
    
    if (children.length === 0) return alert("⚠️ Cette matière n'a aucune sous-matière rattachée (ex: UNSS, Section...) dans l'onglet 'Matières'.");

    currentSplitIdx = idx;
    
    // 2. Remplir les infos du Pop-up
    document.getElementById('split-info').innerHTML = `
        Professeur : ${teacher.name}<br>
        Discipline : ${teacher.subject}<br>
        <span style="display:block; margin-top:5px; border-top:1px solid #a2d9ce; padding-top:5px;">
        Disponible sur cette ligne : <strong>${teacher.ors} h</strong>
        </span>
    `;

    const container = document.getElementById('split-container');
    container.innerHTML = '';

    // 3. Générer une ligne pour chaque matière fille
    children.forEach(child => {
        container.innerHTML += `
            <div class="split-row">
                <label>${child}</label>
                <input type="number" id="split-val-${child}" placeholder="0" min="0" max="${teacher.ors}" step="0.5">
            </div>
        `;
    });

    // 4. Afficher le Pop-up
    document.getElementById('split-overlay').style.display = 'flex';
    
    // Focus sur la première case
    setTimeout(() => {
        const firstInput = container.querySelector('input');
        if(firstInput) firstInput.focus();
    }, 100);
}

function confirmVentilation() {
    if (currentSplitIdx === -1) return;
    
    const teacher = DATA.teachers[currentSplitIdx];
    const children = DATA.subjects.filter(s => DATA.subjectMeta[s].parent === teacher.subject);
    let totalVentile = 0;
    let newLines = [];

    // 1. On récupère les valeurs saisies
    for (let child of children) {
        const input = document.getElementById(`split-val-${child}`);
        const val = parseFloat(input.value);
        
        if (!isNaN(val) && val > 0) {
            totalVentile += val;
            newLines.push({ subject: child, hours: val });
        }
    }

    // 2. Vérifications
    if (totalVentile === 0) {
        return closeSplitModal(); // Rien à faire
    }
    if (totalVentile > teacher.ors) {
        alert(`⛔ Erreur : Vous essayez de ventiler ${totalVentile}h alors que le professeur n'a que ${teacher.ors}h sur cette ligne !`);
        return;
    }

    // 3. Application des changements
    // A. On réduit la ligne mère
    teacher.ors -= totalVentile;

    // B. On insère les nouvelles lignes juste en dessous
    // On inverse la boucle pour les insérer dans le bon ordre visuel
    for (let i = newLines.length - 1; i >= 0; i--) {
        const line = newLines[i];
        DATA.teachers.splice(currentSplitIdx + 1, 0, {
            name: teacher.name,
            subject: line.subject,
            status: teacher.status,
            ors: line.hours,
            hsa: 0 // Pas d'HSA sur les ventilations
        });
    }

    // 4. Sauvegarde et Fermeture
    saveData();
    renderRH();
    closeSplitModal();
    
    // Petit feedback sympa
    // alert(`✅ Ventilation effectuée avec succès !`); 
}

function closeSplitModal() {
    document.getElementById('split-overlay').style.display = 'none';
    currentSplitIdx = -1;
}

function updT(i,f,v){ 
    // MUTUALISATION: mise à jour dans SHARED_TEACHERS
    if (SHARED_TEACHERS[i]) {
        SHARED_TEACHERS[i][f] = (f=='ors'||f=='hsa') ? parseFloat(v)||0 : v;
        // Si on change la discipline depuis la liste prof d'une entité,
        // mettre à jour subjects[currentEntity] pour garder la discipline par entité
        if (f === 'subject') {
            if (!SHARED_TEACHERS[i].subjects) SHARED_TEACHERS[i].subjects = {};
            SHARED_TEACHERS[i].subjects[currentEntity] = v;
        }
    }
    saveAllData(); 
    if(document.getElementById('pilotage').classList.contains('active')) {
        renderRHDisc(); 
    } else {
        renderRH();
    }
}
function addTeacherToSubject(s) { 
    // MUTUALISATION: créer dans SHARED_TEACHERS avec heures pour l'entité courante
    const newT = {
        id: 'T_' + Date.now() + '_' + Math.random().toString(36).slice(2,6),
        name: "Nouveau",
        subject: s,
        status: "Certifié",
        ors: 18,
        hsa: 0,
        csd: 0,
        decharge: 0,
        dech_ext: 0,
        bmp: 0,
        services: {college:0, lycee:0, lycee_pro:0, pole:0},
        entities: []
    };
    SHARED_TEACHERS.push(newT);
    renderRH(); 
    saveAllData();
    if(document.getElementById('pilotage').classList.contains('active')) renderRHDisc(); 
}
function delT(i){ SHARED_TEACHERS.splice(i,1); renderRH(); saveAllData(); }
function clearTeachers(){ if(confirm("Supprimer TOUS les enseignants ?\n(Cette action affecte toutes les entités)")) { SHARED_TEACHERS=[]; if(DATA.teachers) DATA.teachers=[]; renderRH(); saveAllData(); } }
function promptAddTeacher() {
    // Ouvrir le modal de sélection de matière pour ajouter un enseignant mutualisé
    openAddSubjectModal(true); // true = mode "ajouter enseignant"
}

/** Surcharge : si mode='teacher', ajouter un enseignant après sélection de matière */
function openAddSubjectModalForTeacher() {
    // Collecter toutes les matières de toutes les entités
    const allSubs = new Set();
    ['college','lycee','lycee_pro','pole'].forEach(k => { MULTI_DATA[k]?.subjects?.forEach(s => allSubs.add(s)); });
    
    let overlay = document.getElementById('add-teacher-subject-modal');
    if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'add-teacher-subject-modal';
        overlay.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:30000; justify-content:center; align-items:center;';
        document.body.appendChild(overlay);
    }
    
    const subjectList = [...allSubs].sort();
    const datalistOpts = subjectList.map(s => `<option value="${s}">`).join('');
    
    // Ajouter aussi les disciplines PNE
    let pneOpts = '';
    Object.entries(PNE_BUREAUX).forEach(([bid, b]) => {
        Object.entries(b.disciplines).forEach(([code, label]) => {
            pneOpts += `<option value="${label}">`;
        });
    });
    
    overlay.innerHTML = `
        <div style="background:white; border-radius:12px; padding:30px; width:460px; max-width:95vw; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0; color:#2c3e50;">👥 Ajouter un Enseignant</h3>
                <button onclick="document.getElementById('add-teacher-subject-modal').style.display='none'" style="background:none;border:none;font-size:1.4rem;cursor:pointer;color:#999;">×</button>
            </div>
            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Prénom / Nom :</label>
                <input id="new-teacher-name" placeholder="Ex: DUPONT" style="width:100%; padding:10px; border:2px solid #27ae60; border-radius:6px; font-size:1rem; box-sizing:border-box;">
            </div>
            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Discipline :</label>
                <input id="new-teacher-subject" list="teacher-subject-list" placeholder="Tapez pour chercher..." style="width:100%; padding:10px; border:2px solid #3498db; border-radius:6px; font-size:1rem; box-sizing:border-box;">
                <datalist id="teacher-subject-list">${datalistOpts}${pneOpts}</datalist>
            </div>
            <div style="margin-bottom:15px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">Grade :</label>
                <select id="new-teacher-status" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;">
                    <option value="">– Sélectionner –</option>
                    <option>Agrégé</option><option>Certifié</option><option>PLP</option>
                    <option>CAPEPS</option><option>Agrégé EPS</option><option>PEGC</option>
                    <option>PCS</option><option>CPE</option><option>Contractuel</option>
                    <option>Vacataire</option><option>PRAG</option><option>BMP/CSR</option><option>Autre</option>
                </select>
            </div>
            <div style="margin-bottom:20px;">
                <label style="font-weight:600; display:block; margin-bottom:5px;">ORS (heures totales) :</label>
                <input id="new-teacher-ors" type="number" value="18" step="0.5" min="0" style="width:100px; padding:8px; border:1px solid #ddd; border-radius:6px; text-align:center;">
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button onclick="document.getElementById('add-teacher-subject-modal').style.display='none'" style="padding:8px 20px; border:1px solid #ddd; border-radius:6px; background:#f5f5f5; cursor:pointer;">Annuler</button>
                <button onclick="confirmAddTeacherFromModal()" style="padding:8px 20px; border:none; border-radius:6px; background:#27ae60; color:white; font-weight:600; cursor:pointer;">✓ Ajouter</button>
            </div>
        </div>`;
    
    overlay.style.display = 'flex';
    setTimeout(() => { const n = document.getElementById('new-teacher-name'); if(n) n.focus(); }, 100);
}

function confirmAddTeacherFromModal() {
    const name = (document.getElementById('new-teacher-name').value || '').trim();
    const subject = (document.getElementById('new-teacher-subject').value || '').trim();
    const status = document.getElementById('new-teacher-status').value;
    const ors = parseFloat(document.getElementById('new-teacher-ors').value) || 18;
    
    if (!name) { alert('Veuillez saisir un nom.'); return; }
    if (!subject) { alert('Veuillez saisir une discipline.'); return; }
    
    // Vérifier si la matière existe, sinon la créer
    if (DATA && !DATA.subjects.includes(subject)) {
        if (confirm("La matière '" + subject + "' n'existe pas dans l'entité courante.\nVoulez-vous la créer ?")) {
            DATA.subjects.push(subject);
            DATA.subjectMeta[subject] = { mode:'div', levels:getDefaultActiveLevels(subject), etab:0, volLevel:{}, parent:'', code:'' };
            DATA.structure.forEach(l => { if(!DATA.levelConfig[l.level]) DATA.levelConfig[l.level]={}; DATA.levelConfig[l.level][subject]={base:0,demi:0,marge:0,coef:1.0}; });
            saveData();
        }
    }
    
    const newT = {
        id: 'T_' + Date.now() + '_' + Math.random().toString(36).slice(2,6),
        name, subject, grade: status, status, ors, hsa:0, csd:0, decharge:0, dech_ext:0, bmp:0,
        services: {college:0, lycee:0, lycee_pro:0, pole:0},
        entities: []
    };
    SHARED_TEACHERS.push(newT);
    
    saveAllData();
    renderRH();
    document.getElementById('add-teacher-subject-modal').style.display = 'none';
}

function importRH(input) {
    const f = input.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = e => {
        try {
            const wb = XLSX.read(new Uint8Array(e.target.result), { type: 'array', codepage: 1252 });
            const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
            let cnt = 0;
            rows.forEach(r => {
                const get = k => r[Object.keys(r).find(x => x.trim().toLowerCase() === k.toLowerCase())];
                const n = get('Nom') || get('NOM');
                const d = get('Discipline') || get('DISCIPLINE');
                if (n && d) {
                    let codeRaw = "";
                    let codeMatch = d.match(/^([A-Z0-9]+)\s+/);
                    if (codeMatch) codeRaw = codeMatch[1];
                    let cl = d.replace(/^([A-Z0-9]+)\s+/, '').replace(/^[L]\d+\s+/, '').trim().toUpperCase();
                    let fin = cl;
                    
                    // Votre logique de mapping originale (V2.old) qui fonctionne bien pour vous
                    for (const [k, v] of Object.entries(SUBJECT_MAPPING))
                        if (cl.includes(k)) { fin = v; break; }

                    if (!DATA.subjects.includes(fin)) {
                        DATA.subjects.push(fin);
                        DATA.subjectMeta[fin] = { mode: 'div', levels: getDefaultActiveLevels(fin), etab: 0, volLevel: {}, parent: "", code: codeRaw };
                        DATA.structure.forEach(l => DATA.levelConfig[l.level][fin] = { base: 0, demi: 0, marge: 0, coef: 1.0 });
                    }

                    // --- MODIFICATION ICI ---
                    // On ajoute csd:0 et decharge:0 pour la compatibilité V2
                    DATA.teachers.push({ 
                        name: `${n} ${get('Prénom') || ''}`.trim(), 
                        subject: fin, 
                        status: "Certifié", 
                        ors: 18, 
                        hsa: 0,
                        csd: 0,       // Ajouté
                        decharge: 0   // Ajouté
                    });
                    cnt++;
                }
            });
            alert(`${cnt} importés`); renderRH(); saveData();
        } catch (err) {
            console.error(err); // J'ai ajouté ceci pour voir l'erreur précise dans la console (F12) au cas où
            alert("Erreur lors de l'import");
        }
        input.value = '';
    };
    r.readAsArrayBuffer(f);
}


function calculateRecap() { 
    // Mise à jour du titre de l'entité active
    updateEntityTitle();
    // Mise à jour des badges dans la sidebar
    updateEntityBadges();
    
    // Sécurité : On vérifie que les besoins sont calculés
    const needs = (typeof calculateNeeds === 'function') ? calculateNeeds() : {};
    const t = document.getElementById('recap-body'); 
    if (!t) return; 
    t.innerHTML = ''; 
    
    // --- 1. CALCUL PASSERELLE EDS (Volume Dynamique) ---
    let totalHeuresEDS = 0;
    if (DATA.type !== 'college' && DATA.eds) {
        ['premiere', 'terminale'].forEach(lvl => {
            if (DATA.eds[lvl]) {
                DATA.eds[lvl].forEach(e => {
                    // Utilise le volume saisi par ligne ou le défaut officiel (4h/6h), pondéré
                    const vol = parseFloat(e.hPerGroup) || (lvl === 'premiere' ? 4 : 6);
                    const coef = parseFloat(e.coef) || 1.0;
                    totalHeuresEDS += (parseFloat(e.groups) || 0) * vol * coef;
                });
            }
        });
    }

    // 2. Initialisation des compteurs et commentaires
    let res = {}; 
    let autoComments = {}; 

    DATA.subjects.forEach(s => {
        res[s] = { teaching:0, cost:0, hsa:0, dechInt:0 };
        autoComments[s] = []; 
    }); 
    
    // 3. Calculs issus des professeurs (Apports)
    // Boucle sur DATA.teachers (données anciennes non migrées)
    getEntityTeachers().forEach(p => {
        if (!p.subject) return;
        if (!res[p.subject]) res[p.subject] = { teaching:0, cost:0, hsa:0, dechInt:0 };
        if (!autoComments[p.subject]) autoComments[p.subject] = [];
        const csd = parseFloat(p.csd || 0);
        const dechInt = parseFloat(p.decharge || 0);
        const dechExt = parseFloat(p.dech_ext || 0);
        const ors = parseFloat(p.ors || 0);
        const hsa = parseFloat(p.hsa || 0);
        const bmp = parseFloat(p.bmp || 0);
        const financialCost = (ors - csd - dechExt) + hsa;
        res[p.subject].cost += financialCost;
        res[p.subject].hsa += hsa;
        res[p.subject].dechInt += dechInt;
        if (bmp > 0) autoComments[p.subject].push(`BMP ${bmp}h`);
        if (csd > 0) autoComments[p.subject].push(`CSD ${p.name} ${csd}h`);
    });
    
    // MUTUALISATION: Boucle sur SHARED_TEACHERS pour l'entité courante
    SHARED_TEACHERS.forEach(p => {
        if (!p.subject) return;
        const entityHours = parseFloat(p.services?.[currentEntity]) || 0;
        if (entityHours === 0) return;
        if (!res[p.subject]) res[p.subject] = { teaching:0, cost:0, hsa:0, dechInt:0 };
        if (!autoComments[p.subject]) autoComments[p.subject] = [];
        const csd = parseFloat(p.csd || 0);
        const dechInt = parseFloat(p.decharge || 0);
        const dechExt = parseFloat(p.dech_ext || 0);
        const hsa = parseFloat(p.hsa || 0);
        const bmp = parseFloat(p.bmp || 0);
        // Utiliser les heures entité, pas l'ORS total
        const financialCost = (entityHours - Math.min(csd, entityHours) - Math.min(dechExt, entityHours)) + hsa;
        res[p.subject].cost += financialCost;
        res[p.subject].hsa += hsa;
        res[p.subject].dechInt += dechInt;
        if (bmp > 0) autoComments[p.subject].push(`BMP ${bmp}h`);
        if (csd > 0) autoComments[p.subject].push(`CSD ${p.name} ${csd}h`);
    });

    // APPORT EDS : heures des enseignants assignés directement dans Spécialités & EDS
    if (DATA.eds) {
        ['premiere', 'terminale'].forEach(lvl => {
            (DATA.eds[lvl] || []).forEach(eds => {
                if (!eds.teachers) return;
                const hPG = (parseFloat(eds.hPerGroup) || (lvl === 'premiere' ? 4 : 6)) * (parseFloat(eds.coef) || 1.0);
                eds.teachers.forEach(tid => {
                    if (!tid) return;
                    const teacher = SHARED_TEACHERS.find(t => t.id === tid);
                    if (!teacher) return;
                    const subj = eds.name; // la matière EDS = nom de la spécialité
                    if (!res[subj]) res[subj] = { teaching:0, cost:0, hsa:0, dechInt:0 };
                    res[subj].cost += hPG;
                    if (!autoComments[subj]) autoComments[subj] = [];
                    autoComments[subj].push(`${teacher.name} (${lvl === 'premiere' ? '1ère' : 'Tle'} Gr.)`);
                });
            });
        });
    }
    
    // --- globalNeed depuis needs[] qui inclut déjà les EDS ---
    let globalNeed = 0, totalApport = 0, totalHSA = 0;

    // 4. Fonction de rendu des lignes
    const renderRow = (s, label, isPole, isChild) => {
        const stats = res[s] || { cost:0, hsa:0, dechInt:0 };
        const meta = DATA.subjectMeta[s];
        const isEds = !!(meta && meta.isEds);
        const structNeed = needs[s] || 0;
        const totalNeed = structNeed + stats.dechInt; 
        const apport = stats.cost;
        const ecart = apport - totalNeed;
        const hpOnly = apport - stats.hsa;

        if (!isPole && totalNeed === 0 && apport === 0 && !isEds) return null;
        const isCounted = (meta && meta.isCounted !== false);
        const safeS = s.replace(/'/g, "\\'");
        
        if (!DATA.recapComments) DATA.recapComments = {};
        const comm = DATA.recapComments[s] || ""; 
        
        let rowClass = "";
        let bgStyle = "";
        let nameStyle = "text-align:left; font-weight:bold;";
        
        if (isPole) rowClass = "row-header"; 
        else if (!isChild && !isPole) rowClass = "row-header"; 
        else if (isChild) { bgStyle = "background:#f9f9f9;"; nameStyle += " padding-left:20px;"; }
        else if (!isCounted) bgStyle = "background:#f4f6f6; color:#95a5a6; font-style:italic;";

        const badge = (!isPole && !isCounted && rowClass !== "row-header") ? '<span style="font-size:0.7rem; background:#95a5a6; color:white; padding:1px 4px; border-radius:3px; margin-left:5px;">HORS DHG</span>' : '';
        const isHeader = (rowClass === "row-header");

        const autoTags = autoComments[s] || [];
        let autoHTML = "";
        const alertColor = isHeader ? '#ffca28' : '#d35400'; 

        if (autoTags.length > 0 && !isPole) {
            autoHTML = `<div style="margin-bottom:4px; font-size:0.75rem; color:${alertColor}; font-weight:bold;">${autoTags.join(' / ')}</div>`;
        }

        return {
            html: `<tr class="${rowClass}" style="${bgStyle}">
                <td style="${nameStyle}; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${label} ${badge}</td>
                <td style="font-weight:bold; ${isHeader?'color:#f1c40f;':'color:#c0392b;'}">${totalNeed.toFixed(1)}</td>
                <td style="font-weight:bold; ${isHeader?'color:#81d4fa;':'color:#16a085;'}">${apport.toFixed(1)}</td>
                <td style="font-weight:bold; color:${ecart>=0?(isHeader?'#2ecc71':'green'):(isHeader?'#e74c3c':'red')};">${ecart.toFixed(1)}</td>
                <td style="padding:4px; vertical-align:middle;">
                    ${!isPole ? `${autoHTML}<input class="input-comment" value="${comm}" onchange="updComment('${safeS}',this.value)" style="width:100%; box-sizing:border-box; border:1px solid ${isHeader?'#78909c':'#ccc'}; padding:4px; color:black;" placeholder="Autre commentaire...">` : ''}
                </td>
            </tr>`,
            data: { need: totalNeed, apport: apport, hsa: stats.hsa, counted: isCounted }
        };
    };

    // 6. Boucle d'affichage des pôles et matières (hors EDS)
    const roots = DATA.subjects.filter(s => DATA.subjectMeta[s] && !DATA.subjectMeta[s].parent && !DATA.subjectMeta[s].isEds).sort();

    roots.forEach(r => {
        const kids = DATA.subjects.filter(s => DATA.subjectMeta[s] && DATA.subjectMeta[s].parent === r && !DATA.subjectMeta[s].isEds);
        if (kids.length > 0) {
            let poleNeed = 0, poleApport = 0, poleHSA = 0;
            let rowsToRender = [];
            const rRow = renderRow(r, `↳ ${r}`, false, true);
            if (rRow) {
                if(rRow.data.counted) { poleNeed += rRow.data.need; poleApport += rRow.data.apport; poleHSA += rRow.data.hsa; }
                rowsToRender.push(rRow.html);
            }
            kids.forEach(k => {
                const kRow = renderRow(k, `↳ ${k}`, false, true);
                if (kRow) {
                    if(kRow.data.counted) { poleNeed += kRow.data.need; poleApport += kRow.data.apport; poleHSA += kRow.data.hsa; }
                    rowsToRender.push(kRow.html);
                }
            });
            const poleEcart = poleApport - poleNeed;
            const poleHPOnly = poleApport - poleHSA;
            if (rowsToRender.length > 0) {
                t.innerHTML += `<tr class="row-header">
                    <td style="text-align:left; font-weight:bold;">📦 PÔLE ${r.toUpperCase()}</td>
                    <td style="font-weight:bold; color:#f1c40f;">${poleNeed.toFixed(1)}</td>
                    <td style="font-weight:bold; color:#81d4fa;">${poleApport.toFixed(1)}</td>
                    <td style="font-weight:bold; background:${poleEcart>=0?'#27ae60':'#c0392b'}; color:white;">${poleEcart.toFixed(1)}</td>
                    <td></td>
                </tr>`;
                rowsToRender.forEach(html => t.innerHTML += html);
            }
            globalNeed += poleNeed; totalApport += poleApport; totalHSA += poleHSA;
        } else {
            const row = renderRow(r, r, false, false);
            if (row) {
                t.innerHTML += row.html;
                if(row.data.counted) { globalNeed += row.data.need; totalApport += row.data.apport; totalHSA += row.data.hsa; }
            }
        }
    });

    // 6b. SECTION EDS – affichage groupé de toutes les matières EDS
    const edsSubjects = DATA.subjects.filter(s => DATA.subjectMeta[s] && DATA.subjectMeta[s].isEds).sort();
    if (edsSubjects.length > 0) {
        let edsNeed = 0, edsApport = 0, edsHSA = 0;
        let edsRows = [];
        edsSubjects.forEach(s => {
            const row = renderRow(s, `↳ ${s}`, false, true);
            if (row) {
                edsNeed   += row.data.need;
                edsApport += row.data.apport;
                edsHSA    += row.data.hsa;
                edsRows.push(row.html);
            }
        });
        if (edsRows.length > 0) {
            const edsEcart  = edsApport - edsNeed;
            const edsHPOnly = edsApport - edsHSA;
            t.innerHTML += `<tr class="row-header" style="background:#2c3e50; color:white;">
                <td style="text-align:left; font-weight:bold;">🎓 SPÉCIALITÉS (EDS)</td>
                <td style="font-weight:bold; color:#f1c40f;">${edsNeed.toFixed(1)}</td>
                <td style="font-weight:bold; color:#81d4fa;">${edsApport.toFixed(1)}</td>
                <td>${edsHPOnly.toFixed(1)}</td>
                <td>${edsHSA.toFixed(1)}</td>
                <td style="font-weight:bold; background:${edsEcart>=0?'#27ae60':'#c0392b'}; color:white;">${edsEcart.toFixed(1)}</td>
                <td></td>
            </tr>`;
            edsRows.forEach(html => t.innerHTML += html);
            globalNeed  += edsNeed;
            totalApport += edsApport;
            totalHSA    += edsHSA;
        }
    }
    
    // 7. Mise à jour des Totaux (Pied de tableau)
    const totalEl = document.getElementById('recap-total');
    if(totalEl) {
        totalEl.innerHTML = `
            <td style="text-align:right;">TOTAL GÉNÉRAL</td>
            <td style="color:#c0392b; font-size:1.1rem;">${globalNeed.toFixed(1)}</td>
            <td style="color:#16a085; font-size:1.1rem;">${totalApport.toFixed(1)}</td>
            <td>${(totalApport - totalHSA).toFixed(1)}</td>
            <td>${totalHSA.toFixed(1)}</td>
            <td style="color:${(totalApport - globalNeed)>=0?'green':'red'}; font-size:1.1rem;">${(totalApport - globalNeed).toFixed(1)}</td>
            <td></td>`; 
    }
    
    // 8. Mise à jour des KPI du Dashboard d'accueil
    if(DATA.config && document.getElementById('dash-total-dhg')) {
        const g = DATA.config.total || 0; 
        document.getElementById('dash-total-dhg').innerText = g; 
        document.getElementById('dash-conso').innerText = totalApport.toFixed(1); 
        document.getElementById('dash-hsa').innerText = totalHSA.toFixed(1); 
        document.getElementById('dash-solde').innerText = (g - totalApport).toFixed(1);
        
        const hpUsed = Math.max(0, totalApport - totalHSA);
        document.getElementById('dash-hp-used').innerText = hpUsed.toFixed(1);

        const hsaInput = document.getElementById('global-hsa');
        const globalHsaInput = hsaInput ? (parseFloat(hsaInput.value) || 0) : 0;
        const globalDotation = parseFloat(document.getElementById('dash-total-dhg').innerText) || 0;
        let ratio = 0; if(globalDotation > 0) { ratio = (globalHsaInput / globalDotation) * 100; }
        document.getElementById('global-hsa-percent-display').innerText = ratio.toFixed(1) + "%";
    }
}
function renderFinalKPIs(need, apport, hsa) {
    const totalEl = document.getElementById('recap-total');
    if(totalEl) {
        totalEl.innerHTML = `
            <td style="text-align:right;">TOTAL GÉNÉRAL</td>
            <td style="color:#c0392b;">${need.toFixed(1)}</td>
            <td style="color:#16a085;">${apport.toFixed(1)}</td>
            <td>${(apport - hsa).toFixed(1)}</td><td>${hsa.toFixed(1)}</td>
            <td style="color:${(apport - need)>=0?'green':'red'};">${(apport - need).toFixed(1)}</td><td></td>`; 
    }
    // Mise à jour Dashboard
    document.getElementById('dash-conso').innerText = apport.toFixed(1);
    document.getElementById('dash-solde').innerText = (DATA.config.total - apport).toFixed(1);
}

function updComment(s,v){ if(!DATA.recapComments)DATA.recapComments={}; DATA.recapComments[s]=v; saveData(); }

// Variable globale pour savoir quelle page on est en train d'exporter
let pendingExportSection = "";
let pendingExportTitle = "";
function exportCurrentPage(type) {
    // 1. Identification de la section active
    const activeSection = document.querySelector('.section.active').id;
    
    // ========================================================================
    // CAS SPÉCIFIQUE : ONGLET RÉPARTITION
    // ========================================================================
    if (activeSection === 'repartition') {
        
        // A. Sous-vue "Par Enseignant" (Cartes visuelles)
        if (typeof currentRepartitionView !== 'undefined' && currentRepartitionView === 'profs') {
            if (type === 'excel') {
                alert("⛔ Export Excel impossible sur la vue 'Cartes Enseignants'.\n\nCette vue est graphique. Utilisez l'export PDF pour imprimer les fiches, ou passez en vue 'Par Matière' pour un export Excel.");
                return;
            }
            if (type === 'pdf') {
                // Lance la fonction PDF spécifique "Cartes"
                generateRepartitionProfsPDF(); 
                return;
            }
        } 
        
        // B. Sous-vue "Par Matière" (Tableaux)
        else {
            if (type === 'excel') {
                // Lance la fonction Excel spécifique (Multi-onglets par Pôle)
                exportRepartitionMatiereExcel(); 
                return;
            }
            if (type === 'pdf') {
                // Lance la fonction PDF spécifique (Sauts de page par Pôle)
                exportRepartitionMatierePDF(); 
                return;
            }
        }
    }

    // ========================================================================
    // CAS STANDARD : AUTRES ONGLETS
    // ========================================================================
    
    const dateStr = new Date().toLocaleDateString('fr-FR');
    let title = 'Export';
    let tableId = null;

    // Configuration des IDs de tableaux selon la page
    if (activeSection === 'dashboard') title = 'Tableau de Bord';
    else if (activeSection === 'structure') { title = 'Structure'; tableId = 'structure-table'; }
    else if (activeSection === 'ventilation') title = 'Grille Horaire'; 
    else if (activeSection === 'professeurs') { title = 'Liste des Enseignants'; tableId = 'rh-table-list'; }
    else if (activeSection === 'pilotage') { title = 'Ventilation par Matière'; tableId = 'rh-table-disc'; }
    else if (activeSection === 'recap') { title = 'Bilan'; tableId = 'recap-table'; }
    else if (activeSection === 'equipes') title = 'Equipes Pédagogiques';
    else if (activeSection === 'matieres') { title = 'Matières'; tableId = 'subjects-table'; }

    const filename = `DHG - ${title} - ${dateStr}`;

    // --- Export EXCEL Standard ---
    if (type === 'excel') {
        const wb = XLSX.utils.book_new();
        
        // Cas 1 : Tableaux complexes nécessitant un nettoyage (Inputs -> Texte)
        if (activeSection === 'ventilation' || activeSection === 'matieres' || activeSection === 'structure') {
            let grid = null;
            if (activeSection === 'ventilation') grid = document.querySelector('.grid-table');
            else if (activeSection === 'matieres') grid = document.getElementById('subjects-table');
            else if (activeSection === 'structure') grid = document.getElementById('structure-table');
            
            if(grid) {
                const cleanT = cleanTableForExport(grid);
                XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(cleanT), "Données");
            }
        }
        // Cas 2 : Tableaux simples via ID
        else if (tableId) {
            const el = document.getElementById(tableId);
            if(el) {
                const cleanT = cleanTableForExport(el);
                XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(cleanT), "Données");
            }
        }
        // Cas 3 : Pilotage (Tableau spécifique)
        else if (activeSection === 'pilotage') {
             const el = document.getElementById('rh-table-disc');
             if(el) XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(el), "Données");
        }
        // Cas 4 : Rien à exporter
        else {
            alert("Rien à exporter sur cette vue.");
            return;
        }
        
        XLSX.writeFile(wb, `${filename}.xlsx`);
    } 
    
    // --- Export PDF Standard (Via Modale) ---
    else if (type === 'pdf') {
        // On stocke le contexte et on ouvre la modale de choix (A4/A3, Portrait/Paysage)
        pendingExportSection = activeSection;
        pendingExportTitle = title;
        openExportModal();
    }
}

// --- UTILITAIRE : Convertit un index (0, 1, 2) en lettre Excel (A, B, C... AA, AB) ---
function getExcelAlpha(colIndex) {
    let temp, letter = '';
    while (colIndex >= 0) {
        temp = (colIndex) % 26;
        letter = String.fromCharCode(temp + 65) + letter;
        colIndex = (colIndex - temp - 1) / 26;
    }
    return letter;
}

function exportRepartitionMatiereExcel() {
    const wb = XLSX.utils.book_new();
    const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();

    // --- STYLES ---
    const baseStyle = {
        border: {
            top: { style: "thin", color: { auto: 1 } },
            bottom: { style: "thin", color: { auto: 1 } },
            left: { style: "thin", color: { auto: 1 } },
            right: { style: "thin", color: { auto: 1 } }
        },
        font: { name: "Calibri", sz: 11 }
    };

    const headerStyle = {
        ...baseStyle,
        fill: { fgColor: { rgb: "E7E6E6" } }, // Gris clair
        font: { name: "Calibri", sz: 11, bold: true },
        alignment: { horizontal: "center", vertical: "center" }
    };

    const needStyle = {
        ...baseStyle,
        fill: { fgColor: { rgb: "FFF2CC" } }, // Jaune clair
        font: { name: "Calibri", sz: 11, italic: true }
    };
    
    // Fonction nettoyage nom onglet
    const cleanSheetName = (name) => name.replace(/[\\/?*[\]]/g, ' ').substring(0, 31);

    roots.forEach(root => {
        const subjectsInPole = [root, ...DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === root)];
        let wsData = [];
        
        // Titre du Pôle (Ligne 1)
        wsData.push([{ v: `PÔLE : ${root.toUpperCase()}`, s: { font: { bold: true, sz: 14 } } }]);
        wsData.push([]); 

        subjectsInPole.forEach(sub => {
            const meta = DATA.subjectMeta[sub];
            if (!meta) return;
            const isLabo = (meta.code === 'LAB' && meta.parent);
            
            let profs = [];
            if (isLabo) profs = getEntityTeachers().filter(t => t.subject === meta.parent);
            else profs = getEntityTeachers().filter(t => t.subject === sub);
            if (profs.length === 0 && isLabo) return;

            // --- 1. PRÉPARATION DES COLONNES ---
            let colKeys = []; 
            let headerRow = [{ v: "Enseignant", s: headerStyle }];

            if (meta.mode === 'div') {
                DATA.structure.forEach(lvl => {
                    const prefix = getLevelPrefix(lvl.level);
                    for (let i = 0; i < lvl.div; i++) {
                        const cId = `${prefix}${String.fromCharCode(65 + i)}`;
                        const isActive = (meta.levels && meta.levels.includes(lvl.level));
                        const hasHours = getHoursForClassSubject(cId, lvl.level, sub) > 0;
                        
                        if (hasHours || isActive) {
                            headerRow.push({ v: DATA.classNames[cId] || cId, s: headerStyle });
                            
                            // ⬇️ C'EST ICI QUE C'ÉTAIT CORRIGÉ : Ajout de 'lvl: lvl.level'
                            colKeys.push({id: cId, type: 'class', lvl: lvl.level}); 
                        }
                    }
                });
            } else if (meta.mode === 'level') {
                DATA.structure.forEach(lvl => {
                    headerRow.push({ v: lvl.level, s: headerStyle });
                    colKeys.push({id: lvl.level, type: 'level'}); // Ici le niveau est l'ID
                });
            } else if (meta.mode === 'etab') {
                headerRow.push({ v: "Global", s: headerStyle });
                colKeys.push({id: 'ETAB', type: 'etab'});
            }

            if (colKeys.length === 0) return;

            // Colonnes Totaux
            headerRow.push(
                { v: "Total Matière", s: headerStyle },
                { v: "Service Global", s: headerStyle },
                { v: "Service Dû", s: headerStyle },
                { v: "Solde", s: headerStyle }
            );

            // Titre Matière
            wsData.push([{ v: `Matière : ${sub}`, s: { font: { bold: true, color: { rgb: "2F75B5" } } } }]);
            wsData.push(headerRow);
            
            // --- 2. LIGNE BESOIN (Cible) ---
            if (!isLabo) {
                let needRow = [{ v: "BESOIN (Cible)", s: needStyle }];
                
                colKeys.forEach(col => {
                    let besoin = 0;
                    // Maintenant 'col.lvl' existe bien, donc le calcul fonctionne !
                    if(col.type === 'class') besoin = getHoursForClassSubject(col.id, col.lvl, sub);
                    else if(col.type === 'level') besoin = (meta.volLevel && meta.volLevel[col.id]) || 0;
                    else if(col.type === 'etab') besoin = meta.etab || 0;
                    
                    // On force un Nombre (t:'n') pour que les formules Excel marchent
                    needRow.push({ v: besoin > 0 ? besoin : "", t: 'n', s: needStyle });
                });
                
                // Cellules vides de fin de ligne (pour le style)
                needRow.push({v:"", s:needStyle}, {v:"", s:needStyle}, {v:"", s:needStyle}, {v:"", s:needStyle});
                wsData.push(needRow);
            }

            // --- 3. LIGNES PROFS ---
            profs.forEach(p => {
                const currentRowNum = wsData.length + 1; // Index Excel (1-based)
                
                let row = [{ v: p.name, s: baseStyle }];

                colKeys.forEach(col => {
                    let val = 0;
                    if (isLabo) val = p.decharge || 0; 
                    else {
                        const key = `${col.id}_${p.idx}`;
                        const assign = DATA.assignments[key];
                        val = (assign && assign.quota !== undefined) ? assign.quota : 0;
                    }
                    row.push({ v: val > 0 ? val : "", t: 'n', s: baseStyle });
                });

                // FORMULE SOMME
                const startChar = getExcelAlpha(1); // "B"
                const endChar = getExcelAlpha(colKeys.length); 
                const formulaTotal = `SUM(${startChar}${currentRowNum}:${endChar}${currentRowNum})`;
                
                row.push({ t: 'n', f: formulaTotal, s: { ...baseStyle, font: { bold: true } } });

                // Services & Solde
                const serviceGlobal = getGlobalTeacherService(p.idx);
                const serviceDu = p.ors - (p.csd || 0);
                
                row.push({ v: serviceGlobal, t: 'n', s: baseStyle });
                row.push({ v: serviceDu, t: 'n', s: baseStyle });
                
                // Formule Solde
                const colGlobalChar = getExcelAlpha(colKeys.length + 2);
                const colDuChar = getExcelAlpha(colKeys.length + 3);
                const formulaSolde = `${colGlobalChar}${currentRowNum}-${colDuChar}${currentRowNum}`;
                
                row.push({ t: 'n', f: formulaSolde, s: { ...baseStyle, font: { bold: true } } });

                wsData.push(row);
            });

            // --- 4. LIGNE RELIQUAT ---
            if (!isLabo) {
                const currentRowNum = wsData.length + 1;
                const needRowNum = currentRowNum - profs.length - 1; // On remonte chercher la ligne Besoin

                let relRow = [{ v: "RELIQUAT", s: { ...baseStyle, font: { italic: true, color: { rgb: "C00000" } } } }];
                
                colKeys.forEach((col, idx) => {
                    const colChar = getExcelAlpha(idx + 1);
                    const profStartRow = needRowNum + 1;
                    const profEndRow = currentRowNum - 1;
                    
                    // Formule : = Besoin - SOMME(Profs)
                    let formulaRel = "";
                    if (profStartRow > profEndRow) {
                        // Cas sans profs : Reliquat = Besoin
                        formulaRel = `${colChar}${needRowNum}`;
                    } else {
                        formulaRel = `${colChar}${needRowNum}-SUM(${colChar}${profStartRow}:${colChar}${profEndRow})`;
                    }
                    
                    relRow.push({ t: 'n', f: formulaRel, s: baseStyle });
                });
                
                relRow.push({v:"", s:baseStyle}, {v:"", s:baseStyle}, {v:"", s:baseStyle}, {v:"", s:baseStyle});
                wsData.push(relRow);
            }

            wsData.push([]); 
            wsData.push([]); 
        });

        // Création de la feuille
        if (wsData.length > 2) {
            const ws = XLSX.utils.aoa_to_sheet([]);
            XLSX.utils.sheet_add_aoa(ws, wsData, { origin: "A1" });

            // Largeurs colonnes
            let maxColCount = 0;
            wsData.forEach(r => { if(r.length > maxColCount) maxColCount = r.length; });
            let wscols = [];
            for(let i=0; i<maxColCount; i++) wscols.push({wch: 12});
            wscols[0] = {wch: 25};
            ws['!cols'] = wscols;

            XLSX.utils.book_append_sheet(wb, ws, cleanSheetName(root));
        }
    });

    const dateStr = new Date().toLocaleDateString('fr-FR').replace(/\//g, '-');
    XLSX.writeFile(wb, `DHG_Repartition_Matieres_PRO_${dateStr}.xlsx`);
}

function exportRepartitionMatierePDF() {
    const { jsPDF } = window.jspdf;
    // Format Paysage obligatoire vu la largeur des tableaux
    const doc = new jsPDF({ orientation: 'landscape', format: 'a4' });
    
    const margin = 14;
    let cursorY = 20;
    const pageWidth = doc.internal.pageSize.width;

    // Fonction En-tête (répétée sur chaque page si besoin)
    const printHeader = (title) => {
        doc.setFillColor(44, 62, 80);
        doc.rect(0, 0, pageWidth, 15, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(10);
        doc.setFont("helvetica", "bold");
        doc.text(`DHG MANAGER - RÉPARTITION : ${title.toUpperCase()}`, margin, 10);
        doc.text(`Année ${DATA.config.year}`, pageWidth - margin, 10, { align: 'right' });
        cursorY = 25;
    };

    const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();
    let isFirstPage = true;

    roots.forEach(root => {
        const subjectsInPole = [root, ...DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === root)];
        
        // Vérifier s'il y a du contenu à afficher pour ce pôle
        // (Pour éviter de créer une page vide si le pôle est vide)
        let hasContent = subjectsInPole.some(sub => {
             const meta = DATA.subjectMeta[sub];
             // Logique simplifiée : si la matière existe, on suppose qu'il faut l'afficher
             return !!meta; 
        });

        if (!hasContent) return;

        // GESTION DU SAUT DE PAGE ENTRE PÔLES
        if (!isFirstPage) {
            doc.addPage();
            cursorY = 20;
        }
        isFirstPage = false;

        // Impression du Titre du Pôle (Haut de page)
        printHeader(root);

        // Boucle sur les matières du pôle
        subjectsInPole.forEach(sub => {
            const meta = DATA.subjectMeta[sub];
            if (!meta) return;

            const isLabo = (meta.code === 'LAB' && meta.parent);
            let profs = [];
            if (isLabo) profs = getEntityTeachers().filter(t => t.subject === meta.parent);
            else profs = getEntityTeachers().filter(t => t.subject === sub);

            if (profs.length === 0 && isLabo) return;

            // --- Préparation des colonnes pour le PDF ---
            let pdfColumns = [{ header: 'Enseignant', dataKey: 'name' }];
            let colKeys = [];

            if (meta.mode === 'div') {
                DATA.structure.forEach(lvl => {
                    const prefix = getLevelPrefix(lvl.level);
                    for (let i = 0; i < lvl.div; i++) {
                        const cId = `${prefix}${String.fromCharCode(65 + i)}`;
                        const isActive = (meta.levels && meta.levels.includes(lvl.level));
                        const hasHours = getHoursForClassSubject(cId, lvl.level, sub) > 0;
                        if (hasHours || isActive) {
                            pdfColumns.push({ header: DATA.classNames[cId] || cId, dataKey: cId });
                            colKeys.push({id: cId, lvl: lvl.level, type: 'class'});
                        }
                    }
                });
            } else if (meta.mode === 'level') {
                DATA.structure.forEach(lvl => {
                    pdfColumns.push({ header: lvl.level, dataKey: lvl.level });
                    colKeys.push({id: lvl.level, lvl: lvl.level, type: 'level'});
                });
            } else if (meta.mode === 'etab') {
                pdfColumns.push({ header: 'Global', dataKey: 'ETAB' });
                colKeys.push({id: 'ETAB', type: 'etab'});
            }

            if (colKeys.length === 0) return;

            // Colonnes de totaux
            pdfColumns.push(
                { header: 'Tot.', dataKey: 'total' },
                { header: 'Svc.', dataKey: 'global' },
                { header: 'Dû', dataKey: 'due' }
            );

            // --- Préparation des données (Lignes) ---
            let pdfRows = [];
            profs.forEach(p => {
                let row = { name: p.name };
                let rowTotal = 0;

                colKeys.forEach(col => {
                    let val = 0;
                    if (isLabo) val = p.decharge || 0;
                    else {
                        const key = `${col.id}_${p.idx}`;
                        const assign = DATA.assignments[key];
                        val = (assign && assign.quota !== undefined) ? assign.quota : 0;
                    }
                    if (val > 0) rowTotal += parseFloat(val);
                    row[col.id] = val > 0 ? val : "";
                });

                const serviceGlobal = getGlobalTeacherService(p.idx);
                const serviceDu = p.ors - (p.csd || 0);

                row.total = rowTotal.toFixed(1);
                row.global = serviceGlobal.toFixed(1);
                row.due = serviceDu.toFixed(1);
                
                // Info de style pour la ligne
                row._style_global = { textColor: serviceGlobal >= serviceDu ? [39, 174, 96] : [192, 57, 43], fontStyle: 'bold' };
                row._style_due = { textColor: [142, 68, 173] }; // Violet pour le dû
                
                pdfRows.push(row);
            });

            // Ligne Reliquat
            if (!isLabo) {
                let relRow = { name: "RELIQUAT" };
                colKeys.forEach(col => {
                    let assignedInCol = 0;
                    profs.forEach(p => {
                         const q = DATA.assignments[`${col.id}_${p.idx}`]?.quota || 0;
                         assignedInCol += parseFloat(q);
                    });
                    
                    let besoin = 0;
                    if(col.type === 'class') besoin = getHoursForClassSubject(col.id, col.lvl, sub);
                    else if(col.type === 'level') besoin = (meta.volLevel && meta.volLevel[col.id]) || 0;
                    else if(col.type === 'etab') besoin = meta.etab || 0;

                    const diff = besoin - assignedInCol;
                    relRow[col.id] = Math.abs(diff) < 0.01 ? "OK" : diff.toFixed(1);
                    
                    // Style conditionnel cellule
                    relRow[`_style_${col.id}`] = { 
                        textColor: Math.abs(diff) < 0.01 ? [39, 174, 96] : (diff > 0 ? [192, 57, 43] : [230, 126, 34]),
                        fontStyle: 'bold'
                    };
                });
                // Styles vides pour les totaux sur la ligne reliquat
                relRow.total = ""; relRow.global = ""; relRow.due = "";
                pdfRows.push(relRow);
            }

            // --- Génération du Tableau PDF ---
            
            // Titre de la matière
            doc.setFontSize(11);
            doc.setTextColor(52, 152, 219);
            doc.text(`${sub} (${isLabo ? 'Labo' : meta.mode})`, margin, cursorY + 5);
            
            doc.autoTable({
                startY: cursorY + 7,
                columns: pdfColumns,
                body: pdfRows,
                theme: 'grid',
                styles: { fontSize: 8, cellPadding: 1, textColor: 50, halign: 'center' },
                headStyles: { fillColor: [52, 73, 94], textColor: 255, fontStyle: 'bold' },
                columnStyles: { name: { halign: 'left', fontStyle: 'bold', cellWidth: 35 } },
                
                // Application des styles conditionnels
                didParseCell: function(data) {
                    if (data.section === 'body') {
                        const rowRaw = data.row.raw;
                        
                        // Style Colonne Totale Global Prof
                        if (data.column.dataKey === 'global' && rowRaw._style_global) {
                            data.cell.styles.textColor = rowRaw._style_global.textColor;
                            data.cell.styles.fontStyle = rowRaw._style_global.fontStyle;
                        }
                        // Style Colonne Dû
                        if (data.column.dataKey === 'due' && rowRaw._style_due) {
                            data.cell.styles.textColor = rowRaw._style_due.textColor;
                        }
                        // Style Cellules Reliquat
                        const styleMeta = rowRaw[`_style_${data.column.dataKey}`];
                        if (styleMeta) {
                            data.cell.styles.textColor = styleMeta.textColor;
                            data.cell.styles.fontStyle = styleMeta.fontStyle;
                        }
                        // Fond rouge pour la ligne Reliquat
                        if (rowRaw.name === "RELIQUAT" && data.column.dataKey === 'name') {
                             data.cell.styles.fontStyle = 'italic';
                             data.cell.styles.textColor = [192, 57, 43];
                        }
                    }
                },
                margin: { left: margin, right: margin }
            });

            cursorY = doc.lastAutoTable.finalY + 10;
            
            // Si on arrive en bas de page, on saute
            if (cursorY > doc.internal.pageSize.height - 20) {
                doc.addPage();
                cursorY = 20;
            }
        });
    });

    const dateStr = new Date().toLocaleDateString('fr-FR').replace(/\//g, '-');
    doc.save(`Repartition_Matiere_Par_Pole_${dateStr}.pdf`);
}

function generateRepartitionProfsPDF() {
    const { jsPDF } = window.jspdf;
    // Force paysage (Landscape) pour avoir de la place, format A4
    const doc = new jsPDF({ orientation: 'landscape', format: 'a4' });
    
    const pageWidth = doc.internal.pageSize.width;
    const pageHeight = doc.internal.pageSize.height;
    const margin = 14;
    let cursorY = 20;

    // --- EN-TÊTE DU DOCUMENT ---
    const addHeader = () => {
        doc.setFillColor(44, 62, 80); // Couleur Primary
        doc.rect(0, 0, pageWidth, 15, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(10);
        doc.setFont("helvetica", "bold");
        doc.text(`DHG MANAGER - RÉPARTITION PAR ENSEIGNANT`, margin, 10);
        doc.text(`Année ${DATA.config.year}`, pageWidth - margin, 10, { align: 'right' });
        cursorY = 25;
    };
    addHeader();

    // 1. Regroupement des données (Idem que l'affichage écran)
    const consolidated = {};
    getEntityTeachers().forEach((t) => {
        const cleanName = t.name.trim();
        if(!consolidated[cleanName]) {
            consolidated[cleanName] = { name: cleanName, indices: [], data: [] };
        }
        consolidated[cleanName].indices.push(t.idx); // index réel dans SHARED_TEACHERS
        consolidated[cleanName].data.push(t);
    });

    // Tri alphabétique
    const groups = Object.values(consolidated).sort((a, b) => a.name.localeCompare(b.name));

    // 2. Boucle sur chaque professeur
    groups.forEach(group => {
        let totalServiceFait = 0;
        let totalDu = 0;
        let rows = [];

        // Matière principale
        let mainSub = group.data[0].subject;
        group.data.forEach(t => {
            const meta = DATA.subjectMeta[t.subject];
            const metaMain = DATA.subjectMeta[mainSub];
            if(DATA.subjects.some(s => DATA.subjectMeta[s]?.parent === t.subject)) mainSub = t.subject;
            if(metaMain?.parent === t.subject) mainSub = t.subject;
        });

        // totalServiceFait via calcTeacherHoursBreakdown (plafonnement lycée/pôle inclus)
        group.data.forEach((t, i) => {
            const realIdx = group.indices[i];
            const csd = parseFloat(t.csd || 0);
            totalDu += (t.ors - csd);
            const bd = calcTeacherHoursBreakdown(realIdx, currentEntity);
            totalServiceFait += bd.weighted;
        });

        // Construction des lignes PDF (affichage uniquement - sans modifier totalServiceFait)
        group.data.forEach((t, i) => {
            const realIdx = group.indices[i];
            const dech = (parseFloat(t.decharge || 0) + parseFloat(t.dech_ext || 0));

            let levelsPaid = new Set();
            const relevantKeys = Object.keys(DATA.assignments).filter(k => parseInt(k.split('_')[1]) === realIdx);

            relevantKeys.forEach(key => {
                const parts = key.split('_');
                const assign = DATA.assignments[key];
                const entityId = parts.slice(0, parts.length - 1).join('_');
                const meta = DATA.subjectMeta[t.subject];
                
                let parentLevelName = null;
                const structLvlExact = DATA.structure.find(l => l.level === entityId);
                if (structLvlExact) parentLevelName = structLvlExact.level;
                else {
                    const structLvlPrefix = DATA.structure.find(l => entityId.startsWith(getLevelPrefix(l.level)));
                    if (structLvlPrefix) parentLevelName = structLvlPrefix.level;
                }

                let h = assign.quota !== undefined ? parseFloat(assign.quota) : 0;
                if(h === 0 && parentLevelName) h = getHoursForClassSubject(entityId, parentLevelName, t.subject);

                if(h > 0) {
                    let label = DATA.classNames[entityId] || entityId;
                    let typeBadge = "Cl.";
                    if (entityId === 'ETAB') { label = "Forfait Etab"; typeBadge = "Etab"; }
                    else if (structLvlExact) { typeBadge = "Niv"; }

                    let isIncluded = false;
                    if (meta && meta.mode === 'level' && parentLevelName) {
                        if (levelsPaid.has(parentLevelName)) { isIncluded = true; }
                        else { levelsPaid.add(parentLevelName); }
                    }
                    
                    let rowLabel = label;
                    if(t.subject !== mainSub) rowLabel += ` (${t.subject})`;

                    rows.push({
                        col1: rowLabel,
                        col2: isIncluded ? "(Incl.)" : h.toFixed(1),
                        col3: typeBadge,
                        isIncluded: isIncluded,
                        isDech: false
                    });
                }
            });

            if(dech > 0) {
                // Décharges visuelles (déjà dans le weighted de calcTeacherHoursBreakdown)
                rows.push({ col1: "Décharges / Autres", col2: dech.toFixed(1), col3: "Div.", isDech: true });
            }
        });

        // Calcul du solde et couleur
        const solde = totalServiceFait - totalDu;
        const isOk = solde >= -0.1;
        const colorHex = isOk ? "#27ae60" : "#c0392b"; // Vert ou Rouge
        const colorRGB = isOk ? [39, 174, 96] : [192, 57, 43];

        // --- RENDU SUR LE PDF ---

        // 1. Vérification de l'espace restant pour éviter de couper une carte
        // Estimation hauteur : Header (10) + Table (approx 7 par ligne) + Padding
        const estimatedHeight = 15 + (rows.length * 7) + 10;
        
        if (cursorY + estimatedHeight > pageHeight - 10) {
            doc.addPage();
            addHeader(); // Remettre l'en-tête sur la nouvelle page
        }

        // 2. Dessin du cadre "Carte"
        const cardStartY = cursorY;
        
        // Barre de couleur à gauche
        doc.setFillColor(colorRGB[0], colorRGB[1], colorRGB[2]);
        doc.rect(margin, cardStartY, 2, 8, 'F'); // Petite barre colorée visuelle

        // Titre Professeur
        doc.setFontSize(11);
        doc.setFont("helvetica", "bold");
        doc.setTextColor(44, 62, 80);
        doc.text(`${group.name} - ${mainSub}`, margin + 4, cardStartY + 6);

        // Indicateur Solde (à droite)
        doc.setFontSize(10);
        doc.text(`Fait: ${totalServiceFait.toFixed(2)}h / Dû: ${totalDu.toFixed(1)}h`, pageWidth - margin - 30, cardStartY + 6, { align: 'right' });
        
        // Badge Solde
        doc.setFillColor(colorRGB[0], colorRGB[1], colorRGB[2]);
        doc.roundedRect(pageWidth - margin - 25, cardStartY + 1, 25, 7, 2, 2, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFont("helvetica", "bold");
        doc.text(`${solde > 0 ? '+' : ''}${solde.toFixed(2)}`, pageWidth - margin - 12.5, cardStartY + 5.5, { align: 'center' });

        cursorY += 10;

        // 3. Tableau des services (s'il y a des lignes)
        if (rows.length > 0) {
            doc.autoTable({
                startY: cursorY,
                head: [['Support / Classe', 'Heures', 'Type']],
                body: rows.map(r => [r.col1, r.col2, r.col3]),
                theme: 'grid',
                styles: { fontSize: 9, cellPadding: 1, textColor: 50 },
                headStyles: { fillColor: [236, 240, 241], textColor: 50, fontStyle: 'bold', lineWidth: 0.1, lineColor: 200 },
                columnStyles: {
                    0: { cellWidth: 'auto' },
                    1: { cellWidth: 20, halign: 'center', fontStyle: 'bold' },
                    2: { cellWidth: 15, halign: 'center', textColor: 100 }
                },
                didParseCell: function(data) {
                    // Style conditionnel (lignes grisées si incluses, etc.)
                    const rowRaw = rows[data.row.index];
                    if (data.section === 'body' && rowRaw) {
                        if (rowRaw.isIncluded) {
                            data.cell.styles.textColor = [150, 150, 150];
                            data.cell.styles.fillColor = [248, 249, 250];
                        }
                        if (rowRaw.isDech) {
                            data.cell.styles.textColor = [142, 68, 173]; // Violet pour décharges
                            data.cell.styles.fillColor = [244, 236, 247];
                        }
                    }
                },
                margin: { left: margin + 4, right: margin } // Indentation légère sous le titre
            });

            cursorY = doc.lastAutoTable.finalY + 8; // Espace après le tableau
        } else {
            // Cas sans service
            doc.setFont("helvetica", "italic");
            doc.setFontSize(9);
            doc.setTextColor(150);
            doc.text("(Aucun service saisi)", margin + 4, cursorY + 5);
            cursorY += 15;
        }
        
        // Ligne de séparation légère entre les profs (optionnel)
        doc.setDrawColor(230, 230, 230);
        doc.line(margin, cursorY - 4, pageWidth - margin, cursorY - 4);

    });

    // Finalisation
    const dateStr = new Date().toLocaleDateString('fr-FR').replace(/\//g, '-');
    doc.save(`Repartition_Service_Enseignants_${dateStr}.pdf`);
}

// Fonction appelée quand on clique sur "Télécharger" dans le pop-up
function confirmGlobalExport() {
    // Récupère les choix du menu
    const orientation = expConfig.orientation; // 'portrait' ou 'landscape'
    const format = expConfig.format;           // 'a3' ou 'a4'
    const forceOnePage = document.getElementById('chk-force-one-page').checked;
    
    // Ferme le menu
    document.getElementById('export-overlay').style.display = 'none';

    // Lance le bon export selon la section
    if (pendingExportSection === 'equipes') {
        exportTeamsGridPDF(orientation, format, forceOnePage);
    } else {
        const dateStr = new Date().toLocaleDateString('fr-FR');
        const filename = `DHG - ${pendingExportTitle} - ${dateStr}`;
        generateProPDF(pendingExportSection, pendingExportTitle, filename, orientation, format);
    }
}

// Nouvelle version de generateProPDF qui accepte le format et l'orientation
function generateProPDF(section, title, filename, customOrientation, customFormat) {
    const { jsPDF } = window.jspdf;
    
    // Si pas de choix (ex: appel direct), valeurs par défaut
    const orient = customOrientation || 'landscape';
    const fmt = customFormat || 'a4';

    const doc = new jsPDF({ orientation: orient, format: fmt });
    
    const pageWidth = doc.internal.pageSize.width;
    const margin = 14;

    // Ajustement de la taille de police de base selon le format pour remplir l'espace
    // A3 permet d'écrire plus gros ou d'avoir plus de colonnes
    let baseFontSize = (fmt === 'a3') ? 11 : 9;
    let headerFontSize = (fmt === 'a3') ? 11 : 9;

    // --- EN-TÊTE ---
    const addHeader = (data) => {
        doc.setTextColor(44, 62, 80);
        doc.setFontSize(16);
        doc.setFont("helvetica", "bold");
        doc.text(title.toUpperCase(), margin, 20); 
        
        doc.setFontSize(12);
        doc.setFont("helvetica", "bold");
        doc.setTextColor(100); 
        doc.text(`Rentrée ${DATA.config.year} - ${DATA.config.year+1}`, pageWidth - margin, 20, { align: 'right' });
        
        doc.setDrawColor(200, 200, 200);
        doc.line(margin, 25, pageWidth - margin, 25);
    };

    // --- VENTILATION (PILOTAGE) ---
    if (section === 'pilotage') {
        const needs = calculateNeeds();
        const rows = [];
        
        // (Logique de récupération des données identique...)
        const getStats = (sub) => {
            const profs = getEntityTeachers().filter(t => t.subject === sub);
            const dechInt = profs.reduce((a,t)=>a+(t.decharge||0), 0);
            const dechExt = profs.reduce((a,t)=>a+(t.dech_ext||0), 0);
            const hp = profs.reduce((a,t)=> a + (t.ors - (t.csd||0) - (t.dech_ext||0)), 0);
            const hsa = profs.reduce((a,t)=>a+t.hsa, 0);
            const bes = (needs[sub] || 0) + dechInt;
            const app = hp + hsa;
            return { bes, app, hp, hsa, profs };
        };

        const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();
        
        roots.forEach(r => {
            const rStats = getStats(r);
            const kids = DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === r);
            
            if (kids.length > 0) {
                let poleBes = rStats.bes, poleApp = rStats.app, poleHP = rStats.hp, poleHSA = rStats.hsa;
                const kidsData = kids.map(k => {
                    const kStats = getStats(k);
                    poleBes += kStats.bes; poleApp += kStats.app; poleHP += kStats.hp; poleHSA += kStats.hsa;
                    return { name: k, stats: kStats };
                });
                const soldePole = poleApp - poleBes;

                rows.push({
                    col1: `PÔLE ${r.toUpperCase()}`,
                    col2: poleBes.toFixed(1), col3: poleApp.toFixed(1), col4: poleHP.toFixed(1), col5: poleHSA.toFixed(1), col6: soldePole.toFixed(1),
                    _style: { fillColor: [69, 90, 100], fontStyle: 'bold', textColor: 255 } // Gris Anthracite
                });

                addSubjectRows(rows, r, rStats, true);
                kidsData.forEach(kd => addSubjectRows(rows, kd.name, kd.stats, true));

            } else {
                // Matière Solo : Style "En-tête" aussi
                rows.push({
                    col1: r,
                    col2: rStats.bes.toFixed(1), col3: rStats.app.toFixed(1), col6: (rStats.app - rStats.bes).toFixed(1),
                    _style: { fillColor: [69, 90, 100], fontStyle: 'bold', textColor: 255 } // Gris Anthracite
                });
                
                // Profs de la matière solo
                rStats.profs.forEach(p => addProfRow(rows, p, false));
            }
        });

        function addSubjectRows(targetArray, name, stats, indent) {
            // Pour les sous-matières dans un pôle
            if(stats.bes === 0 && stats.app === 0) return;
            const solde = stats.app - stats.bes;
            const label = indent ? `   ${name}` : name; 

            targetArray.push({
                col1: label,
                col2: stats.bes.toFixed(1), col3: stats.app.toFixed(1), col6: solde.toFixed(1),
                _style: { fillColor: [245, 245, 245], fontStyle: 'bold', textColor: 0 } // Gris très clair
            });
            stats.profs.forEach(p => addProfRow(targetArray, p, true));
        }

        function addProfRow(targetArray, p, indent) {
            const realContrib = (p.ors - (p.csd||0) - (p.dech_ext||0)) + p.hsa;
            let info = ""; 
            if(p.bmp>0) info += `BMP ${p.bmp}h `;
            if(p.csd>0) info += `(Dont ${p.csd}h CSD) `;
            if(p.decharge>0) info += `(Dont ${p.decharge}h DGH) `;
            
            const profLabel = indent ? `      ${p.name} (${p.status})` : `   ${p.name} (${p.status})`;

            targetArray.push({
                col1: profLabel,
                col2: '', col3: '', 
                col4: realContrib.toFixed(1),
                _style: { fillColor: [255, 255, 255], fontStyle: 'normal', textColor: 50 }
            });
        }

        doc.autoTable({
            head: [['Discipline / Enseignant', 'Besoin', 'Apport', 'Solde']],
            body: rows.map(r => [r.col1, r.col2, r.col3, r.col6]),
            startY: 35,
            theme: 'grid',
            headStyles: { fillColor: [52, 152, 219], textColor: 255, fontStyle: 'bold', halign: 'center', fontSize: headerFontSize },
            styles: { fontSize: baseFontSize, cellPadding: 1.5, valign: 'middle', halign: 'center', lineColor: [200,200,200], lineWidth: 0.1 },
            columnStyles: { 0: { halign: 'left', cellWidth: 'auto' } },
            didParseCell: function(data) {
                const rowObj = rows[data.row.index];
                if (data.section === 'body' && rowObj && rowObj._style) {
                    data.cell.styles.fillColor = rowObj._style.fillColor;
                    data.cell.styles.fontStyle = rowObj._style.fontStyle;
                    data.cell.styles.textColor = rowObj._style.textColor;
                }
            },
            didDrawPage: addHeader,
            margin: { top: 35, bottom: 20, left: margin, right: margin }
        });
    }

    // --- AUTRES (BILAN, PROFS, ETC.) ---
    else {
        let sourceElem = null;
        if (section === 'professeurs') sourceElem = document.getElementById('rh-table-list'); 
        else if (section === 'recap') sourceElem = document.getElementById('recap-table');
        else if (section === 'ventilation') sourceElem = document.querySelector('.grid-table');
        else if (section === 'structure') sourceElem = document.getElementById('structure-table');
        else if (section === 'matieres') sourceElem = document.getElementById('subjects-table');

        if (!sourceElem && section !== 'dashboard') { alert("Rien à exporter."); return; }

        if (section === 'dashboard') {
             // (Code dashboard inchangé...)
             addHeader();
             doc.save(`${filename}.pdf`);
             return;
        }

        // Nettoyage avant export
        const cleanT = cleanTableForExport(sourceElem);
        
        doc.autoTable({
            html: cleanT,
            startY: 35,
            theme: 'grid',
            headStyles: { fillColor: [52, 152, 219], textColor: 255, fontStyle: 'bold', halign: 'center', fontSize: headerFontSize },
            styles: { fontSize: baseFontSize, textColor: 50, valign: 'middle', halign: 'center', cellPadding: 1 },
            
            // Gestion des couleurs pour le BILAN
            didParseCell: function(data) {
                if(section === 'recap' && data.section === 'body') {
                    const rowRaw = data.row.raw;
                    // Si la ligne a la classe "row-header" (notre gris anthracite)
                    if(rowRaw.classList && rowRaw.classList.contains('row-header')) {
                         data.cell.styles.fillColor = [69, 90, 100]; // Gris Anthracite
                         data.cell.styles.textColor = 255;
                         data.cell.styles.fontStyle = 'bold';
                    }
                }
            },
            
            didDrawPage: addHeader,
            margin: { top: 35, bottom: 20, left: margin, right: margin }
        });
    }

    doc.save(`${filename}.pdf`);
}

function cleanTableForExport(original) {
    if (!original) return null;
    const clone = original.cloneNode(true);

    // 1. Suppression Colonne Code
    const codeHeader = clone.querySelector('.col-code-header');
    if(codeHeader) codeHeader.remove();
    clone.querySelectorAll('.col-code').forEach(el => el.remove());

    // 2. Aplatissement des Inputs
    clone.querySelectorAll('.td-class').forEach(td => {
        const btn = td.querySelector('.class-name-btn');
        const name = btn ? btn.innerText : td.innerText;
        td.innerHTML = '';
        td.innerText = name.trim();
        td.style.fontWeight = 'bold';
        td.style.textAlign = 'center'; 
    });

    clone.querySelectorAll('.vertical-stack').forEach(stack => {
        const inputs = stack.querySelectorAll('input');
        if(inputs.length === 2) {
            const base = parseFloat(inputs[0].value || 0);
            const marge = parseFloat(inputs[1].value || 0);
            const span = document.createElement('span');
            span.innerText = marge > 0 ? `${base} + ${marge}` : base;
            span.style.whiteSpace = 'nowrap';
            stack.parentNode.replaceChild(span, stack);
        }
    });

    clone.querySelectorAll('input').forEach(input => {
        const span = document.createElement('span');
        span.innerText = input.value !== "" ? input.value : "";
        input.parentNode.replaceChild(span, input);
    });

    clone.querySelectorAll('select').forEach(select => {
        const span = document.createElement('span');
        span.innerText = select.options[select.selectedIndex]?.text || "";
        select.parentNode.replaceChild(span, select);
    });

    // 3. Nettoyage Interface
    clone.querySelectorAll('button, .del-badge, .btn, label, input[type=checkbox]').forEach(el => el.remove());

    // 4. Nettoyage En-têtes
    clone.querySelectorAll('th').forEach(th => {
        const text = th.innerText.trim().replace(/\s+/g, ' '); 
        th.innerHTML = text;
        th.style.width = 'auto';
        th.style.height = 'auto';
    });
    
    // 5. Suppression Colonne Actions
    const headers = clone.querySelectorAll('th');
    let actionIndex = -1;
    headers.forEach((th, idx) => {
        if(th.innerText.includes('Act') || th.innerText.includes('Suppr') || th.innerText.includes('Actions') || th.innerText.includes('Action')) actionIndex = idx;
    });
    
    if (actionIndex > -1) {
        headers[actionIndex].remove();
        clone.querySelectorAll('tbody tr').forEach(tr => {
            if(tr.cells.length > actionIndex) tr.deleteCell(actionIndex);
        });
    }

    // --- 6. OPTIMISATION ET NETTOYAGE DES ICONES ---
    clone.querySelectorAll('td').forEach(el => {
        // Suppression flèches
        if(el.innerText.includes('↳')) {
            el.innerText = el.innerText.replace(/↳/g, '').trim();
        }
        
        // AJOUT : Suppression de l'icône BOÎTE/POLE (📦) pour le PDF
        if(el.innerText.includes('📦')) {
            el.innerText = el.innerText.replace(/📦/g, '').trim();
        }
        
        // Nettoyage général
        el.innerHTML = el.innerText.replace(/\n/g, ' ').replace(/\s+/g, ' ').trim();
        
        // Compactage visuel
        el.style.paddingLeft = '2px';
        el.style.textAlign = 'left';
    });

    return clone;
}

function renderTeams() {
    cleanGroupAssignments();
    const t = document.getElementById('teams-table');
    if (!t) return;
    t.innerHTML = '';
    
    // Modification de la légende (inchangé)
    const legendContainer = t.closest('.card').querySelector('.card-header div[style*="font-style:italic"]');
    if (legendContainer) {
        legendContainer.innerHTML = `
            <span style="display:flex; align-items:center;"><span style="width:12px; height:12px; background:#27ae60; margin-right:4px;"></span>Classe</span>
            <span style="display:flex; align-items:center; margin-left:10px;"><span style="width:12px; height:12px; background:#3498db; margin-right:4px;"></span>Partage de classe</span>
            <span style="margin-left:10px;">👑 Clic Droit = Prof Principal</span>
            <span style="color:#c0392b; font-weight:bold; margin-left:10px;">Rouge = Prof manquant</span>
        `;
    }

    // Construction du Header (inchangé)
    let headerHTML = '<thead><tr><th style="min-width:220px; text-align:left; padding-left:10px;">Matière / Enseignant</th>';
    DATA.structure.forEach(lvl => {
        const prefix = getLevelPrefix(lvl.level);
        for(let i=0; i<lvl.div; i++) {
            const defId = `${prefix}${String.fromCharCode(65+i)}`;
            const displayName = DATA.classNames[defId] || defId;
            headerHTML += `<th style="width:45px; font-size:0.8rem;">${displayName}</th>`;
        }
    });
    headerHTML += '</tr></thead>';
    t.innerHTML = headerHTML;
    
    const body = document.createElement('tbody');
    const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();
    const organized = [];
    
    // Organisation hiérarchique
    roots.forEach(r => { 
        organized.push({name: r, isChild: false}); 
        DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === r).forEach(c => organized.push({name: c, isChild: true, parent: r})); 
    });

    organized.forEach(subjItem => {
        const sub = subjItem.name;
        const meta = DATA.subjectMeta[sub] || {};
        
        // Les sur-matières (mode=group) n'ont pas de volume horaire propre → jamais affichées
        if (meta.mode === 'group') return;
        
        let isSubjectVisible = false;

        // Vérification de visibilité
        DATA.structure.forEach(lvl => {
            const prefix = getLevelPrefix(lvl.level);
            for(let i=0; i<lvl.div; i++) {
                const cId = `${prefix}${String.fromCharCode(65+i)}`;
                if (getHoursForClassSubject(cId, lvl.level, sub) > 0) isSubjectVisible = true;
            }
        });
        
        if (!isSubjectVisible) return;

        // Titre de la section Matière avec volumes horaires par classe
        {
            let headerHTML = `<tr class="team-subject-row"><td style="text-align:left; padding-left:12px;">${sub}`;
            // Volumes horaires : afficher pour chaque colonne
            let volumeCells = '';
            DATA.structure.forEach(lvl => {
                const prefix = getLevelPrefix(lvl.level);
                for(let i=0; i<lvl.div; i++) {
                    const cId = `${prefix}${String.fromCharCode(65+i)}`;
                    const h = getHoursForClassSubject(cId, lvl.level, sub);
                    // Récupérer config demi pour notation X+(Y)
                    let label = '';
                    if (h > 0) {
                        const lc = DATA.levelConfig?.[lvl.level];
                        const cfg = (DATA.classOverrides?.[cId]?.[sub]) || (lc?.[sub]);
                        const demi = cfg ? (parseFloat(cfg.demi) || 0) : 0;
                        const coef = cfg ? (parseFloat(cfg.coef) || 1) : 1;
                        const base = cfg ? (parseFloat(cfg.base) || 0) : 0;
                        if (demi > 0) {
                            label = `${base}+(${demi})`;
                        } else {
                            label = `${h % 1 === 0 ? h.toFixed(0) : h.toFixed(1)}h`;
                        }
                        volumeCells += `<td style="text-align:center; font-size:0.7rem; color:#27ae60; font-weight:700;">${label}</td>`;
                    } else {
                        volumeCells += `<td></td>`;
                    }
                }
            });
            headerHTML += `</td>${volumeCells}</tr>`;
            body.innerHTML += headerHTML;
        }

        // --- NOUVELLE LOGIQUE DE FUSION ---
        
        // 1. Les titulaires directs de cette sous-matière
        const parentGroup = meta.parent && DATA.subjectMeta[meta.parent]?.mode === 'group' ? meta.parent : null;
        const mainProfs = getEntityTeachers().filter(p => p.subject === sub);

        // 2. Les profs du groupe parent : TOUJOURS affichés dans toutes les sous-matières
        //    pour permettre l'affectation indépendante par sous-matière.
        //    Leur clé d'affectation est : cId_tIdx~childSub (avec ~ comme séparateur)
        let groupProfs = [];
        if (parentGroup) {
            getEntityTeachers()
                .filter(p => p.subject === parentGroup)
                .forEach(p => groupProfs.push({...p, _fromGroup: true, _groupName: parentGroup}));
        }
            
        // 3. Les invités (Disciplines associées)
        let guestProfs = [];
        if (meta.linkedSubjects && meta.linkedSubjects.length > 0) {
            guestProfs = getEntityTeachers()
                .filter(p => meta.linkedSubjects.includes(p.subject));
        }

        // 4. Fusion et Tri (sans doublons)
        const seenProfIdx = new Set();
        const profs = [...mainProfs, ...groupProfs, ...guestProfs].filter(p => {
            const uid = p._fromGroup ? `g_${p.idx}` : `${p.idx}`;
            if (seenProfIdx.has(uid)) return false;
            seenProfIdx.add(uid);
            return true;
        }).sort((a, b) => a.name.localeCompare(b.name));
        
        // ----------------------------------

        profs.forEach(p => {
            // Affichage distinctif selon l'origine du prof
            let displayName = p.name;
            if (p._fromGroup) {
                displayName += ` <span style="font-size:0.75rem; color:#8e44ad; font-weight:normal;" title="Assigné via le groupe '${p._groupName}'">📂 ${p._groupName}</span>`;
            } else if (p.subject !== sub) {
                displayName += ` <span style="font-size:0.75rem; color:#e67e22; font-weight:normal;">(${p.subject})</span>`;
            }

            let rowHTML = `<tr><td class="team-teacher-label" title="${p.name}">${displayName}</td>`;
            
            // Génération des cellules
            DATA.structure.forEach(lvl => {
                const prefix = getLevelPrefix(lvl.level);
                for(let i=0; i<lvl.div; i++) {
                    const cId = `${prefix}${String.fromCharCode(65+i)}`;
                    // Clé spécifique à la sous-matière pour les profs de groupe
                    const key = p._fromGroup ? `${cId}_${p.idx}~${sub}` : `${cId}_${p.idx}`;
                    const assign = DATA.assignments[key];
                    const hours = getHoursForClassSubject(cId, lvl.level, sub);
                    
                    let cellClass = "cell-assign";
                    let content = "";
                    
                    if (hours <= 0) {
                        cellClass += " cell-disabled";
                    } else if (assign) {
                        cellClass += assign.mode === 'GROUP' ? " mode-group" : " mode-class";
                        content = assign.mode === 'GROUP' ? "👥" : "✅";
                        if(assign.isPP) cellClass += " is-pp";
                    } else {
                        cellClass += " missing-teacher";
                    }
                    
                    // Profs de groupe : cliquables avec childSub passé en argument
                    let actions = "";
                    if (hours > 0) {
                        if (p._fromGroup) {
                            actions = `onclick="toggleTeamAssign('${cId}', ${p.idx}, '${sub.replace(/'/g,"\'")}')" oncontextmenu="toggleTeamPP(event, '${cId}', ${p.idx}, '${sub.replace(/'/g,"\'")}')"`; 
                        } else {
                            actions = `onclick="toggleTeamAssign('${cId}', ${p.idx})" oncontextmenu="toggleTeamPP(event, '${cId}', ${p.idx})"`;
                        }
                    }
                    rowHTML += `<td><div class="${cellClass}" ${actions}>${content}</div></td>`;
                }
            });
            rowHTML += `</tr>`;
            body.innerHTML += rowHTML;
        });

        // Cas vide (inchangé)
        if(profs.length === 0) {
            let rowHTML = `<tr><td class="team-teacher-label" style="font-style:italic; color:#999;">(Aucun enseignant)</td>`;
            DATA.structure.forEach(lvl => {
                const prefix = getLevelPrefix(lvl.level);
                for(let i=0; i<lvl.div; i++) {
                    const cId = `${prefix}${String.fromCharCode(65+i)}`;
                    if (getHoursForClassSubject(cId, lvl.level, sub) <= 0) rowHTML += `<td><div class="cell-assign cell-disabled"></div></td>`;
                    else rowHTML += `<td><div class="cell-assign missing-teacher"></div></td>`;
                }
            });
            body.innerHTML += rowHTML + `</tr>`;
        }
    });
    t.appendChild(body);
}

function toggleTeamAssign(cId, tIdx, childSub) {
    // childSub : fourni pour les profs d'un groupe (sur-matière), spécifie la sous-matière cliquée
    const key = childSub ? `${cId}_${tIdx}~${childSub}` : `${cId}_${tIdx}`;
    const entityTeachers = getEntityTeachers();
    const teacher = entityTeachers.find(t => t.idx === tIdx) || SHARED_TEACHERS[tIdx];

    if (!DATA.assignments[key]) {
        const lvlName = DATA.structure.find(l => cId.startsWith(getLevelPrefix(l.level)))?.level;
        // Pour un prof de groupe : quota = heures de la SOUS-matière spécifique
        const subjectForHours = childSub || teacher.subject;
        const h = getHoursForClassSubject(cId, lvlName, subjectForHours);
        DATA.assignments[key] = { mode: 'CLASS', quota: h, isPP: false, childSub: childSub || null };
    } else {
        delete DATA.assignments[key];
    }

    // Recalcul des modes (partage de classe) pour les clés du même type
    const subject = childSub || teacher.subject;
    const assigned = getEntityTeachers().map(t => t.idx)
        .filter(idx => {
            const k = childSub ? `${cId}_${idx}~${childSub}` : `${cId}_${idx}`;
            return DATA.assignments[k] && (SHARED_TEACHERS[idx] || {subject:''}).subject === teacher.subject;
        });

    const newMode = assigned.length > 1 ? 'GROUP' : 'CLASS';
    assigned.forEach(idx => {
        const k = childSub ? `${cId}_${idx}~${childSub}` : `${cId}_${idx}`;
        if (DATA.assignments[k]) DATA.assignments[k].mode = newMode;
    });

    saveData();
    renderTeams();
}

// Clic Droit : Prof Principal
function toggleTeamPP(e, cId, tIdx, childSub) {
    e.preventDefault(); // Bloque le menu contextuel du navigateur
    if(!DATA.assignments) DATA.assignments = {};
    const key = childSub ? `${cId}_${tIdx}~${childSub}` : `${cId}_${tIdx}`;
    
    // Si la case est vide, le clic droit l'active en "Classe entière" direct
    if(!DATA.assignments[key]) DATA.assignments[key] = { mode: 'CLASS', isPP: false, childSub: childSub || null };
    
    DATA.assignments[key].isPP = !DATA.assignments[key].isPP;
    saveData();
    renderTeams();
}

function exportTeamsListsPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const pageWidth = doc.internal.pageSize.width;
    let pageAdded = false;

    DATA.structure.forEach(lvl => {
        const prefix = lvl.level.replace(/[^0-9]/g, '') || lvl.level.charAt(0);
        for(let i=0; i<lvl.div; i++) {
            const cId = `${prefix}${String.fromCharCode(65+i)}`;
            const displayName = DATA.classNames[cId] || cId;
            
            if(pageAdded) doc.addPage();
            pageAdded = true;

            // Titre Classe
            doc.setFillColor(44, 62, 80);
            doc.rect(0, 0, pageWidth, 25, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont("helvetica", "bold");
            doc.text(`ÉQUIPE PÉDAGOGIQUE - ${displayName}`, pageWidth/2, 16, { align: 'center' });

            let ppName = "Non désigné";
            for(const [key, val] of Object.entries(DATA.assignments)) {
                if(key.startsWith(cId+'_') && val.isPP) {
                    const idx = parseInt(key.split('_')[1]);
                    const teacher = SHARED_TEACHERS[idx];
                    if(teacher) {
                        const sub = teacher.subject;
                        const meta = DATA.subjectMeta[sub] || {};
                        let isActive = false;
                        if (meta.mode === 'div') {
                             const ov = DATA.classOverrides[cId] && DATA.classOverrides[cId][sub];
                             const cfg = DATA.levelConfig[lvl.level] && DATA.levelConfig[lvl.level][sub];
                             if( ((ov||cfg).base||0) + ((ov||cfg).marge||0) > 0 ) isActive = true;
                        } else if (meta.mode === 'level') {
                             if( (meta.volLevel && meta.volLevel[lvl.level] > 0) ) isActive = true;
                        }
                        if(isActive) ppName = teacher.name;
                    }
                }
            }

            doc.setFontSize(11);
            doc.text(`Professeur Principal : ${ppName}`, pageWidth/2, 23, { align: 'center' });

            const tableBody = [];
             const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();
             const organized = [];
             roots.forEach(r => { 
                organized.push(r); 
                DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === r).forEach(c => organized.push(c)); 
             });

             organized.forEach(sub => {
                 const meta = DATA.subjectMeta[sub] || {};
                 let hours = 0;
                 if (meta.mode === 'etab') return;

                 if (meta.mode === 'div') {
                     const ov = DATA.classOverrides[cId] && DATA.classOverrides[cId][sub];
                     const cfg = DATA.levelConfig[lvl.level] && DATA.levelConfig[lvl.level][sub];
                     if(ov || cfg) hours = ((ov||cfg).base||0) + ((ov||cfg).marge||0);
                 } else if (meta.mode === 'level') {
                     hours = (meta.volLevel && meta.volLevel[lvl.level]) || 0;
                 }
                 
                 if (hours <= 0) return; 

                 const assignedProfs = [];
                 getEntityTeachers().forEach((t, idx) => {
                     if(t.subject === sub) {
                         const key = `${cId}_${idx}`;
                         if(DATA.assignments[key] && DATA.assignments[key].mode) {
                             let name = t.name;
                             // MODIFICATION ICI : Terme "Partage"
                             if(DATA.assignments[key].mode === 'GROUP') name += " (Partage)";
                             if(DATA.assignments[key].isPP) name += " (PP)";
                             assignedProfs.push(name);
                         }
                     }
                 });

                 if(assignedProfs.length > 0) {
                     tableBody.push([sub, assignedProfs.join(', ')]);
                 }
             });

            doc.autoTable({
                head: [['Matière', 'Enseignant(s)']],
                body: tableBody,
                startY: 35,
                theme: 'grid',
                headStyles: { fillColor: [52, 152, 219] },
                columnStyles: { 0: { fontStyle: 'bold', width: 60 } }
            });
        }
    });
    doc.save(`Equipes_Pedagogiques_${DATA.config.year}.pdf`);
}

// Variables d'état pour l'export
let expConfig = {
    orientation: 'landscape', // 'portrait' ou 'landscape'
    format: 'a3'              // 'a4' ou 'a3'
};

function openExportModal() {
    document.getElementById('export-overlay').style.display = 'flex';
    // On remet les valeurs par défaut visuellement
    setExportParam('orientation', 'landscape');
    setExportParam('format', 'a3');
}

function setExportParam(type, value) {
    // Mise à jour de la config
    expConfig[type] = value;
    
    // Mise à jour visuelle (Classe .selected)
    if (type === 'orientation') {
        document.getElementById('tile-orient-portrait').classList.toggle('selected', value === 'portrait');
        document.getElementById('tile-orient-landscape').classList.toggle('selected', value === 'landscape');
    } else if (type === 'format') {
        document.getElementById('tile-format-a4').classList.toggle('selected', value === 'a4');
        document.getElementById('tile-format-a3').classList.toggle('selected', value === 'a3');
    }
}

function confirmTeamExport() {
    const forceOnePage = document.getElementById('chk-force-one-page').checked;
    exportTeamsGridPDF(expConfig.orientation, expConfig.format, forceOnePage);
    document.getElementById('export-overlay').style.display = 'none';
}

function exportTeamsGridPDF(orientation, format, forceOnePage) {
    const { jsPDF } = window.jspdf;
    
    const doc = new jsPDF({ 
        orientation: orientation, 
        format: format 
    });
    
    const dateStr = new Date().toLocaleDateString('fr-FR');
    const pageWidth = doc.internal.pageSize.width;
    const margin = 14;

    // --- 1. EN-TÊTE ---
    doc.setFontSize(14);
    doc.setFont("helvetica", "bold");
    doc.text("ÉQUIPES PÉDAGOGIQUES", margin, 15);
    
    doc.setFontSize(10);
    doc.setFont("helvetica", "normal");
    doc.text(`Version du ${dateStr}`, margin, 20);
    
    doc.setFontSize(9);
    doc.setTextColor(100);
    
    const legendX = orientation === 'landscape' ? pageWidth - margin : margin;
    const legendAlign = orientation === 'landscape' ? 'right' : 'left';
    const legendY = orientation === 'landscape' ? 15 : 25;
    
    // MODIFICATION DE LA LÉGENDE ICI
    doc.text("Légende : Vert = Classe | Bleu = Partage de classe | (PP) = Prof. Principal", legendX, legendY, { align: legendAlign });
    doc.setTextColor(0);

    let baseFontSize = 8;
    let cellPadding = 1;
    
    if (forceOnePage) {
        baseFontSize = 7;
        cellPadding = 0.8;
        if (orientation === 'portrait' && format === 'a4') {
            baseFontSize = 5;
            cellPadding = 0.5;
        } else if (format === 'a4' || orientation === 'portrait') {
            baseFontSize = 6;
        }
    } else {
        if (format === 'a3' && orientation === 'landscape') {
            baseFontSize = 10;
        }
    }

    const columns = [
        { header: 'Discipline / Enseignant', dataKey: 'libelle' }
    ];
    
    const classKeys = [];
    DATA.structure.forEach(lvl => {
        const prefix = lvl.level.replace(/[^0-9]/g, '') || lvl.level.charAt(0);
        for(let i=0; i<lvl.div; i++) {
            const cId = `${prefix}${String.fromCharCode(65+i)}`;
            const cName = DATA.classNames[cId] || cId;
            columns.push({ header: cName, dataKey: cId });
            classKeys.push(cId);
        }
    });

    const colNameWidth = (format === 'a3' && orientation === 'landscape') ? 80 : 50;
    const availableWidth = pageWidth - (margin * 2) - colNameWidth;
    const nbClasses = classKeys.length;
    const colClassWidth = nbClasses > 0 ? (availableWidth / nbClasses) : 20;

    let customColStyles = { 
        0: { cellWidth: colNameWidth, halign: 'left' } 
    };
    for(let i=1; i <= nbClasses; i++) {
        customColStyles[i] = { cellWidth: colClassWidth, halign: 'center' };
    }

    const rows = [];
    const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();
    const organized = [];
    roots.forEach(r => { 
        organized.push({name: r, isChild: false}); 
        DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === r).forEach(c => organized.push({name: c, isChild: true, parent: r})); 
    });

    organized.forEach(subjItem => {
        const sub = subjItem.name;
        let isVisible = false;
        const meta = DATA.subjectMeta[sub] || {};
        if (meta.mode !== 'etab') {
            DATA.structure.forEach(lvl => {
                 const prefix = lvl.level.replace(/[^0-9]/g, '') || lvl.level.charAt(0);
                 for(let i=0; i<lvl.div; i++) {
                    const cId = `${prefix}${String.fromCharCode(65+i)}`;
                    if (DATA.levelConfig[lvl.level] && DATA.levelConfig[lvl.level][sub] && DATA.levelConfig[lvl.level][sub].base > 0) isVisible = true;
                    if (DATA.classOverrides[cId] && DATA.classOverrides[cId][sub] && DATA.classOverrides[cId][sub].base > 0) isVisible = true;
                    if (meta.mode === 'level' && meta.volLevel && meta.volLevel[lvl.level] > 0) isVisible = true;
                 }
            });
        }
        if (!isVisible) return;

        rows.push({ libelle: sub, isSubjectRow: true });

        const profs = getEntityTeachers().filter(p => p.subject === sub);
        profs.forEach(p => {
            const pRow = { libelle: p.name, isSubjectRow: false };
            classKeys.forEach(cId => {
                const key = `${cId}_${p.idx}`;
                const assign = (DATA.assignments && DATA.assignments[key]) ? DATA.assignments[key] : null;
                if (assign) {
                    let txt = "";
                    if (assign.mode === 'CLASS') txt = "X";
                    // MODIFICATION ICI : Abréviation "Ptg" pour "Partage"
                    if (assign.mode === 'GROUP') txt = "Ptg";
                    if (assign.isPP) txt += " PP";
                    pRow[cId] = txt;
                    pRow[`_style_${cId}`] = {
                        fillColor: assign.mode === 'CLASS' ? [39, 174, 96] : [52, 152, 219],
                        textColor: 255,
                        fontStyle: assign.isPP ? 'bold' : 'normal'
                    };
                }
            });
            rows.push(pRow);
        });
    });

    doc.autoTable({
        columns: columns,
        body: rows,
        startY: orientation === 'landscape' ? 25 : 30,
        theme: 'grid',
        styles: { 
            fontSize: baseFontSize,
            cellPadding: cellPadding,
            valign: 'middle', 
            lineWidth: 0.1,
            lineColor: [200, 200, 200],
            overflow: 'linebreak'
        },
        headStyles: {
            fillColor: [44, 62, 80],
            textColor: 255,
            fontStyle: 'bold',
            halign: 'center',
            fontSize: baseFontSize + 1
        },
        columnStyles: customColStyles,
        didParseCell: function(data) {
            if (data.row.raw.isSubjectRow) {
                data.cell.styles.fillColor = [230, 230, 250];
                data.cell.styles.fontStyle = 'bold';
                data.cell.styles.textColor = [0, 0, 0];
                if(data.column.index > 0) data.cell.text = "";
            }
            if (!data.row.raw.isSubjectRow && data.column.dataKey !== 'libelle') {
                const styleMeta = data.row.raw[`_style_${data.column.dataKey}`];
                if (styleMeta) {
                    data.cell.styles.fillColor = styleMeta.fillColor;
                    data.cell.styles.textColor = styleMeta.textColor;
                    data.cell.styles.fontStyle = styleMeta.fontStyle;
                }
            }
        }
    });

    doc.save(`Equipes_Pedagogiques_${format.toUpperCase()}_${orientation}.pdf`);
}

// --- FONCTION DE MISE À JOUR DES COMPTEURS (WIDGET & GLOBALS) ---
function updateGridCounter() {
    if (!DATA) return;

    // --- 1. CALCUL GLOBAL ÉTABLISSEMENT ---
    let totalConsoEtab = 0;
    
    // A. Ajout des EDS (Le forfait global)
    if (DATA.type !== 'college' && DATA.eds) {
        ['premiere', 'terminale'].forEach(lvl => {
            if (DATA.eds[lvl]) {
                DATA.eds[lvl].forEach(e => {
                    const vol = parseFloat(e.hPerGroup) || (lvl === 'premiere' ? 4 : 6);
                    const coef = parseFloat(e.coef) || 1.0;
                    totalConsoEtab += (parseFloat(e.groups) || 0) * vol * coef;
                });
            }
        });
    }

    // B. Ajout du Tronc Commun (On ignore les matières EDS ici)
    DATA.structure.forEach(lvl => {
        const prefix = getLevelPrefix(lvl.level);
        for(let i=0; i<lvl.div; i++) {
            const cId = `${prefix}${String.fromCharCode(65+i)}`;
            DATA.subjects.forEach(s => {
                const meta = DATA.subjectMeta[s];
                // CORRECTIF : On saute si c'est un EDS
                if (meta && meta.isEds) return; 

                if (meta && meta.mode === 'div') {
                    const cfg = (DATA.classOverrides && DATA.classOverrides[cId] && DATA.classOverrides[cId][s]) 
                                ? DATA.classOverrides[cId][s] 
                                : DATA.levelConfig[lvl.level][s];
                    if (cfg) totalConsoEtab += (getEffectiveBase(cfg) + (cfg.marge||0)) * (cfg.coef||1);
                }
            });
        }
        DATA.subjects.forEach(s => {
             const meta = DATA.subjectMeta[s];
             // CORRECTIF : On saute si c'est un EDS
             if (meta && meta.isEds) return;

             if (meta && meta.mode === 'level' && meta.volLevel && meta.volLevel[lvl.level]) {
                 totalConsoEtab += parseFloat(meta.volLevel[lvl.level] || 0);
             }
        });
    });

    // C. Ajout décharges et forfaits Etab
    DATA.subjects.forEach(s => { 
        if(DATA.subjectMeta[s] && DATA.subjectMeta[s].mode === 'etab') 
            totalConsoEtab += parseFloat(DATA.subjectMeta[s].etab || 0); 
    });
    getEntityTeachers().forEach(t => { totalConsoEtab += parseFloat(t.decharge || 0); });

    // Mise à jour des Widgets
    const dotationEtab = DATA.config.total || 0;
    const soldeEtab = dotationEtab - totalConsoEtab;
    const etabValEl = document.getElementById('kpi-etab-val');
    if (etabValEl) {
        etabValEl.innerText = `${totalConsoEtab.toFixed(1)} / ${dotationEtab.toFixed(1)} h`;
        updateKpiTag('kpi-etab-diff', soldeEtab);
    }
    
    // (Le reste de la fonction pour le Widget Niveau reste identique...)
    const activeTab = document.querySelector('#grid-tabs .tab.active');
    const levelRow = document.getElementById('kpi-level-row');
    if (!activeTab || activeTab.classList.contains('global-tab')) {
        if (levelRow) levelRow.style.display = 'none';
    } else {
        if (levelRow) levelRow.style.display = 'flex';
        const levelName = activeTab.innerText;
        const lvlObj = DATA.structure.find(l => l.level === levelName);
        if (lvlObj) {
            const dotationNiveau = (lvlObj.div * lvlObj.target); 
            const grilleTotalEl = document.getElementById('total-final-grille');
            const consoNiveau = grilleTotalEl ? parseFloat(grilleTotalEl.innerText) : 0;
            const soldeNiveau = dotationNiveau - consoNiveau;
            const lvlValEl = document.getElementById('kpi-lvl-val');
            if (lvlValEl) {
                lvlValEl.innerText = `${consoNiveau.toFixed(1)} / ${dotationNiveau.toFixed(1)} h`;
                updateKpiTag('kpi-lvl-diff', soldeNiveau);
            }
        }
    }
}

// Petit helper pour la couleur du badge (Correctif inclus)
function updateKpiTag(id, val) {
    const el = document.getElementById(id);
    if(!el) return;
    const sign = val > 0 ? "+" : "";
    el.innerText = `${sign}${val.toFixed(1)}`;
    el.className = 'kpi-tag'; 
    if(Math.abs(val) < 0.1) el.classList.add('bg-nul');
    else if(val > 0) el.classList.add('bg-pos');
    else el.classList.add('bg-neg');
}


function changeTab(el, idx) {
    document.querySelectorAll('#grid-tabs .tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    window.lastActiveGridTab = idx;
    if(idx === -1) renderGlobalGrid();
    else renderLevelGrid(idx);
    
    // AJOUT ICI : Mettre à jour le compteur (Etab + Niveau actif)
    updateGridCounter();
}

/* --- GESTION AVANCÉE DES DÉCHARGES --- */
let currentDechIdx = -1;

function openDechargeMenu(idx) {
    currentDechIdx = idx;
    const t = SHARED_TEACHERS[idx] || DATA.teachers[idx];
    
    // On remplit les champs du pop-up avec les valeurs actuelles du prof
    document.getElementById('dech-teacher-name').innerText = t.name;
    document.getElementById('input-dech-int').value = t.decharge || 0;
    document.getElementById('input-dech-ext').value = t.dech_ext || 0;
    
    // Affichage du pop-up
    document.getElementById('dech-overlay').style.display = 'flex';
    document.getElementById('input-dech-int').focus();
}

function saveDechargeDetails() {
    if (currentDechIdx === -1) return;
    
    const valInt = parseFloat(document.getElementById('input-dech-int').value) || 0;
    const valExt = parseFloat(document.getElementById('input-dech-ext').value) || 0;
    
    const t = SHARED_TEACHERS[currentDechIdx] || DATA.teachers[currentDechIdx];
    
    // Vérification de cohérence avant modification
    if ((valInt + valExt) > t.ors) {
        alert("Attention : Le total des décharges dépasse l'ORS du professeur !");
        return;
    }
    
    // On applique les modifications seulement maintenant
    t.decharge = valInt;
    t.dech_ext = valExt;
    
    // Sauvegarde et mise à jour de l'interface
    saveData();
    
    // Fermeture du pop-up AVANT les rafraîchissements lourds pour éviter les blocages visuels
    document.getElementById('dech-overlay').style.display = 'none';
    
    // Mise à jour des tableaux
    renderRH();
    if (document.getElementById('pilotage').classList.contains('active')) renderRHDisc();
    calculateRecap();
    
    currentDechIdx = -1;
}

function setBMP(idx) {
    const t = SHARED_TEACHERS[idx] || DATA.teachers[idx];
    const current = t.bmp || 0;
    
    const val = prompt(`Gérer BMP / CSR pour ${t.name}.\n\nSaisissez le volume horaire de ce bloc.\n(Cela remplacera automatiquement la valeur de l'ORS).`, current);
    
    if (val !== null) {
        const hours = parseFloat(val);
        if (isNaN(hours) || hours < 0) return alert("Valeur invalide");
        
        t.bmp = hours;
        
        // Logique métier : Si c'est un BMP, l'ORS devient égal au volume du BMP
        if (hours > 0) {
            t.ors = hours;
            t.status = "BMP/CSR"; // On met à jour le statut automatiquement
        } else {
            // Si on remet à 0, on repasse en Certifié par défaut (à ajuster manuellement si besoin)
            if(t.status === "BMP/CSR") t.status = "Certifié";
        }

        saveData();
        
        // Rafraîchissement intelligent selon la page active
        if (document.getElementById('pilotage').classList.contains('active')) {
            renderRHDisc();
        } else {
            renderRH();
        }
        calculateRecap();
    }
}

/* --- EXPORT PPTX POUR CA (VERSION NETTOYÉE - SANS EDS DANS LES GRILLES) --- */
function generateCAPres() {
    // 1. Initialisation
    let pptx = new PptxGenJS();
    pptx.layout = 'LAYOUT_16x9'; 
    
    const colors = {
        primary: "2C3E50", secondary: "3498DB", accent: "E67E22",
        tableHeader: "34495E", tableRowAlt: "F4F6F6", success: "27AE60",
        danger: "C0392B", poleHeader: "455A64", text: "2C3E50",
        white: "FFFFFF", black: "000000", border: "BDC3C7"
    };

    const headerStyles = { fill: colors.tableHeader, color: colors.white, bold: true, halign: 'center', valign:'middle' };
    const stdBorder = { pt: 0.5, color: colors.border };
    const chunkArray = (arr, size) => Array.from({ length: Math.ceil(arr.length / size) }, (v, i) => arr.slice(i * size, i * size + size));
    const addFooter = (slide, text) => {
        slide.addText(text, { x: 0.5, y: 5.3, fontSize: 8, color: "95A5A6" });
        slide.addText(`DHG ${DATA.config.year}`, { x: 9, y: 5.3, w:0.5, fontSize: 8, color: "95A5A6", align:'right' });
    };

    // --- 1. SLIDE INTRO ---
    let s1 = pptx.addSlide();
    s1.background = { color: "ECF0F1" };
    s1.addShape(pptx.ShapeType.rect, { x: 0, y: 0, w: 0.6, h: '100%', fill: colors.primary });
    s1.addText("CONSEIL D'ADMINISTRATION", { x: 1.2, y: 2.0, w: '80%', fontSize: 20, bold: true, color: colors.secondary, spc:2 });
    s1.addText("PRÉPARATION RENTRÉE", { x: 1.2, y: 2.6, w: '80%', fontSize: 36, bold: true, color: colors.primary });
    s1.addText(`Année Scolaire ${DATA.config.year} - ${DATA.config.year + 1}`, { x: 1.2, y: 3.8, w: '80%', fontSize: 18, color: "7F8C8D", italic:true });

    // --- 2. STRUCTURE & MOYENS ---
    let s2 = pptx.addSlide();
    s2.addText("1. Structure & Moyens", { x: 0.5, y: 0.3, fontSize: 18, bold: true, color: colors.primary });
    s2.addShape(pptx.ShapeType.line, { x:0.5, y:0.7, w:9, h:0, line:{color:colors.accent, width:2} });

    // 1. On ajoute la colonne H/Div dans les en-têtes (J'ai ajusté les largeurs 'w' pour que ça rentre)
    let structHeaders = [
        { text: "Niveau", options: { ...headerStyles, fill: colors.secondary, w: 1.1 } },
        { text: "Eff.", options: { ...headerStyles, fill: colors.secondary, w: 0.7 } },
        { text: "Div.", options: { ...headerStyles, fill: colors.secondary, w: 0.6 } },
        { text: "E/D", options: { ...headerStyles, fill: colors.secondary, w: 0.7 } },
        { text: "H/Div", options: { ...headerStyles, fill: colors.secondary, w: 0.8 } }, // <--- NOUVELLE COLONNE
        { text: "Dotation", options: { ...headerStyles, fill: colors.primary, w: 1.1 } }
    ];

    let structRows = [];
    let totEleves = 0, totDiv = 0, totDot = 0;

    DATA.structure.forEach(lvl => {
        const div = parseFloat(lvl.div) || 0;
        const target = parseFloat(lvl.target) || 0; // Le H/E (Heures par division)
        const students = parseInt(lvl.students) || 0;
        
        // Calcul simple : Div x H/Div
        let need = div * target;

        structRows.push([
            { text: lvl.level, options: { bold: true, align: 'left', border: stdBorder } },
            { text: students.toString(), options: { border: stdBorder } },
            { text: div.toString(), options: { border: stdBorder } },
            { text: div > 0 ? (students/div).toFixed(1) : "-", options: { border: stdBorder } },
            { text: target.toFixed(1), options: { border: stdBorder, fill: "F4F6F6" } }, // <--- AFFICHAGE H/DIV
            { text: need.toFixed(1), options: { bold: true, color: colors.primary, border: stdBorder } }
        ]);

        totEleves += students; 
        totDiv += div; 
        totDot += need;
    });

    // Gestion des moyens supplémentaires
    const supp = DATA.additionalMeans ? parseFloat(DATA.additionalMeans.total || 0) : 0;
    if(supp > 0) {
        // On met un colspan de 5 pour couvrir jusqu'à la colonne Dotation
        structRows.push([
            { text: "Moyens Supplémentaires", options: { colspan: 5, align: 'right', italic: true, color: "8D6E63", fill: colors.white, border: stdBorder } }, 
            { text: "+ " + supp.toFixed(1), options: { bold: true, color: colors.accent, fill: colors.white, border: stdBorder, align: 'center' } }
        ]);
        totDot += supp;
    }
    
    // Ligne TOTAL
    structRows.push([
        { text: "TOTAL", options: { fill: "D5D8DC", bold: true, border: stdBorder } }, 
        { text: totEleves.toString(), options: { fill: "D5D8DC", bold: true, border: stdBorder } }, 
        { text: totDiv.toString(), options: { fill: "D5D8DC", bold: true, border: stdBorder } }, 
        { text: totDiv>0?(totEleves/totDiv).toFixed(1):"-", options: { fill: "D5D8DC", bold: true, border: stdBorder } }, 
        { text: "-", options: { fill: "D5D8DC", bold: true, border: stdBorder } }, // Pas de total pour H/Div
        { text: totDot.toFixed(1), options: { fill: "D5D8DC", bold: true, color: colors.primary, border: stdBorder } }
    ]);
    
    // Génération du tableau (J'ai légèrement élargi le tableau à w: 5.0 pour l'esthétique)
    s2.addTable([structHeaders, ...structRows], { x: 0.5, y: 1.2, w: 5.0, fontSize: 10, rowH: 0.4, align:'center', valign:'middle', fill: { color: colors.tableRowAlt } });

    // --- Partie Droite (Reste inchangé) ---
    const dhgTotale = parseFloat(DATA.config.total || 0);
    const hp = parseFloat(DATA.config.hp || 0);
    const hsa = parseFloat(DATA.config.hsa || 0);
    const percentHSA = dhgTotale > 0 ? ((hsa / dhgTotale) * 100).toFixed(1) : 0;
    
    s2.addShape(pptx.ShapeType.rect, { x: 5.8, y: 1.2, w: 3.7, h: 3.5, fill: "F8F9F9", line: {color: colors.border, width: 1} });
    s2.addText("DOTATION GLOBALE", { x: 5.8, y: 1.4, w: 3.7, fontSize: 12, bold: true, color: colors.primary, align: 'center' });
    s2.addText(`${dhgTotale.toFixed(1)} h`, { x: 5.8, y: 1.8, w: 3.7, fontSize: 32, bold: true, color: colors.primary, align: 'center' });
    s2.addShape(pptx.ShapeType.rect, { x: 6, y: 2.8, w: 3.3, h: 0.6, fill: colors.secondary });
    s2.addText(`Heures Postes : ${hp.toFixed(1)}`, { x: 6, y: 2.8, w: 3.3, h: 0.6, fontSize: 11, color: colors.white, bold: true, align: 'center' });
    s2.addShape(pptx.ShapeType.rect, { x: 6, y: 3.6, w: 3.3, h: 0.6, fill: colors.accent });
    s2.addText(`H.S.A. : ${hsa.toFixed(1)}`, { x: 6, y: 3.6, w: 3.3, h: 0.6, fontSize: 11, color: colors.white, bold: true, align: 'center' });
    s2.addText(`(Taux HSA : ${percentHSA} %)`, { x: 5.8, y: 4.4, w: 3.7, fontSize: 9, color: "7F8C8D", align: 'center', italic:true });
    
    addFooter(s2, "Structure prévisionnelle");

    // --- 2. DÉTAIL EDS (Lycée uniquement - Reste inchangé) ---
    const levelsEDS = [{ key: 'premiere', label: 'PREMIÈRE' }, { key: 'terminale', label: 'TERMINALE' }];
    levelsEDS.forEach(lvl => {
        if (DATA.eds && DATA.eds[lvl.key] && DATA.eds[lvl.key].length > 0) {
            const chunks = chunkArray(DATA.eds[lvl.key], 8);
            chunks.forEach((chunk, idx) => {
                let sEds = pptx.addSlide();
                sEds.addText(`2. Détail Spécialités (EDS) : ${lvl.label}${chunks.length > 1 ? ` (${idx + 1}/${chunks.length})` : ""}`, { x: 0.5, y: 0.3, fontSize: 18, bold: true, color: colors.secondary });
                sEds.addShape(pptx.ShapeType.line, { x:0.5, y:0.7, w:9, h:0, line:{color:colors.secondary, width:2} });
                let edsRows = chunk.map(e => {
                    const vol = parseFloat(e.hPerGroup) || (lvl.key === 'premiere' ? 4 : 6);
                    const coef = parseFloat(e.coef) || 1.0;
                    return [{ text: e.name, options: { align: 'left', bold: true, border: stdBorder } }, { text: e.students.toString(), options: { border: stdBorder } }, { text: e.groups.toString(), options: { border: stdBorder } }, { text: vol.toFixed(1) + " h", options: { border: stdBorder } }, { text: coef !== 1.0 ? `×${coef.toFixed(2)}` : '', options: { border: stdBorder, color: '8e44ad' } }, { text: (e.groups * vol * coef).toFixed(1) + " h", options: { bold: true, fill: "EBF5FB", border: stdBorder } }];
                });
                sEds.addTable([[{ text: "Spécialité", options: { ...headerStyles, w: 3.0 } }, { text: "Élèves", options: { ...headerStyles, w: 0.9 } }, { text: "Gr.", options: { ...headerStyles, w: 0.8 } }, { text: "H/Gr.", options: { ...headerStyles, w: 0.8 } }, { text: "Pond.", options: { ...headerStyles, w: 0.8, fill: '8e44ad' } }, { text: "Total utilisé", options: { ...headerStyles, w: 1.5, fill: colors.primary } }], ...edsRows], { x: 0.5, y: 1.0, w: 9, fontSize: 11, valign: 'middle', align: 'center' });
                addFooter(sEds, `Détail EDS ${lvl.label}`);
            });
        }
    });

    // --- 3. GRILLES HORAIRES PAR NIVEAU (EDS EXCLUS) ---
    const LIMIT_GRID = 11;
    DATA.structure.forEach(lvl => {
        let allGridRows = [];
        DATA.subjects.forEach(s => {
            const meta = DATA.subjectMeta[s];
            if (meta.isEds) return; // CORRECTIF : On saute les spécialités individuelles
            
            let base = 0, marge = 0, coef = 1, display = false, labelHoraire = "";
            if(meta.mode === 'div' && meta.levels && meta.levels.includes(lvl.level)) {
                const cfg = DATA.levelConfig[lvl.level][s];
                if(cfg && (cfg.base > 0 || (cfg.demi||0) > 0 || cfg.marge > 0)) {
                    var effBase = getEffectiveBase(cfg);
                    base = effBase; marge = cfg.marge || 0; coef = cfg.coef || 1;
                    labelHoraire = (cfg.demi||0) > 0 ? cfgToExprLabel(cfg) + ' h' : effBase.toFixed(1) + " h"; display = true;
                }
            } else if(meta.mode === 'level') {
                const vol = meta.volLevel ? parseFloat(meta.volLevel[lvl.level] || 0) : 0;
                if(vol > 0) { labelHoraire = "(Forfait)"; base = vol; display = true; }
            }
            if(display) {
                allGridRows.push([{ text: s, options: { align: 'left', bold: true } }, labelHoraire, marge > 0 ? marge.toFixed(1) + " h" : "-", { text: ((base + marge) * coef).toFixed(1) + " h", options: { bold: true, fill: "EAF2F8", color: colors.primary } }]);
            }
        });
        if(allGridRows.length > 0) {
            const chunks = chunkArray(allGridRows, LIMIT_GRID);
            chunks.forEach((chunk, idx) => {
                let sLvl = pptx.addSlide();
                sLvl.addText(`3. Grille Horaire : Niveau ${lvl.level}${chunks.length > 1 ? ` (${idx+1}/${chunks.length})` : ""}`, { x: 0.5, y: 0.3, fontSize: 18, bold: true, color: colors.primary });
                sLvl.addShape(pptx.ShapeType.line, { x:0.5, y:0.5, w:9, h:0, line:{color:colors.secondary, width:2} });
                sLvl.addTable([[{ text: "Discipline", options: { ...headerStyles, fill: colors.primary, w: 3.5 } }, { text: "Horaire Élève", options: { ...headerStyles, fill: colors.secondary, w: 2.0 } }, { text: "Autonomie", options: { ...headerStyles, fill: colors.accent, w: 2.0 } }, { text: "Total Prof", options: { ...headerStyles, fill: colors.tableHeader, w: 2.0 } }], ...chunk], { x: 0.25, y: 0.65, w: 9.5, fontSize: 10, rowH: 0.35, border: stdBorder, align: 'center', valign: 'middle' });
                addFooter(sLvl, `Grille ${lvl.level}`);
            });
        }
    });

    // --- 4. SYNTHÈSE GLOBALE ---
    const LIMIT_GLOBAL = 14; 
    let colW = (9.5 - 2.5) / (DATA.structure.length + 1);
    let globHeaders = [{ text: "Discipline", options: { ...headerStyles, fill: colors.primary, w: 2.5 } }];
    DATA.structure.forEach(l => globHeaders.push({ text: l.level, options: { ...headerStyles, fill: colors.secondary, w: colW } }));
    globHeaders.push({ text: "TOT", options: { ...headerStyles, fill: colors.tableHeader, w: colW } });

    let allGlobRows = [];
    DATA.subjects.forEach(s => {
        let rowData = [], grandTotal = 0, visible = false;
        rowData.push({ text: s, options: { align: 'left', bold: true, fill: "F2F3F4", fontSize: 8 } });
        DATA.structure.forEach(lvl => {
            let h = 0; const meta = DATA.subjectMeta[s];
            if(meta.mode === 'div') { const cfg = DATA.levelConfig[lvl.level][s]; if(cfg) h = (getEffectiveBase(cfg) + (cfg.marge||0)) * (cfg.coef||1) * lvl.div; }
            else if(meta.mode === 'level') { h = meta.volLevel ? parseFloat(meta.volLevel[lvl.level] || 0) : 0; }
            if(h > 0) visible = true; grandTotal += h; rowData.push({ text: h > 0 ? h.toFixed(1) : "-", options: { fontSize: 8, color: h>0?colors.black:"CCCCCC" } });
        });
        if(DATA.subjectMeta[s].mode === 'etab') { grandTotal += parseFloat(DATA.subjectMeta[s].etab || 0); visible = true; }
        rowData.push({ text: grandTotal.toFixed(1), options: { bold: true, fill: "EAFAF1", color: colors.success, fontSize: 8 } });
        if(visible) allGlobRows.push(rowData);
    });
    chunkArray(allGlobRows, LIMIT_GLOBAL).forEach((chunk, idx) => {
        let sGlobal = pptx.addSlide();
        sGlobal.addText(`4. Synthèse Globale${allGlobRows.length > LIMIT_GLOBAL ? ` (${idx+1})` : ""}`, { x: 0.5, y: 0.3, fontSize: 18, bold: true, color: colors.primary });
        sGlobal.addShape(pptx.ShapeType.line, { x:0.5, y:0.6, w:9, h:0, line:{color:colors.tableHeader, width:2} });
        sGlobal.addTable([globHeaders, ...chunk], { x: 0.25, y: 0.75, w: 9.5, rowH: 0.3, border: { pt: 0.25, color: "CCCCCC" }, align: 'center', valign: 'middle' });
        addFooter(sGlobal, "Vue d'ensemble");
    });

    // --- 5. BILAN PAR PÔLES ---
    const LIMIT_BILAN = 11; 
    let recapRows = []; const needs = calculateNeeds(); let res = {}; let autoComments = {};
    DATA.subjects.forEach(s => { res[s] = { cost:0 }; autoComments[s] = []; });
    getEntityTeachers().forEach(p => {
        if (!p.subject) return; if (!res[p.subject]) res[p.subject] = { cost:0 };
        res[p.subject].cost += (p.ors - (p.csd||0) - (p.dech_ext||0)) + p.hsa;
        if (p.bmp > 0) autoComments[p.subject].push(`BMP ${p.bmp}h`);
        if (p.csd > 0) autoComments[p.subject].push(`CSD ${p.name}`);
    });
    const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();
    roots.forEach(r => {
        const kids = DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === r);
        const makeRow = (label, subjName, isHeader, isChild) => {
            const bes = needs[subjName] || 0, app = res[subjName] ? res[subjName].cost : 0, ecart = app - bes, manComm = (DATA.recapComments && DATA.recapComments[subjName]) ? DATA.recapComments[subjName] : "", autComm = autoComments[subjName] ? autoComments[subjName].join(", ") : "";
            let fullComm = (autComm && manComm) ? `${autComm} / ${manComm}` : (autComm || manComm);
            if(isHeader) return [{ text: label, options: { fill: colors.poleHeader, color: colors.white, bold: true, align: 'left' } }, { text: bes.toFixed(1), options: { fill: colors.poleHeader, color: colors.white, bold: true } }, { text: app.toFixed(1), options: { fill: colors.poleHeader, color: colors.white, bold: true } }, { text: ecart.toFixed(1), options: { fill: colors.poleHeader, color: ecart>=0?colors.success:"#E57373", bold: true } }, { text: "", options: { fill: colors.poleHeader } }];
            else return [{ text: isChild ? "    " + label : label, options: { align: 'left' } }, bes.toFixed(1), app.toFixed(1), { text: ecart.toFixed(1), options: { color: ecart>=0 ? colors.success : colors.danger, bold: true } }, { text: fullComm, options: { align: 'left', italic: true, fontSize: 8 } }];
        };
        if (kids.length > 0) {
            let poleBes = 0, poleApp = 0, kidsRows = [];
            if((needs[r] || 0) > 0 || (res[r] && res[r].cost > 0)) { poleBes += needs[r] || 0; poleApp += (res[r]?.cost || 0); kidsRows.push(makeRow(r, r, false, true)); }
            kids.forEach(k => { if((needs[k] || 0) > 0 || (res[k] && res[k].cost > 0)) { poleBes += needs[k] || 0; poleApp += (res[k]?.cost || 0); kidsRows.push(makeRow(k, k, false, true)); }});
            if(poleApp > 0 || poleBes > 0) {
                let ecartPole = poleApp - poleBes; recapRows.push(makeRow(`PÔLE ${r.toUpperCase()}`, r, true, false)); 
                recapRows[recapRows.length-1][1].text = poleBes.toFixed(1); recapRows[recapRows.length-1][2].text = poleApp.toFixed(1); recapRows[recapRows.length-1][3].text = ecartPole.toFixed(1); recapRows[recapRows.length-1][3].options.color = ecartPole>=0?"#81C784":"#E57373";
                recapRows.push(...kidsRows);
            }
        } else if((needs[r] || 0) > 0 || (res[r] && res[r].cost > 0)) recapRows.push(makeRow(r, r, false, false));
    });
    chunkArray(recapRows, LIMIT_BILAN).forEach((chunk, idx) => {
        let sBilan = pptx.addSlide();
        sBilan.addText(`5. Bilan & Commentaires${recapRows.length > LIMIT_BILAN ? ` (${idx+1})` : ""}`, { x: 0.5, y: 0.3, fontSize: 18, bold: true, color: colors.primary });
        sBilan.addShape(pptx.ShapeType.line, { x:0.5, y:0.6, w:9, h:0, line:{color:colors.danger, width:2} });
        sBilan.addTable([[{ text: "Discipline", options: { ...headerStyles, fill: colors.primary, w: 2.5 } }, { text: "Besoin", options: { ...headerStyles, fill: colors.danger, color: colors.black, w: 1.0 } }, { text: "Apport", options: { ...headerStyles, fill: colors.success, w: 1.0 } }, { text: "Écart", options: { ...headerStyles, fill: "95A5A6", w: 1.0 } }, { text: "Commentaires", options: { ...headerStyles, fill: colors.secondary, w: 4.0 } }], ...chunk], { x: 0.25, y: 0.75, w: 9.5, fontSize: 10, rowH: 0.35, border: stdBorder, align: 'center', valign: 'middle' });
        addFooter(sBilan, "Bilan disciplinaire");
    });

    // --- 6. VOTE & RH ---
    let sVote = pptx.addSlide();
    sVote.addText("6. Synthèse & Vote", { x: 0.5, y: 0.3, fontSize: 18, bold: true, color: colors.primary });
    sVote.addShape(pptx.ShapeType.line, { x:0.5, y:0.6, w:9, h:0, line:{color:colors.primary, width:2} });
    sVote.addShape(pptx.ShapeType.rect, { x: 0.5, y: 0.8, w: 9, h: 3.2, fill: "FFF8E1", line: {color: colors.accent, dashType:'dash'} });
    sVote.addText("INFORMATIONS RH (Postes & BMP)", { x: 0.7, y: 1.0, fontSize: 11, bold: true, color: colors.accent });
    let rhTxt = [];
    getEntityTeachers().forEach(t => {
        if(t.bmp > 0) rhTxt.push(`• ${t.subject} : BMP ${t.bmp}h`);
        if(t.csd > 0) rhTxt.push(`• ${t.subject} : CSD ${t.csd}h (${t.name})`);
    });
    if(rhTxt.length > 0) {
        let half = Math.ceil(rhTxt.length/2);
        sVote.addText(rhTxt.slice(0, half).join("\n"), { x: 0.7, y: 1.3, w: 4, h: 2.5, fontSize: 10, valign:'top' });
        sVote.addText(rhTxt.slice(half).join("\n"), { x: 5.0, y: 1.3, w: 4, h: 2.5, fontSize: 10, valign:'top' });
    } else sVote.addText("Aucun moyen provisoire signalé.", { x: 0.7, y: 1.4, fontSize: 10, italic: true });
    
    let yVote = 4.3; let hVote = 0.8;
    sVote.addShape(pptx.ShapeType.rect, { x: 0.5, y: yVote, w: 9, h: hVote, fill: colors.primary });
    sVote.addText("VOTE CA", { x: 0.7, y: yVote, w: 2, h: hVote, fontSize: 16, bold: true, color: colors.white, valign:'middle' });
    let boxY = yVote + 0.15; let boxH = 0.5;
    sVote.addShape(pptx.ShapeType.rect, { x: 3.0, y: boxY, w: 1.8, h: boxH, fill: colors.white });
    sVote.addText("POUR", { x: 3.0, y: boxY, w: 1.8, h: boxH, fontSize: 10, align:'center', valign:'middle' });
    sVote.addShape(pptx.ShapeType.rect, { x: 5.1, y: boxY, w: 1.8, h: boxH, fill: colors.white });
    sVote.addText("CONTRE", { x: 5.1, y: boxY, w: 1.8, h: boxH, fontSize: 10, align:'center', valign:'middle' });
    sVote.addShape(pptx.ShapeType.rect, { x: 7.2, y: boxY, w: 1.8, h: boxH, fill: colors.white });
    sVote.addText("ABST.", { x: 7.2, y: boxY, w: 1.8, h: boxH, fontSize: 10, align:'center', valign:'middle' });
    addFooter(sVote, "Séance du ........................");

    pptx.writeFile({ fileName: `DHG_CA_${DATA.config.year}.pptx` });
}
let currentEdsLevel = ''; // Pour savoir si on est en 1ere ou Term
let tempSelectedEds = new Set();

const EDS_REFERENTIEL = [
    // --- ENSEIGNEMENTS DE SPÉCIALITÉ GÉNÉRAUX ---
    { name: "Mathématiques", cat: "Gen" },
    { name: "Physique-Chimie", cat: "Gen" },
    { name: "SVT", cat: "Gen" },
    { name: "HGGSP", cat: "Gen" },
    { name: "SES", cat: "Gen" },
    { name: "HLP", cat: "Gen" },
    { name: "LLCE Anglais", cat: "Gen" },
    { name: "LLCE Espagnol", cat: "Gen" },
    { name: "LLCE Allemand", cat: "Gen" },
    { name: "LLCE Italien", cat: "Gen" },
    { name: "NSI", cat: "Gen" },
    { name: "SI (Sciences de l'Ingénieur)", cat: "Gen" },
    { name: "AMC (Anglais Monde Contemp.)", cat: "Gen" },
    { name: "EPPCS (Sport)", cat: "Gen" },
    
    // --- PÔLE ARTS (Indépendants) ---
    { name: "Spé Arts Plastiques (Arts)", cat: "Gen" },
    { name: "Spé Musique (Arts)", cat: "Gen" },
    { name: "Spé Théâtre (Arts)", cat: "Gen" },
    { name: "Spé Cinéma-Audiovisuel (Arts)", cat: "Gen" },
    { name: "Spé Danse (Arts)", cat: "Gen" },
    { name: "Spé Histoire des Arts (Arts)", cat: "Gen" },
    { name: "Spé Arts du Cirque (Arts)", cat: "Gen" },

    // --- FILIÈRE STI2D : PREMIÈRE ---
    { name: "STI2D - Innovation Technologique (IT)", cat: "Tech" },
    { name: "STI2D - Ingénierie et dév. durable (I2D)", cat: "Tech" },
    { name: "STI2D - Phys.-Chimie et Maths (PCM)", cat: "Tech" },

    // --- FILIÈRE STI2D : TERMINALE ---
    { name: "Physique-Chimie et Mathématiques (STI2D)", cat: "Tech" },
    { name: "2I2D - Arch. et Construction (AC)", cat: "Tech" },
    { name: "2I2D - Énergie et Environnement (EE)", cat: "Tech" },
    { name: "2I2D - Innovation Tech. et Éco-conception (ITEC)", cat: "Tech" },
    { name: "2I2D - Systèmes d'Info. et Numérique (SIN)", cat: "Tech" },

    // --- FILIÈRE STMG ---
    { name: "STMG - Gestion et Finance", cat: "Tech" },
    { name: "STMG - Mercatique (Marketing)", cat: "Tech" },
    { name: "STMG - Ressources Humaines et Comm.", cat: "Tech" },
    { name: "STMG - Systèmes d'Information de Gestion", cat: "Tech" },

    // --- AUTRES FILIÈRES TECHNO ---
    { name: "ST2S - Sciences et tech. sanitaires et sociales", cat: "Tech" },
    { name: "ST2S - Biologie et physiopathologie humaines", cat: "Tech" },
    { name: "STL - Biotechnologies", cat: "Tech" },
    { name: "STL - Sciences phys. et chim. en labo", cat: "Tech" },
    { name: "STD2A - Analyse et méthodes en design", cat: "Tech" },
    { name: "STD2A - Conception et création en design", cat: "Tech" },
    { name: "STHR - Hôtellerie et Restauration", cat: "Tech" },
    { name: "STAV - Aménagement / Production / Transformation", cat: "Tech" },
    { name: "S2TMD - Musique / Danse / Théâtre", cat: "Tech" }
];

function addEDS(level) {
    // Sécurité : on s'assure que la structure existe au moment du clic
    if (!DATA.eds) DATA.eds = { premiere: [], terminale: [] };
    if (!DATA.eds[level]) DATA.eds[level] = [];

    currentEdsLevel = level;
    tempSelectedEds.clear();
    
    const container = document.getElementById('eds-tiles-container');
    const title = document.getElementById('eds-selector-title');
    
    if (!container || !title) return;

    title.innerText = `Choisir les EDS : ${level === 'premiere' ? 'Première' : 'Terminale'}`;
    container.innerHTML = '';

    const existing = DATA.eds[level].map(e => e.name || "");

    // Génération des tuiles avec FILTRAGE CORRIGÉ
    EDS_REFERENTIEL.forEach(eds => {
        // --- LOGIQUE DE FILTRAGE STI2D / 2I2D ---
        
        // 1. En Première : On cache les spés de Terminale (celles commençant par 2I2D ou contenant (STI2D))
        if (level === 'premiere' && (eds.name.startsWith("2I2D") || eds.name.includes("(STI2D)"))) {
            return;
        }
        
        // 2. En Terminale : On cache les 3 spés obligatoires de Première (celles commençant par STI2D -)
        if (level === 'terminale' && eds.name.startsWith("STI2D - ")) {
            return;
        }

        // Affichage si pas déjà sélectionné
        if (!existing.includes(eds.name)) {
            const tile = document.createElement('div');
            tile.className = 'eds-tile';
            tile.innerText = eds.name;
            tile.onclick = () => {
                tile.classList.toggle('selected');
                if(tile.classList.contains('selected')) tempSelectedEds.add(eds.name);
                else tempSelectedEds.delete(eds.name);
            };
            container.appendChild(tile);
        }
    });

    const overlay = document.getElementById('eds-selector-overlay');
    if (overlay) {
        overlay.style.display = 'flex';
        document.getElementById('btn-validate-eds').onclick = confirmEdsSelection;
    }
}

function confirmEdsSelection() {
    tempSelectedEds.forEach(name => {
        // 1. Ajout dans la liste de gestion des EDS (Tableau du bas)
        if (!DATA.eds[currentEdsLevel].some(e => e.name === name)) {
            DATA.eds[currentEdsLevel].push({ 
                name: name, 
                students: 0, 
                groups: 0, 
                hPerGroup: (currentEdsLevel === 'premiere' ? 4 : 6),
                coef: 1.0
            });
        }

        // 2. Gestion de la Matière (Tableau principal)
        if (!DATA.subjects.includes(name)) {
            // Cas A : La matière n'existe pas, on la crée proprement
            DATA.subjects.push(name);
            DATA.subjectMeta[name] = { 
                mode: 'level', 
                levels: [currentEdsLevel === 'premiere' ? '1ère' : 'Terminale'],
                etab: 0, 
                volLevel: {}, 
                parent: "Spécialités",
                code: "EDS",
                isEds: true // C'est ce flag qui cache la colonne
            };
        } else {
            // Cas B : La matière EXISTE DÉJÀ (Saisie manuelle avant)
            // ==> ON FORCE LA CONVERSION EN EDS
            if (!DATA.subjectMeta[name]) DATA.subjectMeta[name] = {};
            
            DATA.subjectMeta[name].isEds = true; // On force le masquage de la colonne
            DATA.subjectMeta[name].mode = 'level'; // On force le mode "Niveau"
            DATA.subjectMeta[name].parent = "Spécialités"; // On la range dans le bon pôle
            
            // On s'assure que le niveau actuel est bien activé pour cette matière
            const lvlLabel = currentEdsLevel === 'premiere' ? '1ère' : 'Terminale';
            if (!DATA.subjectMeta[name].levels) DATA.subjectMeta[name].levels = [];
            if (!DATA.subjectMeta[name].levels.includes(lvlLabel)) {
                DATA.subjectMeta[name].levels.push(lvlLabel);
            }
        }
    });
    
    saveData();
    syncEdsToVentilation(); // Synchronise les heures
    renderEDS();
    closeEdsSelector();
    
    // Rafraîchit les écrans pour faire disparaître instantanément la colonne en trop
    if(typeof renderSubjectsConfig === 'function') renderSubjectsConfig();
    if(typeof renderGridSystem === 'function') renderGridSystem();
}

function closeEdsSelector() {
    document.getElementById('eds-selector-overlay').style.display = 'none';
}

function renderEDS() {
    const levels = ['premiere', 'terminale'];
    let globalTotal = 0;

    levels.forEach(lvl => {
        const tbody = document.getElementById(`eds-full-${lvl === 'premiere' ? '1ere' : 'term'}`);
        if(!tbody) return;
        tbody.innerHTML = '';
        let levelTotal = 0;

        const genItems = DATA.eds[lvl]
            .filter(e => { const ref = EDS_REFERENTIEL.find(r => r.name === e.name); return !ref || ref.cat === 'Gen'; })
            .sort((a, b) => a.name.localeCompare(b.name));

        const techItems = DATA.eds[lvl]
            .filter(e => { const ref = EDS_REFERENTIEL.find(r => r.name === e.name); return ref && ref.cat !== 'Gen'; })
            .sort((a, b) => a.name.localeCompare(b.name));

        // Construit la liste des enseignants disponibles (SHARED_TEACHERS)
        const teacherOptions = SHARED_TEACHERS.length > 0
            ? '<option value="">– Choisir –</option>' + SHARED_TEACHERS.map(t =>
                `<option value="${t.id}">${t.name}${t.subject ? ' (' + t.subject + ')' : ''}</option>`
              ).join('')
            : '<option value="">⚠️ Aucun enseignant créé</option>';

        const renderItems = (items, label) => {
            if(items.length === 0) return;
            tbody.innerHTML += `<tr><td colspan="9" class="eds-cat-header">${label}</td></tr>`;

            items.forEach(item => {
                const globalIdx = DATA.eds[lvl].indexOf(item);
                if(item.hPerGroup === undefined) item.hPerGroup = (lvl === 'premiere' ? 4 : 6);
                // Coef par défaut selon l'entité : 1.1 pour lycée GT (1ère/Term), 1.25 pour Pôle Sup
                const _edsDefaultCoef = (currentEntity === 'pole') ? 1.25 : 1.1;
                if(item.coef === undefined || item.coef === 1.0) item.coef = _edsDefaultCoef;
                if(!item.teachers) item.teachers = []; // tableau d'IDs, un par groupe

                const ratioE_G = item.groups > 0 ? (item.students / item.groups).toFixed(1) : 0;
                const rawHours = item.groups * item.hPerGroup;
                const totalHours = rawHours * (item.coef || 1.0);
                levelTotal += totalHours;
                const costPerStudent = item.students > 0 ? (totalHours / item.students).toFixed(3) : 0;
                const ratioClass = ratioE_G > 35 ? 'text-danger' : (ratioE_G < 15 ? 'text-warning' : 'text-success');

                // Génère les selects enseignants : un par groupe
                let teacherCells = '';
                const nbGroups = Math.max(1, item.groups || 1);
                for (let g = 0; g < nbGroups; g++) {
                    const selectedId = item.teachers[g] || '';
                    const selectedName = selectedId
                        ? (SHARED_TEACHERS.find(t => t.id === selectedId)?.name || '?')
                        : '';
                    const gLabel = nbGroups > 1 ? `<span style="font-size:0.7rem;color:#999;display:block;">Gr.${g+1}</span>` : '';
                    teacherCells += `
                        <div style="display:inline-flex;flex-direction:column;align-items:center;margin:2px 3px;">
                            ${gLabel}
                            <select onchange="updEDSTeacher('${lvl}',${globalIdx},${g},this.value)"
                                style="font-size:0.78rem;padding:3px 5px;border-radius:5px;border:1px solid #d2b4de;
                                       background:${selectedId ? '#f5eef8' : '#fafafa'};color:#6c3483;max-width:140px;cursor:pointer;">
                                ${teacherOptions.replace(`value="${selectedId}"`, `value="${selectedId}" selected`)}
                            </select>
                        </div>`;
                }

                const coefColor = (item.coef || 1.0) !== 1.0 ? '#8e44ad' : '#999';
                tbody.innerHTML += `
                    <tr>
                        <td style="text-align:left; font-weight:bold; font-size:0.9rem;">
                            <span class="badge-cat">${label.includes('GÉN') ? 'GEN' : 'TECH'}</span>${item.name}
                        </td>
                        <td><input type="number" value="${item.students}" class="input-inline-eds" onchange="updEDS('${lvl}', ${globalIdx}, 'students', this.value)"></td>
                        <td><input type="number" value="${item.groups}" class="input-inline-eds" style="border-color:var(--secondary)" onchange="updEDS('${lvl}', ${globalIdx}, 'groups', this.value)"></td>
                        <td><input type="number" value="${item.hPerGroup}" class="input-inline-eds" style="border-color:var(--accent)" onchange="updEDS('${lvl}', ${globalIdx}, 'hPerGroup', this.value)"></td>
                        <td><input type="number" step="0.01" min="0.1" max="5" value="${(item.coef || 1.0).toFixed(2)}" class="input-inline-eds" style="border-color:#8e44ad; color:${coefColor}; font-weight:bold;" title="Coefficient de pondération (ex: 1.5 pour majorer de 50%)" onchange="updEDS('${lvl}', ${globalIdx}, 'coef', this.value)"></td>
                        <td class="${ratioClass}" style="font-weight:bold; font-size:1.1rem;">${ratioE_G}</td>
                        <td><span class="cost-badge">${costPerStudent} h/él.</span></td>
                        <td style="vertical-align:middle; min-width:160px;">
                            <div style="display:flex;flex-wrap:wrap;gap:2px;align-items:center;">
                                ${teacherCells}
                            </div>
                        </td>
                        <td><button onclick="delEDS('${lvl}', ${globalIdx})" style="border:none; background:none; color:#c0392b; cursor:pointer; font-size:1.2rem;">×</button></td>
                    </tr>
                `;
            });
        };

        renderItems(genItems, "EDS GÉNÉRAUX");
        renderItems(techItems, "EDS TECHNOLOGIQUES");

        document.getElementById(`total-eds-${lvl === 'premiere' ? '1ere' : 'term'}`).innerText = levelTotal.toFixed(1);
        globalTotal += levelTotal;
    });

    if(document.getElementById('total-eds-global'))
        document.getElementById('total-eds-global').innerText = globalTotal.toFixed(1) + " h";

    // Actualiser le récapitulatif enseignants
    renderEDSTeacherSummary();
}

/** Met à jour l'enseignant assigné à un groupe d'une EDS */
function updEDSTeacher(lvl, idx, groupIdx, teacherId) {
    if (!DATA.eds[lvl][idx].teachers) DATA.eds[lvl][idx].teachers = [];
    DATA.eds[lvl][idx].teachers[groupIdx] = teacherId;
    saveData();
    renderEDSTeacherSummary();
}

/** Récapitulatif des enseignants EDS : une ligne par enseignant avec ses EDS */
function renderEDSTeacherSummary() {
    const div = document.getElementById('eds-teacher-summary');
    if (!div) return;

    // Construire map teacherId → { name, assignments: [{lvl, eds, group, hours}] }
    const map = {};
    ['premiere','terminale'].forEach(lvl => {
        const lvlLabel = lvl === 'premiere' ? '1ère' : 'Terminale';
        (DATA.eds[lvl] || []).forEach(item => {
            const nbG = item.groups || 0;
            const hPG = (item.hPerGroup || (lvl === 'premiere' ? 4 : 6)) * (parseFloat(item.coef) || 1.0);
            (item.teachers || []).forEach((tid, g) => {
                if (!tid) return;
                if (!map[tid]) map[tid] = { assignments: [] };
                map[tid].assignments.push({
                    lvl: lvlLabel, eds: item.name,
                    group: nbG > 1 ? `Gr.${g+1}` : null,
                    hours: hPG
                });
            });
        });
    });

    if (Object.keys(map).length === 0) {
        div.innerHTML = '<em style="color:#aaa;">Aucun enseignant assigné pour l\'instant.</em>';
        return;
    }

    let html = '<table style="width:100%;border-collapse:collapse;font-size:0.86rem;">';
    html += '<thead><tr style="background:#6c3483;color:white;">';
    html += '<th style="padding:8px 10px;text-align:left;">Enseignant</th>';
    html += '<th style="padding:8px;text-align:left;">Discipline</th>';
    html += '<th style="padding:8px;text-align:left;">EDS assignées</th>';
    html += '<th style="padding:8px;text-align:center;width:90px;">Total EDS h</th>';
    html += '</tr></thead><tbody>';

    let i = 0;
    for (const [tid, data] of Object.entries(map)) {
        const t = SHARED_TEACHERS.find(x => x.id === tid);
        const name     = t ? t.name    : `ID:${tid}`;
        const subject  = t ? (getTeacherSubjectForEntity(t, currentEntity) || '–') : '–';
        const totalH   = data.assignments.reduce((s, a) => s + a.hours, 0);
        const bg = i % 2 === 0 ? '#fdf5ff' : 'white';

        const assignList = data.assignments.map(a =>
            `<span style="display:inline-block;background:#e8daef;color:#6c3483;border-radius:10px;padding:2px 8px;margin:2px;font-size:0.8rem;">
                ${a.lvl} – ${a.eds}${a.group ? ' (' + a.group + ')' : ''} · ${a.hours}h
            </span>`
        ).join('');

        html += `<tr style="background:${bg};border-bottom:1px solid #f0e6fb;">
            <td style="padding:8px 10px;font-weight:700;color:#2c3e50;">${name}</td>
            <td style="padding:8px;color:#7d3c98;">${subject}</td>
            <td style="padding:8px;">${assignList}</td>
            <td style="padding:8px;text-align:center;font-weight:800;color:#6c3483;font-size:1rem;">${totalH}h</td>
        </tr>`;
        i++;
    }

    html += '</tbody></table>';
    div.innerHTML = html;
}

// FONCTION DE BASCULEMENT (Transfert)
function transferEDS(from, to) {
    if(DATA.eds[from].length === 0) return alert("Rien à transférer !");
    if(!confirm(`Voulez-vous copier la structure des EDS de ${from} vers ${to} ?\n(Les effectifs seront remis à 0, mais les groupes, noms et enseignants seront conservés)`)) return;

    DATA.eds[from].forEach(source => {
        if(!DATA.eds[to].some(e => e.name === source.name)) {
            DATA.eds[to].push({
                name: source.name,
                students: 0,
                groups: source.groups,
                hPerGroup: (to === 'terminale' ? 6 : 4),
                teachers: source.teachers ? [...source.teachers] : []
            });
        }
    });
    saveData();
    renderEDS();
    alert("✅ Structure transférée ! Pensez à ajuster les effectifs et les volumes horaires.");
}

function updEDS(lvl, idx, field, val) {
    if (field === 'coef') {
        const c = parseFloat(val);
        DATA.eds[lvl][idx][field] = (isNaN(c) || c <= 0) ? 1.0 : c;
    } else {
        DATA.eds[lvl][idx][field] = parseFloat(val) || 0;
    }
    
    // Synchroniser les volumes vers la ventilation
    syncEdsToVentilation();
    
    saveData();
    renderEDS();
    calculateRecap();
}

function delEDS(lvl, idx) {
    if(confirm("Supprimer cet enseignement de spécialité ?")) {
        // On retire l'élément du tableau correspondant (1ere ou Term)
        DATA.eds[lvl].splice(idx, 1);
        
        // Sauvegarde et mise à jour de l'interface
        saveData();
        renderEDS();
        
        // On met à jour le bilan global pour refléter la suppression des heures
        calculateRecap();
    }
}

function syncEdsToVentilation() {
    const levels = ['premiere', 'terminale'];
    levels.forEach(lvlKey => {
        const realLevelName = DATA.structure.find(l => 
            lvlKey === 'premiere' ? (l.level.includes("1") || l.level.includes("Prem")) : (l.level.includes("Term") || l.level.includes("Tle"))
        )?.level;

        if (realLevelName && DATA.eds[lvlKey]) {
            DATA.eds[lvlKey].forEach(eds => {
                const coef = parseFloat(eds.coef) || 1.0;
                const totalHours = (eds.groups || 0) * (eds.hPerGroup || (lvlKey === 'premiere' ? 4 : 6)) * coef;
                if (DATA.subjectMeta[eds.name]) {
                    if (!DATA.subjectMeta[eds.name].volLevel) DATA.subjectMeta[eds.name].volLevel = {};
                    DATA.subjectMeta[eds.name].volLevel[realLevelName] = totalHours;
                }
            });
        }
    });
}
// Changez 'profs' par 'matieres'
let currentRepartitionView = 'matieres'; 

function switchRepartitionView(view) {
    currentRepartitionView = view;
    // Mise à jour visuelle des boutons
    document.getElementById('btn-view-repart-prof').classList.toggle('active', view === 'profs');
    document.getElementById('btn-view-repart-mat').classList.toggle('active', view === 'matieres');
    renderRepartition();
}

function renderRepartition() {
    const container = document.getElementById('repartition-content');
    if (!container) return;
    container.innerHTML = '';

    if (currentRepartitionView === 'profs') {
        renderRepartitionProfs(container);
    } else {
        renderRepartitionMatieres(container);
    }
}
// --- VUE PAR ENSEIGNANT (CORRIGÉE V7 : Dédoublonnage Strict Classes vs Niveau) ---
function renderRepartitionProfs(container) {
    cleanGroupAssignments();
    // 1. Regroupement par Enseignant
    const consolidated = {};

    getEntityTeachers().forEach((t) => {
        const cleanName = t.name.trim();
        if(!consolidated[cleanName]) {
            consolidated[cleanName] = { name: cleanName, indices: [], data: [] };
        }
        consolidated[cleanName].indices.push(t.idx); // index réel dans SHARED_TEACHERS
        consolidated[cleanName].data.push(t);
    });

    // 2. Génération de l'affichage
    Object.values(consolidated)
        .sort((a, b) => a.name.localeCompare(b.name))
        .forEach(group => {
            let totalServiceFait = 0;
            let totalDu = 0;
            let rows = [];

            // A. Matière principale
            let mainSub = group.data[0].subject;
            group.data.forEach(t => {
                const meta = DATA.subjectMeta[t.subject];
                const metaMain = DATA.subjectMeta[mainSub];
                if(DATA.subjects.some(s => DATA.subjectMeta[s]?.parent === t.subject)) mainSub = t.subject;
                if(metaMain?.parent === t.subject) mainSub = t.subject;
            });

            // B. Calcul du totalServiceFait via calcTeacherHoursBreakdown
            // → applique le plafonnement réglementaire (lycée: pond≤1h, pôle: pond≤ORS)
            let globalRaw = 0, globalPond = 0;
            let globalPondCapped = false, globalPondExceedsORS = false;
            group.data.forEach((t, i) => {
                const realIdx = group.indices[i];
                const csd = parseFloat(t.csd || 0);
                totalDu += (t.ors - csd);

                // Utiliser le même calcul que le Bilan Consolidé (avec plafonnement)
                const bd = calcTeacherHoursBreakdown(realIdx, currentEntity);
                globalRaw  += bd.raw;
                globalPond += bd.pond;
                totalServiceFait += bd.weighted;
                if (bd.pondCapped)      globalPondCapped      = true;
                if (bd.pondExceedsORS)  globalPondExceedsORS  = true;
            });

            // C. Construction des lignes visuelles (AFFICHAGE UNIQUEMENT - sans modifier totalServiceFait)
            group.data.forEach((t, i) => {
                const realIdx = group.indices[i];
                const dech = (parseFloat(t.decharge || 0) + parseFloat(t.dech_ext || 0));

                // --- SET ANTI-DOUBLON ---
                let levelsPaid = new Set();

                // Récupération et TRI des affectations
                // Inclure les clés standard (cId_tIdx) ET les clés de sous-matière (cId_tIdx~childSub)
                const relevantKeys = Object.keys(DATA.assignments).filter(key => {
                    const basePart = key.includes('~') ? key.split('~')[0] : key;
                    const parts = basePart.split('_');
                    return parseInt(parts[parts.length - 1]) === realIdx;
                });

                const sortedKeys = relevantKeys.sort((a, b) => {
                    const idA = a.split('_')[0];
                    const idB = b.split('_')[0];
                    const isLvlA = DATA.structure.some(l => l.level === idA) || idA === 'ETAB';
                    const isLvlB = DATA.structure.some(l => l.level === idB) || idB === 'ETAB';
                    return isLvlB - isLvlA;
                });

                sortedKeys.forEach(key => {
                    const assign = DATA.assignments[key];
                    // Les clés ~childSub ont le format: cId_tIdx~childSub → extraire cId correctement
                    const baseKey = key.includes('~') ? key.split('~')[0] : key;
                    const childSubFromKey = key.includes('~') ? key.split('~').slice(1).join('~') : null;
                    const parts = baseKey.split('_');
                    const entityId = parts.slice(0, parts.length - 1).join('_');
                    // Pour les profs de groupe : utiliser la sous-matière de la clé pour le calcul d'heures
                    const effectiveSub = childSubFromKey || t.subject;
                    const meta = DATA.subjectMeta[effectiveSub] || DATA.subjectMeta[t.subject];
                    
                    let parentLevelName = null;
                    
                    const structLvlExact = DATA.structure.find(l => l.level === entityId);
                    if (structLvlExact) {
                        parentLevelName = structLvlExact.level;
                    } else {
                        const structLvlPrefix = DATA.structure.find(l => entityId.startsWith(getLevelPrefix(l.level)));
                        if (structLvlPrefix) parentLevelName = structLvlPrefix.level;
                    }

                    let h = 0;
                    const isGroupSubject = DATA.subjectMeta[t.subject]?.mode === 'group';
                    if (childSubFromKey) {
                        // Clé de sous-matière (~childSub) : recalculer depuis la sous-matière spécifique
                        if (parentLevelName) h = getHoursForClassSubject(entityId, parentLevelName, childSubFromKey);
                    } else if (isGroupSubject) {
                        // Groupe sans clé spécifique : somme de toutes les sous-matières
                        if (parentLevelName) h = getHoursForClassSubject(entityId, parentLevelName, t.subject);
                    } else if(assign.quota !== undefined && assign.quota !== null) {
                        h = parseFloat(assign.quota);
                    } else if(parentLevelName) {
                        h = getHoursForClassSubject(entityId, parentLevelName, t.subject);
                    }

                    let levelCoef = 1.0;
                    let cfgDemi = 0; // heures demi-classe pour affichage X+(Y)
                    if (parentLevelName && DATA.levelConfig && DATA.levelConfig[parentLevelName]) {
                        const lc = DATA.levelConfig[parentLevelName];
                        const entitySubj = getTeacherSubjectForEntity(t, currentEntity);
                        const cfgSubj = lc[entitySubj] || lc[t.subject] || Object.values(lc)[0];
                        if (cfgSubj && cfgSubj.coef !== undefined) levelCoef = parseFloat(cfgSubj.coef) || 1.0;
                        // Récupérer demi pour notation X+(Y)
                        const cfgRaw = (DATA.classOverrides?.[entityId]?.[entitySubj || t.subject]) 
                                    || lc[entitySubj] || lc[t.subject];
                        if (cfgRaw) cfgDemi = parseFloat(cfgRaw.demi) || 0;
                    }
                    // hRaw = heures brutes devant élèves (h est déjà pondéré si coef > 1)
                    const hRaw = levelCoef > 1.01 ? Math.round(h / levelCoef * 10) / 10 : h;
                    // Label volume brut devant élèves avec notation demi-classe si applicable
                    const hBase = levelCoef > 1.01 ? hRaw : h;
                    const rawVolumeLabel = cfgDemi > 0
                        ? `${(hBase - 2*cfgDemi*(levelCoef > 1.01 ? 1 : 1)).toFixed(1)}+(${cfgDemi.toFixed(1)})`
                        : null;

                    if(h > 0) {
                        let label = DATA.classNames[entityId] || entityId;
                        let typeBadge = "Cl.";
                        if (entityId === 'ETAB') { label = "Forfait Global"; typeBadge = "Etab"; }
                        else if (structLvlExact) { typeBadge = "Niv"; }

                        let isIncluded = false;
                        if (meta && meta.mode === 'level' && parentLevelName) {
                            if (levelsPaid.has(parentLevelName)) {
                                isIncluded = true;
                            } else {
                                levelsPaid.add(parentLevelName);
                            }
                        }

                        if(typeBadge === "Cl." && assign.mode === 'GROUP') typeBadge = "Ptg";
                        // Label : pour clé ~childSub, afficher le nom de la sous-matière
                        let labelSub = '';
                        if (childSubFromKey) {
                            labelSub = `<br><small style="color:#8e44ad; font-weight:bold;">${childSubFromKey}</small>`;
                        } else if (t.subject !== mainSub) {
                            labelSub = `<br><small style="color:#e67e22; font-weight:bold;">${t.subject}</small>`;
                        }

                        let displayHours;
                        if (isIncluded) {
                            displayHours = `<span style="color:#bdc3c7; font-size:0.8rem;">(Incl.)</span>`;
                        } else {
                            // Afficher UNIQUEMENT les heures devant élèves (notation X+(Y) si demi-classe)
                            if (rawVolumeLabel) {
                                displayHours = `<span style="font-size:0.82rem;color:#2c3e50;">${rawVolumeLabel}</span>=<b>${hRaw.toFixed(1)}h</b>`;
                            } else {
                                displayHours = `<b>${hRaw.toFixed(1)}h</b>`;
                            }
                        }

                        let styleCell = "";
                        if (isIncluded) styleCell = "background:#f4f6f6; color:#95a5a6; border:1px dashed #bdc3c7;";
                        else if (typeBadge === "Niv" || typeBadge === "Etab") styleCell = "background:#fffcf5; border-bottom:2px solid #f1c40f;";
                        else if (levelCoef > 1.01) styleCell = "background:#fdf5ff; border-bottom:2px solid #8e44ad;";

                        rows.push({
                            isDech: false,
                            isMain: (t.subject === mainSub),
                            isIncluded: isIncluded,
                            isEds: false,
                            parentLevel: parentLevelName,
                            entityId: entityId,
                            html: `<td style="${styleCell}"><b>${label}</b>${labelSub}<br>${displayHours} <small style="color:#999;">(${typeBadge})</small></td>`
                        });
                    }
                });

                // Décharges (visuelles uniquement)
                if(dech > 0) {
                    rows.push({ isDech: true, html: `<td style="color:#8e44ad; background:#f4ecf7;"><i>Décharges</i><br>${dech.toFixed(1)}h</td>` });
                }

                // EDS assignées à cet enseignant
                if (DATA.eds) {
                    ['premiere', 'terminale'].forEach(lvl => {
                        (DATA.eds[lvl] || []).forEach(eds => {
                            if (!eds.teachers) return;
                            eds.teachers.forEach((tid, groupIdx) => {
                                if (tid !== t.id) return;
                                const coef = parseFloat(eds.coef) || 1.0;
                                const hPG = (parseFloat(eds.hPerGroup) || (lvl === 'premiere' ? 4 : 6)) * coef;
                                const lvlLabel = lvl === 'premiere' ? '1ère' : 'Terminale';
                                const nbG = eds.groups || 1;
                                const grpLabel = nbG > 1 ? ` Gr.${groupIdx + 1}` : '';
                                const coefLabel = coef !== 1.0 ? ` ×${coef.toFixed(2)}` : '';
                                // (EDS incluses dans calcTeacherHoursBreakdown - pas d'ajout ici)
                                rows.push({
                                    isDech: false,
                                    isEds: true,
                                    isMain: false,
                                    isIncluded: false,
                                    parentLevel: lvl === 'premiere' ? '1ère' : 'Terminale',
                                    entityId: lvl,
                                    html: `<td style="background:#f5eef8; border-bottom:2px solid #8e44ad;">
                                        <b style="color:#6c3483;">${eds.name}</b><br>
                                        <span style="font-size:0.78rem; color:#8e44ad;">${lvlLabel}${grpLabel}${coefLabel}</span><br>
                                        <span style="font-weight:700;">${hPG.toFixed(1)}h</span> <small style="color:#999;">(EDS)</small>
                                    </td>`
                                });
                            });
                        });
                    });
                }
            });

            // Ordre pédagogique : collège 6→3, lycée/LP 2nde→1ère→Term, pôle/BTS/CPGE après
            const LEVEL_ORDER = [
                '6ème','6','6e','6E',
                '5ème','5','5e','5E',
                '4ème','4','4e','4E',
                '3ème','3','3e','3E',
                '2nde','2nde pro','seconde','2',
                '1ère','première','1ere','1','CAP 1',
                'terminale','term','tle','T','CAP 2'
            ];

            function levelSortKey(row) {
                if (row.isDech) return 9000; // Décharges tout à la fin
                const lvl = (row.parentLevel || row.entityId || '').toLowerCase().trim();
                // Recherche dans LEVEL_ORDER
                const idx = LEVEL_ORDER.findIndex(k => {
                    const kl = k.toLowerCase();
                    return lvl === kl || lvl.startsWith(kl) || kl.startsWith(lvl);
                });
                if (idx >= 0) return idx * 10 + (row.isEds ? 1 : 0); // EDS du même niveau juste après TC
                // Niveau pas dans la liste → cherche dans DATA.structure
                const sIdx = DATA.structure.findIndex(l => {
                    const ll = l.level.toLowerCase();
                    return lvl === ll || lvl.startsWith(ll.replace(/[^0-9a-z]/g,'')); 
                });
                if (sIdx >= 0) return 500 + sIdx * 10 + (row.isEds ? 1 : 0);
                // Niveaux spéciaux (BTS, CPGE, ETAB…)
                if (row.entityId === 'ETAB') return 8000;
                return 7000 + (row.isEds ? 1 : 0);
            }

            // Tri final : par niveau pédagogique, puis Inclus à la fin de leur groupe
            rows.sort((a, b) => {
                const ka = levelSortKey(a) + (a.isIncluded ? 0.5 : 0);
                const kb = levelSortKey(b) + (b.isIncluded ? 0.5 : 0);
                return ka - kb;
            });

            const solde = totalServiceFait - totalDu;
            const isOk = solde >= -0.1;
            const color = isOk ? '#27ae60' : '#c0392b';
            const bg = isOk ? '#e8f8f5' : '#fdedec';

            // Formatage bandeau droit : rawTotal+pondTotal=total / ORS
            // Si pondération plafonnée : le +Xh en gras/couleur avertissement
            let serviceDisplay;
            if (globalPond > 0.01) {
                const pondStyle = globalPondCapped
                    ? 'font-weight:900; color:#e67e22;'
                    : (globalPondExceedsORS ? 'font-weight:900; color:#8e44ad;' : 'color:#8e44ad;');
                serviceDisplay = `<span style="font-size:0.88rem;color:#7f8c8d;font-weight:400;">${globalRaw.toFixed(1)}h<span style="color:#ccc;">+</span><span style="${pondStyle}">${globalPond.toFixed(1)}h</span>=</span><span style="font-weight:800; font-size:1.1rem; color:#2c3e50;">${totalServiceFait.toFixed(1)}h</span>`;
            } else {
                serviceDisplay = `<span style="font-weight:800; font-size:1.1rem; color:#2c3e50;">${totalServiceFait.toFixed(1)}h</span>`;
            }

            const orsDisplay = `<span style="font-size:0.9rem; color:#999; font-weight:normal;"> / ${totalDu.toFixed(1)} h</span>`;

            container.innerHTML += `
            <div class="card" style="border-left: 5px solid ${color}; margin-bottom: 10px; padding: 15px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h4 style="margin:0; color:#2c3e50;">
                        ${group.name} 
                        <span style="font-weight:normal; font-size:0.9rem; color:#7f8c8d; margin-left:5px;">
                            ${mainSub} ${group.data.length > 1 ? '(+ Options)' : ''}
                        </span>
                    </h4>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span>${serviceDisplay}${orsDisplay}</span>
                        <span style="padding:2px 8px; border-radius:4px; background:${bg}; color:${color}; font-weight:bold; font-size:0.9rem;">
                            ${solde > 0 ? '+' : ''}${solde.toFixed(1)}
                        </span>
                    </div>
                </div>
                <div style="margin-top:12px; overflow-x:auto;">
                    <table style="font-size:0.85rem; width:auto;">
                        <tr style="background:#f8f9fa; border-radius:4px;">
                            ${rows.length > 0 ? rows.map(r => r.html).join('') : '<td style="font-style:italic; color:#c0392b; padding:5px; font-weight:bold;">⚠️ Aucun service saisi</td>'}
                        </tr>
                    </table>
                </div>
            </div>`;
        });
}

function renderRepartitionMatieres(container) {
    container.innerHTML = '';
    
    // Correction préventive des données
    checkAndFixData();

    // On récupère les matières racines (Pôles)
    const roots = DATA.subjects.filter(s => !DATA.subjectMeta[s]?.parent).sort();

    roots.forEach(root => {
        const subjectsInPole = [root, ...DATA.subjects.filter(s => DATA.subjectMeta[s]?.parent === root)];
        
        // Création de la carte du Pôle
        let poleHTML = `<div class="card" style="overflow-x:auto; margin-bottom:30px; border-top: 4px solid #455a64;">
                        <h3 style="color:#455a64; margin-bottom:20px;">📦 Pôle ${root.toUpperCase()}</h3>`;

        subjectsInPole.forEach(sub => {
            const meta = DATA.subjectMeta[sub];
            if (!meta) return;
            
            // --- 1. DÉTECTION DU TYPE DE MATIÈRE (LABO ?) ---
            const isLabo = (meta.code === 'LAB' && meta.parent);

            // --- 2. RÉCUPÉRATION DES PROFS (Mise à jour Co-intervention) ---
            let profs = [];
            
            if (isLabo) {
                // CAS LABO : On prend les profs de la matière PARENTE
                profs = getEntityTeachers()
                    .filter(t => t.subject === meta.parent);
            } else {
                // CAS STANDARD : Titulaires + Invités (Co-intervention)
                
                // A. Profs titulaires de la matière
                const mainProfs = getEntityTeachers()
                    .filter(t => t.subject === sub);
                
                // A2. Profs assignés à la sur-matière parente (groupe) — héritent sur toutes les sous-matières
                const parentGroup = meta.parent && DATA.subjectMeta[meta.parent]?.mode === 'group' ? meta.parent : null;
                const groupProfs = parentGroup
                    ? getEntityTeachers().filter(t => t.subject === parentGroup)
                    : [];
                
                // B. Profs "invités" via les disciplines associées
                let guestProfs = [];
                if (meta.linkedSubjects && meta.linkedSubjects.length > 0) {
                    guestProfs = getEntityTeachers()
                        .filter(t => meta.linkedSubjects.includes(t.subject));
                }

                // C. Fusion et Tri (éviter doublons)
                const seenIdx = new Set();
                profs = [...mainProfs, ...groupProfs, ...guestProfs].filter(p => {
                    if (seenIdx.has(p.idx)) return false;
                    seenIdx.add(p.idx);
                    return true;
                });
                
                // D. Tri alphabétique pour un affichage propre
                profs.sort((a, b) => a.name.localeCompare(b.name));
            }

            // Si aucun prof concerné, on n'affiche pas le tableau
            if (profs.length === 0 && isLabo) return;

            // --- 3. DÉFINITION DES COLONNES (Classes/Niveaux) ---
            let columns = [];
            if (meta.mode === 'div') {
                DATA.structure.forEach(lvl => {
                    const prefix = getLevelPrefix(lvl.level);
                    for (let i = 0; i < lvl.div; i++) {
                        const cId = `${prefix}${String.fromCharCode(65 + i)}`;
                        // On affiche la colonne si :
                        // 1. Le niveau est coché dans les paramètres
                        // 2. OU s'il y a des heures saisies (override)
                        const isActive = (meta.levels && meta.levels.includes(lvl.level));
                        const hasHours = getHoursForClassSubject(cId, lvl.level, sub) > 0;
                        
                        if (hasHours || isActive) {
                            columns.push({ 
                                id: cId, 
                                name: DATA.classNames[cId] || cId, 
                                lvl: lvl.level, 
                                type: 'class' 
                            });
                        }
                    }
                });
            } else if (meta.mode === 'level') {
                DATA.structure.forEach(lvl => columns.push({ id: lvl.level, name: lvl.level, lvl: lvl.level, type: 'level' }));
            } else if (meta.mode === 'etab') {
                columns.push({ id: 'ETAB', name: 'Forfait Global', lvl: 'Etab', type: 'etab' });
            } else if (meta.mode === 'group') {
                // Sur-matière groupe : générer les colonnes à partir des classes des sous-matières
                DATA.structure.forEach(lvl => {
                    const prefix = getLevelPrefix(lvl.level);
                    for (let i = 0; i < lvl.div; i++) {
                        const cId = `${prefix}${String.fromCharCode(65 + i)}`;
                        if (getHoursForClassSubject(cId, lvl.level, sub) > 0) {
                            columns.push({ id: cId, name: DATA.classNames[cId] || cId, lvl: lvl.level, type: 'class' });
                        }
                    }
                });
            }

            if (columns.length === 0) return;

            // --- 4. CONSTRUCTION DU HEADER DU TABLEAU ---
            let tableHTML = `<h4 style="color:var(--secondary); margin-bottom:10px; padding-left:5px;">
                                ${sub} <small style="color:#999; font-weight:normal; font-size:0.7rem;">(${isLabo ? 'Décharge / Heure de Vaisselle' : (meta.mode === 'div' ? 'Par Classe' : 'Forfait')})</small>
                             </h4>
                             <table style="width:100%; font-size:0.8rem; border-collapse:collapse; margin-bottom:25px;">
                             <thead>
                                <tr style="background:#455a64; color:white;">
                                    <th style="text-align:left; border:1px solid #ddd; padding:8px; width:180px;">Enseignant</th>
                                    ${columns.map(col => `<th style="border:1px solid #ddd; padding:8px;">${col.name}</th>`).join('')}
                                    <th style="border:1px solid #bdc3c7; padding:8px; width:65px; background:#d6eaf8; color:#2980b9; font-weight:bold;">Tot. Mat.</th>
                                </tr>`;
            
            // Ligne de Besoin (Masquée pour les Labos car c'est du bonus enseignant)
            if (!isLabo) {
                 tableHTML += `<tr style="background:#fffbe6; font-size:0.75rem;">
                                    <td style="text-align:right; font-weight:bold; border:1px solid #ddd; padding:6px;">Besoin (h)</td>
                                    ${columns.map(col => {
                                        let val = 0;
                                        if(col.type === 'class') val = getHoursForClassSubject(col.id, col.lvl, sub);
                                        else if(col.type === 'level') val = (meta.volLevel && meta.volLevel[col.id]) || 0;
                                        else if(col.type === 'etab') val = meta.etab || 0;
                                        return `<td style="border:1px solid #ddd; padding:6px; font-weight:bold;">${val.toFixed(1)}</td>`;
                                    }).join('')}
                                    <td colspan="1" style="border:1px solid #ddd; background:#fff9c4;"></td>
                                </tr>`;
            }
            tableHTML += `</thead><tbody>`;

            // --- 5. LIGNES ENSEIGNANTS ---
            profs.forEach(p => {
                let rowTotal = 0;

                // Affichage du nom + Discipline d'origine si différente
                let displayName = p.name;
                if (p.subject !== sub) {
                    displayName += ` <span style="font-size:0.7rem; color:#e67e22; font-weight:normal;">(${p.subject})</span>`;
                }

                tableHTML += `<tr>
                    <td style="text-align:left; font-weight:bold; border:1px solid #ddd; padding:8px; background:#fafafa;">${displayName}</td>`;
                
                // CELLULES DE SAISIE
                tableHTML += columns.map(col => {
                    let val = 0;
                    let action = "";
                    
                    if (isLabo) {
                        val = p.decharge || 0;
                        action = `onchange="updateDechargeFromGrid(${p.idx}, this.value, this)"`;
                    } else {
                        const key = `${col.id}_${p.idx}`;
                        const assign = DATA.assignments[key];
                        val = (assign && assign.quota !== undefined) ? assign.quota : 0;
                        action = `onchange="updateCoTeaching('${col.id}', ${p.idx}, this.value, this)" oninput="updateCoTeaching('${col.id}', ${p.idx}, this.value, this)"`;
                    }
                    
                    // Coef du niveau pour affichage brut/pond
                    // val = quota déjà pondéré (base×coef), on recalcule le brut pour l'affichage
                    let colCoef = 1.0;
                    if (!isLabo && col.lvl && DATA.levelConfig && DATA.levelConfig[col.lvl]) {
                        const lc = DATA.levelConfig[col.lvl];
                        const entitySubj = getTeacherSubjectForEntity(p, currentEntity);
                        const cfgSubj = lc[entitySubj] || lc[p.subject] || Object.values(lc)[0];
                        if (cfgSubj && cfgSubj.coef !== undefined) colCoef = parseFloat(cfgSubj.coef) || 1.0;
                    }
                    // val est déjà pondéré → rawVal = val / coef
                    const valPond = parseFloat(val);
                    const valRaw  = colCoef > 1.01 ? Math.round(valPond / colCoef * 10) / 10 : valPond;
                    const pond    = Math.round((valPond - valRaw) * 10) / 10;

                    if (val > 0) rowTotal += valPond;

                    // Affichage : input en heures brutes + badge pondération si coef > 1
                    const pondBadge = (colCoef > 1.01 && valPond > 0)
                        ? `<div style="font-size:0.65rem;color:#8e44ad;text-align:center;margin-top:1px;">${valRaw.toFixed(1)}+${pond.toFixed(1)}=<b>${valPond.toFixed(1)}h</b></div>`
                        : '';

                    return `<td style="border:1px solid #ddd; padding:4px; background:${val > 0 ? (colCoef > 1.01 ? '#fdf5ff' : '#e3f2fd') : 'white'};">
                                <input type="number" step="0.5" value="${val === 0 ? '' : val}" 
                                       placeholder="0"
                                       style="width:50px; text-align:center; border:1px solid ${val > 0 ? (colCoef > 1.01 ? '#c39bd3' : '#90caf9') : '#eee'}; font-weight:${val > 0 ? 'bold' : 'normal'};"
                                       ${action}>
                                ${pondBadge}
                            </td>`;
                }).join('');
                    
                // Cellule Total matière uniquement
                tableHTML += `<td style="border:1px solid #ddd; padding:8px; font-weight:bold; background:#e8f0fe; color:var(--primary); text-align:center;">${rowTotal.toFixed(1)}</td>
                </tr>`;
            });
            
            // --- 6. RELIQUAT (Uniquement si pas Labo) ---
            if (!isLabo) {
                tableHTML += `<tr style="background:#fdedec;">
                    <td style="text-align:right; font-style:italic; border:1px solid #ddd; padding:8px; color:#c0392b; font-weight:bold;">Reliquat</td>
                    ${columns.map(col => {
                        let assignedInCol = 0;
                        // On somme les heures assignées pour tous les profs affichés
                        profs.forEach(p => {
                             const q = DATA.assignments[`${col.id}_${p.idx}`]?.quota || 0;
                             assignedInCol += parseFloat(q);
                        });
                        
                        let besoin = 0;
                        if(col.type === 'class') besoin = getHoursForClassSubject(col.id, col.lvl, sub);
                        else if(col.type === 'level') besoin = (meta.volLevel && meta.volLevel[col.id]) || 0;
                        else if(col.type === 'etab') besoin = meta.etab || 0;

                        const diff = besoin - assignedInCol;
                        // Vert si 0, Rouge si positif (manque), Orange si négatif (trop)
                        let color = Math.abs(diff) < 0.01 ? "#27ae60" : (diff > 0 ? "#c0392b" : "#e67e22");
                        let text = Math.abs(diff) < 0.01 ? 'OK' : diff.toFixed(1);

                        return `<td style="border:1px solid #ddd; padding:4px; font-weight:bold; color:${color}; text-align:center;">${text}</td>`;
                    }).join('')}
                    <td colspan="1" style="border:1px solid #ddd; background:#fdedec;"></td>
                </tr>`;
            }

            tableHTML += `</tbody></table>`;
            poleHTML += tableHTML;
        });
        
        container.innerHTML += poleHTML + `</div>`;
    });
}

/**
 * FONCTION DE CORRECTION AUTOMATIQUE DE LA STRUCTURE
 * Gère l'UNSS et les Labos (SVT/PC uniquement)
 */
function cleanGroupAssignments() {
    // Supprimer les anciennes clés d'affectation simples (cId_tIdx) pour les profs de groupe
    // quand des clés spécifiques par sous-matière (cId_tIdx~childSub) existent déjà.
    if (!DATA || !DATA.assignments) return;
    
    const toDelete = [];
    Object.keys(DATA.assignments).forEach(key => {
        if (key.includes('~')) return; // clé ~childSub : OK
        // Format standard : cId_tIdx
        const parts = key.split('_');
        const tIdx = parseInt(parts[parts.length - 1]);
        if (isNaN(tIdx)) return;
        const teacher = SHARED_TEACHERS[tIdx];
        if (!teacher) return;
        // Vérifier si c'est un prof de groupe
        const subjectForEnt = (teacher.subjects && teacher.subjects[currentEntity]) || teacher.subject;
        if (DATA.subjectMeta[subjectForEnt]?.mode !== 'group') return;
        // Si des clés ~childSub existent pour ce même cId+tIdx → supprimer l'ancienne
        const cId = parts.slice(0, parts.length - 1).join('_');
        const hasChildKeys = Object.keys(DATA.assignments).some(k => k.startsWith(`${cId}_${tIdx}~`));
        if (hasChildKeys) toDelete.push(key);
    });
    toDelete.forEach(k => delete DATA.assignments[k]);
    if (toDelete.length > 0) saveData();
}

function checkAndFixData() {
    if (!DATA) return;
    
    // 0. Nettoyer les anciennes affectations de groupe sans ~childSub
    cleanGroupAssignments();

    // 1. Lier UNSS à EPS
    if (DATA.subjects.includes("UNSS")) {
        if (!DATA.subjectMeta["UNSS"]) DATA.subjectMeta["UNSS"] = {};
        DATA.subjectMeta["UNSS"].parent = "EPS";
        DATA.subjectMeta["UNSS"].mode = "etab"; 
    }

    // 2. Créer les matières "Laboratoire" UNIQUEMENT pour SVT et Physique
    // On retire "Techno" de la liste
    const scienceSubjects = ["SVT", "Phys-Chi", "Sciences", "S. V. T.", "PHYSIQUE-CHIMIE"];
    
    scienceSubjects.forEach(sc => {
        // On cherche si la matière existe
        const parentExists = DATA.subjects.find(s => s.toUpperCase() === sc.toUpperCase() && !DATA.subjectMeta[s]?.parent);
        
        if (parentExists) {
            const laboName = `Labo ${parentExists}`; // Ex: "Labo SVT"
            
            // On crée le Labo seulement s'il n'existe pas
            if (!DATA.subjects.includes(laboName)) {
                DATA.subjects.push(laboName);
                DATA.subjectMeta[laboName] = {
                    mode: 'etab',       
                    parent: parentExists,
                    code: 'LAB',
                    etab: 0             
                };
            } else {
                // S'il existe, on force le mode 'etab' et le code 'LAB'
                if(DATA.subjectMeta[laboName]) {
                    DATA.subjectMeta[laboName].parent = parentExists;
                    DATA.subjectMeta[laboName].mode = 'etab';
                    DATA.subjectMeta[laboName].code = 'LAB';
                }
            }
        }
    });
    
    // Nettoyage éventuel : Si un "Labo Techno" traîne d'une version précédente, on pourrait le supprimer ici,
    // mais par sécurité on le laisse juste inactif ou on le supprime manuellement via le menu Matières.

    saveData();
}

/**
 * Met à jour la décharge d'un enseignant depuis la grille "Labo"
 */
function updateDechargeFromGrid(tIdx, val, inputElement) {
    const teacher = SHARED_TEACHERS[tIdx];
    if (teacher) {
        teacher.decharge = parseFloat(val) || 0;
        saveData();
        
        // Mise à jour visuelle des totaux de la ligne
        if (inputElement) {
             const row = inputElement.closest('tr');
             // On met à jour la cellule "Tot. Mat." (dernière cellule)
             // Note : Pour une décharge, le "Tot. Mat." est égal à la décharge elle-même
             if(row) {
                 const cells = row.cells;
                 const totMatCell = cells[cells.length - 1]; // Tot. Mat. uniquement
                 if (totMatCell) totMatCell.innerText = teacher.decharge.toFixed(1);
             }
        }
    }
}

/**
 * CALCULE LE SERVICE RÉEL (FACE À ÉLÈVES) D'UN ENSEIGNANT
 * Prend en compte les heures de co-enseignement saisies manuellement
 */
function getTeacherLiveService(teacherIdx) {
    const teacher = SHARED_TEACHERS[teacherIdx];
    if (!teacher) return 0;

    let totalService = 0;
    
    // On parcourt toutes les clés d'affectations (format: "ClasseID_ProfIndex")
    Object.keys(DATA.assignments).forEach(key => {
        const [cId, tIdx] = key.split('_');
        
        if (parseInt(tIdx) === teacherIdx) {
            const assign = DATA.assignments[key];
            
            // Si une répartition manuelle (quota) existe, on l'utilise
            if (assign.quota !== undefined && assign.quota !== null) {
                totalService += parseFloat(assign.quota);
            } else {
                // Sinon, on récupère la valeur par défaut de la grille horaire
                const levelObj = DATA.structure.find(l => cId.startsWith(getLevelPrefix(l.level)));
                if (levelObj) {
                    totalService += getHoursForClassSubject(cId, levelObj.level, teacher.subject);
                }
            }
        }
    });
    return totalService;
}

function updateCoTeaching(cId, tIdx, val, inputElement) {
    const hours = parseFloat(val);
    const key = `${cId}_${tIdx}`;

    // --- 1. SAUVEGARDE (Back-End) ---
    if (isNaN(hours) || hours <= 0) {
        if (DATA.assignments[key]) delete DATA.assignments[key];
        if (inputElement) {
            inputElement.style.borderColor = '#eee';
            inputElement.style.fontWeight = 'normal';
            inputElement.parentElement.style.background = 'white';
        }
    } else {
        if (!DATA.assignments[key]) DATA.assignments[key] = { mode: 'CLASS', quota: hours, isPP: false };
        else DATA.assignments[key].quota = hours;
        
        if (inputElement) {
            inputElement.style.borderColor = '#90caf9';
            inputElement.style.fontWeight = 'bold';
            inputElement.parentElement.style.background = '#e3f2fd';
        }
    }

    // Calcul auto Groupe/Classe
    const teacher = SHARED_TEACHERS[tIdx];
    if (teacher) {
        const subject = teacher.subject;
        const assignedPeers = getEntityTeachers().map(t => t.idx)
            .filter(idx => {
                const k = `${cId}_${idx}`;
                return DATA.assignments[k] && (SHARED_TEACHERS[idx]||{subject:''}).subject === subject;
            });
        const newMode = assignedPeers.length > 1 ? 'GROUP' : 'CLASS';
        assignedPeers.forEach(idx => {
            const k = `${cId}_${idx}`;
            if (DATA.assignments[k]) DATA.assignments[k].mode = newMode;
        });
    }
    
    saveData();

    // --- 2. MISE À JOUR VISUELLE (Front-End) ---
    if (inputElement) {
        const table = inputElement.closest('table');
        const row = inputElement.closest('tr');
        
        // A. MISE À JOUR LIGNE (PROF)
        if (row) {
            const inputs = row.querySelectorAll('input[type="number"]');
            let rowTotal = 0;
            inputs.forEach(inp => rowTotal += parseFloat(inp.value) || 0);
            
            // Unique cellule de total : Tot. Mat. (dernière cellule)
            const cellTotMat = row.cells[row.cells.length - 1];
            if (cellTotMat) {
                cellTotMat.innerText = rowTotal.toFixed(1);
                cellTotMat.style.backgroundColor = rowTotal > 0 ? '#e8f0fe' : 'white';
                cellTotMat.style.color = rowTotal > 0 ? '#2c3e50' : 'black';
            }
        }

        // B. MISE À JOUR COLONNE (RELIQUAT)
        const cell = inputElement.closest('td');
        const colIdx = cell.cellIndex;
        
        // On récupère le besoin (ligne 2 du header, car ligne 1 = titres colonnes)
        const needCell = table.tHead.rows[1].cells[colIdx];
        const needVal = parseFloat(needCell.innerText) || 0;

        let colSum = 0;
        const bodyRows = table.tBodies[0].rows;
        // On boucle sur toutes les lignes sauf la dernière (le reliquat)
        for(let i=0; i < bodyRows.length - 1; i++) {
            const cellInRow = bodyRows[i].cells[colIdx];
            if(cellInRow) {
                const inputInRow = cellInRow.querySelector('input');
                if(inputInRow) colSum += parseFloat(inputInRow.value) || 0;
            }
        }

        const diff = needVal - colSum;
        const reliquatRow = table.tBodies[0].lastElementChild;
        const reliquatCell = reliquatRow.cells[colIdx];
        
        if (reliquatCell) {
            if (Math.abs(diff) < 0.01) {
                reliquatCell.innerText = "OK";
                reliquatCell.style.color = "#27ae60";
            } else {
                reliquatCell.innerText = diff.toFixed(1);
                reliquatCell.style.color = diff > 0 ? "#c0392b" : "#e67e22";
            }
        }
    }
}

/**
 * RÉCUPÈRE LE PRÉFIXE DU NIVEAU (ex: "6" pour "6ème")
 */
function getLevelPrefix(levelName) {
    return levelName.replace(/[^0-9]/g, '') || levelName.charAt(0);
}

// Helper pour récupérer l'horaire d'une classe (gère les overrides)
function getHoursForClassSubject(cId, levelName, subject) {
    const meta = DATA.subjectMeta[subject];
    if (!meta || meta.mode === 'etab') return 0;
    if (meta.mode === 'level') return (meta.volLevel && meta.volLevel[levelName]) || 0;
    
    // Mode groupe (sur-matière) : sommer les heures de toutes les sous-matières enfants
    if (meta.mode === 'group') {
        const children = (DATA.subjects || []).filter(s => DATA.subjectMeta[s]?.parent === subject);
        return children.reduce((sum, child) => sum + getHoursForClassSubject(cId, levelName, child), 0);
    }
    
    const cfg = (DATA.classOverrides && DATA.classOverrides[cId] && DATA.classOverrides[cId][subject]) 
                ? DATA.classOverrides[cId][subject] 
                : (DATA.levelConfig[levelName] ? DATA.levelConfig[levelName][subject] : null);
    
    return cfg ? (getEffectiveBase(cfg) + (cfg.marge || 0)) * (cfg.coef || 1) : 0;
}
/**
 * Calcule la somme de TOUTES les heures assignées à un prof
 * (Toutes matières et toutes classes confondues)
 */
/**
 * Calcule le service total d'un enseignant dans l'entité courante
 * Utilise calcTeacherHoursBreakdown pour tenir compte de TOUTES les matières,
 * de la pondération plafonnée, et des EDS.
 */
function getGlobalTeacherService(tIdx) {
    return calcTeacherHoursBreakdown(tIdx, currentEntity).weighted;
}

let currentSubjectForLinking = ""; // Variable globale temporaire

function openLinkedSubjectsModal(subjectName) {
    currentSubjectForLinking = subjectName;
    const container = document.getElementById('linked-subjects-list');
    const title = document.getElementById('linked-modal-target-name');
    const overlay = document.getElementById('linked-subjects-overlay');
    
    // Titre
    title.innerText = subjectName;
    container.innerHTML = '';
    
    // Récupération des données existantes
    const m = DATA.subjectMeta[subjectName];
    const linkedList = m.linkedSubjects || [];

    // Génération des cases à cocher (Toutes les matières sauf elle-même)
    const sortedSubjects = [...DATA.subjects].sort();
    
    sortedSubjects.forEach(s => {
        if (s !== subjectName) {
            const isChecked = linkedList.includes(s);
            const safeS = s.replace(/'/g, "\\'");
            
            // Création de l'élément visuel
            const item = document.createElement('label');
            item.style.cssText = `
                display:flex; align-items:center; gap:8px; 
                padding:8px; background:white; border:1px solid #eee; 
                border-radius:4px; cursor:pointer; transition:0.1s;
            `;
            // Effet hover
            item.onmouseover = () => item.style.background = "#ebf5fb";
            item.onmouseout = () => item.style.background = "white";

            item.innerHTML = `
                <input type="checkbox" 
                       ${isChecked ? 'checked' : ''} 
                       onchange="toggleLinkedSubjectInModal('${safeS}')"
                       style="width:16px; height:16px; cursor:pointer;">
                <span style="font-size:0.9rem; color:#2c3e50; font-weight:500;">${s}</span>
            `;
            container.appendChild(item);
        }
    });

    // Affichage
    overlay.style.display = 'flex';
}

function toggleLinkedSubjectInModal(linkedSubject) {
    if (!currentSubjectForLinking) return;
    const m = DATA.subjectMeta[currentSubjectForLinking];
    
    if (!m.linkedSubjects) m.linkedSubjects = [];
    
    const idx = m.linkedSubjects.indexOf(linkedSubject);
    if (idx > -1) {
        m.linkedSubjects.splice(idx, 1);
    } else {
        m.linkedSubjects.push(linkedSubject);
    }
    
    saveData();
    // On ne recharge pas la page ici pour garder la fluidité dans la modale
}

function closeLinkedSubjectsModal() {
    document.getElementById('linked-subjects-overlay').style.display = 'none';
    currentSubjectForLinking = "";
    
    // On recharge la liste des matières pour mettre à jour les compteurs sur les boutons
    renderSubjectsConfig();
}

function sanitizeLegacyData() {
    if (!DATA.eds) return;

    // 1. Dictionnaire des synonymes courants (Minuscule sans accent -> Nom Officiel EDS)
    // Cela permet de faire le lien entre "Maths" (saisi main) et "Mathématiques" (EDS)
    const aliases = {
        "maths": "Mathématiques",
        "math": "Mathématiques",
        "mathematiques": "Mathématiques",
        "ses": "Sciences Économiques et Sociales",
        "eco": "Sciences Économiques et Sociales",
        "nsi": "Numérique et Sciences Informatiques",
        "si": "Sciences de l'Ingénieur",
        "svt": "Sciences de la Vie et de la Terre",
        "bio": "Sciences de la Vie et de la Terre",
        "llce": "LLCE Anglais", // ou autre langue selon votre menu
        "amc": "LLCE Anglais Monde Contempo.",
        "hlp": "Humanités, Littérature et Philosophie",
        "hggsp": "Histoire-Géo, Géopolitique & SP",
        "hgg": "Histoire-Géo, Géopolitique & SP",
        "geopo": "Histoire-Géo, Géopolitique & SP",
        "physique": "Physique-Chimie",
        "pc": "Physique-Chimie"
    };

    // Fonction pour nettoyer une chaine (minuscule, sans accent, sans espace inutile)
    const cleanStr = (str) => str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();

    console.log("Nettoyage intelligent des doublons EDS...");

    // On parcourt TOUTES les matières existantes du tableau
    DATA.subjects.forEach(subjectName => {
        const cleanName = cleanStr(subjectName);
        
        // On vérifie si cette matière correspond à un EDS actif (via Nom Exact ou Alias)
        ['premiere', 'terminale'].forEach(level => {
            if (DATA.eds[level]) {
                DATA.eds[level].forEach(edsItem => {
                    const cleanEdsName = cleanStr(edsItem.name);
                    
                    // Est-ce que ça matche ?
                    // 1. Nom exact nettoyé (ex: "mathematiques" == "mathematiques")
                    // 2. Via l'alias (ex: "maths" -> "mathematiques" == "mathematiques")
                    const isMatch = (cleanName === cleanEdsName) || 
                                    (aliases[cleanName] === edsItem.name);

                    if (isMatch) {
                        // BINGO ! C'est un doublon. On cache la matière manuelle.
                        if (!DATA.subjectMeta[subjectName]) DATA.subjectMeta[subjectName] = {};
                        
                        // On applique les tags pour la masquer de la grille
                        DATA.subjectMeta[subjectName].isEds = true;
                        DATA.subjectMeta[subjectName].mode = 'level';
                        DATA.subjectMeta[subjectName].parent = "Spécialités";
                        
                        console.log(`Doublon détecté et corrigé : "${subjectName}" est lié à l'EDS "${edsItem.name}"`);
                    }
                });
            }
        });
    });
}
</script>

<div style="position: absolute !important; top: 0px !important; left: 0px !important; height: 0px !important; width: 0px !important; display: initial !important;" data-lastpass-root=""></div></body></html>
    </template>

</body></html>